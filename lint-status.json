[{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\__tests__\\integration\\library.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'singleDrainageProduct' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":45,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"singleDrainageProduct"},"fix":{"range":[1139,1162],"text":""},"desc":"Remove unused variable \"singleDrainageProduct\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'singlePendingProduct' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"singlePendingProduct"},"fix":{"range":[1162,1184],"text":""},"desc":"Remove unused variable \"singlePendingProduct\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createMockProducts' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":69,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":87,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"createMockProducts"},"fix":{"range":[1184,1204],"text":""},"desc":"Remove unused variable \"createMockProducts\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n// @vitest-environment jsdom\r\n/**\r\n * Integration Tests: Product Library Page Workflows\r\n *\r\n * Tests complete user workflows for the Product Library page:\r\n * 1. Add product - Form submission - Product appears in list\r\n * 2. Edit product - Update fields - Changes saved\r\n * 3. Delete product - Confirmation dialog - Product removed\r\n * 4. Product enrichment - Trigger enrichment - Progress shown - Enriched data displayed\r\n * 5. Search/filter products - Filter applied - List updates\r\n *\r\n * @file client/src/__tests__/integration/library.test.tsx\r\n */\r\nimport React from 'react';\r\nimport { vi, describe, it, expect, beforeEach, afterEach, beforeAll, afterAll } from 'vitest';\r\nimport { http, HttpResponse } from 'msw';\r\nimport { setupServer } from 'msw/node';\r\nimport userEvent from '@testing-library/user-event';\r\n\r\nimport { render, screen, waitFor, within, createMockProduct, resetIdCounter } from '@/test-utils';\r\nimport '@testing-library/jest-dom';\r\nimport type { Product } from '@shared/schema';\r\n\r\n// Import fixtures\r\nimport { mockProducts, singleDrainageProduct, singlePendingProduct, createMockProducts } from '@/fixtures';\r\n\r\n// ============================================\r\n// MOCKS\r\n// ============================================\r\n\r\n// Mock the Header component to avoid complex dependencies\r\nvi.mock('@/components/layout/Header', () => ({\r\n  Header: ({ currentPage }: { currentPage: string }) => (\r\n    <header data-testid=\"mock-header\" data-page={currentPage}>\r\n      Mock Header\r\n    </header>\r\n  ),\r\n}));\r\n\r\n// Mock wouter Link for navigation tracking\r\nconst mockNavigate = vi.fn();\r\nvi.mock('wouter', async () => {\r\n  const actual = await vi.importActual('wouter');\r\n  return {\r\n    ...actual,\r\n    useLocation: () => ['/', mockNavigate],\r\n    Link: ({ href, children, className }: { href: string; children: React.ReactNode; className?: string }) => (\r\n      <a href={href} className={className} data-testid={`link-${href.replace(/\\//g, '-')}`}>\r\n        {children}\r\n      </a>\r\n    ),\r\n  };\r\n});\r\n\r\n// Mock framer-motion for simpler testing\r\nvi.mock('framer-motion', () => ({\r\n  motion: {\r\n    div: ({\r\n      children,\r\n      initial: _initial,\r\n      animate: _animate,\r\n      exit: _exit,\r\n      transition: _transition,\r\n      ...props\r\n    }: React.PropsWithChildren<Record<string, unknown>>) => <div {...props}>{children}</div>,\r\n  },\r\n  AnimatePresence: ({ children }: React.PropsWithChildren) => <>{children}</>,\r\n}));\r\n\r\n// Mock react-dropzone for file upload testing\r\nvi.mock('react-dropzone', () => ({\r\n  useDropzone: ({ onDrop }: { onDrop: (files: File[]) => void }) => ({\r\n    getRootProps: () => ({\r\n      onClick: () => {},\r\n      onDrop: (e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        const files = Array.from(e.dataTransfer?.files || []);\r\n        onDrop(files);\r\n      },\r\n    }),\r\n    getInputProps: () => ({\r\n      type: 'file',\r\n      accept: 'image/*',\r\n      'data-testid': 'file-input',\r\n      onChange: (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const files = Array.from(e.target.files || []);\r\n        onDrop(files);\r\n      },\r\n    }),\r\n    isDragActive: false,\r\n  }),\r\n}));\r\n\r\n// Mock toast for tracking notifications\r\nconst mockToast = vi.fn();\r\nvi.mock('@/hooks/use-toast', () => ({\r\n  useToast: () => ({\r\n    toast: mockToast,\r\n  }),\r\n}));\r\n\r\n// ============================================\r\n// MSW HANDLERS\r\n// ============================================\r\n\r\n// Mutable state for tests\r\nlet serverProducts: Product[] = [...mockProducts];\r\n\r\nconst handlers = [\r\n  // GET /api/products - List all products\r\n  http.get('/api/products', () => {\r\n    return HttpResponse.json(serverProducts);\r\n  }),\r\n\r\n  // GET /api/products/:id - Get single product\r\n  http.get('/api/products/:id', ({ params }) => {\r\n    const product = serverProducts.find((p) => p.id === params.id);\r\n    if (!product) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(product);\r\n  }),\r\n\r\n  // POST /api/products - Create new product\r\n  http.post('/api/products', async ({ request }) => {\r\n    const formData = await request.formData();\r\n    const name = formData.get('name') as string;\r\n    const category = formData.get('category') as string;\r\n    const description = formData.get('description') as string;\r\n\r\n    const newProduct = createMockProduct({\r\n      id: `prod-new-${Date.now()}`,\r\n      name: name || 'New Product',\r\n      category: category || 'uncategorized',\r\n      description: description || '',\r\n      enrichmentStatus: 'pending',\r\n    });\r\n\r\n    serverProducts = [...serverProducts, newProduct];\r\n    return HttpResponse.json(newProduct, { status: 201 });\r\n  }),\r\n\r\n  // PATCH /api/products/:id - Update product\r\n  http.patch('/api/products/:id', async ({ params, request }) => {\r\n    const body = (await request.json()) as Partial<Product>;\r\n    const productIndex = serverProducts.findIndex((p) => p.id === params.id);\r\n\r\n    if (productIndex === -1) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    const existingProduct = serverProducts[productIndex];\r\n    if (!existingProduct) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    const updatedProduct = {\r\n      ...existingProduct,\r\n      ...body,\r\n    };\r\n    serverProducts[productIndex] = updatedProduct;\r\n\r\n    return HttpResponse.json(updatedProduct);\r\n  }),\r\n\r\n  // DELETE /api/products/:id - Delete product\r\n  http.delete('/api/products/:id', ({ params }) => {\r\n    const productIndex = serverProducts.findIndex((p) => p.id === params.id);\r\n\r\n    if (productIndex === -1) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    serverProducts = serverProducts.filter((p) => p.id !== params.id);\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // GET /api/products/:id/enrichment - Get enrichment status\r\n  http.get('/api/products/:id/enrichment', ({ params }) => {\r\n    const product = serverProducts.find((p) => p.id === params.id);\r\n    if (!product) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    return HttpResponse.json({\r\n      productId: product.id,\r\n      status: product.enrichmentStatus || 'pending',\r\n      draft: product.enrichmentDraft,\r\n      verifiedAt: product.enrichmentVerifiedAt,\r\n      source: product.enrichmentSource,\r\n      completeness: {\r\n        percentage: product.enrichmentStatus === 'complete' ? 100 : 45,\r\n        missing: product.enrichmentStatus === 'complete' ? [] : ['features', 'specifications'],\r\n      },\r\n      isReady: product.enrichmentStatus === 'complete',\r\n    });\r\n  }),\r\n\r\n  // POST /api/products/:id/enrich - Generate AI draft\r\n  http.post('/api/products/:id/enrich', async ({ params }) => {\r\n    const productIndex = serverProducts.findIndex((p) => p.id === params.id);\r\n\r\n    if (productIndex === -1) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    const existingProduct = serverProducts[productIndex];\r\n    if (!existingProduct) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    // Simulate AI enrichment\r\n    const enrichedProduct = {\r\n      ...existingProduct,\r\n      enrichmentStatus: 'draft' as const,\r\n      enrichmentDraft: {\r\n        description: 'AI-generated description for the product.',\r\n        features: { material: 'High-quality', size: 'Standard' },\r\n        benefits: ['Durable', 'Easy to install', 'Cost-effective'],\r\n        specifications: { weight: '5 lbs', dimensions: '10x10x5 inches' },\r\n        tags: ['construction', 'building-materials'],\r\n        confidence: 85,\r\n        sources: [\r\n          { type: 'vision' as const, detail: 'Image analysis' },\r\n          { type: 'kb' as const, detail: 'Knowledge base' },\r\n        ],\r\n        generatedAt: new Date().toISOString(),\r\n      },\r\n      enrichmentSource: 'ai_vision',\r\n    };\r\n\r\n    serverProducts[productIndex] = enrichedProduct;\r\n\r\n    return HttpResponse.json({\r\n      success: true,\r\n      draft: enrichedProduct.enrichmentDraft,\r\n    });\r\n  }),\r\n\r\n  // POST /api/products/:id/enrichment/verify - Verify and save enrichment\r\n  http.post('/api/products/:id/enrichment/verify', async ({ params, request }) => {\r\n    const body = (await request.json()) as { approvedAsIs?: boolean; description?: string };\r\n    const productIndex = serverProducts.findIndex((p) => p.id === params.id);\r\n\r\n    if (productIndex === -1) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    const existingProduct = serverProducts[productIndex];\r\n    if (!existingProduct) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n\r\n    const verifiedProduct = {\r\n      ...existingProduct,\r\n      enrichmentStatus: 'verified' as const,\r\n      enrichmentVerifiedAt: new Date(),\r\n      description: body.description || existingProduct.description,\r\n    };\r\n\r\n    serverProducts[productIndex] = verifiedProduct;\r\n\r\n    return HttpResponse.json({\r\n      success: true,\r\n      product: verifiedProduct,\r\n    });\r\n  }),\r\n];\r\n\r\nconst server = setupServer(...handlers);\r\n\r\n// ============================================\r\n// TEST SETUP\r\n// ============================================\r\n\r\nlet ProductLibrary: React.ComponentType<{\r\n  embedded?: boolean;\r\n  selectedId?: string | null;\r\n}>;\r\n\r\nbeforeAll(() => {\r\n  server.listen({ onUnhandledRequest: 'error' });\r\n});\r\n\r\nafterAll(() => {\r\n  server.close();\r\n});\r\n\r\nbeforeEach(async () => {\r\n  vi.resetAllMocks();\r\n  resetIdCounter();\r\n  mockNavigate.mockClear();\r\n  mockToast.mockClear();\r\n\r\n  // Reset server products to initial state\r\n  serverProducts = [...mockProducts];\r\n\r\n  // Dynamically import component to reset module state\r\n  const module = await import('@/pages/ProductLibrary');\r\n  ProductLibrary = module.default;\r\n});\r\n\r\nafterEach(() => {\r\n  server.resetHandlers();\r\n  vi.restoreAllMocks();\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST 1: ADD PRODUCT WORKFLOW\r\n// ============================================\r\n\r\ndescribe('Integration Test 1: Add Product Workflow', () => {\r\n  it('opens Add Product modal, submits form, and product appears in list', { timeout: 15000 }, async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Add Product\" button\r\n    const addButton = screen.getByRole('button', { name: /add product/i });\r\n    await user.click(addButton);\r\n\r\n    // Verify modal opens with the AddProductModal mock\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Add New Product')).toBeInTheDocument();\r\n    });\r\n\r\n    // The AddProductModal is mocked, so we verify the modal opens correctly\r\n    // and the Cancel button is functional (form interaction requires the real component)\r\n    const cancelButton = screen.getByRole('button', { name: /cancel/i });\r\n    expect(cancelButton).toBeInTheDocument();\r\n    await user.click(cancelButton);\r\n\r\n    // Modal should close after cancel\r\n    await waitFor(() => {\r\n      expect(screen.queryByText('Add New Product')).not.toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows validation error when required fields are missing', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Add Product\" button\r\n    const addButton = screen.getByRole('button', { name: /add product/i });\r\n    await user.click(addButton);\r\n\r\n    // Wait for modal\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Add New Product')).toBeInTheDocument();\r\n    });\r\n\r\n    // Try to submit without filling required fields (image and name)\r\n    // The submit button inside the modal should be disabled when no file is selected\r\n    // Use the dialog scope to avoid picking up the page-level \"Add Product\" trigger button\r\n    const dialog = screen.getByRole('dialog');\r\n    const submitButton = within(dialog).getByRole('button', { name: /add product/i });\r\n    expect(submitButton).toBeDisabled();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST 2: EDIT PRODUCT WORKFLOW\r\n// ============================================\r\n\r\ndescribe('Integration Test 2: Edit Product Workflow', () => {\r\n  it('opens product detail modal and displays editable enrichment form', { timeout: 15000 }, async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click on a product to open details\r\n    const productCard = screen.getByText('NDS EZ-Drain Pre-Constructed French Drain');\r\n    await user.click(productCard);\r\n\r\n    // Wait for modal to open\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    // Verify all three tabs are present (tabs are unique to the dialog)\r\n    expect(screen.getByRole('tab', { name: /details/i })).toBeInTheDocument();\r\n    expect(screen.getByRole('tab', { name: /relationships/i })).toBeInTheDocument();\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n    expect(enrichTab).toBeInTheDocument();\r\n\r\n    // Click enrich tab (Note: Radix tabs don't propagate state in jsdom,\r\n    // so TabsContent may not switch. We verify the tab exists and is clickable.)\r\n    await user.click(enrichTab);\r\n\r\n    // The dialog shows the product name (may appear in both grid card and dialog)\r\n    const productNameElements = screen.getAllByText('NDS EZ-Drain Pre-Constructed French Drain');\r\n    expect(productNameElements.length).toBeGreaterThanOrEqual(1);\r\n  });\r\n\r\n  it('allows editing description through enrichment form and saving changes', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    // Use a pending product that needs enrichment\r\n    const testProduct = createMockProduct({\r\n      id: 'prod-test-edit',\r\n      name: 'Product For Editing',\r\n      description: 'Original description',\r\n      enrichmentStatus: 'draft',\r\n      enrichmentDraft: {\r\n        description: 'Draft description',\r\n        features: {},\r\n        benefits: ['Benefit 1'],\r\n        specifications: {},\r\n        tags: ['tag1'],\r\n        confidence: 80,\r\n        sources: [{ type: 'vision' as const, detail: 'Image analysis' }],\r\n        generatedAt: new Date().toISOString(),\r\n      },\r\n    });\r\n    serverProducts = [testProduct, ...serverProducts];\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Product For Editing')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click on the product\r\n    const productCard = screen.getByText('Product For Editing');\r\n    await user.click(productCard);\r\n\r\n    // Wait for modal\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    // Verify tabs exist (tabs are unique to the dialog)\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n    expect(enrichTab).toBeInTheDocument();\r\n\r\n    // Click enrich tab - Radix tabs may not propagate state in jsdom\r\n    await user.click(enrichTab);\r\n\r\n    // Verify the dialog is still open and shows the product name\r\n    const productNameElements = screen.getAllByText('Product For Editing');\r\n    expect(productNameElements.length).toBeGreaterThanOrEqual(1);\r\n  });\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST 3: DELETE PRODUCT WORKFLOW\r\n// ============================================\r\n\r\ndescribe('Integration Test 3: Delete Product Workflow', () => {\r\n  it('shows confirmation dialog, confirms deletion, and removes product from list', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Get initial count\r\n    const initialCount = serverProducts.length;\r\n    const productToDelete = serverProducts[0];\r\n\r\n    // Find the product card and hover to reveal delete button\r\n    const productCards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n    const firstCard = productCards[0];\r\n    expect(firstCard).toBeDefined();\r\n\r\n    // Find delete button (absolute positioned on the card)\r\n    const deleteButton = firstCard?.querySelector('button');\r\n    expect(deleteButton).toBeDefined();\r\n\r\n    if (deleteButton) {\r\n      await user.click(deleteButton);\r\n\r\n      // Wait for confirmation dialog\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n        expect(screen.getByText(/are you sure you want to delete/i)).toBeInTheDocument();\r\n      });\r\n\r\n      // Find and click the confirm delete button\r\n      const confirmButton = screen.getByRole('button', { name: /^delete$/i });\r\n      await user.click(confirmButton);\r\n\r\n      // Wait for deletion to complete\r\n      await waitFor(() => {\r\n        expect(serverProducts.length).toBe(initialCount - 1);\r\n      });\r\n\r\n      // Verify the deleted product is no longer in the list\r\n      expect(serverProducts.find((p) => p.id === productToDelete?.id)).toBeUndefined();\r\n\r\n      // Verify toast was called\r\n      expect(mockToast).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          title: 'Product deleted',\r\n        }),\r\n      );\r\n    }\r\n  });\r\n\r\n  it('cancels deletion when cancel button is clicked', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    const initialCount = serverProducts.length;\r\n\r\n    // Find and click delete button on first card\r\n    const productCards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n    const deleteButton = productCards[0]?.querySelector('button');\r\n\r\n    if (deleteButton) {\r\n      await user.click(deleteButton);\r\n\r\n      // Wait for confirmation dialog\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n      });\r\n\r\n      // Click cancel\r\n      const cancelButton = screen.getByRole('button', { name: /cancel/i });\r\n      await user.click(cancelButton);\r\n\r\n      // Dialog should close\r\n      await waitFor(() => {\r\n        expect(screen.queryByText('Delete Product')).not.toBeInTheDocument();\r\n      });\r\n\r\n      // Product should still exist\r\n      expect(serverProducts.length).toBe(initialCount);\r\n    }\r\n  });\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST 4: PRODUCT ENRICHMENT WORKFLOW\r\n// ============================================\r\n\r\ndescribe('Integration Test 4: Product Enrichment Workflow', () => {\r\n  it('triggers enrichment, shows progress, and displays enriched data', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    // Create a pending product that needs enrichment\r\n    const pendingProduct = createMockProduct({\r\n      id: 'prod-enrich-test',\r\n      name: 'Product Needing Enrichment',\r\n      enrichmentStatus: 'pending',\r\n      enrichmentDraft: null,\r\n    });\r\n    serverProducts = [pendingProduct, ...serverProducts];\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Product Needing Enrichment')).toBeInTheDocument();\r\n    });\r\n\r\n    // Check for \"Pending\" badge\r\n    const pendingBadges = screen.getAllByText('Pending');\r\n    expect(pendingBadges.length).toBeGreaterThan(0);\r\n\r\n    // Click on the product to open detail modal\r\n    const productCard = screen.getByText('Product Needing Enrichment');\r\n    await user.click(productCard);\r\n\r\n    // Wait for modal\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    // Go to Enrich tab\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n    await user.click(enrichTab);\r\n\r\n    // Wait for enrichment form to load\r\n    await waitFor(() => {\r\n      const statusElement = screen.queryByText(/needs enrichment/i);\r\n      // If status is shown, check it, otherwise just verify the form loaded\r\n      if (statusElement) {\r\n        expect(statusElement).toBeInTheDocument();\r\n      }\r\n    });\r\n\r\n    // Look for \"Generate Draft\" button\r\n    const generateButton = screen.queryByRole('button', { name: /generate draft/i });\r\n\r\n    if (generateButton) {\r\n      await user.click(generateButton);\r\n\r\n      // Wait for enrichment to complete\r\n      await waitFor(\r\n        () => {\r\n          // Check that the product status was updated in server state\r\n          const enrichedProduct = serverProducts.find((p) => p.id === 'prod-enrich-test');\r\n          expect(enrichedProduct?.enrichmentStatus).toBe('draft');\r\n        },\r\n        { timeout: 5000 },\r\n      );\r\n\r\n      // Verify enrichment draft was populated\r\n      const enrichedProduct = serverProducts.find((p) => p.id === 'prod-enrich-test');\r\n      expect(enrichedProduct?.enrichmentDraft).toBeDefined();\r\n      expect(enrichedProduct?.enrichmentDraft?.confidence).toBe(85);\r\n    }\r\n  });\r\n\r\n  it('displays enrichment sources and confidence score', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    // Create a product with existing draft\r\n    const draftProduct = createMockProduct({\r\n      id: 'prod-draft-display',\r\n      name: 'Product With Draft',\r\n      enrichmentStatus: 'draft',\r\n      enrichmentDraft: {\r\n        description: 'AI-generated description',\r\n        features: { material: 'Steel' },\r\n        benefits: ['Durable', 'Affordable'],\r\n        specifications: {},\r\n        tags: ['construction'],\r\n        confidence: 92,\r\n        sources: [\r\n          { type: 'vision' as const, detail: 'Image analysis completed' },\r\n          { type: 'web_search' as const, detail: 'Found on manufacturer site' },\r\n        ],\r\n        generatedAt: new Date().toISOString(),\r\n      },\r\n    });\r\n    serverProducts = [draftProduct, ...serverProducts];\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Product With Draft')).toBeInTheDocument();\r\n    });\r\n\r\n    // Should show \"Draft\" status badge\r\n    const draftBadges = screen.getAllByText('Draft');\r\n    expect(draftBadges.length).toBeGreaterThan(0);\r\n\r\n    // Click on the product\r\n    const productCard = screen.getByText('Product With Draft');\r\n    await user.click(productCard);\r\n\r\n    // Go to Enrich tab\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n    await user.click(enrichTab);\r\n\r\n    // Form should show the draft status\r\n    await waitFor(() => {\r\n      const draftStatus = screen.queryByText(/draft ready/i);\r\n      if (draftStatus) {\r\n        expect(draftStatus).toBeInTheDocument();\r\n      }\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST 5: SEARCH/FILTER WORKFLOW\r\n// ============================================\r\n\r\ndescribe('Integration Test 5: Search and Filter Workflow', () => {\r\n  it('filters products by name search query', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Get search input\r\n    const searchInput = screen.getByPlaceholderText(/search products/i);\r\n\r\n    // Type search query\r\n    await user.type(searchInput, 'EZ-Drain');\r\n\r\n    // Wait for filtered results\r\n    await waitFor(() => {\r\n      // The EZ-Drain product should still be visible\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Other products should not be visible (e.g., Liquid Rubber)\r\n    await waitFor(() => {\r\n      expect(screen.queryByText('Liquid Rubber Foundation Sealant')).not.toBeInTheDocument();\r\n    });\r\n\r\n    // Should show result count\r\n    expect(screen.getByText(/showing.*result.*for/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('filters products by category search', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Search by category\r\n    const searchInput = screen.getByPlaceholderText(/search products/i);\r\n    await user.type(searchInput, 'waterproofing');\r\n\r\n    // Wait for filtered results - should show waterproofing products\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Poly-Wall BlueSkin VP160 Self-Adhered Membrane')).toBeInTheDocument();\r\n    });\r\n\r\n    // Drainage products should not be visible\r\n    expect(screen.queryByText('NDS EZ-Drain Pre-Constructed French Drain')).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('filters products by tag search', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Search by tag\r\n    const searchInput = screen.getByPlaceholderText(/search products/i);\r\n    await user.type(searchInput, 'gravel-free');\r\n\r\n    // Wait for filtered results\r\n    await waitFor(() => {\r\n      // EZ-Drain has \"gravel-free\" tag\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows \"no results\" message when search has no matches', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Search for something that doesn't exist\r\n    const searchInput = screen.getByPlaceholderText(/search products/i);\r\n    await user.type(searchInput, 'xyznonexistentproduct123');\r\n\r\n    // Wait for no results message\r\n    await waitFor(() => {\r\n      expect(screen.getByText('No results found')).toBeInTheDocument();\r\n    });\r\n\r\n    // Clear search button should be available\r\n    const clearButton = screen.getByRole('button', { name: /clear search/i });\r\n    expect(clearButton).toBeInTheDocument();\r\n  });\r\n\r\n  it('clears search and shows all products', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Wait for products to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Apply a filter first\r\n    const searchInput = screen.getByPlaceholderText(/search products/i);\r\n    await user.type(searchInput, 'waterproofing');\r\n\r\n    // Wait for filter to apply\r\n    await waitFor(() => {\r\n      expect(screen.queryByText('NDS EZ-Drain Pre-Constructed French Drain')).not.toBeInTheDocument();\r\n    });\r\n\r\n    // Clear the search using the X button\r\n    const clearIcon = document.querySelector('button[class*=\"text-muted-foreground\"]');\r\n    if (clearIcon) {\r\n      await user.click(clearIcon);\r\n\r\n      // Wait for all products to reappear\r\n      await waitFor(() => {\r\n        expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n        expect(screen.getByText('Poly-Wall BlueSkin VP160 Self-Adhered Membrane')).toBeInTheDocument();\r\n      });\r\n    } else {\r\n      // Alternatively, clear the input manually\r\n      await user.clear(searchInput);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n      });\r\n    }\r\n  });\r\n});\r\n\r\n// ============================================\r\n// EDGE CASE TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('Integration Edge Cases', () => {\r\n  beforeEach(async () => {\r\n    vi.resetAllMocks();\r\n    resetIdCounter();\r\n    mockNavigate.mockClear();\r\n    mockToast.mockClear();\r\n    serverProducts = [...mockProducts];\r\n\r\n    const module = await import('@/pages/ProductLibrary');\r\n    ProductLibrary = module.default;\r\n  });\r\n\r\n  afterEach(() => {\r\n    server.resetHandlers();\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles concurrent delete operations gracefully', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    const initialCount = serverProducts.length;\r\n    const productCards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n\r\n    // Try to trigger multiple deletes rapidly\r\n    if (productCards[0]) {\r\n      const deleteButton = productCards[0].querySelector('button');\r\n      if (deleteButton) {\r\n        // First delete attempt\r\n        await user.click(deleteButton);\r\n\r\n        await waitFor(() => {\r\n          expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n        });\r\n\r\n        // Cancel to reset dialog state\r\n        await user.click(screen.getByRole('button', { name: /cancel/i }));\r\n\r\n        // Products should still exist\r\n        expect(serverProducts.length).toBe(initialCount);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles empty string in enrichment form submission', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    const emptyDescProduct = createMockProduct({\r\n      id: 'prod-empty-desc',\r\n      name: 'Product With Empty Description',\r\n      description: '',\r\n      enrichmentStatus: 'draft',\r\n      enrichmentDraft: {\r\n        description: '',\r\n        features: {},\r\n        benefits: [],\r\n        specifications: {},\r\n        tags: [],\r\n        confidence: 50,\r\n        sources: [],\r\n        generatedAt: new Date().toISOString(),\r\n      },\r\n    });\r\n    serverProducts = [emptyDescProduct, ...serverProducts];\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Product With Empty Description')).toBeInTheDocument();\r\n    });\r\n\r\n    // Open the product modal\r\n    await user.click(screen.getByText('Product With Empty Description'));\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    // Verify dialog opened and has all tabs\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n    expect(enrichTab).toBeInTheDocument();\r\n\r\n    // Click enrich tab - Radix tabs may not switch in jsdom\r\n    await user.click(enrichTab);\r\n\r\n    // Should handle empty enrichment data without crashing\r\n    // Product name appears in both the grid card and the dialog\r\n    const productNameElements = screen.getAllByText('Product With Empty Description');\r\n    expect(productNameElements.length).toBeGreaterThanOrEqual(1);\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles rapid tab switching in product modal', async () => {\r\n    const user = userEvent.setup();\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain')).toBeInTheDocument();\r\n    });\r\n\r\n    // Open modal\r\n    await user.click(screen.getByText('NDS EZ-Drain Pre-Constructed French Drain'));\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n    });\r\n\r\n    // Rapid tab switching\r\n    const detailsTab = screen.getByRole('tab', { name: /details/i });\r\n    const relationshipsTab = screen.getByRole('tab', { name: /relationships/i });\r\n    const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n\r\n    for (let i = 0; i < 5; i++) {\r\n      await user.click(detailsTab);\r\n      await user.click(relationshipsTab);\r\n      await user.click(enrichTab);\r\n    }\r\n\r\n    // Modal should remain stable\r\n    expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles maximum length product name (255 characters)', async () => {\r\n    const longNameProduct = createMockProduct({\r\n      id: 'prod-long-name',\r\n      name: 'A'.repeat(255),\r\n      enrichmentStatus: 'pending',\r\n    });\r\n    serverProducts = [longNameProduct, ...serverProducts];\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    await waitFor(() => {\r\n      // Product with long name should be rendered\r\n      const longNameElements = screen.queryAllByText('A'.repeat(255).slice(0, 50), { exact: false });\r\n      // Either the full name or a truncated version should be visible\r\n      expect(\r\n        longNameElements.length >= 0 || screen.getByText('NDS EZ-Drain Pre-Constructed French Drain'),\r\n      ).toBeTruthy();\r\n    });\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles server returning malformed JSON', async () => {\r\n    server.use(\r\n      http.get('/api/products', () => {\r\n        return new HttpResponse('Not valid JSON {{{', {\r\n          status: 200,\r\n          headers: { 'Content-Type': 'application/json' },\r\n        });\r\n      }),\r\n    );\r\n\r\n    render(<ProductLibrary />);\r\n\r\n    // Should show error state when JSON parsing fails\r\n    await waitFor(() => {\r\n      const errorState = screen.queryByText('Failed to load products');\r\n      const emptyState = screen.queryByText('No products yet');\r\n      // Either error or empty state should be shown\r\n      expect(errorState || emptyState).toBeTruthy();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\__tests__\\integration\\studio.test.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"beforeEach"},"fix":{"range":[634,646],"text":""},"desc":"Remove unused variable \"beforeEach\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":17,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"userEvent"},"fix":{"range":[769,823],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockProducts' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"mockProducts"},"fix":{"range":[1006,1019],"text":""},"desc":"Remove unused variable \"mockProducts\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2817,2820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2817,2820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3278,3281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3278,3281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3655,3658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3655,3658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4348,4351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4348,4351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5118,5121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5118,5121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":178,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":178,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5975,5978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5975,5978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":182,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":182,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6136,6139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6136,6139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":186,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":186,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6294,6297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6294,6297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6468,6471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6468,6471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8480,8483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8480,8483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8561,8564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8561,8564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8644,8647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8644,8647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8718,8721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8718,8721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8800,8803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8800,8803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8866,8869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8866,8869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":281,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8928,8931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8928,8931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9002,9005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9002,9005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":283,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9077,9080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9077,9080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9153,9156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9153,9156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":285,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9227,9230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9227,9230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'capturedRequest' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":492,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":492,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editPrompt' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":571,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":571,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editRequestCaptured' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":601,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":601,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":606,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":606,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchedGenerationId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":662,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":662,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\AdaptiveUploadZone.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3132,3135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3132,3135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * AdaptiveUploadZone Component\n *\n * A smart upload zone that adapts based on pattern library state:\n * - Empty state: Full onboarding experience with feature highlights\n * - Compact state: Minimal upload zone for existing pattern libraries\n *\n * Features:\n * - Drag & drop with visual feedback\n * - File validation (JPG, PNG, WebP, GIF, max 5MB)\n * - Metadata collection dialog\n * - Upload progress with status messages\n * - Privacy trust builders\n * - Framer Motion animations with reduced-motion support\n */\n\nimport { useState, useCallback, useRef } from \"react\";\nimport { motion, AnimatePresence, useReducedMotion } from \"framer-motion\";\nimport {\n  Upload,\n  Sparkles,\n  Shield,\n  Brain,\n  Loader2,\n  Layout,\n  Palette,\n  Target,\n  Image as ImageIcon,\n  BarChart3,\n  Star,\n  Zap,\n  Info,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\n// UI Components\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\n// ============================================\n// Constants\n// ============================================\n\nconst PATTERN_CATEGORIES = [\n  { value: \"product_showcase\", label: \"Product Showcase\", icon: ImageIcon, color: \"blue\" },\n  { value: \"testimonial\", label: \"Testimonial\", icon: Star, color: \"yellow\" },\n  { value: \"comparison\", label: \"Comparison\", icon: BarChart3, color: \"green\" },\n  { value: \"educational\", label: \"Educational\", icon: Brain, color: \"purple\" },\n  { value: \"promotional\", label: \"Promotional\", icon: Zap, color: \"orange\" },\n  { value: \"brand_awareness\", label: \"Brand Awareness\", icon: Target, color: \"pink\" },\n];\n\nconst PLATFORMS = [\n  { value: \"linkedin\", label: \"LinkedIn\" },\n  { value: \"facebook\", label: \"Facebook\" },\n  { value: \"instagram\", label: \"Instagram\" },\n  { value: \"twitter\", label: \"Twitter/X\" },\n  { value: \"tiktok\", label: \"TikTok\" },\n  { value: \"youtube\", label: \"YouTube\" },\n  { value: \"pinterest\", label: \"Pinterest\" },\n  { value: \"general\", label: \"General\" },\n];\n\nconst ENGAGEMENT_TIERS = [\n  { value: \"top-1\", label: \"Top 1%\", color: \"text-yellow-600 dark:text-yellow-400\" },\n  { value: \"top-5\", label: \"Top 5%\", color: \"text-orange-600 dark:text-orange-400\" },\n  { value: \"top-10\", label: \"Top 10%\", color: \"text-blue-600 dark:text-blue-400\" },\n  { value: \"top-25\", label: \"Top 25%\", color: \"text-green-600 dark:text-green-400\" },\n  { value: \"unverified\", label: \"Unverified\", color: \"text-muted-foreground\" },\n];\n\n// ============================================\n// Types\n// ============================================\n\ninterface UploadMetadata {\n  name: string;\n  category: string;\n  platform: string;\n  industry?: string;\n  engagementTier?: string;\n}\n\ninterface AdaptiveUploadZoneProps {\n  patterns: any[];\n  onUpload: (file: File, metadata: UploadMetadata) => void;\n  isUploading: boolean;\n  uploadProgress: number;\n  uploadStatus?: 'pending' | 'scanning' | 'extracting' | 'completed' | 'failed';\n  uploadError?: string;\n}\n\n// ============================================\n// Main Component\n// ============================================\n\nexport function AdaptiveUploadZone({\n  patterns,\n  onUpload,\n  isUploading,\n  uploadProgress,\n  uploadStatus: _uploadStatus,\n  uploadError,\n}: AdaptiveUploadZoneProps) {\n  const isEmpty = patterns.length === 0;\n  const [isDragging, setIsDragging] = useState(false);\n  const [previewFile, setPreviewFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [showMetadataForm, setShowMetadataForm] = useState(false);\n  const [metadata, setMetadata] = useState<UploadMetadata>({\n    name: \"\",\n    category: \"product_showcase\",\n    platform: \"general\",\n  });\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const shouldReduceMotion = useReducedMotion();\n\n  // ============================================\n  // File Validation\n  // ============================================\n\n  const validateFile = (file: File): string | null => {\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/webp\", \"image/gif\"];\n    const maxSize = 5 * 1024 * 1024; // 5MB\n\n    if (!allowedTypes.includes(file.type)) {\n      return \"Invalid file type. Please upload JPG, PNG, WebP, or GIF.\";\n    }\n    if (file.size > maxSize) {\n      return \"File too large. Maximum size is 5MB.\";\n    }\n    return null;\n  };\n\n  // ============================================\n  // Drag & Drop Handlers\n  // ============================================\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!isDragging) setIsDragging(true);\n  }, [isDragging]);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    const file = e.dataTransfer.files[0];\n    if (!file) return;\n\n    const error = validateFile(file);\n    if (error) {\n      // Error handled by parent\n      return;\n    }\n\n    setPreviewFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n    setMetadata(prev => ({ ...prev, name: file.name.replace(/\\.[^.]+$/, \"\") }));\n    setShowMetadataForm(true);\n  }, []);\n\n  // ============================================\n  // File Selection Handler\n  // ============================================\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const error = validateFile(file);\n    if (error) return;\n\n    setPreviewFile(file);\n    setPreviewUrl(URL.createObjectURL(file));\n    setMetadata(prev => ({ ...prev, name: file.name.replace(/\\.[^.]+$/, \"\") }));\n    setShowMetadataForm(true);\n  };\n\n  // ============================================\n  // Form Handlers\n  // ============================================\n\n  const handleSubmit = () => {\n    if (!previewFile || !metadata.name) return;\n    onUpload(previewFile, metadata);\n    setShowMetadataForm(false);\n  };\n\n  const handleCancel = () => {\n    setPreviewFile(null);\n    if (previewUrl) URL.revokeObjectURL(previewUrl);\n    setPreviewUrl(null);\n    setShowMetadataForm(false);\n    setMetadata({ name: \"\", category: \"product_showcase\", platform: \"general\" });\n  };\n\n  const handleUploadClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  // ============================================\n  // Upload Status Message\n  // ============================================\n\n  const getUploadStatusMessage = () => {\n    if (uploadProgress < 30) return \"Scanning for privacy...\";\n    if (uploadProgress >= 30 && uploadProgress < 70) return \"Extracting visual patterns...\";\n    if (uploadProgress >= 70) return \"Saving to your library...\";\n    return \"Processing...\";\n  };\n\n  // ============================================\n  // Empty State Render\n  // ============================================\n\n  if (isEmpty) {\n    return (\n      <>\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"flex flex-col items-center justify-center min-h-[50vh] text-center space-y-6\"\n        >\n          {/* Hero Icon */}\n          <div className=\"relative\">\n            <div className=\"w-24 h-24 rounded-3xl bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center\">\n              <Brain className=\"w-12 h-12 text-primary\" />\n            </div>\n            <div className=\"absolute -right-2 -bottom-2 w-10 h-10 rounded-xl bg-gradient-to-br from-yellow-500/30 to-orange-500/20 dark:from-yellow-500/20 dark:to-orange-500/10 flex items-center justify-center\">\n              <Sparkles className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\n            </div>\n          </div>\n\n          {/* Title & Description */}\n          <div className=\"max-w-md\">\n            <h2 className=\"text-2xl font-display font-semibold mb-2\">\n              Learn from Your Winners\n            </h2>\n            <p className=\"text-muted-foreground\">\n              Upload high-performing ads to extract success patterns.\n              Our AI analyzes layout, color psychology, hooks, and visual elements\n              to help you create more winning ads.\n            </p>\n          </div>\n\n          {/* CTA Button */}\n          <Button size=\"lg\" onClick={handleUploadClick} className=\"mt-2\">\n            <Upload className=\"w-4 h-4 mr-2\" />\n            Upload Your First Ad\n          </Button>\n\n          {/* Feature Highlights */}\n          <div className=\"grid grid-cols-3 gap-6 mt-8 max-w-2xl\">\n            <div className=\"text-center\">\n              <div className=\"w-10 h-10 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 flex items-center justify-center mx-auto mb-2\">\n                <Layout className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <p className=\"text-sm font-medium\">Layout Patterns</p>\n              <p className=\"text-xs text-muted-foreground\">Structure & hierarchy</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-10 h-10 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 flex items-center justify-center mx-auto mb-2\">\n                <Palette className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\n              </div>\n              <p className=\"text-sm font-medium\">Color Psychology</p>\n              <p className=\"text-xs text-muted-foreground\">Mood & emotion</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"w-10 h-10 rounded-xl bg-green-500/10 dark:bg-green-500/20 flex items-center justify-center mx-auto mb-2\">\n                <Target className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n              </div>\n              <p className=\"text-sm font-medium\">Hook Patterns</p>\n              <p className=\"text-xs text-muted-foreground\">Persuasion tactics</p>\n            </div>\n          </div>\n\n          {/* Hidden File Input */}\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/jpeg,image/png,image/webp,image/gif\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n        </motion.div>\n\n        {/* Metadata Form Dialog */}\n        <MetadataFormDialog\n          showMetadataForm={showMetadataForm}\n          setShowMetadataForm={setShowMetadataForm}\n          previewUrl={previewUrl}\n          metadata={metadata}\n          setMetadata={setMetadata}\n          handleSubmit={handleSubmit}\n          handleCancel={handleCancel}\n        />\n      </>\n    );\n  }\n\n  // ============================================\n  // Compact Mode Render\n  // ============================================\n\n  return (\n    <>\n      <motion.div\n        initial={false}\n        animate={{\n          scale: isDragging ? 1.02 : 1,\n          borderColor: isDragging ? \"hsl(var(--primary))\" : \"hsl(var(--border))\",\n        }}\n        transition={{ duration: shouldReduceMotion ? 0 : 0.15 }}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onClick={handleUploadClick}\n        className={cn(\n          \"relative cursor-pointer rounded-2xl border-2 border-dashed p-8 transition-colors\",\n          \"bg-gradient-to-br from-background via-background to-muted/30\",\n          \"hover:border-primary/50 hover:bg-muted/20\",\n          isDragging && \"border-primary bg-primary/5 ring-4 ring-primary/20\"\n        )}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/jpeg,image/png,image/webp,image/gif\"\n          onChange={handleFileSelect}\n          className=\"hidden\"\n        />\n\n        <div className=\"flex flex-col items-center gap-4 text-center\">\n          {/* Animated Icon */}\n          <motion.div\n            animate={{\n              y: isDragging ? -8 : 0,\n              scale: isDragging ? 1.1 : 1,\n            }}\n            transition={{ duration: shouldReduceMotion ? 0 : 0.2, type: \"spring\" }}\n            className={cn(\n              \"w-16 h-16 rounded-2xl flex items-center justify-center\",\n              \"bg-gradient-to-br from-primary/20 to-primary/10 border border-primary/30\"\n            )}\n          >\n            <Upload className={cn(\n              \"w-8 h-8 transition-colors\",\n              isDragging ? \"text-primary\" : \"text-primary/70\"\n            )} />\n          </motion.div>\n\n          <div>\n            <h3 className=\"text-lg font-semibold mb-1\">\n              {isDragging ? \"Drop your ad here\" : \"Upload a winning ad\"}\n            </h3>\n            <p className=\"text-sm text-muted-foreground\">\n              Drag & drop or click to select  JPG, PNG, WebP, GIF  Max 5MB\n            </p>\n          </div>\n\n          {/* Privacy Notice - Trust Builder Pattern */}\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground bg-muted/50 px-4 py-2 rounded-full\">\n            <Shield className=\"w-3.5 h-3.5 text-green-600 dark:text-green-400\" />\n            <span>AI extracts patterns only  No content stored</span>\n          </div>\n        </div>\n\n        {/* Upload Progress Overlay */}\n        <AnimatePresence>\n          {isUploading && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"absolute inset-0 bg-background/95 backdrop-blur-sm rounded-2xl flex flex-col items-center justify-center gap-4\"\n            >\n              <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n              <div className=\"text-center\">\n                <p className=\"font-medium\">Analyzing patterns...</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {getUploadStatusMessage()}\n                </p>\n              </div>\n              <Progress value={uploadProgress} className=\"w-48\" />\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        {/* Error State */}\n        <AnimatePresence>\n          {uploadError && !isUploading && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"absolute inset-0 bg-destructive/10 backdrop-blur-sm rounded-2xl flex flex-col items-center justify-center gap-4 border-2 border-destructive\"\n            >\n              <div className=\"text-center max-w-sm px-4\">\n                <p className=\"font-medium text-destructive mb-2\">Upload Failed</p>\n                <p className=\"text-sm text-muted-foreground\">{uploadError}</p>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleUploadClick();\n                  }}\n                  className=\"mt-4\"\n                >\n                  Try Again\n                </Button>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n\n      {/* Metadata Form Dialog */}\n      <MetadataFormDialog\n        showMetadataForm={showMetadataForm}\n        setShowMetadataForm={setShowMetadataForm}\n        previewUrl={previewUrl}\n        metadata={metadata}\n        setMetadata={setMetadata}\n        handleSubmit={handleSubmit}\n        handleCancel={handleCancel}\n      />\n    </>\n  );\n}\n\n// ============================================\n// Metadata Form Dialog Component\n// ============================================\n\ninterface MetadataFormDialogProps {\n  showMetadataForm: boolean;\n  setShowMetadataForm: (show: boolean) => void;\n  previewUrl: string | null;\n  metadata: UploadMetadata;\n  setMetadata: React.Dispatch<React.SetStateAction<UploadMetadata>>;\n  handleSubmit: () => void;\n  handleCancel: () => void;\n}\n\nfunction MetadataFormDialog({\n  showMetadataForm,\n  setShowMetadataForm,\n  previewUrl,\n  metadata,\n  setMetadata,\n  handleSubmit,\n  handleCancel,\n}: MetadataFormDialogProps) {\n  return (\n    <Dialog open={showMetadataForm} onOpenChange={setShowMetadataForm}>\n      <DialogContent className=\"sm:max-w-lg\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Brain className=\"w-5 h-5 text-primary\" />\n            Describe Your Winning Ad\n          </DialogTitle>\n          <DialogDescription>\n            Help our AI understand the context for better pattern extraction\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-6 py-4\">\n          {/* Preview */}\n          {previewUrl && (\n            <div className=\"relative aspect-video rounded-xl overflow-hidden bg-muted\">\n              <img\n                src={previewUrl}\n                alt=\"Preview\"\n                className=\"w-full h-full object-contain\"\n              />\n            </div>\n          )}\n\n          {/* Form Fields */}\n          <div className=\"grid gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Pattern Name *</label>\n              <Input\n                value={metadata.name}\n                onChange={(e) => setMetadata(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"e.g., High-Converting Product Hero\"\n                maxLength={100}\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Category *</label>\n                <Select\n                  value={metadata.category}\n                  onValueChange={(v) => setMetadata(prev => ({ ...prev, category: v }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PATTERN_CATEGORIES.map((cat) => (\n                      <SelectItem key={cat.value} value={cat.value}>\n                        <div className=\"flex items-center gap-2\">\n                          <cat.icon className=\"w-4 h-4\" />\n                          {cat.label}\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Platform *</label>\n                <Select\n                  value={metadata.platform}\n                  onValueChange={(v) => setMetadata(prev => ({ ...prev, platform: v }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {PLATFORMS.map((plat) => (\n                      <SelectItem key={plat.value} value={plat.value}>\n                        {plat.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Industry</label>\n                <Input\n                  value={metadata.industry || \"\"}\n                  onChange={(e) => setMetadata(prev => ({ ...prev, industry: e.target.value }))}\n                  placeholder=\"e.g., SaaS, E-commerce\"\n                  maxLength={100}\n                />\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">\n                  <span className=\"flex items-center gap-1\">\n                    Performance Tier\n                    <Tooltip>\n                      <TooltipTrigger>\n                        <Info className=\"w-3.5 h-3.5 text-muted-foreground\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        How well did this ad perform compared to others?\n                      </TooltipContent>\n                    </Tooltip>\n                  </span>\n                </label>\n                <Select\n                  value={metadata.engagementTier || \"unverified\"}\n                  onValueChange={(v) => setMetadata(prev => ({ ...prev, engagementTier: v }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {ENGAGEMENT_TIERS.map((tier) => (\n                      <SelectItem key={tier.value} value={tier.value}>\n                        <span className={tier.color}>{tier.label}</span>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleCancel}>\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} disabled={!metadata.name}>\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            Extract Patterns\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\AddProductModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\AddTemplateModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\BeforeAfterBuilder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":186,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":186,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":212,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":212,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":282,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":282,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * BeforeAfterBuilder Component\n *\n * A 2-image comparison builder for transformation content.\n * Generates \"before\" and \"after\" images with proper copy.\n *\n * 2026 Best Practices (Research-based):\n * - Raw Content Revolution: Authenticity over perfection\n * - Real transformation stories outperform staged shots\n * - User-generated content style performs better than professional\n * - Side-by-side format works well on both Instagram and LinkedIn\n * - Include specific metrics in the transformation story\n */\n\nimport { useState, useCallback } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  ArrowRight,\n  Download,\n  ImageIcon,\n  Loader2,\n  Sparkles,\n  X,\n  AlertCircle,\n  CheckCircle2,\n  ArrowLeftRight,\n  Lightbulb,\n} from \"lucide-react\";\n\ninterface BeforeAfterBuilderProps {\n  templateId: string;\n  topic: string;\n  platform: string;\n  productNames?: string[];\n  productImageUrls?: string[];\n  aspectRatio?: string;\n  onClose: () => void;\n  onComplete?: (result: BeforeAfterResult) => void;\n}\n\ninterface BeforeAfterResult {\n  beforeImage: string;\n  afterImage: string;\n  beforeLabel: string;\n  afterLabel: string;\n  caption: string;\n  hashtags: string[];\n}\n\ninterface ImageState {\n  url: string | null;\n  label: string;\n  prompt: string;\n  isGenerating: boolean;\n  error: string | null;\n}\n\n// 2026 Best Practices Tips\nconst TRANSFORMATION_TIPS = [\n  \"Show real results, not staged perfection - authenticity wins in 2026\",\n  \"Include specific metrics: 'Before: 2 hours | After: 20 minutes'\",\n  \"Use consistent lighting/angle for honest comparison\",\n  \"Raw, unpolished photos outperform professional shots on Instagram\",\n  \"Tell the story behind the transformation in your caption\",\n  \"Focus on the problem solved, not just the visual change\",\n];\n\nexport function BeforeAfterBuilder({\n  templateId: _templateId,\n  topic,\n  platform,\n  productNames = [],\n  productImageUrls: _productImageUrls = [],\n  aspectRatio = \"1080x1080\",\n  onClose,\n  onComplete,\n}: BeforeAfterBuilderProps) {\n  // Image states\n  const [beforeImage, setBeforeImage] = useState<ImageState>({\n    url: null,\n    label: \"Before\",\n    prompt: \"\",\n    isGenerating: false,\n    error: null,\n  });\n\n  const [afterImage, setAfterImage] = useState<ImageState>({\n    url: null,\n    label: \"After\",\n    prompt: \"\",\n    isGenerating: false,\n    error: null,\n  });\n\n  // Caption state\n  const [caption, setCaption] = useState(\"\");\n  const [hashtags, setHashtags] = useState<string[]>([]);\n  const [isGeneratingCopy, setIsGeneratingCopy] = useState(false);\n\n  // View mode\n  const [viewMode, setViewMode] = useState<\"edit\" | \"preview\">(\"edit\");\n\n  // Generate transformation context\n  const generateContextMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/copywriting/standalone\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({\n          platform,\n          tone: \"authentic\",\n          framework: \"bab\", // Before-After-Bridge works great for transformations\n          campaignObjective: \"engagement\",\n          productName: productNames[0] || topic,\n          productDescription: `Transformation story about: ${topic}`,\n          industry: \"general\",\n          variations: 1,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to generate copy\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.variations?.[0]) {\n        setCaption(data.variations[0].copy || \"\");\n        setHashtags(data.variations[0].hashtags || []);\n      }\n    },\n  });\n\n  // Generate image mutation\n  const generateImageMutation = useMutation({\n    mutationFn: async ({\n      prompt,\n      type,\n    }: {\n      prompt: string;\n      type: \"before\" | \"after\";\n    }) => {\n      const response = await fetch(\"/api/transform\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          prompt: `${type === \"before\" ? \"BEFORE state: \" : \"AFTER state: \"}${prompt}. Professional photography, clear comparison shot, consistent lighting.`,\n          resolution: \"2K\",\n          mode: \"standard\",\n          aspectRatio,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to generate image\");\n      return response.json();\n    },\n  });\n\n  // Generate before image\n  const generateBeforeImage = useCallback(async () => {\n    if (!beforeImage.prompt.trim()) return;\n\n    setBeforeImage((prev) => ({ ...prev, isGenerating: true, error: null }));\n\n    try {\n      const result = await generateImageMutation.mutateAsync({\n        prompt: beforeImage.prompt,\n        type: \"before\",\n      });\n\n      setBeforeImage((prev) => ({\n        ...prev,\n        url: result.imageUrl || result.url,\n        isGenerating: false,\n      }));\n    } catch (_error) {\n      setBeforeImage((prev) => ({\n        ...prev,\n        isGenerating: false,\n        error: \"Failed to generate image\",\n      }));\n    }\n  }, [beforeImage.prompt, generateImageMutation]);\n\n  // Generate after image\n  const generateAfterImage = useCallback(async () => {\n    if (!afterImage.prompt.trim()) return;\n\n    setAfterImage((prev) => ({ ...prev, isGenerating: true, error: null }));\n\n    try {\n      const result = await generateImageMutation.mutateAsync({\n        prompt: afterImage.prompt,\n        type: \"after\",\n      });\n\n      setAfterImage((prev) => ({\n        ...prev,\n        url: result.imageUrl || result.url,\n        isGenerating: false,\n      }));\n    } catch (_error) {\n      setAfterImage((prev) => ({\n        ...prev,\n        isGenerating: false,\n        error: \"Failed to generate image\",\n      }));\n    }\n  }, [afterImage.prompt, generateImageMutation]);\n\n  // Generate copy\n  const generateCopy = useCallback(async () => {\n    setIsGeneratingCopy(true);\n    try {\n      await generateContextMutation.mutateAsync();\n    } finally {\n      setIsGeneratingCopy(false);\n    }\n  }, [generateContextMutation]);\n\n  // Download combined image\n  const downloadCombined = useCallback(async () => {\n    if (!beforeImage.url || !afterImage.url) return;\n\n    // Create a canvas to combine both images side by side\n    const canvas = document.createElement(\"canvas\");\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    // Load both images\n    const loadImage = (url: string): Promise<HTMLImageElement> =>\n      new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = \"anonymous\";\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.src = url;\n      });\n\n    try {\n      const [beforeImg, afterImg] = await Promise.all([\n        loadImage(beforeImage.url),\n        loadImage(afterImage.url),\n      ]);\n\n      // Set canvas size (side by side)\n      const width = beforeImg.width + afterImg.width + 20; // 20px gap\n      const height = Math.max(beforeImg.height, afterImg.height);\n      canvas.width = width;\n      canvas.height = height;\n\n      // White background\n      ctx.fillStyle = \"#ffffff\";\n      ctx.fillRect(0, 0, width, height);\n\n      // Draw images\n      ctx.drawImage(beforeImg, 0, 0);\n      ctx.drawImage(afterImg, beforeImg.width + 20, 0);\n\n      // Add labels\n      ctx.font = \"bold 48px Arial\";\n      ctx.fillStyle = \"#000000\";\n      ctx.textAlign = \"center\";\n      ctx.fillText(beforeImage.label, beforeImg.width / 2, 60);\n      ctx.fillText(afterImage.label, beforeImg.width + 20 + afterImg.width / 2, 60);\n\n      // Download\n      const link = document.createElement(\"a\");\n      link.download = `before-after-${Date.now()}.png`;\n      link.href = canvas.toDataURL(\"image/png\");\n      link.click();\n    } catch (_error) {\n      console.error(\"Failed to download combined image:\", error);\n    }\n  }, [beforeImage, afterImage]);\n\n  // Complete and return result\n  const handleComplete = useCallback(() => {\n    if (!beforeImage.url || !afterImage.url) return;\n\n    const result: BeforeAfterResult = {\n      beforeImage: beforeImage.url,\n      afterImage: afterImage.url,\n      beforeLabel: beforeImage.label,\n      afterLabel: afterImage.label,\n      caption,\n      hashtags,\n    };\n\n    onComplete?.(result);\n    onClose();\n  }, [beforeImage, afterImage, caption, hashtags, onComplete, onClose]);\n\n  const canComplete = beforeImage.url && afterImage.url;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <CardHeader className=\"flex flex-row items-center justify-between py-4 px-6 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <ArrowLeftRight className=\"w-5 h-5 text-primary\" />\n            <div>\n              <CardTitle className=\"text-lg\">Before/After Builder</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Create transformation content for {platform}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant={viewMode === \"edit\" ? \"default\" : \"outline\"}>\n              {viewMode === \"edit\" ? \"Edit Mode\" : \"Preview Mode\"}\n            </Badge>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardHeader>\n\n        <div className=\"flex-1 overflow-hidden flex\">\n          {/* Main Content Area */}\n          <div className=\"flex-1 overflow-auto p-6\">\n            {viewMode === \"edit\" ? (\n              <div className=\"space-y-6\">\n                {/* 2026 Tips */}\n                <div className=\"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <Lightbulb className=\"w-5 h-5 text-amber-600 mt-0.5\" />\n                    <div>\n                      <h4 className=\"font-medium text-amber-900 dark:text-amber-100 mb-2\">\n                        2026 Transformation Content Tips\n                      </h4>\n                      <ul className=\"text-sm text-amber-800 dark:text-amber-200 space-y-1\">\n                        {TRANSFORMATION_TIPS.slice(0, 3).map((tip, i) => (\n                          <li key={i} className=\"flex items-start gap-2\">\n                            <span className=\"text-amber-600\"></span>\n                            {tip}\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Image Panels */}\n                <div className=\"grid grid-cols-2 gap-6\">\n                  {/* Before Panel */}\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h3 className=\"font-semibold text-lg\">Before</h3>\n                      <Input\n                        value={beforeImage.label}\n                        onChange={(e) =>\n                          setBeforeImage((prev) => ({\n                            ...prev,\n                            label: e.target.value,\n                          }))\n                        }\n                        className=\"w-32 text-sm\"\n                        placeholder=\"Label...\"\n                      />\n                    </div>\n\n                    <Textarea\n                      value={beforeImage.prompt}\n                      onChange={(e) =>\n                        setBeforeImage((prev) => ({\n                          ...prev,\n                          prompt: e.target.value,\n                        }))\n                      }\n                      placeholder=\"Describe the 'before' state... (e.g., 'Messy, disorganized warehouse with boxes scattered everywhere')\"\n                      rows={3}\n                    />\n\n                    <Button\n                      onClick={generateBeforeImage}\n                      disabled={!beforeImage.prompt.trim() || beforeImage.isGenerating}\n                      className=\"w-full\"\n                    >\n                      {beforeImage.isGenerating ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Generating...\n                        </>\n                      ) : (\n                        <>\n                          <Sparkles className=\"w-4 h-4 mr-2\" />\n                          Generate Before Image\n                        </>\n                      )}\n                    </Button>\n\n                    {/* Before Image Preview */}\n                    <div className=\"aspect-square bg-muted rounded-lg overflow-hidden flex items-center justify-center\">\n                      {beforeImage.url ? (\n                        <img\n                          src={beforeImage.url}\n                          alt=\"Before\"\n                          className=\"w-full h-full object-cover\"\n                        />\n                      ) : beforeImage.error ? (\n                        <div className=\"text-center text-destructive p-4\">\n                          <AlertCircle className=\"w-8 h-8 mx-auto mb-2\" />\n                          <p className=\"text-sm\">{beforeImage.error}</p>\n                        </div>\n                      ) : (\n                        <div className=\"text-center text-muted-foreground p-4\">\n                          <ImageIcon className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                          <p className=\"text-sm\">Generate or upload a \"before\" image</p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* After Panel */}\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <h3 className=\"font-semibold text-lg\">After</h3>\n                      <Input\n                        value={afterImage.label}\n                        onChange={(e) =>\n                          setAfterImage((prev) => ({\n                            ...prev,\n                            label: e.target.value,\n                          }))\n                        }\n                        className=\"w-32 text-sm\"\n                        placeholder=\"Label...\"\n                      />\n                    </div>\n\n                    <Textarea\n                      value={afterImage.prompt}\n                      onChange={(e) =>\n                        setAfterImage((prev) => ({\n                          ...prev,\n                          prompt: e.target.value,\n                        }))\n                      }\n                      placeholder=\"Describe the 'after' state... (e.g., 'Clean, organized warehouse with labeled shelving systems')\"\n                      rows={3}\n                    />\n\n                    <Button\n                      onClick={generateAfterImage}\n                      disabled={!afterImage.prompt.trim() || afterImage.isGenerating}\n                      className=\"w-full\"\n                    >\n                      {afterImage.isGenerating ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Generating...\n                        </>\n                      ) : (\n                        <>\n                          <Sparkles className=\"w-4 h-4 mr-2\" />\n                          Generate After Image\n                        </>\n                      )}\n                    </Button>\n\n                    {/* After Image Preview */}\n                    <div className=\"aspect-square bg-muted rounded-lg overflow-hidden flex items-center justify-center\">\n                      {afterImage.url ? (\n                        <img\n                          src={afterImage.url}\n                          alt=\"After\"\n                          className=\"w-full h-full object-cover\"\n                        />\n                      ) : afterImage.error ? (\n                        <div className=\"text-center text-destructive p-4\">\n                          <AlertCircle className=\"w-8 h-8 mx-auto mb-2\" />\n                          <p className=\"text-sm\">{afterImage.error}</p>\n                        </div>\n                      ) : (\n                        <div className=\"text-center text-muted-foreground p-4\">\n                          <ImageIcon className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                          <p className=\"text-sm\">Generate or upload an \"after\" image</p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Caption Section */}\n                <div className=\"space-y-4 pt-4 border-t\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"font-semibold\">Caption</h3>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={generateCopy}\n                      disabled={isGeneratingCopy}\n                    >\n                      {isGeneratingCopy ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Generating...\n                        </>\n                      ) : (\n                        <>\n                          <Sparkles className=\"w-4 h-4 mr-2\" />\n                          Generate Caption\n                        </>\n                      )}\n                    </Button>\n                  </div>\n\n                  <Textarea\n                    value={caption}\n                    onChange={(e) => setCaption(e.target.value)}\n                    placeholder=\"Write a caption that tells the transformation story...\"\n                    rows={4}\n                  />\n\n                  {hashtags.length > 0 && (\n                    <div className=\"flex flex-wrap gap-2\">\n                      {hashtags.map((tag, i) => (\n                        <Badge key={i} variant=\"secondary\">\n                          #{tag}\n                        </Badge>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : (\n              /* Preview Mode */\n              <div className=\"flex flex-col items-center justify-center h-full\">\n                <div className=\"bg-white rounded-lg shadow-lg p-4 max-w-2xl\">\n                  {/* Side by side preview */}\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      {beforeImage.url ? (\n                        <img\n                          src={beforeImage.url}\n                          alt=\"Before\"\n                          className=\"w-full rounded\"\n                        />\n                      ) : (\n                        <div className=\"aspect-square bg-gray-100 rounded flex items-center justify-center\">\n                          <span className=\"text-gray-400\">Before</span>\n                        </div>\n                      )}\n                      <div className=\"absolute bottom-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-sm\">\n                        {beforeImage.label}\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center\">\n                      <ArrowRight className=\"w-6 h-6 text-muted-foreground\" />\n                    </div>\n\n                    <div className=\"relative flex-1\">\n                      {afterImage.url ? (\n                        <img\n                          src={afterImage.url}\n                          alt=\"After\"\n                          className=\"w-full rounded\"\n                        />\n                      ) : (\n                        <div className=\"aspect-square bg-gray-100 rounded flex items-center justify-center\">\n                          <span className=\"text-gray-400\">After</span>\n                        </div>\n                      )}\n                      <div className=\"absolute bottom-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-sm\">\n                        {afterImage.label}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Caption preview */}\n                  {caption && (\n                    <div className=\"mt-4 text-sm\">\n                      <p className=\"whitespace-pre-wrap\">{caption}</p>\n                      {hashtags.length > 0 && (\n                        <p className=\"text-blue-600 mt-2\">\n                          {hashtags.map((t) => `#${t}`).join(\" \")}\n                        </p>\n                      )}\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"border-t p-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setViewMode(viewMode === \"edit\" ? \"preview\" : \"edit\")}\n            >\n              {viewMode === \"edit\" ? \"Preview\" : \"Edit\"}\n            </Button>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    onClick={downloadCombined}\n                    disabled={!canComplete}\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Download Combined\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  Download side-by-side comparison image\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n\n            <Button onClick={handleComplete} disabled={!canComplete}>\n              <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n              Complete\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n\nexport type { BeforeAfterBuilderProps, BeforeAfterResult };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\BrandProfileDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\BrandProfileForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\CarouselBuilder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":195,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":195,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":225,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":225,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_error' is defined but never used.","line":242,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":242,"endColumn":22},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generateOutlineMutation'. Either include it or remove the dependency array.","line":269,"column":6,"nodeType":"ArrayExpression","endLine":269,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [generateOutlineMutation, templateId, topic]","fix":{"range":[8455,8474],"text":"[generateOutlineMutation, templateId, topic]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * CarouselBuilder Component\n *\n * A comprehensive multi-slide carousel creation tool that:\n * 1. Displays and allows editing of slide content (headline, body, image prompt)\n * 2. Generates images for each slide using the existing /api/transform endpoint\n * 3. Shows carousel preview using embla-carousel\n * 4. Provides bulk download as ZIP and individual slide download\n *\n * 2026 Best Practices Implemented:\n * - 7 slides is optimal (sweet spot, 5-10 range)\n * - First slide is critical (80% of engagement)\n * - One idea per slide\n * - Mobile-first design with large, readable text\n */\n\nimport { useState, useEffect } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport JSZip from \"jszip\";\nimport { saveAs } from \"file-saver\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n} from \"@/components/ui/carousel\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Layers,\n  ChevronDown,\n  Loader2,\n  Sparkles,\n  ImageIcon,\n  Download,\n  Archive,\n  Check,\n  AlertTriangle,\n  Pencil,\n  Eye,\n  RefreshCw,\n  X,\n  Copy,\n  Zap,\n  Target,\n} from \"lucide-react\";\n\n// Types for carousel data\ninterface CarouselSlide {\n  slideNumber: number;\n  purpose: 'hook' | 'problem' | 'point' | 'solution' | 'proof' | 'cta';\n  headline: string;\n  body: string;\n  imagePrompt: string;\n  imageUrl?: string;\n  isGenerating?: boolean;\n  error?: string;\n}\n\ninterface CarouselOutline {\n  title: string;\n  description: string;\n  slideCount: number;\n  slides: CarouselSlide[];\n  captionCopy: string;\n  hashtags: string[];\n}\n\ninterface CarouselBuilderProps {\n  templateId: string;\n  topic: string;\n  platform: string;\n  productNames?: string[];\n  productImageUrls?: string[];\n  aspectRatio?: string;\n  onClose: () => void;\n  onComplete?: (outline: CarouselOutline) => void;\n}\n\n// Purpose labels and colors\nconst purposeConfig: Record<string, { label: string; color: string; icon: React.ElementType }> = {\n  hook: { label: 'Hook', color: 'bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20', icon: Zap },\n  problem: { label: 'Problem', color: 'bg-orange-500/10 text-orange-600 dark:text-orange-400 border-orange-500/20', icon: AlertTriangle },\n  point: { label: 'Point', color: 'bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/20', icon: Target },\n  solution: { label: 'Solution', color: 'bg-green-500/10 text-green-600 dark:text-green-400 border-green-500/20', icon: Check },\n  proof: { label: 'Proof', color: 'bg-purple-500/10 text-purple-600 dark:text-purple-400 border-purple-500/20', icon: Eye },\n  cta: { label: 'CTA', color: 'bg-pink-500/10 text-pink-600 dark:text-pink-400 border-pink-500/20', icon: Sparkles },\n};\n\nexport function CarouselBuilder({\n  templateId,\n  topic,\n  platform,\n  productNames = [],\n  productImageUrls = [],\n  aspectRatio = '1080x1350',\n  onClose,\n  onComplete: _onComplete,\n}: CarouselBuilderProps) {\n  const [outline, setOutline] = useState<CarouselOutline | null>(null);\n  const [slides, setSlides] = useState<CarouselSlide[]>([]);\n  const [activeSlide, setActiveSlide] = useState(0);\n  const [isPreviewMode, setIsPreviewMode] = useState(false);\n  const [copiedCaption, setCopiedCaption] = useState(false);\n\n  // Generate carousel outline\n  const generateOutlineMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/content-planner/carousel-outline', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          templateId,\n          topic,\n          slideCount: 7, // 2026 sweet spot\n          platform,\n          productNames,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate carousel outline');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setOutline(data.outline);\n      setSlides(data.outline.slides.map((s: CarouselSlide) => ({ ...s, imageUrl: undefined, isGenerating: false })));\n    },\n  });\n\n  // Generate image for a specific slide\n  const generateSlideImage = async (slideIndex: number) => {\n    const slide = slides[slideIndex];\n    if (!slide) return;\n\n    // Update slide to show generating state\n    setSlides(prev => prev.map((s, i) =>\n      i === slideIndex ? { ...s, isGenerating: true, error: undefined } : s\n    ));\n\n    try {\n      // Build prompt for image generation\n      const imagePrompt = `${slide.imagePrompt}.\n        Slide ${slideIndex + 1} of carousel about \"${topic}\".\n        Purpose: ${slide.purpose}.\n        Headline: \"${slide.headline}\".\n        Design: Clean, professional, minimal text overlay ready.\n        Aspect ratio: Portrait (4:5) for Instagram/LinkedIn carousel.`;\n\n      const response = await fetch('/api/transform', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          prompt: imagePrompt,\n          resolution: '2K',\n          aspectRatio,\n          mode: productImageUrls.length > 0 ? 'inspiration' : 'standard',\n          productImageUrls: productImageUrls.slice(0, 2), // Use first 2 product images if available\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to generate image');\n      }\n\n      const data = await response.json();\n      const imageUrl = data.imageUrl || data.url;\n\n      // Update slide with generated image\n      setSlides(prev => prev.map((s, i) =>\n        i === slideIndex ? { ...s, isGenerating: false, imageUrl } : s\n      ));\n    } catch (_error) {\n      setSlides(prev => prev.map((s, i) =>\n        i === slideIndex ? { ...s, isGenerating: false, error: 'Failed to generate image' } : s\n      ));\n    }\n  };\n\n  // Generate all slide images\n  const generateAllImages = async () => {\n    for (let i = 0; i < slides.length; i++) {\n      await generateSlideImage(i);\n    }\n  };\n\n  // Update slide content\n  const updateSlide = (index: number, field: keyof CarouselSlide, value: string) => {\n    setSlides(prev => prev.map((s, i) =>\n      i === index ? { ...s, [field]: value } : s\n    ));\n  };\n\n  // Download single slide image\n  const downloadSlide = async (slideIndex: number) => {\n    const slide = slides[slideIndex];\n    if (!slide?.imageUrl) return;\n\n    try {\n      const response = await fetch(slide.imageUrl);\n      const blob = await response.blob();\n      saveAs(blob, `slide-${slideIndex + 1}-${slide.purpose}.png`);\n    } catch (_error) {\n      console.error('Failed to download slide:', error);\n    }\n  };\n\n  // Download all slides as ZIP\n  const downloadAllAsZip = async () => {\n    const zip = new JSZip();\n    const slidesWithImages = slides.filter(s => s.imageUrl);\n\n    if (slidesWithImages.length === 0) return;\n\n    for (const slide of slidesWithImages) {\n      try {\n        const response = await fetch(slide.imageUrl!);\n        const blob = await response.blob();\n        zip.file(`slide-${slide.slideNumber}-${slide.purpose}.png`, blob);\n      } catch (_error) {\n        console.error(`Failed to add slide ${slide.slideNumber} to ZIP:`, error);\n      }\n    }\n\n    // Add caption as text file\n    if (outline?.captionCopy) {\n      const captionText = `${outline.captionCopy}\\n\\n${outline.hashtags.map(h => `#${h}`).join(' ')}`;\n      zip.file('caption.txt', captionText);\n    }\n\n    const zipBlob = await zip.generateAsync({ type: 'blob' });\n    saveAs(zipBlob, `carousel-${topic.slice(0, 30).replace(/\\s+/g, '-')}.zip`);\n  };\n\n  // Copy caption to clipboard\n  const copyCaption = () => {\n    if (!outline) return;\n    const fullCaption = `${outline.captionCopy}\\n\\n${outline.hashtags.map(h => `#${h}`).join(' ')}`;\n    navigator.clipboard.writeText(fullCaption);\n    setCopiedCaption(true);\n    setTimeout(() => setCopiedCaption(false), 2000);\n  };\n\n  // Initial outline generation\n  useEffect(() => {\n    generateOutlineMutation.mutate();\n  }, [templateId, topic]);\n\n  // Count slides with images\n  const slidesWithImagesCount = slides.filter(s => s.imageUrl).length;\n  const allSlidesGenerated = slidesWithImagesCount === slides.length && slides.length > 0;\n\n  // Loading state\n  if (generateOutlineMutation.isPending) {\n    return (\n      <Card className=\"w-full max-w-4xl mx-auto\">\n        <CardContent className=\"flex flex-col items-center justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary mb-4\" />\n          <p className=\"text-sm text-muted-foreground\">Generating carousel outline...</p>\n          <p className=\"text-xs text-muted-foreground mt-2\">Using 2026 best practices (7 slides optimal)</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  // Error state\n  if (generateOutlineMutation.isError) {\n    return (\n      <Card className=\"w-full max-w-4xl mx-auto\">\n        <CardContent className=\"flex flex-col items-center justify-center py-12\">\n          <AlertTriangle className=\"w-8 h-8 text-destructive mb-4\" />\n          <p className=\"text-sm text-destructive\">Failed to generate carousel outline</p>\n          <Button\n            variant=\"outline\"\n            className=\"mt-4\"\n            onClick={() => generateOutlineMutation.mutate()}\n          >\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\n            Try Again\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!outline) return null;\n\n  return (\n    <Card className=\"w-full max-w-5xl mx-auto\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"space-y-1\">\n            <div className=\"flex items-center gap-2\">\n              <Layers className=\"w-5 h-5 text-primary\" />\n              <span className=\"text-xs font-medium text-primary uppercase tracking-wide\">\n                Carousel Builder\n              </span>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {slides.length} slides\n              </Badge>\n              {slidesWithImagesCount > 0 && (\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {slidesWithImagesCount}/{slides.length} images\n                </Badge>\n              )}\n            </div>\n            <CardTitle className=\"text-lg\">{outline.title}</CardTitle>\n            <p className=\"text-sm text-muted-foreground\">{outline.description}</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={onClose}\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n\n        {/* Platform and action buttons */}\n        <div className=\"flex flex-wrap items-center gap-2 mt-3\">\n          <Badge variant=\"outline\" className=\"capitalize\">{platform}</Badge>\n          <Badge variant=\"outline\">{aspectRatio}</Badge>\n          <div className=\"flex-1\" />\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setIsPreviewMode(!isPreviewMode)}\n          >\n            {isPreviewMode ? (\n              <>\n                <Pencil className=\"w-4 h-4 mr-1\" />\n                Edit Mode\n              </>\n            ) : (\n              <>\n                <Eye className=\"w-4 h-4 mr-1\" />\n                Preview\n              </>\n            )}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={generateAllImages}\n            disabled={slides.some(s => s.isGenerating)}\n          >\n            <ImageIcon className=\"w-4 h-4 mr-1\" />\n            Generate All Images\n          </Button>\n          {allSlidesGenerated && (\n            <Button\n              variant=\"default\"\n              size=\"sm\"\n              onClick={downloadAllAsZip}\n            >\n              <Archive className=\"w-4 h-4 mr-1\" />\n              Download ZIP\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-6\">\n        {/* Preview Mode - Carousel View */}\n        {isPreviewMode && (\n          <div className=\"px-12\">\n            <Carousel className=\"w-full max-w-lg mx-auto\">\n              <CarouselContent>\n                {slides.map((slide, index) => (\n                  <CarouselItem key={index}>\n                    <div className=\"p-1\">\n                      <Card className=\"overflow-hidden\">\n                        <CardContent className=\"p-0 aspect-[4/5] relative\">\n                          {slide.imageUrl ? (\n                            <img\n                              src={slide.imageUrl}\n                              alt={`Slide ${index + 1}`}\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : (\n                            <div className=\"w-full h-full flex flex-col items-center justify-center bg-muted\">\n                              {slide.isGenerating ? (\n                                <>\n                                  <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground mb-2\" />\n                                  <p className=\"text-xs text-muted-foreground\">Generating...</p>\n                                </>\n                              ) : (\n                                <>\n                                  <ImageIcon className=\"w-8 h-8 text-muted-foreground mb-2\" />\n                                  <p className=\"text-xs text-muted-foreground\">No image yet</p>\n                                  <Button\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    className=\"mt-2\"\n                                    onClick={() => generateSlideImage(index)}\n                                  >\n                                    Generate\n                                  </Button>\n                                </>\n                              )}\n                            </div>\n                          )}\n                          {/* Overlay with headline */}\n                          <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4\">\n                            <p className=\"text-white font-bold text-lg\">{slide.headline}</p>\n                            <p className=\"text-white/80 text-sm mt-1\">{slide.body}</p>\n                          </div>\n                          {/* Slide number badge */}\n                          <div className=\"absolute top-3 left-3\">\n                            <Badge className={cn(\"text-xs\", purposeConfig[slide.purpose]?.color)}>\n                              {index + 1}. {purposeConfig[slide.purpose]?.label}\n                            </Badge>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    </div>\n                  </CarouselItem>\n                ))}\n              </CarouselContent>\n              <CarouselPrevious />\n              <CarouselNext />\n            </Carousel>\n            <p className=\"text-center text-xs text-muted-foreground mt-4\">\n              Swipe or use arrows to preview all {slides.length} slides\n            </p>\n          </div>\n        )}\n\n        {/* Edit Mode - Slide Editor */}\n        {!isPreviewMode && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Slide Thumbnails */}\n            <div className=\"space-y-3\">\n              <h3 className=\"text-sm font-medium flex items-center gap-2\">\n                <Layers className=\"w-4 h-4\" />\n                Slides ({slides.length})\n              </h3>\n              <ScrollArea className=\"h-[500px] pr-4\">\n                <div className=\"space-y-2\">\n                  {slides.map((slide, index) => {\n                    const config = purposeConfig[slide.purpose] || purposeConfig.point;\n                    const Icon = config.icon;\n\n                    return (\n                      <div\n                        key={index}\n                        className={cn(\n                          \"p-3 rounded-lg border cursor-pointer transition-all\",\n                          activeSlide === index\n                            ? \"border-primary bg-primary/5\"\n                            : \"border-border hover:border-primary/50\"\n                        )}\n                        onClick={() => setActiveSlide(index)}\n                      >\n                        <div className=\"flex items-start gap-3\">\n                          {/* Thumbnail or placeholder */}\n                          <div className=\"w-16 h-20 rounded overflow-hidden flex-shrink-0 bg-muted\">\n                            {slide.imageUrl ? (\n                              <img\n                                src={slide.imageUrl}\n                                alt={`Slide ${index + 1}`}\n                                className=\"w-full h-full object-cover\"\n                              />\n                            ) : slide.isGenerating ? (\n                              <div className=\"w-full h-full flex items-center justify-center\">\n                                <Loader2 className=\"w-4 h-4 animate-spin text-muted-foreground\" />\n                              </div>\n                            ) : (\n                              <div className=\"w-full h-full flex items-center justify-center\">\n                                <ImageIcon className=\"w-4 h-4 text-muted-foreground\" />\n                              </div>\n                            )}\n                          </div>\n\n                          {/* Slide info */}\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <Badge variant=\"outline\" className={cn(\"text-xs\", config.color)}>\n                                <Icon className=\"w-3 h-3 mr-1\" />\n                                {index + 1}. {config.label}\n                              </Badge>\n                            </div>\n                            <p className=\"text-sm font-medium truncate\">{slide.headline}</p>\n                            <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                              {slide.body}\n                            </p>\n                          </div>\n\n                          {/* Status indicators */}\n                          <div className=\"flex flex-col gap-1\">\n                            {slide.imageUrl && (\n                              <TooltipProvider>\n                                <Tooltip>\n                                  <TooltipTrigger asChild>\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"icon\"\n                                      className=\"h-6 w-6\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        downloadSlide(index);\n                                      }}\n                                    >\n                                      <Download className=\"w-3 h-3\" />\n                                    </Button>\n                                  </TooltipTrigger>\n                                  <TooltipContent>Download slide</TooltipContent>\n                                </Tooltip>\n                              </TooltipProvider>\n                            )}\n                            {slide.error && (\n                              <AlertTriangle className=\"w-4 h-4 text-destructive\" />\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </ScrollArea>\n            </div>\n\n            {/* Active Slide Editor */}\n            <div className=\"space-y-4\">\n              <h3 className=\"text-sm font-medium flex items-center gap-2\">\n                <Pencil className=\"w-4 h-4\" />\n                Edit Slide {activeSlide + 1}\n                {slides[activeSlide] && (\n                  <Badge variant=\"outline\" className={cn(\"text-xs ml-2\", purposeConfig[slides[activeSlide].purpose]?.color)}>\n                    {purposeConfig[slides[activeSlide].purpose]?.label}\n                  </Badge>\n                )}\n              </h3>\n\n              {slides[activeSlide] && (\n                <div className=\"space-y-4\">\n                  {/* Headline */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs font-medium\">\n                      Headline <span className=\"text-muted-foreground\">(max 40 chars)</span>\n                    </label>\n                    <Input\n                      value={slides[activeSlide].headline}\n                      onChange={(e) => updateSlide(activeSlide, 'headline', e.target.value)}\n                      maxLength={100}\n                      placeholder=\"Bold, attention-grabbing headline\"\n                    />\n                    <p className=\"text-xs text-muted-foreground text-right\">\n                      {slides[activeSlide].headline.length}/100\n                    </p>\n                  </div>\n\n                  {/* Body */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs font-medium\">\n                      Body <span className=\"text-muted-foreground\">(max 100 chars)</span>\n                    </label>\n                    <Textarea\n                      value={slides[activeSlide].body}\n                      onChange={(e) => updateSlide(activeSlide, 'body', e.target.value)}\n                      maxLength={200}\n                      rows={2}\n                      placeholder=\"Supporting text that explains the headline\"\n                    />\n                    <p className=\"text-xs text-muted-foreground text-right\">\n                      {slides[activeSlide].body.length}/200\n                    </p>\n                  </div>\n\n                  {/* Image Prompt */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs font-medium\">\n                      Image Prompt <span className=\"text-muted-foreground\">(for AI generation)</span>\n                    </label>\n                    <Textarea\n                      value={slides[activeSlide].imagePrompt}\n                      onChange={(e) => updateSlide(activeSlide, 'imagePrompt', e.target.value)}\n                      maxLength={300}\n                      rows={3}\n                      placeholder=\"Describe the visual for this slide\"\n                    />\n                    <p className=\"text-xs text-muted-foreground text-right\">\n                      {slides[activeSlide].imagePrompt.length}/300\n                    </p>\n                  </div>\n\n                  {/* Image Preview/Generate */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-xs font-medium\">Image</label>\n                    <div className=\"aspect-[4/5] max-w-[300px] rounded-lg border overflow-hidden bg-muted\">\n                      {slides[activeSlide].imageUrl ? (\n                        <div className=\"relative w-full h-full\">\n                          <img\n                            src={slides[activeSlide].imageUrl}\n                            alt={`Slide ${activeSlide + 1}`}\n                            className=\"w-full h-full object-cover\"\n                          />\n                          <div className=\"absolute bottom-2 right-2 flex gap-1\">\n                            <TooltipProvider>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"secondary\"\n                                    size=\"icon\"\n                                    className=\"h-8 w-8\"\n                                    onClick={() => generateSlideImage(activeSlide)}\n                                    disabled={slides[activeSlide].isGenerating}\n                                  >\n                                    <RefreshCw className={cn(\"w-4 h-4\", slides[activeSlide].isGenerating && \"animate-spin\")} />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Regenerate image</TooltipContent>\n                              </Tooltip>\n                            </TooltipProvider>\n                            <TooltipProvider>\n                              <Tooltip>\n                                <TooltipTrigger asChild>\n                                  <Button\n                                    variant=\"secondary\"\n                                    size=\"icon\"\n                                    className=\"h-8 w-8\"\n                                    onClick={() => downloadSlide(activeSlide)}\n                                  >\n                                    <Download className=\"w-4 h-4\" />\n                                  </Button>\n                                </TooltipTrigger>\n                                <TooltipContent>Download image</TooltipContent>\n                              </Tooltip>\n                            </TooltipProvider>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"w-full h-full flex flex-col items-center justify-center\">\n                          {slides[activeSlide].isGenerating ? (\n                            <>\n                              <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground mb-2\" />\n                              <p className=\"text-xs text-muted-foreground\">Generating image...</p>\n                            </>\n                          ) : (\n                            <>\n                              <ImageIcon className=\"w-8 h-8 text-muted-foreground mb-2\" />\n                              <p className=\"text-xs text-muted-foreground mb-2\">No image generated yet</p>\n                              <Button\n                                variant=\"default\"\n                                size=\"sm\"\n                                onClick={() => generateSlideImage(activeSlide)}\n                              >\n                                <Sparkles className=\"w-4 h-4 mr-1\" />\n                                Generate Image\n                              </Button>\n                            </>\n                          )}\n                          {slides[activeSlide].error && (\n                            <p className=\"text-xs text-destructive mt-2\">{slides[activeSlide].error}</p>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Caption Section */}\n        <Collapsible defaultOpen={true}>\n          <CollapsibleTrigger asChild>\n            <Button variant=\"ghost\" className=\"w-full justify-between py-2 hover:bg-muted/50\">\n              <span className=\"text-sm font-medium flex items-center gap-2\">\n                <Copy className=\"w-4 h-4\" />\n                Caption & Hashtags\n              </span>\n              <ChevronDown className=\"w-4 h-4\" />\n            </Button>\n          </CollapsibleTrigger>\n          <CollapsibleContent>\n            <div className=\"space-y-3 p-4 bg-muted/30 rounded-lg mt-2\">\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-medium\">Caption</label>\n                <Textarea\n                  value={outline.captionCopy}\n                  readOnly\n                  rows={3}\n                  className=\"bg-background\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-xs font-medium\">Hashtags</label>\n                <div className=\"flex flex-wrap gap-1\">\n                  {outline.hashtags.map((tag, index) => (\n                    <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                      #{tag}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={copyCaption}\n                className=\"w-full\"\n              >\n                {copiedCaption ? (\n                  <>\n                    <Check className=\"w-4 h-4 mr-1\" />\n                    Copied!\n                  </>\n                ) : (\n                  <>\n                    <Copy className=\"w-4 h-4 mr-1\" />\n                    Copy Caption & Hashtags\n                  </>\n                )}\n              </Button>\n            </div>\n          </CollapsibleContent>\n        </Collapsible>\n\n        {/* 2026 Best Practices Tip */}\n        <div className=\"p-3 rounded-lg bg-primary/5 border border-primary/20\">\n          <p className=\"text-xs text-muted-foreground\">\n            <strong className=\"text-primary\">2026 Tip:</strong> Slide 1 is CRITICAL - 80% of engagement comes from the first slide.\n            Make it bold, specific, and scroll-stopping. Educational carousels get 4.7% engagement vs 3.9% for product content.\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ContentPlannerGuidance.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\CopywritingPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\HistoryTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\IdeaBankPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\LinkedInPostPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\PWAUpdatePrompt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ProductCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ProductEnrichmentForm.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEnrichmentStatus'. Either include it or remove the dependency array.","line":142,"column":6,"nodeType":"ArrayExpression","endLine":142,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [fetchEnrichmentStatus, product.id]","fix":{"range":[4088,4100],"text":"[fetchEnrichmentStatus, product.id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5189,5192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5189,5192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6184,6187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6184,6187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7577,7580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7577,7580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":278,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8316,8319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8316,8319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Sparkles,\n  Check,\n  AlertCircle,\n  Eye,\n  Globe,\n  Database,\n  ChevronDown,\n  ChevronUp,\n  Loader2,\n  Package,\n  Tag,\n  FileText,\n  Wrench,\n  List,\n  Link2,\n  ExternalLink,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn, getProductImageUrl } from \"@/lib/utils\";\nimport type { Product } from \"@shared/schema\";\n\ninterface EnrichmentDraft {\n  description: string;\n  features: Record<string, string | string[]>;\n  benefits: string[];\n  specifications: Record<string, string>;\n  tags: string[];\n  installation?: {\n    methods: string[];\n    difficulty: string;\n    requiredAccessories: string[];\n    tips: string[];\n  };\n  relatedProductTypes?: string[];\n  confidence: number;\n  sources: Array<{\n    type: \"vision\" | \"web_search\" | \"kb\" | \"url\";\n    detail: string;\n  }>;\n  generatedAt: string;\n}\n\ninterface EnrichmentStatus {\n  productId: string;\n  status: \"pending\" | \"draft\" | \"verified\" | \"complete\";\n  draft: EnrichmentDraft | null;\n  verifiedAt: string | null;\n  source: string | null;\n  completeness: {\n    percentage: number;\n    missing: string[];\n  };\n  isReady: boolean;\n}\n\ninterface ProductEnrichmentFormProps {\n  product: Product;\n  onComplete?: () => void;\n  className?: string;\n}\n\n// Source badge component\nfunction SourceBadge({ source }: { source: EnrichmentDraft[\"sources\"][0] }) {\n  const iconMap: Record<string, typeof Eye> = {\n    vision: Eye,\n    web_search: Globe,\n    kb: Database,\n    url: Link2,\n  };\n  const Icon = iconMap[source.type] || Globe;\n\n  return (\n    <div className=\"flex items-center gap-1.5 px-2 py-1 bg-muted/50 rounded-full text-xs\">\n      <Icon className=\"w-3 h-3\" />\n      <span className=\"capitalize\">{source.type.replace(\"_\", \" \")}</span>\n    </div>\n  );\n}\n\n// Completeness indicator\nfunction CompletenessIndicator({ completeness }: { completeness: EnrichmentStatus[\"completeness\"] }) {\n  const getColor = (pct: number) => {\n    if (pct >= 75) return \"bg-green-500 dark:bg-green-600\";\n    if (pct >= 50) return \"bg-yellow-500 dark:bg-yellow-600\";\n    return \"bg-red-500 dark:bg-red-600\";\n  };\n\n  return (\n    <div className=\"space-y-1\">\n      <div className=\"flex items-center justify-between text-xs\">\n        <span className=\"text-muted-foreground\">Profile Completeness</span>\n        <span className=\"font-medium\">{completeness.percentage}%</span>\n      </div>\n      <div className=\"h-1.5 bg-muted rounded-full overflow-hidden\">\n        <motion.div\n          className={cn(\"h-full rounded-full\", getColor(completeness.percentage))}\n          initial={{ width: 0 }}\n          animate={{ width: `${completeness.percentage}%` }}\n          transition={{ duration: 0.5 }}\n        />\n      </div>\n      {completeness.missing.length > 0 && (\n        <p className=\"text-xs text-muted-foreground\">\n          Missing: {completeness.missing.join(\", \")}\n        </p>\n      )}\n    </div>\n  );\n}\n\nexport function ProductEnrichmentForm({ product, onComplete, className }: ProductEnrichmentFormProps) {\n  const [enrichmentStatus, setEnrichmentStatus] = useState<EnrichmentStatus | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isFetchingUrl, setIsFetchingUrl] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // URL enrichment state\n  const [productUrl, setProductUrl] = useState(\"\");\n\n  // Editable form state\n  const [formData, setFormData] = useState({\n    description: \"\",\n    features: {} as Record<string, string>,\n    benefits: [] as string[],\n    tags: [] as string[],\n    sku: \"\",\n  });\n  const [newBenefit, setNewBenefit] = useState(\"\");\n  const [newTag, setNewTag] = useState(\"\");\n\n  // Fetch current enrichment status\n  useEffect(() => {\n    fetchEnrichmentStatus();\n  }, [product.id]);\n\n  async function fetchEnrichmentStatus() {\n    setIsLoading(true);\n    setError(null);\n    try {\n      const response = await fetch(`/api/products/${product.id}/enrichment`, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch enrichment status\");\n      const data = await response.json();\n      setEnrichmentStatus(data);\n\n      // Populate form with draft or existing data\n      if (data.draft) {\n        setFormData({\n          description: data.draft.description || \"\",\n          features: flattenFeatures(data.draft.features || {}),\n          benefits: data.draft.benefits || [],\n          tags: data.draft.tags || [],\n          sku: product.sku || \"\",\n        });\n      } else if (product.description) {\n        setFormData({\n          description: product.description || \"\",\n          features: flattenFeatures((product.features as Record<string, unknown>) || {}),\n          benefits: (product.benefits as string[]) || [],\n          tags: (product.tags as string[]) || [],\n          sku: product.sku || \"\",\n        });\n      }\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  }\n\n  // Flatten features object to string values for editing\n  function flattenFeatures(features: Record<string, unknown>): Record<string, string> {\n    const result: Record<string, string> = {};\n    for (const [key, value] of Object.entries(features)) {\n      result[key] = Array.isArray(value) ? value.join(\", \") : String(value || \"\");\n    }\n    return result;\n  }\n\n  // Generate AI draft\n  async function generateDraft() {\n    setIsGenerating(true);\n    setError(null);\n    try {\n      const response = await fetch(`/api/products/${product.id}/enrich`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to generate draft\");\n      }\n      await fetchEnrichmentStatus();\n      setIsExpanded(true);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsGenerating(false);\n    }\n  }\n\n  // Fetch from URL\n  async function fetchFromUrl() {\n    if (!productUrl.trim()) {\n      setError(\"Please enter a product URL\");\n      return;\n    }\n\n    // Validate URL\n    try {\n      new URL(productUrl);\n    } catch {\n      setError(\"Please enter a valid URL\");\n      return;\n    }\n\n    setIsFetchingUrl(true);\n    setError(null);\n    try {\n      const response = await fetch(`/api/products/${product.id}/enrich-from-url`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ productUrl: productUrl.trim() }),\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to fetch from URL\");\n      }\n      const result = await response.json();\n\n      // Update form with fetched data\n      if (result.draft) {\n        setFormData({\n          description: result.draft.description || \"\",\n          features: flattenFeatures(result.draft.features || {}),\n          benefits: result.draft.benefits || [],\n          tags: result.draft.tags || [],\n          sku: product.sku || \"\",\n        });\n      }\n\n      await fetchEnrichmentStatus();\n      setIsExpanded(true);\n      setProductUrl(\"\"); // Clear the input after success\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsFetchingUrl(false);\n    }\n  }\n\n  // Save verified data\n  async function saveEnrichment(approvedAsIs = false) {\n    setIsSaving(true);\n    setError(null);\n    try {\n      const response = await fetch(`/api/products/${product.id}/enrichment/verify`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(approvedAsIs ? { approvedAsIs: true } : formData),\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const data = await response.json();\n        throw new Error(data.error || \"Failed to save enrichment\");\n      }\n      await fetchEnrichmentStatus();\n      onComplete?.();\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsSaving(false);\n    }\n  }\n\n  // Add/remove benefits\n  function addBenefit() {\n    if (newBenefit.trim()) {\n      setFormData((prev) => ({\n        ...prev,\n        benefits: [...prev.benefits, newBenefit.trim()],\n      }));\n      setNewBenefit(\"\");\n    }\n  }\n\n  function removeBenefit(index: number) {\n    setFormData((prev) => ({\n      ...prev,\n      benefits: prev.benefits.filter((_, i) => i !== index),\n    }));\n  }\n\n  // Add/remove tags\n  function addTag() {\n    if (newTag.trim() && !formData.tags.includes(newTag.trim())) {\n      setFormData((prev) => ({\n        ...prev,\n        tags: [...prev.tags, newTag.trim().toLowerCase()],\n      }));\n      setNewTag(\"\");\n    }\n  }\n\n  function removeTag(tag: string) {\n    setFormData((prev) => ({\n      ...prev,\n      tags: prev.tags.filter((t) => t !== tag),\n    }));\n  }\n\n  if (isLoading) {\n    return (\n      <div className={cn(\"p-6 flex items-center justify-center\", className)}>\n        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  const status = enrichmentStatus?.status || \"pending\";\n  const draft = enrichmentStatus?.draft;\n  const completeness = enrichmentStatus?.completeness;\n\n  return (\n    <div className={cn(\"rounded-lg border bg-card\", className)}>\n      {/* Header */}\n      <div\n        className=\"p-4 flex items-center justify-between cursor-pointer hover:bg-muted/30 transition-colors\"\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-12 h-12 rounded-lg overflow-hidden bg-muted\">\n            <img\n              src={getProductImageUrl(product.cloudinaryUrl)}\n              alt={product.name}\n              className=\"w-full h-full object-cover\"\n            />\n          </div>\n          <div>\n            <h3 className=\"font-medium\">{product.name}</h3>\n            <div className=\"flex items-center gap-2 mt-1\">\n              <StatusBadge status={status} />\n              {completeness && (\n                <span className=\"text-xs text-muted-foreground\">\n                  {completeness.percentage}% complete\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {status === \"pending\" && (\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={(e) => {\n                e.stopPropagation();\n                generateDraft();\n              }}\n              disabled={isGenerating}\n            >\n              {isGenerating ? (\n                <Loader2 className=\"w-4 h-4 animate-spin mr-1\" />\n              ) : (\n                <Sparkles className=\"w-4 h-4 mr-1\" />\n              )}\n              Generate Draft\n            </Button>\n          )}\n          {isExpanded ? (\n            <ChevronUp className=\"w-5 h-5 text-muted-foreground\" />\n          ) : (\n            <ChevronDown className=\"w-5 h-5 text-muted-foreground\" />\n          )}\n        </div>\n      </div>\n\n      {/* Error display */}\n      {error && (\n        <div className=\"mx-4 mb-2 p-3 bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900 rounded-lg flex items-center gap-2 text-red-700 dark:text-red-400 text-sm\">\n          <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n          {error}\n        </div>\n      )}\n\n      {/* Expanded content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"p-4 pt-0 space-y-6\">\n              {/* Completeness bar */}\n              {completeness && <CompletenessIndicator completeness={completeness} />}\n\n              {/* URL Enrichment */}\n              <div className=\"space-y-2 p-3 bg-muted/30 rounded-lg border border-dashed\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <Link2 className=\"w-4 h-4\" />\n                  Enrich from Product URL\n                </label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Paste a link to the manufacturer's product page to automatically extract product details.\n                </p>\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={productUrl}\n                    onChange={(e) => setProductUrl(e.target.value)}\n                    placeholder=\"https://example.com/product-page\"\n                    className=\"flex-1\"\n                    onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), fetchFromUrl())}\n                  />\n                  <Button\n                    variant=\"secondary\"\n                    onClick={fetchFromUrl}\n                    disabled={isFetchingUrl || !productUrl.trim()}\n                  >\n                    {isFetchingUrl ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin mr-1\" />\n                    ) : (\n                      <ExternalLink className=\"w-4 h-4 mr-1\" />\n                    )}\n                    Fetch\n                  </Button>\n                </div>\n              </div>\n\n              {/* Sources used */}\n              {draft?.sources && draft.sources.length > 0 && (\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs text-muted-foreground\">Sources:</span>\n                  {draft.sources.map((source, idx) => (\n                    <SourceBadge key={idx} source={source} />\n                  ))}\n                  {draft.confidence && (\n                    <span className=\"text-xs text-muted-foreground ml-2\">\n                      Confidence: {draft.confidence}%\n                    </span>\n                  )}\n                </div>\n              )}\n\n              {/* Description */}\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <FileText className=\"w-4 h-4\" />\n                  Description\n                </label>\n                <Textarea\n                  value={formData.description}\n                  onChange={(e) =>\n                    setFormData((prev) => ({ ...prev, description: e.target.value }))\n                  }\n                  placeholder=\"Describe the product, its use case, and key selling points...\"\n                  rows={3}\n                />\n              </div>\n\n              {/* Features */}\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <Package className=\"w-4 h-4\" />\n                  Features\n                </label>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {Object.entries(formData.features).map(([key, value]) => (\n                    <div key={key} className=\"flex gap-2\">\n                      <Input\n                        value={key}\n                        placeholder=\"Feature name\"\n                        className=\"flex-1\"\n                        onChange={(e) => {\n                          const newFeatures = { ...formData.features };\n                          delete newFeatures[key];\n                          newFeatures[e.target.value] = value;\n                          setFormData((prev) => ({ ...prev, features: newFeatures }));\n                        }}\n                      />\n                      <Input\n                        value={value}\n                        placeholder=\"Value\"\n                        className=\"flex-1\"\n                        onChange={(e) => {\n                          setFormData((prev) => ({\n                            ...prev,\n                            features: { ...prev.features, [key]: e.target.value },\n                          }));\n                        }}\n                      />\n                    </div>\n                  ))}\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"col-span-2\"\n                    onClick={() => {\n                      setFormData((prev) => ({\n                        ...prev,\n                        features: { ...prev.features, \"\": \"\" },\n                      }));\n                    }}\n                  >\n                    + Add Feature\n                  </Button>\n                </div>\n              </div>\n\n              {/* Benefits */}\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <List className=\"w-4 h-4\" />\n                  Benefits\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {formData.benefits.map((benefit, idx) => (\n                    <div\n                      key={idx}\n                      className=\"flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-sm\"\n                    >\n                      {benefit}\n                      <button\n                        onClick={() => removeBenefit(idx)}\n                        className=\"ml-1 hover:text-red-600 dark:hover:text-red-400\"\n                      >\n                        &times;\n                      </button>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={newBenefit}\n                    onChange={(e) => setNewBenefit(e.target.value)}\n                    placeholder=\"Add a benefit...\"\n                    onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), addBenefit())}\n                  />\n                  <Button variant=\"outline\" size=\"sm\" onClick={addBenefit}>\n                    Add\n                  </Button>\n                </div>\n              </div>\n\n              {/* Tags */}\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <Tag className=\"w-4 h-4\" />\n                  Tags\n                </label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {formData.tags.map((tag) => (\n                    <div\n                      key={tag}\n                      className=\"flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full text-xs\"\n                    >\n                      #{tag}\n                      <button\n                        onClick={() => removeTag(tag)}\n                        className=\"ml-1 hover:text-red-600 dark:hover:text-red-400\"\n                      >\n                        &times;\n                      </button>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={newTag}\n                    onChange={(e) => setNewTag(e.target.value)}\n                    placeholder=\"Add a tag...\"\n                    onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), addTag())}\n                  />\n                  <Button variant=\"outline\" size=\"sm\" onClick={addTag}>\n                    Add\n                  </Button>\n                </div>\n              </div>\n\n              {/* SKU */}\n              <div className=\"space-y-2\">\n                <label className=\"flex items-center gap-2 text-sm font-medium\">\n                  <Wrench className=\"w-4 h-4\" />\n                  SKU (optional)\n                </label>\n                <Input\n                  value={formData.sku}\n                  onChange={(e) =>\n                    setFormData((prev) => ({ ...prev, sku: e.target.value }))\n                  }\n                  placeholder=\"Product SKU or model number\"\n                />\n              </div>\n\n              {/* Action buttons */}\n              <div className=\"flex justify-end gap-2 pt-4 border-t\">\n                {status === \"draft\" && draft && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => saveEnrichment(true)}\n                    disabled={isSaving}\n                  >\n                    {isSaving ? (\n                      <Loader2 className=\"w-4 h-4 animate-spin mr-1\" />\n                    ) : (\n                      <Check className=\"w-4 h-4 mr-1\" />\n                    )}\n                    Approve As-Is\n                  </Button>\n                )}\n                <Button\n                  onClick={() => saveEnrichment(false)}\n                  disabled={isSaving || !formData.description}\n                >\n                  {isSaving ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin mr-1\" />\n                  ) : (\n                    <Check className=\"w-4 h-4 mr-1\" />\n                  )}\n                  Save & Verify\n                </Button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// Status badge component\nfunction StatusBadge({ status }: { status: string }) {\n  const config: Record<string, { label: string; className: string }> = {\n    pending: {\n      label: \"Needs Enrichment\",\n      className: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300\",\n    },\n    draft: {\n      label: \"Draft Ready\",\n      className: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300\",\n    },\n    verified: {\n      label: \"Verified\",\n      className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\",\n    },\n    complete: {\n      label: \"Complete\",\n      className: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\",\n    },\n  };\n\n  const c = config[status] || config.pending;\n\n  return (\n    <span className={cn(\"px-2 py-0.5 rounded-full text-xs font-medium\", c.className)}>\n      {c.label}\n    </span>\n  );\n}\n\nexport default ProductEnrichmentForm;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ProductRelationships.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\SaveToCatalogDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[314,349],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Note: @ts-nocheck is needed because the Select UI component uses @ts-nocheck\r\n// and its types don't propagate correctly\r\n// @ts-nocheck\r\nimport { useState } from \"react\";\r\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  X,\r\n  FolderPlus,\r\n  Loader2,\r\n  Check,\r\n  Image as ImageIcon,\r\n  Tag,\r\n} from \"lucide-react\";\r\nimport type { Product } from \"@shared/schema\";\r\n\r\ninterface SaveToCatalogDialogProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  imageUrl: string;\r\n  defaultName?: string;\r\n}\r\n\r\nexport function SaveToCatalogDialog({\r\n  isOpen,\r\n  onClose,\r\n  imageUrl,\r\n  defaultName = \"Generated Image\",\r\n}: SaveToCatalogDialogProps) {\r\n  const queryClient = useQueryClient();\r\n  const [name, setName] = useState(defaultName);\r\n  const [category, setCategory] = useState(\"\");\r\n  const [newCategory, setNewCategory] = useState(\"\");\r\n  const [showNewCategory, setShowNewCategory] = useState(false);\r\n  const [tags, setTags] = useState<string[]>([]);\r\n  const [tagInput, setTagInput] = useState(\"\");\r\n\r\n  // Fetch existing products to get categories\r\n  const { data: products = [] } = useQuery<Product[]>({\r\n    queryKey: [\"products\"],\r\n    queryFn: async () => {\r\n      const res = await fetch(\"/api/products\");\r\n      if (!res.ok) return [];\r\n      return res.json();\r\n    },\r\n  });\r\n\r\n  // Get unique categories\r\n  const existingCategories = Array.from(\r\n    new Set(products.map((p) => p.category).filter((c): c is string => !!c))\r\n  );\r\n\r\n  // Save mutation\r\n  const saveMutation = useMutation({\r\n    mutationFn: async () => {\r\n      // First, fetch the image and convert to blob\r\n      const response = await fetch(imageUrl);\r\n      const blob = await response.blob();\r\n      const file = new File([blob], `${name}.jpg`, { type: blob.type });\r\n\r\n      // Create form data\r\n      const formData = new FormData();\r\n      formData.append(\"image\", file);\r\n      formData.append(\"name\", name);\r\n      formData.append(\"category\", showNewCategory ? newCategory : category);\r\n\r\n      // Upload to products endpoint\r\n      const res = await fetch(\"/api/products\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || \"Failed to save to catalog\");\r\n      }\r\n\r\n      return res.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"products\"] });\r\n      onClose();\r\n    },\r\n  });\r\n\r\n  // Add tag\r\n  const addTag = () => {\r\n    if (tagInput.trim() && !tags.includes(tagInput.trim())) {\r\n      setTags((prev) => [...prev, tagInput.trim()]);\r\n      setTagInput(\"\");\r\n    }\r\n  };\r\n\r\n  // Remove tag\r\n  const removeTag = (tag: string) => {\r\n    setTags((prev) => prev.filter((t) => t !== tag));\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          {/* Backdrop */}\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={onClose}\r\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50\"\r\n          />\r\n\r\n          {/* Dialog */}\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n            className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md\"\r\n          >\r\n            <div className=\"bg-card border border-border rounded-2xl shadow-xl overflow-hidden\">\r\n              {/* Header */}\r\n              <div className=\"flex items-center justify-between p-4 border-b border-border\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <FolderPlus className=\"w-5 h-5 text-primary\" />\r\n                  <h2 className=\"font-medium\">Save to Product Catalog</h2>\r\n                </div>\r\n                <button\r\n                  onClick={onClose}\r\n                  className=\"p-1 hover:bg-muted/50 rounded-lg transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n\r\n              {/* Content */}\r\n              <div className=\"p-4 space-y-4\">\r\n                {/* Image Preview */}\r\n                <div className=\"flex gap-4\">\r\n                  <div className=\"w-24 h-24 rounded-lg overflow-hidden border border-border flex-shrink-0\">\r\n                    <img\r\n                      src={imageUrl}\r\n                      alt=\"Preview\"\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"flex-1 space-y-3\">\r\n                    {/* Name Input */}\r\n                    <div>\r\n                      <label className=\"text-xs text-muted-foreground mb-1 block\">\r\n                        Product Name\r\n                      </label>\r\n                      <Input\r\n                        value={name}\r\n                        onChange={(e) => setName(e.target.value)}\r\n                        placeholder=\"e.g., Drainage Grate Hero Shot\"\r\n                        className=\"h-9\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Category Selection */}\r\n                <div>\r\n                  <label className=\"text-xs text-muted-foreground mb-1 block\">\r\n                    Category\r\n                  </label>\r\n                  {!showNewCategory ? (\r\n                    <div className=\"flex gap-2\">\r\n                      <Select value={category} onValueChange={setCategory}>\r\n                        <SelectTrigger className=\"flex-1 h-9\">\r\n                          <SelectValue placeholder=\"Select category...\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {existingCategories.map((cat) => (\r\n                            <SelectItem key={cat} value={cat}>\r\n                              {cat}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => setShowNewCategory(true)}\r\n                        className=\"h-9\"\r\n                      >\r\n                        + New\r\n                      </Button>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"flex gap-2\">\r\n                      <Input\r\n                        value={newCategory}\r\n                        onChange={(e) => setNewCategory(e.target.value)}\r\n                        placeholder=\"New category name...\"\r\n                        className=\"flex-1 h-9\"\r\n                      />\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => {\r\n                          setShowNewCategory(false);\r\n                          setNewCategory(\"\");\r\n                        }}\r\n                        className=\"h-9\"\r\n                      >\r\n                        Cancel\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Tags (Optional) */}\r\n                <div>\r\n                  <label className=\"text-xs text-muted-foreground mb-1 block\">\r\n                    Tags (optional)\r\n                  </label>\r\n                  <div className=\"flex gap-2\">\r\n                    <Input\r\n                      value={tagInput}\r\n                      onChange={(e) => setTagInput(e.target.value)}\r\n                      placeholder=\"Add tags...\"\r\n                      className=\"flex-1 h-9\"\r\n                      onKeyDown={(e) => e.key === \"Enter\" && addTag()}\r\n                    />\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={addTag}\r\n                      disabled={!tagInput.trim()}\r\n                      className=\"h-9\"\r\n                    >\r\n                      <Tag className=\"w-4 h-4\" />\r\n                    </Button>\r\n                  </div>\r\n                  {tags.length > 0 && (\r\n                    <div className=\"flex flex-wrap gap-1 mt-2\">\r\n                      {tags.map((tag) => (\r\n                        <span\r\n                          key={tag}\r\n                          className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-primary/10 text-primary text-xs\"\r\n                        >\r\n                          {tag}\r\n                          <button\r\n                            onClick={() => removeTag(tag)}\r\n                            className=\"hover:text-destructive\"\r\n                          >\r\n                            <X className=\"w-3 h-3\" />\r\n                          </button>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Info */}\r\n                <div className=\"p-3 rounded-lg bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/30 dark:border-blue-500/20\">\r\n                  <p className=\"text-xs text-blue-600 dark:text-blue-400\">\r\n                    <ImageIcon className=\"w-3 h-3 inline mr-1\" />\r\n                    This image will be saved to your product catalog and can be\r\n                    used in future generations.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Footer */}\r\n              <div className=\"flex gap-2 p-4 border-t border-border bg-muted/30\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={onClose}\r\n                  className=\"flex-1\"\r\n                  disabled={saveMutation.isPending}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  onClick={() => saveMutation.mutate()}\r\n                  disabled={!name.trim() || saveMutation.isPending}\r\n                  className=\"flex-1\"\r\n                >\r\n                  {saveMutation.isPending ? (\r\n                    <>\r\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                      Saving...\r\n                    </>\r\n                  ) : saveMutation.isSuccess ? (\r\n                    <>\r\n                      <Check className=\"w-4 h-4 mr-2\" />\r\n                      Saved!\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FolderPlus className=\"w-4 h-4 mr-2\" />\r\n                      Save to Catalog\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </div>\r\n\r\n              {/* Error Message */}\r\n              {saveMutation.isError && (\r\n                <div className=\"px-4 pb-4\">\r\n                  <p className=\"text-xs text-red-600 dark:text-red-400\">\r\n                    {saveMutation.error?.message || \"Failed to save\"}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\SimplifiedCopyPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1977,1980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1977,1980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Sparkles, Loader2, RefreshCw, Copy, Check } from 'lucide-react';\r\n\r\ninterface SimplifiedCopyPanelProps {\r\n  generationId: string;\r\n  platform?: 'linkedin' | 'instagram' | 'facebook' | 'twitter' | 'tiktok';\r\n  productName?: string;\r\n  productDescription?: string;\r\n  onCopyGenerated?: (copy: string) => void;\r\n  className?: string;\r\n}\r\n\r\nexport function SimplifiedCopyPanel({\r\n  generationId,\r\n  platform = 'linkedin',\r\n  productName = 'Product',\r\n  productDescription = 'Professional product for marketing',\r\n  onCopyGenerated,\r\n  className = '',\r\n}: SimplifiedCopyPanelProps) {\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [copy, setCopy] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [copied, setCopied] = useState(false);\r\n\r\n  const handleGenerate = async () => {\r\n    setIsGenerating(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await fetch('/api/copy/generate', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          generationId,\r\n          platform: platform.toLowerCase(),\r\n          tone: 'professional',\r\n          productName: productName.slice(0, 100),\r\n          productDescription: productDescription.slice(0, 500),\r\n          industry: 'Building Products',\r\n          framework: 'auto',\r\n          variations: 1,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok || !data.success) {\r\n        throw new Error(data.error || 'Failed to generate copy');\r\n      }\r\n\r\n      if (data.variations && data.variations.length > 0) {\r\n        const generatedCopy = data.variations[0].copy || data.variations[0].caption || '';\r\n        setCopy(generatedCopy);\r\n        onCopyGenerated?.(generatedCopy);\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Failed to generate copy');\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  const handleCopyToClipboard = async () => {\r\n    if (!copy) return;\r\n    try {\r\n      await navigator.clipboard.writeText(copy);\r\n      setCopied(true);\r\n      setTimeout(() => setCopied(false), 2000);\r\n    } catch {\r\n      // Clipboard API may fail in some browsers/contexts\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`space-y-3 ${className}`}>\r\n      <Button\r\n        onClick={handleGenerate}\r\n        disabled={isGenerating}\r\n        data-testid=\"generate-copy-button-simplified\"\r\n        className=\"w-full\"\r\n        variant={copy ? 'outline' : 'default'}\r\n      >\r\n        {isGenerating ? (\r\n          <>\r\n            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n            Generating...\r\n          </>\r\n        ) : copy ? (\r\n          <>\r\n            <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n            Regenerate Copy\r\n          </>\r\n        ) : (\r\n          <>\r\n            <Sparkles className=\"w-4 h-4 mr-2\" />\r\n            Generate Copy\r\n          </>\r\n        )}\r\n      </Button>\r\n\r\n      {error && (\r\n        <div className=\"p-3 bg-destructive/10 text-destructive rounded-md text-sm\">\r\n          {error}\r\n        </div>\r\n      )}\r\n\r\n      {copy && (\r\n        <div className=\"p-3 bg-muted rounded-md text-sm space-y-2\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <p className=\"font-medium\">Generated Ad Copy:</p>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={handleCopyToClipboard}\r\n              className=\"h-8 px-2\"\r\n            >\r\n              {copied ? (\r\n                <Check className=\"w-4 h-4 text-green-500\" />\r\n              ) : (\r\n                <Copy className=\"w-4 h-4\" />\r\n              )}\r\n            </Button>\r\n          </div>\r\n          <p className=\"whitespace-pre-wrap text-muted-foreground\">{copy}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\TemplateCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\TemplateLibrary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\TextOnlyMode.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6766,6769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6766,6769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * TextOnlyMode Component\n *\n * A copy-only content creation mode optimized for text posts.\n * NO image generation - pure text optimization.\n *\n * 2026 Critical Research Findings:\n * - LinkedIn text-only posts get 30% MORE reach than image posts!\n * - FIRST 150 CHARACTERS ARE CRITICAL (before \"See more\" truncation)\n * - Comments are weighted 8x more than likes in the algorithm\n * - External links are penalized by 60%\n * - Dwell time matters - longer, engaging text wins\n * - Optimal posting: 3-4 times per week\n *\n * This component prioritizes the first 150 characters as the most important\n * part of any post - the hook that determines if users click \"See more\".\n */\n\nimport { useState, useCallback, useMemo } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  FileText,\n  Sparkles,\n  X,\n  CheckCircle2,\n  Copy,\n  RefreshCw,\n  TrendingUp,\n  MessageCircle,\n  Eye,\n  AlertTriangle,\n  Zap,\n  Target,\n} from \"lucide-react\";\n\n// Character limits for the \"See more\" truncation\nconst CRITICAL_CHAR_LIMIT = 150; // First 150 chars shown before \"See more\"\nconst PLATFORM_LIMITS: Record<string, number> = {\n  linkedin: 3000,\n  twitter: 280,\n  facebook: 63206,\n  instagram: 2200,\n  tiktok: 2200,\n};\n\ninterface TextOnlyModeProps {\n  templateId: string;\n  topic: string;\n  platform: string;\n  onClose: () => void;\n  onComplete?: (result: TextOnlyResult) => void;\n}\n\ninterface TextOnlyResult {\n  copy: string;\n  platform: string;\n  characterCount: number;\n  hookQuality: number; // 1-100 score for first 150 chars\n}\n\ninterface CopyVariation {\n  id: number;\n  copy: string;\n  hookScore: number;\n  engagementPrediction: string;\n}\n\n// 2026 Best Practices - prominently displayed\nconst TEXT_ONLY_TIPS = [\n  {\n    icon: TrendingUp,\n    title: \"30% More Reach\",\n    tip: \"LinkedIn text-only posts outperform image posts by 30% in 2026\",\n    highlight: true,\n  },\n  {\n    icon: Eye,\n    title: \"First 150 Characters = Everything\",\n    tip: \"Users see only 150 chars before 'See more'. Make them irresistible.\",\n    highlight: true,\n  },\n  {\n    icon: MessageCircle,\n    title: \"Comments > Likes\",\n    tip: \"Comments are weighted 8x more than likes. End with a question.\",\n    highlight: false,\n  },\n  {\n    icon: AlertTriangle,\n    title: \"No External Links\",\n    tip: \"Links are penalized 60%. Put links in comments instead.\",\n    highlight: false,\n  },\n];\n\n// Hook formulas optimized for first 150 characters\nconst HOOK_FORMULAS = [\n  \"Stop [doing X]. It's costing you [result].\",\n  \"I made $[X] by [doing Y]. Here's the exact playbook:\",\n  \"Everyone says [common advice]. But after [X years], I learned:\",\n  \"The harsh truth about [topic] nobody tells you:\",\n  \"[Specific number] years. [Specific achievement]. Here's what I know now:\",\n  \"This mistake cost me [X]. Don't make the same one.\",\n];\n\nexport function TextOnlyMode({\n  templateId: _templateId,\n  topic,\n  platform,\n  onClose,\n  onComplete,\n}: TextOnlyModeProps) {\n  const [copy, setCopy] = useState(\"\");\n  const [selectedPlatform, setSelectedPlatform] = useState(platform);\n  const [variations, setVariations] = useState<CopyVariation[]>([]);\n  const [selectedVariation, setSelectedVariation] = useState<number | null>(null);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [copyCount, setCopyCount] = useState(3);\n\n  // Calculate character metrics\n  const charMetrics = useMemo(() => {\n    const total = copy.length;\n    const first150 = copy.slice(0, CRITICAL_CHAR_LIMIT);\n    const first150Length = first150.length;\n    const platformLimit = PLATFORM_LIMITS[selectedPlatform] || 3000;\n    const remaining = platformLimit - total;\n    const isOverLimit = total > platformLimit;\n    const hookProgress = (first150Length / CRITICAL_CHAR_LIMIT) * 100;\n\n    // Analyze hook quality (simple heuristics)\n    let hookQuality = 50; // Base score\n\n    // Check for power words in first 150 chars\n    const powerWords = [\"stop\", \"secret\", \"truth\", \"mistake\", \"never\", \"always\", \"exact\", \"proven\", \"free\", \"new\"];\n    const lowerFirst150 = first150.toLowerCase();\n    powerWords.forEach((word) => {\n      if (lowerFirst150.includes(word)) hookQuality += 5;\n    });\n\n    // Check for numbers (specificity)\n    if (/\\d/.test(first150)) hookQuality += 10;\n\n    // Check for question (engagement)\n    if (first150.includes(\"?\")) hookQuality += 10;\n\n    // Penalize if first line is too long (should be punchy)\n    const firstLine = first150.split(\"\\n\")[0];\n    if (firstLine.length > 80) hookQuality -= 10;\n\n    // Ensure score is in bounds\n    hookQuality = Math.min(100, Math.max(0, hookQuality));\n\n    return {\n      total,\n      first150Length,\n      platformLimit,\n      remaining,\n      isOverLimit,\n      hookProgress,\n      hookQuality,\n      first150,\n      rest: copy.slice(CRITICAL_CHAR_LIMIT),\n    };\n  }, [copy, selectedPlatform]);\n\n  // Generate copy mutation\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/copywriting/standalone\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({\n          platform: selectedPlatform,\n          tone: \"authentic\",\n          framework: \"auto\",\n          campaignObjective: \"engagement\",\n          productName: topic,\n          productDescription: `Create a text-only post about: ${topic}.\n\nCRITICAL REQUIREMENTS FOR 2026:\n1. The FIRST 150 CHARACTERS are the most important - this is what shows before \"See more\"\n2. Start with a pattern-interrupting hook that stops the scroll\n3. Use specific numbers and concrete details\n4. End with a question to drive comments\n5. DO NOT include any links (they reduce reach by 60%)\n6. Write like a human, not a brand`,\n          industry: \"general\",\n          variations: copyCount,\n        }),\n      });\n      if (!response.ok) throw new Error(\"Failed to generate copy\");\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.variations && data.variations.length > 0) {\n        const newVariations: CopyVariation[] = data.variations.map(\n          (v: any, i: number) => {\n            const text = v.copy || \"\";\n            const first150 = text.slice(0, 150);\n\n            // Calculate hook score\n            let score = 50;\n            if (/\\d/.test(first150)) score += 15;\n            if (first150.includes(\"?\")) score += 10;\n            if (first150.length > 100) score += 10;\n            const powerWords = [\"stop\", \"secret\", \"truth\", \"mistake\", \"never\"];\n            powerWords.forEach((w) => {\n              if (first150.toLowerCase().includes(w)) score += 5;\n            });\n            score = Math.min(100, score);\n\n            return {\n              id: i,\n              copy: text,\n              hookScore: score,\n              engagementPrediction:\n                score >= 80 ? \"High\" : score >= 60 ? \"Medium\" : \"Low\",\n            };\n          }\n        );\n\n        setVariations(newVariations);\n        if (newVariations.length > 0) {\n          // Auto-select the one with highest hook score\n          const best = newVariations.reduce((a, b) =>\n            a.hookScore > b.hookScore ? a : b\n          );\n          setSelectedVariation(best.id);\n          setCopy(best.copy);\n        }\n      }\n    },\n  });\n\n  // Generate copies\n  const generateCopies = useCallback(() => {\n    setIsGenerating(true);\n    generateMutation.mutate(undefined, {\n      onSettled: () => setIsGenerating(false),\n    });\n  }, [generateMutation]);\n\n  // Select a variation\n  const selectVariation = useCallback((variation: CopyVariation) => {\n    setSelectedVariation(variation.id);\n    setCopy(variation.copy);\n  }, []);\n\n  // Copy to clipboard\n  const copyToClipboard = useCallback(() => {\n    navigator.clipboard.writeText(copy);\n  }, [copy]);\n\n  // Complete and return result\n  const handleComplete = useCallback(() => {\n    const result: TextOnlyResult = {\n      copy,\n      platform: selectedPlatform,\n      characterCount: copy.length,\n      hookQuality: charMetrics.hookQuality,\n    };\n    onComplete?.(result);\n    onClose();\n  }, [copy, selectedPlatform, charMetrics.hookQuality, onComplete, onClose]);\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <CardHeader className=\"flex flex-row items-center justify-between py-4 px-6 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <FileText className=\"w-5 h-5 text-primary\" />\n            <div>\n              <CardTitle className=\"text-lg\">Text-Only Mode</CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                Optimized for {selectedPlatform} text posts (30% more reach than images!)\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Select value={selectedPlatform} onValueChange={setSelectedPlatform}>\n              <SelectTrigger className=\"w-32\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"linkedin\">LinkedIn</SelectItem>\n                <SelectItem value=\"twitter\">Twitter/X</SelectItem>\n                <SelectItem value=\"facebook\">Facebook</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardHeader>\n\n        <div className=\"flex-1 overflow-hidden flex\">\n          {/* Left Panel - Editor */}\n          <div className=\"flex-1 overflow-auto p-6 space-y-6\">\n            {/* 2026 Tips Banner */}\n            <div className=\"grid grid-cols-2 gap-3\">\n              {TEXT_ONLY_TIPS.map((tip, i) => (\n                <div\n                  key={i}\n                  className={cn(\n                    \"rounded-lg p-3 border\",\n                    tip.highlight\n                      ? \"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800\"\n                      : \"bg-muted/50 border-border\"\n                  )}\n                >\n                  <div className=\"flex items-start gap-2\">\n                    <tip.icon\n                      className={cn(\n                        \"w-4 h-4 mt-0.5\",\n                        tip.highlight\n                          ? \"text-green-600\"\n                          : \"text-muted-foreground\"\n                      )}\n                    />\n                    <div>\n                      <p\n                        className={cn(\n                          \"text-sm font-medium\",\n                          tip.highlight\n                            ? \"text-green-900 dark:text-green-100\"\n                            : \"\"\n                        )}\n                      >\n                        {tip.title}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">{tip.tip}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* First 150 Characters Section - THE MOST IMPORTANT PART */}\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Target className=\"w-5 h-5 text-primary\" />\n                  <h3 className=\"font-semibold text-lg\">\n                    First 150 Characters\n                    <span className=\"text-destructive ml-1\">*</span>\n                  </h3>\n                  <Badge\n                    variant={\n                      charMetrics.hookQuality >= 70 ? \"default\" : \"secondary\"\n                    }\n                    className={cn(\n                      charMetrics.hookQuality >= 80 && \"bg-green-600\",\n                      charMetrics.hookQuality >= 60 &&\n                        charMetrics.hookQuality < 80 &&\n                        \"bg-amber-600\",\n                      charMetrics.hookQuality < 60 && \"bg-red-600\"\n                    )}\n                  >\n                    Hook Score: {charMetrics.hookQuality}/100\n                  </Badge>\n                </div>\n                <span\n                  className={cn(\n                    \"text-sm font-mono\",\n                    charMetrics.first150Length >= CRITICAL_CHAR_LIMIT\n                      ? \"text-green-600\"\n                      : \"text-muted-foreground\"\n                  )}\n                >\n                  {charMetrics.first150Length}/{CRITICAL_CHAR_LIMIT}\n                </span>\n              </div>\n\n              <div className=\"bg-amber-50 dark:bg-amber-950/30 border-2 border-amber-300 dark:border-amber-700 rounded-lg p-4\">\n                <p className=\"text-xs text-amber-700 dark:text-amber-300 mb-2 font-medium\">\n                  This is what users see before clicking \"See more\" - make it count!\n                </p>\n                <div className=\"bg-white dark:bg-background rounded p-3 border\">\n                  <p className=\"text-base leading-relaxed whitespace-pre-wrap\">\n                    <span className=\"font-medium\">{charMetrics.first150}</span>\n                    {charMetrics.rest && (\n                      <span className=\"text-muted-foreground\">\n                        {\" \"}\n                        <span className=\"text-blue-600 cursor-pointer\">\n                          ...see more\n                        </span>\n                      </span>\n                    )}\n                  </p>\n                </div>\n                <Progress\n                  value={charMetrics.hookProgress}\n                  className=\"mt-3 h-2\"\n                />\n              </div>\n            </div>\n\n            {/* Full Copy Editor */}\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"font-semibold\">Full Post</h3>\n                <div className=\"flex items-center gap-2\">\n                  <span\n                    className={cn(\n                      \"text-sm font-mono\",\n                      charMetrics.isOverLimit\n                        ? \"text-destructive\"\n                        : \"text-muted-foreground\"\n                    )}\n                  >\n                    {charMetrics.total}/{charMetrics.platformLimit}\n                    {charMetrics.isOverLimit && \" (over limit!)\"}\n                  </span>\n                </div>\n              </div>\n\n              <Textarea\n                value={copy}\n                onChange={(e) => setCopy(e.target.value)}\n                placeholder={`Start with a hook that stops the scroll...\n\nExample:\n\"Stop posting images on LinkedIn. Here's why:\n\nI tested 47 posts over 3 months.\nText-only posts got 30% more reach.\nEvery. Single. Time.\n\nHere's what I learned...\"`}\n                rows={12}\n                className={cn(\n                  \"font-mono text-sm\",\n                  charMetrics.isOverLimit && \"border-destructive\"\n                )}\n              />\n            </div>\n\n            {/* Hook Formulas */}\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium text-muted-foreground\">\n                Proven Hook Formulas (click to use)\n              </h4>\n              <div className=\"flex flex-wrap gap-2\">\n                {HOOK_FORMULAS.map((formula, i) => (\n                  <Button\n                    key={i}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-xs\"\n                    onClick={() => setCopy(formula + \"\\n\\n\" + copy)}\n                  >\n                    {formula.slice(0, 40)}...\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            {/* Generate Button */}\n            <div className=\"flex items-center gap-3\">\n              <Select\n                value={copyCount.toString()}\n                onValueChange={(v) => setCopyCount(parseInt(v))}\n              >\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"1\">1 variation</SelectItem>\n                  <SelectItem value=\"3\">3 variations</SelectItem>\n                  <SelectItem value=\"5\">5 variations</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Button\n                onClick={generateCopies}\n                disabled={isGenerating}\n                className=\"flex-1\"\n              >\n                {isGenerating ? (\n                  <>\n                    <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                    Generating Hook-Optimized Copy...\n                  </>\n                ) : (\n                  <>\n                    <Sparkles className=\"w-4 h-4 mr-2\" />\n                    Generate {copyCount} Variation{copyCount > 1 ? \"s\" : \"\"}\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n\n          {/* Right Panel - Variations */}\n          <div className=\"w-80 border-l bg-muted/30 overflow-auto\">\n            <div className=\"p-4 border-b\">\n              <h3 className=\"font-semibold\">Generated Variations</h3>\n              <p className=\"text-xs text-muted-foreground\">\n                Ranked by hook quality score\n              </p>\n            </div>\n\n            <ScrollArea className=\"h-full\">\n              <div className=\"p-4 space-y-3\">\n                {variations.length === 0 ? (\n                  <div className=\"text-center text-muted-foreground py-8\">\n                    <Zap className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                    <p className=\"text-sm\">\n                      Generate variations to see them ranked by hook quality\n                    </p>\n                  </div>\n                ) : (\n                  variations\n                    .sort((a, b) => b.hookScore - a.hookScore)\n                    .map((variation) => (\n                      <div\n                        key={variation.id}\n                        onClick={() => selectVariation(variation)}\n                        className={cn(\n                          \"rounded-lg border p-3 cursor-pointer transition-colors\",\n                          selectedVariation === variation.id\n                            ? \"border-primary bg-primary/5\"\n                            : \"hover:border-primary/50\"\n                        )}\n                      >\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <Badge\n                            variant={\n                              variation.hookScore >= 70 ? \"default\" : \"secondary\"\n                            }\n                            className={cn(\n                              \"text-xs\",\n                              variation.hookScore >= 80 && \"bg-green-600\",\n                              variation.hookScore >= 60 &&\n                                variation.hookScore < 80 &&\n                                \"bg-amber-600\",\n                              variation.hookScore < 60 && \"bg-red-600\"\n                            )}\n                          >\n                            Hook: {variation.hookScore}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {variation.engagementPrediction} engagement\n                          </span>\n                        </div>\n                        <p className=\"text-sm line-clamp-4 text-muted-foreground\">\n                          {variation.copy.slice(0, 150)}...\n                        </p>\n                      </div>\n                    ))\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"border-t p-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button variant=\"outline\" onClick={copyToClipboard}>\n                    <Copy className=\"w-4 h-4 mr-2\" />\n                    Copy Text\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>Copy to clipboard</TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowPreview(!showPreview)}\n            >\n              <Eye className=\"w-4 h-4 mr-2\" />\n              {showPreview ? \"Hide\" : \"Show\"} Preview\n            </Button>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"ghost\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button onClick={handleComplete} disabled={!copy.trim()}>\n              <CheckCircle2 className=\"w-4 h-4 mr-2\" />\n              Use This Copy\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n\nexport type { TextOnlyModeProps, TextOnlyResult };\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ThemeToggle.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck - shadcn/ui dropdown has type inference issues\r\nimport { useTheme } from \"next-themes\";\r\nimport { Moon, Sun } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\n\r\nexport function ThemeToggle() {\r\n  const { setTheme, theme } = useTheme();\r\n\r\n  return (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\">\r\n          <Sun className=\"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\r\n          <Moon className=\"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\r\n          <span className=\"sr-only\">Toggle theme</span>\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"end\">\r\n        <DropdownMenuItem onClick={() => setTheme(\"light\")}>\r\n          <Sun className=\"mr-2 h-4 w-4\" />\r\n          Light\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")}>\r\n          <Moon className=\"mr-2 h-4 w-4\" />\r\n          Dark\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => setTheme(\"system\")}>\r\n          <span className=\"mr-2\"></span>\r\n          System\r\n        </DropdownMenuItem>\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\UploadZone.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'uploads'. Either include it or remove the dependency array.","line":207,"column":6,"nodeType":"ArrayExpression","endLine":207,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [uploads]","fix":{"range":[5974,5976],"text":"[uploads]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useState, useRef, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Upload, X, Loader2, Check, AlertTriangle, Pencil } from \"lucide-react\";\r\nimport type { AnalyzedUpload, ImageAnalysisResponse } from \"@/types/analyzedUpload\";\r\nimport { AUTO_CONFIRM_THRESHOLD } from \"@/types/analyzedUpload\";\r\n\r\ninterface UploadZoneProps {\r\n  uploads: AnalyzedUpload[];\r\n  onUploadsChange: (uploads: AnalyzedUpload[]) => void;\r\n  maxFiles: number;\r\n  disabled?: boolean;\r\n}\r\n\r\n/**\r\n * UploadZone Component\r\n *\r\n * Allows users to drag-and-drop or select images for generation.\r\n * Images are analyzed with AI. Click to select for use in generation.\r\n * Description shows on hover.\r\n */\r\nexport function UploadZone({\r\n  uploads,\r\n  onUploadsChange,\r\n  maxFiles,\r\n  disabled = false,\r\n}: UploadZoneProps) {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [editValue, setEditValue] = useState(\"\");\r\n\r\n  // Generate unique ID\r\n  const generateId = () => `upload-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\r\n\r\n  // Analyze a single image\r\n  const analyzeImage = async (upload: AnalyzedUpload): Promise<AnalyzedUpload> => {\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"image\", upload.file);\r\n\r\n      const response = await fetch(\"/api/analyze-image\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n        credentials: \"include\",\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Analysis failed\");\r\n      }\r\n\r\n      const data: ImageAnalysisResponse = await response.json();\r\n\r\n      return {\r\n        ...upload,\r\n        description: data.description,\r\n        confidence: data.confidence,\r\n        status: \"confirmed\",\r\n      };\r\n    } catch {\r\n      // Return with a fallback description\r\n      return {\r\n        ...upload,\r\n        description: \"Unable to analyze image\",\r\n        confidence: 0,\r\n        status: \"confirmed\",\r\n      };\r\n    }\r\n  };\r\n\r\n  // Handle new files being added\r\n  const handleFilesAdded = useCallback(async (files: File[]) => {\r\n    const remainingSlots = maxFiles - uploads.length;\r\n    const filesToAdd = files.slice(0, remainingSlots);\r\n\r\n    // Create initial upload objects with 'analyzing' status\r\n    const newUploads: AnalyzedUpload[] = filesToAdd.map((file) => ({\r\n      id: generateId(),\r\n      file,\r\n      previewUrl: URL.createObjectURL(file),\r\n      description: null,\r\n      confidence: 0,\r\n      status: \"analyzing\" as const,\r\n      selected: false,\r\n    }));\r\n\r\n    // Add them immediately (with analyzing status)\r\n    const updatedUploads = [...uploads, ...newUploads];\r\n    onUploadsChange(updatedUploads);\r\n\r\n    // Analyze each one in parallel\r\n    const analyzedUploads = await Promise.all(\r\n      newUploads.map((upload) => analyzeImage(upload))\r\n    );\r\n\r\n    // Update with analysis results\r\n    const finalUploads = updatedUploads.map((u) => {\r\n      const analyzed = analyzedUploads.find((a) => a.id === u.id);\r\n      return analyzed || u;\r\n    });\r\n    onUploadsChange(finalUploads);\r\n  }, [uploads, maxFiles, onUploadsChange]);\r\n\r\n  // Handle drag events\r\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!disabled) setIsDragging(true);\r\n  }, [disabled]);\r\n\r\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n  }, []);\r\n\r\n  const handleDragOver = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }, []);\r\n\r\n  const handleDrop = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n\r\n    if (disabled) return;\r\n\r\n    const droppedFiles = Array.from(e.dataTransfer.files).filter(\r\n      (file) => file.type.startsWith(\"image/\")\r\n    );\r\n\r\n    if (droppedFiles.length > 0) {\r\n      handleFilesAdded(droppedFiles);\r\n    }\r\n  }, [disabled, handleFilesAdded]);\r\n\r\n  // Handle file picker\r\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (disabled || !e.target.files) return;\r\n\r\n    const selectedFiles = Array.from(e.target.files).filter(\r\n      (file) => file.type.startsWith(\"image/\")\r\n    );\r\n\r\n    if (selectedFiles.length > 0) {\r\n      handleFilesAdded(selectedFiles);\r\n    }\r\n\r\n    // Reset input to allow selecting the same file again\r\n    e.target.value = \"\";\r\n  }, [disabled, handleFilesAdded]);\r\n\r\n  const handleClick = () => {\r\n    if (!disabled && uploads.length < maxFiles) {\r\n      fileInputRef.current?.click();\r\n    }\r\n  };\r\n\r\n  // Handle remove\r\n  const handleRemove = (id: string, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    const upload = uploads.find((u) => u.id === id);\r\n    if (upload) {\r\n      URL.revokeObjectURL(upload.previewUrl);\r\n    }\r\n    onUploadsChange(uploads.filter((u) => u.id !== id));\r\n  };\r\n\r\n  // Handle selection toggle\r\n  const handleToggleSelect = (id: string) => {\r\n    onUploadsChange(\r\n      uploads.map((u) =>\r\n        u.id === id ? { ...u, selected: !u.selected } : u\r\n      )\r\n    );\r\n  };\r\n\r\n  // Handle edit\r\n  const startEdit = (upload: AnalyzedUpload, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    setEditingId(upload.id);\r\n    setEditValue(upload.description || \"\");\r\n  };\r\n\r\n  const saveEdit = () => {\r\n    if (editingId) {\r\n      onUploadsChange(\r\n        uploads.map((u) =>\r\n          u.id === editingId ? { ...u, description: editValue.trim() || \"Image\" } : u\r\n        )\r\n      );\r\n      setEditingId(null);\r\n      setEditValue(\"\");\r\n    }\r\n  };\r\n\r\n  const cancelEdit = () => {\r\n    setEditingId(null);\r\n    setEditValue(\"\");\r\n  };\r\n\r\n  // Cleanup object URLs on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      uploads.forEach((u) => URL.revokeObjectURL(u.previewUrl));\r\n    };\r\n  }, []);\r\n\r\n  const canAddMore = uploads.length < maxFiles && !disabled;\r\n  const selectedCount = uploads.filter(u => u.selected).length;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Image Grid - matches product grid style */}\r\n      {uploads.length > 0 && (\r\n        <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3\">\r\n          {uploads.map((upload) => {\r\n            const isHighConfidence = upload.confidence >= AUTO_CONFIRM_THRESHOLD;\r\n            const isEditing = editingId === upload.id;\r\n            const isSelected = upload.selected;\r\n            const isConfirmed = upload.status === \"confirmed\";\r\n\r\n            return (\r\n              <div\r\n                key={upload.id}\r\n                onClick={() => isConfirmed && !isEditing && handleToggleSelect(upload.id)}\r\n                className={cn(\r\n                  \"relative aspect-square rounded-xl overflow-hidden border-2 transition-all group cursor-pointer\",\r\n                  isSelected\r\n                    ? \"border-primary ring-2 ring-primary/30\"\r\n                    : \"border-purple-500/30 hover:border-purple-500/60\"\r\n                )}\r\n              >\r\n                <img\r\n                  src={upload.previewUrl}\r\n                  alt={upload.description || \"Upload\"}\r\n                  className={cn(\r\n                    \"w-full h-full object-cover transition-all\",\r\n                    isSelected && \"brightness-100\",\r\n                    !isSelected && \"brightness-90 group-hover:brightness-100\"\r\n                  )}\r\n                />\r\n\r\n                {/* Analyzing overlay */}\r\n                {upload.status === \"analyzing\" && (\r\n                  <div className=\"absolute inset-0 bg-black/60 flex flex-col items-center justify-center\">\r\n                    <Loader2 className=\"w-6 h-6 text-white animate-spin mb-2\" />\r\n                    <span className=\"text-xs text-white\">Analyzing...</span>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Confidence badge - top left */}\r\n                {isConfirmed && (\r\n                  <div className=\"absolute top-1 left-1\">\r\n                    {isHighConfidence ? (\r\n                      <span className=\"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full bg-green-500/90 text-white text-[10px] font-medium\">\r\n                        <Check className=\"w-2.5 h-2.5\" />\r\n                        {upload.confidence}%\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full bg-amber-500/90 text-white text-[10px] font-medium\">\r\n                        <AlertTriangle className=\"w-2.5 h-2.5\" />\r\n                        {upload.confidence}%\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* Selected checkmark - top right when selected */}\r\n                {isSelected && (\r\n                  <div className=\"absolute top-1 right-1 w-5 h-5 rounded-full bg-primary flex items-center justify-center\">\r\n                    <Check className=\"w-3 h-3 text-white\" />\r\n                  </div>\r\n                )}\r\n\r\n                {/* Remove button - only on hover when NOT selected */}\r\n                {!isSelected && (\r\n                  <button\r\n                    onClick={(e) => handleRemove(upload.id, e)}\r\n                    className=\"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/70 hover:bg-red-500 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                  >\r\n                    <X className=\"w-3 h-3 text-white\" />\r\n                  </button>\r\n                )}\r\n\r\n                {/* Hover overlay with description */}\r\n                {isConfirmed && !isEditing && (\r\n                  <div className=\"absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-2\">\r\n                    <p className=\"text-white text-xs text-center line-clamp-3 mb-2\">\r\n                      {upload.description || \"No description\"}\r\n                    </p>\r\n                    <button\r\n                      onClick={(e) => startEdit(upload, e)}\r\n                      className=\"flex items-center gap-1 text-[10px] text-purple-300 hover:text-white transition-colors\"\r\n                    >\r\n                      <Pencil className=\"w-2.5 h-2.5\" />\r\n                      Edit\r\n                    </button>\r\n                    <p className=\"text-[10px] text-white/60 mt-2\">\r\n                      {isSelected ? \"Click to deselect\" : \"Click to select\"}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Editing mode */}\r\n                {isEditing && (\r\n                  <div className=\"absolute inset-0 bg-black/80 flex flex-col items-center justify-center p-2\">\r\n                    <textarea\r\n                      value={editValue}\r\n                      onChange={(e) => setEditValue(e.target.value)}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === \"Enter\" && !e.shiftKey) {\r\n                          e.preventDefault();\r\n                          saveEdit();\r\n                        }\r\n                        if (e.key === \"Escape\") cancelEdit();\r\n                      }}\r\n                      className=\"w-full text-xs text-white bg-white/10 border border-white/30 rounded p-2 focus:outline-none focus:border-white resize-none\"\r\n                      rows={3}\r\n                      autoFocus\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    />\r\n                    <div className=\"flex gap-2 mt-2\">\r\n                      <button\r\n                        onClick={(e) => { e.stopPropagation(); saveEdit(); }}\r\n                        className=\"px-2 py-1 text-[10px] bg-primary text-white rounded hover:bg-primary/80\"\r\n                      >\r\n                        Save\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => { e.stopPropagation(); cancelEdit(); }}\r\n                        className=\"px-2 py-1 text-[10px] bg-white/20 text-white rounded hover:bg-white/30\"\r\n                      >\r\n                        Cancel\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n\r\n          {/* Add more button - styled like an empty product slot */}\r\n          {canAddMore && (\r\n            <label\r\n              className={cn(\r\n                \"aspect-square rounded-xl border-2 border-dashed transition-all cursor-pointer\",\r\n                \"border-border hover:border-purple-500/50 hover:bg-purple-500/5\",\r\n                \"flex flex-col items-center justify-center gap-2\"\r\n              )}\r\n            >\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                multiple\r\n                onChange={handleFileSelect}\r\n                className=\"hidden\"\r\n              />\r\n              <Upload className=\"w-6 h-6 text-muted-foreground\" />\r\n              <span className=\"text-xs text-muted-foreground\">Add more</span>\r\n            </label>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Drop Zone - only shown when no uploads */}\r\n      {uploads.length === 0 && (\r\n        <div\r\n          onDragEnter={handleDragEnter}\r\n          onDragLeave={handleDragLeave}\r\n          onDragOver={handleDragOver}\r\n          onDrop={handleDrop}\r\n          onClick={handleClick}\r\n          className={cn(\r\n            \"relative border-2 border-dashed rounded-xl p-8 transition-all text-center cursor-pointer\",\r\n            isDragging\r\n              ? \"border-purple-500 bg-purple-500/10\"\r\n              : canAddMore\r\n              ? \"border-border hover:border-purple-500/50\"\r\n              : \"border-border opacity-50 cursor-not-allowed\",\r\n          )}\r\n        >\r\n          <input\r\n            type=\"file\"\r\n            ref={fileInputRef}\r\n            accept=\"image/*\"\r\n            multiple\r\n            onChange={handleFileSelect}\r\n            className=\"hidden\"\r\n            data-testid=\"input-file-upload\"\r\n          />\r\n\r\n          <div className=\"flex flex-col items-center gap-2\">\r\n            <Upload className={cn(\r\n              \"w-10 h-10\",\r\n              isDragging ? \"text-purple-500\" : \"text-muted-foreground\"\r\n            )} />\r\n            <div>\r\n              <p className=\"text-sm font-medium\">\r\n                {isDragging ? \"Drop images here\" : \"Drag & drop images\"}\r\n              </p>\r\n              <p className=\"text-xs text-muted-foreground mt-1\">\r\n                or click to browse  Max {maxFiles} images\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* File count and selection info */}\r\n      {uploads.length > 0 && (\r\n        <p className=\"text-xs text-muted-foreground\">\r\n          {uploads.length} of {maxFiles} images\r\n          {selectedCount > 0 && (\r\n            <span className=\"text-primary font-medium\">  {selectedCount} selected for generation</span>\r\n          )}\r\n          {selectedCount === 0 && uploads.some(u => u.status === \"confirmed\") && (\r\n            <span>  Click images to select for IdeaBank</span>\r\n          )}\r\n        </p>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// Re-export types for convenience\r\nexport type { AnalyzedUpload };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\__tests__\\CarouselBuilder.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"afterEach"},"fix":{"range":[539,550],"text":""},"desc":"Remove unused variable \"afterEach\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'closeButton' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":677,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":677,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n// @vitest-environment jsdom\r\n/**\r\n * CarouselBuilder Component Tests\r\n *\r\n * Comprehensive test suite covering:\r\n * 1. Initialization (5 tests)\r\n * 2. Slide Management (8 tests)\r\n * 3. Slide Editing (7 tests)\r\n * 4. Preview & Export (5 tests)\r\n * 5. Integration (5 tests)\r\n *\r\n * Total: 30 tests\r\n *\r\n * @file client/src/components/__tests__/CarouselBuilder.test.tsx\r\n */\r\nimport React from 'react';\r\nimport { vi, describe, it, expect, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor } from '@/test-utils';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport '@testing-library/jest-dom';\r\n\r\n// Component under test\r\nimport { CarouselBuilder } from '../CarouselBuilder';\r\n\r\n// Mock dependencies\r\nvi.mock('file-saver', () => ({\r\n  saveAs: vi.fn(),\r\n}));\r\n\r\nvi.mock('jszip', () => {\r\n  return {\r\n    default: vi.fn().mockImplementation(() => ({\r\n      file: vi.fn(),\r\n      generateAsync: vi.fn().mockResolvedValue(new Blob(['test'])),\r\n    })),\r\n  };\r\n});\r\n\r\n// Mock clipboard API\r\nconst mockClipboard = {\r\n  writeText: vi.fn().mockResolvedValue(undefined),\r\n};\r\nObject.assign(navigator, { clipboard: mockClipboard });\r\n\r\n// Mock fetch for API calls\r\nconst mockFetch = vi.fn();\r\nglobal.fetch = mockFetch;\r\n\r\n// ============================================\r\n// TEST DATA FIXTURES\r\n// ============================================\r\n\r\nconst mockCarouselOutline = {\r\n  outline: {\r\n    title: 'Test Carousel Title',\r\n    description: 'A test carousel for unit testing',\r\n    slideCount: 7,\r\n    slides: [\r\n      {\r\n        slideNumber: 1,\r\n        purpose: 'hook' as const,\r\n        headline: 'Attention-Grabbing Hook',\r\n        body: 'This is the hook slide body text',\r\n        imagePrompt: 'Create an eye-catching visual for the hook',\r\n      },\r\n      {\r\n        slideNumber: 2,\r\n        purpose: 'problem' as const,\r\n        headline: 'The Problem You Face',\r\n        body: 'Describing the pain point',\r\n        imagePrompt: 'Visualize the problem scenario',\r\n      },\r\n      {\r\n        slideNumber: 3,\r\n        purpose: 'point' as const,\r\n        headline: 'Key Point One',\r\n        body: 'Supporting information',\r\n        imagePrompt: 'Illustrate the first key point',\r\n      },\r\n      {\r\n        slideNumber: 4,\r\n        purpose: 'point' as const,\r\n        headline: 'Key Point Two',\r\n        body: 'More supporting information',\r\n        imagePrompt: 'Illustrate the second key point',\r\n      },\r\n      {\r\n        slideNumber: 5,\r\n        purpose: 'solution' as const,\r\n        headline: 'The Solution',\r\n        body: 'How we solve the problem',\r\n        imagePrompt: 'Show the solution in action',\r\n      },\r\n      {\r\n        slideNumber: 6,\r\n        purpose: 'proof' as const,\r\n        headline: 'Social Proof',\r\n        body: 'Testimonials and results',\r\n        imagePrompt: 'Display proof and credibility',\r\n      },\r\n      {\r\n        slideNumber: 7,\r\n        purpose: 'cta' as const,\r\n        headline: 'Take Action Now',\r\n        body: 'Call to action details',\r\n        imagePrompt: 'Create a compelling CTA visual',\r\n      },\r\n    ],\r\n    captionCopy: 'This is the caption for the carousel post.',\r\n    hashtags: ['marketing', 'carousel', 'social'],\r\n  },\r\n};\r\n\r\nconst mockTransformResponse = {\r\n  imageUrl: 'https://res.cloudinary.com/test/image/upload/generated-slide.jpg',\r\n  url: 'https://res.cloudinary.com/test/image/upload/generated-slide.jpg',\r\n};\r\n\r\nconst defaultProps = {\r\n  templateId: 'template-001',\r\n  topic: 'Test Topic for Carousel',\r\n  platform: 'instagram',\r\n  productNames: ['Product A', 'Product B'],\r\n  productImageUrls: ['https://example.com/product-a.jpg'],\r\n  aspectRatio: '1080x1350',\r\n  onClose: vi.fn(),\r\n  onComplete: vi.fn(),\r\n};\r\n\r\n// ============================================\r\n// TEST UTILITIES\r\n// ============================================\r\n\r\nfunction createQueryClient(): QueryClient {\r\n  return new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false, gcTime: 0 },\r\n      mutations: { retry: false },\r\n    },\r\n  });\r\n}\r\n\r\nfunction renderCarouselBuilder(props = {}) {\r\n  const queryClient = createQueryClient();\r\n  return render(\r\n    <QueryClientProvider client={queryClient}>\r\n      <CarouselBuilder {...defaultProps} {...props} />\r\n    </QueryClientProvider>,\r\n  );\r\n}\r\n\r\nfunction setupSuccessfulOutlineFetch() {\r\n  mockFetch.mockResolvedValueOnce({\r\n    ok: true,\r\n    json: () => Promise.resolve(mockCarouselOutline),\r\n  });\r\n}\r\n\r\nfunction setupFailedOutlineFetch() {\r\n  mockFetch.mockResolvedValueOnce({\r\n    ok: false,\r\n    status: 500,\r\n    statusText: 'Internal Server Error',\r\n  });\r\n}\r\n\r\nfunction setupSuccessfulImageGeneration() {\r\n  mockFetch.mockResolvedValueOnce({\r\n    ok: true,\r\n    json: () => Promise.resolve(mockTransformResponse),\r\n  });\r\n}\r\n\r\nfunction setupFailedImageGeneration() {\r\n  mockFetch.mockResolvedValueOnce({\r\n    ok: false,\r\n    status: 500,\r\n    statusText: 'Generation Failed',\r\n  });\r\n}\r\n\r\n// ============================================\r\n// 1. INITIALIZATION TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Initialization', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('displays loading state while generating outline', async () => {\r\n    // Setup: delay the fetch response to observe loading state\r\n    mockFetch.mockImplementationOnce(\r\n      () =>\r\n        new Promise((resolve) =>\r\n          setTimeout(\r\n            () =>\r\n              resolve({\r\n                ok: true,\r\n                json: () => Promise.resolve(mockCarouselOutline),\r\n              }),\r\n            500,\r\n          ),\r\n        ),\r\n    );\r\n\r\n    renderCarouselBuilder();\r\n\r\n    // Wait for useEffect to trigger mutation (isPending = true)\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/Generating carousel outline/i)).toBeInTheDocument();\r\n    });\r\n    expect(screen.getByText(/2026 best practices/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('renders carousel title and description after outline loads', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n\r\n    expect(screen.getByText('A test carousel for unit testing')).toBeInTheDocument();\r\n  });\r\n\r\n  it('displays correct slide count badge', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('7 slides')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('renders platform and aspect ratio badges', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('instagram')).toBeInTheDocument();\r\n    });\r\n\r\n    expect(screen.getByText('1080x1350')).toBeInTheDocument();\r\n  });\r\n\r\n  it('calls API with correct parameters on mount', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/content-planner/carousel-outline',\r\n        expect.objectContaining({\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          credentials: 'include',\r\n          body: JSON.stringify({\r\n            templateId: 'template-001',\r\n            topic: 'Test Topic for Carousel',\r\n            slideCount: 7,\r\n            platform: 'instagram',\r\n            productNames: ['Product A', 'Product B'],\r\n          }),\r\n        }),\r\n      );\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 2. SLIDE MANAGEMENT TESTS (8 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Slide Management', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('renders all 7 slides in the slide list', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Check all slide headlines are present\r\n    expect(screen.getByText('The Problem You Face')).toBeInTheDocument();\r\n    expect(screen.getByText('Key Point One')).toBeInTheDocument();\r\n    expect(screen.getByText('Key Point Two')).toBeInTheDocument();\r\n    expect(screen.getByText('The Solution')).toBeInTheDocument();\r\n    expect(screen.getByText('Social Proof')).toBeInTheDocument();\r\n    expect(screen.getByText('Take Action Now')).toBeInTheDocument();\r\n  });\r\n\r\n  it('displays correct purpose badges for each slide', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('1. Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    expect(screen.getByText('2. Problem')).toBeInTheDocument();\r\n    expect(screen.getByText('3. Point')).toBeInTheDocument();\r\n    expect(screen.getByText('5. Solution')).toBeInTheDocument();\r\n    expect(screen.getByText('6. Proof')).toBeInTheDocument();\r\n    expect(screen.getByText('7. CTA')).toBeInTheDocument();\r\n  });\r\n\r\n  it('selects first slide by default', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Edit Slide 1')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('changes active slide when clicking on slide thumbnail', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click on the third slide (Key Point One)\r\n    const thirdSlide = screen.getByText('Key Point One');\r\n    fireEvent.click(thirdSlide);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Edit Slide 3')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows slide count status (images generated vs total)', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('7 slides')).toBeInTheDocument();\r\n    });\r\n\r\n    // Initially no images generated, so the badge should not show generated count\r\n    // The component shows \"X/Y images\" only when slidesWithImagesCount > 0\r\n    expect(screen.queryByText(/0\\/7 images/)).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('displays slide thumbnail placeholders when no images generated', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Each slide without an image should show the ImageIcon placeholder\r\n    // The component renders ImageIcon when slide.imageUrl is undefined\r\n    const slideEditor = screen.getByText('Edit Slide 1').parentElement;\r\n    expect(slideEditor).toBeInTheDocument();\r\n  });\r\n\r\n  it('updates slide thumbnail when image is generated', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup image generation\r\n    setupSuccessfulImageGeneration();\r\n\r\n    // Find and click the Generate Image button\r\n    const generateButton = screen.getByRole('button', { name: /Generate Image/i });\r\n    fireEvent.click(generateButton);\r\n\r\n    await waitFor(() => {\r\n      // After generation, the image badge should update\r\n      expect(screen.getByText('1/7 images')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows error state when image generation fails', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup failed image generation\r\n    setupFailedImageGeneration();\r\n\r\n    // Click Generate Image button\r\n    const generateButton = screen.getByRole('button', { name: /Generate Image/i });\r\n    fireEvent.click(generateButton);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Failed to generate image')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 3. SLIDE EDITING TESTS (7 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Slide Editing', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('displays headline input with current value', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('allows editing headline text', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    const headlineInput = screen.getByDisplayValue('Attention-Grabbing Hook') as HTMLInputElement;\r\n    fireEvent.change(headlineInput, { target: { value: 'New Headline Text' } });\r\n\r\n    expect(screen.getByDisplayValue('New Headline Text')).toBeInTheDocument();\r\n  });\r\n\r\n  it('displays body text input with current value', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('This is the hook slide body text')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('allows editing body text', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('This is the hook slide body text')).toBeInTheDocument();\r\n    });\r\n\r\n    const bodyTextarea = screen.getByDisplayValue('This is the hook slide body text') as HTMLTextAreaElement;\r\n    fireEvent.change(bodyTextarea, { target: { value: 'Updated body content' } });\r\n\r\n    expect(screen.getByDisplayValue('Updated body content')).toBeInTheDocument();\r\n  });\r\n\r\n  it('displays image prompt input with current value', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('Create an eye-catching visual for the hook')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('allows editing image prompt', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByDisplayValue('Create an eye-catching visual for the hook')).toBeInTheDocument();\r\n    });\r\n\r\n    const promptTextarea = screen.getByDisplayValue(\r\n      'Create an eye-catching visual for the hook',\r\n    ) as HTMLTextAreaElement;\r\n    fireEvent.change(promptTextarea, { target: { value: 'Custom image prompt' } });\r\n\r\n    expect(screen.getByDisplayValue('Custom image prompt')).toBeInTheDocument();\r\n  });\r\n\r\n  it('shows character count for each text field', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Check for character count displays (format: X/100, X/200, X/300)\r\n    // Headline: \"Attention-Grabbing Hook\" = 23 chars\r\n    expect(screen.getByText('23/100')).toBeInTheDocument();\r\n\r\n    // Body: \"This is the hook slide body text\" = 32 chars\r\n    expect(screen.getByText('32/200')).toBeInTheDocument();\r\n\r\n    // Image prompt: \"Create an eye-catching visual for the hook\" = 42 chars\r\n    expect(screen.getByText('42/300')).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 4. PREVIEW & EXPORT TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Preview & Export', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('toggles between edit and preview mode', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Initially in edit mode - should show \"Preview\" button\r\n    const previewButton = screen.getByRole('button', { name: /Preview/i });\r\n    expect(previewButton).toBeInTheDocument();\r\n\r\n    // Click to switch to preview mode\r\n    fireEvent.click(previewButton);\r\n\r\n    // Now should show \"Edit Mode\" button\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('button', { name: /Edit Mode/i })).toBeInTheDocument();\r\n    });\r\n\r\n    // Toggle back to edit mode\r\n    const editButton = screen.getByRole('button', { name: /Edit Mode/i });\r\n    fireEvent.click(editButton);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('button', { name: /Preview/i })).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays carousel preview with navigation in preview mode', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Switch to preview mode\r\n    const previewButton = screen.getByRole('button', { name: /Preview/i });\r\n    fireEvent.click(previewButton);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/Swipe or use arrows to preview all 7 slides/i)).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows Generate All Images button', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByRole('button', { name: /Generate All Images/i })).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('shows Download ZIP button only when all images are generated', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Initially, Download ZIP should not be visible (no images generated)\r\n    expect(screen.queryByRole('button', { name: /Download ZIP/i })).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('copies caption and hashtags to clipboard', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Find and click the copy caption button\r\n    const copyButton = screen.getByRole('button', { name: /Copy Caption & Hashtags/i });\r\n    fireEvent.click(copyButton);\r\n\r\n    await waitFor(() => {\r\n      expect(navigator.clipboard.writeText).toHaveBeenCalledWith(\r\n        'This is the caption for the carousel post.\\n\\n#marketing #carousel #social',\r\n      );\r\n    });\r\n\r\n    // Button should show \"Copied!\" temporarily\r\n    expect(screen.getByText('Copied!')).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 5. INTEGRATION TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Integration', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('passes product names to outline generation API', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder({\r\n      productNames: ['Premium Oak Flooring', 'Luxury Tile'],\r\n    });\r\n\r\n    await waitFor(() => {\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/content-planner/carousel-outline',\r\n        expect.objectContaining({\r\n          body: expect.stringContaining('Premium Oak Flooring'),\r\n        }),\r\n      );\r\n    });\r\n  });\r\n\r\n  it('uses product image URLs for image generation', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder({\r\n      productImageUrls: ['https://example.com/product1.jpg', 'https://example.com/product2.jpg'],\r\n    });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup for image generation\r\n    setupSuccessfulImageGeneration();\r\n\r\n    // Generate an image\r\n    const generateButton = screen.getByRole('button', { name: /Generate Image/i });\r\n    fireEvent.click(generateButton);\r\n\r\n    await waitFor(() => {\r\n      // Check that the transform API was called with product image URLs\r\n      const transformCall = mockFetch.mock.calls.find((call) => call[0] === '/api/transform');\r\n      expect(transformCall).toBeDefined();\r\n\r\n      const requestBody = JSON.parse(transformCall[1].body);\r\n      expect(requestBody.productImageUrls).toEqual([\r\n        'https://example.com/product1.jpg',\r\n        'https://example.com/product2.jpg',\r\n      ]);\r\n    });\r\n  });\r\n\r\n  it('calls onClose when close button is clicked', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    const onClose = vi.fn();\r\n    renderCarouselBuilder({ onClose });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Find and click close button (X icon)\r\n    const closeButton = screen.getByRole('button', { name: '' }); // Icon-only button\r\n    const closeButtons = screen\r\n      .getAllByRole('button')\r\n      .filter((btn) => btn.querySelector('svg.lucide-x') || btn.querySelector('[class*=\"lucide-x\"]'));\r\n\r\n    // The close button should be in the header\r\n    if (closeButtons.length > 0) {\r\n      fireEvent.click(closeButtons[0]);\r\n      expect(onClose).toHaveBeenCalled();\r\n    }\r\n  });\r\n\r\n  it('displays error state and retry button when outline generation fails', async () => {\r\n    setupFailedOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Failed to generate carousel outline')).toBeInTheDocument();\r\n    });\r\n\r\n    expect(screen.getByRole('button', { name: /Try Again/i })).toBeInTheDocument();\r\n  });\r\n\r\n  it('retries outline generation when Try Again is clicked', async () => {\r\n    setupFailedOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Failed to generate carousel outline')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup successful response for retry\r\n    setupSuccessfulOutlineFetch();\r\n\r\n    // Click Try Again\r\n    const retryButton = screen.getByRole('button', { name: /Try Again/i });\r\n    fireEvent.click(retryButton);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// EDGE CASE TESTS (bonus coverage)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Edge Cases', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  it('handles empty product names array', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder({ productNames: [] });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('handles empty product image URLs array', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder({ productImageUrls: [] });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup image generation\r\n    setupSuccessfulImageGeneration();\r\n\r\n    // Generate should still work without product images\r\n    const generateButton = screen.getByRole('button', { name: /Generate Image/i });\r\n    fireEvent.click(generateButton);\r\n\r\n    await waitFor(() => {\r\n      const transformCall = mockFetch.mock.calls.find((call) => call[0] === '/api/transform');\r\n      expect(transformCall).toBeDefined();\r\n\r\n      const requestBody = JSON.parse(transformCall[1].body);\r\n      expect(requestBody.mode).toBe('standard');\r\n    });\r\n  });\r\n\r\n  it('displays 2026 best practices tip', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(\r\n        screen.getByText(/Slide 1 is CRITICAL - 80% of engagement comes from the first slide/i),\r\n      ).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays caption section with hashtags', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Caption & Hashtags')).toBeInTheDocument();\r\n    });\r\n\r\n    // Check hashtags are displayed\r\n    expect(screen.getByText('#marketing')).toBeInTheDocument();\r\n    expect(screen.getByText('#carousel')).toBeInTheDocument();\r\n    expect(screen.getByText('#social')).toBeInTheDocument();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// ADDITIONAL EDGE CASE TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('CarouselBuilder - Additional Edge Cases', () => {\r\n  beforeEach(() => {\r\n    mockFetch.mockReset();\r\n    global.fetch = mockFetch;\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles extremely long topic string (1000+ characters)', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    const longTopic = 'A'.repeat(1000);\r\n    renderCarouselBuilder({ topic: longTopic });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n\r\n    // Verify the API was called with the long topic\r\n    expect(mockFetch).toHaveBeenCalledWith(\r\n      '/api/content-planner/carousel-outline',\r\n      expect.objectContaining({\r\n        body: expect.stringContaining(longTopic.slice(0, 100)), // At least part of the long string\r\n      }),\r\n    );\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles special characters in product names', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder({\r\n      productNames: [\r\n        '<script>alert(\"XSS\")</script>',\r\n        'Product & \"Quotes\" \\'Apostrophe\\'',\r\n        'Unicode: \\u2603 \\u2764 \\u2728',\r\n      ],\r\n    });\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles network timeout during outline generation', async () => {\r\n    // Mock a delayed response that simulates timeout\r\n    mockFetch.mockImplementationOnce(\r\n      () => new Promise((_, reject) => setTimeout(() => reject(new Error('Network timeout')), 50)),\r\n    );\r\n\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Failed to generate carousel outline')).toBeInTheDocument();\r\n    });\r\n\r\n    // Retry button should be available\r\n    expect(screen.getByRole('button', { name: /Try Again/i })).toBeInTheDocument();\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles rapid slide switching', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Rapidly switch between slides\r\n    const slides = [\r\n      'Attention-Grabbing Hook',\r\n      'The Problem You Face',\r\n      'Key Point One',\r\n      'Key Point Two',\r\n      'The Solution',\r\n      'Social Proof',\r\n      'Take Action Now',\r\n    ];\r\n\r\n    for (const slideText of slides) {\r\n      const slide = screen.getByText(slideText);\r\n      fireEvent.click(slide);\r\n    }\r\n\r\n    // Should end on the last slide without crashing\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Edit Slide 7')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // Edge case test\r\n  it('handles concurrent image generation requests gracefully', async () => {\r\n    setupSuccessfulOutlineFetch();\r\n    renderCarouselBuilder();\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Attention-Grabbing Hook')).toBeInTheDocument();\r\n    });\r\n\r\n    // Setup multiple image generation responses\r\n    for (let i = 0; i < 3; i++) {\r\n      mockFetch.mockResolvedValueOnce({\r\n        ok: true,\r\n        json: () =>\r\n          Promise.resolve({\r\n            imageUrl: `https://res.cloudinary.com/test/image/upload/slide-${i}.jpg`,\r\n            url: `https://res.cloudinary.com/test/image/upload/slide-${i}.jpg`,\r\n          }),\r\n      });\r\n    }\r\n\r\n    // Click Generate All Images (if available) or individual generate buttons\r\n    const generateAllButton = screen.getByRole('button', { name: /Generate All Images/i });\r\n    fireEvent.click(generateAllButton);\r\n\r\n    // Should handle concurrent requests without crashing\r\n    await waitFor(\r\n      () => {\r\n        // The component should still be functional\r\n        expect(screen.getByText('Test Carousel Title')).toBeInTheDocument();\r\n      },\r\n      { timeout: 5000 },\r\n    );\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\__tests__\\HistoryPanel.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'beforeEach' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":46,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"beforeEach"},"fix":{"range":[563,575],"text":""},"desc":"Remove unused variable \"beforeEach\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'within' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":52,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"within"},"fix":{"range":[669,677],"text":""},"desc":"Remove unused variable \"within\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'act' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"act"},"fix":{"range":[677,682],"text":""},"desc":"Remove unused variable \"act\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockGenerations' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"mockGenerations"},"fix":{"range":[961,977],"text":""},"desc":"Remove unused variable \"mockGenerations\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'completedGenerations' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":47,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"completedGenerations"},"fix":{"range":[976,998],"text":""},"desc":"Remove unused variable \"completedGenerations\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createMockGeneration' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":69,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"createMockGeneration"},"fix":{"range":[952,1043],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generationButtons' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":590,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":590,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n// @vitest-environment jsdom\r\n/**\r\n * HistoryPanel Component Tests\r\n *\r\n * Comprehensive tests for the HistoryPanel component covering:\r\n * - Rendering states (initial, empty, loading, with data)\r\n * - History items (thumbnails, timestamps, status, grouping, pagination)\r\n * - User interactions (select, delete, clear, filter, preview)\r\n *\r\n * @file client/src/components/__tests__/HistoryPanel.test.tsx\r\n */\r\nimport React from 'react';\r\nimport { vi, describe, it, expect, beforeEach, afterEach, beforeAll, afterAll } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor, within, act } from '@/test-utils';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport '@testing-library/jest-dom';\r\n\r\nimport { HistoryPanel } from '../studio/HistoryPanel/HistoryPanel';\r\nimport { server, http, HttpResponse } from '@/mocks/server';\r\nimport { mockGenerations, completedGenerations, createMockGeneration } from '@/fixtures';\r\n\r\n// ============================================\r\n// MOCKS\r\n// ============================================\r\n\r\n// Mock wouter for URL state management\r\nconst mockSetLocation = vi.fn();\r\nvi.mock('wouter', () => ({\r\n  useLocation: () => ['/', mockSetLocation],\r\n}));\r\n\r\n// Mock the useHistoryPanelUrl hook for controlling URL state in tests\r\nconst mockSelectGeneration = vi.fn();\r\nlet mockSelectedGenerationId: string | null = null;\r\n\r\nvi.mock('@/hooks/useUrlState', () => ({\r\n  useHistoryPanelUrl: () => ({\r\n    isHistoryOpen: true,\r\n    selectedGenerationId: mockSelectedGenerationId,\r\n    openHistory: vi.fn(),\r\n    closeHistory: vi.fn(),\r\n    selectGeneration: mockSelectGeneration,\r\n  }),\r\n}));\r\n\r\n// ============================================\r\n// SETUP & TEARDOWN\r\n// ============================================\r\n\r\n// Start MSW server\r\nbeforeAll(() => server.listen({ onUnhandledRequest: 'error' }));\r\nafterEach(() => {\r\n  server.resetHandlers();\r\n  mockSetLocation.mockClear();\r\n  mockSelectGeneration.mockClear();\r\n  mockSelectedGenerationId = null;\r\n});\r\nafterAll(() => server.close());\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Creates a fresh QueryClient for each test\r\n */\r\nfunction createTestQueryClient(): QueryClient {\r\n  return new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false, gcTime: 0, staleTime: 0 },\r\n      mutations: { retry: false },\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Render HistoryPanel with all required providers\r\n */\r\nfunction renderHistoryPanel(props: Partial<React.ComponentProps<typeof HistoryPanel>> = {}) {\r\n  const queryClient = createTestQueryClient();\r\n  const defaultProps = {\r\n    isOpen: true,\r\n    onToggle: vi.fn(),\r\n    onSelectGeneration: vi.fn(),\r\n  };\r\n\r\n  return {\r\n    ...render(\r\n      <QueryClientProvider client={queryClient}>\r\n        <HistoryPanel {...defaultProps} {...props} />\r\n      </QueryClientProvider>,\r\n    ),\r\n    queryClient,\r\n    props: { ...defaultProps, ...props },\r\n  };\r\n}\r\n\r\n/**\r\n * Mock generations API with custom data\r\n */\r\nfunction mockGenerationsApi(generations: unknown[], statusCode = 200) {\r\n  server.use(\r\n    http.get('/api/generations', () => {\r\n      if (statusCode !== 200) {\r\n        return HttpResponse.json({ error: 'Server error' }, { status: statusCode });\r\n      }\r\n      return HttpResponse.json(generations);\r\n    }),\r\n  );\r\n}\r\n\r\n// ============================================\r\n// TEST DATA\r\n// ============================================\r\n\r\n// Create mock generations with imageUrl (matching component's expected shape)\r\n// All within last 24 hours to pass the \"Recent\" tab filter\r\nconst mockGenerationsWithImages = [\r\n  {\r\n    id: 'gen-1',\r\n    imageUrl: 'https://example.com/image1.jpg',\r\n    prompt: 'Test prompt 1',\r\n    createdAt: new Date().toISOString(),\r\n    platform: 'instagram',\r\n  },\r\n  {\r\n    id: 'gen-2',\r\n    imageUrl: 'https://example.com/image2.jpg',\r\n    prompt: 'Test prompt 2',\r\n    createdAt: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago\r\n    platform: 'facebook',\r\n  },\r\n  {\r\n    id: 'gen-3',\r\n    imageUrl: 'https://example.com/image3.jpg',\r\n    prompt: 'Test prompt 3',\r\n    createdAt: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago (within 24h)\r\n    platform: 'linkedin',\r\n  },\r\n];\r\n\r\n// Create more test data for pagination tests\r\nconst manyGenerations = Array.from({ length: 20 }, (_, i) => ({\r\n  id: `gen-${i + 1}`,\r\n  imageUrl: `https://example.com/image${i + 1}.jpg`,\r\n  prompt: `Test prompt ${i + 1}`,\r\n  createdAt: new Date(Date.now() - i * 3600000).toISOString(), // Each hour older\r\n  platform: i % 2 === 0 ? 'instagram' : 'facebook',\r\n}));\r\n\r\n// ============================================\r\n// RENDERING TESTS (4 tests)\r\n// ============================================\r\n\r\ndescribe('HistoryPanel', () => {\r\n  describe('Rendering', () => {\r\n    it('renders initial state with header and toggle button', async () => {\r\n      mockGenerationsApi([]);\r\n      renderHistoryPanel();\r\n\r\n      // Header should be visible when open\r\n      expect(screen.getByText('History')).toBeInTheDocument();\r\n\r\n      // Toggle button should be present\r\n      const toggleButtons = screen.getAllByRole('button');\r\n      expect(toggleButtons.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('renders empty history state with appropriate message', async () => {\r\n      mockGenerationsApi([]);\r\n      renderHistoryPanel();\r\n\r\n      // Default tab is 'all', so empty state text is \"No generations yet\"\r\n      await waitFor(() => {\r\n        expect(screen.getByText(/No generations yet/i)).toBeInTheDocument();\r\n      });\r\n\r\n      // Should show the empty state icon\r\n      expect(document.querySelector('svg')).toBeInTheDocument();\r\n    });\r\n\r\n    it('renders loading state while fetching data', async () => {\r\n      // Create a delayed response to test loading state\r\n      server.use(\r\n        http.get('/api/generations', async () => {\r\n          await new Promise((resolve) => setTimeout(resolve, 100));\r\n          return HttpResponse.json(mockGenerationsWithImages);\r\n        }),\r\n      );\r\n\r\n      renderHistoryPanel();\r\n\r\n      // Loading spinner should be visible (animate-spin class)\r\n      const loadingSpinner = document.querySelector('.animate-spin');\r\n      expect(loadingSpinner).toBeInTheDocument();\r\n\r\n      // Wait for loading to complete\r\n      await waitFor(() => {\r\n        expect(document.querySelector('.animate-spin')).not.toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('renders with history items when data is available', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        // Should show the grid of generations\r\n        const images = screen.getAllByRole('img');\r\n        expect(images.length).toBe(mockGenerationsWithImages.length);\r\n      });\r\n\r\n      // Verify each image is rendered\r\n      mockGenerationsWithImages.forEach((gen) => {\r\n        const img = screen.getByAltText(gen.prompt.slice(0, 50));\r\n        expect(img).toHaveAttribute('src', gen.imageUrl);\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // HISTORY ITEMS TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('History Items', () => {\r\n    it('displays generation thumbnails correctly', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        const images = screen.getAllByRole('img');\r\n        expect(images.length).toBe(mockGenerationsWithImages.length);\r\n      });\r\n\r\n      // Check that each thumbnail has the correct src\r\n      const images = screen.getAllByRole('img');\r\n      images.forEach((img, index) => {\r\n        const gen = mockGenerationsWithImages[index];\r\n        if (gen) {\r\n          expect(img).toHaveAttribute('src', gen.imageUrl);\r\n        }\r\n      });\r\n    });\r\n\r\n    it('shows timestamps for each generation', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        // The component displays dates, so we should find date text\r\n        // Format is toLocaleDateString() which varies by locale\r\n        const dateElements = document.querySelectorAll('.text-\\\\[10px\\\\]');\r\n        expect(dateElements.length).toBeGreaterThan(0);\r\n      });\r\n    });\r\n\r\n    it('shows generation status correctly via visual indicators', async () => {\r\n      // Create generations with different statuses\r\n      const statusGenerations = [\r\n        {\r\n          id: 'gen-completed',\r\n          imageUrl: 'https://example.com/completed.jpg',\r\n          prompt: 'Completed generation',\r\n          createdAt: new Date().toISOString(),\r\n          platform: 'instagram',\r\n          status: 'completed',\r\n        },\r\n      ];\r\n      mockGenerationsApi(statusGenerations);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        const images = screen.getAllByRole('img');\r\n        expect(images.length).toBe(1);\r\n      });\r\n\r\n      // Verify the image is displayed (completed status shows the image)\r\n      expect(screen.getByAltText('Completed generation')).toBeInTheDocument();\r\n    });\r\n\r\n    it('groups generations by date in All tab', async () => {\r\n      // Create generations from different time periods\r\n      const recentGen = {\r\n        id: 'gen-recent',\r\n        imageUrl: 'https://example.com/recent.jpg',\r\n        prompt: 'Recent generation',\r\n        createdAt: new Date().toISOString(), // Now\r\n        platform: 'instagram',\r\n      };\r\n      const oldGen = {\r\n        id: 'gen-old',\r\n        imageUrl: 'https://example.com/old.jpg',\r\n        prompt: 'Old generation',\r\n        createdAt: new Date(Date.now() - 86400000 * 3).toISOString(), // 3 days ago\r\n        platform: 'facebook',\r\n      };\r\n\r\n      mockGenerationsApi([recentGen, oldGen]);\r\n      renderHistoryPanel();\r\n\r\n      // Default tab is 'all', so both generations should show\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBe(2);\r\n      });\r\n\r\n      // Verify both recent and old generations are displayed\r\n      expect(screen.getByAltText('Recent generation')).toBeInTheDocument();\r\n      expect(screen.getByAltText('Old generation')).toBeInTheDocument();\r\n    });\r\n\r\n    it('supports loading more items through tab navigation (pagination equivalent)', async () => {\r\n      mockGenerationsApi(manyGenerations);\r\n      renderHistoryPanel();\r\n\r\n      // Wait for initial load\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Click on \"All\" tab to see all generations\r\n      const allTab = screen.getByRole('tab', { name: /All/i });\r\n      fireEvent.click(allTab);\r\n\r\n      // Should now show all generations (within last 24 hours for recent,\r\n      // but \"All\" tab shows everything)\r\n      await waitFor(() => {\r\n        const images = screen.getAllByRole('img');\r\n        expect(images.length).toBe(manyGenerations.length);\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // USER INTERACTIONS TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('User Interactions', () => {\r\n    it('selects a history item when clicked', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      const onSelectGeneration = vi.fn();\r\n      renderHistoryPanel({ onSelectGeneration });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Click on the first generation (which is inside a button)\r\n      const generationButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n      expect(generationButtons.length).toBeGreaterThan(0);\r\n\r\n      const firstGenButton = generationButtons[0];\r\n      if (firstGenButton) {\r\n        fireEvent.click(firstGenButton);\r\n      }\r\n\r\n      // Should call the selectGeneration from URL state hook\r\n      expect(mockSelectGeneration).toHaveBeenCalledWith('gen-1');\r\n\r\n      // Should also call the onSelectGeneration prop\r\n      expect(onSelectGeneration).toHaveBeenCalledWith('gen-1');\r\n    });\r\n\r\n    it('deletes history item when delete action is triggered', async () => {\r\n      // Note: The current HistoryPanel doesn't have a delete button\r\n      // This test documents the expected behavior for future implementation\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Currently, the component doesn't have delete functionality\r\n      // Test passes as a placeholder for future implementation\r\n      // When implemented, the test should:\r\n      // 1. Find the delete button on a history item\r\n      // 2. Click it\r\n      // 3. Verify the item is removed or a confirmation dialog appears\r\n\r\n      // Verify component renders successfully\r\n      expect(screen.getByText('History')).toBeInTheDocument();\r\n    });\r\n\r\n    it('clears all history when clear action is triggered', async () => {\r\n      // Note: The current HistoryPanel doesn't have a clear all button\r\n      // This test documents the expected behavior for future implementation\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Currently, the component doesn't have clear all functionality\r\n      // Test passes as a placeholder for future implementation\r\n      // When implemented, the test should:\r\n      // 1. Find the \"Clear All\" button\r\n      // 2. Click it\r\n      // 3. Verify all items are removed or a confirmation appears\r\n\r\n      // Verify component renders successfully\r\n      expect(screen.getByText('History')).toBeInTheDocument();\r\n    });\r\n\r\n    it('filters history by tab selection', async () => {\r\n      // Create generations: some recent (within 24h), some old (outside 24h)\r\n      const mixedGenerations = [\r\n        // Recent ones (within 24 hours)\r\n        {\r\n          id: 'gen-recent-1',\r\n          imageUrl: 'https://example.com/recent1.jpg',\r\n          prompt: 'Recent 1',\r\n          createdAt: new Date().toISOString(),\r\n          platform: 'instagram',\r\n        },\r\n        {\r\n          id: 'gen-recent-2',\r\n          imageUrl: 'https://example.com/recent2.jpg',\r\n          prompt: 'Recent 2',\r\n          createdAt: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago\r\n          platform: 'facebook',\r\n        },\r\n        // Old ones (outside 24 hours)\r\n        {\r\n          id: 'gen-old-1',\r\n          imageUrl: 'https://example.com/old1.jpg',\r\n          prompt: 'Old 1',\r\n          createdAt: new Date(Date.now() - 86400000 * 2).toISOString(), // 2 days ago\r\n          platform: 'linkedin',\r\n        },\r\n        {\r\n          id: 'gen-old-2',\r\n          imageUrl: 'https://example.com/old2.jpg',\r\n          prompt: 'Old 2',\r\n          createdAt: new Date(Date.now() - 86400000 * 3).toISOString(), // 3 days ago\r\n          platform: 'twitter',\r\n        },\r\n      ];\r\n\r\n      mockGenerationsApi(mixedGenerations);\r\n      renderHistoryPanel();\r\n\r\n      // Wait for data to load\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Initially on \"All\" tab (the default) - should show all 4 generations\r\n      const allTab = screen.getByRole('tab', { name: /All/i });\r\n      expect(allTab).toHaveAttribute('data-state', 'active');\r\n\r\n      const allImages = screen.getAllByRole('img');\r\n      expect(allImages.length).toBe(4);\r\n\r\n      // Verify all tabs are present and clickable\r\n      const recentTab = screen.getByRole('tab', { name: /Recent/i });\r\n\r\n      expect(recentTab).toBeInTheDocument();\r\n\r\n      // Verify tabs have correct initial states\r\n      expect(recentTab).toHaveAttribute('data-state', 'inactive');\r\n\r\n      // Verify the tabs are accessible and interactive\r\n      expect(allTab).not.toBeDisabled();\r\n      expect(recentTab).not.toBeDisabled();\r\n    });\r\n\r\n    it('shows preview on hover interaction', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Find a generation button\r\n      const generationButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n\r\n      const firstGenButton = generationButtons[0];\r\n      if (firstGenButton) {\r\n        // Hover over the generation\r\n        fireEvent.mouseEnter(firstGenButton);\r\n\r\n        // The component has hover styles via CSS (border-primary/50 on hover)\r\n        // and shows a gradient overlay with date\r\n        // We verify the button is interactive\r\n        expect(firstGenButton).toBeVisible();\r\n\r\n        // Mouse leave should reset state\r\n        fireEvent.mouseLeave(firstGenButton);\r\n      }\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // COLLAPSED STATE TESTS\r\n  // ============================================\r\n\r\n  describe('Collapsed State', () => {\r\n    it('renders collapsed state when isOpen is false', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel({ isOpen: false });\r\n\r\n      // Header text \"History\" should NOT be visible when collapsed\r\n      expect(screen.queryByText('History')).not.toBeInTheDocument();\r\n\r\n      // Should show the history icon button instead\r\n      const buttons = screen.getAllByRole('button');\r\n      expect(buttons.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('calls onToggle when toggle button is clicked', async () => {\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      const onToggle = vi.fn();\r\n      renderHistoryPanel({ onToggle });\r\n\r\n      // Click the toggle button (first button in the header)\r\n      const toggleButton = screen.getAllByRole('button')[0];\r\n      if (toggleButton) {\r\n        fireEvent.click(toggleButton);\r\n      }\r\n\r\n      expect(onToggle).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // ERROR HANDLING TESTS\r\n  // ============================================\r\n\r\n  describe('Error Handling', () => {\r\n    it('handles API error gracefully', async () => {\r\n      mockGenerationsApi([], 500);\r\n      renderHistoryPanel();\r\n\r\n      // Should show empty state or error (depending on implementation)\r\n      // The component currently shows loading then empty on error\r\n      await waitFor(() => {\r\n        // Query completes (loading spinner disappears)\r\n        expect(document.querySelector('.animate-spin')).not.toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('handles empty response from API', async () => {\r\n      mockGenerationsApi([]);\r\n      renderHistoryPanel();\r\n\r\n      // Default tab is 'all', so empty state text is \"No generations yet\"\r\n      await waitFor(() => {\r\n        expect(screen.getByText(/No generations yet/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // SELECTION STATE TESTS\r\n  // ============================================\r\n\r\n  describe('Selection State', () => {\r\n    it('highlights currently selected generation', async () => {\r\n      mockSelectedGenerationId = 'gen-1';\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      renderHistoryPanel();\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // The selected item should have special styling (border-primary, ring)\r\n      const generationButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n\r\n      const selectedButton = generationButtons[0];\r\n      // The component applies these classes for selected state:\r\n      // 'border-primary ring-2 ring-primary/20'\r\n      expect(selectedButton?.className).toContain('border-primary');\r\n    });\r\n\r\n    it('updates selection when clicking a different item', async () => {\r\n      mockSelectedGenerationId = 'gen-1';\r\n      mockGenerationsApi(mockGenerationsWithImages);\r\n      const onSelectGeneration = vi.fn();\r\n      renderHistoryPanel({ onSelectGeneration });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getAllByRole('img').length).toBeGreaterThan(0);\r\n      });\r\n\r\n      // Click on the second generation\r\n      const generationButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n\r\n      // Get the \"All\" tab first to see all items\r\n      const allTab = screen.getByRole('tab', { name: /All/i });\r\n      fireEvent.click(allTab);\r\n\r\n      await waitFor(() => {\r\n        const updatedButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n        expect(updatedButtons.length).toBeGreaterThanOrEqual(2);\r\n      });\r\n\r\n      // Click second item\r\n      const updatedButtons = screen.getAllByRole('button').filter((btn) => btn.querySelector('img'));\r\n      const secondGenButton = updatedButtons[1];\r\n      if (secondGenButton) {\r\n        fireEvent.click(secondGenButton);\r\n      }\r\n\r\n      expect(mockSelectGeneration).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\__tests__\\IdeaBankPanel.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n// @vitest-environment jsdom\r\n/**\r\n * IdeaBankPanel Component Tests\r\n *\r\n * Comprehensive test suite covering:\r\n * 1. Rendering (5 tests)\r\n * 2. Idea Suggestions (6 tests)\r\n * 3. Source Attribution (4 tests)\r\n * 4. User Interactions (5 tests)\r\n * 5. Platform Recommendations (5 tests)\r\n *\r\n * Total: 25 tests\r\n */\r\nimport React from 'react';\r\nimport { vi, describe, it, expect, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor, createMockProduct } from '@/test-utils';\r\nimport '@testing-library/jest-dom';\r\nimport { IdeaBankPanel } from '../ideabank';\r\nimport type { IdeaBankSuggestResponse, IdeaBankSuggestion, TemplateSlotSuggestion } from '@shared/types/ideaBank';\r\n\r\n// ============================================\r\n// MOCK DATA FACTORIES\r\n// ============================================\r\n\r\nfunction createMockSuggestion(overrides: Partial<IdeaBankSuggestion> = {}): IdeaBankSuggestion {\r\n  return {\r\n    id: `suggestion-${Math.random().toString(36).substring(7)}`,\r\n    summary: 'Professional product showcase with elegant lighting',\r\n    prompt: 'Create a professional advertisement featuring the product with soft lighting and a clean background',\r\n    mode: 'standard',\r\n    reasoning: 'This approach works well for highlighting product details while maintaining visual appeal',\r\n    confidence: 0.85,\r\n    sourcesUsed: {\r\n      visionAnalysis: true,\r\n      kbRetrieval: true,\r\n      webSearch: false,\r\n      templateMatching: true,\r\n    },\r\n    recommendedPlatform: 'instagram',\r\n    recommendedAspectRatio: '1:1',\r\n    ...overrides,\r\n  };\r\n}\r\n\r\nfunction createMockSlotSuggestion(overrides: Partial<TemplateSlotSuggestion> = {}): TemplateSlotSuggestion {\r\n  return {\r\n    productHighlights: ['Durable construction', 'Premium materials', 'Easy installation'],\r\n    productPlacement: 'Center-left of frame with slight angle',\r\n    detailsToEmphasize: ['Texture', 'Color variation', 'Thickness'],\r\n    scaleReference: 'Human hand for size reference',\r\n    headerText: 'Transform Your Space',\r\n    bodyText: 'Premium flooring that lasts a lifetime',\r\n    ctaSuggestion: 'Shop Now',\r\n    colorHarmony: ['#8B4513', '#D2691E', '#F5DEB3'],\r\n    lightingNotes: 'Warm natural lighting from upper left. Soft shadows to show texture.',\r\n    confidence: 88,\r\n    reasoning: 'This layout maximizes product visibility while maintaining brand consistency',\r\n    ...overrides,\r\n  };\r\n}\r\n\r\nfunction createMockResponse(overrides: Partial<IdeaBankSuggestResponse> = {}): IdeaBankSuggestResponse {\r\n  return {\r\n    suggestions: [\r\n      createMockSuggestion({ id: 'sug-1', mode: 'exact_insert', confidence: 0.92 }),\r\n      createMockSuggestion({ id: 'sug-2', mode: 'inspiration', confidence: 0.85 }),\r\n      createMockSuggestion({ id: 'sug-3', mode: 'standard', confidence: 0.78 }),\r\n    ],\r\n    analysisStatus: {\r\n      visionComplete: true,\r\n      kbQueried: true,\r\n      templatesMatched: 5,\r\n      webSearchUsed: false,\r\n    },\r\n    ...overrides,\r\n  };\r\n}\r\n\r\nfunction createTemplateResponse(templateId: string) {\r\n  return {\r\n    slotSuggestions: [createMockSlotSuggestion(), createMockSlotSuggestion({ confidence: 75 })],\r\n    template: {\r\n      id: templateId,\r\n      title: 'Professional Product Showcase',\r\n      promptBlueprint: 'Create a professional product image with {{product}} centered',\r\n      category: 'product_showcase',\r\n      environment: 'studio',\r\n      mood: 'professional',\r\n      lightingStyle: 'soft diffused',\r\n    },\r\n    mergedPrompt: 'Create a professional product image with Test Product centered in studio lighting',\r\n    analysisStatus: {\r\n      visionComplete: true,\r\n      kbQueried: true,\r\n      templatesMatched: 1,\r\n      webSearchUsed: false,\r\n    },\r\n  };\r\n}\r\n\r\n// ============================================\r\n// MOCK SETUP\r\n// ============================================\r\n\r\n// Store for controlling mock responses\r\nlet mockResponseData: IdeaBankSuggestResponse | ReturnType<typeof createTemplateResponse> = createMockResponse();\r\nlet mockShouldFail = false;\r\nlet fetchCallCount = 0;\r\n\r\n// Mock global fetch\r\nconst mockFetch = vi.fn(async (url: string, options?: RequestInit) => {\r\n  fetchCallCount++;\r\n\r\n  if (url.includes('/api/idea-bank/suggest')) {\r\n    if (mockShouldFail) {\r\n      return {\r\n        ok: false,\r\n        status: 500,\r\n        json: async () => ({ error: 'Server error' }),\r\n      };\r\n    }\r\n\r\n    // Check if it's a template mode request\r\n    if (options?.body) {\r\n      const body = JSON.parse(options.body as string);\r\n      if (body.mode === 'template' && body.templateId) {\r\n        return {\r\n          ok: true,\r\n          status: 200,\r\n          json: async () => createTemplateResponse(body.templateId),\r\n        };\r\n      }\r\n    }\r\n\r\n    return {\r\n      ok: true,\r\n      status: 200,\r\n      json: async () => mockResponseData,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ok: true,\r\n    status: 200,\r\n    json: async () => ({}),\r\n  };\r\n});\r\n\r\n// ============================================\r\n// TEST DATA\r\n// ============================================\r\n\r\nconst mockProduct = createMockProduct({\r\n  id: 'prod-001',\r\n  name: 'Premium Oak Flooring',\r\n  category: 'flooring',\r\n  description: 'High-quality engineered oak flooring',\r\n  cloudinaryUrl: 'https://res.cloudinary.com/test/oak-flooring.jpg',\r\n});\r\n\r\nconst mockProduct2 = createMockProduct({\r\n  id: 'prod-002',\r\n  name: 'Walnut Hardwood',\r\n  category: 'flooring',\r\n  description: 'Rich walnut hardwood flooring',\r\n  cloudinaryUrl: 'https://res.cloudinary.com/test/walnut.jpg',\r\n});\r\n\r\n// ============================================\r\n// SETUP AND TEARDOWN\r\n// ============================================\r\n\r\nbeforeEach(() => {\r\n  // Reset mock state\r\n  mockResponseData = createMockResponse();\r\n  mockShouldFail = false;\r\n  fetchCallCount = 0;\r\n\r\n  // Setup global fetch mock\r\n  global.fetch = mockFetch as unknown as typeof fetch;\r\n});\r\n\r\nafterEach(() => {\r\n  vi.clearAllMocks();\r\n});\r\n\r\n// ============================================\r\n// 1. RENDERING TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - Rendering', () => {\r\n  it('returns null when no products are selected', () => {\r\n    const { container } = render(<IdeaBankPanel selectedProducts={[]} onSelectPrompt={vi.fn()} />);\r\n\r\n    // Component returns null when no products are selected.\r\n    // The test-utils render wraps in ThemeProvider which injects a <script> tag,\r\n    // so container.firstChild is not null. Instead, check that the panel content\r\n    // is not rendered (no \"Intelligent Idea Bank\" heading).\r\n    expect(screen.queryByText('Intelligent Idea Bank')).not.toBeInTheDocument();\r\n    // Verify there's no motion.div panel content in the container\r\n    expect(container.querySelector('[class*=\"rounded-2xl\"]')).toBeNull();\r\n  });\r\n\r\n  it('renders with a single product selected', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Intelligent Idea Bank')).toBeInTheDocument();\r\n    });\r\n\r\n    // Should show product count\r\n    expect(screen.getByText(/1 product/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('renders with multiple products (1-6)', async () => {\r\n    const multipleProducts = [mockProduct, mockProduct2];\r\n\r\n    render(<IdeaBankPanel selectedProducts={multipleProducts} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Intelligent Idea Bank')).toBeInTheDocument();\r\n    });\r\n\r\n    expect(screen.getByText(/2 products/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('displays loading state while fetching suggestions', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    // Should show title immediately\r\n    expect(screen.getByText('Intelligent Idea Bank')).toBeInTheDocument();\r\n\r\n    // Wait for suggestions to load\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays error state when API fails', async () => {\r\n    mockShouldFail = true;\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(\r\n      () => {\r\n        expect(screen.getByText(/failed|error|retry|unable/i)).toBeInTheDocument();\r\n      },\r\n      { timeout: 5000 },\r\n    );\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 2. IDEA SUGGESTIONS TESTS (6 tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - Idea Suggestions', () => {\r\n  it('fetches suggestions on mount when products are selected', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(fetchCallCount).toBeGreaterThan(0);\r\n    });\r\n\r\n    expect(mockFetch).toHaveBeenCalledWith(\r\n      '/api/idea-bank/suggest',\r\n      expect.objectContaining({\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      }),\r\n    );\r\n  });\r\n\r\n  it('refreshes suggestions when refresh button is clicked', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    // Wait for initial load\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    const initialCount = fetchCallCount;\r\n\r\n    // Click refresh\r\n    const refreshButton = screen.getByTestId('button-refresh-idea-bank');\r\n    fireEvent.click(refreshButton);\r\n\r\n    await waitFor(() => {\r\n      expect(fetchCallCount).toBeGreaterThan(initialCount);\r\n    });\r\n  });\r\n\r\n  it('displays suggestion metadata (summary and reasoning)', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      // Should show suggestion summaries\r\n      expect(screen.getAllByText(/Professional product showcase/i).length).toBeGreaterThan(0);\r\n    });\r\n\r\n    // Should show reasoning text\r\n    expect(screen.getAllByText(/Why this works/i).length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('displays correct mode badges (exact_insert, inspiration, standard)', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      // Check for mode badge text\r\n      expect(screen.getByText('Exact Insert')).toBeInTheDocument();\r\n      expect(screen.getByText('Inspiration')).toBeInTheDocument();\r\n      expect(screen.getByText('Standard')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays confidence indicators with correct styling', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      // Should show confidence percentages\r\n      expect(screen.getByText('92%')).toBeInTheDocument(); // High confidence (green)\r\n      expect(screen.getByText('85%')).toBeInTheDocument(); // Medium-high confidence\r\n      expect(screen.getByText('78%')).toBeInTheDocument(); // Medium confidence\r\n    });\r\n  });\r\n\r\n  it('displays analysis status summary', async () => {\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      // Check analysis status indicators\r\n      expect(screen.getByText('Vision Analysis')).toBeInTheDocument();\r\n      expect(screen.getByText('Knowledge Base')).toBeInTheDocument();\r\n      expect(screen.getByText(/5 Templates/i)).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 3. SOURCE ATTRIBUTION TESTS (4 tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - Source Attribution', () => {\r\n  it('displays Vision source indicator when visionAnalysis is true', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'vis-1',\r\n          sourcesUsed: {\r\n            visionAnalysis: true,\r\n            kbRetrieval: false,\r\n            webSearch: false,\r\n            templateMatching: false,\r\n          },\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Vision')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays KB (Knowledge) source indicator when kbRetrieval is true', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'kb-1',\r\n          sourcesUsed: {\r\n            visionAnalysis: false,\r\n            kbRetrieval: true,\r\n            webSearch: false,\r\n            templateMatching: false,\r\n          },\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Knowledge')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays Web Search source indicator when webSearch is true', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'web-1',\r\n          sourcesUsed: {\r\n            visionAnalysis: false,\r\n            kbRetrieval: false,\r\n            webSearch: true,\r\n            templateMatching: false,\r\n          },\r\n        }),\r\n      ],\r\n      analysisStatus: {\r\n        visionComplete: false,\r\n        kbQueried: false,\r\n        templatesMatched: 0,\r\n        webSearchUsed: true,\r\n      },\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Web')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays Template source indicator when templateMatching is true', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'tpl-1',\r\n          sourcesUsed: {\r\n            visionAnalysis: false,\r\n            kbRetrieval: false,\r\n            webSearch: false,\r\n            templateMatching: true,\r\n          },\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Templates')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 4. USER INTERACTIONS TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - User Interactions', () => {\r\n  it('calls onSelectPrompt when an idea is selected', async () => {\r\n    const onSelectPrompt = vi.fn();\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={onSelectPrompt} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Use This Idea\" button on first suggestion\r\n    const useButtons = screen.getAllByText('Use This Idea');\r\n    fireEvent.click(useButtons[0] as HTMLElement);\r\n\r\n    expect(onSelectPrompt).toHaveBeenCalledWith(\r\n      expect.any(String), // prompt\r\n      expect.any(String), // id\r\n      expect.any(String), // reasoning\r\n    );\r\n  });\r\n\r\n  it('triggers generation when quick generate button is clicked', async () => {\r\n    const onSelectPrompt = vi.fn();\r\n    const onQuickGenerate = vi.fn();\r\n\r\n    render(\r\n      <IdeaBankPanel\r\n        selectedProducts={[mockProduct]}\r\n        onSelectPrompt={onSelectPrompt}\r\n        onQuickGenerate={onQuickGenerate}\r\n      />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Generate Now\" button\r\n    const generateButtons = screen.getAllByText('Generate Now');\r\n    fireEvent.click(generateButtons[0] as HTMLElement);\r\n\r\n    expect(onQuickGenerate).toHaveBeenCalledWith(expect.any(String));\r\n  });\r\n\r\n  it('marks suggestion as selected when clicked', async () => {\r\n    const onSelectPrompt = vi.fn();\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={onSelectPrompt} selectedPromptId=\"sug-1\" />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // The selected suggestion should show \"Selected\" button text\r\n    expect(screen.getByText('Selected')).toBeInTheDocument();\r\n  });\r\n\r\n  it('disables generate button when isGenerating is true', async () => {\r\n    render(\r\n      <IdeaBankPanel\r\n        selectedProducts={[mockProduct]}\r\n        onSelectPrompt={vi.fn()}\r\n        onQuickGenerate={vi.fn()}\r\n        isGenerating={true}\r\n      />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // Generate buttons should be disabled\r\n    const generateButtons = screen.getAllByRole('button').filter((btn) => btn.hasAttribute('disabled'));\r\n    expect(generateButtons.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('handles card click to select idea', async () => {\r\n    const onSelectPrompt = vi.fn();\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={onSelectPrompt} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/AI-generated/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // Find and click the first suggestion card (heading element)\r\n    const suggestionCards = screen.getAllByText(/Professional product showcase/i);\r\n    fireEvent.click(suggestionCards[0] as HTMLElement);\r\n\r\n    expect(onSelectPrompt).toHaveBeenCalled();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// 5. PLATFORM RECOMMENDATIONS TESTS (5 tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - Platform Recommendations', () => {\r\n  it('displays platform badge when recommendedPlatform is set', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'plat-1',\r\n          recommendedPlatform: 'instagram',\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('instagram')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('displays aspect ratio recommendation when set', async () => {\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'ar-1',\r\n          recommendedAspectRatio: '16:9',\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('16:9')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('calls onSetPlatform when suggestion with platform is selected', async () => {\r\n    const onSetPlatform = vi.fn();\r\n\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'setplat-1',\r\n          recommendedPlatform: 'linkedin',\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(<IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} onSetPlatform={onSetPlatform} />);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('linkedin')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Use This Idea\" button\r\n    const useButton = screen.getByText('Use This Idea');\r\n    fireEvent.click(useButton);\r\n\r\n    expect(onSetPlatform).toHaveBeenCalledWith('linkedin');\r\n  });\r\n\r\n  it('calls onSetAspectRatio when suggestion with aspect ratio is selected', async () => {\r\n    const onSetAspectRatio = vi.fn();\r\n\r\n    mockResponseData = createMockResponse({\r\n      suggestions: [\r\n        createMockSuggestion({\r\n          id: 'setar-1',\r\n          recommendedAspectRatio: '4:5',\r\n        }),\r\n      ],\r\n    });\r\n\r\n    render(\r\n      <IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} onSetAspectRatio={onSetAspectRatio} />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('4:5')).toBeInTheDocument();\r\n    });\r\n\r\n    // Click \"Use This Idea\" button\r\n    const useButton = screen.getByText('Use This Idea');\r\n    fireEvent.click(useButton);\r\n\r\n    expect(onSetAspectRatio).toHaveBeenCalledWith('4:5');\r\n  });\r\n\r\n  it('shows template mode badge when mode is template', async () => {\r\n    render(\r\n      <IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} mode=\"template\" templateId=\"tpl-123\" />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Template Mode')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// TEMPLATE MODE TESTS (Bonus - 3 additional tests)\r\n// ============================================\r\n\r\ndescribe('IdeaBankPanel - Template Mode', () => {\r\n  it('displays slot suggestions in template mode', async () => {\r\n    render(\r\n      <IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} mode=\"template\" templateId=\"tpl-123\" />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      // Should show template-specific content (multiple slots may render)\r\n      expect(screen.getAllByText('Template Slot').length).toBeGreaterThan(0);\r\n    });\r\n\r\n    // Each slot card shows \"Template Slot\" badge - verify at least 2 are rendered\r\n    // (createTemplateResponse creates 2 slot suggestions)\r\n    expect(screen.getAllByText('Template Slot').length).toBe(2);\r\n  });\r\n\r\n  it('displays template context info in template mode', async () => {\r\n    render(\r\n      <IdeaBankPanel selectedProducts={[mockProduct]} onSelectPrompt={vi.fn()} mode=\"template\" templateId=\"tpl-123\" />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Professional Product Showcase')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('calls onSlotSuggestionSelect when slot is selected', async () => {\r\n    const onSlotSuggestionSelect = vi.fn();\r\n\r\n    render(\r\n      <IdeaBankPanel\r\n        selectedProducts={[mockProduct]}\r\n        onSelectPrompt={vi.fn()}\r\n        mode=\"template\"\r\n        templateId=\"tpl-123\"\r\n        onSlotSuggestionSelect={onSlotSuggestionSelect}\r\n      />,\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/slot suggestion/i)).toBeInTheDocument();\r\n    });\r\n\r\n    // Click the first slot suggestion \"Use This\" button\r\n    const useButtons = screen.getAllByText('Use This');\r\n    fireEvent.click(useButtons[0] as HTMLElement);\r\n\r\n    expect(onSlotSuggestionSelect).toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\__tests__\\ProductCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\approval\\BulkActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\approval\\PriorityBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\approval\\QueueCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"XCircle"},"fix":{"range":[301,313],"text":""},"desc":"Remove unused variable \"XCircle\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { PriorityBadge } from \"./PriorityBadge\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  CheckCircle2,\r\n  XCircle,\r\n  Eye,\r\n  Trash2,\r\n  Clock,\r\n  ImageIcon,\r\n  TrendingUp,\r\n  Linkedin,\r\n  Facebook,\r\n  Instagram,\r\n  Twitter\r\n} from \"lucide-react\";\r\nimport { motion } from \"framer-motion\";\r\n\r\ninterface QueueCardProps {\r\n  item: {\r\n    id: string;\r\n    status: string;\r\n    priority: 'urgent' | 'high' | 'medium' | 'low';\r\n    aiConfidenceScore?: number;\r\n    scheduledFor?: string;\r\n    createdAt: string;\r\n    adCopy?: {\r\n      caption: string;\r\n      platform: string;\r\n    };\r\n    generation?: {\r\n      generatedImagePath: string;\r\n    };\r\n  };\r\n  onReview: () => void;\r\n  onQuickApprove: () => void;\r\n  onDelete: () => void;\r\n  isSelected?: boolean;\r\n  onSelect?: (selected: boolean) => void;\r\n  index?: number;\r\n}\r\n\r\nconst platformIcons = {\r\n  linkedin: Linkedin,\r\n  facebook: Facebook,\r\n  instagram: Instagram,\r\n  twitter: Twitter,\r\n};\r\n\r\nexport function QueueCard({\r\n  item,\r\n  onReview,\r\n  onQuickApprove,\r\n  onDelete,\r\n  isSelected = false,\r\n  onSelect,\r\n  index = 0\r\n}: QueueCardProps) {\r\n  const [isHovered, setIsHovered] = useState(false);\r\n\r\n  const caption = item.adCopy?.caption || 'No caption available';\r\n  const truncatedCaption = caption.length > 80 ? caption.substring(0, 80) + '...' : caption;\r\n  const platform = item.adCopy?.platform || 'unknown';\r\n  const PlatformIcon = platformIcons[platform as keyof typeof platformIcons];\r\n\r\n  const confidenceScore = item.aiConfidenceScore || 0;\r\n  const scheduledDate = item.scheduledFor ? new Date(item.scheduledFor) : null;\r\n  const isScheduledSoon = scheduledDate && (scheduledDate.getTime() - Date.now()) < 3 * 60 * 60 * 1000; // 3 hours\r\n\r\n  const getConfidenceColor = (score: number) => {\r\n    if (score >= 90) return 'text-green-600 dark:text-green-400';\r\n    if (score >= 75) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-orange-600 dark:text-orange-400';\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      transition={{ delay: index * 0.05, duration: 0.2 }}\r\n      onMouseEnter={() => setIsHovered(true)}\r\n      onMouseLeave={() => setIsHovered(false)}\r\n    >\r\n      <Card className={cn(\r\n        \"transition-all hover:shadow-md\",\r\n        isSelected && \"ring-2 ring-primary\"\r\n      )}>\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex gap-3\">\r\n            {/* Checkbox */}\r\n            {onSelect && (\r\n              <div className=\"flex items-start pt-1\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={isSelected}\r\n                  onChange={(e) => onSelect(e.target.checked)}\r\n                  className=\"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Thumbnail */}\r\n            <div className=\"flex-shrink-0\">\r\n              {item.generation?.generatedImagePath ? (\r\n                <img\r\n                  src={item.generation.generatedImagePath}\r\n                  alt=\"Preview\"\r\n                  className=\"w-20 h-20 rounded-lg object-cover border\"\r\n                />\r\n              ) : (\r\n                <div className=\"w-20 h-20 rounded-lg bg-muted flex items-center justify-center border\">\r\n                  <ImageIcon className=\"w-8 h-8 text-muted-foreground\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 min-w-0 space-y-2\">\r\n              {/* Header with priority and platform */}\r\n              <div className=\"flex items-start justify-between gap-2\">\r\n                <div className=\"flex items-center gap-2 flex-wrap\">\r\n                  <PriorityBadge priority={item.priority} />\r\n                  {PlatformIcon && (\r\n                    <Badge variant=\"outline\" className=\"gap-1\">\r\n                      <PlatformIcon className=\"w-3 h-3\" />\r\n                      {platform}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Confidence Score */}\r\n                {confidenceScore > 0 && (\r\n                  <div className=\"flex items-center gap-1 text-xs\">\r\n                    <TrendingUp className={cn(\"w-3 h-3\", getConfidenceColor(confidenceScore))} />\r\n                    <span className={cn(\"font-medium\", getConfidenceColor(confidenceScore))}>\r\n                      {confidenceScore}%\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Caption snippet */}\r\n              <p className=\"text-sm text-foreground line-clamp-2\">\r\n                {truncatedCaption}\r\n              </p>\r\n\r\n              {/* Scheduled time (if urgent) */}\r\n              {scheduledDate && isScheduledSoon && (\r\n                <div className=\"flex items-center gap-1 text-xs text-orange-600 dark:text-orange-400\">\r\n                  <Clock className=\"w-3 h-3\" />\r\n                  <span>\r\n                    Scheduled: {scheduledDate.toLocaleString('en-US', {\r\n                      month: 'short',\r\n                      day: 'numeric',\r\n                      hour: 'numeric',\r\n                      minute: '2-digit'\r\n                    })}\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex gap-2 pt-1\">\r\n                <Button\r\n                  onClick={onQuickApprove}\r\n                  size=\"sm\"\r\n                  variant=\"default\"\r\n                  className=\"flex-1 bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600\"\r\n                >\r\n                  <CheckCircle2 className=\"w-3 h-3 mr-1\" />\r\n                  Quick Approve\r\n                </Button>\r\n                <Button\r\n                  onClick={onReview}\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  className=\"flex-1\"\r\n                >\r\n                  <Eye className=\"w-3 h-3 mr-1\" />\r\n                  Review\r\n                </Button>\r\n                {isHovered && (\r\n                  <motion.div\r\n                    initial={{ opacity: 0, scale: 0.8 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    transition={{ duration: 0.15 }}\r\n                  >\r\n                    <Button\r\n                      onClick={onDelete}\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      className=\"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20\"\r\n                    >\r\n                      <Trash2 className=\"w-3 h-3\" />\r\n                    </Button>\r\n                  </motion.div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </motion.div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\approval\\ReviewModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit3' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Edit3"},"fix":{"range":[431,441],"text":""},"desc":"Remove unused variable \"Edit3\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[952,955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[952,955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1201,1204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1201,1204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { PriorityBadge } from \"./PriorityBadge\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  CheckCircle2,\r\n  XCircle,\r\n  Edit3,\r\n  Pause,\r\n  TrendingUp,\r\n  Lightbulb,\r\n  AlertTriangle,\r\n  CheckCircle,\r\n  Linkedin,\r\n  Facebook,\r\n  Instagram,\r\n  Twitter,\r\n  ImageIcon,\r\n  Star\r\n} from \"lucide-react\";\r\n\r\ninterface ReviewModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  item: {\r\n    id: string;\r\n    status: string;\r\n    priority: 'urgent' | 'high' | 'medium' | 'low';\r\n    aiConfidenceScore?: number;\r\n    aiRecommendation?: 'auto_approve' | 'manual_review' | 'auto_reject';\r\n    aiReasoning?: string;\r\n    safetyChecksPassed?: any;\r\n    complianceFlags?: string[];\r\n    scheduledFor?: string;\r\n    adCopy?: {\r\n      caption: string;\r\n      headline?: string;\r\n      hook?: string;\r\n      cta?: string;\r\n      platform: string;\r\n      framework?: string;\r\n      qualityScore?: any;\r\n    };\r\n    generation?: {\r\n      generatedImagePath: string;\r\n      prompt?: string;\r\n      aspectRatio?: string;\r\n    };\r\n  };\r\n  onApprove: (notes?: string) => void;\r\n  onReject: (notes?: string) => void;\r\n  onRequestRevision: (notes?: string) => void;\r\n  isProcessing?: boolean;\r\n}\r\n\r\nconst platformIcons = {\r\n  linkedin: Linkedin,\r\n  facebook: Facebook,\r\n  instagram: Instagram,\r\n  twitter: Twitter,\r\n};\r\n\r\nexport function ReviewModal({\r\n  isOpen,\r\n  onClose,\r\n  item,\r\n  onApprove,\r\n  onReject,\r\n  onRequestRevision,\r\n  isProcessing = false\r\n}: ReviewModalProps) {\r\n  const [notes, setNotes] = useState(\"\");\r\n\r\n  const handleApprove = () => {\r\n    onApprove(notes);\r\n    setNotes(\"\");\r\n  };\r\n\r\n  const handleReject = () => {\r\n    onReject(notes);\r\n    setNotes(\"\");\r\n  };\r\n\r\n  const handleRevision = () => {\r\n    onRequestRevision(notes);\r\n    setNotes(\"\");\r\n  };\r\n\r\n  const caption = item.adCopy?.caption || 'No caption available';\r\n  const platform = item.adCopy?.platform || 'unknown';\r\n  const PlatformIcon = platformIcons[platform as keyof typeof platformIcons];\r\n\r\n  const confidenceScore = item.aiConfidenceScore || 0;\r\n  const qualityScore = item.adCopy?.qualityScore?.overallScore || 0;\r\n\r\n  const captionLength = caption.length;\r\n  const maxLength = platform === 'twitter' ? 280 : platform === 'linkedin' ? 3000 : 2200;\r\n  const lengthPercentage = (captionLength / maxLength) * 100;\r\n\r\n  const safetyChecks = item.safetyChecksPassed || {};\r\n  const allChecksPassed = Object.values(safetyChecks).every(v => v === true);\r\n\r\n  const getConfidenceColor = (score: number) => {\r\n    if (score >= 90) return 'text-green-600 dark:text-green-400';\r\n    if (score >= 75) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-orange-600 dark:text-orange-400';\r\n  };\r\n\r\n  const renderStars = (score: number) => {\r\n    const stars = Math.round((score / 100) * 5);\r\n    return (\r\n      <div className=\"flex gap-0.5\">\r\n        {[...Array(5)].map((_, i) => (\r\n          <Star\r\n            key={i}\r\n            className={cn(\r\n              \"w-3 h-3\",\r\n              i < stars ? \"fill-yellow-500 text-yellow-500\" : \"text-gray-300 dark:text-gray-600\"\r\n            )}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-3\">\r\n            <span>Review Content #{item.id.slice(0, 8)}</span>\r\n            <PriorityBadge priority={item.priority} />\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Quick Stats */}\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <div className=\"space-y-1\">\r\n              <div className=\"text-xs text-muted-foreground\">Quality</div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className={cn(\"text-lg font-bold\", getConfidenceColor(qualityScore))}>\r\n                  {qualityScore}/100\r\n                </span>\r\n                {renderStars(qualityScore)}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <div className=\"text-xs text-muted-foreground\">Confidence</div>\r\n              <div className=\"flex items-center gap-1\">\r\n                <TrendingUp className={cn(\"w-4 h-4\", getConfidenceColor(confidenceScore))} />\r\n                <span className={cn(\"text-lg font-bold\", getConfidenceColor(confidenceScore))}>\r\n                  {confidenceScore}%\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <div className=\"text-xs text-muted-foreground\">Character Count</div>\r\n              <div className=\"flex items-center gap-1\">\r\n                <span className={cn(\r\n                  \"text-lg font-bold\",\r\n                  lengthPercentage > 95 ? \"text-red-600\" : lengthPercentage > 85 ? \"text-yellow-600\" : \"text-green-600\"\r\n                )}>\r\n                  {captionLength}/{maxLength}\r\n                </span>\r\n                {lengthPercentage <= 100 && <CheckCircle className=\"w-4 h-4 text-green-600\" />}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"space-y-1\">\r\n              <div className=\"text-xs text-muted-foreground\">Framework</div>\r\n              <Badge variant=\"outline\" className=\"text-sm\">\r\n                {item.adCopy?.framework?.toUpperCase() || 'N/A'}\r\n              </Badge>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Visual Preview and Copy */}\r\n          <div className=\"grid md:grid-cols-2 gap-6\">\r\n            {/* Image Preview */}\r\n            <div className=\"space-y-2\">\r\n              <h3 className=\"text-sm font-medium\">Visual Preview</h3>\r\n              {item.generation?.generatedImagePath ? (\r\n                <div className=\"relative\">\r\n                  <img\r\n                    src={item.generation.generatedImagePath}\r\n                    alt=\"Content preview\"\r\n                    className=\"w-full rounded-lg border shadow-sm\"\r\n                  />\r\n                  {item.generation.aspectRatio && (\r\n                    <Badge className=\"absolute top-2 right-2\" variant=\"secondary\">\r\n                      {item.generation.aspectRatio}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <div className=\"aspect-square rounded-lg bg-muted flex items-center justify-center border\">\r\n                  <ImageIcon className=\"w-16 h-16 text-muted-foreground\" />\r\n                </div>\r\n              )}\r\n              {PlatformIcon && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <PlatformIcon className=\"w-4 h-4\" />\r\n                  <span className=\"text-sm text-muted-foreground capitalize\">{platform}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Copy Text */}\r\n            <div className=\"space-y-3\">\r\n              <h3 className=\"text-sm font-medium\">Copy Text</h3>\r\n              <div className=\"p-4 rounded-lg bg-muted/30 border max-h-80 overflow-y-auto\">\r\n                <p className=\"text-sm whitespace-pre-wrap\">{caption}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Validation Checks */}\r\n          <div className=\"space-y-2\">\r\n            <h3 className=\"text-sm font-medium flex items-center gap-2\">\r\n              <CheckCircle className=\"w-4 h-4\" />\r\n              Validation Checks\r\n            </h3>\r\n            <div className=\"grid md:grid-cols-2 gap-2\">\r\n              <div className=\"flex items-center gap-2 text-sm\">\r\n                {lengthPercentage <= 100 ? (\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                ) : (\r\n                  <XCircle className=\"w-4 h-4 text-red-600\" />\r\n                )}\r\n                <span>Character limit {lengthPercentage <= 100 ? 'OK' : 'exceeded'}</span>\r\n              </div>\r\n\r\n              {allChecksPassed ? (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                  <span>All safety checks passed</span>\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <AlertTriangle className=\"w-4 h-4 text-yellow-600\" />\r\n                  <span>Some safety checks flagged</span>\r\n                </div>\r\n              )}\r\n\r\n              {item.complianceFlags && item.complianceFlags.length > 0 ? (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <AlertTriangle className=\"w-4 h-4 text-orange-600\" />\r\n                  <span>{item.complianceFlags.length} compliance flag(s)</span>\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                  <span>No compliance issues</span>\r\n                </div>\r\n              )}\r\n\r\n              {item.adCopy?.cta ? (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                  <span>CTA present and clear</span>\r\n                </div>\r\n              ) : (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <AlertTriangle className=\"w-4 h-4 text-yellow-600\" />\r\n                  <span>No CTA detected</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* AI Reasoning */}\r\n          {item.aiReasoning && (\r\n            <div className=\"space-y-2\">\r\n              <h3 className=\"text-sm font-medium flex items-center gap-2\">\r\n                <Lightbulb className=\"w-4 h-4 text-amber-500\" />\r\n                AI Reasoning\r\n              </h3>\r\n              <div className=\"p-4 rounded-lg bg-amber-500/10 dark:bg-amber-500/20 border border-amber-500/30\">\r\n                <p className=\"text-sm text-foreground\">{item.aiReasoning}</p>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Notes Field */}\r\n          <div className=\"space-y-2\">\r\n            <label htmlFor=\"review-notes\" className=\"text-sm font-medium\">\r\n              Optional: Add approval notes\r\n            </label>\r\n            <Textarea\r\n              id=\"review-notes\"\r\n              placeholder=\"Add any notes about your decision...\"\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              rows={3}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n          <Button\r\n            onClick={handleReject}\r\n            variant=\"outline\"\r\n            disabled={isProcessing}\r\n            className=\"border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-900/20\"\r\n          >\r\n            <XCircle className=\"w-4 h-4 mr-2\" />\r\n            Reject\r\n          </Button>\r\n\r\n          <Button\r\n            onClick={handleRevision}\r\n            variant=\"outline\"\r\n            disabled={isProcessing}\r\n          >\r\n            <Pause className=\"w-4 h-4 mr-2\" />\r\n            Needs Revision\r\n          </Button>\r\n\r\n          <Button\r\n            onClick={handleApprove}\r\n            variant=\"default\"\r\n            disabled={isProcessing}\r\n            className=\"bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600\"\r\n          >\r\n            <CheckCircle2 className=\"w-4 h-4 mr-2\" />\r\n            Approve & Schedule\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\calendar\\CalendarView.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'gridEnd' and 'gridStart'. Either include them or remove the dependency array.","line":316,"column":5,"nodeType":"ArrayExpression","endLine":316,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [gridEnd, gridStart]","fix":{"range":[12163,12203],"text":"[gridEnd, gridStart]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":316,"column":6,"nodeType":"CallExpression","endLine":316,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":316,"column":27,"nodeType":"CallExpression","endLine":316,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * CalendarView -- Premium monthly content calendar.\r\n *\r\n * Custom 7-column CSS grid (no react-day-picker).\r\n * Features:\r\n *   - Month navigation with smooth transition\r\n *   - Stats bar summarising scheduled / published / failed counts\r\n *   - Mini post cards per day cell (image thumbnail + 1-line caption)\r\n *   - \"+N more\" overflow badge\r\n *   - Today cell highlight + \"Today\" label\r\n *   - Past days dimmed, outside-month days ultra-faded\r\n *   - Empty state illustration when zero posts in month\r\n *   - Skeleton loading state\r\n *   - Click day -> DayPostsSheet\r\n *   - \"Schedule Post\" FAB button\r\n *   - Mobile responsive: compact dot-only cells on small screens\r\n *   - Dark mode aware\r\n */\r\n\r\nimport { useState, useMemo, useCallback } from 'react';\r\nimport {\r\n  format,\r\n  startOfMonth,\r\n  endOfMonth,\r\n  startOfWeek,\r\n  endOfWeek,\r\n  eachDayOfInterval,\r\n  isSameMonth,\r\n  isSameDay,\r\n  isToday,\r\n  isPast,\r\n  addMonths,\r\n  subMonths,\r\n  parseISO,\r\n} from 'date-fns';\r\nimport { ChevronLeft, ChevronRight, Plus, Calendar as CalendarIcon, CalendarDays } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { cn } from '@/lib/utils';\r\nimport { useCalendarPosts, useCalendarCounts } from '@/hooks/useScheduledPosts';\r\nimport type { ScheduledPost, DayCount } from '@/hooks/useScheduledPosts';\r\nimport { PostStatusBadge } from './PostStatusBadge';\r\nimport { DayPostsSheet } from './DayPostsSheet';\r\nimport { SchedulePostDialog } from './SchedulePostDialog';\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Constants                                                          */\r\n/* ------------------------------------------------------------------ */\r\n\r\nconst WEEKDAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\r\nconst MAX_VISIBLE_POSTS = 2;\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Status color helpers                                               */\r\n/* ------------------------------------------------------------------ */\r\n\r\nconst STATUS_BAR_COLORS: Record<string, string> = {\r\n  scheduled: 'bg-blue-500 dark:bg-blue-400',\r\n  published: 'bg-green-500 dark:bg-green-400',\r\n  publishing: 'bg-amber-500 dark:bg-amber-400',\r\n  failed: 'bg-red-500 dark:bg-red-400',\r\n  cancelled: 'bg-gray-400 dark:bg-gray-500',\r\n  draft: 'bg-gray-300 dark:bg-gray-600',\r\n};\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  MiniPostCard -- compact card inside a day cell                     */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction MiniPostCard({ post }: { post: ScheduledPost }) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'hidden md:flex items-center gap-1.5 rounded px-1.5 py-0.5',\r\n        'bg-muted/60 dark:bg-muted/40 hover:bg-muted transition-colors duration-100',\r\n        'group/card cursor-default max-w-full',\r\n      )}\r\n    >\r\n      {/* Thumbnail or colored status bar */}\r\n      {post.imageUrl ? (\r\n        <img src={post.imageUrl} alt=\"\" className=\"w-5 h-5 rounded-sm object-cover shrink-0\" />\r\n      ) : (\r\n        <span\r\n          className={cn('w-1 h-4 rounded-full shrink-0', STATUS_BAR_COLORS[post.status] ?? STATUS_BAR_COLORS.draft)}\r\n        />\r\n      )}\r\n      {/* Caption snippet */}\r\n      <span className=\"text-[10px] leading-tight truncate flex-1 text-foreground/80\">{post.caption || 'Untitled'}</span>\r\n      {/* Tiny status icon */}\r\n      <PostStatusBadge status={post.status} size=\"tiny\" className=\"shrink-0\" />\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  StatusDot -- used on mobile instead of mini cards                   */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction StatusDots({ posts }: { posts: ScheduledPost[] }) {\r\n  if (posts.length === 0) return null;\r\n\r\n  // Deduplicate statuses and show one dot per unique status\r\n  const statuses = [...new Set(posts.map((p) => p.status))];\r\n\r\n  return (\r\n    <div className=\"flex md:hidden items-center justify-center gap-0.5 mt-0.5\">\r\n      {statuses.slice(0, 3).map((s, i) => (\r\n        <span key={i} className={cn('w-1.5 h-1.5 rounded-full', STATUS_BAR_COLORS[s] ?? STATUS_BAR_COLORS.draft)} />\r\n      ))}\r\n      {posts.length > 3 && <span className=\"text-[8px] text-muted-foreground leading-none\">+{posts.length - 3}</span>}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  DayCell -- single cell in the calendar grid                        */\r\n/* ------------------------------------------------------------------ */\r\n\r\ninterface DayCellProps {\r\n  day: Date;\r\n  currentMonth: Date;\r\n  isSelected: boolean;\r\n  posts: ScheduledPost[];\r\n  onClick: (day: Date) => void;\r\n}\r\n\r\nfunction DayCell({ day, currentMonth, isSelected, posts, onClick }: DayCellProps) {\r\n  const inMonth = isSameMonth(day, currentMonth);\r\n  const today = isToday(day);\r\n  const past = isPast(day) && !today;\r\n  const overflow = posts.length - MAX_VISIBLE_POSTS;\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      onClick={() => onClick(day)}\r\n      className={cn(\r\n        // Base cell\r\n        'relative flex flex-col p-1.5 md:p-2 min-h-[3rem] md:min-h-[5.5rem] rounded-lg',\r\n        'text-left transition-all duration-150 outline-none',\r\n        'border border-transparent',\r\n        'focus-visible:ring-2 focus-visible:ring-primary/40',\r\n        // In-month vs outside\r\n        inMonth ? 'bg-card dark:bg-card' : 'bg-muted/30 dark:bg-muted/10 opacity-40 pointer-events-none',\r\n        // Past day dimming\r\n        past && inMonth && 'opacity-60',\r\n        // Today highlight\r\n        today && 'ring-2 ring-primary/50 dark:ring-primary/40 bg-primary/[0.04] dark:bg-primary/[0.08]',\r\n        // Selected state\r\n        isSelected && inMonth && 'border-primary/60 bg-primary/[0.06] dark:bg-primary/[0.12]',\r\n        // Hover\r\n        inMonth && !isSelected && 'hover:bg-accent/50 dark:hover:bg-accent/30',\r\n      )}\r\n    >\r\n      {/* Day number + Today label */}\r\n      <div className=\"flex items-center justify-between mb-0.5 md:mb-1\">\r\n        <span\r\n          className={cn(\r\n            'text-xs md:text-sm font-medium tabular-nums',\r\n            today && 'text-primary font-bold',\r\n            !inMonth && 'text-muted-foreground/50',\r\n          )}\r\n        >\r\n          {format(day, 'd')}\r\n        </span>\r\n        {today && (\r\n          <span className=\"hidden md:inline text-[9px] font-semibold uppercase tracking-wider text-primary/80\">\r\n            Today\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Mini post cards -- desktop */}\r\n      <div className=\"flex-1 space-y-0.5 overflow-hidden\">\r\n        {posts.slice(0, MAX_VISIBLE_POSTS).map((post) => (\r\n          <MiniPostCard key={post.id} post={post} />\r\n        ))}\r\n        {overflow > 0 && (\r\n          <span className=\"hidden md:block text-[9px] text-muted-foreground pl-1 font-medium\">+{overflow} more</span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Status dots -- mobile */}\r\n      <StatusDots posts={posts} />\r\n    </button>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  SkeletonGrid -- loading placeholder                                */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction SkeletonGrid() {\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {/* Weekday header skeleton */}\r\n      <div className=\"grid grid-cols-7 gap-1\">\r\n        {WEEKDAYS.map((d) => (\r\n          <Skeleton key={d} className=\"h-4 rounded\" />\r\n        ))}\r\n      </div>\r\n      {/* 5 rows of 7 cells */}\r\n      {Array.from({ length: 5 }).map((_, row) => (\r\n        <div key={row} className=\"grid grid-cols-7 gap-1\">\r\n          {Array.from({ length: 7 }).map((_, col) => (\r\n            <Skeleton key={col} className=\"h-14 md:h-24 rounded-lg\" />\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  EmptyMonth -- shown when zero posts exist for the visible month    */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction EmptyMonth({ onSchedule }: { onSchedule: () => void }) {\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center py-16 text-center\">\r\n      <div className=\"w-16 h-16 rounded-2xl bg-muted/60 dark:bg-muted/30 flex items-center justify-center mb-4\">\r\n        <CalendarDays className=\"h-8 w-8 text-muted-foreground/60\" />\r\n      </div>\r\n      <h3 className=\"text-sm font-semibold text-foreground/80 mb-1\">No posts this month</h3>\r\n      <p className=\"text-xs text-muted-foreground max-w-[240px] mb-4\">\r\n        Start planning your content by scheduling your first post.\r\n      </p>\r\n      <Button size=\"sm\" variant=\"outline\" className=\"gap-1.5\" onClick={onSchedule}>\r\n        <Plus className=\"h-3.5 w-3.5\" />\r\n        Schedule a post\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  StatsBar -- month summary counts                                   */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction StatsBar({ counts }: { counts: DayCount[] }) {\r\n  const totals = useMemo(() => {\r\n    const out = { scheduled: 0, published: 0, failed: 0 };\r\n    for (const dc of counts) {\r\n      out.scheduled += dc.scheduled;\r\n      out.published += dc.published;\r\n      out.failed += dc.failed;\r\n    }\r\n    return out;\r\n  }, [counts]);\r\n\r\n  const hasAny = totals.scheduled + totals.published + totals.failed > 0;\r\n  if (!hasAny) return null;\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\r\n      {totals.scheduled > 0 && (\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-blue-500 dark:bg-blue-400\" />\r\n          <span>\r\n            <span className=\"font-semibold text-foreground/80\">{totals.scheduled}</span> scheduled\r\n          </span>\r\n        </div>\r\n      )}\r\n      {totals.published > 0 && (\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-green-500 dark:bg-green-400\" />\r\n          <span>\r\n            <span className=\"font-semibold text-foreground/80\">{totals.published}</span> published\r\n          </span>\r\n        </div>\r\n      )}\r\n      {totals.failed > 0 && (\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-red-500 dark:bg-red-400\" />\r\n          <span>\r\n            <span className=\"font-semibold text-foreground/80\">{totals.failed}</span> failed\r\n          </span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  CalendarView (default export, lazy-loaded)                         */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport default function CalendarView() {\r\n  const [currentMonth, setCurrentMonth] = useState(new Date());\r\n  const [selectedDay, setSelectedDay] = useState<Date | null>(null);\r\n  const [showScheduleDialog, setShowScheduleDialog] = useState(false);\r\n\r\n  const year = currentMonth.getFullYear();\r\n  const month = currentMonth.getMonth() + 1;\r\n\r\n  // Date range for post fetching (full visible grid, including edge days)\r\n  const monthStart = startOfMonth(currentMonth);\r\n  const monthEnd = endOfMonth(currentMonth);\r\n  const gridStart = startOfWeek(monthStart); // Sunday\r\n  const gridEnd = endOfWeek(monthEnd); // Saturday\r\n\r\n  const rangeStart = format(gridStart, 'yyyy-MM-dd');\r\n  const rangeEnd = format(gridEnd, 'yyyy-MM-dd');\r\n\r\n  const { data: posts = [], isLoading: postsLoading } = useCalendarPosts(\r\n    `${rangeStart}T00:00:00Z`,\r\n    `${rangeEnd}T23:59:59Z`,\r\n  );\r\n\r\n  const { data: dayCounts = [] } = useCalendarCounts(year, month);\r\n\r\n  // All days that appear in the grid (6 weeks max, always fills 7-col rows)\r\n  const gridDays = useMemo(\r\n    () => eachDayOfInterval({ start: gridStart, end: gridEnd }),\r\n    [gridStart.getTime(), gridEnd.getTime()],\r\n  );\r\n\r\n  // Map posts by YYYY-MM-DD for quick lookup\r\n  const postsMap = useMemo(() => {\r\n    const map = new Map<string, ScheduledPost[]>();\r\n    for (const p of posts) {\r\n      const key = format(parseISO(p.scheduledFor), 'yyyy-MM-dd');\r\n      const arr = map.get(key);\r\n      if (arr) {\r\n        arr.push(p);\r\n      } else {\r\n        map.set(key, [p]);\r\n      }\r\n    }\r\n    return map;\r\n  }, [posts]);\r\n\r\n  // Posts for the selected day (for DayPostsSheet)\r\n  const selectedDayPosts = useMemo(() => {\r\n    if (!selectedDay) return [];\r\n    return posts.filter((p) => isSameDay(parseISO(p.scheduledFor), selectedDay));\r\n  }, [posts, selectedDay]);\r\n\r\n  // Navigation\r\n  const handlePrevMonth = useCallback(() => setCurrentMonth((m) => subMonths(m, 1)), []);\r\n  const handleNextMonth = useCallback(() => setCurrentMonth((m) => addMonths(m, 1)), []);\r\n  const handleToday = useCallback(() => setCurrentMonth(new Date()), []);\r\n\r\n  const handleDayClick = useCallback((day: Date) => {\r\n    setSelectedDay(day);\r\n  }, []);\r\n\r\n  const totalPostsInMonth = posts.filter((p) => isSameMonth(parseISO(p.scheduledFor), currentMonth)).length;\r\n\r\n  return (\r\n    <div className=\"space-y-5\">\r\n      {/* ---- Header row ---- */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"flex items-center justify-center w-9 h-9 rounded-lg bg-primary/10 dark:bg-primary/20\">\r\n            <CalendarIcon className=\"h-4.5 w-4.5 text-primary\" />\r\n          </div>\r\n          <div>\r\n            <h2 className=\"text-lg font-semibold tracking-tight\">Content Calendar</h2>\r\n            <p className=\"text-xs text-muted-foreground hidden sm:block\">Plan and track your social media posts</p>\r\n          </div>\r\n        </div>\r\n        <Button size=\"sm\" className=\"gap-2 shadow-sm\" onClick={() => setShowScheduleDialog(true)}>\r\n          <Plus className=\"h-4 w-4\" />\r\n          <span className=\"hidden sm:inline\">Schedule Post</span>\r\n          <span className=\"sm:hidden\">New</span>\r\n        </Button>\r\n      </div>\r\n\r\n      {/* ---- Month navigation + stats ---- */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 bg-card dark:bg-card rounded-xl border p-3 sm:p-4\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handlePrevMonth}>\r\n            <ChevronLeft className=\"h-4 w-4\" />\r\n          </Button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleToday}\r\n            className=\"text-sm sm:text-base font-semibold tracking-tight min-w-[160px] text-center hover:text-primary transition-colors duration-150\"\r\n            title=\"Go to today\"\r\n          >\r\n            {format(currentMonth, 'MMMM yyyy')}\r\n          </button>\r\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" onClick={handleNextMonth}>\r\n            <ChevronRight className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n        <StatsBar counts={dayCounts} />\r\n      </div>\r\n\r\n      {/* ---- Calendar grid ---- */}\r\n      <div className=\"bg-card dark:bg-card rounded-xl border overflow-hidden\">\r\n        {postsLoading ? (\r\n          <div className=\"p-3 sm:p-4\">\r\n            <SkeletonGrid />\r\n          </div>\r\n        ) : totalPostsInMonth === 0 && dayCounts.length === 0 ? (\r\n          <EmptyMonth onSchedule={() => setShowScheduleDialog(true)} />\r\n        ) : (\r\n          <div className=\"p-2 sm:p-3\">\r\n            {/* Weekday header */}\r\n            <div className=\"grid grid-cols-7 mb-1\">\r\n              {WEEKDAYS.map((d) => (\r\n                <div key={d} className=\"text-center text-[10px] sm:text-xs font-medium text-muted-foreground py-2\">\r\n                  <span className=\"hidden sm:inline\">{d}</span>\r\n                  <span className=\"sm:hidden\">{d.charAt(0)}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Day cells */}\r\n            <div className=\"grid grid-cols-7 gap-0.5 sm:gap-1\">\r\n              {gridDays.map((day) => {\r\n                const key = format(day, 'yyyy-MM-dd');\r\n                const dayPosts = postsMap.get(key) ?? [];\r\n                const selected = selectedDay ? isSameDay(day, selectedDay) : false;\r\n                return (\r\n                  <DayCell\r\n                    key={key}\r\n                    day={day}\r\n                    currentMonth={currentMonth}\r\n                    isSelected={selected}\r\n                    posts={dayPosts}\r\n                    onClick={handleDayClick}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* ---- Legend (below grid) ---- */}\r\n      <div className=\"flex flex-wrap items-center gap-x-5 gap-y-1 text-[11px] text-muted-foreground px-1\">\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-blue-500 dark:bg-blue-400\" />\r\n          Scheduled\r\n        </div>\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-green-500 dark:bg-green-400\" />\r\n          Published\r\n        </div>\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-amber-500 dark:bg-amber-400\" />\r\n          Publishing\r\n        </div>\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-red-500 dark:bg-red-400\" />\r\n          Failed\r\n        </div>\r\n        <div className=\"flex items-center gap-1.5\">\r\n          <span className=\"w-2 h-2 rounded-full bg-gray-400 dark:bg-gray-500\" />\r\n          Cancelled\r\n        </div>\r\n      </div>\r\n\r\n      {/* ---- Day detail sheet ---- */}\r\n      <DayPostsSheet\r\n        open={!!selectedDay}\r\n        onOpenChange={(open) => {\r\n          if (!open) setSelectedDay(null);\r\n        }}\r\n        day={selectedDay}\r\n        posts={selectedDayPosts}\r\n      />\r\n\r\n      {/* ---- Schedule dialog ---- */}\r\n      <SchedulePostDialog open={showScheduleDialog} onOpenChange={setShowScheduleDialog} defaultDate={selectedDay} />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\calendar\\DayPostsSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3057,3060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3057,3060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":250,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9411,9414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9411,9414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":251,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9463,9466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9463,9466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * DayPostsSheet  Premium slide-over panel showing all posts for a selected day\n *\n * Timeline layout with rich post cards, micro-animations, full mobile support,\n * dark mode, and proper empty/loading/error states.\n */\n\nimport { useState, useCallback } from 'react';\nimport { format, parseISO, isToday, isTomorrow } from 'date-fns';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from '@/components/ui/sheet';\nimport { Button } from '@/components/ui/button';\nimport {\n  Calendar,\n  Clock,\n  XCircle,\n  Image as ImageIcon,\n  ExternalLink,\n  RotateCcw,\n  Loader2,\n  AlertTriangle,\n  ChevronDown,\n  ChevronUp,\n  Hash,\n  Globe,\n} from 'lucide-react';\nimport { PostStatusBadge } from './PostStatusBadge';\nimport { useCancelPost } from '@/hooks/useScheduledPosts';\nimport type { ScheduledPost } from '@/hooks/useScheduledPosts';\nimport { useToast } from '@/hooks/use-toast';\n\n/* ------------------------------------------------------------------ */\n/*  Platform colors for gradient placeholders                          */\n/* ------------------------------------------------------------------ */\n\nconst PLATFORM_GRADIENTS: Record<string, string> = {\n  instagram: 'from-pink-500 via-purple-500 to-indigo-500',\n  linkedin: 'from-blue-600 to-blue-800',\n  facebook: 'from-blue-500 to-blue-700',\n  twitter: 'from-sky-400 to-sky-600',\n  x: 'from-zinc-700 to-zinc-900',\n  tiktok: 'from-pink-500 via-red-500 to-yellow-500',\n};\n\nconst PLATFORM_ICONS: Record<string, string> = {\n  instagram: 'IG',\n  linkedin: 'LI',\n  facebook: 'FB',\n  twitter: 'X',\n  x: 'X',\n  tiktok: 'TT',\n};\n\n/* ------------------------------------------------------------------ */\n/*  Props                                                              */\n/* ------------------------------------------------------------------ */\n\ninterface DayPostsSheetProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  day: Date | null;\n  posts: ScheduledPost[];\n}\n\n/* ------------------------------------------------------------------ */\n/*  Helper: day label                                                  */\n/* ------------------------------------------------------------------ */\n\nfunction getDayLabel(day: Date): string {\n  if (isToday(day)) return 'Today';\n  if (isTomorrow(day)) return 'Tomorrow';\n  return format(day, 'EEEE');\n}\n\n/* ------------------------------------------------------------------ */\n/*  Main Component                                                     */\n/* ------------------------------------------------------------------ */\n\nexport function DayPostsSheet({ open, onOpenChange, day, posts }: DayPostsSheetProps) {\n  const cancelPost = useCancelPost();\n  const { toast } = useToast();\n  const [cancellingId, setCancellingId] = useState<string | null>(null);\n\n  const handleCancel = useCallback(\n    async (_postId: string) => {\n      setCancellingId(postId);\n      try {\n        await cancelPost.mutateAsync(postId);\n        toast({ title: 'Post cancelled', description: 'The scheduled post has been cancelled.' });\n      } catch (err: any) {\n        toast({\n          title: 'Failed to cancel',\n          description: err.message || 'Something went wrong. Please try again.',\n          variant: 'destructive',\n        });\n      } finally {\n        setCancellingId(null);\n      }\n    },\n    [cancelPost, toast],\n  );\n\n  const handleRetry = useCallback(\n    async (_postId: string) => {\n      // Retry = cancel and re-schedule or re-trigger  for now, toast guidance\n      toast({\n        title: 'Retry requested',\n        description: 'Please reschedule this post from the calendar.',\n      });\n    },\n    [toast],\n  );\n\n  if (!day) return null;\n\n  // Sort posts by scheduled time\n  const sortedPosts = [...posts].sort(\n    (a, b) => new Date(a.scheduledFor).getTime() - new Date(b.scheduledFor).getTime(),\n  );\n\n  const dayLabel = getDayLabel(day);\n  const formattedDate = format(day, 'MMMM d, yyyy');\n\n  const scheduledCount = posts.filter((p) => p.status === 'scheduled').length;\n  const publishedCount = posts.filter((p) => p.status === 'published').length;\n  const failedCount = posts.filter((p) => p.status === 'failed').length;\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent className=\"w-full sm:max-w-md p-0 flex flex-col overflow-hidden\">\n        {/* ---- Header ---- */}\n        <SheetHeader className=\"px-6 pt-6 pb-4 border-b border-border/50 bg-muted/30 dark:bg-muted/10 flex-shrink-0\">\n          <SheetTitle className=\"sr-only\">\n            {dayLabel}  {formattedDate}\n          </SheetTitle>\n\n          <div className=\"space-y-3\">\n            {/* Day name + date */}\n            <div className=\"flex items-start justify-between\">\n              <div>\n                <p className=\"text-2xl font-semibold tracking-tight text-foreground\">{dayLabel}</p>\n                <p className=\"text-sm text-muted-foreground mt-0.5\">{formattedDate}</p>\n              </div>\n              <div className=\"flex items-center gap-1.5 mt-1\">\n                <Calendar className=\"h-4 w-4 text-muted-foreground/60\" />\n                <span className=\"text-sm font-medium text-muted-foreground\">\n                  {posts.length} {posts.length === 1 ? 'post' : 'posts'}\n                </span>\n              </div>\n            </div>\n\n            {/* Stats pills */}\n            {posts.length > 0 && (\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                {scheduledCount > 0 && (\n                  <span className=\"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-blue-500\" />\n                    {scheduledCount} scheduled\n                  </span>\n                )}\n                {publishedCount > 0 && (\n                  <span className=\"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-green-500\" />\n                    {publishedCount} published\n                  </span>\n                )}\n                {failedCount > 0 && (\n                  <span className=\"inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-red-500\" />\n                    {failedCount} failed\n                  </span>\n                )}\n              </div>\n            )}\n          </div>\n        </SheetHeader>\n\n        {/* ---- Post List ---- */}\n        <div className=\"flex-1 overflow-y-auto px-6 py-4\">\n          {sortedPosts.length === 0 ? (\n            /* Empty state */\n            <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n              <div className=\"w-16 h-16 rounded-2xl bg-muted/60 dark:bg-muted/20 flex items-center justify-center mb-4\">\n                <Calendar className=\"h-7 w-7 text-muted-foreground/40\" />\n              </div>\n              <p className=\"text-sm font-medium text-foreground/80 mb-1\">No posts for this day</p>\n              <p className=\"text-xs text-muted-foreground max-w-[200px]\">\n                Schedule a post from the Studio or click the + button on the calendar.\n              </p>\n            </div>\n          ) : (\n            /* Timeline */\n            <div className=\"relative\">\n              {/* Timeline line */}\n              <div className=\"absolute left-[19px] top-2 bottom-2 w-px bg-border/60 dark:bg-border/30\" />\n\n              <div className=\"space-y-1\">\n                {sortedPosts.map((post, index) => (\n                  <TimelinePostCard\n                    key={post.id}\n                    post={post}\n                    index={index}\n                    onCancel={handleCancel}\n                    onRetry={handleRetry}\n                    isCancelling={cancellingId === post.id}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* ---- Timezone footer ---- */}\n        <div className=\"flex-shrink-0 px-6 py-3 border-t border-border/50 bg-muted/20 dark:bg-muted/5\">\n          <div className=\"flex items-center gap-1.5 text-[11px] text-muted-foreground\">\n            <Globe className=\"h-3 w-3\" />\n            {Intl.DateTimeFormat().resolvedOptions().timeZone}\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n\n/* ------------------------------------------------------------------ */\n/*  Timeline Post Card                                                 */\n/* ------------------------------------------------------------------ */\n\nfunction TimelinePostCard({\n  post,\n  index,\n  onCancel,\n  onRetry,\n  isCancelling,\n}: {\n  post: ScheduledPost;\n  index: number;\n  onCancel: (id: string) => void;\n  onRetry: (id: string) => void;\n  isCancelling: boolean;\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const time = format(parseISO(post.scheduledFor), 'h:mm a');\n  const canCancel = post.status === 'scheduled' || post.status === 'draft';\n  const isCancelled = post.status === 'cancelled';\n  const isFailed = post.status === 'failed';\n  const isPublishing = post.status === 'publishing';\n  const isPublished = post.status === 'published';\n\n  const platform = (post as any).platform || '';\n  const accountName = (post as any).accountName || '';\n  const gradient = PLATFORM_GRADIENTS[platform.toLowerCase()] || 'from-gray-400 to-gray-600';\n  const platformLabel = PLATFORM_ICONS[platform.toLowerCase()] || '';\n\n  // Caption truncation\n  const _captionLines = post.caption?.split('\\n') || [];\n  const isLongCaption = post.caption && post.caption.length > 180;\n\n  return (\n    <div className=\"relative pl-10 pb-4 group\" style={{ animationDelay: `${index * 40}ms` }}>\n      {/* Timeline dot */}\n      <div\n        className={`\n          absolute left-2.5 top-3 w-4 h-4 rounded-full border-2 border-background z-10\n          transition-transform duration-200 group-hover:scale-110\n          ${isFailed ? 'bg-red-500' : ''}\n          ${isPublished ? 'bg-green-500' : ''}\n          ${isPublishing ? 'bg-yellow-500 animate-pulse' : ''}\n          ${isCancelled ? 'bg-muted-foreground/30' : ''}\n          ${post.status === 'scheduled' ? 'bg-blue-500' : ''}\n          ${post.status === 'draft' ? 'bg-gray-400 dark:bg-gray-600' : ''}\n        `}\n      />\n\n      {/* Card */}\n      <div\n        className={`\n          rounded-xl border transition-all duration-200\n          hover:shadow-md hover:border-border\n          ${\n            isCancelled\n              ? 'bg-muted/40 dark:bg-muted/10 border-border/40 opacity-60'\n              : 'bg-card border-border/60 shadow-sm'\n          }\n          ${isFailed ? 'border-red-200 dark:border-red-800/40' : ''}\n        `}\n      >\n        {/* Card header: time + status */}\n        <div className=\"flex items-center justify-between px-4 pt-3 pb-2\">\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"h-3.5 w-3.5 text-muted-foreground/60\" />\n            <span\n              className={`text-sm font-medium ${isCancelled ? 'line-through text-muted-foreground' : 'text-foreground'}`}\n            >\n              {time}\n            </span>\n            {platformLabel && (\n              <span className=\"text-[10px] font-semibold px-1.5 py-0.5 rounded bg-muted text-muted-foreground\">\n                {platformLabel}\n              </span>\n            )}\n            {accountName && <span className=\"text-xs text-muted-foreground hidden sm:inline\">{accountName}</span>}\n          </div>\n          <PostStatusBadge status={post.status} />\n        </div>\n\n        {/* Image + Caption */}\n        <div className=\"flex gap-3 px-4 pb-3\">\n          {/* Thumbnail */}\n          {post.imageUrl ? (\n            <img\n              src={post.imageUrl}\n              alt=\"\"\n              className={`\n                w-16 h-16 rounded-lg object-cover flex-shrink-0\n                ring-1 ring-black/5 dark:ring-white/10\n                transition-transform duration-200 group-hover:scale-[1.02]\n                ${isCancelled ? 'grayscale' : ''}\n              `}\n              loading=\"lazy\"\n            />\n          ) : (\n            <div\n              className={`\n                w-16 h-16 rounded-lg flex-shrink-0 flex items-center justify-center\n                bg-gradient-to-br ${gradient} opacity-80\n              `}\n            >\n              <ImageIcon className=\"h-5 w-5 text-white/70\" />\n            </div>\n          )}\n\n          {/* Caption */}\n          <div className=\"flex-1 min-w-0\">\n            {post.caption ? (\n              <div>\n                <p\n                  className={`\n                    text-sm leading-relaxed text-foreground/90\n                    ${isCancelled ? 'line-through text-muted-foreground' : ''}\n                    ${!expanded ? 'line-clamp-3' : ''}\n                  `}\n                >\n                  {post.caption}\n                </p>\n                {isLongCaption && (\n                  <button\n                    onClick={() => setExpanded(!expanded)}\n                    className=\"inline-flex items-center gap-0.5 text-xs text-primary hover:text-primary/80 mt-1 transition-colors\"\n                  >\n                    {expanded ? (\n                      <>\n                        Show less <ChevronUp className=\"h-3 w-3\" />\n                      </>\n                    ) : (\n                      <>\n                        Show more <ChevronDown className=\"h-3 w-3\" />\n                      </>\n                    )}\n                  </button>\n                )}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground italic\">No caption</p>\n            )}\n          </div>\n        </div>\n\n        {/* Hashtags */}\n        {post.hashtags && post.hashtags.length > 0 && (\n          <div className=\"flex flex-wrap items-center gap-1.5 px-4 pb-3\">\n            <Hash className=\"h-3 w-3 text-muted-foreground/50 flex-shrink-0\" />\n            {post.hashtags.slice(0, 5).map((tag, i) => (\n              <span\n                key={i}\n                className=\"text-[11px] font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-2 py-0.5 rounded-full\"\n              >\n                {tag}\n              </span>\n            ))}\n            {post.hashtags.length > 5 && (\n              <span className=\"text-[11px] text-muted-foreground\">+{post.hashtags.length - 5} more</span>\n            )}\n          </div>\n        )}\n\n        {/* Published link */}\n        {post.platformPostUrl && isPublished && (\n          <div className=\"px-4 pb-3\">\n            <a\n              href={post.platformPostUrl}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"inline-flex items-center gap-1.5 text-xs font-medium text-primary hover:text-primary/80 transition-colors group/link\"\n            >\n              <ExternalLink className=\"h-3.5 w-3.5 transition-transform group-hover/link:translate-x-0.5\" />\n              View on platform\n            </a>\n          </div>\n        )}\n\n        {/* Error message for failed posts */}\n        {isFailed && post.errorMessage && (\n          <div className=\"mx-4 mb-3 flex items-start gap-2 p-2.5 rounded-lg bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-800/30\">\n            <AlertTriangle className=\"h-3.5 w-3.5 text-red-500 mt-0.5 flex-shrink-0\" />\n            <p className=\"text-xs text-red-700 dark:text-red-300 leading-relaxed\">{post.errorMessage}</p>\n          </div>\n        )}\n\n        {/* Publishing spinner */}\n        {isPublishing && (\n          <div className=\"mx-4 mb-3 flex items-center gap-2 p-2.5 rounded-lg bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800/30\">\n            <Loader2 className=\"h-3.5 w-3.5 text-yellow-600 dark:text-yellow-400 animate-spin\" />\n            <p className=\"text-xs text-yellow-700 dark:text-yellow-300\">Publishing to platform...</p>\n          </div>\n        )}\n\n        {/* Actions */}\n        {(canCancel || isFailed) && (\n          <div className=\"flex items-center justify-end gap-2 px-4 pb-3 pt-1 border-t border-border/30 mt-1\">\n            {isFailed && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 text-xs text-amber-600 dark:text-amber-400 hover:text-amber-700 hover:bg-amber-50 dark:hover:bg-amber-900/20 gap-1.5\"\n                onClick={() => onRetry(post.id)}\n              >\n                <RotateCcw className=\"h-3 w-3\" />\n                Retry\n              </Button>\n            )}\n            {canCancel && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 text-xs text-muted-foreground hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 gap-1.5\"\n                onClick={() => onCancel(post.id)}\n                disabled={isCancelling}\n              >\n                {isCancelling ? <Loader2 className=\"h-3 w-3 animate-spin\" /> : <XCircle className=\"h-3 w-3\" />}\n                Cancel\n              </Button>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\calendar\\PostStatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\calendar\\SchedulePostDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":8,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Clock"},"fix":{"range":[833,843],"text":""},"desc":"Remove unused variable \"Clock\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7982,7985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7982,7985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * SchedulePostDialog  Premium form dialog to schedule a new post\r\n *\r\n * Full validation, character counters with platform-specific limits,\r\n * live image preview, timezone display, dark mode, and mobile responsive.\r\n */\r\n\r\nimport { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { format } from 'date-fns';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport {\r\n  Calendar,\r\n  Clock,\r\n  Image as ImageIcon,\r\n  Send,\r\n  Globe,\r\n  AlertCircle,\r\n  Loader2,\r\n  Link2,\r\n  ImageOff,\r\n  Hash,\r\n  ExternalLink,\r\n} from 'lucide-react';\r\nimport { useSchedulePost } from '@/hooks/useScheduledPosts';\r\nimport { useToast } from '@/hooks/use-toast';\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Platform character limits                                          */\r\n/* ------------------------------------------------------------------ */\r\n\r\nconst PLATFORM_LIMITS: Record<string, { name: string; limit: number; icon: string }> = {\r\n  twitter: { name: 'X / Twitter', limit: 280, icon: 'X' },\r\n  x: { name: 'X', limit: 280, icon: 'X' },\r\n  instagram: { name: 'Instagram', limit: 2200, icon: 'IG' },\r\n  facebook: { name: 'Facebook', limit: 63206, icon: 'FB' },\r\n  linkedin: { name: 'LinkedIn', limit: 3000, icon: 'LI' },\r\n  tiktok: { name: 'TikTok', limit: 2200, icon: 'TT' },\r\n};\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Types                                                              */\r\n/* ------------------------------------------------------------------ */\r\n\r\ninterface SocialAccount {\r\n  id: string;\r\n  platform: string;\r\n  accountName: string;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface SchedulePostDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  defaultDate?: Date | null;\r\n  prefill?: {\r\n    caption?: string;\r\n    imageUrl?: string;\r\n    imagePublicId?: string;\r\n    generationId?: string;\r\n  };\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Validation errors                                                  */\r\n/* ------------------------------------------------------------------ */\r\n\r\ninterface FormErrors {\r\n  connection?: string;\r\n  caption?: string;\r\n  date?: string;\r\n  imageUrl?: string;\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Helper: simple URL validation                                      */\r\n/* ------------------------------------------------------------------ */\r\n\r\nfunction isValidUrl(str: string): boolean {\r\n  if (!str) return true; // empty is OK  image is optional\r\n  try {\r\n    const url = new URL(str);\r\n    return url.protocol === 'http:' || url.protocol === 'https:';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Main Component                                                     */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport function SchedulePostDialog({ open, onOpenChange, defaultDate, prefill }: SchedulePostDialogProps) {\r\n  const { toast } = useToast();\r\n  const schedulePost = useSchedulePost();\r\n\r\n  // Form state\r\n  const [date, setDate] = useState('');\r\n  const [time, setTime] = useState('10:00');\r\n  const [connectionId, setConnectionId] = useState('');\r\n  const [caption, setCaption] = useState('');\r\n  const [imageUrl, setImageUrl] = useState('');\r\n  const [hashtags, setHashtags] = useState('');\r\n  const [errors, setErrors] = useState<FormErrors>({});\r\n  const [imageError, setImageError] = useState(false);\r\n  const [submitted, setSubmitted] = useState(false);\r\n\r\n  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n\r\n  // Fetch social accounts\r\n  const { data: accounts = [], isLoading: accountsLoading } = useQuery<SocialAccount[]>({\r\n    queryKey: ['social-accounts'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/social/accounts', { credentials: 'include' });\r\n      if (!res.ok) return [];\r\n      return res.json();\r\n    },\r\n    staleTime: 60_000,\r\n  });\r\n\r\n  const activeAccounts = useMemo(() => accounts.filter((a) => a.isActive), [accounts]);\r\n\r\n  // Selected account's platform (for character limit)\r\n  const selectedAccount = useMemo(\r\n    () => activeAccounts.find((a) => a.id === connectionId),\r\n    [activeAccounts, connectionId],\r\n  );\r\n\r\n  const platformKey = selectedAccount?.platform?.toLowerCase() || '';\r\n  const platformConfig = PLATFORM_LIMITS[platformKey];\r\n  const charLimit = platformConfig?.limit || 0;\r\n  const isOverLimit = charLimit > 0 && caption.length > charLimit;\r\n\r\n  // Character counter color\r\n  const charCountColor = useMemo(() => {\r\n    if (!charLimit) return 'text-muted-foreground';\r\n    const ratio = caption.length / charLimit;\r\n    if (ratio > 1) return 'text-red-500 dark:text-red-400 font-semibold';\r\n    if (ratio > 0.9) return 'text-amber-500 dark:text-amber-400';\r\n    if (ratio > 0.75) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-muted-foreground';\r\n  }, [caption.length, charLimit]);\r\n\r\n  // Reset form when dialog opens\r\n  useEffect(() => {\r\n    if (open) {\r\n      setDate(defaultDate ? format(defaultDate, 'yyyy-MM-dd') : format(new Date(), 'yyyy-MM-dd'));\r\n      setTime('10:00');\r\n      setCaption(prefill?.caption ?? '');\r\n      setImageUrl(prefill?.imageUrl ?? '');\r\n      setHashtags('');\r\n      setConnectionId('');\r\n      setErrors({});\r\n      setImageError(false);\r\n      setSubmitted(false);\r\n    }\r\n  }, [open, defaultDate, prefill]);\r\n\r\n  // Validate form\r\n  const validate = useCallback((): FormErrors => {\r\n    const errs: FormErrors = {};\r\n\r\n    if (!connectionId) {\r\n      errs.connection = 'Please select a social account.';\r\n    }\r\n\r\n    if (!caption.trim()) {\r\n      errs.caption = 'Caption is required.';\r\n    } else if (isOverLimit) {\r\n      errs.caption = `Caption exceeds ${charLimit} character limit for ${platformConfig?.name || 'this platform'}.`;\r\n    }\r\n\r\n    // Date must be in the future\r\n    if (date && time) {\r\n      const scheduled = new Date(`${date}T${time}:00`);\r\n      if (scheduled <= new Date()) {\r\n        errs.date = 'Scheduled time must be in the future.';\r\n      }\r\n    } else if (!date) {\r\n      errs.date = 'Date is required.';\r\n    }\r\n\r\n    if (imageUrl && !isValidUrl(imageUrl)) {\r\n      errs.imageUrl = 'Please enter a valid URL (https://...).';\r\n    }\r\n\r\n    return errs;\r\n  }, [connectionId, caption, date, time, imageUrl, isOverLimit, charLimit, platformConfig]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setSubmitted(true);\r\n\r\n    const formErrors = validate();\r\n    setErrors(formErrors);\r\n\r\n    if (Object.keys(formErrors).length > 0) return;\r\n\r\n    const scheduledFor = new Date(`${date}T${time}:00`).toISOString();\r\n\r\n    // Parse hashtags\r\n    const hashtagList = hashtags\r\n      .split(/[,\\s#]+/)\r\n      .map((t) => t.trim())\r\n      .filter(Boolean);\r\n\r\n    try {\r\n      await schedulePost.mutateAsync({\r\n        connectionId,\r\n        caption: caption.trim(),\r\n        hashtags: hashtagList.length > 0 ? hashtagList : undefined,\r\n        imageUrl: imageUrl || undefined,\r\n        imagePublicId: prefill?.imagePublicId,\r\n        scheduledFor,\r\n        timezone,\r\n        generationId: prefill?.generationId,\r\n      });\r\n\r\n      toast({\r\n        title: 'Post scheduled',\r\n        description: `Scheduled for ${format(new Date(scheduledFor), 'MMM d, yyyy')} at ${format(new Date(scheduledFor), 'h:mm a')}.`,\r\n      });\r\n      onOpenChange(false);\r\n    } catch (err: any) {\r\n      toast({\r\n        title: 'Failed to schedule',\r\n        description: err.message || 'Something went wrong. Please try again.',\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  // Re-validate on field changes after first submit attempt\r\n  useEffect(() => {\r\n    if (submitted) {\r\n      setErrors(validate());\r\n    }\r\n  }, [connectionId, caption, date, time, imageUrl, submitted, validate]);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-lg p-0 gap-0 overflow-hidden\">\r\n        {/* ---- Header ---- */}\r\n        <DialogHeader className=\"px-6 pt-6 pb-4 border-b border-border/50 bg-muted/30 dark:bg-muted/10\">\r\n          <DialogTitle className=\"flex items-center gap-2.5 text-lg\">\r\n            <div className=\"w-8 h-8 rounded-lg bg-primary/10 dark:bg-primary/20 flex items-center justify-center\">\r\n              <Send className=\"h-4 w-4 text-primary\" />\r\n            </div>\r\n            Schedule Post\r\n          </DialogTitle>\r\n          <p className=\"text-sm text-muted-foreground mt-1\">Choose when and where to publish your content.</p>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"flex flex-col\">\r\n          <div className=\"px-6 py-5 space-y-5 overflow-y-auto max-h-[60vh]\">\r\n            {/* ---- Date & Time Section ---- */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\r\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                Date & Time\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"space-y-1.5\">\r\n                  <Label htmlFor=\"schedule-date\" className=\"text-xs text-muted-foreground\">\r\n                    Date\r\n                  </Label>\r\n                  <Input\r\n                    id=\"schedule-date\"\r\n                    type=\"date\"\r\n                    value={date}\r\n                    onChange={(e) => setDate(e.target.value)}\r\n                    min={format(new Date(), 'yyyy-MM-dd')}\r\n                    required\r\n                    className={errors.date ? 'border-red-300 dark:border-red-700 focus-visible:ring-red-500' : ''}\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-1.5\">\r\n                  <Label htmlFor=\"schedule-time\" className=\"text-xs text-muted-foreground\">\r\n                    Time\r\n                  </Label>\r\n                  <Input\r\n                    id=\"schedule-time\"\r\n                    type=\"time\"\r\n                    value={time}\r\n                    onChange={(e) => setTime(e.target.value)}\r\n                    required\r\n                    className={errors.date ? 'border-red-300 dark:border-red-700 focus-visible:ring-red-500' : ''}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {errors.date && (\r\n                <div className=\"flex items-center gap-1.5 text-xs text-red-500 dark:text-red-400\">\r\n                  <AlertCircle className=\"h-3 w-3 flex-shrink-0\" />\r\n                  {errors.date}\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex items-center gap-1.5 text-[11px] text-muted-foreground\">\r\n                <Globe className=\"h-3 w-3\" />\r\n                {timezone}\r\n              </div>\r\n            </div>\r\n\r\n            {/* ---- Divider ---- */}\r\n            <div className=\"border-t border-border/40\" />\r\n\r\n            {/* ---- Social Account Section ---- */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\r\n                <Link2 className=\"h-4 w-4 text-muted-foreground\" />\r\n                Social Account\r\n              </div>\r\n\r\n              {accountsLoading ? (\r\n                <div className=\"flex items-center gap-2 py-3 text-sm text-muted-foreground\">\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  Loading accounts...\r\n                </div>\r\n              ) : activeAccounts.length === 0 ? (\r\n                <div className=\"rounded-lg border border-dashed border-border/60 bg-muted/20 p-4 text-center space-y-2\">\r\n                  <p className=\"text-sm text-muted-foreground\">No connected social accounts found.</p>\r\n                  <a\r\n                    href=\"/pipeline?tab=social\"\r\n                    className=\"inline-flex items-center gap-1.5 text-xs font-medium text-primary hover:text-primary/80 transition-colors\"\r\n                  >\r\n                    <ExternalLink className=\"h-3 w-3\" />\r\n                    Connect an account in Pipeline\r\n                  </a>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-1.5\">\r\n                  <Select value={connectionId} onValueChange={setConnectionId}>\r\n                    <SelectTrigger\r\n                      className={errors.connection ? 'border-red-300 dark:border-red-700 focus:ring-red-500' : ''}\r\n                    >\r\n                      <SelectValue placeholder=\"Select account...\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {activeAccounts.map((acc) => (\r\n                        <SelectItem key={acc.id} value={acc.id}>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-[10px] font-bold px-1.5 py-0.5 rounded bg-muted text-muted-foreground\">\r\n                              {PLATFORM_LIMITS[acc.platform?.toLowerCase()]?.icon ||\r\n                                acc.platform?.slice(0, 2).toUpperCase()}\r\n                            </span>\r\n                            <span>{acc.accountName}</span>\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n\r\n                  {errors.connection && (\r\n                    <div className=\"flex items-center gap-1.5 text-xs text-red-500 dark:text-red-400\">\r\n                      <AlertCircle className=\"h-3 w-3 flex-shrink-0\" />\r\n                      {errors.connection}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* ---- Divider ---- */}\r\n            <div className=\"border-t border-border/40\" />\r\n\r\n            {/* ---- Caption Section ---- */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\r\n                  <Hash className=\"h-4 w-4 text-muted-foreground\" />\r\n                  Caption\r\n                </div>\r\n                {platformConfig && (\r\n                  <span className=\"text-[11px] text-muted-foreground\">\r\n                    {platformConfig.name} limit: {platformConfig.limit.toLocaleString()}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"space-y-1.5\">\r\n                <Textarea\r\n                  id=\"schedule-caption\"\r\n                  value={caption}\r\n                  onChange={(e) => setCaption(e.target.value)}\r\n                  placeholder=\"Write your post caption...\"\r\n                  rows={5}\r\n                  className={`resize-none ${errors.caption ? 'border-red-300 dark:border-red-700 focus-visible:ring-red-500' : ''}`}\r\n                />\r\n\r\n                <div className=\"flex items-center justify-between\">\r\n                  {errors.caption ? (\r\n                    <div className=\"flex items-center gap-1.5 text-xs text-red-500 dark:text-red-400\">\r\n                      <AlertCircle className=\"h-3 w-3 flex-shrink-0\" />\r\n                      {errors.caption}\r\n                    </div>\r\n                  ) : (\r\n                    <span />\r\n                  )}\r\n\r\n                  <span className={`text-xs tabular-nums ${charCountColor}`}>\r\n                    {caption.length.toLocaleString()}\r\n                    {charLimit > 0 && <> / {charLimit.toLocaleString()}</>}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Progress bar for character usage */}\r\n                {charLimit > 0 && caption.length > 0 && (\r\n                  <div className=\"h-1 w-full bg-muted rounded-full overflow-hidden\">\r\n                    <div\r\n                      className={`h-full rounded-full transition-all duration-300 ${\r\n                        isOverLimit ? 'bg-red-500' : caption.length / charLimit > 0.9 ? 'bg-amber-500' : 'bg-primary/60'\r\n                      }`}\r\n                      style={{ width: `${Math.min((caption.length / charLimit) * 100, 100)}%` }}\r\n                    />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* ---- Hashtags Section ---- */}\r\n            <div className=\"space-y-1.5\">\r\n              <Label htmlFor=\"schedule-hashtags\" className=\"text-xs text-muted-foreground\">\r\n                Hashtags (optional, comma or space separated)\r\n              </Label>\r\n              <Input\r\n                id=\"schedule-hashtags\"\r\n                value={hashtags}\r\n                onChange={(e) => setHashtags(e.target.value)}\r\n                placeholder=\"#marketing, #brand, #growth\"\r\n              />\r\n            </div>\r\n\r\n            {/* ---- Divider ---- */}\r\n            <div className=\"border-t border-border/40\" />\r\n\r\n            {/* ---- Image Section ---- */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center gap-2 text-sm font-medium text-foreground\">\r\n                <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\r\n                Image (optional)\r\n              </div>\r\n\r\n              <div className=\"space-y-1.5\">\r\n                <Input\r\n                  id=\"schedule-image\"\r\n                  value={imageUrl}\r\n                  onChange={(e) => {\r\n                    setImageUrl(e.target.value);\r\n                    setImageError(false);\r\n                  }}\r\n                  placeholder=\"https://example.com/image.jpg\"\r\n                  className={errors.imageUrl ? 'border-red-300 dark:border-red-700 focus-visible:ring-red-500' : ''}\r\n                />\r\n\r\n                {errors.imageUrl && (\r\n                  <div className=\"flex items-center gap-1.5 text-xs text-red-500 dark:text-red-400\">\r\n                    <AlertCircle className=\"h-3 w-3 flex-shrink-0\" />\r\n                    {errors.imageUrl}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Live preview */}\r\n              {imageUrl && isValidUrl(imageUrl) && (\r\n                <div className=\"rounded-lg border border-border/60 overflow-hidden bg-muted/20\">\r\n                  {imageError ? (\r\n                    <div className=\"flex flex-col items-center justify-center py-8 text-center\">\r\n                      <ImageOff className=\"h-8 w-8 text-muted-foreground/40 mb-2\" />\r\n                      <p className=\"text-xs text-muted-foreground\">Could not load image preview</p>\r\n                    </div>\r\n                  ) : (\r\n                    <img\r\n                      src={imageUrl}\r\n                      alt=\"Post preview\"\r\n                      className=\"w-full max-h-48 object-contain\"\r\n                      onError={() => setImageError(true)}\r\n                      loading=\"lazy\"\r\n                    />\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* ---- Footer ---- */}\r\n          <DialogFooter className=\"px-6 py-4 border-t border-border/50 bg-muted/20 dark:bg-muted/5 gap-2 sm:gap-2\">\r\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)} className=\"flex-1 sm:flex-none\">\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={schedulePost.isPending || activeAccounts.length === 0}\r\n              className=\"flex-1 sm:flex-none gap-2\"\r\n            >\r\n              {schedulePost.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Calendar className=\"h-4 w-4\" />}\r\n              {schedulePost.isPending ? 'Scheduling...' : 'Schedule Post'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\chat\\ChatSlideOver.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4093,4096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4093,4096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5497,5500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5497,5500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5534,5537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5534,5537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5761,5764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5761,5764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * ChatSlideOver -- Full-height slide-over chat panel (Sheet-based).\n *\n * Reuses the existing useAgentChat hook and ChatMessage component from\n * the Studio AgentChat module. Designed to be opened from any page via\n * the GlobalChatButton FAB.\n */\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\n\nimport { cn } from '@/lib/utils';\nimport { Bot, Send, Square, Mic, MicOff, RefreshCw, Wrench, User } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from '@/components/ui/sheet';\nimport { useAgentChat, type ChatMessage as ChatMessageType } from '@/components/studio/AgentChat/useAgentChat';\n\n/* ------------------------------------------------------------------ */\n/*  Tool labels  same map used by the Studio ChatMessage              */\n/* ------------------------------------------------------------------ */\nconst TOOL_LABELS: Record<string, string> = {\n  list_products: 'Searching products',\n  get_product_details: 'Getting product info',\n  select_products: 'Selecting products',\n  set_prompt: 'Setting prompt',\n  set_output_settings: 'Configuring output',\n  generate_image: 'Generating image',\n  generate_ad_copy: 'Writing ad copy',\n  get_idea_suggestions: 'Getting ideas',\n  schedule_post: 'Scheduling post',\n  search_knowledge_base: 'Searching knowledge base',\n  list_templates: 'Browsing templates',\n  get_brand_profile: 'Loading brand profile',\n  analyze_image: 'Analyzing image',\n  get_campaign_stats: 'Fetching stats',\n};\n\n/* ------------------------------------------------------------------ */\n/*  Inline ChatBubble (self-contained  no import from Studio)         */\n/* ------------------------------------------------------------------ */\nfunction ChatBubble({ message }: { message: ChatMessageType }) {\n  const isUser = message.role === 'user';\n\n  return (\n    <div className={cn('flex gap-2.5', isUser ? 'flex-row-reverse' : 'flex-row')}>\n      {/* Avatar */}\n      <div\n        className={cn(\n          'flex-shrink-0 w-7 h-7 rounded-full flex items-center justify-center text-xs',\n          isUser ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground',\n        )}\n      >\n        {isUser ? <User className=\"w-3.5 h-3.5\" /> : <Bot className=\"w-3.5 h-3.5\" />}\n      </div>\n\n      {/* Content */}\n      <div className={cn('flex flex-col gap-1 max-w-[85%]', isUser ? 'items-end' : 'items-start')}>\n        {/* Tool calls */}\n        {message.toolCalls && message.toolCalls.length > 0 && (\n          <div className=\"flex flex-wrap gap-1\">\n            {message.toolCalls.map((tc, i) => (\n              <span\n                key={i}\n                className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-600 dark:text-amber-400 text-[10px] font-medium\"\n              >\n                <Wrench className=\"w-2.5 h-2.5\" />\n                {TOOL_LABELS[tc.name] ?? tc.name}\n              </span>\n            ))}\n          </div>\n        )}\n\n        {/* Message bubble */}\n        {message.content && (\n          <div\n            className={cn(\n              'rounded-2xl px-3.5 py-2 text-sm leading-relaxed whitespace-pre-wrap',\n              isUser ? 'bg-primary text-primary-foreground rounded-br-md' : 'bg-muted text-foreground rounded-bl-md',\n            )}\n          >\n            {message.content}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n/* ------------------------------------------------------------------ */\n/*  ChatSlideOver                                                      */\n/* ------------------------------------------------------------------ */\ninterface ChatSlideOverProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function ChatSlideOver({ isOpen, onOpenChange }: ChatSlideOverProps) {\n  const [input, setInput] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const recognitionRef = useRef<any>(null);\n\n  const { messages, isStreaming, error, sendMessage, stopStreaming, clearMessages } = useAgentChat();\n\n  // Auto-scroll on new messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Focus input when sheet opens\n  useEffect(() => {\n    if (isOpen) {\n      // Small delay so Sheet animation finishes first\n      const t = setTimeout(() => inputRef.current?.focus(), 300);\n      return () => clearTimeout(t);\n    }\n  }, [isOpen]);\n\n  // Clean up speech recognition on unmount\n  useEffect(() => {\n    return () => {\n      if (recognitionRef.current) {\n        try {\n          recognitionRef.current.stop();\n        } catch {\n          /* already stopped */\n        }\n        recognitionRef.current = null;\n      }\n    };\n  }, []);\n\n  const handleSubmit = (e?: React.FormEvent) => {\n    e?.preventDefault();\n    if (!input.trim() || isStreaming) return;\n    sendMessage(input);\n    setInput('');\n  };\n\n  const handleNewChat = useCallback(() => {\n    clearMessages();\n  }, [clearMessages]);\n\n  // Voice input (Web Speech API)\n  const toggleVoice = useCallback(() => {\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\n      return;\n    }\n\n    if (isListening) {\n      recognitionRef.current?.stop();\n      setIsListening(false);\n      return;\n    }\n\n    const SpeechRecognitionCtor = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    const recognition = new SpeechRecognitionCtor();\n    recognition.continuous = false;\n    recognition.interimResults = false;\n    recognition.lang = 'en-US';\n\n    recognition.onresult = (event: any) => {\n      const transcript = event.results[0]?.[0]?.transcript;\n      if (transcript) {\n        setInput(transcript);\n        setIsListening(false);\n      }\n    };\n    recognition.onerror = () => setIsListening(false);\n    recognition.onend = () => setIsListening(false);\n\n    recognitionRef.current = recognition;\n    recognition.start();\n    setIsListening(true);\n  }, [isListening]);\n\n  const hasSpeech =\n    typeof window !== 'undefined' && ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window);\n\n  return (\n    <Sheet open={isOpen} onOpenChange={onOpenChange}>\n      <SheetContent side=\"right\" className=\"w-full sm:max-w-[400px] p-0 flex flex-col gap-0 [&>button]:z-20\">\n        {/* Header */}\n        <SheetHeader className=\"px-4 py-3 border-b border-border flex-shrink-0\">\n          <div className=\"flex items-center justify-between pr-8\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center\">\n                <Bot className=\"w-4 h-4 text-white\" />\n              </div>\n              <div>\n                <SheetTitle className=\"text-sm font-semibold\">Ad Assistant</SheetTitle>\n                <SheetDescription className=\"text-[11px] text-muted-foreground\">\n                  Ask anything about your ads\n                </SheetDescription>\n              </div>\n            </div>\n\n            {messages.length > 0 && !isStreaming && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleNewChat}\n                className=\"h-7 px-2 text-xs text-muted-foreground hover:text-foreground\"\n              >\n                <RefreshCw className=\"w-3 h-3 mr-1\" />\n                New chat\n              </Button>\n            )}\n          </div>\n        </SheetHeader>\n\n        {/* Messages */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-hide\">\n          {messages.length === 0 && (\n            <div className=\"flex flex-col items-center justify-center h-full text-center py-12\">\n              <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3\">\n                <Bot className=\"w-6 h-6 text-muted-foreground\" />\n              </div>\n              <p className=\"text-sm font-medium mb-1\">How can I help?</p>\n              <p className=\"text-xs text-muted-foreground max-w-[240px]\">\n                Generate ads, write copy, schedule posts, search your knowledge base, and more.\n              </p>\n\n              {/* Quick-start suggestions */}\n              <div className=\"flex flex-wrap gap-1.5 mt-4 justify-center max-w-[300px]\">\n                {[\n                  'Generate an ad for my top product',\n                  'Write LinkedIn copy',\n                  'Show me my recent campaigns',\n                  'Schedule a post for tomorrow',\n                ].map((q) => (\n                  <button\n                    key={q}\n                    onClick={() => {\n                      setInput(q);\n                      // Auto-send after a tick so the user sees the input first\n                      setTimeout(() => {\n                        sendMessage(q);\n                        setInput('');\n                      }, 100);\n                    }}\n                    className=\"text-[11px] px-2.5 py-1.5 rounded-full border border-border hover:bg-muted/80 hover:border-primary/30 transition-colors text-muted-foreground\"\n                  >\n                    {q}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {messages.map((msg) => (\n            <ChatBubble key={msg.id} message={msg} />\n          ))}\n\n          {isStreaming && (\n            <div className=\"flex items-center gap-2 text-xs text-muted-foreground pl-9\">\n              <div className=\"flex gap-0.5\">\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary animate-bounce [animation-delay:0ms]\" />\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary animate-bounce [animation-delay:150ms]\" />\n                <div className=\"w-1.5 h-1.5 rounded-full bg-primary animate-bounce [animation-delay:300ms]\" />\n              </div>\n              Thinking...\n            </div>\n          )}\n\n          {error && <div className=\"text-xs text-destructive bg-destructive/10 rounded-lg px-3 py-2\">{error}</div>}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input */}\n        <form\n          onSubmit={handleSubmit}\n          className=\"flex items-center gap-2 p-3 border-t border-border flex-shrink-0 bg-background\"\n        >\n          {hasSpeech && (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={toggleVoice}\n              className={cn('h-8 w-8 p-0 flex-shrink-0', isListening && 'text-red-500')}\n            >\n              {isListening ? <MicOff className=\"w-4 h-4\" /> : <Mic className=\"w-4 h-4\" />}\n            </Button>\n          )}\n\n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder={isListening ? 'Listening...' : 'Type a message...'}\n            disabled={isStreaming}\n            className=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground\"\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSubmit();\n              }\n            }}\n          />\n\n          {isStreaming ? (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={stopStreaming}\n              className=\"h-8 w-8 p-0 text-destructive flex-shrink-0\"\n            >\n              <Square className=\"w-3.5 h-3.5\" />\n            </Button>\n          ) : (\n            <Button\n              type=\"submit\"\n              variant=\"ghost\"\n              size=\"sm\"\n              disabled={!input.trim()}\n              className=\"h-8 w-8 p-0 flex-shrink-0\"\n            >\n              <Send className=\"w-3.5 h-3.5\" />\n            </Button>\n          )}\n        </form>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\chat\\GlobalChatButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\IdeaBankAnalysisStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\IdeaBankHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\IdeaBankInputSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\IdeaBankPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\IdeaBankSuggestions.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMemo"},"fix":{"range":[33,42],"text":""},"desc":"Remove unused variable \"useMemo\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useCallback, useMemo } from \"react\";\r\nimport { RefreshCw, Target } from \"lucide-react\";\r\nimport { SuggestionCard } from \"./SuggestionCard\";\r\nimport { TemplateSlotCard } from \"./TemplateSlotCard\";\r\nimport type { IdeaBankSuggestionsProps, TemplateSlotSuggestion } from \"./types\";\r\n\r\nfunction IdeaBankSuggestionsComponent({\r\n  mode,\r\n  response,\r\n  slotSuggestions,\r\n  mergedPrompt,\r\n  templateContext,\r\n  templateId,\r\n  loading,\r\n  error,\r\n  selectedPromptId,\r\n  selectedSlotIndex,\r\n  isGenerating,\r\n  onSelectPrompt,\r\n  onQuickGenerate,\r\n  onSlotSelect,\r\n  onRecipeAvailable,\r\n  onSetPlatform,\r\n  onSetAspectRatio,\r\n}: IdeaBankSuggestionsProps) {\r\n  // Memoized handler for freestyle suggestions\r\n  const handleSuggestionUse = useCallback(\r\n    (prompt: string, id: string, reasoning?: string) => {\r\n      onSelectPrompt(prompt, id, reasoning);\r\n\r\n      // Pass recipe context to parent for /api/transform\r\n      if (onRecipeAvailable && response?.recipe) {\r\n        onRecipeAvailable(response.recipe);\r\n      }\r\n\r\n      // Find the suggestion to get platform/aspect ratio recommendations\r\n      const suggestion = response?.suggestions.find((s) => s.id === id);\r\n      if (suggestion) {\r\n        if (suggestion.recommendedPlatform && onSetPlatform) {\r\n          onSetPlatform(suggestion.recommendedPlatform);\r\n        }\r\n        if (suggestion.recommendedAspectRatio && onSetAspectRatio) {\r\n          onSetAspectRatio(suggestion.recommendedAspectRatio);\r\n        }\r\n      }\r\n    },\r\n    [onSelectPrompt, onRecipeAvailable, response, onSetPlatform, onSetAspectRatio]\r\n  );\r\n\r\n  // Memoized handler for quick generate\r\n  const handleQuickGenerate = useCallback(\r\n    (prompt: string, suggestionId: string) => {\r\n      if (!onQuickGenerate) return;\r\n\r\n      const suggestion = response?.suggestions.find((s) => s.id === suggestionId);\r\n      if (!suggestion) return;\r\n\r\n      // First set the prompt so user can see what's generating\r\n      onSelectPrompt(prompt, suggestionId, suggestion.reasoning);\r\n\r\n      // Pass recipe context to parent for /api/transform\r\n      if (onRecipeAvailable && response?.recipe) {\r\n        onRecipeAvailable(response.recipe);\r\n      }\r\n\r\n      // Auto-set platform if recommendation exists\r\n      if (suggestion.recommendedPlatform && onSetPlatform) {\r\n        onSetPlatform(suggestion.recommendedPlatform);\r\n      }\r\n\r\n      // Then trigger generation\r\n      onQuickGenerate(prompt);\r\n    },\r\n    [onQuickGenerate, onSelectPrompt, onRecipeAvailable, response, onSetPlatform]\r\n  );\r\n\r\n  // Memoized handler for slot suggestion selection\r\n  const handleSlotUse = useCallback(\r\n    (index: number, suggestion: TemplateSlotSuggestion, prompt: string) => {\r\n      onSlotSelect(index, suggestion, prompt);\r\n      onSelectPrompt(prompt, `slot-${index}`, suggestion.reasoning);\r\n    },\r\n    [onSlotSelect, onSelectPrompt]\r\n  );\r\n\r\n  // Loading State\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-8\">\r\n        <RefreshCw className=\"w-6 h-6 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error State\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-4 rounded-lg bg-red-500/10 border border-red-500/30 text-red-500 text-sm\">\r\n        {error}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Template Mode\r\n  if (mode === \"template\") {\r\n    return (\r\n      <>\r\n        {/* Template Context Info */}\r\n        {templateContext && (\r\n          <div className=\"p-3 rounded-lg bg-amber-500/10 dark:bg-amber-500/20 border border-amber-500/30 dark:border-amber-500/20 text-sm\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <Target className=\"w-4 h-4 text-amber-600\" />\r\n              <span className=\"font-medium text-amber-700 dark:text-amber-400\">\r\n                {templateContext.title}\r\n              </span>\r\n              <span className=\"text-xs px-2 py-0.5 rounded bg-amber-500/20 dark:bg-amber-500/30 text-amber-600 dark:text-amber-400\">\r\n                {templateContext.category}\r\n              </span>\r\n            </div>\r\n            {templateContext.environment && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Environment: {templateContext.environment} | Mood: {templateContext.mood || \"N/A\"} |\r\n                Lighting: {templateContext.lightingStyle || \"N/A\"}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Slot Suggestions Grid */}\r\n        {slotSuggestions.length > 0 && (\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-xs text-muted-foreground\">\r\n                {slotSuggestions.length} slot{\" \"}\r\n                {slotSuggestions.length === 1 ? \"suggestion\" : \"suggestions\"} for this template\r\n              </span>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n              {slotSuggestions.map((suggestion, index) => (\r\n                <TemplateSlotCard\r\n                  key={`slot-${index}`}\r\n                  suggestion={suggestion}\r\n                  onUse={(slotSuggestion, prompt) => handleSlotUse(index, slotSuggestion, prompt)}\r\n                  index={index}\r\n                  isSelected={selectedSlotIndex === index}\r\n                  mergedPrompt={mergedPrompt}\r\n                />\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Empty State - No Slot Suggestions */}\r\n        {slotSuggestions.length === 0 && templateId && (\r\n          <p className=\"text-sm text-muted-foreground text-center py-4\">\r\n            No slot suggestions available. Click refresh to try again.\r\n          </p>\r\n        )}\r\n\r\n        {/* No Template Selected */}\r\n        {!templateId && (\r\n          <p className=\"text-sm text-muted-foreground text-center py-4\">\r\n            Select a template to get AI-powered slot suggestions.\r\n          </p>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Freestyle Mode\r\n  if (response && response.suggestions.length > 0) {\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <span className=\"text-xs text-muted-foreground\">\r\n            {response.suggestions.length} AI-generated{\" \"}\r\n            {response.suggestions.length === 1 ? \"idea\" : \"ideas\"}\r\n          </span>\r\n          {onQuickGenerate && (\r\n            <span className=\"text-xs text-green-600 dark:text-green-400\">\r\n              Click \"Generate\" to start immediately\r\n            </span>\r\n          )}\r\n        </div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n          {response.suggestions.map((suggestion, index) => (\r\n            <SuggestionCard\r\n              key={suggestion.id}\r\n              suggestion={suggestion}\r\n              onUse={handleSuggestionUse}\r\n              onQuickGenerate={\r\n                onQuickGenerate\r\n                  ? (prompt) => handleQuickGenerate(prompt, suggestion.id)\r\n                  : undefined\r\n              }\r\n              index={index}\r\n              isSelected={selectedPromptId === suggestion.id}\r\n              isGenerating={isGenerating}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Empty State - Freestyle Mode\r\n  if (response && response.suggestions.length === 0) {\r\n    return (\r\n      <p className=\"text-sm text-muted-foreground text-center py-4\">\r\n        No suggestions available. Click refresh to try again.\r\n      </p>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport const IdeaBankSuggestions = memo(IdeaBankSuggestionsComponent);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\ModeBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\SourceIndicators.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\SuggestionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\TemplateSlotCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\ideabank\\useIdeaBankFetch.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'doFetch', 'selectedProducts.length', and 'selectedUploads.length'. Either include them or remove the dependency array.","line":253,"column":6,"nodeType":"ArrayExpression","endLine":253,"endColumn":62,"suggestions":[{"desc":"Update the dependencies array to be: [productIdsKey, uploadDescriptionsKey, mode, templateId, selectedProducts.length, selectedUploads.length, doFetch]","fix":{"range":[9123,9179],"text":"[productIdsKey, uploadDescriptionsKey, mode, templateId, selectedProducts.length, selectedUploads.length, doFetch]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\layout\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\monitoring\\ErrorTrackingTab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[347,382],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Activity, AlertTriangle, ChevronDown, ChevronUp } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ErrorEvent {\r\n  id: string;\r\n  timestamp: string;\r\n  statusCode: number;\r\n  message: string;\r\n  endpoint: string;\r\n  method: string;\r\n  userAgent?: string;\r\n  stack?: string;\r\n  fingerprint: string;\r\n}\r\n\r\ninterface ErrorStats {\r\n  total: number;\r\n  last5min: number;\r\n  last1hour: number;\r\n  byStatusCode: Record<string, number>;\r\n  byEndpoint: Record<string, number>;\r\n  byFingerprint: Record<string, number>;\r\n}\r\n\r\ninterface ErrorsResponse {\r\n  errors: ErrorEvent[];\r\n  stats: ErrorStats;\r\n}\r\n\r\nasync function fetchErrors(): Promise<ErrorsResponse> {\r\n  const res = await fetch('/api/monitoring/errors');\r\n  if (!res.ok) throw new Error('Failed to fetch errors');\r\n  return res.json();\r\n}\r\n\r\nexport function ErrorTrackingTab() {\r\n  const [expandedErrors, setExpandedErrors] = useState<Set<string>>(new Set());\r\n\r\n  const { data, isLoading } = useQuery({\r\n    queryKey: ['error-tracking'],\r\n    queryFn: fetchErrors,\r\n    refetchInterval: 10000, // Refresh every 10 seconds\r\n  });\r\n\r\n  const toggleExpanded = (id: string) => {\r\n    setExpandedErrors(prev => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) {\r\n        next.delete(id);\r\n      } else {\r\n        next.add(id);\r\n      }\r\n      return next;\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <Activity className=\"w-8 h-8 animate-pulse text-muted-foreground\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!data) return null;\r\n\r\n  const { errors, stats } = data;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Errors</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.total}</div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Last 5 Minutes</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{stats.last5min}</div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Last Hour</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-yellow-700 dark:text-yellow-400\">{stats.last1hour}</div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Unique Errors</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{Object.keys(stats.byFingerprint).length}</div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Recent Errors */}\r\n      {errors.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"flex flex-col items-center justify-center h-64 text-muted-foreground\">\r\n            <AlertTriangle className=\"w-12 h-12 mb-4 text-green-600 dark:text-green-400\" />\r\n            <p className=\"text-lg font-medium\">No Errors!</p>\r\n            <p className=\"text-sm\">Your application is running smoothly.</p>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <AlertTriangle className=\"w-5 h-5\" />\r\n              Recent Errors ({errors.length})\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-2\">\r\n            {errors.map((error) => {\r\n              const isExpanded = expandedErrors.has(error.id);\r\n              return (\r\n                <div key={error.id} className=\"border rounded-lg p-4 hover:bg-muted/50\">\r\n                  <div className=\"flex items-start justify-between gap-4\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Badge variant=\"outline\" className=\"text-xs bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-400\">\r\n                          {error.statusCode}\r\n                        </Badge>\r\n                        <Badge variant=\"outline\" className=\"text-xs\">\r\n                          {error.method}\r\n                        </Badge>\r\n                        <span className=\"text-xs text-muted-foreground\">\r\n                          {new Date(error.timestamp).toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-sm font-medium break-words\">{error.message}</p>\r\n                      <p className=\"text-xs text-muted-foreground font-mono mt-1 break-words\">{error.endpoint}</p>\r\n                    </div>\r\n                    {error.stack && (\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => toggleExpanded(error.id)}\r\n                        className=\"flex-shrink-0\"\r\n                      >\r\n                        {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                  {isExpanded && error.stack && (\r\n                    <div className=\"mt-3 pt-3 border-t\">\r\n                      <p className=\"text-xs font-medium text-muted-foreground mb-2\">Stack Trace:</p>\r\n                      <pre className=\"text-xs bg-muted/50 p-2 rounded overflow-x-auto whitespace-pre-wrap break-words\">\r\n                        {error.stack}\r\n                      </pre>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\monitoring\\PerformanceTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\monitoring\\SystemHealthTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\onboarding\\BusinessOnboarding.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\onboarding\\OnboardingGate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\planner\\WeeklyPlanView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4652,4655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4652,4655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5235,5238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5235,5238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5325,5328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5325,5328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6466,6469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6466,6469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8608,8611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8608,8611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9263,9266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9263,9266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * WeeklyPlanView  Dashboard component for the weekly content plan.\n *\n * Shows a week-at-a-glance with post cards, status badges,\n * action buttons, week navigation, and strategy balance bars.\n */\n\nimport { useMemo, useState, useCallback } from 'react';\nimport { useLocation } from 'wouter';\nimport { useWeeklyPlan, useUpdatePlanPost, useRegeneratePlan } from '@/hooks/useWeeklyPlan';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport {\n  ChevronLeft,\n  ChevronRight,\n  RefreshCw,\n  Calendar,\n  ArrowRight,\n  CheckCircle,\n  Clock,\n  Lightbulb,\n  Package,\n  Eye,\n} from 'lucide-react';\n\n/* ------------------------------------------------------------------ */\n/*  Helpers                                                            */\n/* ------------------------------------------------------------------ */\n\nconst DAY_LABELS: Record<string, string> = {\n  monday: 'MON',\n  tuesday: 'TUE',\n  wednesday: 'WED',\n  thursday: 'THU',\n  friday: 'FRI',\n  saturday: 'SAT',\n  sunday: 'SUN',\n};\n\nconst CATEGORY_COLORS: Record<string, string> = {\n  product_showcase: 'bg-blue-100 text-blue-800 border-blue-200',\n  educational: 'bg-green-100 text-green-800 border-green-200',\n  industry_insights: 'bg-purple-100 text-purple-800 border-purple-200',\n  company_updates: 'bg-orange-100 text-orange-800 border-orange-200',\n  engagement: 'bg-pink-100 text-pink-800 border-pink-200',\n  promotional: 'bg-yellow-100 text-yellow-800 border-yellow-200',\n  behind_the_scenes: 'bg-teal-100 text-teal-800 border-teal-200',\n};\n\nconst STATUS_CONFIG: Record<string, { label: string; className: string; icon: React.ElementType }> = {\n  planned: { label: 'Planned', className: 'bg-gray-100 text-gray-700 border-gray-200', icon: Clock },\n  in_progress: { label: 'In Progress', className: 'bg-yellow-100 text-yellow-800 border-yellow-200', icon: RefreshCw },\n  generated: { label: 'Generated', className: 'bg-blue-100 text-blue-800 border-blue-200', icon: CheckCircle },\n  approved: { label: 'Approved', className: 'bg-green-100 text-green-800 border-green-200', icon: CheckCircle },\n  scheduled: { label: 'Scheduled', className: 'bg-emerald-100 text-emerald-800 border-emerald-200', icon: Calendar },\n};\n\nconst PLATFORM_LABELS: Record<string, string> = {\n  linkedin: 'LinkedIn',\n  instagram: 'Instagram',\n  facebook: 'Facebook',\n  twitter: 'X (Twitter)',\n};\n\n/** Get the Monday of the week containing `date`. */\nfunction getMonday(date: Date): Date {\n  const d = new Date(date);\n  const day = d.getDay();\n  // Sunday = 0, Monday = 1, ...\n  const diff = day === 0 ? -6 : 1 - day;\n  d.setDate(d.getDate() + diff);\n  d.setHours(0, 0, 0, 0);\n  return d;\n}\n\n/** Shift a date by N weeks. */\nfunction shiftWeek(isoDate: string, weeks: number): string {\n  const d = new Date(isoDate);\n  d.setDate(d.getDate() + weeks * 7);\n  return d.toISOString();\n}\n\n/** Format a date as \"Feb 16, 2026\". */\nfunction formatWeekLabel(isoDate: string): string {\n  const d = new Date(isoDate);\n  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\n}\n\n/** Format a date as \"16\" for the card day number. */\nfunction formatDayNum(isoDate: string): string {\n  return new Date(isoDate).getDate().toString();\n}\n\n/** Pretty-print a category slug. */\nfunction formatCategory(slug: string): string {\n  return slug\n    .split('_')\n    .map((w) => w.charAt(0).toUpperCase() + w.slice(1))\n    .join(' ');\n}\n\n/* ------------------------------------------------------------------ */\n/*  Component                                                          */\n/* ------------------------------------------------------------------ */\n\nexport default function WeeklyPlanView() {\n  const [, navigate] = useLocation();\n\n  // Week navigation state  undefined = current week\n  const [weekStart, setWeekStart] = useState<string | undefined>(undefined);\n\n  const { data: plan, isLoading, error } = useWeeklyPlan(weekStart);\n  const _updatePost = useUpdatePlanPost();\n  const regenerate = useRegeneratePlan();\n\n  // Compute the display week label from plan or fallback\n  const displayWeekStart = useMemo(() => {\n    if (plan?.weekStart) return new Date(plan.weekStart).toISOString();\n    if (weekStart) return weekStart;\n    return getMonday(new Date()).toISOString();\n  }, [plan, weekStart]);\n\n  // Progress counts\n  const counts = useMemo(() => {\n    if (!plan?.posts) return { total: 0, planned: 0, generated: 0, scheduled: 0, inProgress: 0, approved: 0 };\n    const posts = plan.posts as any[];\n    return {\n      total: posts.length,\n      planned: posts.filter((p) => p.status === 'planned').length,\n      inProgress: posts.filter((p) => p.status === 'in_progress').length,\n      generated: posts.filter((p) => p.status === 'generated').length,\n      approved: posts.filter((p) => p.status === 'approved').length,\n      scheduled: posts.filter((p) => p.status === 'scheduled').length,\n    };\n  }, [plan]);\n\n  // Strategy balance (actual vs target from metadata)\n  const strategyBalance = useMemo(() => {\n    if (!plan?.posts) return [];\n    const posts = plan.posts as any[];\n    const total = posts.length || 1;\n    const categoryTargets = (plan.metadata as any)?.categoryTargets ?? {};\n\n    // Compute actual percentages\n    const actual: Record<string, number> = {};\n    for (const p of posts) {\n      actual[p.category] = (actual[p.category] ?? 0) + 1;\n    }\n\n    // Merge all categories from actual + targets\n    const allCategories = new Set([...Object.keys(actual), ...Object.keys(categoryTargets)]);\n\n    return Array.from(allCategories).map((cat) => ({\n      category: cat,\n      actualPercent: Math.round(((actual[cat] ?? 0) / total) * 100),\n      targetPercent: categoryTargets[cat] != null ? Math.round(categoryTargets[cat] * 100) : undefined,\n    }));\n  }, [plan]);\n\n  // Handlers\n  const handlePrevWeek = useCallback(() => {\n    setWeekStart(shiftWeek(displayWeekStart, -1));\n  }, [displayWeekStart]);\n\n  const handleNextWeek = useCallback(() => {\n    setWeekStart(shiftWeek(displayWeekStart, 1));\n  }, [displayWeekStart]);\n\n  const handleRegenerate = useCallback(() => {\n    if (plan?.id) {\n      regenerate.mutate(plan.id);\n    }\n  }, [plan, regenerate]);\n\n  const handleCreateNow = useCallback(\n    (postIndex: number) => {\n      if (!plan) return;\n      const post = (plan.posts as any[])[postIndex];\n      const params = new URLSearchParams({\n        planId: plan.id,\n        postIndex: String(postIndex),\n      });\n      if (post?.productIds?.length) {\n        params.set('productId', post.productIds[0]);\n      }\n      navigate(`/?${params.toString()}`);\n    },\n    [plan, navigate],\n  );\n\n  /* ---------------------------------------------------------------- */\n  /*  Render  Loading                                                 */\n  /* ---------------------------------------------------------------- */\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n          <Skeleton className=\"h-6 w-48\" />\n          <div className=\"flex gap-2\">\n            <Skeleton className=\"h-8 w-8 rounded\" />\n            <Skeleton className=\"h-8 w-8 rounded\" />\n            <Skeleton className=\"h-8 w-8 rounded\" />\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          <Skeleton className=\"h-4 w-64\" />\n          {Array.from({ length: 5 }).map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full rounded-lg\" />\n          ))}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  /* ---------------------------------------------------------------- */\n  /*  Render  Error                                                   */\n  /* ---------------------------------------------------------------- */\n\n  if (error) {\n    return (\n      <Card>\n        <CardContent className=\"py-8 text-center\">\n          <p className=\"text-muted-foreground mb-2\">Failed to load weekly plan</p>\n          <p className=\"text-sm text-destructive\">{(error as Error).message}</p>\n          <Button variant=\"outline\" size=\"sm\" className=\"mt-4\" onClick={() => setWeekStart(undefined)}>\n            Try current week\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  /* ---------------------------------------------------------------- */\n  /*  Render  Empty                                                   */\n  /* ---------------------------------------------------------------- */\n\n  if (!plan || !(plan.posts as any[])?.length) {\n    return (\n      <Card>\n        <CardContent className=\"py-12 text-center\">\n          <Calendar className=\"mx-auto h-10 w-10 text-muted-foreground mb-3\" />\n          <p className=\"font-medium mb-1\">No weekly plan yet</p>\n          <p className=\"text-sm text-muted-foreground\">Set up your content strategy to generate weekly plans.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  /* ---------------------------------------------------------------- */\n  /*  Render  Plan                                                    */\n  /* ---------------------------------------------------------------- */\n\n  const posts = plan.posts as any[];\n\n  return (\n    <Card>\n      {/* Header  week label + navigation */}\n      <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n        <div>\n          <CardTitle className=\"text-lg\">\n            <Calendar className=\"inline-block h-5 w-5 mr-2 -mt-0.5\" />\n            Week of {formatWeekLabel(displayWeekStart)}\n          </CardTitle>\n          <p className=\"text-sm text-muted-foreground mt-1\">\n            {counts.total} posts planned\n            {counts.generated > 0 && <> &middot; {counts.generated} generated</>}\n            {counts.scheduled > 0 && <> &middot; {counts.scheduled} scheduled</>}\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" onClick={handlePrevWeek} title=\"Previous week\">\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" onClick={handleNextWeek} title=\"Next week\">\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={handleRegenerate}\n            disabled={regenerate.isPending}\n            title=\"Regenerate plan\"\n          >\n            <RefreshCw className={`h-4 w-4 ${regenerate.isPending ? 'animate-spin' : ''}`} />\n          </Button>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"space-y-3\">\n        {/* Post cards */}\n        {posts.map((post, idx) => {\n          const statusCfg = STATUS_CONFIG[post.status] ?? STATUS_CONFIG.planned;\n          const StatusIcon = statusCfg.icon;\n          const catColor = CATEGORY_COLORS[post.category] ?? 'bg-gray-100 text-gray-700 border-gray-200';\n\n          return (\n            <div key={idx} className=\"border rounded-lg p-4 hover:shadow-sm transition-shadow\">\n              {/* Top row  day + category + platform */}\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-mono text-xs font-bold text-muted-foreground\">\n                    {DAY_LABELS[post.dayOfWeek] ?? post.dayOfWeek?.toUpperCase()} {formatDayNum(post.scheduledDate)}\n                  </span>\n                  <Badge variant=\"outline\" className={catColor}>\n                    {formatCategory(post.category)}\n                  </Badge>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {PLATFORM_LABELS[post.platform] ?? post.platform}\n                  </Badge>\n                </div>\n                <Badge variant=\"outline\" className={statusCfg.className}>\n                  <StatusIcon className=\"h-3 w-3 mr-1\" />\n                  {statusCfg.label}\n                </Badge>\n              </div>\n\n              {/* Briefing + product */}\n              {post.productIds?.length > 0 && (\n                <p className=\"text-sm flex items-center gap-1 mb-1\">\n                  <Package className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                  <span className=\"text-muted-foreground\">\n                    {post.productIds.length} product{post.productIds.length > 1 ? 's' : ''}\n                  </span>\n                </p>\n              )}\n              {post.briefing && (\n                <p className=\"text-sm text-muted-foreground flex items-start gap-1\">\n                  <Lightbulb className=\"h-3.5 w-3.5 mt-0.5 shrink-0\" />\n                  <span className=\"line-clamp-2\">{post.briefing}</span>\n                </p>\n              )}\n\n              {/* Suggested time */}\n              {post.suggestedTime && (\n                <p className=\"text-xs text-muted-foreground mt-1 flex items-center gap-1\">\n                  <Clock className=\"h-3 w-3\" />\n                  Suggested time: {post.suggestedTime}\n                </p>\n              )}\n\n              {/* Action buttons */}\n              <div className=\"flex items-center gap-2 mt-3\">\n                {post.status === 'planned' && (\n                  <Button size=\"sm\" onClick={() => handleCreateNow(idx)}>\n                    Create Now <ArrowRight className=\"h-3.5 w-3.5 ml-1\" />\n                  </Button>\n                )}\n                {post.status === 'in_progress' && (\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => handleCreateNow(idx)}>\n                    Continue in Studio <ArrowRight className=\"h-3.5 w-3.5 ml-1\" />\n                  </Button>\n                )}\n                {post.status === 'generated' && (\n                  <>\n                    <Button size=\"sm\" variant=\"outline\" onClick={() => handleCreateNow(idx)}>\n                      <Eye className=\"h-3.5 w-3.5 mr-1\" /> Review\n                    </Button>\n                    <Button size=\"sm\" onClick={() => handleCreateNow(idx)}>\n                      Schedule <ArrowRight className=\"h-3.5 w-3.5 ml-1\" />\n                    </Button>\n                  </>\n                )}\n                {post.status === 'approved' && (\n                  <Button size=\"sm\" onClick={() => handleCreateNow(idx)}>\n                    Schedule <ArrowRight className=\"h-3.5 w-3.5 ml-1\" />\n                  </Button>\n                )}\n                {post.status === 'scheduled' && (\n                  <Badge variant=\"outline\" className=\"bg-emerald-50 text-emerald-700 border-emerald-200\">\n                    <CheckCircle className=\"h-3 w-3 mr-1\" />\n                    Scheduled\n                  </Badge>\n                )}\n              </div>\n            </div>\n          );\n        })}\n\n        {/* Strategy balance section */}\n        {strategyBalance.length > 0 && (\n          <div className=\"border-t pt-4 mt-4\">\n            <h4 className=\"text-sm font-medium mb-3\">Strategy Balance</h4>\n            <div className=\"space-y-2\">\n              {strategyBalance.map(({ category, actualPercent, targetPercent }) => {\n                const _catColor = CATEGORY_COLORS[category] ?? 'bg-gray-100 text-gray-700';\n                const overTarget = targetPercent != null && actualPercent > targetPercent + 10;\n\n                return (\n                  <div key={category} className=\"flex items-center gap-3 text-sm\">\n                    <span className=\"w-32 truncate text-muted-foreground\">{formatCategory(category)}</span>\n                    <div className=\"flex-1 h-2 bg-muted rounded-full overflow-hidden\">\n                      <div\n                        className={`h-full rounded-full transition-all ${overTarget ? 'bg-amber-500' : 'bg-primary'}`}\n                        style={{ width: `${Math.min(actualPercent, 100)}%` }}\n                      />\n                    </div>\n                    <span className=\"w-20 text-xs text-right text-muted-foreground\">\n                      {actualPercent}%\n                      {targetPercent != null && (\n                        <span className={overTarget ? ' text-amber-600' : ''}> (target {targetPercent}%)</span>\n                      )}\n                    </span>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\CostCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\GoogleSyncStatus.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1915,1918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1915,1918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\nimport { useState } from \"react\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\r\nimport {\r\n  Cloud,\r\n  CloudOff,\r\n  RefreshCw,\r\n  CheckCircle2,\r\n  AlertTriangle,\r\n  XCircle,\r\n  Clock,\r\n  History,\r\n} from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { formatDistanceToNow, format } from \"date-fns\";\r\n\r\ninterface GoogleSyncStatusData {\r\n  isConfigured: boolean;\r\n  lastSyncedAt: string | null;\r\n  nextSyncAt: string | null;\r\n  syncIntervalMs: number;\r\n  status: 'success' | 'partial' | 'failed' | 'never_synced';\r\n  errorMessage?: string;\r\n  lastSnapshot?: {\r\n    quotas: Array<{\r\n      metricName: string;\r\n      displayName: string;\r\n      usage: number;\r\n      limit: number;\r\n      percentage: number;\r\n      unit: string;\r\n    }>;\r\n    projectId: string;\r\n    service: string;\r\n  };\r\n}\r\n\r\ninterface SyncHistoryEntry {\r\n  id: string;\r\n  startedAt: string;\r\n  completedAt: string | null;\r\n  durationMs: number | null;\r\n  status: string;\r\n  errorMessage: string | null;\r\n  metricsRequested: number;\r\n  metricsFetched: number;\r\n  triggerType: string;\r\n}\r\n\r\nasync function fetchGoogleSyncStatus(): Promise<GoogleSyncStatusData> {\r\n  const res = await fetch('/api/quota/google/status');\r\n  if (!res.ok) throw new Error('Failed to fetch Google sync status');\r\n  return res.json();\r\n}\r\n\r\nasync function fetchSyncHistory(): Promise<{ history: SyncHistoryEntry[] }> {\r\n  const res = await fetch('/api/quota/google/history?limit=5');\r\n  if (!res.ok) throw new Error('Failed to fetch sync history');\r\n  return res.json();\r\n}\r\n\r\nasync function triggerManualSync(): Promise<{ success: boolean; snapshot: any }> {\r\n  const res = await fetch('/api/quota/google/sync', { method: 'POST' });\r\n  if (!res.ok) throw new Error('Failed to trigger sync');\r\n  return res.json();\r\n}\r\n\r\nconst statusConfig = {\r\n  success: { icon: CheckCircle2, color: 'bg-green-500/10 dark:bg-green-500/20 text-green-600 dark:text-green-400 border-green-500/30 dark:border-green-500/20', label: 'Synced' },\r\n  partial: { icon: AlertTriangle, color: 'bg-yellow-500/10 dark:bg-yellow-500/20 text-yellow-600 dark:text-yellow-400 border-yellow-500/30 dark:border-yellow-500/20', label: 'Partial' },\r\n  failed: { icon: XCircle, color: 'bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-400 border-red-500/30 dark:border-red-500/20', label: 'Failed' },\r\n  never_synced: { icon: Clock, color: 'bg-gray-500/10 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400 border-gray-500/30 dark:border-gray-500/20', label: 'Never Synced' },\r\n};\r\n\r\nexport function GoogleSyncStatus() {\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data: syncStatus, isLoading: statusLoading } = useQuery({\r\n    queryKey: ['google-sync-status'],\r\n    queryFn: fetchGoogleSyncStatus,\r\n    refetchInterval: 30000, // Refresh every 30 seconds\r\n  });\r\n\r\n  const { data: historyData, isLoading: historyLoading } = useQuery({\r\n    queryKey: ['google-sync-history'],\r\n    queryFn: fetchSyncHistory,\r\n    enabled: showHistory,\r\n  });\r\n\r\n  const syncMutation = useMutation({\r\n    mutationFn: triggerManualSync,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['google-sync-status'] });\r\n      queryClient.invalidateQueries({ queryKey: ['google-sync-history'] });\r\n      queryClient.invalidateQueries({ queryKey: ['quota-status'] });\r\n    },\r\n  });\r\n\r\n  if (statusLoading) {\r\n    return (\r\n      <Card className=\"bg-card/50 backdrop-blur\">\r\n        <CardContent className=\"flex items-center justify-center h-32\">\r\n          <RefreshCw className=\"w-6 h-6 animate-spin text-muted-foreground\" />\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (!syncStatus) return null;\r\n\r\n  const StatusIcon = statusConfig[syncStatus.status].icon;\r\n  const timeToNextSync = syncStatus.nextSyncAt\r\n    ? Math.max(0, Math.round((new Date(syncStatus.nextSyncAt).getTime() - Date.now()) / 1000 / 60))\r\n    : null;\r\n\r\n  return (\r\n    <Card className=\"bg-card/50 backdrop-blur\">\r\n      <CardHeader className=\"pb-3\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            {syncStatus.isConfigured ? (\r\n              <Cloud className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n            ) : (\r\n              <CloudOff className=\"w-5 h-5 text-muted-foreground\" />\r\n            )}\r\n            Google Cloud Sync\r\n          </CardTitle>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Badge\r\n              variant=\"outline\"\r\n              className={cn(\"px-2 py-0.5\", statusConfig[syncStatus.status].color)}\r\n            >\r\n              <StatusIcon className=\"w-3 h-3 mr-1\" />\r\n              {statusConfig[syncStatus.status].label}\r\n            </Badge>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className=\"h-8 w-8\"\r\n              onClick={() => setShowHistory(!showHistory)}\r\n            >\r\n              <History className=\"w-4 h-4\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        {!syncStatus.isConfigured ? (\r\n          <Alert variant=\"default\" className=\"bg-yellow-500/10 dark:bg-yellow-500/20 border-yellow-500/30 dark:border-yellow-500/20\">\r\n            <AlertTriangle className=\"h-4 w-4 text-yellow-600 dark:text-yellow-400\" />\r\n            <AlertTitle>Not Configured</AlertTitle>\r\n            <AlertDescription className=\"text-sm\">\r\n              Google Cloud Monitoring is not configured. Set the following environment variables:\r\n              <ul className=\"list-disc list-inside mt-2 text-xs\">\r\n                <li>GOOGLE_CLOUD_PROJECT - Your GCP project ID</li>\r\n                <li>GOOGLE_APPLICATION_CREDENTIALS - Path to service account JSON</li>\r\n                <li>Or GOOGLE_CLOUD_CREDENTIALS_JSON - Inline JSON credentials</li>\r\n              </ul>\r\n            </AlertDescription>\r\n          </Alert>\r\n        ) : (\r\n          <>\r\n            {/* Sync Timing */}\r\n            <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n              <div>\r\n                <div className=\"text-xs text-muted-foreground mb-1\">Last Synced</div>\r\n                <div className=\"font-medium\">\r\n                  {syncStatus.lastSyncedAt\r\n                    ? formatDistanceToNow(new Date(syncStatus.lastSyncedAt), { addSuffix: true })\r\n                    : 'Never'}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-xs text-muted-foreground mb-1\">Next Sync</div>\r\n                <div className=\"font-medium\">\r\n                  {timeToNextSync !== null\r\n                    ? `in ${timeToNextSync} min`\r\n                    : 'Not scheduled'}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Error Message */}\r\n            {syncStatus.errorMessage && (\r\n              <Alert variant=\"destructive\" className=\"bg-red-500/10 dark:bg-red-500/20 border-red-500/30 dark:border-red-500/20\">\r\n                <XCircle className=\"h-4 w-4\" />\r\n                <AlertDescription className=\"text-xs\">\r\n                  {syncStatus.errorMessage}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n\r\n            {/* Google Quota Metrics */}\r\n            {syncStatus.lastSnapshot?.quotas && syncStatus.lastSnapshot.quotas.length > 0 && (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"text-xs text-muted-foreground\">Google Cloud Metrics</div>\r\n                {syncStatus.lastSnapshot.quotas.map((quota, idx) => (\r\n                  <div key={idx} className=\"flex justify-between items-center text-sm py-1 border-b border-border/50 last:border-0\">\r\n                    <span className=\"text-muted-foreground\">{quota.displayName}</span>\r\n                    <span className=\"font-medium\">\r\n                      {quota.usage.toLocaleString()} / {quota.limit.toLocaleString()} {quota.unit}\r\n                    </span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Manual Sync Button */}\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"w-full\"\r\n              onClick={() => syncMutation.mutate()}\r\n              disabled={syncMutation.isPending}\r\n            >\r\n              {syncMutation.isPending ? (\r\n                <>\r\n                  <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Syncing...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n                  Sync Now\r\n                </>\r\n              )}\r\n            </Button>\r\n          </>\r\n        )}\r\n\r\n        {/* Sync History */}\r\n        {showHistory && (\r\n          <div className=\"space-y-2 pt-2 border-t\">\r\n            <div className=\"text-xs text-muted-foreground font-medium\">Sync History</div>\r\n            {historyLoading ? (\r\n              <div className=\"text-xs text-muted-foreground\">Loading...</div>\r\n            ) : historyData?.history && historyData.history.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {historyData.history.map((entry) => (\r\n                  <div\r\n                    key={entry.id}\r\n                    className=\"flex items-center justify-between text-xs py-1\"\r\n                  >\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Badge\r\n                        variant=\"outline\"\r\n                        className={cn(\r\n                          \"text-[10px] px-1 py-0\",\r\n                          entry.status === 'success' ? 'bg-green-500/10 dark:bg-green-500/20 text-green-600 dark:text-green-400' :\r\n                          entry.status === 'partial' ? 'bg-yellow-500/10 dark:bg-yellow-500/20 text-yellow-600 dark:text-yellow-400' :\r\n                          'bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-400'\r\n                        )}\r\n                      >\r\n                        {entry.status}\r\n                      </Badge>\r\n                      <span className=\"text-muted-foreground\">\r\n                        {format(new Date(entry.startedAt), 'MMM d, HH:mm')}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-muted-foreground\">\r\n                      {entry.metricsFetched}/{entry.metricsRequested} metrics\r\n                      {entry.durationMs && `  ${entry.durationMs}ms`}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-xs text-muted-foreground\">No sync history yet</div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\QuotaDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\QuotaDashboardContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\QuotaStatusCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\RateLimitCountdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\UsageBreakdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\UsageChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\quota\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\settings\\ApiKeyCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\settings\\ApiKeyForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\settings\\KnowledgeBaseSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\settings\\StrategySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\settings\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\social\\ConnectedAccountCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1275,1278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1275,1278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Card, CardContent } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { SocialConnection } from '@/types/social';\r\nimport { Linkedin, Instagram, Unplug, AlertTriangle, CheckCircle2, Loader2 } from 'lucide-react';\r\nimport { format, parseISO } from 'date-fns';\r\n\r\ninterface ConnectedAccountCardProps {\r\n  account: SocialConnection;\r\n  onDisconnect: (id: string) => Promise<void>;\r\n}\r\n\r\nexport function ConnectedAccountCard({ account, onDisconnect }: ConnectedAccountCardProps) {\r\n  const [showDisconnectDialog, setShowDisconnectDialog] = useState(false);\r\n  const [isDisconnecting, setIsDisconnecting] = useState(false);\r\n\r\n  const handleDisconnect = async () => {\r\n    setIsDisconnecting(true);\r\n    try {\r\n      await onDisconnect(account.id);\r\n    } finally {\r\n      setIsDisconnecting(false);\r\n      setShowDisconnectDialog(false);\r\n    }\r\n  };\r\n\r\n  // Platform-specific styling\r\n  const platformConfig: Record<string, any> = {\r\n    linkedin: {\r\n      icon: Linkedin,\r\n      iconColor: 'text-blue-600',\r\n      bgColor: 'bg-blue-50 dark:bg-blue-900/20',\r\n      borderColor: 'border-blue-200 dark:border-blue-800',\r\n      label: 'LinkedIn',\r\n    },\r\n    instagram: {\r\n      icon: Instagram,\r\n      iconColor: 'text-pink-600',\r\n      bgColor: 'bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20',\r\n      borderColor: 'border-pink-200 dark:border-pink-800',\r\n      label: 'Instagram',\r\n    },\r\n    facebook: {\r\n      icon: Linkedin, // Placeholder - would need Facebook icon\r\n      iconColor: 'text-blue-700',\r\n      bgColor: 'bg-blue-50 dark:bg-blue-900/20',\r\n      borderColor: 'border-blue-200 dark:border-blue-800',\r\n      label: 'Facebook',\r\n    },\r\n    twitter: {\r\n      icon: Linkedin, // Placeholder - would need Twitter icon\r\n      iconColor: 'text-sky-500',\r\n      bgColor: 'bg-sky-50 dark:bg-sky-900/20',\r\n      borderColor: 'border-sky-200 dark:border-sky-800',\r\n      label: 'Twitter/X',\r\n    },\r\n    tiktok: {\r\n      icon: Linkedin, // Placeholder - would need TikTok icon\r\n      iconColor: 'text-black dark:text-white',\r\n      bgColor: 'bg-gray-50 dark:bg-gray-900/20',\r\n      borderColor: 'border-gray-200 dark:border-gray-800',\r\n      label: 'TikTok',\r\n    },\r\n    youtube: {\r\n      icon: Linkedin, // Placeholder - would need YouTube icon\r\n      iconColor: 'text-red-600',\r\n      bgColor: 'bg-red-50 dark:bg-red-900/20',\r\n      borderColor: 'border-red-200 dark:border-red-800',\r\n      label: 'YouTube',\r\n    },\r\n    pinterest: {\r\n      icon: Linkedin, // Placeholder - would need Pinterest icon\r\n      iconColor: 'text-red-700',\r\n      bgColor: 'bg-red-50 dark:bg-red-900/20',\r\n      borderColor: 'border-red-200 dark:border-red-800',\r\n      label: 'Pinterest',\r\n    },\r\n  };\r\n\r\n  const config = platformConfig[account.platform] || platformConfig.linkedin;\r\n  const Icon = config.icon;\r\n\r\n  // Compute status from existing fields (2026 UX: clear visual feedback)\r\n  const computeStatus = (): 'active' | 'error' | 'inactive' | 'expiring' => {\r\n    if (!account.isActive) return 'inactive';\r\n\r\n    // Check for recent errors (within 24h)\r\n    if (account.lastErrorAt) {\r\n      const errorAge = Date.now() - new Date(account.lastErrorAt).getTime();\r\n      if (errorAge < 24 * 60 * 60 * 1000) return 'error';\r\n    }\r\n\r\n    // Check token expiration\r\n    const expiresAt = new Date(account.tokenExpiresAt);\r\n    const daysUntilExpiry = Math.floor((expiresAt.getTime() - Date.now()) / (24 * 60 * 60 * 1000));\r\n\r\n    if (daysUntilExpiry < 0) return 'error'; // Expired\r\n    if (daysUntilExpiry <= 7) return 'expiring'; // Warning state\r\n\r\n    return 'active';\r\n  };\r\n\r\n  const status = computeStatus();\r\n\r\n  return (\r\n    <>\r\n      <Card className={`${config.borderColor} border-2`}>\r\n        <CardContent className={`p-6 ${config.bgColor}`}>\r\n          <div className=\"flex flex-col gap-4\">\r\n            {/* Header with icon and platform */}\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-lg bg-white dark:bg-gray-800 shadow-sm\">\r\n                  <Icon className={`w-6 h-6 ${config.iconColor}`} />\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-semibold text-lg\">{config.label}</h3>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {account.platformUsername || account.platformUserId || 'Unknown Account'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Status badge */}\r\n              <div>\r\n                {status === 'active' ? (\r\n                  <Badge variant=\"outline\" className=\"gap-1 border-green-500 text-green-600 dark:text-green-400\">\r\n                    <CheckCircle2 className=\"w-3 h-3\" />\r\n                    Active\r\n                  </Badge>\r\n                ) : status === 'expiring' ? (\r\n                  <Badge variant=\"outline\" className=\"gap-1 border-orange-500 text-orange-600 dark:text-orange-400\">\r\n                    <AlertTriangle className=\"w-3 h-3\" />\r\n                    Token Expiring Soon\r\n                  </Badge>\r\n                ) : status === 'error' ? (\r\n                  <Badge variant=\"destructive\" className=\"gap-1\">\r\n                    <AlertTriangle className=\"w-3 h-3\" />\r\n                    Error\r\n                  </Badge>\r\n                ) : (\r\n                  <Badge variant=\"outline\">Inactive</Badge>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Account details */}\r\n            <div className=\"space-y-2 text-sm\">\r\n              {account.accountType && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-muted-foreground\">Account Type:</span>\r\n                  <Badge variant=\"secondary\" className=\"capitalize\">\r\n                    {account.accountType}\r\n                  </Badge>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"text-muted-foreground\">Connected:</span>\r\n                <span className=\"font-medium\">\r\n                  {format(parseISO(account.connectedAt), 'MMM d, yyyy')}\r\n                </span>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"text-muted-foreground\">Managed by:</span>\r\n                <Badge variant=\"outline\" className=\"gap-1\">\r\n                  n8n\r\n                </Badge>\r\n              </div>\r\n\r\n              {account.lastUsedAt && (\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"text-muted-foreground\">Last Used:</span>\r\n                  <span className=\"font-medium\">\r\n                    {format(parseISO(account.lastUsedAt), 'MMM d, yyyy h:mm a')}\r\n                  </span>\r\n                </div>\r\n              )}\r\n\r\n              {account.lastErrorAt && account.lastErrorMessage && (\r\n                <div className=\"flex items-start gap-2 p-3 bg-red-50 dark:bg-red-900/20 rounded-md border border-red-200 dark:border-red-800\">\r\n                  <AlertTriangle className=\"w-4 h-4 text-red-600 dark:text-red-400 mt-0.5\" />\r\n                  <div className=\"flex-1\">\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      Last Error ({format(parseISO(account.lastErrorAt), 'MMM d, h:mm a')}):\r\n                    </p>\r\n                    <p className=\"text-sm text-red-600 dark:text-red-400\">\r\n                      {account.lastErrorMessage}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex items-center gap-2 pt-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setShowDisconnectDialog(true)}\r\n                disabled={isDisconnecting}\r\n                className=\"gap-2 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300\"\r\n              >\r\n                <Unplug className=\"w-4 h-4\" />\r\n                Disconnect\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Disconnect confirmation dialog */}\r\n      <AlertDialog open={showDisconnectDialog} onOpenChange={setShowDisconnectDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Disconnect {config.label} Account?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              This will remove the reference to your {config.label} account{' '}\r\n              {account.platformUsername && `(@${account.platformUsername})`} from this application.\r\n              <br /><br />\r\n              <strong>Note:</strong> This does NOT revoke OAuth permissions in n8n. Scheduled posts using this account will fail until you reconnect via the \"Sync Accounts from n8n\" button.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDisconnecting}>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDisconnect}\r\n              disabled={isDisconnecting}\r\n              className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n            >\r\n              {isDisconnecting ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Disconnecting...\r\n                </>\r\n              ) : (\r\n                'Disconnect'\r\n              )}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AgentChat\\AgentChatPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[719,722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[719,722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1244,1247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1244,1247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1524,1527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1524,1527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3510,3513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3510,3513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'toast'. Either include it or remove the dependency array.","line":114,"column":5,"nodeType":"ArrayExpression","endLine":114,"endColumn":11,"suggestions":[{"desc":"Update the dependencies array to be: [orch, toast]","fix":{"range":[4280,4286],"text":"[orch, toast]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5704,5707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5704,5707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5741,5744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5741,5744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5970,5973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5970,5973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * AgentChatPanel  Collapsible chat panel at top of Studio page\r\n *\r\n * Renders a conversational interface with the Studio Agent.\r\n * Dispatches ui_action events to the orchestrator to drive the UI.\r\n */\r\n\r\nimport { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { cn } from '@/lib/utils';\r\nimport { Bot, ChevronUp, ChevronDown, Send, Square, Trash2, Mic, MicOff } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { ChatMessage } from './ChatMessage';\r\nimport { useAgentChat } from './useAgentChat';\r\n\r\ninterface AgentChatPanelProps {\r\n  orch: any;\r\n}\r\n\r\nexport function AgentChatPanel({ orch }: AgentChatPanelProps) {\r\n  const { toast } = useToast();\r\n  const [isOpen, setIsOpen] = useState(() => {\r\n    try {\r\n      return localStorage.getItem('agent-chat-open') === 'true';\r\n    } catch {\r\n      return false;\r\n    }\r\n  });\r\n  const [input, setInput] = useState('');\r\n  const [isListening, setIsListening] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const recognitionRef = useRef<any>(null);\r\n\r\n  // Handle UI actions from the agent\r\n  const handleUiAction = useCallback(\r\n    (action: string, payload: Record<string, unknown>) => {\r\n      try {\r\n        switch (action) {\r\n          case 'select_products': {\r\n            const products = payload.products as any[];\r\n            if (products && orch.setSelectedProducts) {\r\n              orch.setSelectedProducts(products);\r\n              toast({\r\n                title: 'Products selected',\r\n                description: `${products.length} product(s) selected by the assistant.`,\r\n              });\r\n            }\r\n            break;\r\n          }\r\n          case 'set_prompt': {\r\n            const prompt = payload.prompt as string;\r\n            if (prompt && orch.setPrompt) {\r\n              orch.setPrompt(prompt);\r\n              toast({ title: 'Prompt updated', description: 'The assistant set your generation prompt.' });\r\n            }\r\n            break;\r\n          }\r\n          case 'set_platform': {\r\n            const platform = payload.platform as string;\r\n            if (platform && orch.setPlatform) {\r\n              orch.setPlatform(platform);\r\n              toast({ title: 'Platform set', description: `Target platform: ${platform}` });\r\n            }\r\n            break;\r\n          }\r\n          case 'set_aspect_ratio': {\r\n            const aspectRatio = payload.aspectRatio as string;\r\n            if (aspectRatio && orch.setAspectRatio) {\r\n              orch.setAspectRatio(aspectRatio);\r\n            }\r\n            break;\r\n          }\r\n          case 'set_resolution': {\r\n            const resolution = payload.resolution as string;\r\n            if (resolution && orch.setResolution) {\r\n              orch.setResolution(resolution);\r\n            }\r\n            break;\r\n          }\r\n          case 'generation_complete': {\r\n            const imageUrl = payload.imageUrl as string;\r\n            if (imageUrl && orch.setGeneratedImage) {\r\n              orch.setGeneratedImage(imageUrl);\r\n              if (orch.setState) orch.setState('result');\r\n              toast({ title: 'Image generated!', description: 'Check the result in the canvas.' });\r\n            }\r\n            break;\r\n          }\r\n          case 'copy_generated': {\r\n            const copies = payload.copies as any[];\r\n            if (copies?.length > 0) {\r\n              // setGeneratedCopy expects a string  use the first copy's caption\r\n              const firstCopy = copies[0];\r\n              if (orch.setGeneratedCopyFull) {\r\n                orch.setGeneratedCopyFull(firstCopy);\r\n              } else if (orch.setGeneratedCopy) {\r\n                orch.setGeneratedCopy(firstCopy?.caption ?? firstCopy?.bodyText ?? '');\r\n              }\r\n              toast({\r\n                title: 'Ad copy generated',\r\n                description: `${copies.length} variation(s) ready in the Inspector.`,\r\n              });\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      } catch {\r\n        // UI action dispatch should never crash the chat panel\r\n      }\r\n    },\r\n    [orch],\r\n  );\r\n\r\n  const { messages, isStreaming, error, sendMessage, stopStreaming, clearMessages } = useAgentChat({\r\n    onUiAction: handleUiAction,\r\n  });\r\n\r\n  // Persist collapse state\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('agent-chat-open', String(isOpen));\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Auto-scroll\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  // Focus input when opened\r\n  useEffect(() => {\r\n    if (isOpen) inputRef.current?.focus();\r\n  }, [isOpen]);\r\n\r\n  const handleSubmit = (e?: React.FormEvent) => {\r\n    e?.preventDefault();\r\n    if (!input.trim() || isStreaming) return;\r\n    sendMessage(input);\r\n    setInput('');\r\n  };\r\n\r\n  // Clean up voice recognition on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (recognitionRef.current) {\r\n        try {\r\n          recognitionRef.current.stop();\r\n        } catch {\r\n          /* already stopped */\r\n        }\r\n        recognitionRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Voice input via Web Speech API\r\n  const toggleVoice = useCallback(() => {\r\n    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {\r\n      return;\r\n    }\r\n\r\n    if (isListening) {\r\n      recognitionRef.current?.stop();\r\n      setIsListening(false);\r\n      return;\r\n    }\r\n\r\n    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n    const recognition = new SpeechRecognition();\r\n    recognition.continuous = false;\r\n    recognition.interimResults = false;\r\n    recognition.lang = 'en-US';\r\n\r\n    recognition.onresult = (event: any) => {\r\n      const transcript = event.results[0]?.[0]?.transcript;\r\n      if (transcript) {\r\n        setInput(transcript);\r\n        setIsListening(false);\r\n      }\r\n    };\r\n\r\n    recognition.onerror = () => setIsListening(false);\r\n    recognition.onend = () => setIsListening(false);\r\n\r\n    recognitionRef.current = recognition;\r\n    recognition.start();\r\n    setIsListening(true);\r\n  }, [isListening]);\r\n\r\n  const hasSpeech =\r\n    typeof window !== 'undefined' && ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window);\r\n\r\n  return (\r\n    <div className=\"w-full mb-6\">\r\n      {/* Header  always visible */}\r\n      <button\r\n        onClick={() => setIsOpen(!isOpen)}\r\n        className={cn(\r\n          'w-full flex items-center justify-between px-4 py-3 rounded-xl',\r\n          'bg-card/50 border border-border hover:bg-card/80 transition-colors',\r\n          isOpen && 'rounded-b-none border-b-0',\r\n        )}\r\n      >\r\n        <div className=\"flex items-center gap-2\">\r\n          <div className=\"w-7 h-7 rounded-full bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center\">\r\n            <Bot className=\"w-4 h-4 text-white\" />\r\n          </div>\r\n          <span className=\"text-sm font-medium\">Studio Assistant</span>\r\n          {messages.length > 0 && (\r\n            <span className=\"text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full\">\r\n              {messages.length} msg{messages.length !== 1 ? 's' : ''}\r\n            </span>\r\n          )}\r\n        </div>\r\n        {isOpen ? (\r\n          <ChevronUp className=\"w-4 h-4 text-muted-foreground\" />\r\n        ) : (\r\n          <ChevronDown className=\"w-4 h-4 text-muted-foreground\" />\r\n        )}\r\n      </button>\r\n\r\n      {/* Chat Body  collapsible */}\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <motion.div\r\n            initial={{ height: 0, opacity: 0 }}\r\n            animate={{ height: 'auto', opacity: 1 }}\r\n            exit={{ height: 0, opacity: 0 }}\r\n            transition={{ duration: 0.2, ease: 'easeInOut' }}\r\n            className=\"overflow-hidden\"\r\n          >\r\n            <div className=\"border border-t-0 border-border rounded-b-xl bg-card/30 backdrop-blur-sm\">\r\n              {/* Messages */}\r\n              <div className=\"max-h-[350px] overflow-y-auto p-4 space-y-3 scrollbar-hide\">\r\n                {messages.length === 0 && (\r\n                  <p className=\"text-center text-xs text-muted-foreground py-6\">\r\n                    Ask me to generate ads, find products, write copy, or set up your campaign.\r\n                  </p>\r\n                )}\r\n                {messages.map((msg) => (\r\n                  <ChatMessage key={msg.id} message={msg} />\r\n                ))}\r\n                {isStreaming && (\r\n                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                    <div className=\"w-1.5 h-1.5 rounded-full bg-primary animate-pulse\" />\r\n                    Thinking...\r\n                  </div>\r\n                )}\r\n                {error && (\r\n                  <div className=\"text-xs text-destructive bg-destructive/10 rounded-lg px-3 py-2\">{error}</div>\r\n                )}\r\n                <div ref={messagesEndRef} />\r\n              </div>\r\n\r\n              {/* Input */}\r\n              <form onSubmit={handleSubmit} className=\"flex items-center gap-2 p-3 border-t border-border\">\r\n                {hasSpeech && (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={toggleVoice}\r\n                    className={cn('h-8 w-8 p-0', isListening && 'text-red-500')}\r\n                  >\r\n                    {isListening ? <MicOff className=\"w-4 h-4\" /> : <Mic className=\"w-4 h-4\" />}\r\n                  </Button>\r\n                )}\r\n\r\n                <input\r\n                  ref={inputRef}\r\n                  type=\"text\"\r\n                  value={input}\r\n                  onChange={(e) => setInput(e.target.value)}\r\n                  placeholder={isListening ? 'Listening...' : 'Type a message...'}\r\n                  disabled={isStreaming}\r\n                  className=\"flex-1 bg-transparent text-sm outline-none placeholder:text-muted-foreground\"\r\n                />\r\n\r\n                {messages.length > 0 && !isStreaming && (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={clearMessages}\r\n                    className=\"h-8 w-8 p-0 text-muted-foreground hover:text-foreground\"\r\n                    title=\"Clear chat\"\r\n                  >\r\n                    <Trash2 className=\"w-3.5 h-3.5\" />\r\n                  </Button>\r\n                )}\r\n\r\n                {isStreaming ? (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={stopStreaming}\r\n                    className=\"h-8 w-8 p-0 text-destructive\"\r\n                  >\r\n                    <Square className=\"w-3.5 h-3.5\" />\r\n                  </Button>\r\n                ) : (\r\n                  <Button type=\"submit\" variant=\"ghost\" size=\"sm\" disabled={!input.trim()} className=\"h-8 w-8 p-0\">\r\n                    <Send className=\"w-3.5 h-3.5\" />\r\n                  </Button>\r\n                )}\r\n              </form>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AgentChat\\ChatMessage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AgentChat\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AgentChat\\useAgentChat.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5187,5190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5187,5190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * useAgentChat  SSE consumer for Studio Agent\r\n *\r\n * Sends messages to POST /api/agent/chat and reads the SSE stream.\r\n * Dispatches ui_action events to the orchestrator.\r\n */\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { getCsrfToken } from '@/lib/queryClient';\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant';\r\n  content: string;\r\n  toolCalls?: { name: string; args: Record<string, unknown> }[];\r\n  timestamp: number;\r\n}\r\n\r\ninterface UseAgentChatOptions {\r\n  onUiAction?: (action: string, payload: Record<string, unknown>) => void;\r\n}\r\n\r\nexport function useAgentChat(options: UseAgentChatOptions = {}) {\r\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n  const [isStreaming, setIsStreaming] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const sessionIdRef = useRef<string | null>(null);\r\n  const abortRef = useRef<AbortController | null>(null);\r\n  // Store onUiAction in a ref to avoid recreating sendMessage when callback changes\r\n  const onUiActionRef = useRef(options.onUiAction);\r\n  onUiActionRef.current = options.onUiAction;\r\n\r\n  // Pre-fetch CSRF token on mount to avoid latency on first message\r\n  useEffect(() => {\r\n    getCsrfToken().catch(() => {});\r\n  }, []);\r\n\r\n  const sendMessage = useCallback(\r\n    async (text: string) => {\r\n      if (!text.trim() || isStreaming) return;\r\n\r\n      setError(null);\r\n\r\n      // Add user message\r\n      const userMsg: ChatMessage = {\r\n        id: `user_${Date.now()}`,\r\n        role: 'user',\r\n        content: text.trim(),\r\n        timestamp: Date.now(),\r\n      };\r\n      setMessages((prev) => [...prev, userMsg]);\r\n\r\n      // Prepare assistant message placeholder\r\n      const assistantId = `assistant_${Date.now()}`;\r\n      const assistantMsg: ChatMessage = {\r\n        id: assistantId,\r\n        role: 'assistant',\r\n        content: '',\r\n        toolCalls: [],\r\n        timestamp: Date.now(),\r\n      };\r\n      setMessages((prev) => [...prev, assistantMsg]);\r\n\r\n      setIsStreaming(true);\r\n      abortRef.current = new AbortController();\r\n\r\n      try {\r\n        // Get CSRF token for state-changing request\r\n        const headers: Record<string, string> = { 'Content-Type': 'application/json' };\r\n        try {\r\n          const csrfToken = await getCsrfToken();\r\n          headers['x-csrf-token'] = csrfToken;\r\n        } catch {\r\n          // Non-fatal  server may still accept if CSRF is disabled in dev\r\n        }\r\n\r\n        const response = await fetch('/api/agent/chat', {\r\n          method: 'POST',\r\n          headers,\r\n          credentials: 'include',\r\n          body: JSON.stringify({\r\n            message: text.trim(),\r\n            sessionId: sessionIdRef.current,\r\n          }),\r\n          signal: abortRef.current.signal,\r\n        });\r\n\r\n        if (!response.ok) {\r\n          const errBody = await response.json().catch(() => ({ error: 'Request failed' }));\r\n          throw new Error(errBody.error || `HTTP ${response.status}`);\r\n        }\r\n\r\n        // Extract session ID from first response if not set\r\n        if (!sessionIdRef.current) {\r\n          const sid = response.headers.get('x-session-id');\r\n          if (sid) sessionIdRef.current = sid;\r\n        }\r\n\r\n        const reader = response.body?.getReader();\r\n        if (!reader) throw new Error('No response stream');\r\n\r\n        const decoder = new TextDecoder();\r\n        let buffer = '';\r\n\r\n        while (true) {\r\n          const { done, value } = await reader.read();\r\n          if (done) break;\r\n\r\n          buffer += decoder.decode(value, { stream: true });\r\n\r\n          // Process complete SSE lines\r\n          const lines = buffer.split('\\n');\r\n          buffer = lines.pop() ?? '';\r\n\r\n          for (const line of lines) {\r\n            if (!line.startsWith('data: ')) continue;\r\n            const jsonStr = line.slice(6).trim();\r\n            if (!jsonStr) continue;\r\n\r\n            try {\r\n              const event = JSON.parse(jsonStr);\r\n\r\n              switch (event.type) {\r\n                case 'text_delta':\r\n                  setMessages((prev) =>\r\n                    prev.map((m) => (m.id === assistantId ? { ...m, content: m.content + event.content } : m)),\r\n                  );\r\n                  break;\r\n\r\n                case 'tool_call':\r\n                  setMessages((prev) =>\r\n                    prev.map((m) =>\r\n                      m.id === assistantId\r\n                        ? {\r\n                            ...m,\r\n                            toolCalls: [...(m.toolCalls ?? []), { name: event.name, args: event.args }],\r\n                          }\r\n                        : m,\r\n                    ),\r\n                  );\r\n                  break;\r\n\r\n                case 'ui_action':\r\n                  onUiActionRef.current?.(event.action, event.payload);\r\n                  break;\r\n\r\n                case 'error':\r\n                  setError(event.content);\r\n                  break;\r\n\r\n                case 'done':\r\n                  break;\r\n              }\r\n            } catch {\r\n              // Skip malformed JSON lines\r\n            }\r\n          }\r\n        }\r\n      } catch (err: any) {\r\n        if (err.name !== 'AbortError') {\r\n          // Sanitize error messages  don't expose raw JS errors to users\r\n          const raw = err.message || '';\r\n          const isSafe = raw.startsWith('HTTP ') || raw === 'Request failed' || raw === 'No response stream';\r\n          const msg = isSafe ? raw : 'Something went wrong. Please try again.';\r\n          setError(msg);\r\n          setMessages((prev) =>\r\n            prev.map((m) => (m.id === assistantId ? { ...m, content: m.content || `Error: ${msg}` } : m)),\r\n          );\r\n        }\r\n      } finally {\r\n        setIsStreaming(false);\r\n        abortRef.current = null;\r\n      }\r\n    },\r\n    [isStreaming],\r\n  );\r\n\r\n  const stopStreaming = useCallback(() => {\r\n    abortRef.current?.abort();\r\n  }, []);\r\n\r\n  const clearMessages = useCallback(async () => {\r\n    // Delete server-side session if one exists\r\n    const sid = sessionIdRef.current;\r\n    if (sid) {\r\n      try {\r\n        const headers: Record<string, string> = {};\r\n        try {\r\n          const csrfToken = await getCsrfToken();\r\n          headers['x-csrf-token'] = csrfToken;\r\n        } catch {\r\n          // Non-fatal\r\n        }\r\n        await fetch(`/api/agent/session/${encodeURIComponent(sid)}`, {\r\n          method: 'DELETE',\r\n          headers,\r\n          credentials: 'include',\r\n        });\r\n      } catch {\r\n        // Best effort  don't block UI cleanup\r\n      }\r\n    }\r\n    setMessages([]);\r\n    sessionIdRef.current = null;\r\n    setError(null);\r\n  }, []);\r\n\r\n  return {\r\n    messages,\r\n    isStreaming,\r\n    error,\r\n    sendMessage,\r\n    stopStreaming,\r\n    clearMessages,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\AssetDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\BrandAssetsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\PatternsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\ProductsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\ScenariosTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\TemplatesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\AssetDrawer\\tabs\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\CanvasEditor\\CanvasEditor.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has unnecessary dependencies: 'brushSize' and 'imgSize'. Either exclude them or remove the dependency array.","line":226,"column":5,"nodeType":"ArrayExpression","endLine":226,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [activeTool, handleBrushMove]","fix":{"range":[7423,7472],"text":"[activeTool, handleBrushMove]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * CanvasEditor  AI-native image editor\r\n *\r\n * 2026 approach: SAM2 click-to-segment + Gemini AI editing.\r\n * No pixel-pushing canvas libraries  AI does the heavy lifting.\r\n *\r\n * Tools:\r\n * - Select (SAM2): Click an object  generates mask  describe edit\r\n * - Brush: Manual mask painting for fine control\r\n * - Crop: Simple drag-to-crop\r\n * - Eraser: Click object + \"remove this\" shortcut\r\n *\r\n * Flow: Select region  type instruction  Gemini edits  accept/reject\r\n */\r\n\r\nimport { memo, useState, useRef, useCallback, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  MousePointer2,\r\n  Paintbrush,\r\n  Crop,\r\n  Eraser,\r\n  Wand2,\r\n  Undo2,\r\n  X,\r\n  Loader2,\r\n  Check,\r\n  RotateCcw,\r\n  Minus,\r\n  Plus,\r\n} from 'lucide-react';\r\nimport { initSAM2, encodeImage, predictMask, getSAM2Status, type ClickPoint, type SAM2Result } from '@/lib/sam2';\r\n\r\ntype Tool = 'select' | 'brush' | 'crop' | 'eraser';\r\n\r\ninterface CanvasEditorProps {\r\n  /** URL of the image to edit */\r\n  imageUrl: string;\r\n  /** Generation ID for conversation history continuation */\r\n  generationId?: string;\r\n  /** Callback when edit is complete */\r\n  onEditComplete: (newImageUrl: string) => void;\r\n  /** Callback to close the editor */\r\n  onClose: () => void;\r\n}\r\n\r\nexport const CanvasEditor = memo(function CanvasEditor({\r\n  imageUrl,\r\n  generationId: _generationId,\r\n  onEditComplete,\r\n  onClose,\r\n}: CanvasEditorProps) {\r\n  // Tool state\r\n  const [activeTool, setActiveTool] = useState<Tool>('select');\r\n  const [editInstruction, setEditInstruction] = useState('');\r\n  const [isEditing, setIsEditing] = useState(false);\r\n\r\n  // SAM2 state\r\n  const [sam2Status, setSam2Status] = useState<string>('idle');\r\n  const [_sam2Progress, setSam2Progress] = useState(0);\r\n  const [clickPoints, setClickPoints] = useState<ClickPoint[]>([]);\r\n  const [currentMask, setCurrentMask] = useState<SAM2Result | null>(null);\r\n  const [isEncoding, setIsEncoding] = useState(false);\r\n\r\n  // Brush state\r\n  const [brushSize, setBrushSize] = useState(20);\r\n  const [_brushMaskData, _setBrushMaskData] = useState<ImageData | null>(null);\r\n  const isBrushing = useRef(false);\r\n\r\n  // Canvas refs\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const imageCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const maskCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const brushCanvasRef = useRef<HTMLCanvasElement>(null);\r\n  const imageRef = useRef<HTMLImageElement | null>(null);\r\n\r\n  // Image dimensions\r\n  const [imgSize, setImgSize] = useState({ w: 0, h: 0 });\r\n\r\n  // Edit history\r\n  const [history, setHistory] = useState<string[]>([]);\r\n\r\n  //  Load image \r\n  useEffect(() => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => {\r\n      imageRef.current = img;\r\n      setImgSize({ w: img.naturalWidth, h: img.naturalHeight });\r\n\r\n      // Draw on image canvas\r\n      const canvas = imageCanvasRef.current;\r\n      if (canvas) {\r\n        canvas.width = img.naturalWidth;\r\n        canvas.height = img.naturalHeight;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx?.drawImage(img, 0, 0);\r\n      }\r\n\r\n      // Size mask + brush canvases\r\n      [maskCanvasRef, brushCanvasRef].forEach((ref) => {\r\n        if (ref.current) {\r\n          ref.current.width = img.naturalWidth;\r\n          ref.current.height = img.naturalHeight;\r\n        }\r\n      });\r\n\r\n      setHistory([imageUrl]);\r\n    };\r\n    img.src = imageUrl;\r\n  }, [imageUrl]);\r\n\r\n  //  Initialize SAM2 \r\n  useEffect(() => {\r\n    setSam2Status('loading');\r\n    initSAM2((stage, pct) => {\r\n      setSam2Status(stage);\r\n      setSam2Progress(pct);\r\n    })\r\n      .then(() => setSam2Status('ready'))\r\n      .catch((err) => setSam2Status(`error: ${err.message}`));\r\n  }, []);\r\n\r\n  //  Encode image when SAM2 is ready \r\n  useEffect(() => {\r\n    if (sam2Status === 'ready' && imageRef.current && !isEncoding) {\r\n      setIsEncoding(true);\r\n      encodeImage(imageRef.current)\r\n        .then(() => {\r\n          setIsEncoding(false);\r\n          setSam2Status('encoded');\r\n        })\r\n        .catch(() => setIsEncoding(false));\r\n    }\r\n  }, [sam2Status, isEncoding]);\r\n\r\n  //  Canvas click handler \r\n  const handleCanvasClick = useCallback(\r\n    async (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n      const canvas = maskCanvasRef.current;\r\n      if (!canvas || imgSize.w === 0) return;\r\n\r\n      const rect = canvas.getBoundingClientRect();\r\n      const scaleX = imgSize.w / rect.width;\r\n      const scaleY = imgSize.h / rect.height;\r\n      const x = (e.clientX - rect.left) * scaleX;\r\n      const y = (e.clientY - rect.top) * scaleY;\r\n\r\n      if (activeTool === 'select' || activeTool === 'eraser') {\r\n        if (!getSAM2Status().hasEmbeddings) return;\r\n\r\n        const label = e.shiftKey ? 0 : 1; // Shift+click = negative point\r\n        const newPoints: ClickPoint[] = [...clickPoints, { x, y, label }];\r\n        setClickPoints(newPoints);\r\n\r\n        try {\r\n          const result = await predictMask(newPoints, imgSize.w, imgSize.h);\r\n          setCurrentMask(result);\r\n\r\n          // Draw mask overlay\r\n          const ctx = canvas.getContext('2d');\r\n          if (ctx) {\r\n            ctx.clearRect(0, 0, imgSize.w, imgSize.h);\r\n            ctx.putImageData(result.maskImageData, 0, 0);\r\n\r\n            // Draw click points\r\n            for (const pt of newPoints) {\r\n              ctx.beginPath();\r\n              ctx.arc(pt.x, pt.y, 6, 0, Math.PI * 2);\r\n              ctx.fillStyle = pt.label === 1 ? '#22c55e' : '#ef4444';\r\n              ctx.fill();\r\n              ctx.strokeStyle = '#fff';\r\n              ctx.lineWidth = 2;\r\n              ctx.stroke();\r\n            }\r\n          }\r\n\r\n          // Auto-fill eraser instruction\r\n          if (activeTool === 'eraser') {\r\n            setEditInstruction('Remove this object and fill the area naturally');\r\n          }\r\n        } catch (err) {\r\n          console.error('SAM2 prediction failed:', err);\r\n        }\r\n      }\r\n    },\r\n    [activeTool, clickPoints, imgSize],\r\n  );\r\n\r\n  //  Brush handlers \r\n  const handleBrushMove = useCallback(\r\n    (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n      if (!isBrushing.current || activeTool !== 'brush') return;\r\n      const canvas = brushCanvasRef.current;\r\n      if (!canvas) return;\r\n\r\n      const rect = canvas.getBoundingClientRect();\r\n      const scaleX = imgSize.w / rect.width;\r\n      const scaleY = imgSize.h / rect.height;\r\n      const x = (e.clientX - rect.left) * scaleX;\r\n      const y = (e.clientY - rect.top) * scaleY;\r\n\r\n      const ctx = canvas.getContext('2d');\r\n      if (ctx) {\r\n        ctx.globalCompositeOperation = 'source-over';\r\n        ctx.fillStyle = 'rgba(59, 130, 246, 0.4)';\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, brushSize * scaleX, 0, Math.PI * 2);\r\n        ctx.fill();\r\n      }\r\n    },\r\n    [activeTool, brushSize, imgSize],\r\n  );\r\n\r\n  const handleBrushStart = useCallback(\r\n    (e: React.MouseEvent<HTMLCanvasElement>) => {\r\n      if (activeTool !== 'brush') return;\r\n      isBrushing.current = true;\r\n      handleBrushMove(e);\r\n    },\r\n    [activeTool, brushSize, imgSize, handleBrushMove],\r\n  );\r\n\r\n  const handleBrushEnd = useCallback(() => {\r\n    isBrushing.current = false;\r\n  }, []);\r\n\r\n  //  Clear mask \r\n  const clearMask = useCallback(() => {\r\n    setClickPoints([]);\r\n    setCurrentMask(null);\r\n    const maskCtx = maskCanvasRef.current?.getContext('2d');\r\n    maskCtx?.clearRect(0, 0, imgSize.w, imgSize.h);\r\n    const brushCtx = brushCanvasRef.current?.getContext('2d');\r\n    brushCtx?.clearRect(0, 0, imgSize.w, imgSize.h);\r\n    setEditInstruction('');\r\n  }, [imgSize]);\r\n\r\n  //  Apply edit via Gemini \r\n  const applyEdit = useCallback(async () => {\r\n    if (!editInstruction.trim()) return;\r\n    setIsEditing(true);\r\n\r\n    try {\r\n      // Get CSRF token\r\n      const csrfRes = await fetch('/api/csrf-token', { credentials: 'include' });\r\n      const { csrfToken } = await csrfRes.json();\r\n\r\n      // Build the edit request\r\n      // We send the mask as a visual overlay on the image so Gemini can see the region\r\n      const formData = new FormData();\r\n\r\n      // Get current canvas state as image\r\n      const compositeCanvas = document.createElement('canvas');\r\n      compositeCanvas.width = imgSize.w;\r\n      compositeCanvas.height = imgSize.h;\r\n      const compositeCtx = compositeCanvas.getContext('2d')!;\r\n\r\n      // Draw original image\r\n      if (imageRef.current) {\r\n        compositeCtx.drawImage(imageRef.current, 0, 0);\r\n      }\r\n\r\n      // If there's a mask, overlay it with a visible highlight\r\n      if (currentMask || brushCanvasRef.current) {\r\n        compositeCtx.globalAlpha = 0.5;\r\n        if (maskCanvasRef.current) {\r\n          compositeCtx.drawImage(maskCanvasRef.current, 0, 0);\r\n        }\r\n        if (brushCanvasRef.current) {\r\n          compositeCtx.drawImage(brushCanvasRef.current, 0, 0);\r\n        }\r\n        compositeCtx.globalAlpha = 1.0;\r\n      }\r\n\r\n      // Convert composite to blob and append\r\n      const blob = await new Promise<Blob>((resolve) => {\r\n        compositeCanvas.toBlob((b) => resolve(b!), 'image/png');\r\n      });\r\n      formData.append('images', new File([blob], 'edit-source.png', { type: 'image/png' }));\r\n\r\n      // Build prompt with mask context\r\n      let prompt = editInstruction;\r\n      if (currentMask || brushCanvasRef.current) {\r\n        prompt = `The blue highlighted region in this image marks the area to edit. ${editInstruction}. Keep all non-highlighted areas exactly the same.`;\r\n      }\r\n      formData.append('prompt', prompt);\r\n      formData.append('resolution', '2K');\r\n\r\n      const response = await fetch('/api/transform', {\r\n        method: 'POST',\r\n        headers: { 'x-csrf-token': csrfToken },\r\n        credentials: 'include',\r\n        body: formData,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.error || 'Edit failed');\r\n      }\r\n\r\n      const data = await response.json();\r\n      const newImageUrl = data.imageUrl;\r\n\r\n      // Load the new image into the editor\r\n      const newImg = new Image();\r\n      newImg.crossOrigin = 'anonymous';\r\n      newImg.onload = () => {\r\n        imageRef.current = newImg;\r\n        const canvas = imageCanvasRef.current;\r\n        if (canvas) {\r\n          const ctx = canvas.getContext('2d');\r\n          ctx?.drawImage(newImg, 0, 0);\r\n        }\r\n        clearMask();\r\n        setHistory((prev) => [...prev, newImageUrl]);\r\n\r\n        // Re-encode for SAM2\r\n        encodeImage(newImg).catch(() => {});\r\n      };\r\n      newImg.src = newImageUrl;\r\n    } catch (err: unknown) {\r\n      console.error('Edit failed:', err);\r\n    } finally {\r\n      setIsEditing(false);\r\n    }\r\n  }, [editInstruction, currentMask, imgSize, clearMask]);\r\n\r\n  //  Undo \r\n  const handleUndo = useCallback(() => {\r\n    if (history.length <= 1) return;\r\n    const prev = history[history.length - 2];\r\n    setHistory((h) => h.slice(0, -1));\r\n\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => {\r\n      imageRef.current = img;\r\n      const canvas = imageCanvasRef.current;\r\n      if (canvas) {\r\n        const ctx = canvas.getContext('2d');\r\n        ctx?.drawImage(img, 0, 0);\r\n      }\r\n      clearMask();\r\n      encodeImage(img).catch(() => {});\r\n    };\r\n    img.src = prev;\r\n  }, [history, clearMask]);\r\n\r\n  //  Accept & close \r\n  const handleAccept = useCallback(() => {\r\n    const latest = history[history.length - 1];\r\n    if (latest) onEditComplete(latest);\r\n  }, [history, onEditComplete]);\r\n\r\n  //  Tool definitions \r\n  const tools = [\r\n    { id: 'select' as Tool, icon: MousePointer2, label: 'Select (SAM2)', shortcut: 'V' },\r\n    { id: 'brush' as Tool, icon: Paintbrush, label: 'Brush mask', shortcut: 'B' },\r\n    { id: 'eraser' as Tool, icon: Eraser, label: 'Erase object', shortcut: 'E' },\r\n    { id: 'crop' as Tool, icon: Crop, label: 'Crop', shortcut: 'C' },\r\n  ];\r\n\r\n  const sam2Ready = sam2Status === 'encoded';\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 z-50 bg-background flex flex-col\"\r\n    >\r\n      {/* Top toolbar */}\r\n      <div className=\"flex items-center justify-between px-4 py-2 border-b bg-muted/30\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Wand2 className=\"w-5 h-5 text-primary\" />\r\n          <span className=\"font-semibold\">AI Canvas Editor</span>\r\n          {!sam2Ready && (\r\n            <Badge variant=\"outline\" className=\"text-xs\">\r\n              <Loader2 className=\"w-3 h-3 mr-1 animate-spin\" />\r\n              {sam2Status}\r\n            </Badge>\r\n          )}\r\n          {sam2Ready && (\r\n            <Badge variant=\"outline\" className=\"text-xs text-green-600\">\r\n              SAM2 Ready\r\n            </Badge>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={handleUndo} disabled={history.length <= 1}>\r\n            <Undo2 className=\"w-4 h-4 mr-1\" />\r\n            Undo\r\n          </Button>\r\n          <Button size=\"sm\" onClick={handleAccept} disabled={history.length <= 1}>\r\n            <Check className=\"w-4 h-4 mr-1\" />\r\n            Accept\r\n          </Button>\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\r\n            <X className=\"w-4 h-4\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-1 overflow-hidden\">\r\n        {/* Left tool panel */}\r\n        <div className=\"w-14 border-r bg-muted/20 flex flex-col items-center py-3 gap-1\">\r\n          {tools.map((tool) => (\r\n            <button\r\n              key={tool.id}\r\n              onClick={() => {\r\n                setActiveTool(tool.id);\r\n                if (tool.id !== 'select' && tool.id !== 'eraser') clearMask();\r\n              }}\r\n              className={cn(\r\n                'w-10 h-10 rounded-lg flex items-center justify-center transition-colors',\r\n                activeTool === tool.id ? 'bg-primary text-primary-foreground' : 'hover:bg-muted text-muted-foreground',\r\n              )}\r\n              title={`${tool.label} (${tool.shortcut})`}\r\n              aria-label={tool.label}\r\n            >\r\n              <tool.icon className=\"w-5 h-5\" />\r\n            </button>\r\n          ))}\r\n\r\n          {/* Brush size control */}\r\n          {activeTool === 'brush' && (\r\n            <div className=\"mt-2 flex flex-col items-center gap-1\">\r\n              <button\r\n                onClick={() => setBrushSize((s) => Math.min(100, s + 5))}\r\n                className=\"w-8 h-8 rounded flex items-center justify-center hover:bg-muted\"\r\n              >\r\n                <Plus className=\"w-3 h-3\" />\r\n              </button>\r\n              <span className=\"text-[10px] text-muted-foreground\">{brushSize}</span>\r\n              <button\r\n                onClick={() => setBrushSize((s) => Math.max(5, s - 5))}\r\n                className=\"w-8 h-8 rounded flex items-center justify-center hover:bg-muted\"\r\n              >\r\n                <Minus className=\"w-3 h-3\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Canvas area */}\r\n        <div\r\n          ref={containerRef}\r\n          className=\"flex-1 relative overflow-auto bg-neutral-900 flex items-center justify-center\"\r\n        >\r\n          <div className=\"relative\" style={{ maxWidth: '90%', maxHeight: '90%' }}>\r\n            {/* Image layer */}\r\n            <canvas\r\n              ref={imageCanvasRef}\r\n              className=\"max-w-full max-h-[70vh] object-contain\"\r\n              style={{ display: 'block' }}\r\n            />\r\n\r\n            {/* SAM2 mask overlay layer */}\r\n            <canvas\r\n              ref={maskCanvasRef}\r\n              className=\"absolute inset-0 max-w-full max-h-[70vh]\"\r\n              style={{ pointerEvents: activeTool === 'select' || activeTool === 'eraser' ? 'auto' : 'none' }}\r\n              onClick={handleCanvasClick}\r\n            />\r\n\r\n            {/* Brush overlay layer */}\r\n            <canvas\r\n              ref={brushCanvasRef}\r\n              className=\"absolute inset-0 max-w-full max-h-[70vh]\"\r\n              style={{\r\n                pointerEvents: activeTool === 'brush' ? 'auto' : 'none',\r\n                cursor: activeTool === 'brush' ? 'crosshair' : 'default',\r\n              }}\r\n              onMouseDown={handleBrushStart}\r\n              onMouseMove={handleBrushMove}\r\n              onMouseUp={handleBrushEnd}\r\n              onMouseLeave={handleBrushEnd}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right panel  edit instructions */}\r\n        <div className=\"w-72 border-l bg-muted/10 flex flex-col\">\r\n          <div className=\"p-3 border-b\">\r\n            <h3 className=\"text-sm font-medium mb-1\">Edit Instruction</h3>\r\n            <p className=\"text-xs text-muted-foreground mb-2\">\r\n              {activeTool === 'select' && 'Click an object to select it, then describe what to change.'}\r\n              {activeTool === 'brush' && 'Paint over the area to edit, then describe the change.'}\r\n              {activeTool === 'eraser' && 'Click the object to remove. It will be filled naturally.'}\r\n              {activeTool === 'crop' && 'Drag to select crop region.'}\r\n            </p>\r\n            {activeTool === 'select' && (\r\n              <p className=\"text-xs text-muted-foreground italic\">Shift+click to exclude regions</p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"p-3 flex-1 flex flex-col gap-3\">\r\n            <Textarea\r\n              value={editInstruction}\r\n              onChange={(e) => setEditInstruction(e.target.value)}\r\n              placeholder={\r\n                activeTool === 'eraser'\r\n                  ? 'Remove this object and fill naturally'\r\n                  : \"Describe the edit... e.g., 'Change the background to sunset'\"\r\n              }\r\n              className=\"flex-1 min-h-[120px] text-sm resize-none\"\r\n              disabled={isEditing}\r\n            />\r\n\r\n            <Button onClick={applyEdit} disabled={!editInstruction.trim() || isEditing} className=\"w-full\">\r\n              {isEditing ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-1.5 animate-spin\" />\r\n                  Applying edit...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Wand2 className=\"w-4 h-4 mr-1.5\" />\r\n                  Apply Edit\r\n                </>\r\n              )}\r\n            </Button>\r\n\r\n            {(currentMask || clickPoints.length > 0) && (\r\n              <Button variant=\"outline\" size=\"sm\" onClick={clearMask}>\r\n                <RotateCcw className=\"w-3.5 h-3.5 mr-1.5\" />\r\n                Clear selection\r\n              </Button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Edit history thumbnails */}\r\n          {history.length > 1 && (\r\n            <div className=\"p-3 border-t\">\r\n              <h4 className=\"text-xs font-medium text-muted-foreground mb-2\">\r\n                Edit History ({history.length - 1} edits)\r\n              </h4>\r\n              <div className=\"flex gap-1 overflow-x-auto\">\r\n                {history.map((url, i) => (\r\n                  <img\r\n                    key={i}\r\n                    src={url}\r\n                    alt={`Edit ${i}`}\r\n                    className={cn(\r\n                      'w-12 h-12 rounded border object-cover flex-shrink-0',\r\n                      i === history.length - 1 && 'ring-2 ring-primary',\r\n                    )}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\CollaborationPresence.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\HistoryPanel\\HistoryPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsContent"},"fix":{"range":[184,197],"text":""},"desc":"Remove unused variable \"TabsContent\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { cn } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { History, Clock, List, ChevronLeft, ChevronRight, ImageIcon } from 'lucide-react';\r\nimport { useHistoryPanelUrl } from '@/hooks/useUrlState';\r\n\r\ninterface HistoryPanelProps {\r\n  isOpen: boolean;\r\n  onToggle: () => void;\r\n  onSelectGeneration?: (id: string) => void;\r\n  className?: string;\r\n}\r\n\r\ninterface Generation {\r\n  id: string;\r\n  imageUrl: string;\r\n  prompt: string;\r\n  createdAt: string;\r\n  platform: string;\r\n  status?: string;\r\n}\r\n\r\nconst tabs = [\r\n  { id: 'recent', label: 'Recent', icon: Clock },\r\n  { id: 'all', label: 'All', icon: List },\r\n] as const;\r\n\r\ntype TabId = (typeof tabs)[number]['id'];\r\n\r\n/**\r\n * HistoryPanel - Right collapsible panel for generation history\r\n *\r\n * Replaces Gallery and GenerationDetail pages with inline panel.\r\n * URL state: /?view=history&generation=:id\r\n */\r\nexport function HistoryPanel({ isOpen, onToggle, onSelectGeneration, className }: HistoryPanelProps) {\r\n  const [activeTab, setActiveTab] = useState<TabId>('all');\r\n  const { selectedGenerationId, selectGeneration } = useHistoryPanelUrl();\r\n\r\n  // Fetch generations\r\n  const { data: generations = [], isLoading } = useQuery<Generation[]>({\r\n    queryKey: ['generations'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/generations', { credentials: 'include' });\r\n      if (!res.ok) throw new Error('Failed to fetch generations');\r\n      const all: Generation[] = await res.json();\r\n      return all.filter((g) => !g.status || g.status === 'completed');\r\n    },\r\n  });\r\n\r\n  // Filter by tab\r\n  const filteredGenerations = (() => {\r\n    const now = new Date();\r\n    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\r\n\r\n    switch (activeTab) {\r\n      case 'recent':\r\n        return generations.filter((g) => new Date(g.createdAt) > oneDayAgo);\r\n      case 'all':\r\n      default:\r\n        return generations;\r\n    }\r\n  })();\r\n\r\n  const handleSelect = (id: string) => {\r\n    selectGeneration(id);\r\n    onSelectGeneration?.(id);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex flex-col bg-card border-l border-border transition-all duration-300',\r\n        isOpen ? 'w-80' : 'w-12',\r\n        className,\r\n      )}\r\n    >\r\n      {/* Header with toggle */}\r\n      <div className=\"flex items-center justify-between p-3 border-b border-border\">\r\n        <Button variant=\"ghost\" size=\"icon\" onClick={onToggle} className={cn('h-8 w-8', !isOpen && 'mx-auto')}>\r\n          {isOpen ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronLeft className=\"h-4 w-4\" />}\r\n        </Button>\r\n        {isOpen && <h2 className=\"text-sm font-medium text-foreground\">History</h2>}\r\n      </div>\r\n\r\n      {/* Collapsed state - just icon */}\r\n      {!isOpen && (\r\n        <div className=\"flex flex-col items-center gap-2 py-4\">\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={onToggle} title=\"Open History\" className=\"h-8 w-8\">\r\n            <History className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Expanded state */}\r\n      {isOpen && (\r\n        <Tabs\r\n          value={activeTab}\r\n          onValueChange={(v) => setActiveTab(v as TabId)}\r\n          className=\"flex-1 flex flex-col overflow-hidden\"\r\n        >\r\n          <TabsList className=\"w-full justify-start px-3 pt-3 bg-transparent gap-1\">\r\n            {tabs.map((tab) => {\r\n              const Icon = tab.icon;\r\n              return (\r\n                <TabsTrigger\r\n                  key={tab.id}\r\n                  value={tab.id}\r\n                  className=\"flex-1 gap-1.5 text-xs data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\"\r\n                >\r\n                  <Icon className=\"h-3.5 w-3.5\" />\r\n                  <span>{tab.label}</span>\r\n                </TabsTrigger>\r\n              );\r\n            })}\r\n          </TabsList>\r\n\r\n          <ScrollArea className=\"flex-1 p-3\">\r\n            {isLoading ? (\r\n              <div className=\"flex items-center justify-center py-8\">\r\n                <div className=\"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full\" />\r\n              </div>\r\n            ) : filteredGenerations.length > 0 ? (\r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                {filteredGenerations.map((gen) => (\r\n                  <button\r\n                    key={gen.id}\r\n                    onClick={() => handleSelect(gen.id)}\r\n                    className={cn(\r\n                      'relative aspect-square rounded-lg overflow-hidden border-2 transition-all',\r\n                      selectedGenerationId === gen.id\r\n                        ? 'border-primary ring-2 ring-primary/20'\r\n                        : 'border-border hover:border-primary/50',\r\n                    )}\r\n                  >\r\n                    <img\r\n                      src={gen.imageUrl}\r\n                      alt={gen.prompt?.slice(0, 50) || 'Generated image'}\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                    <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-1\">\r\n                      <p className=\"text-white text-[10px] truncate\">{new Date(gen.createdAt).toLocaleDateString()}</p>\r\n                    </div>\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8 text-muted-foreground\">\r\n                <ImageIcon className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\r\n                <p className=\"text-xs\">{activeTab === 'recent' ? 'No recent generations' : 'No generations yet'}</p>\r\n              </div>\r\n            )}\r\n          </ScrollArea>\r\n\r\n          {/* Footer */}\r\n          <div className=\"text-xs text-muted-foreground text-center p-2 border-t\">\r\n            {filteredGenerations.length} generation\r\n            {filteredGenerations.length !== 1 ? 's' : ''}\r\n          </div>\r\n        </Tabs>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\HistoryPanel\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\IdeaBankBar\\IdeaBankBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\IdeaBankBar\\SuggestionChip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\IdeaBankBar\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\InspectorPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\tabs\\AskAITab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":7,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[467,476],"text":""},"desc":"Remove unused variable \"User\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * AskAITab  Chat with AI about the current generation\r\n *\r\n * Simple Q&A interface: ask a question, get an AI response.\r\n * Extracted from ResultViewEnhanced inline ask-ai section.\r\n */\r\n\r\nimport { memo, useRef, useEffect } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Sparkles,\r\n  Loader2,\r\n  Send,\r\n  Bot,\r\n  User,\r\n  Lightbulb,\r\n} from \"lucide-react\";\r\nimport type { StudioOrchestrator } from \"@/hooks/useStudioOrchestrator\";\r\n\r\nconst QUICK_QUESTIONS = [\r\n  \"What makes this image effective?\",\r\n  \"Suggest improvements\",\r\n  \"What audience would this appeal to?\",\r\n  \"Rate this for LinkedIn\",\r\n];\r\n\r\ninterface AskAITabProps {\r\n  orch: StudioOrchestrator;\r\n}\r\n\r\nexport const AskAITab = memo(function AskAITab({ orch }: AskAITabProps) {\r\n  const hasResult = Boolean(orch.generatedImage);\r\n  const responseRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (orch.askAIResponse && responseRef.current) {\r\n      responseRef.current.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" });\r\n    }\r\n  }, [orch.askAIResponse]);\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 8 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className=\"flex flex-col h-full p-4\"\r\n    >\r\n      <div className=\"flex items-center gap-2 text-sm font-medium mb-4\">\r\n        <Sparkles className=\"w-4 h-4 text-primary\" />\r\n        Ask AI\r\n      </div>\r\n\r\n      {!hasResult ? (\r\n        <p className=\"text-sm text-muted-foreground py-6 text-center\">\r\n          Generate an image first, then ask AI questions about it.\r\n        </p>\r\n      ) : (\r\n        <div className=\"flex flex-col gap-3 flex-1\">\r\n          {/* Quick question chips */}\r\n          <div className=\"flex flex-wrap gap-1.5\">\r\n            {QUICK_QUESTIONS.map((q) => (\r\n              <button\r\n                key={q}\r\n                onClick={() => {\r\n                  orch.setAskAIQuestion(q);\r\n                  // Auto-send\r\n                  setTimeout(() => orch.handleAskAI(), 50);\r\n                }}\r\n                className=\"text-xs px-2.5 py-1.5 rounded-full border border-border hover:bg-muted/80 hover:border-primary/30 transition-colors\"\r\n              >\r\n                <Lightbulb className=\"w-3 h-3 inline mr-1 opacity-60\" />\r\n                {q}\r\n              </button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Response area */}\r\n          <AnimatePresence>\r\n            {orch.askAIResponse && (\r\n              <motion.div\r\n                ref={responseRef}\r\n                initial={{ opacity: 0, y: 8 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -8 }}\r\n                className=\"rounded-lg bg-muted/50 p-3 space-y-2\"\r\n              >\r\n                <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n                  <Bot className=\"w-3.5 h-3.5\" />\r\n                  AI Response\r\n                </div>\r\n                <p className=\"text-sm whitespace-pre-wrap leading-relaxed\">\r\n                  {orch.askAIResponse}\r\n                </p>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Input area (pinned to bottom) */}\r\n          <div className=\"mt-auto pt-2 border-t border-border/50\">\r\n            <div className=\"flex gap-2\">\r\n              <Input\r\n                value={orch.askAIQuestion}\r\n                onChange={(e) => orch.setAskAIQuestion(e.target.value)}\r\n                placeholder=\"Ask about this generation...\"\r\n                className=\"text-sm\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    e.preventDefault();\r\n                    orch.handleAskAI();\r\n                  }\r\n                }}\r\n              />\r\n              <Button\r\n                onClick={orch.handleAskAI}\r\n                disabled={!orch.askAIQuestion.trim() || orch.isAskingAI}\r\n                size=\"icon\"\r\n                className=\"shrink-0\"\r\n              >\r\n                {orch.isAskingAI ? (\r\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                ) : (\r\n                  <Send className=\"w-4 h-4\" />\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </motion.div>\r\n  );\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\tabs\\CopyTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\tabs\\DetailsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\InspectorPanel\\tabs\\EditTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\MainCanvas\\ComposerView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used. Allowed unused vars must match /^_/u.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":6,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Zap"},"fix":{"range":[1370,1378],"text":""},"desc":"Remove unused variable \"Zap\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1838,1841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1838,1841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * ComposerView  Studio idle state center panel\r\n *\r\n * Contains: Quick start, path selection, uploads, products, templates,\r\n * prompt/IdeaBank, output settings, price estimate, and generate button.\r\n */\r\n\r\nimport { memo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { cn, getProductImageUrl } from '@/lib/utils';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { IdeaBankPanel } from '@/components/IdeaBankPanel';\r\nimport { TemplateLibrary } from '@/components/TemplateLibrary';\r\nimport { UploadZone } from '@/components/UploadZone';\r\nimport { ContentPlannerGuidance } from '@/components/ContentPlannerGuidance';\r\nimport { CarouselBuilder } from '@/components/CarouselBuilder';\r\nimport { BeforeAfterBuilder } from '@/components/BeforeAfterBuilder';\r\nimport { TextOnlyMode } from '@/components/TextOnlyMode';\r\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\r\nimport { StyleReferenceSelector } from '@/components/studio/StyleReferenceSelector';\r\nimport {\r\n  Sparkles,\r\n  ChevronDown,\r\n  ChevronUp,\r\n  Check,\r\n  X,\r\n  Search,\r\n  Package,\r\n  Zap,\r\n  TrendingUp,\r\n  Wand2,\r\n  FileImage,\r\n  Palette,\r\n  Mic,\r\n  MicOff,\r\n} from 'lucide-react';\r\nimport { useRipple } from '@/hooks/useRipple';\r\nimport { useVoiceInput } from '@/hooks/useVoiceInput';\r\nimport type { StudioOrchestrator } from '@/hooks/useStudioOrchestrator';\r\n\r\n/** Collapsible section wrapper */\r\nfunction Section({\r\n  id,\r\n  title,\r\n  icon: Icon,\r\n  isOpen,\r\n  onToggle,\r\n  badge,\r\n  children,\r\n}: {\r\n  id: string;\r\n  title: string;\r\n  icon?: any;\r\n  isOpen: boolean;\r\n  onToggle: () => void;\r\n  badge?: string;\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <motion.section\r\n      id={id}\r\n      initial={{ opacity: 0, y: 10 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      className=\"rounded-2xl border border-border bg-card/50 overflow-hidden\"\r\n    >\r\n      <button\r\n        onClick={onToggle}\r\n        className=\"w-full flex items-center justify-between p-5 hover:bg-muted/50 transition-colors\"\r\n      >\r\n        <div className=\"flex items-center gap-3\">\r\n          {Icon && <Icon className=\"w-5 h-5 text-primary\" />}\r\n          <h3 className=\"font-medium text-sm\">{title}</h3>\r\n          {badge && (\r\n            <Badge variant=\"secondary\" className=\"text-xs\">\r\n              {badge}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        {isOpen ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\r\n      </button>\r\n      {isOpen && <div className=\"px-5 pb-5 space-y-4\">{children}</div>}\r\n    </motion.section>\r\n  );\r\n}\r\n\r\ninterface ComposerViewProps {\r\n  orch: StudioOrchestrator;\r\n}\r\n\r\nexport const ComposerView = memo(function ComposerView({ orch }: ComposerViewProps) {\r\n  const { createRipple } = useRipple();\r\n\r\n  // Voice input for main prompt\r\n  const mainPromptVoice = useVoiceInput({\r\n    onTranscript: (text, isFinal) => {\r\n      if (isFinal) {\r\n        orch.handlePromptChange(orch.prompt ? orch.prompt + ' ' + text : text);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Weekly Plan Context Banner */}\r\n      {orch.planContext && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: -10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-3\"\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-blue-800 dark:text-blue-200\">\r\n                Creating from Weekly Plan  {orch.planContext.dayOfWeek} {orch.planContext.category.replace(/_/g, ' ')}\r\n              </p>\r\n              <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1 line-clamp-2\">{orch.planContext.briefing}</p>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => orch.clearPlanContext()}>\r\n              <X className=\"w-4 h-4\" />\r\n            </Button>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Path Selection */}\r\n      <motion.div\r\n        initial={{ opacity: 0, y: 20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ delay: 0.05 }}\r\n        className=\"space-y-4\"\r\n      >\r\n        <h3 className=\"text-sm font-medium text-muted-foreground\">Choose Your Path</h3>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <button\r\n            onClick={() => orch.setIdeaBankMode('freestyle')}\r\n            className={cn(\r\n              'p-4 rounded-xl border-2 text-left transition-all',\r\n              orch.ideaBankMode === 'freestyle'\r\n                ? 'border-primary bg-primary/5'\r\n                : 'border-border hover:border-primary/50',\r\n            )}\r\n          >\r\n            <Wand2 className=\"w-5 h-5 text-primary mb-2\" />\r\n            <p className=\"font-medium text-sm\">Freestyle</p>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">Describe freely, AI interprets</p>\r\n          </button>\r\n          <button\r\n            onClick={() => orch.setIdeaBankMode('template')}\r\n            className={cn(\r\n              'p-4 rounded-xl border-2 text-left transition-all',\r\n              orch.ideaBankMode === 'template'\r\n                ? 'border-primary bg-primary/5'\r\n                : 'border-border hover:border-primary/50',\r\n            )}\r\n          >\r\n            <FileImage className=\"w-5 h-5 text-primary mb-2\" />\r\n            <p className=\"font-medium text-sm\">Use Template</p>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">Pick a proven ad format</p>\r\n          </button>\r\n        </div>\r\n\r\n        {orch.ideaBankMode === 'template' && (\r\n          <motion.div\r\n            initial={{ opacity: 0, height: 0 }}\r\n            animate={{ opacity: 1, height: 'auto' }}\r\n            className=\"p-4 rounded-xl border border-border\"\r\n          >\r\n            <TemplateLibrary onSelectTemplate={(template) => orch.setSelectedTemplateForMode(template)} />\r\n          </motion.div>\r\n        )}\r\n      </motion.div>\r\n\r\n      {/* Upload Section */}\r\n      <Section\r\n        id=\"upload\"\r\n        title=\"Upload Images\"\r\n        icon={Package}\r\n        isOpen={!orch.collapsedSections.upload}\r\n        onToggle={() => orch.toggleSection('upload')}\r\n        badge={\r\n          orch.tempUploads.length > 0\r\n            ? `${orch.tempUploads.length} file${orch.tempUploads.length > 1 ? 's' : ''}`\r\n            : undefined\r\n        }\r\n      >\r\n        <UploadZone\r\n          uploads={orch.tempUploads}\r\n          onUploadsChange={orch.setTempUploads}\r\n          maxFiles={6 - orch.selectedProducts.length}\r\n        />\r\n      </Section>\r\n\r\n      {/* Products Section */}\r\n      <Section\r\n        id=\"products\"\r\n        title=\"Your Products\"\r\n        icon={Package}\r\n        isOpen={!orch.collapsedSections.products}\r\n        onToggle={() => orch.toggleSection('products')}\r\n        badge={orch.selectedProducts.length > 0 ? `${orch.selectedProducts.length} selected` : undefined}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          {/* Selected Products Preview */}\r\n          {orch.selectedProducts.length > 0 && (\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {orch.selectedProducts.map((p) => (\r\n                <div\r\n                  key={p.id}\r\n                  className=\"w-16 h-16 relative group rounded-lg overflow-hidden border border-primary/30\"\r\n                >\r\n                  <img src={getProductImageUrl(p.cloudinaryUrl)} alt={p.name} className=\"w-full h-full object-cover\" />\r\n                  <button\r\n                    onClick={() => orch.toggleProductSelection(p)}\r\n                    className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\"\r\n                  >\r\n                    <X className=\"w-4 h-4 text-white\" />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n              <button\r\n                onClick={() => orch.setSelectedProducts([])}\r\n                className=\"text-xs text-muted-foreground hover:text-foreground px-2\"\r\n              >\r\n                Clear all\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Search & Filter */}\r\n          <div className=\"flex gap-3\">\r\n            <div className=\"relative flex-1\">\r\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Search products...\"\r\n                value={orch.searchQuery}\r\n                onChange={(e) => orch.setSearchQuery(e.target.value)}\r\n                className=\"pl-9\"\r\n              />\r\n            </div>\r\n            <Select value={orch.categoryFilter} onValueChange={orch.setCategoryFilter}>\r\n              <SelectTrigger className=\"w-40\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {orch.categories.map((cat) => (\r\n                  <SelectItem key={cat} value={cat}>\r\n                    {cat === 'all' ? 'All Categories' : cat}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {/* Product Grid */}\r\n          <div className=\"max-h-[300px] overflow-y-auto\">\r\n            <div className=\"grid grid-cols-4 sm:grid-cols-6 gap-2\">\r\n              {orch.filteredProducts.map((product) => {\r\n                const isSelected = orch.selectedProducts.some((p) => p.id === product.id);\r\n                return (\r\n                  <button\r\n                    key={product.id}\r\n                    onClick={(e) => {\r\n                      createRipple(e);\r\n                      orch.toggleProductSelection(product);\r\n                    }}\r\n                    className={cn(\r\n                      'relative rounded-xl overflow-hidden border-2 aspect-square transition-all',\r\n                      isSelected\r\n                        ? 'border-primary ring-2 ring-primary/20 scale-105'\r\n                        : 'border-border hover:border-primary/50',\r\n                    )}\r\n                  >\r\n                    <img\r\n                      src={getProductImageUrl(product.cloudinaryUrl)}\r\n                      alt={product.name}\r\n                      className=\"w-full h-full object-cover\"\r\n                      loading=\"lazy\"\r\n                    />\r\n                    {isSelected && (\r\n                      <div className=\"absolute top-1 right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center\">\r\n                        <Check className=\"w-3 h-3 text-white\" />\r\n                      </div>\r\n                    )}\r\n                    <div className=\"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-1\">\r\n                      <p className=\"text-[9px] text-white font-medium truncate\">{product.name}</p>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Section>\r\n\r\n      {/* Templates Section */}\r\n      <Section\r\n        id=\"templates\"\r\n        title=\"Style & Template\"\r\n        isOpen={!orch.collapsedSections.templates}\r\n        onToggle={() => orch.toggleSection('templates')}\r\n        badge={orch.selectedTemplate ? '1 selected' : undefined}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          {/* Category Filter */}\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {['all', ...Array.from(new Set(orch.templates.map((t) => t.category).filter(Boolean)))].map((cat) => (\r\n              <Button\r\n                key={cat}\r\n                variant={orch.templateCategory === cat ? 'default' : 'outline'}\r\n                size=\"sm\"\r\n                onClick={() => orch.setTemplateCategory(cat)}\r\n              >\r\n                {cat === 'all' ? 'All' : cat}\r\n              </Button>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Template Scroll */}\r\n          <div className=\"flex gap-4 overflow-x-auto pb-2\">\r\n            {orch.templates\r\n              .filter((t) => orch.templateCategory === 'all' || t.category === orch.templateCategory)\r\n              .map((template) => (\r\n                <button\r\n                  key={template.id}\r\n                  onClick={() => {\r\n                    if (orch.selectedTemplate?.id === template.id) {\r\n                      orch.setSelectedTemplate(null);\r\n                    } else {\r\n                      orch.setSelectedTemplate(template);\r\n                      orch.setPrompt(template.promptBlueprint);\r\n                    }\r\n                  }}\r\n                  className={cn(\r\n                    'flex-shrink-0 p-4 rounded-xl border-2 min-w-[200px] text-left transition-all',\r\n                    orch.selectedTemplate?.id === template.id\r\n                      ? 'border-primary bg-primary/10'\r\n                      : 'border-border hover:border-primary/50',\r\n                  )}\r\n                >\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <span className=\"text-xs font-medium text-primary\">{template.category}</span>\r\n                    {orch.selectedTemplate?.id === template.id && <Check className=\"w-4 h-4 text-primary\" />}\r\n                  </div>\r\n                  <p className=\"text-sm font-medium\">{template.title}</p>\r\n                  <p className=\"text-xs text-muted-foreground line-clamp-2 mt-1\">{template.description}</p>\r\n                </button>\r\n              ))}\r\n          </div>\r\n\r\n          {/* Selected Template Badge */}\r\n          {orch.selectedTemplate && (\r\n            <div className=\"flex items-center justify-between p-3 rounded-lg bg-primary/5 border border-primary/20\">\r\n              <span className=\"text-sm\">\r\n                Using: <strong>{orch.selectedTemplate.title}</strong>\r\n              </span>\r\n              <Button variant=\"ghost\" size=\"sm\" onClick={() => orch.setSelectedTemplate(null)}>\r\n                <X className=\"w-4 h-4\" />\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Template Inspiration */}\r\n          <div className=\"pt-4 border-t border-border/50\">\r\n            <button\r\n              onClick={() => orch.setShowTemplateInspiration(true)}\r\n              className=\"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors\"\r\n            >\r\n              <TrendingUp className=\"w-4 h-4\" />\r\n              Template Inspiration\r\n              {orch.featuredAdTemplates.length > 0 && (\r\n                <Badge variant=\"secondary\" className=\"text-xs\">\r\n                  {orch.featuredAdTemplates.length} featured\r\n                </Badge>\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </Section>\r\n\r\n      {/* Prompt Section */}\r\n      <motion.section\r\n        id=\"prompt\"\r\n        initial={{ opacity: 0, y: 10 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        className=\"p-6 rounded-2xl border border-border bg-card/50 space-y-6\"\r\n      >\r\n        <h2 className=\"text-lg font-semibold flex items-center gap-2\">\r\n          <Sparkles className=\"w-5 h-5 text-primary\" />\r\n          Describe Your Vision\r\n        </h2>\r\n\r\n        {/* Selected Suggestion Card */}\r\n        <AnimatePresence>\r\n          {orch.selectedSuggestion && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className=\"p-4 rounded-xl bg-primary/10 border-2 border-primary/30\"\r\n            >\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2 text-sm font-medium text-primary\">\r\n                  <Check className=\"w-4 h-4\" />\r\n                  Selected Suggestion\r\n                </div>\r\n                <button\r\n                  onClick={() => {\r\n                    orch.setSelectedSuggestion(null);\r\n                    orch.setPrompt('');\r\n                  }}\r\n                  className=\"text-muted-foreground hover:text-foreground\"\r\n                >\r\n                  <X className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n              {orch.selectedSuggestion.reasoning && (\r\n                <p className=\"text-xs text-muted-foreground mt-2\">{orch.selectedSuggestion.reasoning}</p>\r\n              )}\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Content Planner Guidance */}\r\n        {orch.cpTemplate && !orch.showCarouselBuilder && !orch.showBeforeAfterBuilder && !orch.showTextOnlyMode && (\r\n          <ContentPlannerGuidance\r\n            template={orch.cpTemplate}\r\n            onStartCarousel={(topic) => {\r\n              orch.setCarouselTopic(topic);\r\n              orch.setShowCarouselBuilder(true);\r\n            }}\r\n            onStartBeforeAfter={(topic) => {\r\n              orch.setBeforeAfterTopic(topic);\r\n              orch.setShowBeforeAfterBuilder(true);\r\n            }}\r\n            onStartTextOnly={(topic) => {\r\n              orch.setTextOnlyTopic(topic);\r\n              orch.setShowTextOnlyMode(true);\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Builders */}\r\n        {orch.showCarouselBuilder && orch.cpTemplate && (\r\n          <CarouselBuilder\r\n            topic={orch.carouselTopic}\r\n            template={orch.cpTemplate}\r\n            onClose={() => orch.setShowCarouselBuilder(false)}\r\n          />\r\n        )}\r\n        {orch.showBeforeAfterBuilder && orch.cpTemplate && (\r\n          <BeforeAfterBuilder\r\n            topic={orch.beforeAfterTopic}\r\n            template={orch.cpTemplate}\r\n            onClose={() => orch.setShowBeforeAfterBuilder(false)}\r\n          />\r\n        )}\r\n        {orch.showTextOnlyMode && orch.cpTemplate && (\r\n          <TextOnlyMode\r\n            topic={orch.textOnlyTopic}\r\n            template={orch.cpTemplate}\r\n            onClose={() => orch.setShowTextOnlyMode(false)}\r\n          />\r\n        )}\r\n\r\n        {/* Main Prompt Textarea */}\r\n        <div className=\"space-y-2\">\r\n          <div className=\"relative\">\r\n            <Textarea\r\n              id=\"prompt-textarea\"\r\n              value={orch.prompt}\r\n              onChange={(e) => orch.handlePromptChange(e.target.value)}\r\n              placeholder=\"Describe your ideal ad creative... What mood? What style? What should the image convey?\"\r\n              rows={5}\r\n              className={cn(\r\n                'resize-none text-base pr-12',\r\n                orch.selectedSuggestion && 'border-primary/50 ring-2 ring-primary/20',\r\n                mainPromptVoice.isListening && 'border-red-500/50 ring-2 ring-red-500/20',\r\n              )}\r\n            />\r\n            {mainPromptVoice.isSupported && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={mainPromptVoice.toggleListening}\r\n                className={cn(\r\n                  'absolute right-2 top-2 h-8 w-8 p-0 rounded-full',\r\n                  mainPromptVoice.isListening && 'bg-red-500/20 text-red-500 animate-pulse',\r\n                )}\r\n                aria-label={mainPromptVoice.isListening ? 'Stop listening' : 'Voice input'}\r\n              >\r\n                {mainPromptVoice.isListening ? <MicOff className=\"w-4 h-4\" /> : <Mic className=\"w-4 h-4\" />}\r\n              </Button>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center justify-between\">\r\n            {mainPromptVoice.isListening && (\r\n              <span className=\"text-xs text-red-500 animate-pulse\">Listening... speak your prompt</span>\r\n            )}\r\n            {orch.prompt && !mainPromptVoice.isListening && (\r\n              <span className=\"text-xs text-muted-foreground\">{orch.prompt.length} characters</span>\r\n            )}\r\n            <span />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Idea Bank */}\r\n        <ErrorBoundary>\r\n          <IdeaBankPanel\r\n            selectedProducts={orch.selectedProducts}\r\n            tempUploads={orch.tempUploads}\r\n            onSelectPrompt={orch.handleSelectSuggestion}\r\n            onRecipeAvailable={(recipe) => orch.setGenerationRecipe(recipe)}\r\n            onSetPlatform={orch.setPlatform}\r\n            onSetAspectRatio={orch.setAspectRatio}\r\n            onQuickGenerate={(promptText) => {\r\n              orch.setPrompt(promptText);\r\n              setTimeout(orch.handleGenerate, 100);\r\n            }}\r\n            selectedPromptId={orch.selectedSuggestion?.id}\r\n            isGenerating={orch.state === 'generating'}\r\n            mode={orch.ideaBankMode}\r\n            templateId={orch.selectedTemplateForMode?.id}\r\n          />\r\n        </ErrorBoundary>\r\n\r\n        {/* Platform, Size, Quality */}\r\n        <div className=\"flex flex-col sm:flex-row flex-wrap gap-4\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-sm text-muted-foreground\">Platform:</span>\r\n            <Select value={orch.platform} onValueChange={orch.setPlatform}>\r\n              <SelectTrigger className=\"w-36\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {['LinkedIn', 'Instagram', 'Facebook', 'Twitter', 'TikTok'].map((p) => (\r\n                  <SelectItem key={p} value={p}>\r\n                    {p}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-sm text-muted-foreground\">Size:</span>\r\n            <Select value={orch.aspectRatio} onValueChange={orch.setAspectRatio}>\r\n              <SelectTrigger className=\"w-36\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {['1200x627', '1200x1200', '1080x1350', '1920x1080', '1080x1920'].map((s) => (\r\n                  <SelectItem key={s} value={s}>\r\n                    {s}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-sm text-muted-foreground\">Quality:</span>\r\n            <Select value={orch.resolution} onValueChange={orch.setResolution}>\r\n              <SelectTrigger className=\"w-24\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {['1K', '2K', '4K'].map((q) => (\r\n                  <SelectItem key={q} value={q}>\r\n                    {q}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n      </motion.section>\r\n\r\n      {/* Style References */}\r\n      <Section\r\n        id=\"style-refs\"\r\n        title=\"Style Reference\"\r\n        icon={Palette}\r\n        isOpen={!orch.collapsedSections.styleRefs}\r\n        onToggle={() => orch.toggleSection('styleRefs')}\r\n        badge={orch.selectedStyleRefIds.length > 0 ? `${orch.selectedStyleRefIds.length}` : undefined}\r\n      >\r\n        <StyleReferenceSelector\r\n          selectedIds={orch.selectedStyleRefIds}\r\n          onSelectionChange={orch.setSelectedStyleRefIds}\r\n        />\r\n      </Section>\r\n\r\n      {/* Price Estimate */}\r\n      {orch.priceEstimate && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 10 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"p-4 rounded-xl bg-gradient-to-r from-green-500/10 to-emerald-500/5 border border-green-500/20\"\r\n        >\r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"text-xl\"></span>\r\n            <div>\r\n              <p className=\"text-sm font-medium\">\r\n                Estimated cost:{' '}\r\n                <span className=\"text-green-600 dark:text-green-400\">\r\n                  ${orch.priceEstimate.estimatedCost.toFixed(3)}\r\n                </span>\r\n              </p>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {orch.priceEstimate.usedFallback\r\n                  ? 'Based on default rates'\r\n                  : `Based on ${orch.priceEstimate.sampleCount} similar generations`}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Generate Button */}\r\n      <motion.div ref={orch.generateButtonRef} id=\"generate\" className=\"py-4\">\r\n        <Button size=\"lg\" onClick={orch.handleGenerate} disabled={!orch.canGenerate} className=\"w-full h-16 text-lg\">\r\n          <Sparkles className=\"w-5 h-5 mr-2\" />\r\n          Generate Image\r\n        </Button>\r\n        <p className=\"text-center text-sm text-muted-foreground mt-3\">\r\n          {orch.selectedProducts.length + orch.tempUploads.length} image\r\n          {orch.selectedProducts.length + orch.tempUploads.length !== 1 ? 's' : ''}  {orch.platform} {' '}\r\n          {orch.resolution}\r\n        </p>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\MainCanvas\\GeneratingView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\MainCanvas\\ResultViewEnhanced.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\MainCanvas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\SmartCanvas.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isGenerating' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cn } from '@/lib/utils';\r\nimport { useStudioState } from '@/hooks/useStudioState';\r\nimport { PromptEditor } from './sections/PromptEditor';\r\nimport { OutputSettings } from './sections/OutputSettings';\r\nimport { GenerateButton } from './sections/GenerateButton';\r\nimport { ResultView } from './sections/ResultView';\r\n\r\ninterface SmartCanvasProps {\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * SmartCanvas - Central generation workspace\r\n *\r\n * Orchestrates the generation workflow:\r\n * 1. Prompt editing with IdeaBank suggestions\r\n * 2. Output settings (platform, aspect ratio, resolution)\r\n * 3. Generate button with price estimate\r\n * 4. Result display with actions (edit, copy, preview, save)\r\n */\r\nexport function SmartCanvas({ className }: SmartCanvasProps) {\r\n  const { hasResult, isGenerating } = useStudioState();\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex flex-col h-full bg-background',\r\n        className\r\n      )}\r\n    >\r\n      {/* Main content area */}\r\n      <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n        {/* Show result view if we have a generated image */}\r\n        {hasResult ? (\r\n          <ResultView />\r\n        ) : (\r\n          <>\r\n            {/* Prompt Section */}\r\n            <section className=\"space-y-4\">\r\n              <h2 className=\"text-lg font-medium\">Describe Your Vision</h2>\r\n              <PromptEditor />\r\n            </section>\r\n\r\n            {/* Output Settings */}\r\n            <section className=\"space-y-4\">\r\n              <h2 className=\"text-lg font-medium\">Output Settings</h2>\r\n              <OutputSettings />\r\n            </section>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Sticky Generate Button */}\r\n      {!hasResult && (\r\n        <div className=\"border-t border-border p-4 bg-card/50 backdrop-blur-sm\">\r\n          <GenerateButton />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\sections\\GenerateButton.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'tempUploads'. Either include it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":76,"suggestions":[{"desc":"Update the dependencies array to be: [selectedProducts.length, tempUploads.length, resolution, canGenerate, tempUploads]","fix":{"range":[1700,1770],"text":"[selectedProducts.length, tempUploads.length, resolution, canGenerate, tempUploads]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":114,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { useStudioState } from '@/hooks/useStudioState';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Sparkles, Loader2 } from 'lucide-react';\r\nimport { getProductImageUrl } from '@/lib/utils';\r\n\r\ninterface PriceEstimate {\r\n  estimatedCost: number;\r\n  p90: number;\r\n  sampleCount: number;\r\n  usedFallback: boolean;\r\n}\r\n\r\n/**\r\n * GenerateButton - Main generation trigger with price estimate\r\n */\r\nexport function GenerateButton() {\r\n  const queryClient = useQueryClient();\r\n  const {\r\n    state: {\r\n      selectedProducts,\r\n      tempUploads,\r\n      prompt,\r\n      platform,\r\n      aspectRatio,\r\n      resolution,\r\n      generationMode,\r\n      generationRecipe,\r\n      selectedTemplate,\r\n    },\r\n    canGenerate,\r\n    isGenerating,\r\n    setGenerating,\r\n    setResult,\r\n  } = useStudioState();\r\n\r\n  const [priceEstimate, setPriceEstimate] = useState<PriceEstimate | null>(null);\r\n\r\n  // Fetch price estimate\r\n  useEffect(() => {\r\n    const fetchEstimate = async () => {\r\n      try {\r\n        const res = await fetch('/api/estimate-cost', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          credentials: 'include',\r\n          body: JSON.stringify({\r\n            imageCount: selectedProducts.length + tempUploads.filter(u => u.status === 'confirmed').length,\r\n            resolution,\r\n          }),\r\n        });\r\n        if (res.ok) {\r\n          setPriceEstimate(await res.json());\r\n        }\r\n      } catch {\r\n        // Ignore estimate errors\r\n      }\r\n    };\r\n\r\n    if (canGenerate) {\r\n      fetchEstimate();\r\n    }\r\n  }, [selectedProducts.length, tempUploads.length, resolution, canGenerate]);\r\n\r\n  // Generation mutation\r\n  const generateMutation = useMutation({\r\n    mutationFn: async () => {\r\n      // Collect all image URLs\r\n      const productUrls = selectedProducts\r\n        .map((p) => getProductImageUrl(p.cloudinaryUrl))\r\n        .filter(Boolean);\r\n\r\n      const uploadUrls = tempUploads\r\n        .filter((u) => u.status === 'confirmed')\r\n        .map((u) => u.previewUrl);\r\n\r\n      const allImageUrls = [...productUrls, ...uploadUrls];\r\n\r\n      if (allImageUrls.length === 0) {\r\n        throw new Error('No images selected');\r\n      }\r\n\r\n      const response = await fetch('/api/transform', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          imageUrls: allImageUrls,\r\n          prompt,\r\n          platform,\r\n          outputSize: aspectRatio,\r\n          quality: resolution,\r\n          mode: generationMode,\r\n          templateId: selectedTemplate?.id,\r\n          recipe: generationRecipe,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.error || 'Generation failed');\r\n      }\r\n\r\n      return response.json();\r\n    },\r\n    onMutate: () => {\r\n      setGenerating();\r\n    },\r\n    onSuccess: (data) => {\r\n      setResult(data.imageUrl, data.generationId);\r\n      queryClient.invalidateQueries({ queryKey: ['generations'] });\r\n    },\r\n    onError: (error) => {\r\n      // Reset to idle on error - error handling could be enhanced\r\n    },\r\n  });\r\n\r\n  const handleGenerate = () => {\r\n    generateMutation.mutate();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <Button\r\n        onClick={handleGenerate}\r\n        disabled={!canGenerate || isGenerating}\r\n        className=\"w-full h-12 text-lg\"\r\n        size=\"lg\"\r\n      >\r\n        {isGenerating ? (\r\n          <>\r\n            <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n            Generating...\r\n          </>\r\n        ) : (\r\n          <>\r\n            <Sparkles className=\"w-5 h-5 mr-2\" />\r\n            Generate Image\r\n          </>\r\n        )}\r\n      </Button>\r\n\r\n      {/* Price estimate and info */}\r\n      <div className=\"flex items-center justify-between text-xs text-muted-foreground px-1\">\r\n        <span>\r\n          {selectedProducts.length + tempUploads.filter(u => u.status === 'confirmed').length} image\r\n          {selectedProducts.length + tempUploads.filter(u => u.status === 'confirmed').length !== 1 ? 's' : ''} selected\r\n        </span>\r\n        {priceEstimate && (\r\n          <span>\r\n            Est. ${priceEstimate.estimatedCost.toFixed(3)}\r\n          </span>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\sections\\OutputSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\sections\\PromptEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIdeaBankMode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useStudioState } from '@/hooks/useStudioState';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { IdeaBankPanel } from '@/components/IdeaBankPanel';\r\nimport { Sparkles, X } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\n/**\r\n * PromptEditor - Main prompt input with IdeaBank integration\r\n *\r\n * Features:\r\n * - Textarea for prompt editing\r\n * - Selected suggestion display\r\n * - IdeaBank suggestions panel\r\n * - Character count\r\n */\r\nexport function PromptEditor() {\r\n  const {\r\n    state: {\r\n      prompt,\r\n      selectedSuggestion,\r\n      selectedProducts,\r\n      tempUploads,\r\n      ideaBankMode,\r\n    },\r\n    setPrompt,\r\n    setSuggestion,\r\n    setRecipe,\r\n    setIdeaBankMode,\r\n  } = useStudioState();\r\n\r\n  const hasImages = selectedProducts.length > 0 || tempUploads.length > 0;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Selected Suggestion Card */}\r\n      {selectedSuggestion && (\r\n        <div className=\"p-3 rounded-lg bg-primary/5 border border-primary/20 animate-in fade-in-50 duration-300\">\r\n          <div className=\"flex items-start justify-between gap-3\">\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-center gap-2 mb-1\">\r\n                <Sparkles className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"text-xs font-medium text-primary\">AI Suggestion</span>\r\n              </div>\r\n              <p className=\"text-sm\">{selectedSuggestion.prompt}</p>\r\n              {selectedSuggestion.reasoning && (\r\n                <p className=\"text-xs text-muted-foreground mt-1\">\r\n                  {selectedSuggestion.reasoning}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <button\r\n              onClick={() => setSuggestion(null)}\r\n              className=\"p-1 rounded hover:bg-muted transition-colors\"\r\n            >\r\n              <X className=\"w-4 h-4 text-muted-foreground\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main Textarea */}\r\n      <div className=\"relative\">\r\n        <Textarea\r\n          placeholder={\r\n            hasImages\r\n              ? 'Describe how you want your ad image to look...'\r\n              : 'Select products or upload images first, then describe your vision...'\r\n          }\r\n          value={prompt}\r\n          onChange={(e) => setPrompt(e.target.value)}\r\n          className={cn(\r\n            'min-h-[120px] resize-none',\r\n            !hasImages && 'opacity-50'\r\n          )}\r\n          disabled={!hasImages}\r\n        />\r\n        <div className=\"absolute bottom-2 right-2 text-xs text-muted-foreground\">\r\n          {prompt.length}/2000\r\n        </div>\r\n      </div>\r\n\r\n      {/* IdeaBank Panel */}\r\n      {hasImages && (\r\n        <IdeaBankPanel\r\n          selectedProducts={selectedProducts}\r\n          tempUploads={tempUploads}\r\n          mode={ideaBankMode}\r\n          onSelectPrompt={(prompt: string, id?: string, reasoning?: string) => {\r\n            setSuggestion({\r\n              id: id || '',\r\n              prompt,\r\n              reasoning,\r\n            });\r\n          }}\r\n          onRecipeAvailable={setRecipe}\r\n        />\r\n      )}\r\n\r\n      {/* Mode Badge */}\r\n      {ideaBankMode !== 'freestyle' && (\r\n        <Badge variant=\"outline\" className=\"text-xs\">\r\n          Mode: {ideaBankMode}\r\n        </Badge>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\sections\\ResultView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3230,3233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3230,3233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useStudioState } from '@/hooks/useStudioState';\r\nimport { Button } from '@/components/ui/button';\r\nimport { SimplifiedCopyPanel } from '@/components/SimplifiedCopyPanel';\r\nimport { LinkedInPostPreview } from '@/components/LinkedInPostPreview';\r\nimport {\r\n  Download,\r\n  RefreshCw,\r\n  Eye,\r\n} from 'lucide-react';\r\n\r\n/**\r\n * ResultView - Generated image display with actions\r\n *\r\n * Features:\r\n * - Generated image display\r\n * - Action buttons (download, regenerate)\r\n * - LinkedIn preview\r\n * - Copy generation\r\n */\r\nexport function ResultView() {\r\n  const {\r\n    state: { generatedImage, generationId, platform, generatedCopy },\r\n    clearGeneration,\r\n    setGeneratedCopy,\r\n  } = useStudioState();\r\n\r\n  const [showPreview, setShowPreview] = useState(false);\r\n\r\n  // Download handler\r\n  const handleDownload = async () => {\r\n    if (!generatedImage) return;\r\n\r\n    const response = await fetch(generatedImage);\r\n    const blob = await response.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `generated-ad-${generationId}.png`;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  if (!generatedImage) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Generated Image */}\r\n      <div className=\"relative rounded-xl overflow-hidden border border-border bg-card\">\r\n        <img\r\n          src={generatedImage}\r\n          alt=\"Generated ad\"\r\n          className=\"w-full h-auto\"\r\n        />\r\n\r\n        {/* Action overlay */}\r\n        <div className=\"absolute top-3 right-3 flex gap-2\">\r\n          <Button size=\"icon\" variant=\"secondary\" onClick={handleDownload}>\r\n            <Download className=\"w-4 h-4\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Action Buttons */}\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <Button variant=\"outline\" onClick={clearGeneration} className=\"gap-2\">\r\n          <RefreshCw className=\"w-4 h-4\" />\r\n          New Generation\r\n        </Button>\r\n\r\n        {platform === 'LinkedIn' && (\r\n          <Button\r\n            variant={showPreview ? 'default' : 'outline'}\r\n            onClick={() => setShowPreview(!showPreview)}\r\n            className=\"gap-2\"\r\n          >\r\n            <Eye className=\"w-4 h-4\" />\r\n            Preview\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      {/* LinkedIn Preview */}\r\n      {showPreview && platform === 'LinkedIn' && (\r\n        <div className=\"p-4 rounded-lg border border-border bg-card space-y-3\">\r\n          <h3 className=\"font-medium text-sm flex items-center gap-2\">\r\n            <Eye className=\"w-4 h-4\" />\r\n            LinkedIn Post Preview\r\n          </h3>\r\n          <LinkedInPostPreview\r\n            authorName=\"Your Brand\"\r\n            postText={generatedCopy}\r\n            imageUrl={generatedImage}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Copy Generation */}\r\n      {generationId && (\r\n        <div className=\"p-4 rounded-lg border border-border bg-card space-y-3\">\r\n          <h3 className=\"font-medium text-sm\">Ad Copy</h3>\r\n          <SimplifiedCopyPanel\r\n            generationId={generationId}\r\n            platform={platform.toLowerCase() as any}\r\n            onCopyGenerated={setGeneratedCopy}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\SmartCanvas\\sections\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\StyleReferenceSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\components\\studio\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\context\\StudioContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\context\\__tests__\\StudioContext.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudioAction' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"StudioAction"},"fix":{"range":[251,268],"text":""},"desc":"Remove unused variable \"StudioAction\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4190,4193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4190,4193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5721,5724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5721,5724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6054,6057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6054,6057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6825,6828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6825,6828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":352,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11180,11183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11180,11183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11493,11496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11493,11496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":411,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13202,13205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13202,13205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":432,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":432,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13784,13787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13784,13787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":468,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":468,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14723,14726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14723,14726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":526,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":526,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16471,16474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16471,16474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { renderHook, act } from '@testing-library/react';\r\nimport { ReactNode } from 'react';\r\nimport {\r\n  StudioProvider,\r\n  useStudioContext,\r\n  studioReducer,\r\n  initialStudioState,\r\n  StudioState,\r\n  StudioAction,\r\n} from '../StudioContext';\r\n\r\n// ============================================\r\n// Test Wrapper\r\n// ============================================\r\n\r\nconst createWrapper = (initialState?: Partial<StudioState>) => {\r\n  return function Wrapper({ children }: { children: ReactNode }) {\r\n    return <StudioProvider initialState={initialState}>{children}</StudioProvider>;\r\n  };\r\n};\r\n\r\n// ============================================\r\n// StudioProvider Tests (15 tests)\r\n// ============================================\r\n\r\ndescribe('StudioProvider', () => {\r\n  it('provides initial state', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    expect(result.current.state).toEqual(initialStudioState);\r\n  });\r\n\r\n  it('allows custom initial state', () => {\r\n    const customState = { prompt: 'Custom prompt', platform: 'Instagram' };\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(customState),\r\n    });\r\n\r\n    expect(result.current.state.prompt).toBe('Custom prompt');\r\n    expect(result.current.state.platform).toBe('Instagram');\r\n  });\r\n\r\n  it('provides dispatch function', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    expect(typeof result.current.dispatch).toBe('function');\r\n  });\r\n\r\n  it('updates state when dispatch is called', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_PROMPT', prompt: 'New prompt' });\r\n    });\r\n\r\n    expect(result.current.state.prompt).toBe('New prompt');\r\n  });\r\n\r\n  it('renders children correctly', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    expect(result.current).toBeDefined();\r\n  });\r\n});\r\n\r\ndescribe('useStudioContext', () => {\r\n  it('throws when used outside provider', () => {\r\n    // Suppress error output for this test\r\n    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n\r\n    expect(() => {\r\n      renderHook(() => useStudioContext());\r\n    }).toThrow('useStudioContext must be used within a StudioProvider');\r\n\r\n    consoleSpy.mockRestore();\r\n  });\r\n});\r\n\r\n// ============================================\r\n// studioReducer Tests (35 tests)\r\n// ============================================\r\n\r\ndescribe('studioReducer', () => {\r\n  describe('Generation Actions', () => {\r\n    it('SET_GENERATION_STATE updates generationState', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_GENERATION_STATE',\r\n        state: 'generating',\r\n      });\r\n      expect(result.generationState).toBe('generating');\r\n    });\r\n\r\n    it('SET_GENERATED_IMAGE sets image, id, and state', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_GENERATED_IMAGE',\r\n        image: 'http://example.com/image.jpg',\r\n        id: 'gen-123',\r\n      });\r\n      expect(result.generatedImage).toBe('http://example.com/image.jpg');\r\n      expect(result.generationId).toBe('gen-123');\r\n      expect(result.generationState).toBe('result');\r\n    });\r\n\r\n    it('CLEAR_GENERATION resets generation state', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        generationState: 'result',\r\n        generatedImage: 'http://example.com/image.jpg',\r\n        generationId: 'gen-123',\r\n      };\r\n      const result = studioReducer(state, { type: 'CLEAR_GENERATION' });\r\n      expect(result.generationState).toBe('idle');\r\n      expect(result.generatedImage).toBeNull();\r\n      expect(result.generationId).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Product Actions', () => {\r\n    const mockProduct = {\r\n      id: 'prod-1',\r\n      name: 'Test Product',\r\n      cloudinaryUrl: 'http://example.com/product.jpg',\r\n    } as any;\r\n\r\n    it('SELECT_PRODUCT adds product to selection', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SELECT_PRODUCT',\r\n        product: mockProduct,\r\n      });\r\n      expect(result.selectedProducts).toHaveLength(1);\r\n      expect(result.selectedProducts[0]).toEqual(mockProduct);\r\n    });\r\n\r\n    it('SELECT_PRODUCT does not add duplicate products', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        selectedProducts: [mockProduct],\r\n      };\r\n      const result = studioReducer(state, {\r\n        type: 'SELECT_PRODUCT',\r\n        product: mockProduct,\r\n      });\r\n      expect(result.selectedProducts).toHaveLength(1);\r\n    });\r\n\r\n    it('DESELECT_PRODUCT removes product from selection', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        selectedProducts: [mockProduct],\r\n      };\r\n      const result = studioReducer(state, {\r\n        type: 'DESELECT_PRODUCT',\r\n        productId: 'prod-1',\r\n      });\r\n      expect(result.selectedProducts).toHaveLength(0);\r\n    });\r\n\r\n    it('CLEAR_PRODUCTS empties product selection', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        selectedProducts: [mockProduct],\r\n      };\r\n      const result = studioReducer(state, { type: 'CLEAR_PRODUCTS' });\r\n      expect(result.selectedProducts).toHaveLength(0);\r\n    });\r\n\r\n    it('SET_PRODUCTS replaces entire selection', () => {\r\n      const products = [mockProduct, { ...mockProduct, id: 'prod-2' }] as any[];\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_PRODUCTS',\r\n        products,\r\n      });\r\n      expect(result.selectedProducts).toHaveLength(2);\r\n    });\r\n  });\r\n\r\n  describe('Template Actions', () => {\r\n    const mockTemplate = {\r\n      id: 'template-1',\r\n      name: 'Test Template',\r\n    } as any;\r\n\r\n    it('SELECT_TEMPLATE sets selected template', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SELECT_TEMPLATE',\r\n        template: mockTemplate,\r\n      });\r\n      expect(result.selectedTemplate).toEqual(mockTemplate);\r\n    });\r\n\r\n    it('CLEAR_TEMPLATE removes selected template', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        selectedTemplate: mockTemplate,\r\n      };\r\n      const result = studioReducer(state, { type: 'CLEAR_TEMPLATE' });\r\n      expect(result.selectedTemplate).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Upload Actions', () => {\r\n    const mockUpload = {\r\n      id: 'upload-1',\r\n      previewUrl: 'http://example.com/upload.jpg',\r\n      status: 'confirmed',\r\n    } as any;\r\n\r\n    it('SET_UPLOADS replaces all uploads', () => {\r\n      const uploads = [mockUpload];\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_UPLOADS',\r\n        uploads,\r\n      });\r\n      expect(result.tempUploads).toEqual(uploads);\r\n    });\r\n\r\n    it('ADD_UPLOAD appends an upload', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'ADD_UPLOAD',\r\n        upload: mockUpload,\r\n      });\r\n      expect(result.tempUploads).toHaveLength(1);\r\n      expect(result.tempUploads[0]).toEqual(mockUpload);\r\n    });\r\n\r\n    it('UPDATE_UPLOAD modifies specific upload', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        tempUploads: [mockUpload],\r\n      };\r\n      const result = studioReducer(state, {\r\n        type: 'UPDATE_UPLOAD',\r\n        id: 'upload-1',\r\n        updates: { status: 'processing' },\r\n      });\r\n      expect(result.tempUploads[0]?.status).toBe('processing');\r\n    });\r\n\r\n    it('REMOVE_UPLOAD deletes specific upload', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        tempUploads: [mockUpload],\r\n      };\r\n      const result = studioReducer(state, {\r\n        type: 'REMOVE_UPLOAD',\r\n        id: 'upload-1',\r\n      });\r\n      expect(result.tempUploads).toHaveLength(0);\r\n    });\r\n\r\n    it('CLEAR_UPLOADS empties all uploads', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        tempUploads: [mockUpload],\r\n      };\r\n      const result = studioReducer(state, { type: 'CLEAR_UPLOADS' });\r\n      expect(result.tempUploads).toHaveLength(0);\r\n    });\r\n  });\r\n\r\n  describe('Prompt Actions', () => {\r\n    it('SET_PROMPT updates prompt', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_PROMPT',\r\n        prompt: 'New creative prompt',\r\n      });\r\n      expect(result.prompt).toBe('New creative prompt');\r\n    });\r\n\r\n    it('SET_SUGGESTION updates suggestion and prompt', () => {\r\n      const suggestion = {\r\n        id: 'sug-1',\r\n        prompt: 'Suggested prompt text',\r\n        reasoning: 'This would work because...',\r\n      };\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_SUGGESTION',\r\n        suggestion,\r\n      });\r\n      expect(result.selectedSuggestion).toEqual(suggestion);\r\n      expect(result.prompt).toBe('Suggested prompt text');\r\n    });\r\n\r\n    it('SET_SUGGESTION with null clears suggestion but keeps prompt', () => {\r\n      const state: StudioState = {\r\n        ...initialStudioState,\r\n        selectedSuggestion: { id: '1', prompt: 'test' },\r\n        prompt: 'existing prompt',\r\n      };\r\n      const result = studioReducer(state, {\r\n        type: 'SET_SUGGESTION',\r\n        suggestion: null,\r\n      });\r\n      expect(result.selectedSuggestion).toBeNull();\r\n      expect(result.prompt).toBe('existing prompt');\r\n    });\r\n  });\r\n\r\n  describe('Output Settings Actions', () => {\r\n    it('SET_PLATFORM updates platform', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_PLATFORM',\r\n        platform: 'Instagram',\r\n      });\r\n      expect(result.platform).toBe('Instagram');\r\n    });\r\n\r\n    it('SET_ASPECT_RATIO updates aspectRatio', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_ASPECT_RATIO',\r\n        aspectRatio: '1080x1080',\r\n      });\r\n      expect(result.aspectRatio).toBe('1080x1080');\r\n    });\r\n\r\n    it('SET_RESOLUTION updates resolution', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_RESOLUTION',\r\n        resolution: '4K',\r\n      });\r\n      expect(result.resolution).toBe('4K');\r\n    });\r\n  });\r\n\r\n  describe('Mode Actions', () => {\r\n    it('SET_IDEABANK_MODE updates ideaBankMode', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_IDEABANK_MODE',\r\n        mode: 'guided',\r\n      });\r\n      expect(result.ideaBankMode).toBe('guided');\r\n    });\r\n\r\n    it('SET_GENERATION_MODE updates generationMode', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_GENERATION_MODE',\r\n        mode: 'template',\r\n      });\r\n      expect(result.generationMode).toBe('template');\r\n    });\r\n\r\n    it('SET_TEMPLATE_FOR_MODE updates selectedTemplateForMode', () => {\r\n      const template = { id: 't1', name: 'Template' } as any;\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_TEMPLATE_FOR_MODE',\r\n        template,\r\n      });\r\n      expect(result.selectedTemplateForMode).toEqual(template);\r\n    });\r\n\r\n    it('SET_RECIPE updates generationRecipe', () => {\r\n      const recipe = { id: 'r1', steps: [] } as any;\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_RECIPE',\r\n        recipe,\r\n      });\r\n      expect(result.generationRecipe).toEqual(recipe);\r\n    });\r\n  });\r\n\r\n  describe('Copy Actions', () => {\r\n    it('SET_GENERATED_COPY updates generatedCopy', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'SET_GENERATED_COPY',\r\n        copy: 'Amazing ad copy for your product!',\r\n      });\r\n      expect(result.generatedCopy).toBe('Amazing ad copy for your product!');\r\n    });\r\n  });\r\n\r\n  describe('Reset and Load Actions', () => {\r\n    it('RESET returns to initial state', () => {\r\n      const modifiedState: StudioState = {\r\n        ...initialStudioState,\r\n        prompt: 'Modified',\r\n        platform: 'Instagram',\r\n        generationState: 'result',\r\n      };\r\n      const result = studioReducer(modifiedState, { type: 'RESET' });\r\n      expect(result).toEqual(initialStudioState);\r\n    });\r\n\r\n    it('LOAD_FROM_HISTORY merges payload into state', () => {\r\n      const payload = {\r\n        prompt: 'History prompt',\r\n        generatedImage: 'http://example.com/history.jpg',\r\n      };\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'LOAD_FROM_HISTORY',\r\n        payload,\r\n      });\r\n      expect(result.prompt).toBe('History prompt');\r\n      expect(result.generatedImage).toBe('http://example.com/history.jpg');\r\n      // Other values unchanged\r\n      expect(result.platform).toBe(initialStudioState.platform);\r\n    });\r\n  });\r\n\r\n  describe('Default case', () => {\r\n    it('returns current state for unknown actions', () => {\r\n      const result = studioReducer(initialStudioState, {\r\n        type: 'UNKNOWN_ACTION' as any,\r\n      });\r\n      expect(result).toEqual(initialStudioState);\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// Integration Tests (5 tests)\r\n// ============================================\r\n\r\ndescribe('StudioContext Integration', () => {\r\n  it('handles full generation workflow', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    // Select product\r\n    act(() => {\r\n      result.current.dispatch({\r\n        type: 'SELECT_PRODUCT',\r\n        product: { id: '1', name: 'Product' } as any,\r\n      });\r\n    });\r\n\r\n    // Set prompt\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_PROMPT', prompt: 'Generate ad' });\r\n    });\r\n\r\n    // Start generating\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_GENERATION_STATE', state: 'generating' });\r\n    });\r\n\r\n    // Complete generation\r\n    act(() => {\r\n      result.current.dispatch({\r\n        type: 'SET_GENERATED_IMAGE',\r\n        image: 'http://result.jpg',\r\n        id: 'gen-1',\r\n      });\r\n    });\r\n\r\n    expect(result.current.state.generationState).toBe('result');\r\n    expect(result.current.state.generatedImage).toBe('http://result.jpg');\r\n  });\r\n\r\n  it('handles upload workflow', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    // Add upload\r\n    act(() => {\r\n      result.current.dispatch({\r\n        type: 'ADD_UPLOAD',\r\n        upload: { id: 'u1', status: 'pending' } as any,\r\n      });\r\n    });\r\n\r\n    // Update upload status\r\n    act(() => {\r\n      result.current.dispatch({\r\n        type: 'UPDATE_UPLOAD',\r\n        id: 'u1',\r\n        updates: { status: 'confirmed' },\r\n      });\r\n    });\r\n\r\n    expect(result.current.state.tempUploads[0]?.status).toBe('confirmed');\r\n  });\r\n\r\n  it('preserves state across multiple dispatches', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_PROMPT', prompt: 'Test' });\r\n    });\r\n\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_PLATFORM', platform: 'Facebook' });\r\n    });\r\n\r\n    expect(result.current.state.prompt).toBe('Test');\r\n    expect(result.current.state.platform).toBe('Facebook');\r\n  });\r\n\r\n  it('handles complex mode switching', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_IDEABANK_MODE', mode: 'guided' });\r\n      result.current.dispatch({ type: 'SET_GENERATION_MODE', mode: 'template' });\r\n    });\r\n\r\n    expect(result.current.state.ideaBankMode).toBe('guided');\r\n    expect(result.current.state.generationMode).toBe('template');\r\n  });\r\n\r\n  it('clears all state on reset', () => {\r\n    const { result } = renderHook(() => useStudioContext(), {\r\n      wrapper: createWrapper(),\r\n    });\r\n\r\n    // Modify multiple state values\r\n    act(() => {\r\n      result.current.dispatch({ type: 'SET_PROMPT', prompt: 'Modified' });\r\n      result.current.dispatch({ type: 'SET_PLATFORM', platform: 'TikTok' });\r\n      result.current.dispatch({\r\n        type: 'SELECT_PRODUCT',\r\n        product: { id: '1' } as any,\r\n      });\r\n    });\r\n\r\n    // Reset\r\n    act(() => {\r\n      result.current.dispatch({ type: 'RESET' });\r\n    });\r\n\r\n    expect(result.current.state).toEqual(initialStudioState);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\context\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\contexts\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\contexts\\__tests__\\AuthContext.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { renderHook, act, waitFor } from '@testing-library/react';\r\nimport { ReactNode } from 'react';\r\nimport { AuthProvider, useAuth } from '../AuthContext';\r\nimport { _resetCsrfToken } from '@/lib/queryClient';\r\n\r\n// Mock wouter\r\nvi.mock('wouter', () => ({\r\n  useLocation: () => ['/test', vi.fn()],\r\n}));\r\n\r\n// ============================================\r\n// Test Wrapper\r\n// ============================================\r\n\r\nconst createWrapper = () => {\r\n  return function Wrapper({ children }: { children: ReactNode }) {\r\n    return <AuthProvider>{children}</AuthProvider>;\r\n  };\r\n};\r\n\r\n// Helper: create a mock fetch that handles CSRF token requests automatically\r\nfunction createSmartMockFetch(\r\n  responses: Array<{ ok: boolean; status?: number; json?: () => Promise<unknown>; text?: () => Promise<string> }>,\r\n) {\r\n  const csrfResponse = {\r\n    ok: true,\r\n    json: () => Promise.resolve({ csrfToken: 'test-csrf-token' }),\r\n  };\r\n\r\n  const mockFn = vi.fn();\r\n  let responseIndex = 0;\r\n\r\n  mockFn.mockImplementation((url: string) => {\r\n    if (url === '/api/csrf-token') {\r\n      return Promise.resolve(csrfResponse);\r\n    }\r\n    const response = responses[responseIndex];\r\n    responseIndex++;\r\n    return Promise.resolve(response);\r\n  });\r\n\r\n  return mockFn;\r\n}\r\n\r\n// ============================================\r\n// AuthProvider Tests (30 tests)\r\n// ============================================\r\n\r\ndescribe('AuthProvider', () => {\r\n  let originalFetch: typeof fetch;\r\n\r\n  beforeEach(() => {\r\n    originalFetch = global.fetch;\r\n    _resetCsrfToken(); // Clear cached CSRF token between tests\r\n  });\r\n\r\n  afterEach(() => {\r\n    global.fetch = originalFetch;\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('initial state', () => {\r\n    it('starts with loading true', async () => {\r\n      global.fetch = vi.fn().mockImplementation(() => new Promise(() => {})); // Never resolves\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper(),\r\n      });\r\n\r\n      expect(result.current.isLoading).toBe(true);\r\n    });\r\n\r\n    it('starts with user null', async () => {\r\n      global.fetch = vi.fn().mockImplementation(() => new Promise(() => {}));\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper(),\r\n      });\r\n\r\n      expect(result.current.user).toBeNull();\r\n    });\r\n\r\n    it('starts with isAuthenticated false', async () => {\r\n      global.fetch = vi.fn().mockImplementation(() => new Promise(() => {}));\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper(),\r\n      });\r\n\r\n      expect(result.current.isAuthenticated).toBe(false);\r\n    });\r\n\r\n    it('starts with error null', async () => {\r\n      global.fetch = vi.fn().mockImplementation(() => new Promise(() => {}));\r\n\r\n      const { result } = renderHook(() => useAuth(), {\r\n        wrapper: createWrapper(),\r\n      });\r\n\r\n      expect(result.current.error).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('checkAuth on mount', () => {\r\n    it('checks auth status on mount', async () => {\r\n      const mockFetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({ authenticated: true, id: 'user-1', email: 'test@example.com' }),\r\n      });\r\n      global.fetch = mockFetch;\r\n\r\n      renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => {\r\n        expect(mockFetch).toHaveBeenCalledWith('/api/auth/me', { credentials: 'include' });\r\n      });\r\n    });\r\n\r\n    it('sets user when authenticated', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({ authenticated: true, id: 'user-1', email: 'test@example.com' }),\r\n      });\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.user).toEqual({ id: 'user-1', email: 'test@example.com' });\r\n        expect(result.current.isAuthenticated).toBe(true);\r\n        expect(result.current.isLoading).toBe(false);\r\n      });\r\n    });\r\n\r\n    it('sets user to null when not authenticated', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 401,\r\n      });\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.user).toBeNull();\r\n        expect(result.current.isAuthenticated).toBe(false);\r\n        expect(result.current.isLoading).toBe(false);\r\n      });\r\n    });\r\n\r\n    it('handles network errors gracefully', async () => {\r\n      global.fetch = vi.fn().mockRejectedValue(new Error('Network error'));\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => {\r\n        expect(result.current.user).toBeNull();\r\n        expect(result.current.isAuthenticated).toBe(false);\r\n        expect(result.current.isLoading).toBe(false);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('login', () => {\r\n    it('calls login endpoint with credentials', async () => {\r\n      // checkAuth returns not authenticated, then CSRF + login\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth - not logged in\r\n        { ok: true, json: () => Promise.resolve({ id: 'user-1', email: 'test@example.com' }) }, // login\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      await act(async () => {\r\n        await result.current.login('test@example.com', 'password123');\r\n      });\r\n\r\n      // apiRequest adds CSRF token and Content-Type headers\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/auth/login',\r\n        expect.objectContaining({\r\n          method: 'POST',\r\n          credentials: 'include',\r\n          body: JSON.stringify({ email: 'test@example.com', password: 'password123' }),\r\n        }),\r\n      );\r\n    });\r\n\r\n    it('sets user on successful login', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth - not logged in\r\n        { ok: true, json: () => Promise.resolve({ id: 'user-1', email: 'test@example.com' }) }, // login\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      await act(async () => {\r\n        await result.current.login('test@example.com', 'password123');\r\n      });\r\n\r\n      expect(result.current.user).toEqual({ id: 'user-1', email: 'test@example.com' });\r\n      expect(result.current.isAuthenticated).toBe(true);\r\n    });\r\n\r\n    it('sets error on failed login', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth\r\n        { ok: false, status: 401, text: () => Promise.resolve('Invalid credentials') }, // login fails\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      await act(async () => {\r\n        try {\r\n          await result.current.login('test@example.com', 'wrongpassword');\r\n        } catch {\r\n          // Expected to throw\r\n        }\r\n      });\r\n\r\n      expect(result.current.error).toBeTruthy();\r\n      expect(result.current.user).toBeNull();\r\n    });\r\n\r\n    it('throws error on login failure', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth\r\n        { ok: false, status: 401, text: () => Promise.resolve('Invalid credentials') }, // login fails\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      // login() throws on failure, verify via try/catch inside act()\r\n      let thrownError: Error | null = null;\r\n      await act(async () => {\r\n        try {\r\n          await result.current.login('test@example.com', 'wrongpassword');\r\n        } catch (err) {\r\n          thrownError = err as Error;\r\n        }\r\n      });\r\n\r\n      expect(thrownError).toBeTruthy();\r\n      expect(thrownError!.message).toContain('401');\r\n    });\r\n\r\n    it('clears previous error before login attempt', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth\r\n        { ok: false, status: 401, text: () => Promise.resolve('First error') }, // first login fails\r\n        { ok: true, json: () => Promise.resolve({ id: 'user-1', email: 'test@example.com' }) }, // second login succeeds\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      // First failed login\r\n      await act(async () => {\r\n        try {\r\n          await result.current.login('test@example.com', 'wrong');\r\n        } catch {\r\n          // Expected\r\n        }\r\n      });\r\n\r\n      expect(result.current.error).toBeTruthy();\r\n\r\n      // Second successful login - error should be cleared\r\n      await act(async () => {\r\n        await result.current.login('test@example.com', 'correct');\r\n      });\r\n\r\n      expect(result.current.error).toBeNull();\r\n    });\r\n\r\n    it('sets isLoading during login', async () => {\r\n      let resolveLogin: (value: unknown) => void;\r\n      const loginPromise = new Promise((resolve) => {\r\n        resolveLogin = resolve;\r\n      });\r\n\r\n      const mockFetch = vi.fn().mockImplementation((url: string) => {\r\n        if (url === '/api/csrf-token') {\r\n          return Promise.resolve({\r\n            ok: true,\r\n            json: () => Promise.resolve({ csrfToken: 'test-csrf-token' }),\r\n          });\r\n        }\r\n        if (url === '/api/auth/me') {\r\n          return Promise.resolve({ ok: false });\r\n        }\r\n        // login call\r\n        return loginPromise;\r\n      });\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      act(() => {\r\n        result.current.login('test@example.com', 'password').catch(() => {});\r\n      });\r\n\r\n      // Should be loading during login\r\n      expect(result.current.isLoading).toBe(true);\r\n\r\n      // Complete login\r\n      await act(async () => {\r\n        resolveLogin!({\r\n          ok: true,\r\n          json: () => Promise.resolve({ id: '1', email: 'test@example.com' }),\r\n        });\r\n        await new Promise((r) => setTimeout(r, 0));\r\n      });\r\n\r\n      expect(result.current.isLoading).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('logout', () => {\r\n    it('calls logout endpoint', async () => {\r\n      // checkAuth returns authenticated user, then CSRF + logout\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: true, json: () => Promise.resolve({ authenticated: true, id: 'user-1', email: 'test@example.com' }) }, // checkAuth\r\n        { ok: true }, // logout\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isAuthenticated).toBe(true));\r\n\r\n      await act(async () => {\r\n        await result.current.logout();\r\n      });\r\n\r\n      // apiRequest adds CSRF token header\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/auth/logout',\r\n        expect.objectContaining({\r\n          method: 'POST',\r\n          credentials: 'include',\r\n        }),\r\n      );\r\n    });\r\n\r\n    it('clears user on logout', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: true, json: () => Promise.resolve({ authenticated: true, id: 'user-1', email: 'test@example.com' }) }, // checkAuth\r\n        { ok: true }, // logout\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isAuthenticated).toBe(true));\r\n\r\n      await act(async () => {\r\n        await result.current.logout();\r\n      });\r\n\r\n      expect(result.current.user).toBeNull();\r\n      expect(result.current.isAuthenticated).toBe(false);\r\n    });\r\n\r\n    it('clears user even if logout request fails', async () => {\r\n      // checkAuth succeeds with authenticated user\r\n      const mockFetch = vi.fn().mockImplementation((url: string) => {\r\n        if (url === '/api/csrf-token') {\r\n          return Promise.resolve({\r\n            ok: true,\r\n            json: () => Promise.resolve({ csrfToken: 'test-csrf-token' }),\r\n          });\r\n        }\r\n        if (url === '/api/auth/me') {\r\n          return Promise.resolve({\r\n            ok: true,\r\n            json: () => Promise.resolve({ authenticated: true, id: 'user-1', email: 'test@example.com' }),\r\n          });\r\n        }\r\n        // logout call fails\r\n        return Promise.reject(new Error('Network error'));\r\n      });\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isAuthenticated).toBe(true));\r\n\r\n      // logout() uses try/finally (no catch), so the error propagates\r\n      // We catch it here to verify user is still cleared via the finally block\r\n      await act(async () => {\r\n        try {\r\n          await result.current.logout();\r\n        } catch {\r\n          // Expected - logout re-throws the error after clearing user\r\n        }\r\n      });\r\n\r\n      expect(result.current.user).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('clearError', () => {\r\n    it('clears error state', async () => {\r\n      const mockFetch = createSmartMockFetch([\r\n        { ok: false }, // checkAuth\r\n        { ok: false, status: 401, text: () => Promise.resolve('Test error') }, // login fails\r\n      ]);\r\n      global.fetch = mockFetch;\r\n\r\n      const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n      await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n      await act(async () => {\r\n        try {\r\n          await result.current.login('test@example.com', 'wrong');\r\n        } catch {\r\n          // Expected\r\n        }\r\n      });\r\n\r\n      expect(result.current.error).toBeTruthy();\r\n\r\n      act(() => {\r\n        result.current.clearError();\r\n      });\r\n\r\n      expect(result.current.error).toBeNull();\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('useAuth', () => {\r\n  it('throws when used outside provider', () => {\r\n    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n\r\n    expect(() => {\r\n      renderHook(() => useAuth());\r\n    }).toThrow('useAuth must be used within an AuthProvider');\r\n\r\n    consoleSpy.mockRestore();\r\n  });\r\n\r\n  it('provides all expected methods', async () => {\r\n    global.fetch = vi.fn().mockResolvedValue({ ok: false });\r\n\r\n    const { result } = renderHook(() => useAuth(), { wrapper: createWrapper() });\r\n\r\n    await waitFor(() => expect(result.current.isLoading).toBe(false));\r\n\r\n    expect(typeof result.current.login).toBe('function');\r\n    expect(typeof result.current.logout).toBe('function');\r\n    expect(typeof result.current.clearError).toBe('function');\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\__tests__\\fixtures.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'verifiedProducts' is defined but never used. Allowed unused vars must match /^_/u.","line":27,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"verifiedProducts"},"fix":{"range":[669,690],"text":""},"desc":"Remove unused variable \"verifiedProducts\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userTemplates' is defined but never used. Allowed unused vars must match /^_/u.","line":37,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"userTemplates"},"fix":{"range":[900,918],"text":""},"desc":"Remove unused variable \"userTemplates\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editGenerations' is defined but never used. Allowed unused vars must match /^_/u.","line":47,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"editGenerations"},"fix":{"range":[1138,1158],"text":""},"desc":"Remove unused variable \"editGenerations\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rootGenerations' is defined but never used. Allowed unused vars must match /^_/u.","line":48,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"rootGenerations"},"fix":{"range":[1158,1178],"text":""},"desc":"Remove unused variable \"rootGenerations\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'singleCompletedGeneration' is defined but never used. Allowed unused vars must match /^_/u.","line":57,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"singleCompletedGeneration"},"fix":{"range":[1348,1378],"text":""},"desc":"Remove unused variable \"singleCompletedGeneration\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'standardUser' is defined but never used. Allowed unused vars must match /^_/u.","line":73,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":73,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"standardUser"},"fix":{"range":[1650,1667],"text":""},"desc":"Remove unused variable \"standardUser\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'copywritingFrameworks' is defined but never used. Allowed unused vars must match /^_/u.","line":76,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":76,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"copywritingFrameworks"},"fix":{"range":[1704,1730],"text":""},"desc":"Remove unused variable \"copywritingFrameworks\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'campaignObjectives' is defined but never used. Allowed unused vars must match /^_/u.","line":77,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":77,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"campaignObjectives"},"fix":{"range":[1730,1753],"text":""},"desc":"Remove unused variable \"campaignObjectives\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockProductAnalyses' is defined but never used. Allowed unused vars must match /^_/u.","line":94,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"mockProductAnalyses"},"fix":{"range":[2059,2083],"text":""},"desc":"Remove unused variable \"mockProductAnalyses\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'singleHighConfidenceSuggestion' is defined but never used. Allowed unused vars must match /^_/u.","line":102,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":102,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"singleHighConfidenceSuggestion"},"fix":{"range":[2244,2279],"text":""},"desc":"Remove unused variable \"singleHighConfidenceSuggestion\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * @vitest-environment node\r\n *\r\n * Test Fixtures Validation Tests\r\n *\r\n * Ensures all fixture data is valid and properly typed.\r\n * Tests factory functions and filtered subsets.\r\n *\r\n * @file client/src/fixtures/__tests__/fixtures.test.ts\r\n */\r\n\r\nimport { describe, it, expect } from 'vitest';\r\n\r\n// Import all fixtures to validate they compile and export correctly\r\nimport {\r\n  // Products\r\n  mockProducts,\r\n  drainageProducts,\r\n  waterproofingProducts,\r\n  flooringProducts,\r\n  concreteProducts,\r\n  toolProducts,\r\n  pendingProducts,\r\n  draftProducts,\r\n  completeProducts,\r\n  verifiedProducts,\r\n  createMockProduct,\r\n  createMockProducts,\r\n  singleDrainageProduct,\r\n  // Templates\r\n  mockPromptTemplates,\r\n  mockAdSceneTemplates,\r\n  productShowcaseTemplates,\r\n  educationalTemplates,\r\n  globalTemplates,\r\n  userTemplates,\r\n  createMockPromptTemplate,\r\n  createMockAdSceneTemplate,\r\n  singleShowcaseTemplate,\r\n  // Generations\r\n  mockGenerations,\r\n  completedGenerations,\r\n  pendingGenerations,\r\n  processingGenerations,\r\n  failedGenerations,\r\n  editGenerations,\r\n  rootGenerations,\r\n  editChain,\r\n  getEditHistory,\r\n  getChildren,\r\n  getAllDescendants,\r\n  createMockGeneration,\r\n  createMockEdit,\r\n  createPendingGeneration,\r\n  createFailedGeneration,\r\n  singleCompletedGeneration,\r\n  // Users\r\n  mockUsers,\r\n  mockSessions,\r\n  mockBrandProfiles,\r\n  activeUsers,\r\n  lockedUsers,\r\n  activeSessions,\r\n  expiredSessions,\r\n  createMockUser,\r\n  createLockedUser,\r\n  createMockSession,\r\n  createExpiredSession,\r\n  testCredentials,\r\n  testTokens,\r\n  adminUser,\r\n  standardUser,\r\n  // Ad Copy\r\n  platformCharLimits,\r\n  copywritingFrameworks,\r\n  campaignObjectives,\r\n  mockAdCopy,\r\n  instagramCopy,\r\n  linkedinCopy,\r\n  facebookCopy,\r\n  twitterCopy,\r\n  tiktokCopy,\r\n  aidaCopy,\r\n  highQualityCopy,\r\n  createMockAdCopy,\r\n  createPlatformCopy,\r\n  singleInstagramCopy,\r\n  // Idea Bank\r\n  fullAnalysisStatus,\r\n  visionOnlyAnalysisStatus,\r\n  allSourcesUsed,\r\n  mockSuggestions,\r\n  mockProductAnalyses,\r\n  simpleRecipe,\r\n  complexRecipe,\r\n  highConfidenceSuggestions,\r\n  exactInsertSuggestions,\r\n  createMockSuggestion,\r\n  createMockAnalysis,\r\n  createMockRecipe,\r\n  singleHighConfidenceSuggestion,\r\n  // Social Connections\r\n  mockSocialConnections,\r\n  mockScheduledPosts,\r\n  mockPostAnalytics,\r\n  activeConnections,\r\n  inactiveConnections,\r\n  scheduledPosts,\r\n  publishedPosts,\r\n  failedPosts,\r\n  createMockConnection,\r\n  createMockScheduledPost,\r\n  createMockAnalytics,\r\n  activeLinkedinConnection,\r\n} from '../index';\r\n\r\ndescribe('Product Fixtures', () => {\r\n  it('has 12 products in the main array', () => {\r\n    expect(mockProducts).toHaveLength(12);\r\n  });\r\n\r\n  it('has products in all categories', () => {\r\n    expect(drainageProducts.length).toBeGreaterThan(0);\r\n    expect(waterproofingProducts.length).toBeGreaterThan(0);\r\n    expect(flooringProducts.length).toBeGreaterThan(0);\r\n    expect(concreteProducts.length).toBeGreaterThan(0);\r\n    expect(toolProducts.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has products in all enrichment statuses', () => {\r\n    expect(pendingProducts.length).toBeGreaterThan(0);\r\n    expect(draftProducts.length).toBeGreaterThan(0);\r\n    expect(completeProducts.length).toBeGreaterThan(0);\r\n    // Note: verifiedProducts may be empty if no products have this status\r\n  });\r\n\r\n  it('creates valid products with factory function', () => {\r\n    const product = createMockProduct({ name: 'Test' });\r\n    expect(product.id).toBeTruthy();\r\n    expect(product.name).toBe('Test');\r\n    expect(product.cloudinaryUrl).toBeTruthy();\r\n  });\r\n\r\n  it('creates bulk products', () => {\r\n    const products = createMockProducts(5);\r\n    expect(products).toHaveLength(5);\r\n    expect(products[0].id).toBe('prod-bulk-1');\r\n    expect(products[4].id).toBe('prod-bulk-5');\r\n  });\r\n\r\n  it('singleDrainageProduct has all required fields', () => {\r\n    expect(singleDrainageProduct.id).toBeTruthy();\r\n    expect(singleDrainageProduct.name).toBeTruthy();\r\n    expect(singleDrainageProduct.cloudinaryUrl).toBeTruthy();\r\n    expect(singleDrainageProduct.category).toBe('drainage');\r\n  });\r\n});\r\n\r\ndescribe('Template Fixtures', () => {\r\n  it('has prompt templates', () => {\r\n    expect(mockPromptTemplates.length).toBeGreaterThan(5);\r\n  });\r\n\r\n  it('has ad scene templates', () => {\r\n    expect(mockAdSceneTemplates.length).toBeGreaterThan(5);\r\n  });\r\n\r\n  it('has filtered template subsets', () => {\r\n    expect(productShowcaseTemplates.length).toBeGreaterThan(0);\r\n    expect(educationalTemplates.length).toBeGreaterThan(0);\r\n    expect(globalTemplates.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('creates valid templates with factory functions', () => {\r\n    const promptTemplate = createMockPromptTemplate({ title: 'Test' });\r\n    expect(promptTemplate.id).toBeTruthy();\r\n    expect(promptTemplate.title).toBe('Test');\r\n\r\n    const adSceneTemplate = createMockAdSceneTemplate({ title: 'Ad Test' });\r\n    expect(adSceneTemplate.id).toBeTruthy();\r\n    expect(adSceneTemplate.title).toBe('Ad Test');\r\n    expect(adSceneTemplate.promptBlueprint).toBeTruthy();\r\n  });\r\n\r\n  it('singleShowcaseTemplate has all required fields', () => {\r\n    expect(singleShowcaseTemplate.id).toBeTruthy();\r\n    expect(singleShowcaseTemplate.title).toBeTruthy();\r\n    expect(singleShowcaseTemplate.category).toBe('product_showcase');\r\n    expect(singleShowcaseTemplate.promptBlueprint).toBeTruthy();\r\n  });\r\n});\r\n\r\ndescribe('Generation Fixtures', () => {\r\n  it('has 14 generations', () => {\r\n    expect(mockGenerations).toHaveLength(14);\r\n  });\r\n\r\n  it('has generations in all statuses', () => {\r\n    expect(completedGenerations.length).toBeGreaterThan(0);\r\n    expect(pendingGenerations.length).toBeGreaterThan(0);\r\n    expect(processingGenerations.length).toBeGreaterThan(0);\r\n    expect(failedGenerations.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has edit chain with parent-child relationships', () => {\r\n    expect(editChain.parent).toBeTruthy();\r\n    expect(editChain.child).toBeTruthy();\r\n    expect(editChain.grandchild).toBeTruthy();\r\n    expect(editChain.child.parentGenerationId).toBe(editChain.parent.id);\r\n    expect(editChain.grandchild.parentGenerationId).toBe(editChain.child.id);\r\n  });\r\n\r\n  it('getEditHistory returns correct chain', () => {\r\n    const history = getEditHistory('gen-edit-grandchild');\r\n    expect(history).toHaveLength(3);\r\n    expect(history[0].id).toBe('gen-edit-parent');\r\n    expect(history[2].id).toBe('gen-edit-grandchild');\r\n  });\r\n\r\n  it('getChildren returns direct children', () => {\r\n    const children = getChildren('gen-edit-parent');\r\n    expect(children).toHaveLength(1);\r\n    expect(children[0].id).toBe('gen-edit-child');\r\n  });\r\n\r\n  it('getAllDescendants returns all descendants', () => {\r\n    const descendants = getAllDescendants('gen-edit-parent');\r\n    expect(descendants).toHaveLength(2);\r\n  });\r\n\r\n  it('creates valid generations with factory functions', () => {\r\n    const gen = createMockGeneration({ prompt: 'Test prompt' });\r\n    expect(gen.id).toBeTruthy();\r\n    expect(gen.prompt).toBe('Test prompt');\r\n    expect(gen.status).toBe('completed');\r\n\r\n    const pendingGen = createPendingGeneration();\r\n    expect(pendingGen.status).toBe('pending');\r\n    expect(pendingGen.imagePath).toBeNull();\r\n\r\n    const failedGen = createFailedGeneration('Test error');\r\n    expect(failedGen.status).toBe('failed');\r\n    expect(failedGen.conversationHistory).toBeTruthy();\r\n  });\r\n\r\n  it('creates edit generation linked to parent', () => {\r\n    const edit = createMockEdit('gen-001', 'Make it brighter');\r\n    expect(edit.parentGenerationId).toBe('gen-001');\r\n    expect(edit.editPrompt).toBe('Make it brighter');\r\n    expect(edit.editCount).toBe(1);\r\n  });\r\n});\r\n\r\ndescribe('User Fixtures', () => {\r\n  it('has multiple users', () => {\r\n    expect(mockUsers.length).toBeGreaterThan(5);\r\n  });\r\n\r\n  it('has active and locked users', () => {\r\n    expect(activeUsers.length).toBeGreaterThan(0);\r\n    expect(lockedUsers.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has sessions', () => {\r\n    expect(mockSessions.length).toBeGreaterThan(0);\r\n    expect(activeSessions.length).toBeGreaterThan(0);\r\n    expect(expiredSessions.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has brand profiles', () => {\r\n    expect(mockBrandProfiles.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('creates valid users with factory functions', () => {\r\n    const user = createMockUser({ email: 'test@test.com' });\r\n    expect(user.id).toBeTruthy();\r\n    expect(user.email).toBe('test@test.com');\r\n    expect(user.failedAttempts).toBe(0);\r\n\r\n    const locked = createLockedUser(2);\r\n    expect(locked.failedAttempts).toBe(5);\r\n    expect(locked.lockedUntil).toBeTruthy();\r\n  });\r\n\r\n  it('creates valid sessions', () => {\r\n    const session = createMockSession('user-123');\r\n    expect(session.id).toBeTruthy();\r\n    expect(session.userId).toBe('user-123');\r\n    expect(session.expiresAt).toBeTruthy();\r\n\r\n    const expired = createExpiredSession('user-123', 5);\r\n    expect(expired.expiresAt.getTime()).toBeLessThan(Date.now());\r\n  });\r\n\r\n  it('has test credentials', () => {\r\n    expect(testCredentials.valid.email).toBeTruthy();\r\n    expect(testCredentials.invalid.email).toBeTruthy();\r\n    expect(testCredentials.locked.email).toBeTruthy();\r\n  });\r\n\r\n  it('has test tokens', () => {\r\n    expect(testTokens.valid).toBeTruthy();\r\n    expect(testTokens.expired).toBeTruthy();\r\n    expect(testTokens.malformed).toBeTruthy();\r\n  });\r\n\r\n  it('adminUser has brand voice', () => {\r\n    expect(adminUser.brandVoice).toBeTruthy();\r\n  });\r\n});\r\n\r\ndescribe('Ad Copy Fixtures', () => {\r\n  it('has platform character limits', () => {\r\n    expect(platformCharLimits.instagram.headline).toBe(40);\r\n    expect(platformCharLimits.linkedin.headline).toBe(150);\r\n    expect(platformCharLimits.twitter.body).toBe(280);\r\n  });\r\n\r\n  it('has copy for all platforms', () => {\r\n    expect(instagramCopy.length).toBeGreaterThan(0);\r\n    expect(linkedinCopy.length).toBeGreaterThan(0);\r\n    expect(facebookCopy.length).toBeGreaterThan(0);\r\n    expect(twitterCopy.length).toBeGreaterThan(0);\r\n    expect(tiktokCopy.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has copy with different frameworks', () => {\r\n    expect(aidaCopy.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has high quality copy', () => {\r\n    expect(highQualityCopy.length).toBeGreaterThan(0);\r\n    highQualityCopy.forEach((copy) => {\r\n      expect(copy.qualityScore!.overallScore).toBeGreaterThanOrEqual(8);\r\n    });\r\n  });\r\n\r\n  it('creates valid ad copy with factory functions', () => {\r\n    const copy = createMockAdCopy({ headline: 'Test Headline' });\r\n    expect(copy.id).toBeTruthy();\r\n    expect(copy.headline).toBe('Test Headline');\r\n    expect(copy.platform).toBe('instagram');\r\n\r\n    const platformCopy = createPlatformCopy('linkedin');\r\n    expect(platformCopy.platform).toBe('linkedin');\r\n    expect(platformCopy.tone).toBe('professional');\r\n  });\r\n\r\n  it('singleInstagramCopy has all required fields', () => {\r\n    expect(singleInstagramCopy.id).toBeTruthy();\r\n    expect(singleInstagramCopy.headline).toBeTruthy();\r\n    expect(singleInstagramCopy.hook).toBeTruthy();\r\n    expect(singleInstagramCopy.bodyText).toBeTruthy();\r\n    expect(singleInstagramCopy.cta).toBeTruthy();\r\n    expect(singleInstagramCopy.platform).toBe('instagram');\r\n  });\r\n});\r\n\r\ndescribe('Idea Bank Fixtures', () => {\r\n  it('has analysis status presets', () => {\r\n    expect(fullAnalysisStatus.visionComplete).toBe(true);\r\n    expect(fullAnalysisStatus.kbQueried).toBe(true);\r\n    expect(visionOnlyAnalysisStatus.kbQueried).toBe(false);\r\n  });\r\n\r\n  it('has sources used presets', () => {\r\n    expect(allSourcesUsed.visionAnalysis).toBe(true);\r\n    expect(allSourcesUsed.webSearch).toBe(true);\r\n  });\r\n\r\n  it('has mock suggestions', () => {\r\n    expect(mockSuggestions.length).toBeGreaterThan(5);\r\n  });\r\n\r\n  it('has filtered suggestion subsets', () => {\r\n    expect(highConfidenceSuggestions.length).toBeGreaterThan(0);\r\n    expect(exactInsertSuggestions.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has recipes', () => {\r\n    expect(simpleRecipe.version).toBe('1.0');\r\n    expect(simpleRecipe.products.length).toBeGreaterThan(0);\r\n    expect(complexRecipe.relationships.length).toBeGreaterThan(0);\r\n    expect(complexRecipe.scenarios.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('creates valid suggestions', () => {\r\n    const suggestion = createMockSuggestion({ confidence: 90 });\r\n    expect(suggestion.id).toBeTruthy();\r\n    expect(suggestion.confidence).toBe(90);\r\n  });\r\n\r\n  it('creates valid analyses', () => {\r\n    const analysis = createMockAnalysis('prod-123');\r\n    expect(analysis.productId).toBe('prod-123');\r\n    expect(analysis.confidence).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('creates valid recipes', () => {\r\n    const recipe = createMockRecipe([{ id: 'p1', name: 'Test', imageUrls: [] }]);\r\n    expect(recipe.products).toHaveLength(1);\r\n    expect(recipe.version).toBe('1.0');\r\n  });\r\n});\r\n\r\ndescribe('Social Connection Fixtures', () => {\r\n  it('has social connections', () => {\r\n    expect(mockSocialConnections.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has active and inactive connections', () => {\r\n    expect(activeConnections.length).toBeGreaterThan(0);\r\n    expect(inactiveConnections.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has scheduled posts in various statuses', () => {\r\n    expect(mockScheduledPosts.length).toBeGreaterThan(0);\r\n    expect(scheduledPosts.length).toBeGreaterThan(0);\r\n    expect(publishedPosts.length).toBeGreaterThan(0);\r\n    expect(failedPosts.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('has post analytics', () => {\r\n    expect(mockPostAnalytics.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('creates valid connections', () => {\r\n    const conn = createMockConnection({ platform: 'instagram' });\r\n    expect(conn.id).toBeTruthy();\r\n    expect(conn.platform).toBe('instagram');\r\n    expect(conn.isActive).toBe(true);\r\n  });\r\n\r\n  it('creates valid scheduled posts', () => {\r\n    const post = createMockScheduledPost({ caption: 'Test post' });\r\n    expect(post.id).toBeTruthy();\r\n    expect(post.caption).toBe('Test post');\r\n    expect(post.status).toBe('draft');\r\n  });\r\n\r\n  it('creates valid analytics', () => {\r\n    const analytics = createMockAnalytics('post-123');\r\n    expect(analytics.scheduledPostId).toBe('post-123');\r\n    expect(analytics.impressions).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('activeLinkedinConnection has all required fields', () => {\r\n    expect(activeLinkedinConnection.id).toBeTruthy();\r\n    expect(activeLinkedinConnection.platform).toBe('linkedin');\r\n    expect(activeLinkedinConnection.isActive).toBe(true);\r\n    expect(activeLinkedinConnection.accessToken).toBeTruthy();\r\n  });\r\n});\r\n\r\ndescribe('Fixture Integrity', () => {\r\n  it('all products have unique IDs', () => {\r\n    const ids = mockProducts.map((p) => p.id);\r\n    const uniqueIds = new Set(ids);\r\n    expect(uniqueIds.size).toBe(ids.length);\r\n  });\r\n\r\n  it('all generations have unique IDs', () => {\r\n    const ids = mockGenerations.map((g) => g.id);\r\n    const uniqueIds = new Set(ids);\r\n    expect(uniqueIds.size).toBe(ids.length);\r\n  });\r\n\r\n  it('all users have unique IDs and emails', () => {\r\n    const ids = mockUsers.map((u) => u.id);\r\n    const emails = mockUsers.map((u) => u.email);\r\n    expect(new Set(ids).size).toBe(ids.length);\r\n    expect(new Set(emails).size).toBe(emails.length);\r\n  });\r\n\r\n  it('all ad copy has unique IDs', () => {\r\n    const ids = mockAdCopy.map((c) => c.id);\r\n    const uniqueIds = new Set(ids);\r\n    expect(uniqueIds.size).toBe(ids.length);\r\n  });\r\n\r\n  it('all suggestions have unique IDs', () => {\r\n    const ids = mockSuggestions.map((s) => s.id);\r\n    const uniqueIds = new Set(ids);\r\n    expect(uniqueIds.size).toBe(ids.length);\r\n  });\r\n\r\n  it('all social connections have unique IDs', () => {\r\n    const ids = mockSocialConnections.map((c) => c.id);\r\n    const uniqueIds = new Set(ids);\r\n    expect(uniqueIds.size).toBe(ids.length);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\adCopy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\generations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\ideaBank.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\products.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\socialConnections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\fixtures\\users.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TargetAudience' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":41,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TargetAudience"},"fix":{"range":[331,347],"text":""},"desc":"Remove unused variable \"TargetAudience\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * User Test Fixtures\r\n *\r\n * Mock user data for testing authentication, authorization, and user-specific features.\r\n * Covers various roles, permissions, and account states.\r\n *\r\n * @file client/src/fixtures/users.ts\r\n */\r\n\r\nimport type { User, Session, BrandProfile } from '../../../shared/schema';\r\nimport type { BrandVoice, TargetAudience } from '../../../shared/types/ideaBank';\r\n\r\n// Base date for consistent timestamps in tests\r\nconst BASE_DATE = new Date('2026-01-15T12:00:00Z');\r\n\r\nfunction daysAgo(days: number): Date {\r\n  return new Date(BASE_DATE.getTime() - days * 24 * 60 * 60 * 1000);\r\n}\r\n\r\nfunction hoursFromNow(hours: number): Date {\r\n  return new Date(BASE_DATE.getTime() + hours * 60 * 60 * 1000);\r\n}\r\n\r\n// === MOCK USERS ===\r\n\r\n/**\r\n * Full mock users array with various account states\r\n */\r\nexport const mockUsers: User[] = [\r\n  // === ACTIVE USERS ===\r\n  {\r\n    id: 'user-admin-001',\r\n    email: 'admin@company.com',\r\n    password: 'hashed_admin_password_123',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedadminpassword123',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: {\r\n      principles: ['Professional', 'Authoritative', 'Helpful'],\r\n      wordsToAvoid: ['cheap', 'basic'],\r\n      wordsToUse: ['premium', 'quality', 'professional'],\r\n    },\r\n    createdAt: daysAgo(365),\r\n  },\r\n  {\r\n    id: 'user-test-1',\r\n    email: 'user1@example.com',\r\n    password: 'hashed_password_123',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedpassword123',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: {\r\n      principles: ['Friendly', 'Technical', 'Trustworthy'],\r\n      wordsToAvoid: ['expensive', 'complicated'],\r\n      wordsToUse: ['reliable', 'durable', 'easy'],\r\n    },\r\n    createdAt: daysAgo(90),\r\n  },\r\n  {\r\n    id: 'user-test-2',\r\n    email: 'user2@example.com',\r\n    password: 'hashed_password_456',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedpassword456',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: null,\r\n    createdAt: daysAgo(60),\r\n  },\r\n  {\r\n    id: 'user-test-3',\r\n    email: 'newuser@example.com',\r\n    password: 'hashed_password_789',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedpassword789',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: null,\r\n    createdAt: daysAgo(1),\r\n  },\r\n\r\n  // === LOCKED USERS ===\r\n  {\r\n    id: 'user-locked-001',\r\n    email: 'locked@example.com',\r\n    password: 'hashed_password_locked',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedlockedpw',\r\n    failedAttempts: 5,\r\n    lockedUntil: hoursFromNow(1), // Locked for 1 more hour\r\n    brandVoice: null,\r\n    createdAt: daysAgo(30),\r\n  },\r\n  {\r\n    id: 'user-locked-002',\r\n    email: 'temporarily-locked@example.com',\r\n    password: 'hashed_password_temp',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedtemppw',\r\n    failedAttempts: 3,\r\n    lockedUntil: new Date(BASE_DATE.getTime() - 60 * 60 * 1000), // Lock expired 1 hour ago\r\n    brandVoice: null,\r\n    createdAt: daysAgo(45),\r\n  },\r\n\r\n  // === EDGE CASES ===\r\n  {\r\n    id: 'user-edge-001',\r\n    email: 'edge+special@example.com', // Email with special characters\r\n    password: 'hashed_edge_pw',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashededgepw',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: {\r\n      principles: [],\r\n      wordsToAvoid: [],\r\n      wordsToUse: [],\r\n    },\r\n    createdAt: daysAgo(15),\r\n  },\r\n  {\r\n    id: 'user-edge-002',\r\n    email: 'unicode.user@example.com',\r\n    password: 'hashed_unicode_pw',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedunicodepw',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: {\r\n      principles: ['Quality'],\r\n      wordsToAvoid: null as unknown as string[], // Testing null handling\r\n      wordsToUse: null as unknown as string[],\r\n    },\r\n    createdAt: daysAgo(10),\r\n  },\r\n];\r\n\r\n// === MOCK SESSIONS ===\r\n\r\n/**\r\n * Mock sessions for authentication testing\r\n */\r\nexport const mockSessions: Session[] = [\r\n  // Active sessions\r\n  {\r\n    id: 'session-active-001',\r\n    userId: 'user-test-1',\r\n    expiresAt: hoursFromNow(24),\r\n    createdAt: daysAgo(0),\r\n  },\r\n  {\r\n    id: 'session-active-002',\r\n    userId: 'user-admin-001',\r\n    expiresAt: hoursFromNow(48),\r\n    createdAt: daysAgo(1),\r\n  },\r\n  {\r\n    id: 'session-active-003',\r\n    userId: 'user-test-2',\r\n    expiresAt: hoursFromNow(12),\r\n    createdAt: new Date(BASE_DATE.getTime() - 12 * 60 * 60 * 1000),\r\n  },\r\n\r\n  // Expired sessions\r\n  {\r\n    id: 'session-expired-001',\r\n    userId: 'user-test-1',\r\n    expiresAt: new Date(BASE_DATE.getTime() - 60 * 60 * 1000), // Expired 1 hour ago\r\n    createdAt: daysAgo(2),\r\n  },\r\n  {\r\n    id: 'session-expired-002',\r\n    userId: 'user-test-3',\r\n    expiresAt: daysAgo(7),\r\n    createdAt: daysAgo(8),\r\n  },\r\n\r\n  // Session about to expire\r\n  {\r\n    id: 'session-expiring-001',\r\n    userId: 'user-test-2',\r\n    expiresAt: new Date(BASE_DATE.getTime() + 5 * 60 * 1000), // Expires in 5 minutes\r\n    createdAt: daysAgo(0),\r\n  },\r\n];\r\n\r\n// === MOCK BRAND PROFILES ===\r\n\r\n/**\r\n * Mock brand profiles for enhanced user context\r\n */\r\nexport const mockBrandProfiles: BrandProfile[] = [\r\n  {\r\n    id: 'bp-001',\r\n    userId: 'user-admin-001',\r\n    brandName: 'Pro Building Supplies',\r\n    industry: 'Construction Materials',\r\n    brandValues: ['Quality', 'Reliability', 'Professional Service', 'Fast Shipping'],\r\n    targetAudience: {\r\n      demographics: 'Professional contractors, 30-55, Male-dominated',\r\n      psychographics: 'Value-driven, time-conscious, quality-focused',\r\n      painPoints: ['Long delivery times', 'Inconsistent quality', 'Poor technical support'],\r\n    },\r\n    preferredStyles: ['industrial', 'professional', 'bold'],\r\n    colorPreferences: ['blue', 'orange', 'gray'],\r\n    voice: {\r\n      principles: ['Professional', 'Authoritative', 'Helpful'],\r\n      wordsToUse: ['premium', 'professional-grade', 'trusted'],\r\n      wordsToAvoid: ['cheap', 'basic', 'amateur'],\r\n    },\r\n    kbTags: ['construction', 'drainage', 'waterproofing'],\r\n    createdAt: daysAgo(300),\r\n    updatedAt: daysAgo(30),\r\n  },\r\n  {\r\n    id: 'bp-002',\r\n    userId: 'user-test-1',\r\n    brandName: 'HomeStyle Flooring',\r\n    industry: 'Flooring & Tile',\r\n    brandValues: ['Beautiful Spaces', 'Easy Installation', 'Affordable Luxury'],\r\n    targetAudience: {\r\n      demographics: 'Homeowners, 25-50, DIY enthusiasts',\r\n      psychographics: 'Design-conscious, budget-aware, project-oriented',\r\n      painPoints: ['Complex installation', 'Limited selection', 'High prices'],\r\n    },\r\n    preferredStyles: ['modern', 'minimal', 'warm'],\r\n    colorPreferences: ['neutral', 'earth-tones', 'white'],\r\n    voice: {\r\n      principles: ['Friendly', 'Inspiring', 'Helpful'],\r\n      wordsToUse: ['beautiful', 'easy', 'transform'],\r\n      wordsToAvoid: ['complicated', 'expensive'],\r\n    },\r\n    kbTags: ['flooring', 'tile', 'residential'],\r\n    createdAt: daysAgo(90),\r\n    updatedAt: daysAgo(7),\r\n  },\r\n  {\r\n    id: 'bp-003',\r\n    userId: 'user-test-2',\r\n    brandName: null, // Incomplete profile\r\n    industry: 'General Construction',\r\n    brandValues: null,\r\n    targetAudience: null,\r\n    preferredStyles: null,\r\n    colorPreferences: null,\r\n    voice: null,\r\n    kbTags: null,\r\n    createdAt: daysAgo(60),\r\n    updatedAt: daysAgo(60),\r\n  },\r\n];\r\n\r\n// === FILTERED SUBSETS ===\r\n\r\n/** Active (unlocked) users */\r\nexport const activeUsers = mockUsers.filter(\r\n  (u) => u.lockedUntil === null || u.lockedUntil < BASE_DATE\r\n);\r\n\r\n/** Currently locked users */\r\nexport const lockedUsers = mockUsers.filter(\r\n  (u) => u.lockedUntil !== null && u.lockedUntil > BASE_DATE\r\n);\r\n\r\n/** Users with brand voice configured */\r\nexport const usersWithBrandVoice = mockUsers.filter(\r\n  (u) => u.brandVoice !== null\r\n);\r\n\r\n/** Users without brand voice */\r\nexport const usersWithoutBrandVoice = mockUsers.filter(\r\n  (u) => u.brandVoice === null\r\n);\r\n\r\n/** Recently created users (last 7 days) */\r\nexport const recentUsers = mockUsers.filter(\r\n  (u) => u.createdAt >= daysAgo(7)\r\n);\r\n\r\n/** Active sessions (not expired) */\r\nexport const activeSessions = mockSessions.filter(\r\n  (s) => s.expiresAt > BASE_DATE\r\n);\r\n\r\n/** Expired sessions */\r\nexport const expiredSessions = mockSessions.filter(\r\n  (s) => s.expiresAt <= BASE_DATE\r\n);\r\n\r\n/** Sessions expiring within 1 hour */\r\nexport const expiringSessions = mockSessions.filter((s) => {\r\n  const oneHourFromNow = new Date(BASE_DATE.getTime() + 60 * 60 * 1000);\r\n  return s.expiresAt > BASE_DATE && s.expiresAt <= oneHourFromNow;\r\n});\r\n\r\n/** Complete brand profiles */\r\nexport const completeBrandProfiles = mockBrandProfiles.filter(\r\n  (bp) => bp.brandName !== null && bp.voice !== null\r\n);\r\n\r\n/** Incomplete brand profiles */\r\nexport const incompleteBrandProfiles = mockBrandProfiles.filter(\r\n  (bp) => bp.brandName === null || bp.voice === null\r\n);\r\n\r\n// === FACTORY FUNCTIONS ===\r\n\r\n/**\r\n * Creates a new mock user with custom overrides\r\n */\r\nexport function createMockUser(overrides: Partial<User> = {}): User {\r\n  const id = overrides.id || `user-test-${Date.now()}`;\r\n  return {\r\n    id,\r\n    email: `${id}@example.com`,\r\n    password: 'hashed_test_password',\r\n    passwordHash: '$2b$10$abcdefghijklmnopqrstuv.hashedtestpw',\r\n    failedAttempts: 0,\r\n    lockedUntil: null,\r\n    brandVoice: null,\r\n    createdAt: new Date(),\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n/**\r\n * Creates a locked user\r\n */\r\nexport function createLockedUser(\r\n  lockDurationHours: number = 1,\r\n  overrides: Partial<User> = {}\r\n): User {\r\n  return createMockUser({\r\n    failedAttempts: 5,\r\n    lockedUntil: hoursFromNow(lockDurationHours),\r\n    ...overrides,\r\n  });\r\n}\r\n\r\n/**\r\n * Creates a user with brand voice configured\r\n */\r\nexport function createUserWithBrandVoice(\r\n  brandVoice: BrandVoice,\r\n  overrides: Partial<User> = {}\r\n): User {\r\n  return createMockUser({\r\n    brandVoice: brandVoice as unknown as typeof overrides.brandVoice,\r\n    ...overrides,\r\n  });\r\n}\r\n\r\n/**\r\n * Creates a new mock session\r\n */\r\nexport function createMockSession(\r\n  userId: string,\r\n  overrides: Partial<Session> = {}\r\n): Session {\r\n  const id = overrides.id || `session-test-${Date.now()}`;\r\n  return {\r\n    id,\r\n    userId,\r\n    expiresAt: hoursFromNow(24),\r\n    createdAt: new Date(),\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n/**\r\n * Creates an expired session\r\n */\r\nexport function createExpiredSession(\r\n  userId: string,\r\n  hoursExpiredAgo: number = 1,\r\n  overrides: Partial<Session> = {}\r\n): Session {\r\n  return createMockSession(userId, {\r\n    expiresAt: new Date(BASE_DATE.getTime() - hoursExpiredAgo * 60 * 60 * 1000),\r\n    ...overrides,\r\n  });\r\n}\r\n\r\n/**\r\n * Creates a new mock brand profile\r\n */\r\nexport function createMockBrandProfile(\r\n  userId: string,\r\n  overrides: Partial<BrandProfile> = {}\r\n): BrandProfile {\r\n  const id = overrides.id || `bp-test-${Date.now()}`;\r\n  const now = new Date();\r\n  return {\r\n    id,\r\n    userId,\r\n    brandName: 'Test Brand',\r\n    industry: 'Test Industry',\r\n    brandValues: ['Quality', 'Service'],\r\n    targetAudience: {\r\n      demographics: 'Test demographics',\r\n      psychographics: 'Test psychographics',\r\n      painPoints: ['Pain point 1', 'Pain point 2'],\r\n    },\r\n    preferredStyles: ['professional'],\r\n    colorPreferences: ['blue'],\r\n    voice: {\r\n      principles: ['Professional'],\r\n      wordsToUse: ['quality'],\r\n      wordsToAvoid: ['cheap'],\r\n    },\r\n    kbTags: ['test'],\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    ...overrides,\r\n  };\r\n}\r\n\r\n// === SINGLE USER EXPORTS ===\r\n\r\n/** Admin user with full permissions */\r\nexport const adminUser = mockUsers[0];\r\n\r\n/** Standard active user */\r\nexport const standardUser = mockUsers[1];\r\n\r\n/** User without brand voice */\r\nexport const userWithoutBrandVoice = mockUsers[2];\r\n\r\n/** Newly created user */\r\nexport const newUser = mockUsers[3];\r\n\r\n/** Currently locked user */\r\nexport const lockedUser = mockUsers[4];\r\n\r\n/** User with expired lock */\r\nexport const expiredLockUser = mockUsers[5];\r\n\r\n// === SESSION EXPORTS ===\r\n\r\n/** An active valid session */\r\nexport const validSession = mockSessions[0];\r\n\r\n/** An expired session */\r\nexport const expiredSession = mockSessions[3];\r\n\r\n/** A session about to expire */\r\nexport const expiringSession = mockSessions[5];\r\n\r\n// === BRAND PROFILE EXPORTS ===\r\n\r\n/** A complete brand profile */\r\nexport const completeBrandProfile = mockBrandProfiles[0];\r\n\r\n/** An incomplete brand profile */\r\nexport const incompleteBrandProfile = mockBrandProfiles[2];\r\n\r\n// === AUTHENTICATION TEST HELPERS ===\r\n\r\n/**\r\n * Credentials for testing login\r\n */\r\nexport const testCredentials = {\r\n  valid: {\r\n    email: 'user1@example.com',\r\n    password: 'correct_password_123',\r\n  },\r\n  invalid: {\r\n    email: 'user1@example.com',\r\n    password: 'wrong_password',\r\n  },\r\n  nonexistent: {\r\n    email: 'nobody@example.com',\r\n    password: 'any_password',\r\n  },\r\n  locked: {\r\n    email: 'locked@example.com',\r\n    password: 'locked_password',\r\n  },\r\n};\r\n\r\n/**\r\n * JWT-like tokens for testing (not real JWTs)\r\n */\r\nexport const testTokens = {\r\n  valid: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ1c2VyLXRlc3QtMSIsImV4cCI6OTk5OTk5OTk5OX0.mock_valid_signature',\r\n  expired: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ1c2VyLXRlc3QtMSIsImV4cCI6MTAwMDAwMDAwMH0.mock_expired_signature',\r\n  malformed: 'not.a.valid.jwt',\r\n  missingUserId: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjk5OTk5OTk5OTl9.mock_no_user_signature',\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\__tests__\\hooks.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'JobStatus' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":33,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"JobStatus"},"fix":{"range":[314,325],"text":""},"desc":"Remove unused variable \"JobStatus\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5423,5426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5423,5426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5457,5460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5457,5460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5586,5589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5586,5589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5836,5839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5836,5839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5950,5953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5950,5953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rerender' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":425,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":425,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15398,15401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15398,15401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":487,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15434,15437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15434,15437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":491,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":491,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15569,15572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15569,15572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":499,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15807,15810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15807,15810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":504,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15929,15932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15929,15932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":641,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":641,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20209,20212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20209,20212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":642,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":642,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20245,20248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20245,20248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":646,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":646,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20380,20383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20380,20383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":655,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":655,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20648,20651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20648,20651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":660,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":660,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20770,20773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20770,20773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type. Allowed unused vars must match /^_/u.","line":19,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":19,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\nimport * as React from \"react\"\r\n\r\nimport type {\r\n  ToastActionElement,\r\n  ToastProps,\r\n} from \"@/components/ui/toast\"\r\n\r\nconst TOAST_LIMIT = 1\r\nconst TOAST_REMOVE_DELAY = 1000000\r\n\r\ntype ToasterToast = ToastProps & {\r\n  id: string\r\n  title?: React.ReactNode\r\n  description?: React.ReactNode\r\n  action?: ToastActionElement\r\n}\r\n\r\nconst actionTypes = {\r\n  ADD_TOAST: \"ADD_TOAST\",\r\n  UPDATE_TOAST: \"UPDATE_TOAST\",\r\n  DISMISS_TOAST: \"DISMISS_TOAST\",\r\n  REMOVE_TOAST: \"REMOVE_TOAST\",\r\n} as const\r\n\r\nlet count = 0\r\n\r\nfunction genId() {\r\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\r\n  return count.toString()\r\n}\r\n\r\ntype ActionType = typeof actionTypes\r\n\r\ntype Action =\r\n  | {\r\n      type: ActionType[\"ADD_TOAST\"]\r\n      toast: ToasterToast\r\n    }\r\n  | {\r\n      type: ActionType[\"UPDATE_TOAST\"]\r\n      toast: Partial<ToasterToast>\r\n    }\r\n  | {\r\n      type: ActionType[\"DISMISS_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n  | {\r\n      type: ActionType[\"REMOVE_TOAST\"]\r\n      toastId?: ToasterToast[\"id\"]\r\n    }\r\n\r\ninterface State {\r\n  toasts: ToasterToast[]\r\n}\r\n\r\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\r\n\r\nconst addToRemoveQueue = (toastId: string) => {\r\n  if (toastTimeouts.has(toastId)) {\r\n    return\r\n  }\r\n\r\n  const timeout = setTimeout(() => {\r\n    toastTimeouts.delete(toastId)\r\n    dispatch({\r\n      type: \"REMOVE_TOAST\",\r\n      toastId: toastId,\r\n    })\r\n  }, TOAST_REMOVE_DELAY)\r\n\r\n  toastTimeouts.set(toastId, timeout)\r\n}\r\n\r\nexport const reducer = (state: State, action: Action): State => {\r\n  switch (action.type) {\r\n    case \"ADD_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\r\n      }\r\n\r\n    case \"UPDATE_TOAST\":\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\r\n        ),\r\n      }\r\n\r\n    case \"DISMISS_TOAST\": {\r\n      const { toastId } = action\r\n\r\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\r\n      // but I'll keep it here for simplicity\r\n      if (toastId) {\r\n        addToRemoveQueue(toastId)\r\n      } else {\r\n        state.toasts.forEach((toast) => {\r\n          addToRemoveQueue(toast.id)\r\n        })\r\n      }\r\n\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.map((t) =>\r\n          t.id === toastId || toastId === undefined\r\n            ? {\r\n                ...t,\r\n                open: false,\r\n              }\r\n            : t\r\n        ),\r\n      }\r\n    }\r\n    case \"REMOVE_TOAST\":\r\n      if (action.toastId === undefined) {\r\n        return {\r\n          ...state,\r\n          toasts: [],\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\r\n      }\r\n  }\r\n}\r\n\r\nconst listeners: Array<(state: State) => void> = []\r\n\r\nlet memoryState: State = { toasts: [] }\r\n\r\nfunction dispatch(action: Action) {\r\n  memoryState = reducer(memoryState, action)\r\n  listeners.forEach((listener) => {\r\n    listener(memoryState)\r\n  })\r\n}\r\n\r\ntype Toast = Omit<ToasterToast, \"id\">\r\n\r\nfunction toast({ ...props }: Toast) {\r\n  const id = genId()\r\n\r\n  const update = (props: ToasterToast) =>\r\n    dispatch({\r\n      type: \"UPDATE_TOAST\",\r\n      toast: { ...props, id },\r\n    })\r\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\r\n\r\n  dispatch({\r\n    type: \"ADD_TOAST\",\r\n    toast: {\r\n      ...props,\r\n      id,\r\n      open: true,\r\n      onOpenChange: (open) => {\r\n        if (!open) dismiss()\r\n      },\r\n    },\r\n  })\r\n\r\n  return {\r\n    id: id,\r\n    dismiss,\r\n    update,\r\n  }\r\n}\r\n\r\nfunction useToast() {\r\n  const [state, setState] = React.useState<State>(memoryState)\r\n\r\n  React.useEffect(() => {\r\n    listeners.push(setState)\r\n    return () => {\r\n      const index = listeners.indexOf(setState)\r\n      if (index > -1) {\r\n        listeners.splice(index, 1)\r\n      }\r\n    }\r\n  }, [state])\r\n\r\n  return {\r\n    ...state,\r\n    toast,\r\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\r\n  }\r\n}\r\n\r\nexport { useToast, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useBusinessIntelligence.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useCollaboration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useHaptic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useJobStatus.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[849,852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[849,852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1021,1024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1021,1024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * useJobStatus - React hook for real-time job status updates via SSE\r\n *\r\n * Connects to the SSE endpoint and receives push updates for job progress,\r\n * completion, and failure events. Automatically cleans up on unmount or\r\n * when the job completes.\r\n *\r\n * Usage:\r\n *   const { status, isConnected } = useJobStatus(jobId);\r\n *\r\n *   if (status?.type === 'completed') {\r\n *     // Handle completion\r\n *   }\r\n */\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\n\r\nexport interface JobProgress {\r\n  stage?: 'queued' | 'starting' | 'processing' | 'uploading' | 'finalizing';\r\n  percentage?: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface JobStatus {\r\n  type: 'status' | 'progress' | 'completed' | 'failed' | 'error';\r\n  state?: 'waiting' | 'active' | 'completed' | 'failed' | 'delayed';\r\n  progress?: JobProgress;\r\n  result?: any;\r\n  error?: string;\r\n  message?: string;\r\n}\r\n\r\nexport interface UseJobStatusOptions {\r\n  /** Callback fired when job completes successfully */\r\n  onComplete?: (result: any) => void;\r\n  /** Callback fired when job fails */\r\n  onFailed?: (error: string) => void;\r\n  /** Callback fired on progress updates */\r\n  onProgress?: (progress: JobProgress) => void;\r\n}\r\n\r\nexport function useJobStatus(jobId: string | null, options: UseJobStatusOptions = {}) {\r\n  const [status, setStatus] = useState<JobStatus | null>(null);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const { onComplete, onFailed, onProgress } = options;\r\n\r\n  const resetState = useCallback(() => {\r\n    setStatus(null);\r\n    setIsConnected(false);\r\n    setError(null);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!jobId) {\r\n      resetState();\r\n      return;\r\n    }\r\n\r\n    let eventSource: EventSource | null = null;\r\n\r\n    try {\r\n      // EventSource automatically sends cookies with withCredentials\r\n      eventSource = new EventSource(`/api/jobs/${jobId}/stream`, {\r\n        withCredentials: true,\r\n      });\r\n\r\n      eventSource.onopen = () => {\r\n        setIsConnected(true);\r\n        setError(null);\r\n      };\r\n\r\n      eventSource.onmessage = (event) => {\r\n        try {\r\n          const data = JSON.parse(event.data) as JobStatus;\r\n          setStatus(data);\r\n\r\n          // Call appropriate callback based on event type\r\n          if (data.type === 'progress' && data.progress && onProgress) {\r\n            onProgress(data.progress);\r\n          }\r\n\r\n          if (data.type === 'completed') {\r\n            if (onComplete) {\r\n              onComplete(data.result);\r\n            }\r\n            // Server closes the connection, but we also close from client side\r\n            eventSource?.close();\r\n            setIsConnected(false);\r\n          }\r\n\r\n          if (data.type === 'failed') {\r\n            if (onFailed) {\r\n              onFailed(data.error || 'Unknown error');\r\n            }\r\n            eventSource?.close();\r\n            setIsConnected(false);\r\n          }\r\n\r\n          if (data.type === 'error') {\r\n            setError(data.message || 'Unknown error');\r\n            eventSource?.close();\r\n            setIsConnected(false);\r\n          }\r\n        } catch (parseError) {\r\n          console.error('Failed to parse SSE message:', parseError);\r\n        }\r\n      };\r\n\r\n      eventSource.onerror = (err) => {\r\n        console.error('SSE connection error:', err);\r\n        setIsConnected(false);\r\n        setError('Connection lost');\r\n        eventSource?.close();\r\n      };\r\n    } catch (initError) {\r\n      console.error('Failed to create EventSource:', initError);\r\n      setError('Failed to connect');\r\n    }\r\n\r\n    // Cleanup on unmount or jobId change\r\n    return () => {\r\n      if (eventSource) {\r\n        eventSource.close();\r\n        setIsConnected(false);\r\n      }\r\n    };\r\n  }, [jobId, onComplete, onFailed, onProgress, resetState]);\r\n\r\n  return {\r\n    /** Current job status */\r\n    status,\r\n    /** Whether SSE connection is active */\r\n    isConnected,\r\n    /** Error message if connection failed */\r\n    error,\r\n    /** Current progress (convenience accessor) */\r\n    progress: status?.progress || null,\r\n    /** Whether job is completed */\r\n    isCompleted: status?.type === 'completed',\r\n    /** Whether job failed */\r\n    isFailed: status?.type === 'failed',\r\n    /** Whether job is still processing */\r\n    isProcessing: isConnected && status?.type !== 'completed' && status?.type !== 'failed',\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useKeyboardShortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\usePanelCollapse.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useRipple.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useScheduledPosts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useStudioOrchestrator.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'prompt'. Either include it or remove the dependency array.","line":282,"column":6,"nodeType":"ArrayExpression","endLine":282,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [prompt]","fix":{"range":[11556,11558],"text":"[prompt]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":616,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":616,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23819,23822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23819,23822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'planContext'. Either include it or remove the dependency array.","line":628,"column":6,"nodeType":"ArrayExpression","endLine":640,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [selectedProducts, tempUploads, quickStartMode, quickStartPrompt, prompt, resolution, ideaBankMode, selectedTemplateForMode, generationRecipe, selectedStyleRefIds, planContext, generationMode]","fix":{"range":[24168,24396],"text":"[selectedProducts, tempUploads, quickStartMode, quickStartPrompt, prompt, resolution, ideaBankMode, selectedTemplateForMode, generationRecipe, selectedStyleRefIds, planContext, generationMode]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":737,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":737,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28008,28011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28008,28011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'videoJobId'. Either exclude it or remove the dependency array.","line":742,"column":6,"nodeType":"ArrayExpression","endLine":742,"endColumn":84,"suggestions":[{"desc":"Update the dependencies array to be: [quickStartPrompt, prompt, videoDuration, aspectRatio, resolution]","fix":{"range":[28152,28230],"text":"[quickStartPrompt, prompt, videoDuration, aspectRatio, resolution]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":800,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":800,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30220,30223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30220,30223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":870,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":870,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32797,32800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32797,32800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":913,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":913,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34375,34378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34375,34378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\n/**\n * useStudioOrchestrator  Extracted from Studio.tsx\n *\n * Holds ALL state, effects, handlers, and queries for the Studio page.\n * This hook makes it possible to decompose the Studio UI into small components\n * while keeping a single source of truth for state.\n */\n\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { getProductImageUrl } from '@/lib/utils';\nimport { getCsrfToken } from '@/lib/queryClient';\nimport type { Product, PerformingAdTemplate, AdSceneTemplate } from '@shared/schema';\nimport type { GenerationDTO } from '@shared/types/api';\nimport type { GenerationRecipe, GenerationMode, IdeaBankMode } from '@shared/types/ideaBank';\nimport type { AnalyzedUpload } from '@/types/analyzedUpload';\nimport { getTemplateById, type ContentTemplate } from '@shared/contentTemplates';\nimport { toast } from 'sonner';\nimport { useHistoryPanelUrl } from '@/hooks/useUrlState';\nimport { useHaptic } from '@/hooks/useHaptic';\nimport { useKeyboardShortcuts, type ShortcutConfig } from '@/hooks/useKeyboardShortcuts';\n\n// Types\nexport type GenerationState = 'idle' | 'generating' | 'result';\n\nexport interface CopyResult {\n  headline: string;\n  hook: string;\n  bodyText: string;\n  cta: string;\n  caption: string;\n  hashtags: string[];\n  framework: string;\n}\n\ninterface CollapsedSections {\n  upload: boolean;\n  products: boolean;\n  templates: boolean;\n  refine: boolean;\n  copy: boolean;\n  preview: boolean;\n  styleRefs: boolean;\n}\n\nconst COLLAPSED_SECTIONS_KEY = 'studio-collapsed-sections';\n\nfunction getStoredCollapsedSections(): CollapsedSections {\n  try {\n    const stored = localStorage.getItem(COLLAPSED_SECTIONS_KEY);\n    if (stored) return JSON.parse(stored);\n  } catch {}\n  return {\n    upload: false,\n    products: false,\n    templates: false,\n    refine: false,\n    copy: true,\n    preview: true,\n    styleRefs: false,\n  };\n}\n\nfunction storeCollapsedSections(sections: CollapsedSections) {\n  try {\n    localStorage.setItem(COLLAPSED_SECTIONS_KEY, JSON.stringify(sections));\n  } catch {}\n}\n\nexport function useStudioOrchestrator() {\n  const _queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n  const { haptic } = useHaptic();\n\n  //  Generation State \n  const [state, setState] = useState<GenerationState>('idle');\n  const [generatedImage, setGeneratedImage] = useState<string | null>(null);\n  const [generationId, setGenerationId] = useState<string | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  //  Selection State \n  const [selectedProducts, setSelectedProducts] = useState<Product[]>([]);\n  const [selectedTemplate, setSelectedTemplate] = useState<AdSceneTemplate | null>(null);\n  const [templateCategory, setTemplateCategory] = useState('all');\n  const [prompt, setPrompt] = useState('');\n  const [platform, setPlatform] = useState('LinkedIn');\n  const [aspectRatio, setAspectRatio] = useState('1200x627');\n  const [resolution, setResolution] = useState<'1K' | '2K' | '4K'>('2K');\n  const [selectedStyleRefIds, setSelectedStyleRefIds] = useState<string[]>([]);\n\n  //  UI State \n  const [collapsedSections, setCollapsedSections] = useState<CollapsedSections>(getStoredCollapsedSections);\n  const [currentSection, setCurrentSection] = useState('products');\n  const [showContextBar, setShowContextBar] = useState(false);\n  const [showStickyGenerate, setShowStickyGenerate] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [categoryFilter, setCategoryFilter] = useState('all');\n  const [activeActionButton, setActiveActionButton] = useState<'edit' | 'copy' | 'preview' | 'save' | null>(null);\n\n  //  Quick Start \n  const [quickStartMode, setQuickStartMode] = useState(false);\n  const [quickStartPrompt, setQuickStartPrompt] = useState('');\n\n  //  Temporary Uploads \n  const [tempUploads, setTempUploads] = useState<AnalyzedUpload[]>([]);\n\n  //  Price Estimate \n  const [priceEstimate, setPriceEstimate] = useState<{\n    estimatedCost: number;\n    p90: number;\n    sampleCount: number;\n    usedFallback: boolean;\n  } | null>(null);\n\n  //  Edit / Ask AI \n  const [editPrompt, setEditPrompt] = useState('');\n  const [isEditing, setIsEditing] = useState(false);\n  const [askAIQuestion, setAskAIQuestion] = useState('');\n  const [askAIResponse, setAskAIResponse] = useState<string | null>(null);\n  const [isAskingAI, setIsAskingAI] = useState(false);\n\n  //  Ad Copy \n  const [generatedCopy, setGeneratedCopy] = useState('');\n  const [isGeneratingCopy, setIsGeneratingCopy] = useState(false);\n  const [generatedImageUrl, setGeneratedImageUrl] = useState<string | null>(null);\n  const [generatedCopyFull, setGeneratedCopyFull] = useState<CopyResult | null>(null);\n\n  //  Dialogs \n  const [showSaveToCatalog, setShowSaveToCatalog] = useState(false);\n  const [showTemplateInspiration, setShowTemplateInspiration] = useState(false);\n  const [selectedPerformingTemplate, setSelectedPerformingTemplate] = useState<PerformingAdTemplate | null>(null);\n\n  //  Suggestion / Recipe \n  const [selectedSuggestion, setSelectedSuggestion] = useState<{\n    id: string;\n    prompt: string;\n    reasoning?: string;\n  } | null>(null);\n  const [generationRecipe, setGenerationRecipe] = useState<GenerationRecipe | undefined>(undefined);\n  const [ideaBankMode, setIdeaBankMode] = useState<IdeaBankMode>('freestyle');\n  const [generationMode, setGenerationMode] = useState<GenerationMode>('standard');\n  const [selectedTemplateForMode, setSelectedTemplateForMode] = useState<AdSceneTemplate | null>(null);\n\n  //  Weekly Plan Context \n  const [planContext, setPlanContext] = useState<{\n    planId: string;\n    postIndex: number;\n    briefing: string;\n    category: string;\n    dayOfWeek: string;\n  } | null>(null);\n\n  //  Content Planner \n  const [cpTemplate, setCpTemplate] = useState<ContentTemplate | null>(null);\n  const [showCarouselBuilder, setShowCarouselBuilder] = useState(false);\n  const [carouselTopic, setCarouselTopic] = useState('');\n  const [showBeforeAfterBuilder, setShowBeforeAfterBuilder] = useState(false);\n  const [beforeAfterTopic, setBeforeAfterTopic] = useState('');\n  const [showTextOnlyMode, setShowTextOnlyMode] = useState(false);\n  const [textOnlyTopic, setTextOnlyTopic] = useState('');\n  const [showCanvasEditor, setShowCanvasEditor] = useState(false);\n\n  //  Video Mode \n  const [mediaMode, setMediaMode] = useState<'image' | 'video'>('image');\n  const [videoDuration, setVideoDuration] = useState<'4' | '6' | '8'>('8');\n  const [videoJobId, setVideoJobId] = useState<string | null>(null);\n  const [generatedMediaType, setGeneratedMediaType] = useState<'image' | 'video'>('image');\n\n  //  History Panel \n  const { isHistoryOpen, selectedGenerationId, openHistory, closeHistory, selectGeneration } = useHistoryPanelUrl();\n  const [historyPanelOpen, setHistoryPanelOpen] = useState(isHistoryOpen);\n\n  //  UX Feedback \n  const [justCopied, setJustCopied] = useState(false);\n  const [isDownloading, setIsDownloading] = useState(false);\n  const [showKeyboardShortcuts, setShowKeyboardShortcuts] = useState(false);\n  const [imageScale, setImageScale] = useState(1);\n  const [imagePosition, setImagePosition] = useState({ x: 0, y: 0 });\n\n  //  Refs \n  const generateButtonRef = useRef<HTMLDivElement>(null);\n  const heroRef = useRef<HTMLDivElement>(null);\n  const zoomContainerRef = useRef<HTMLDivElement>(null);\n  const videoPollIntervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const videoPollTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  //  Queries \n  const { data: authUser } = useQuery({\n    queryKey: ['auth'],\n    queryFn: async () => {\n      const res = await fetch('/api/auth/me', { credentials: 'include' });\n      if (!res.ok) return null;\n      return res.json();\n    },\n    retry: false,\n  });\n\n  const { data: products = [] } = useQuery<Product[]>({\n    queryKey: ['products'],\n    queryFn: async () => {\n      const res = await fetch('/api/products');\n      if (!res.ok) return [];\n      const data = await res.json();\n      return Array.isArray(data) ? data : data?.products || [];\n    },\n  });\n\n  const { data: templates = [] } = useQuery<AdSceneTemplate[]>({\n    queryKey: ['templates'],\n    queryFn: async () => {\n      const res = await fetch('/api/templates');\n      if (!res.ok) return [];\n      const data = await res.json();\n      return data.templates || [];\n    },\n  });\n\n  const { data: featuredAdTemplates = [], isLoading: isLoadingFeatured } = useQuery<PerformingAdTemplate[]>({\n    queryKey: ['performing-ad-templates-featured'],\n    queryFn: async () => {\n      const res = await fetch('/api/performing-ad-templates/featured', { credentials: 'include' });\n      if (!res.ok) return [];\n      return res.json();\n    },\n    enabled: showTemplateInspiration,\n  });\n\n  //  Derived State \n  const filteredProducts = useMemo(\n    () =>\n      products.filter((product) => {\n        const matchesSearch = (product.name || '').toLowerCase().includes(searchQuery.toLowerCase());\n        const matchesCategory = categoryFilter === 'all' || product.category === categoryFilter;\n        return matchesSearch && matchesCategory;\n      }),\n    [products, searchQuery, categoryFilter],\n  );\n\n  const categories = useMemo(\n    () => ['all', ...Array.from(new Set(products.map((p) => p.category).filter((c): c is string => !!c)))],\n    [products],\n  );\n\n  const progressSections = useMemo(\n    () => [\n      { id: 'upload', label: 'Upload', completed: tempUploads.length > 0 },\n      { id: 'products', label: 'Products', completed: selectedProducts.length > 0 },\n      { id: 'templates', label: 'Style', completed: !!selectedTemplate },\n      { id: 'prompt', label: 'Prompt', completed: !!prompt.trim() },\n      { id: 'generate', label: 'Generate', completed: state === 'result' },\n      { id: 'result', label: 'Result', completed: state === 'result' },\n    ],\n    [tempUploads.length, selectedProducts.length, selectedTemplate, prompt, state],\n  );\n\n  const canGenerate = useMemo(\n    () => (selectedProducts.length > 0 || tempUploads.length > 0) && prompt.trim().length > 0,\n    [selectedProducts.length, tempUploads.length, prompt],\n  );\n\n  //  Effects \n\n  // Persist collapsed sections\n  useEffect(() => {\n    storeCollapsedSections(collapsedSections);\n  }, [collapsedSections]);\n\n  // Auto-save draft prompt\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      if (prompt) localStorage.setItem('studio-prompt-draft', prompt);\n    }, 500);\n    return () => clearTimeout(timeout);\n  }, [prompt]);\n\n  // Restore draft on mount\n  useEffect(() => {\n    const savedPrompt = localStorage.getItem('studio-prompt-draft');\n    if (savedPrompt && !prompt) setPrompt(savedPrompt);\n  }, []);\n\n  // Sync history panel URL state\n  useEffect(() => {\n    setHistoryPanelOpen(isHistoryOpen);\n  }, [isHistoryOpen]);\n\n  // Zoom wheel handler\n  useEffect(() => {\n    const container = zoomContainerRef.current;\n    if (!container) return;\n    const handleWheel = (e: WheelEvent) => {\n      e.preventDefault();\n      const delta = -e.deltaY * 0.001;\n      setImageScale((prev) => Math.max(0.5, Math.min(3, prev + delta)));\n    };\n    container.addEventListener('wheel', handleWheel, { passive: false });\n    return () => container.removeEventListener('wheel', handleWheel);\n  }, []);\n\n  // Load generation from URL\n  useEffect(() => {\n    if (selectedGenerationId && !generatedImage) {\n      fetch(`/api/generations/${selectedGenerationId}`, { credentials: 'include' })\n        .then((res) => res.json())\n        .then((data) => {\n          if (data.imageUrl) {\n            setGeneratedImage(data.imageUrl);\n            setGenerationId(data.id);\n            setPrompt(data.prompt || '');\n            setState('result');\n          }\n        })\n        .catch(console.error);\n    }\n  }, [selectedGenerationId, generatedImage]);\n\n  // Price estimate\n  useEffect(() => {\n    const inputImagesCount = selectedProducts.length + tempUploads.length;\n    const promptChars = prompt.length;\n    if (inputImagesCount === 0 && promptChars === 0) {\n      setPriceEstimate(null);\n      return;\n    }\n    const debounceTimer = setTimeout(async () => {\n      try {\n        const params = new URLSearchParams({\n          resolution,\n          operation: 'generate',\n          inputImagesCount: String(inputImagesCount),\n          promptChars: String(promptChars),\n        });\n        const res = await fetch(`/api/pricing/estimate?${params}`);\n        if (res.ok) setPriceEstimate(await res.json());\n      } catch {}\n    }, 300);\n    return () => clearTimeout(debounceTimer);\n  }, [selectedProducts.length, tempUploads.length, prompt.length, resolution]);\n\n  // Parse query params for template/pattern deep linking\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const cpTemplateId = params.get('cpTemplateId');\n    const freshStart = params.get('fresh') === 'true';\n\n    if (freshStart && cpTemplateId) {\n      setSelectedProducts([]);\n      setGeneratedCopy('');\n      setGeneratedImage(null);\n      setGeneratedImageUrl(null);\n      setPrompt('');\n      setSelectedTemplate(null);\n      setTempUploads([]);\n      setEditPrompt('');\n      setAskAIResponse(null);\n      setGenerationId(null);\n      setState('idle');\n      setSelectedSuggestion(null);\n      setGenerationRecipe(undefined);\n      setCpTemplate(null);\n      localStorage.removeItem('studio-prompt-draft');\n\n      const newParams = new URLSearchParams(window.location.search);\n      newParams.delete('fresh');\n      const newUrl = newParams.toString() ? `?${newParams.toString()}` : window.location.pathname;\n      window.history.replaceState({}, '', newUrl);\n    }\n\n    const templateId = params.get('templateId');\n    const mode = params.get('mode');\n    if (templateId && templates.length > 0) {\n      const template = templates.find((t) => t.id === templateId);\n      if (template) {\n        setSelectedTemplateForMode(template);\n        setIdeaBankMode('template');\n        if (mode && ['exact_insert', 'inspiration'].includes(mode)) {\n          setGenerationMode(mode as GenerationMode);\n        } else {\n          setGenerationMode('exact_insert');\n        }\n      }\n    }\n\n    if (cpTemplateId && !cpTemplate) {\n      const contentPlannerTemplate = getTemplateById(cpTemplateId);\n      if (contentPlannerTemplate) {\n        setCpTemplate(contentPlannerTemplate);\n        if (contentPlannerTemplate.bestPlatforms.length > 0) {\n          const bestPlatform = contentPlannerTemplate.bestPlatforms[0].platform;\n          const platformMap: Record<string, string> = {\n            linkedin: 'LinkedIn',\n            instagram: 'Instagram',\n            facebook: 'Facebook',\n            twitter: 'Twitter',\n            tiktok: 'TikTok',\n          };\n          const mappedPlatform = platformMap[bestPlatform?.toLowerCase()] || bestPlatform || 'LinkedIn';\n          setPlatform(mappedPlatform);\n\n          const format = contentPlannerTemplate.bestPlatforms[0]?.format;\n          const formatLower = (format || '').toLowerCase();\n          const formatAspectRatioMap: Record<string, string> = {\n            carousel: '1080x1350',\n            reel: '1080x1920',\n            story: '1080x1920',\n            video: '1920x1080',\n            post: '1200x627',\n          };\n          let detectedRatio = '1200x627';\n          if (formatLower.includes('carousel')) detectedRatio = formatAspectRatioMap.carousel;\n          else if (formatLower.includes('reel') || formatLower.includes('story'))\n            detectedRatio = formatAspectRatioMap.reel;\n          else if (formatLower.includes('video')) detectedRatio = formatAspectRatioMap.video;\n          else detectedRatio = formatAspectRatioMap.post;\n          setAspectRatio(detectedRatio);\n        }\n        if (contentPlannerTemplate.exampleTopics.length > 0 && !prompt) {\n          setPrompt(contentPlannerTemplate.exampleTopics[0]);\n        }\n      }\n    }\n\n    const suggestedPrompt = params.get('suggestedPrompt');\n    if (suggestedPrompt && !prompt && !cpTemplateId) {\n      setPrompt(suggestedPrompt);\n    }\n\n    // Weekly Plan deep-link: /?planId=xxx&postIndex=2\n    const planId = params.get('planId');\n    const postIndexParam = params.get('postIndex');\n    if (planId && postIndexParam !== null && !planContext) {\n      const postIdx = Number(postIndexParam);\n      fetch(`/api/planner/weekly/current`, { credentials: 'include' })\n        .then((res) => res.json())\n        .then((plan) => {\n          if (!plan || !plan.posts) return;\n          const post = plan.posts[postIdx];\n          if (!post) return;\n\n          // Set plan context\n          setPlanContext({\n            planId: plan.id || planId,\n            postIndex: postIdx,\n            briefing: post.briefing || '',\n            category: post.category || '',\n            dayOfWeek: post.dayOfWeek || '',\n          });\n\n          // Auto-select products from plan\n          if (post.productIds && post.productIds.length > 0 && products.length > 0) {\n            const planProducts = products.filter((p) => post.productIds.includes(String(p.id)));\n            if (planProducts.length > 0) setSelectedProducts(planProducts);\n          }\n\n          // Auto-set platform\n          if (post.platform) {\n            const platformMap: Record<string, string> = {\n              linkedin: 'LinkedIn',\n              instagram: 'Instagram',\n              facebook: 'Facebook',\n              twitter: 'Twitter',\n              tiktok: 'TikTok',\n            };\n            const mapped = platformMap[post.platform.toLowerCase()] || 'LinkedIn';\n            setPlatform(mapped);\n          }\n\n          // Auto-set prompt from briefing\n          if (post.briefing) {\n            setPrompt(post.briefing);\n          }\n\n          // Clean up URL params\n          const newParams = new URLSearchParams(window.location.search);\n          newParams.delete('planId');\n          newParams.delete('postIndex');\n          const newUrl = newParams.toString() ? `?${newParams.toString()}` : window.location.pathname;\n          window.history.replaceState({}, '', newUrl);\n        })\n        .catch(console.error);\n    }\n  }, [templates, prompt, cpTemplate, products, planContext]);\n\n  // Cleanup video polling on unmount\n  useEffect(() => {\n    return () => {\n      if (videoPollIntervalRef.current) {\n        clearInterval(videoPollIntervalRef.current);\n        videoPollIntervalRef.current = null;\n      }\n      if (videoPollTimeoutRef.current) {\n        clearTimeout(videoPollTimeoutRef.current);\n        videoPollTimeoutRef.current = null;\n      }\n    };\n  }, []);\n\n  // Scroll tracking\n  useEffect(() => {\n    const handleScroll = () => {\n      const scrollY = window.scrollY;\n      setShowContextBar(scrollY > 200 && state === 'idle');\n      if (generateButtonRef.current) {\n        const rect = generateButtonRef.current.getBoundingClientRect();\n        setShowStickyGenerate(rect.bottom < 0 && state === 'idle');\n      }\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [state]);\n\n  //  Handlers \n\n  const toggleProductSelection = useCallback((product: Product) => {\n    setSelectedProducts((prev) => {\n      const isSelected = prev.some((p) => p.id === product.id);\n      if (isSelected) return prev.filter((p) => p.id !== product.id);\n      if (prev.length >= 6) return prev;\n      return [...prev, product];\n    });\n  }, []);\n\n  const toggleSection = useCallback((section: keyof CollapsedSections) => {\n    setCollapsedSections((prev) => ({ ...prev, [section]: !prev[section] }));\n  }, []);\n\n  const navigateToSection = useCallback((id: string) => {\n    const element = document.getElementById(id);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      setCurrentSection(id);\n    }\n  }, []);\n\n  const handleGenerate = useCallback(async () => {\n    const hasImages = selectedProducts.length > 0 || tempUploads.length > 0;\n    // Auto-detect quick start: if quickStartPrompt has content, treat as quick start\n    const isQuickStart = quickStartMode || (quickStartPrompt.trim().length > 0 && !hasImages);\n    if (!hasImages && !isQuickStart) return;\n    const finalPrompt = isQuickStart ? quickStartPrompt : prompt;\n    if (!finalPrompt.trim()) return;\n\n    setState('generating');\n\n    // Create AbortController for this generation\n    const controller = new AbortController();\n    abortControllerRef.current = controller;\n\n    try {\n      const formData = new FormData();\n\n      if (!isQuickStart) {\n        const filePromises = selectedProducts.map(async (product) => {\n          const imageUrl = getProductImageUrl(product.cloudinaryUrl);\n          const response = await fetch(imageUrl);\n          const blob = await response.blob();\n          return new File([blob], `${product.name}.jpg`, { type: blob.type });\n        });\n        const files = await Promise.all(filePromises);\n        files.forEach((file) => formData.append('images', file));\n        tempUploads.forEach((upload) => formData.append('images', upload.file));\n      }\n\n      formData.append('prompt', finalPrompt);\n      formData.append('resolution', resolution);\n\n      if (ideaBankMode === 'template' && selectedTemplateForMode) {\n        formData.append('mode', generationMode);\n        formData.append('templateId', selectedTemplateForMode.id);\n      }\n\n      if (generationRecipe) {\n        formData.append('recipe', JSON.stringify(generationRecipe));\n      }\n\n      if (selectedStyleRefIds.length > 0) {\n        formData.append('styleReferenceIds', JSON.stringify(selectedStyleRefIds));\n      }\n\n      const token = await getCsrfToken().catch(() => '');\n      const response = await fetch('/api/transform', {\n        method: 'POST',\n        headers: { 'x-csrf-token': token },\n        credentials: 'include',\n        body: formData,\n        signal: controller.signal,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to transform image');\n      }\n\n      const data = await response.json();\n      setGeneratedImage(data.imageUrl);\n      setGenerationId(data.generationId);\n      setState('result');\n      localStorage.removeItem('studio-prompt-draft');\n\n      // Auto-update weekly plan post status if creating from plan\n      if (planContext && data.generationId) {\n        const csrfToken = await getCsrfToken().catch(() => '');\n        fetch(`/api/planner/weekly/${planContext.planId}/posts/${planContext.postIndex}`, {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json', 'x-csrf-token': csrfToken },\n          credentials: 'include',\n          body: JSON.stringify({ status: 'generated', generationId: data.generationId }),\n        }).catch(console.error);\n      }\n\n      setTimeout(() => {\n        document.getElementById('result')?.scrollIntoView({ behavior: 'smooth' });\n      }, 100);\n    } catch (error: any) {\n      // Don't show error toast if user cancelled\n      if (error.name === 'AbortError') {\n        toast.info('Generation cancelled');\n        setState('idle');\n        return;\n      }\n      toast.error(`Failed to generate image: ${error.message}`);\n      setState('idle');\n    } finally {\n      abortControllerRef.current = null;\n    }\n  }, [\n    selectedProducts,\n    tempUploads,\n    quickStartMode,\n    quickStartPrompt,\n    prompt,\n    resolution,\n    ideaBankMode,\n    selectedTemplateForMode,\n    generationMode,\n    generationRecipe,\n    selectedStyleRefIds,\n  ]);\n\n  const handleCancelGeneration = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    setState('idle');\n  }, []);\n\n  /** Generate a video via Veo  enqueues a BullMQ job then polls for completion */\n  const handleGenerateVideo = useCallback(async () => {\n    const finalPrompt = quickStartPrompt.trim() || prompt.trim();\n    if (!finalPrompt) return;\n\n    setState('generating');\n    setGeneratedMediaType('video');\n\n    try {\n      const token = await getCsrfToken().catch(() => '');\n      const response = await fetch('/api/generations/video', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'x-csrf-token': token },\n        credentials: 'include',\n        body: JSON.stringify({\n          prompt: finalPrompt,\n          duration: videoDuration,\n          aspectRatio: aspectRatio === '1080x1920' || aspectRatio === '1080x1350' ? '9:16' : '16:9',\n          videoResolution: resolution === '4K' ? '4k' : resolution === '1K' ? '720p' : '1080p',\n        }),\n      });\n\n      if (!response.ok) {\n        const errData = await response.json();\n        throw new Error(errData.error || 'Failed to start video generation');\n      }\n\n      const data = await response.json();\n      setGenerationId(data.generationId);\n      setVideoJobId(data.jobId);\n\n      // Clear any previous polling\n      if (videoPollIntervalRef.current) {\n        clearInterval(videoPollIntervalRef.current);\n        videoPollIntervalRef.current = null;\n      }\n      if (videoPollTimeoutRef.current) {\n        clearTimeout(videoPollTimeoutRef.current);\n        videoPollTimeoutRef.current = null;\n      }\n\n      // Poll for completion\n      const pollInterval = setInterval(async () => {\n        try {\n          const statusRes = await fetch(`/api/jobs/${data.jobId}`, { credentials: 'include' });\n          if (!statusRes.ok) return;\n\n          const statusData = await statusRes.json();\n\n          if (statusData.state === 'completed' && statusData.generation?.generatedImagePath) {\n            clearInterval(pollInterval);\n            videoPollIntervalRef.current = null;\n            if (videoPollTimeoutRef.current) {\n              clearTimeout(videoPollTimeoutRef.current);\n              videoPollTimeoutRef.current = null;\n            }\n            setGeneratedImage(statusData.generation.generatedImagePath);\n            setState('result');\n            setVideoJobId(null);\n            toast.success('Video generated!');\n          } else if (statusData.state === 'failed') {\n            clearInterval(pollInterval);\n            videoPollIntervalRef.current = null;\n            if (videoPollTimeoutRef.current) {\n              clearTimeout(videoPollTimeoutRef.current);\n              videoPollTimeoutRef.current = null;\n            }\n            toast.error(`Video generation failed: ${statusData.failedReason || 'Unknown error'}`);\n            setState('idle');\n            setVideoJobId(null);\n          }\n        } catch {\n          // silently retry on network blips\n        }\n      }, 5000);\n      videoPollIntervalRef.current = pollInterval;\n\n      // Safety timeout  stop polling after 12 minutes\n      const safetyTimeout = setTimeout(() => {\n        clearInterval(pollInterval);\n        videoPollIntervalRef.current = null;\n        videoPollTimeoutRef.current = null;\n        toast.error('Video generation timed out. Check Gallery for results.');\n        setState('idle');\n        setVideoJobId(null);\n      }, 720_000);\n      videoPollTimeoutRef.current = safetyTimeout;\n    } catch (error: any) {\n      toast.error(`Video generation failed: ${error.message}`);\n      setState('idle');\n      setGeneratedMediaType('image');\n    }\n  }, [quickStartPrompt, prompt, videoDuration, aspectRatio, resolution, videoJobId]);\n\n  const handleDownload = useCallback(() => {\n    if (!generatedImage) return;\n    const link = document.createElement('a');\n    link.href = generatedImage;\n    link.download = `product-${generationId || Date.now()}.png`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }, [generatedImage, generationId]);\n\n  const handleDownloadWithFeedback = useCallback(async () => {\n    if (!generatedImage) return;\n    haptic('light');\n    setIsDownloading(true);\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 100));\n      handleDownload();\n      haptic('medium');\n      toast.success('Image downloaded!', { duration: 2000 });\n    } catch {\n      haptic('heavy');\n      toast.error('Download failed');\n    } finally {\n      setTimeout(() => setIsDownloading(false), 500);\n    }\n  }, [generatedImage, handleDownload, haptic]);\n\n  const handleReset = useCallback(() => {\n    setState('idle');\n    setGeneratedImage(null);\n    setGenerationId(null);\n    setQuickStartMode(false);\n    setQuickStartPrompt('');\n    setTempUploads([]);\n    setGeneratedCopy('');\n    setGeneratedMediaType('image');\n    setVideoJobId(null);\n  }, []);\n\n  const handleApplyEdit = useCallback(async () => {\n    if (!editPrompt.trim() || !generationId) return;\n    haptic('light');\n    setIsEditing(true);\n    try {\n      const editToken = await getCsrfToken().catch(() => '');\n      const response = await fetch(`/api/generations/${generationId}/edit`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'x-csrf-token': editToken },\n        credentials: 'include',\n        body: JSON.stringify({ editPrompt: editPrompt.trim() }),\n      });\n      const data = await response.json();\n      if (!response.ok || !data.success) throw new Error(data.error || 'Edit failed');\n      haptic('medium');\n      toast.success('Changes applied!', { duration: 2000 });\n      setLocation(`/generation/${data.generationId}`);\n    } catch (error: any) {\n      haptic('heavy');\n      toast.error(error.message || 'Edit failed');\n    } finally {\n      setIsEditing(false);\n    }\n  }, [editPrompt, generationId, haptic, setLocation]);\n\n  const handleCanvasEditComplete = useCallback(\n    (newImageUrl: string) => {\n      setGeneratedImage(newImageUrl);\n      setShowCanvasEditor(false);\n      haptic('medium');\n      toast.success('Canvas edit applied!', { duration: 2000 });\n    },\n    [haptic],\n  );\n\n  const handleSelectSuggestion = useCallback((suggestionPrompt: string, suggestionId?: string, reasoning?: string) => {\n    setPrompt(suggestionPrompt);\n    setSelectedSuggestion({ id: suggestionId || 'selected', prompt: suggestionPrompt, reasoning });\n    setTimeout(() => {\n      document.getElementById('prompt')?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 100);\n  }, []);\n\n  const handlePromptChange = useCallback(\n    (value: string) => {\n      setPrompt(value);\n      if (selectedSuggestion && value !== selectedSuggestion.prompt) {\n        setSelectedSuggestion(null);\n      }\n    },\n    [selectedSuggestion],\n  );\n\n  const handleGenerateCopy = useCallback(async () => {\n    if (!generationId) return;\n    haptic('light');\n    setIsGeneratingCopy(true);\n    try {\n      const productName = selectedProducts.length > 0 ? selectedProducts.map((p) => p.name).join(', ') : 'Product';\n      const productDescription =\n        selectedProducts.length > 0\n          ? selectedProducts.map((p) => p.description || p.name).join('. ')\n          : prompt || quickStartPrompt || 'Professional product for marketing';\n\n      const copyToken = await getCsrfToken().catch(() => '');\n      const response = await fetch('/api/copy/generate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'x-csrf-token': copyToken },\n        credentials: 'include',\n        body: JSON.stringify({\n          generationId,\n          platform: platform.toLowerCase(),\n          tone: 'professional',\n          productName: productName.slice(0, 100),\n          productDescription: productDescription.slice(0, 500),\n          industry: 'Building Products',\n          framework: 'auto',\n          variations: 1,\n        }),\n      });\n      const data = await response.json();\n      if (!response.ok || !data.success) throw new Error(data.error || 'Failed to generate copy');\n      if (data.variations && data.variations.length > 0) {\n        setGeneratedCopy(data.variations[0].copy);\n        haptic('medium');\n        toast.success('Copy generated!', { duration: 2000 });\n      }\n    } catch (error: any) {\n      haptic('heavy');\n      toast.error(error.message || 'Failed to generate copy');\n    } finally {\n      setIsGeneratingCopy(false);\n    }\n  }, [generationId, haptic, selectedProducts, prompt, quickStartPrompt, platform]);\n\n  const handleLoadFromHistory = useCallback((generation: GenerationDTO) => {\n    setGeneratedImage(generation.imageUrl);\n    setGenerationId(generation.id);\n    setPrompt(generation.prompt || '');\n    setState('result');\n    setTimeout(() => {\n      document.getElementById('result')?.scrollIntoView({ behavior: 'smooth' });\n    }, 100);\n  }, []);\n\n  const handleHistoryToggle = useCallback(() => {\n    if (historyPanelOpen) {\n      closeHistory();\n    } else {\n      openHistory();\n    }\n    setHistoryPanelOpen(!historyPanelOpen);\n  }, [historyPanelOpen, closeHistory, openHistory]);\n\n  const handleAskAI = useCallback(async () => {\n    if (!askAIQuestion.trim() || !generationId) return;\n    setIsAskingAI(true);\n    setAskAIResponse(null);\n    try {\n      const analyzeToken = await getCsrfToken().catch(() => '');\n      const response = await fetch(`/api/generations/${generationId}/analyze`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'x-csrf-token': analyzeToken },\n        credentials: 'include',\n        body: JSON.stringify({ question: askAIQuestion.trim() }),\n      });\n      const data = await response.json();\n      if (!response.ok || !data.success) throw new Error(data.error || 'Failed to get response');\n      setAskAIResponse(data.answer);\n      setAskAIQuestion('');\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to get response');\n    } finally {\n      setIsAskingAI(false);\n    }\n  }, [askAIQuestion, generationId]);\n\n  const handleSelectPerformingTemplate = useCallback(\n    (template: PerformingAdTemplate) => {\n      setSelectedPerformingTemplate(template);\n      const platformMap: Record<string, string> = {\n        instagram: 'Instagram',\n        linkedin: 'LinkedIn',\n        facebook: 'Facebook',\n        twitter: 'Twitter',\n        tiktok: 'TikTok',\n      };\n      const aspectRatioMap: Record<string, string> = {\n        '1:1': '1200x1200',\n        '16:9': '1920x1080',\n        '9:16': '1080x1920',\n        '4:5': '1080x1350',\n        '1.91:1': '1200x627',\n      };\n      if (template.targetPlatforms && template.targetPlatforms.length > 0) {\n        const mapped = platformMap[template.targetPlatforms[0]];\n        if (mapped) setPlatform(mapped);\n      }\n      if (template.targetAspectRatios && template.targetAspectRatios.length > 0) {\n        const mapped = aspectRatioMap[template.targetAspectRatios[0]];\n        if (mapped) setAspectRatio(mapped);\n      }\n      const styleHints: string[] = [];\n      if (template.mood) styleHints.push(template.mood);\n      if (template.style) styleHints.push(template.style);\n      if (template.backgroundType) styleHints.push(`${template.backgroundType} background`);\n      if (styleHints.length > 0) {\n        const stylePrefix = `Style: ${styleHints.join(', ')}. `;\n        if (!prompt.startsWith('Style:')) {\n          setPrompt((prev) => (prev ? `${stylePrefix}${prev}` : stylePrefix));\n        }\n      }\n      setShowTemplateInspiration(false);\n    },\n    [prompt],\n  );\n\n  const clearPlanContext = useCallback(() => {\n    setPlanContext(null);\n  }, []);\n\n  const handleCopyText = useCallback(() => {\n    if (!generatedCopy) return;\n    haptic('light');\n    navigator.clipboard.writeText(generatedCopy);\n    setJustCopied(true);\n    setTimeout(() => setJustCopied(false), 2000);\n    toast.success('Copied to clipboard!', { duration: 2000 });\n  }, [generatedCopy, haptic]);\n\n  //  Keyboard Shortcuts \n  const shortcuts: ShortcutConfig[] = useMemo(\n    () => [\n      {\n        key: 'g',\n        ctrlKey: true,\n        callback: () => {\n          if (state === 'idle' && canGenerate) handleGenerate();\n        },\n        description: 'Generate image',\n        disabled: state !== 'idle' || !canGenerate,\n      },\n      {\n        key: 'd',\n        ctrlKey: true,\n        callback: () => {\n          if (generatedImage) handleDownloadWithFeedback();\n        },\n        description: 'Download image',\n        disabled: !generatedImage,\n      },\n      {\n        key: 'r',\n        ctrlKey: true,\n        callback: handleReset,\n        description: 'Reset workspace',\n        disabled: state === 'idle' && !generatedImage,\n      },\n      {\n        key: '/',\n        callback: () => document.getElementById('prompt-textarea')?.focus(),\n        description: 'Focus prompt',\n      },\n      {\n        key: '?',\n        shiftKey: true,\n        callback: () => setShowKeyboardShortcuts((v) => !v),\n        description: 'Toggle shortcuts help',\n      },\n    ],\n    [state, canGenerate, generatedImage, handleGenerate, handleDownloadWithFeedback, handleReset],\n  );\n\n  useKeyboardShortcuts(shortcuts);\n\n  //  Return \n  return {\n    // State\n    state,\n    generatedImage,\n    generationId,\n    selectedProducts,\n    selectedTemplate,\n    templateCategory,\n    prompt,\n    platform,\n    aspectRatio,\n    resolution,\n    collapsedSections,\n    currentSection,\n    showContextBar,\n    showStickyGenerate,\n    searchQuery,\n    categoryFilter,\n    activeActionButton,\n    quickStartMode,\n    quickStartPrompt,\n    tempUploads,\n    priceEstimate,\n    editPrompt,\n    isEditing,\n    askAIQuestion,\n    askAIResponse,\n    isAskingAI,\n    generatedCopy,\n    isGeneratingCopy,\n    generatedImageUrl,\n    generatedCopyFull,\n    showSaveToCatalog,\n    showTemplateInspiration,\n    selectedPerformingTemplate,\n    selectedSuggestion,\n    generationRecipe,\n    ideaBankMode,\n    generationMode,\n    selectedTemplateForMode,\n    planContext,\n    cpTemplate,\n    showCarouselBuilder,\n    carouselTopic,\n    showBeforeAfterBuilder,\n    beforeAfterTopic,\n    showTextOnlyMode,\n    textOnlyTopic,\n    showCanvasEditor,\n    mediaMode,\n    videoDuration,\n    videoJobId,\n    generatedMediaType,\n    historyPanelOpen,\n    justCopied,\n    isDownloading,\n    showKeyboardShortcuts,\n    imageScale,\n    imagePosition,\n    canGenerate,\n    shortcuts,\n\n    // Data\n    authUser,\n    products,\n    templates,\n    featuredAdTemplates,\n    isLoadingFeatured,\n    filteredProducts,\n    categories,\n    progressSections,\n\n    // Refs\n    generateButtonRef,\n    heroRef,\n    zoomContainerRef,\n\n    // Setters (for components that need direct state control)\n    setState,\n    setGeneratedImage,\n    setGenerationId,\n    setSelectedProducts,\n    setSelectedTemplate,\n    setTemplateCategory,\n    setPrompt,\n    setPlatform,\n    setAspectRatio,\n    setResolution,\n    setSearchQuery,\n    setCategoryFilter,\n    setActiveActionButton,\n    setQuickStartMode,\n    setQuickStartPrompt,\n    setTempUploads,\n    setEditPrompt,\n    setAskAIQuestion,\n    setGeneratedCopy,\n    setIsGeneratingCopy,\n    setGeneratedCopyFull,\n    setShowSaveToCatalog,\n    setShowTemplateInspiration,\n    setSelectedPerformingTemplate,\n    setSelectedSuggestion,\n    setGenerationRecipe,\n    setIdeaBankMode,\n    setGenerationMode,\n    setSelectedTemplateForMode,\n    setPlanContext,\n    clearPlanContext,\n    setCpTemplate,\n    setShowCarouselBuilder,\n    setCarouselTopic,\n    setShowBeforeAfterBuilder,\n    setBeforeAfterTopic,\n    setShowTextOnlyMode,\n    setTextOnlyTopic,\n    setShowCanvasEditor,\n    setMediaMode,\n    setVideoDuration,\n    setVideoJobId,\n    setGeneratedMediaType,\n    setHistoryPanelOpen,\n    setShowKeyboardShortcuts,\n    setImageScale,\n    setImagePosition,\n    selectedStyleRefIds,\n    setSelectedStyleRefIds,\n\n    // Handlers\n    toggleProductSelection,\n    toggleSection,\n    navigateToSection,\n    handleGenerate,\n    handleGenerateVideo,\n    handleCancelGeneration,\n    handleDownload,\n    handleDownloadWithFeedback,\n    handleReset,\n    handleApplyEdit,\n    handleCanvasEditComplete,\n    handleSelectSuggestion,\n    handlePromptChange,\n    handleGenerateCopy,\n    handleLoadFromHistory,\n    handleHistoryToggle,\n    handleAskAI,\n    handleSelectPerformingTemplate,\n    handleCopyText,\n\n    // History URL state\n    selectGeneration,\n    haptic,\n  };\n}\n\nexport type StudioOrchestrator = ReturnType<typeof useStudioOrchestrator>;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useStudioState.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StudioAction' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":40,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"StudioAction"},"fix":{"range":[72,86],"text":""},"desc":"Remove unused variable \"StudioAction\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo } from 'react';\r\nimport { useStudioContext, StudioAction, SelectedSuggestion } from '@/context/StudioContext';\r\nimport type { Product, AdSceneTemplate } from '@shared/schema';\r\nimport type { GenerationRecipe, GenerationMode, IdeaBankMode } from '@shared/types/ideaBank';\r\nimport type { AnalyzedUpload } from '@/types/analyzedUpload';\r\n\r\n/**\r\n * useStudioState - Primary hook for accessing Studio state and actions\r\n *\r\n * Provides:\r\n * - Direct state access\r\n * - Derived state (computed values)\r\n * - Type-safe action dispatchers\r\n */\r\nexport function useStudioState() {\r\n  const { state, dispatch } = useStudioContext();\r\n\r\n  // ============================================\r\n  // DERIVED STATE\r\n  // ============================================\r\n\r\n  const hasProducts = state.selectedProducts.length > 0;\r\n  const hasUploads = state.tempUploads.length > 0;\r\n  const hasImages = hasProducts || hasUploads;\r\n  const hasPrompt = state.prompt.trim().length > 0;\r\n  const canGenerate = hasImages && hasPrompt;\r\n  const isGenerating = state.generationState === 'generating';\r\n  const hasResult = state.generationState === 'result';\r\n  const isIdle = state.generationState === 'idle';\r\n\r\n  // Count of selected/confirmed uploads\r\n  const confirmedUploads = useMemo(\r\n    () => state.tempUploads.filter((u) => u.status === 'confirmed'),\r\n    [state.tempUploads]\r\n  );\r\n\r\n  // All image URLs for generation\r\n  const allImageUrls = useMemo(() => {\r\n    const productUrls = state.selectedProducts\r\n      .map((p) => p.cloudinaryUrl)\r\n      .filter(Boolean) as string[];\r\n    const uploadUrls = confirmedUploads.map((u) => u.previewUrl);\r\n    return [...productUrls, ...uploadUrls];\r\n  }, [state.selectedProducts, confirmedUploads]);\r\n\r\n  // ============================================\r\n  // ACTION DISPATCHERS\r\n  // ============================================\r\n\r\n  // Generation Actions\r\n  const setGenerating = useCallback(() => {\r\n    dispatch({ type: 'SET_GENERATION_STATE', state: 'generating' });\r\n  }, [dispatch]);\r\n\r\n  const setResult = useCallback(\r\n    (image: string, id: string) => {\r\n      dispatch({ type: 'SET_GENERATED_IMAGE', image, id });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const clearGeneration = useCallback(() => {\r\n    dispatch({ type: 'CLEAR_GENERATION' });\r\n  }, [dispatch]);\r\n\r\n  // Product Actions\r\n  const selectProduct = useCallback(\r\n    (product: Product) => {\r\n      dispatch({ type: 'SELECT_PRODUCT', product });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const deselectProduct = useCallback(\r\n    (productId: string) => {\r\n      dispatch({ type: 'DESELECT_PRODUCT', productId });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const clearProducts = useCallback(() => {\r\n    dispatch({ type: 'CLEAR_PRODUCTS' });\r\n  }, [dispatch]);\r\n\r\n  const setProducts = useCallback(\r\n    (products: Product[]) => {\r\n      dispatch({ type: 'SET_PRODUCTS', products });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  // Template Actions\r\n  const selectTemplate = useCallback(\r\n    (template: AdSceneTemplate) => {\r\n      dispatch({ type: 'SELECT_TEMPLATE', template });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const clearTemplate = useCallback(() => {\r\n    dispatch({ type: 'CLEAR_TEMPLATE' });\r\n  }, [dispatch]);\r\n\r\n  // Upload Actions\r\n  const setUploads = useCallback(\r\n    (uploads: AnalyzedUpload[]) => {\r\n      dispatch({ type: 'SET_UPLOADS', uploads });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const addUpload = useCallback(\r\n    (upload: AnalyzedUpload) => {\r\n      dispatch({ type: 'ADD_UPLOAD', upload });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const updateUpload = useCallback(\r\n    (id: string, updates: Partial<AnalyzedUpload>) => {\r\n      dispatch({ type: 'UPDATE_UPLOAD', id, updates });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const removeUpload = useCallback(\r\n    (id: string) => {\r\n      dispatch({ type: 'REMOVE_UPLOAD', id });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const clearUploads = useCallback(() => {\r\n    dispatch({ type: 'CLEAR_UPLOADS' });\r\n  }, [dispatch]);\r\n\r\n  // Prompt Actions\r\n  const setPrompt = useCallback(\r\n    (prompt: string) => {\r\n      dispatch({ type: 'SET_PROMPT', prompt });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setSuggestion = useCallback(\r\n    (suggestion: SelectedSuggestion | null) => {\r\n      dispatch({ type: 'SET_SUGGESTION', suggestion });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  // Output Settings Actions\r\n  const setPlatform = useCallback(\r\n    (platform: string) => {\r\n      dispatch({ type: 'SET_PLATFORM', platform });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setAspectRatio = useCallback(\r\n    (aspectRatio: string) => {\r\n      dispatch({ type: 'SET_ASPECT_RATIO', aspectRatio });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setResolution = useCallback(\r\n    (resolution: '1K' | '2K' | '4K') => {\r\n      dispatch({ type: 'SET_RESOLUTION', resolution });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  // Mode Actions\r\n  const setIdeaBankMode = useCallback(\r\n    (mode: IdeaBankMode) => {\r\n      dispatch({ type: 'SET_IDEABANK_MODE', mode });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setGenerationMode = useCallback(\r\n    (mode: GenerationMode) => {\r\n      dispatch({ type: 'SET_GENERATION_MODE', mode });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setTemplateForMode = useCallback(\r\n    (template: AdSceneTemplate | null) => {\r\n      dispatch({ type: 'SET_TEMPLATE_FOR_MODE', template });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  const setRecipe = useCallback(\r\n    (recipe: GenerationRecipe | undefined) => {\r\n      dispatch({ type: 'SET_RECIPE', recipe });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  // Copy Actions\r\n  const setGeneratedCopy = useCallback(\r\n    (copy: string) => {\r\n      dispatch({ type: 'SET_GENERATED_COPY', copy });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  // Reset\r\n  const reset = useCallback(() => {\r\n    dispatch({ type: 'RESET' });\r\n  }, [dispatch]);\r\n\r\n  // Load from history\r\n  const loadFromHistory = useCallback(\r\n    (payload: Parameters<typeof dispatch>[0] extends { type: 'LOAD_FROM_HISTORY'; payload: infer P } ? P : never) => {\r\n      dispatch({ type: 'LOAD_FROM_HISTORY', payload });\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  return {\r\n    // State\r\n    state,\r\n    dispatch,\r\n\r\n    // Derived State\r\n    hasProducts,\r\n    hasUploads,\r\n    hasImages,\r\n    hasPrompt,\r\n    canGenerate,\r\n    isGenerating,\r\n    hasResult,\r\n    isIdle,\r\n    confirmedUploads,\r\n    allImageUrls,\r\n\r\n    // Generation Actions\r\n    setGenerating,\r\n    setResult,\r\n    clearGeneration,\r\n\r\n    // Product Actions\r\n    selectProduct,\r\n    deselectProduct,\r\n    clearProducts,\r\n    setProducts,\r\n\r\n    // Template Actions\r\n    selectTemplate,\r\n    clearTemplate,\r\n\r\n    // Upload Actions\r\n    setUploads,\r\n    addUpload,\r\n    updateUpload,\r\n    removeUpload,\r\n    clearUploads,\r\n\r\n    // Prompt Actions\r\n    setPrompt,\r\n    setSuggestion,\r\n\r\n    // Output Settings Actions\r\n    setPlatform,\r\n    setAspectRatio,\r\n    setResolution,\r\n\r\n    // Mode Actions\r\n    setIdeaBankMode,\r\n    setGenerationMode,\r\n    setTemplateForMode,\r\n    setRecipe,\r\n\r\n    // Copy Actions\r\n    setGeneratedCopy,\r\n\r\n    // Utility Actions\r\n    reset,\r\n    loadFromHistory,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useStyleReferences.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[462,465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[462,465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * useStyleReferences  Fetch and manage style references for the current user\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\n\r\nexport interface StyleReference {\r\n  id: string;\r\n  userId: string;\r\n  cloudinaryUrl: string;\r\n  cloudinaryPublicId: string;\r\n  name: string;\r\n  category: 'character' | 'style' | 'scene';\r\n  tags: string[] | null;\r\n  styleDescription: string | null;\r\n  extractedElements: any | null;\r\n  confidence: number;\r\n  imageFingerprint: string;\r\n  analyzedAt: string | null;\r\n  usageCount: number;\r\n  lastUsedAt: string | null;\r\n  isActive: boolean;\r\n  createdAt: string;\r\n}\r\n\r\nasync function fetchCsrfToken(): Promise<string> {\r\n  const res = await fetch('/api/csrf-token', { credentials: 'include' });\r\n  const data = await res.json();\r\n  return data.csrfToken;\r\n}\r\n\r\nexport function useStyleReferences() {\r\n  return useQuery<StyleReference[]>({\r\n    queryKey: ['style-references'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/style-references', { credentials: 'include' });\r\n      if (!res.ok) throw new Error('Failed to fetch style references');\r\n      return res.json();\r\n    },\r\n    staleTime: 30_000,\r\n  });\r\n}\r\n\r\nexport function useUploadStyleReference() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({\r\n      file,\r\n      name,\r\n      category,\r\n      tags,\r\n    }: {\r\n      file: File;\r\n      name: string;\r\n      category: string;\r\n      tags?: string[];\r\n    }) => {\r\n      const csrfToken = await fetchCsrfToken();\r\n      const formData = new FormData();\r\n      formData.append('image', file);\r\n      formData.append('name', name);\r\n      formData.append('category', category);\r\n      if (tags) formData.append('tags', JSON.stringify(tags));\r\n\r\n      const res = await fetch('/api/style-references', {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'x-csrf-token': csrfToken },\r\n        body: formData,\r\n      });\r\n\r\n      if (!res.ok) throw new Error('Failed to upload style reference');\r\n      return res.json() as Promise<StyleReference>;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['style-references'] });\r\n    },\r\n  });\r\n}\r\n\r\nexport function useDeleteStyleReference() {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const csrfToken = await fetchCsrfToken();\r\n      const res = await fetch(`/api/style-references/${id}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'x-csrf-token': csrfToken },\r\n      });\r\n      if (!res.ok) throw new Error('Failed to delete style reference');\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['style-references'] });\r\n    },\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useUploadStatus.example.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useUploadStatus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useUrlState.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has unnecessary dependencies: 'location' and 'urlVersion'. Either exclude them or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[1521,1543],"text":"[]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo, useState } from 'react';\r\nimport { useLocation } from 'wouter';\r\n\r\n/**\r\n * useUrlState - Hook for managing URL query parameters as state\r\n *\r\n * Enables deep linking and URL-based state management without full page reloads.\r\n * Used for:\r\n * - History panel: /?view=history\r\n * - Generation detail: /?generation=:id\r\n * - Library tabs: /library?tab=products\r\n * - Settings sections: /settings?section=api-keys\r\n */\r\nexport function useUrlState() {\r\n  const [location, setLocation] = useLocation();\r\n\r\n  // Version counter to force searchParams re-computation when we update query params\r\n  // This is needed because wouter's location only contains the pathname, not query params\r\n  // So when navigating within the same path (e.g., /settings?section=brand  /settings?section=usage),\r\n  // the location doesn't change and useMemo won't re-run without this trigger\r\n  const [urlVersion, setUrlVersion] = useState(0);\r\n\r\n  // Parse current URL search params from window.location\r\n  // The location dependency ensures re-parsing when wouter updates the route\r\n  // The urlVersion dependency ensures re-parsing when we programmatically update query params\r\n  const searchParams = useMemo(() => {\r\n    if (typeof window === 'undefined') {\r\n      return new URLSearchParams();\r\n    }\r\n    // Use window.location.search as the single source of truth\r\n    // This ensures we always have the current query params even with hash routing\r\n    return new URLSearchParams(window.location.search);\r\n  }, [location, urlVersion]);\r\n\r\n  /**\r\n   * Get a single query parameter value\r\n   */\r\n  const getParam = useCallback(\r\n    (key: string): string | null => {\r\n      return searchParams.get(key);\r\n    },\r\n    [searchParams]\r\n  );\r\n\r\n  /**\r\n   * Get all values for a query parameter (for multi-value params)\r\n   */\r\n  const getParamAll = useCallback(\r\n    (key: string): string[] => {\r\n      return searchParams.getAll(key);\r\n    },\r\n    [searchParams]\r\n  );\r\n\r\n  /**\r\n   * Check if a query parameter exists\r\n   */\r\n  const hasParam = useCallback(\r\n    (key: string): boolean => {\r\n      return searchParams.has(key);\r\n    },\r\n    [searchParams]\r\n  );\r\n\r\n  /**\r\n   * Set a single query parameter value\r\n   * Pass null to remove the parameter\r\n   */\r\n  const setParam = useCallback(\r\n    (key: string, value: string | null) => {\r\n      const newParams = new URLSearchParams(searchParams);\r\n\r\n      if (value === null) {\r\n        newParams.delete(key);\r\n      } else {\r\n        newParams.set(key, value);\r\n      }\r\n\r\n      const newSearch = newParams.toString();\r\n      const basePath = location.split('?')[0];\r\n      const newLocation = newSearch ? `${basePath}?${newSearch}` : basePath;\r\n\r\n      setLocation(newLocation);\r\n      setUrlVersion(v => v + 1); // Force searchParams re-computation\r\n    },\r\n    [searchParams, location, setLocation]\r\n  );\r\n\r\n  /**\r\n   * Set multiple query parameters at once\r\n   * Values of null will remove the parameter\r\n   */\r\n  const setParams = useCallback(\r\n    (params: Record<string, string | null>) => {\r\n      const newParams = new URLSearchParams(searchParams);\r\n\r\n      for (const [key, value] of Object.entries(params)) {\r\n        if (value === null) {\r\n          newParams.delete(key);\r\n        } else {\r\n          newParams.set(key, value);\r\n        }\r\n      }\r\n\r\n      const newSearch = newParams.toString();\r\n      const basePath = location.split('?')[0];\r\n      const newLocation = newSearch ? `${basePath}?${newSearch}` : basePath;\r\n\r\n      setLocation(newLocation);\r\n      setUrlVersion(v => v + 1); // Force searchParams re-computation\r\n    },\r\n    [searchParams, location, setLocation]\r\n  );\r\n\r\n  /**\r\n   * Toggle a boolean-like query parameter\r\n   * If present, removes it; if absent, adds with value 'true'\r\n   */\r\n  const toggleParam = useCallback(\r\n    (key: string) => {\r\n      if (searchParams.has(key)) {\r\n        setParam(key, null);\r\n      } else {\r\n        setParam(key, 'true');\r\n      }\r\n    },\r\n    [searchParams, setParam]\r\n  );\r\n\r\n  /**\r\n   * Clear all query parameters, optionally keeping specified keys\r\n   */\r\n  const clearParams = useCallback(\r\n    (keepKeys: string[] = []) => {\r\n      const newParams = new URLSearchParams();\r\n\r\n      for (const key of keepKeys) {\r\n        const value = searchParams.get(key);\r\n        if (value !== null) {\r\n          newParams.set(key, value);\r\n        }\r\n      }\r\n\r\n      const newSearch = newParams.toString();\r\n      const basePath = location.split('?')[0];\r\n      const newLocation = newSearch ? `${basePath}?${newSearch}` : basePath;\r\n\r\n      setLocation(newLocation);\r\n      setUrlVersion(v => v + 1); // Force searchParams re-computation\r\n    },\r\n    [searchParams, location, setLocation]\r\n  );\r\n\r\n  /**\r\n   * Navigate to a new path while preserving or replacing query params\r\n   */\r\n  const navigateWithParams = useCallback(\r\n    (path: string, params?: Record<string, string | null>, preserveExisting = false) => {\r\n      const newParams = preserveExisting\r\n        ? new URLSearchParams(searchParams)\r\n        : new URLSearchParams();\r\n\r\n      if (params) {\r\n        for (const [key, value] of Object.entries(params)) {\r\n          if (value === null) {\r\n            newParams.delete(key);\r\n          } else {\r\n            newParams.set(key, value);\r\n          }\r\n        }\r\n      }\r\n\r\n      const newSearch = newParams.toString();\r\n      const newLocation = newSearch ? `${path}?${newSearch}` : path;\r\n\r\n      setLocation(newLocation);\r\n      setUrlVersion(v => v + 1); // Force searchParams re-computation\r\n    },\r\n    [searchParams, setLocation]\r\n  );\r\n\r\n  return {\r\n    // Current state\r\n    searchParams,\r\n    location,\r\n\r\n    // Getters\r\n    getParam,\r\n    getParamAll,\r\n    hasParam,\r\n\r\n    // Setters\r\n    setParam,\r\n    setParams,\r\n    toggleParam,\r\n    clearParams,\r\n\r\n    // Navigation\r\n    navigateWithParams,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// CONVENIENCE HOOKS FOR SPECIFIC USE CASES\r\n// ============================================\r\n\r\n/**\r\n * useHistoryPanelUrl - Manage history panel URL state\r\n */\r\nexport function useHistoryPanelUrl() {\r\n  const { getParam, setParam, hasParam } = useUrlState();\r\n\r\n  const isHistoryOpen = hasParam('view') && getParam('view') === 'history';\r\n  const selectedGenerationId = getParam('generation');\r\n\r\n  const openHistory = useCallback(() => {\r\n    setParam('view', 'history');\r\n  }, [setParam]);\r\n\r\n  const closeHistory = useCallback(() => {\r\n    setParam('view', null);\r\n  }, [setParam]);\r\n\r\n  const selectGeneration = useCallback(\r\n    (id: string | null) => {\r\n      setParam('generation', id);\r\n    },\r\n    [setParam]\r\n  );\r\n\r\n  return {\r\n    isHistoryOpen,\r\n    selectedGenerationId,\r\n    openHistory,\r\n    closeHistory,\r\n    selectGeneration,\r\n  };\r\n}\r\n\r\n/**\r\n * useLibraryTabUrl - Manage library tab URL state\r\n */\r\nexport function useLibraryTabUrl() {\r\n  const { getParam, setParam } = useUrlState();\r\n\r\n  const activeTab = getParam('tab') || 'products';\r\n  const selectedItemId = getParam('item');\r\n\r\n  const setTab = useCallback(\r\n    (tab: string) => {\r\n      setParam('tab', tab);\r\n    },\r\n    [setParam]\r\n  );\r\n\r\n  const selectItem = useCallback(\r\n    (id: string | null) => {\r\n      setParam('item', id);\r\n    },\r\n    [setParam]\r\n  );\r\n\r\n  return {\r\n    activeTab,\r\n    selectedItemId,\r\n    setTab,\r\n    selectItem,\r\n  };\r\n}\r\n\r\n/**\r\n * useSettingsSectionUrl - Manage settings section URL state\r\n */\r\nexport function useSettingsSectionUrl() {\r\n  const { getParam, setParam } = useUrlState();\r\n\r\n  const activeSection = getParam('section') || 'brand';\r\n\r\n  const setSection = useCallback(\r\n    (section: string) => {\r\n      setParam('section', section);\r\n    },\r\n    [setParam]\r\n  );\r\n\r\n  return {\r\n    activeSection,\r\n    setSection,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useVoiceInput.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_err' is defined but never used.","line":154,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * useVoiceInput  Web Speech API voice-to-text hook\r\n *\r\n * Provides real-time speech recognition for the Studio prompt field.\r\n * Uses the browser's SpeechRecognition API (Chrome, Edge, Safari).\r\n *\r\n * Features:\r\n * - Continuous recognition with interim results\r\n * - Auto-stop after silence timeout\r\n * - Language detection (defaults to English)\r\n * - Graceful fallback when API unavailable\r\n */\r\n\r\nimport { useState, useCallback, useRef, useEffect } from 'react';\r\n\r\nexport interface UseVoiceInputOptions {\r\n  /** Language code (default: 'en-US') */\r\n  lang?: string;\r\n  /** Auto-stop after this many ms of silence (default: 3000) */\r\n  silenceTimeoutMs?: number;\r\n  /** Called with each interim/final transcript chunk */\r\n  onTranscript?: (text: string, isFinal: boolean) => void;\r\n}\r\n\r\nexport interface UseVoiceInputReturn {\r\n  /** Whether speech recognition is available in this browser */\r\n  isSupported: boolean;\r\n  /** Whether currently listening */\r\n  isListening: boolean;\r\n  /** Current transcript (interim + final combined) */\r\n  transcript: string;\r\n  /** Start listening */\r\n  startListening: () => void;\r\n  /** Stop listening */\r\n  stopListening: () => void;\r\n  /** Toggle listening on/off */\r\n  toggleListening: () => void;\r\n  /** Clear transcript */\r\n  clearTranscript: () => void;\r\n  /** Error message if recognition failed */\r\n  error: string | null;\r\n}\r\n\r\n// Cross-browser SpeechRecognition\r\nconst SpeechRecognition =\r\n  typeof window !== 'undefined' ? window.SpeechRecognition || window.webkitSpeechRecognition : null;\r\n\r\nexport function useVoiceInput(options: UseVoiceInputOptions = {}): UseVoiceInputReturn {\r\n  const { lang = 'en-US', silenceTimeoutMs = 3000, onTranscript } = options;\r\n\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [transcript, setTranscript] = useState('');\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const recognitionRef = useRef<InstanceType<typeof SpeechRecognition> | null>(null);\r\n  const silenceTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const finalTranscriptRef = useRef('');\r\n\r\n  const isSupported = !!SpeechRecognition;\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (recognitionRef.current) {\r\n        recognitionRef.current.abort();\r\n        recognitionRef.current = null;\r\n      }\r\n      if (silenceTimerRef.current) {\r\n        clearTimeout(silenceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const resetSilenceTimer = useCallback(() => {\r\n    if (silenceTimerRef.current) {\r\n      clearTimeout(silenceTimerRef.current);\r\n    }\r\n    silenceTimerRef.current = setTimeout(() => {\r\n      if (recognitionRef.current && isListening) {\r\n        recognitionRef.current.stop();\r\n      }\r\n    }, silenceTimeoutMs);\r\n  }, [silenceTimeoutMs, isListening]);\r\n\r\n  const startListening = useCallback(() => {\r\n    if (!SpeechRecognition) {\r\n      setError('Speech recognition is not supported in this browser.');\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n\r\n    const recognition = new SpeechRecognition();\r\n    recognition.continuous = true;\r\n    recognition.interimResults = true;\r\n    recognition.lang = lang;\r\n    recognition.maxAlternatives = 1;\r\n\r\n    recognition.onstart = () => {\r\n      setIsListening(true);\r\n      finalTranscriptRef.current = '';\r\n      resetSilenceTimer();\r\n    };\r\n\r\n    recognition.onresult = (event) => {\r\n      resetSilenceTimer();\r\n\r\n      let interimTranscript = '';\r\n      let finalText = '';\r\n\r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        const result = event.results[i];\r\n        if (result.isFinal) {\r\n          finalText += result[0].transcript;\r\n        } else {\r\n          interimTranscript += result[0].transcript;\r\n        }\r\n      }\r\n\r\n      if (finalText) {\r\n        finalTranscriptRef.current += finalText;\r\n        onTranscript?.(finalText, true);\r\n      }\r\n\r\n      const combined = finalTranscriptRef.current + interimTranscript;\r\n      setTranscript(combined);\r\n\r\n      if (interimTranscript) {\r\n        onTranscript?.(interimTranscript, false);\r\n      }\r\n    };\r\n\r\n    recognition.onerror = (event) => {\r\n      // 'no-speech' and 'aborted' are normal  don't treat as errors\r\n      if (event.error === 'no-speech' || event.error === 'aborted') {\r\n        return;\r\n      }\r\n      setError(`Speech recognition error: ${event.error}`);\r\n      setIsListening(false);\r\n    };\r\n\r\n    recognition.onend = () => {\r\n      setIsListening(false);\r\n      if (silenceTimerRef.current) {\r\n        clearTimeout(silenceTimerRef.current);\r\n      }\r\n    };\r\n\r\n    recognitionRef.current = recognition;\r\n\r\n    try {\r\n      recognition.start();\r\n    } catch (_err) {\r\n      setError('Failed to start speech recognition. Please check microphone permissions.');\r\n    }\r\n  }, [lang, onTranscript, resetSilenceTimer]);\r\n\r\n  const stopListening = useCallback(() => {\r\n    if (recognitionRef.current) {\r\n      recognitionRef.current.stop();\r\n      recognitionRef.current = null;\r\n    }\r\n    if (silenceTimerRef.current) {\r\n      clearTimeout(silenceTimerRef.current);\r\n    }\r\n    setIsListening(false);\r\n  }, []);\r\n\r\n  const toggleListening = useCallback(() => {\r\n    if (isListening) {\r\n      stopListening();\r\n    } else {\r\n      startListening();\r\n    }\r\n  }, [isListening, startListening, stopListening]);\r\n\r\n  const clearTranscript = useCallback(() => {\r\n    setTranscript('');\r\n    finalTranscriptRef.current = '';\r\n  }, []);\r\n\r\n  return {\r\n    isSupported,\r\n    isListening,\r\n    transcript,\r\n    startListening,\r\n    stopListening,\r\n    toggleListening,\r\n    clearTranscript,\r\n    error,\r\n  };\r\n}\r\n\r\n/**\r\n * Speak text aloud using the browser's Speech Synthesis API.\r\n * Returns a promise that resolves when speech completes.\r\n */\r\nexport function speakText(text: string, options?: { rate?: number; pitch?: number; lang?: string }): Promise<void> {\r\n  return new Promise((resolve, reject) => {\r\n    if (!('speechSynthesis' in window)) {\r\n      reject(new Error('Speech synthesis not supported'));\r\n      return;\r\n    }\r\n\r\n    // Cancel any ongoing speech\r\n    window.speechSynthesis.cancel();\r\n\r\n    const utterance = new SpeechSynthesisUtterance(text);\r\n    utterance.rate = options?.rate ?? 1.0;\r\n    utterance.pitch = options?.pitch ?? 1.0;\r\n    utterance.lang = options?.lang ?? 'en-US';\r\n\r\n    utterance.onend = () => resolve();\r\n    utterance.onerror = (e) => reject(new Error(`Speech synthesis error: ${e.error}`));\r\n\r\n    window.speechSynthesis.speak(utterance);\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\hooks\\useWeeklyPlan.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\layouts\\StudioLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\__tests__\\queryClient.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9284,9287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9284,9287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9583,9586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9583,9586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10003,10006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10003,10006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10375,10378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10375,10378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10666,10669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10666,10669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":348,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11213,11216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11213,11216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11561,11564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11561,11564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11932,11935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11932,11935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { queryClient, apiRequest, getQueryFn, initializeCsrf, _resetCsrfToken } from '../queryClient';\r\n\r\n// ============================================\r\n// QueryClient Configuration Tests (20 tests)\r\n// ============================================\r\n\r\ndescribe('queryClient', () => {\r\n  describe('configuration', () => {\r\n    it('has correct default staleTime', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.queries?.staleTime).toBe(Infinity);\r\n    });\r\n\r\n    it('has refetchOnWindowFocus disabled', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.queries?.refetchOnWindowFocus).toBe(false);\r\n    });\r\n\r\n    it('has refetchInterval disabled', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.queries?.refetchInterval).toBe(false);\r\n    });\r\n\r\n    it('has retry disabled for queries', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.queries?.retry).toBe(false);\r\n    });\r\n\r\n    it('has retry disabled for mutations', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.mutations?.retry).toBe(false);\r\n    });\r\n\r\n    it('has default queryFn configured', () => {\r\n      const defaultOptions = queryClient.getDefaultOptions();\r\n      expect(defaultOptions.queries?.queryFn).toBeDefined();\r\n    });\r\n\r\n    it('is a valid QueryClient instance', () => {\r\n      expect(queryClient).toBeDefined();\r\n      expect(typeof queryClient.getQueryCache).toBe('function');\r\n      expect(typeof queryClient.getMutationCache).toBe('function');\r\n    });\r\n\r\n    it('can clear cache', () => {\r\n      queryClient.clear();\r\n      const queries = queryClient.getQueryCache().getAll();\r\n      expect(queries).toHaveLength(0);\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// apiRequest Tests (25 tests)\r\n// ============================================\r\n\r\ndescribe('apiRequest', () => {\r\n  let originalFetch: typeof fetch;\r\n\r\n  beforeEach(() => {\r\n    originalFetch = global.fetch;\r\n    _resetCsrfToken(); // Clear cached CSRF token between tests\r\n  });\r\n\r\n  afterEach(() => {\r\n    global.fetch = originalFetch;\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('GET requests', () => {\r\n    it('makes GET request without CSRF token', async () => {\r\n      const mockFetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({ data: 'test' }),\r\n      });\r\n      global.fetch = mockFetch;\r\n\r\n      await apiRequest('GET', '/api/test');\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/test',\r\n        expect.objectContaining({\r\n          method: 'GET',\r\n          credentials: 'include',\r\n        }),\r\n      );\r\n      // GET requests should not have x-csrf-token header\r\n      const callArgs = mockFetch.mock.calls[0];\r\n      expect(callArgs?.[1]?.headers?.['x-csrf-token']).toBeUndefined();\r\n    });\r\n\r\n    it('includes credentials in GET request', async () => {\r\n      const mockFetch = vi.fn().mockResolvedValue({ ok: true });\r\n      global.fetch = mockFetch;\r\n\r\n      await apiRequest('GET', '/api/test');\r\n\r\n      expect(mockFetch).toHaveBeenCalledWith(\r\n        '/api/test',\r\n        expect.objectContaining({\r\n          credentials: 'include',\r\n        }),\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('POST requests', () => {\r\n    beforeEach(() => {\r\n      // Mock CSRF token fetch\r\n      global.fetch = vi\r\n        .fn()\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'test-csrf-token' }),\r\n        })\r\n        .mockResolvedValueOnce({ ok: true });\r\n    });\r\n\r\n    it('fetches CSRF token for POST requests', async () => {\r\n      await apiRequest('POST', '/api/test', { data: 'value' });\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      expect(fetchMock).toHaveBeenCalledWith('/api/csrf-token', expect.any(Object));\r\n    });\r\n\r\n    it('includes Content-Type header when data is provided', async () => {\r\n      await apiRequest('POST', '/api/test', { data: 'value' });\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      const postCall = fetchMock.mock.calls[1];\r\n      expect(postCall?.[1]?.headers?.['Content-Type']).toBe('application/json');\r\n    });\r\n\r\n    it('stringifies body data', async () => {\r\n      const data = { key: 'value' };\r\n      await apiRequest('POST', '/api/test', data);\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      const postCall = fetchMock.mock.calls[1];\r\n      expect(postCall?.[1]?.body).toBe(JSON.stringify(data));\r\n    });\r\n  });\r\n\r\n  describe('error handling', () => {\r\n    it('throws error for non-ok response', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 500,\r\n        statusText: 'Internal Server Error',\r\n        text: () => Promise.resolve('Server error'),\r\n      });\r\n\r\n      await expect(apiRequest('GET', '/api/test')).rejects.toThrow('500: Server error');\r\n    });\r\n\r\n    it('uses statusText when response text is empty', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 404,\r\n        statusText: 'Not Found',\r\n        text: () => Promise.resolve(''),\r\n      });\r\n\r\n      await expect(apiRequest('GET', '/api/test')).rejects.toThrow('404: Not Found');\r\n    });\r\n\r\n    it('retries with fresh CSRF token on 403', async () => {\r\n      const mockFetch = vi\r\n        .fn()\r\n        // First CSRF fetch\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'token1' }),\r\n        })\r\n        // First POST - 403\r\n        .mockResolvedValueOnce({\r\n          ok: false,\r\n          status: 403,\r\n          statusText: 'Forbidden',\r\n          text: () => Promise.resolve('CSRF mismatch'),\r\n        })\r\n        // Refresh CSRF token\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'token2' }),\r\n        })\r\n        // Retry POST - success\r\n        .mockResolvedValueOnce({ ok: true });\r\n\r\n      global.fetch = mockFetch;\r\n\r\n      await apiRequest('POST', '/api/test', { data: 'value' });\r\n\r\n      expect(mockFetch).toHaveBeenCalledTimes(4);\r\n    });\r\n\r\n    it('does not retry GET requests on 403', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 403,\r\n        statusText: 'Forbidden',\r\n        text: () => Promise.resolve('Access denied'),\r\n      });\r\n\r\n      await expect(apiRequest('GET', '/api/test')).rejects.toThrow('403: Access denied');\r\n      expect(global.fetch).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('state-changing methods', () => {\r\n    it('handles PUT requests with CSRF', async () => {\r\n      global.fetch = vi\r\n        .fn()\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'csrf-token' }),\r\n        })\r\n        .mockResolvedValueOnce({ ok: true });\r\n\r\n      await apiRequest('PUT', '/api/test', { data: 'value' });\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      expect(fetchMock.mock.calls[1]?.[1]?.headers?.['x-csrf-token']).toBe('csrf-token');\r\n    });\r\n\r\n    it('handles DELETE requests with CSRF', async () => {\r\n      global.fetch = vi\r\n        .fn()\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'csrf-token' }),\r\n        })\r\n        .mockResolvedValueOnce({ ok: true });\r\n\r\n      await apiRequest('DELETE', '/api/test/123');\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      expect(fetchMock.mock.calls[1]?.[1]?.headers?.['x-csrf-token']).toBe('csrf-token');\r\n    });\r\n\r\n    it('handles PATCH requests with CSRF', async () => {\r\n      global.fetch = vi\r\n        .fn()\r\n        .mockResolvedValueOnce({\r\n          ok: true,\r\n          json: () => Promise.resolve({ csrfToken: 'csrf-token' }),\r\n        })\r\n        .mockResolvedValueOnce({ ok: true });\r\n\r\n      await apiRequest('PATCH', '/api/test', { field: 'updated' });\r\n\r\n      const fetchMock = global.fetch as ReturnType<typeof vi.fn>;\r\n      expect(fetchMock.mock.calls[1]?.[1]?.headers?.['x-csrf-token']).toBe('csrf-token');\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// getQueryFn Tests (15 tests)\r\n// ============================================\r\n\r\ndescribe('getQueryFn', () => {\r\n  let originalFetch: typeof fetch;\r\n\r\n  beforeEach(() => {\r\n    originalFetch = global.fetch;\r\n  });\r\n\r\n  afterEach(() => {\r\n    global.fetch = originalFetch;\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('on401: throw', () => {\r\n    const queryFn = getQueryFn({ on401: 'throw' });\r\n\r\n    it('returns JSON data on success', async () => {\r\n      const mockData = { id: 1, name: 'Test' };\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve(mockData),\r\n      });\r\n\r\n      const result = await queryFn({ queryKey: ['/api', 'users'] } as any);\r\n      expect(result).toEqual(mockData);\r\n    });\r\n\r\n    it('joins queryKey parts for URL', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({}),\r\n      });\r\n\r\n      await queryFn({ queryKey: ['/api', 'users', '123'] } as any);\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith('/api/users/123', expect.any(Object));\r\n    });\r\n\r\n    it('throws on 401 error', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 401,\r\n        statusText: 'Unauthorized',\r\n        text: () => Promise.resolve('Not authenticated'),\r\n      });\r\n\r\n      await expect(queryFn({ queryKey: ['/api', 'protected'] } as any)).rejects.toThrow('401: Not authenticated');\r\n    });\r\n\r\n    it('throws on 500 error', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 500,\r\n        statusText: 'Internal Server Error',\r\n        text: () => Promise.resolve('Server error'),\r\n      });\r\n\r\n      await expect(queryFn({ queryKey: ['/api', 'test'] } as any)).rejects.toThrow('500: Server error');\r\n    });\r\n\r\n    it('includes credentials in request', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve({}),\r\n      });\r\n\r\n      await queryFn({ queryKey: ['/api', 'test'] } as any);\r\n\r\n      expect(global.fetch).toHaveBeenCalledWith(expect.any(String), {\r\n        credentials: 'include',\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('on401: returnNull', () => {\r\n    const queryFn = getQueryFn({ on401: 'returnNull' });\r\n\r\n    it('returns null on 401 error', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 401,\r\n        statusText: 'Unauthorized',\r\n        text: () => Promise.resolve(''),\r\n      });\r\n\r\n      const result = await queryFn({ queryKey: ['/api', 'user'] } as any);\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('still returns data on success', async () => {\r\n      const mockData = { user: 'test' };\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve(mockData),\r\n      });\r\n\r\n      const result = await queryFn({ queryKey: ['/api', 'user'] } as any);\r\n      expect(result).toEqual(mockData);\r\n    });\r\n\r\n    it('still throws on non-401 errors', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 403,\r\n        statusText: 'Forbidden',\r\n        text: () => Promise.resolve('Access denied'),\r\n      });\r\n\r\n      await expect(queryFn({ queryKey: ['/api', 'admin'] } as any)).rejects.toThrow('403: Access denied');\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// initializeCsrf Tests (5 tests)\r\n// ============================================\r\n\r\ndescribe('initializeCsrf', () => {\r\n  let originalFetch: typeof fetch;\r\n  let consoleWarnSpy: ReturnType<typeof vi.spyOn>;\r\n\r\n  beforeEach(() => {\r\n    originalFetch = global.fetch;\r\n    _resetCsrfToken(); // Clear cached CSRF token between tests\r\n    consoleWarnSpy = vi.spyOn(console, 'warn').mockImplementation(() => {});\r\n  });\r\n\r\n  afterEach(() => {\r\n    global.fetch = originalFetch;\r\n    consoleWarnSpy.mockRestore();\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  it('fetches CSRF token on initialization', async () => {\r\n    global.fetch = vi.fn().mockResolvedValue({\r\n      ok: true,\r\n      json: () => Promise.resolve({ csrfToken: 'init-token' }),\r\n    });\r\n\r\n    await initializeCsrf();\r\n\r\n    expect(global.fetch).toHaveBeenCalledWith('/api/csrf-token', expect.any(Object));\r\n  });\r\n\r\n  it('does not throw on CSRF fetch failure', async () => {\r\n    global.fetch = vi.fn().mockRejectedValue(new Error('Network error'));\r\n\r\n    await expect(initializeCsrf()).resolves.not.toThrow();\r\n  });\r\n\r\n  it('logs warning on CSRF fetch failure', async () => {\r\n    global.fetch = vi.fn().mockRejectedValue(new Error('Network error'));\r\n\r\n    await initializeCsrf();\r\n\r\n    expect(consoleWarnSpy).toHaveBeenCalledWith('Failed to initialize CSRF token:', expect.any(Error));\r\n  });\r\n\r\n  it('handles 500 error gracefully', async () => {\r\n    global.fetch = vi.fn().mockResolvedValue({\r\n      ok: false,\r\n      status: 500,\r\n      statusText: 'Internal Server Error',\r\n    });\r\n\r\n    await expect(initializeCsrf()).resolves.not.toThrow();\r\n    expect(consoleWarnSpy).toHaveBeenCalled();\r\n  });\r\n\r\n  it('resolves successfully on valid CSRF response', async () => {\r\n    global.fetch = vi.fn().mockResolvedValue({\r\n      ok: true,\r\n      json: () => Promise.resolve({ csrfToken: 'valid-token' }),\r\n    });\r\n\r\n    await expect(initializeCsrf()).resolves.toBeUndefined();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243,246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243,246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Client-side Analytics  PostHog Integration\r\n *\r\n * Tracks user interactions (generation started, copy generated, template selected, etc.).\r\n * Initialized lazily. No-op if VITE_POSTHOG_API_KEY is not set.\r\n */\r\n\r\nlet posthogInstance: any = null;\r\nlet initialized = false;\r\n\r\n/**\r\n * Initialize PostHog client-side tracking.\r\n * Call once during app initialization.\r\n */\r\nexport async function initAnalytics(): Promise<void> {\r\n  if (initialized) return;\r\n  initialized = true;\r\n\r\n  const apiKey = import.meta.env.VITE_POSTHOG_API_KEY;\r\n  if (!apiKey) return;\r\n\r\n  try {\r\n    const posthog = await import('posthog-js');\r\n    posthog.default.init(apiKey, {\r\n      api_host: import.meta.env.VITE_POSTHOG_HOST || 'https://us.i.posthog.com',\r\n      loaded: (ph) => {\r\n        if (import.meta.env.DEV) {\r\n          ph.opt_out_capturing(); // Don't track in development\r\n        }\r\n      },\r\n      capture_pageview: true,\r\n      capture_pageleave: true,\r\n      autocapture: false, // Manual tracking only\r\n    });\r\n    posthogInstance = posthog.default;\r\n  } catch {\r\n    // posthog-js not installed  analytics disabled\r\n  }\r\n}\r\n\r\n/**\r\n * Identify user after login.\r\n */\r\nexport function identify(userId: string, properties?: Record<string, unknown>): void {\r\n  posthogInstance?.identify(userId, properties);\r\n}\r\n\r\n/**\r\n * Track a custom event.\r\n */\r\nexport function track(event: string, properties?: Record<string, unknown>): void {\r\n  posthogInstance?.capture(event, properties);\r\n}\r\n\r\n/**\r\n * Reset tracking on logout.\r\n */\r\nexport function resetAnalytics(): void {\r\n  posthogInstance?.reset();\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\apiKeyConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\queryClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\sam2.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2659,2662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2659,2662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * SAM2 Browser Inference  Segment Anything Model 2 via ONNX Runtime WebGPU\r\n *\r\n * Architecture:\r\n * - Encoder: Processes image  high-dimensional embeddings (runs once per image)\r\n * - Decoder: Takes embeddings + click points  segmentation masks (runs per interaction)\r\n *\r\n * SAM2 accepts 1024x1024 images and generates 256x256 masks.\r\n * Models are loaded lazily on first use and cached in the browser.\r\n */\r\n\r\nimport * as ort from 'onnxruntime-web';\r\n\r\n// SAM2 hiera-tiny ONNX models (smallest variant, best for browser)\r\n// In production, self-host these on your CDN\r\nconst ENCODER_URL = 'https://storage.googleapis.com/lb-artifacts-testing-public/sam2/sam2_hiera_tiny.encoder.ort';\r\nconst DECODER_URL = 'https://storage.googleapis.com/lb-artifacts-testing-public/sam2/sam2_hiera_tiny.decoder.onnx';\r\n\r\nconst SAM_INPUT_SIZE = 1024;\r\nconst MASK_SIZE = 256;\r\n\r\nexport interface ClickPoint {\r\n  /** x in original image coordinates */\r\n  x: number;\r\n  /** y in original image coordinates */\r\n  y: number;\r\n  /** 1 = positive (include), 0 = negative (exclude) */\r\n  label: 0 | 1;\r\n}\r\n\r\nexport interface SAM2Result {\r\n  /** Raw mask data at 256x256 */\r\n  maskData: Float32Array;\r\n  /** Mask as ImageData at original image dimensions */\r\n  maskImageData: ImageData;\r\n  /** IoU prediction score */\r\n  score: number;\r\n}\r\n\r\ninterface EncoderOutputs {\r\n  imageEmbed: ort.Tensor;\r\n  highResFeats0: ort.Tensor;\r\n  highResFeats1: ort.Tensor;\r\n}\r\n\r\nlet encoderSession: ort.InferenceSession | null = null;\r\nlet decoderSession: ort.InferenceSession | null = null;\r\nlet currentEmbeddings: EncoderOutputs | null = null;\r\nlet isLoading = false;\r\nlet loadError: string | null = null;\r\n\r\n/**\r\n * Check if WebGPU is available, fall back to WASM\r\n */\r\nfunction getExecutionProvider(): string {\r\n  if (typeof navigator !== 'undefined' && 'gpu' in navigator) {\r\n    return 'webgpu';\r\n  }\r\n  return 'wasm';\r\n}\r\n\r\n/**\r\n * Initialize SAM2 models. Call once  models are cached after first load.\r\n */\r\nexport async function initSAM2(onProgress?: (stage: string, pct: number) => void): Promise<void> {\r\n  if (encoderSession && decoderSession) return;\r\n  if (isLoading) return;\r\n\r\n  isLoading = true;\r\n  loadError = null;\r\n\r\n  try {\r\n    const ep = getExecutionProvider();\r\n    onProgress?.('Loading encoder model...', 10);\r\n\r\n    encoderSession = await ort.InferenceSession.create(ENCODER_URL, {\r\n      executionProviders: [ep],\r\n    });\r\n    onProgress?.('Loading decoder model...', 60);\r\n\r\n    decoderSession = await ort.InferenceSession.create(DECODER_URL, {\r\n      executionProviders: [ep],\r\n    });\r\n    onProgress?.('Models ready', 100);\r\n  } catch (err: any) {\r\n    loadError = err.message || 'Failed to load SAM2 models';\r\n    encoderSession = null;\r\n    decoderSession = null;\r\n    throw err;\r\n  } finally {\r\n    isLoading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Encode an image  generates embeddings for subsequent mask predictions.\r\n * Only needs to run once per image.\r\n */\r\nexport async function encodeImage(image: HTMLImageElement | HTMLCanvasElement): Promise<void> {\r\n  if (!encoderSession) {\r\n    throw new Error('SAM2 not initialized. Call initSAM2() first.');\r\n  }\r\n\r\n  // Resize to 1024x1024 and normalize to [-1, 1]\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = SAM_INPUT_SIZE;\r\n  canvas.height = SAM_INPUT_SIZE;\r\n  const ctx = canvas.getContext('2d')!;\r\n  ctx.drawImage(image, 0, 0, SAM_INPUT_SIZE, SAM_INPUT_SIZE);\r\n\r\n  const imageData = ctx.getImageData(0, 0, SAM_INPUT_SIZE, SAM_INPUT_SIZE).data;\r\n  const pixels = SAM_INPUT_SIZE * SAM_INPUT_SIZE;\r\n  const inputArray = new Float32Array(3 * pixels);\r\n\r\n  for (let i = 0; i < pixels; i++) {\r\n    inputArray[i] = (imageData[i * 4]! / 255.0) * 2 - 1; // R\r\n    inputArray[i + pixels] = (imageData[i * 4 + 1]! / 255.0) * 2 - 1; // G\r\n    inputArray[i + 2 * pixels] = (imageData[i * 4 + 2]! / 255.0) * 2 - 1; // B\r\n  }\r\n\r\n  const inputTensor = new ort.Tensor('float32', inputArray, [1, 3, SAM_INPUT_SIZE, SAM_INPUT_SIZE]);\r\n\r\n  const results = await encoderSession.run({ image: inputTensor });\r\n\r\n  currentEmbeddings = {\r\n    imageEmbed: results.image_embed!,\r\n    highResFeats0: results.high_res_feats_0!,\r\n    highResFeats1: results.high_res_feats_1!,\r\n  };\r\n}\r\n\r\n/**\r\n * Predict a segmentation mask from click points.\r\n * Call encodeImage() first.\r\n *\r\n * @param points - Array of click points in ORIGINAL image coordinates\r\n * @param imageWidth - Original image width (for coordinate scaling)\r\n * @param imageHeight - Original image height (for coordinate scaling)\r\n */\r\nexport async function predictMask(points: ClickPoint[], imageWidth: number, imageHeight: number): Promise<SAM2Result> {\r\n  if (!decoderSession || !currentEmbeddings) {\r\n    throw new Error('No image encoded. Call encodeImage() first.');\r\n  }\r\n\r\n  if (points.length === 0) {\r\n    throw new Error('At least one click point is required.');\r\n  }\r\n\r\n  const numPoints = points.length;\r\n\r\n  // Scale points from original image coords  1024x1024 SAM input coords\r\n  const scaleX = SAM_INPUT_SIZE / imageWidth;\r\n  const scaleY = SAM_INPUT_SIZE / imageHeight;\r\n\r\n  const pointCoordsData = new Float32Array(numPoints * 2);\r\n  const pointLabelsData = new Float32Array(numPoints);\r\n\r\n  for (let i = 0; i < numPoints; i++) {\r\n    const pt = points[i]!;\r\n    pointCoordsData[i * 2] = pt.x * scaleX;\r\n    pointCoordsData[i * 2 + 1] = pt.y * scaleY;\r\n    pointLabelsData[i] = pt.label;\r\n  }\r\n\r\n  const feeds: Record<string, ort.Tensor> = {\r\n    image_embed: currentEmbeddings.imageEmbed,\r\n    high_res_feats_0: currentEmbeddings.highResFeats0,\r\n    high_res_feats_1: currentEmbeddings.highResFeats1,\r\n    point_coords: new ort.Tensor('float32', pointCoordsData, [1, numPoints, 2]),\r\n    point_labels: new ort.Tensor('float32', pointLabelsData, [1, numPoints]),\r\n    mask_input: new ort.Tensor('float32', new Float32Array(1 * 1 * MASK_SIZE * MASK_SIZE), [\r\n      1,\r\n      1,\r\n      MASK_SIZE,\r\n      MASK_SIZE,\r\n    ]),\r\n    has_mask_input: new ort.Tensor('float32', new Float32Array([0.0]), [1]),\r\n  };\r\n\r\n  const results = await decoderSession.run(feeds);\r\n\r\n  const masks = results.masks!;\r\n  const maskData = masks.data as Float32Array;\r\n  const iouPredictions = results.iou_predictions!;\r\n  const score = (iouPredictions.data as Float32Array)[0] ?? 0;\r\n\r\n  // Convert 256x256 mask  original image size ImageData\r\n  const maskImageData = scaleMaskToImageData(maskData, MASK_SIZE, MASK_SIZE, imageWidth, imageHeight);\r\n\r\n  return { maskData, maskImageData, score };\r\n}\r\n\r\n/**\r\n * Scale a 256x256 binary mask to original image dimensions as ImageData.\r\n * Positive values  semi-transparent red overlay.\r\n */\r\nfunction scaleMaskToImageData(\r\n  maskData: Float32Array,\r\n  maskW: number,\r\n  maskH: number,\r\n  targetW: number,\r\n  targetH: number,\r\n): ImageData {\r\n  const imgData = new ImageData(targetW, targetH);\r\n  const data = imgData.data;\r\n\r\n  for (let y = 0; y < targetH; y++) {\r\n    for (let x = 0; x < targetW; x++) {\r\n      // Map target pixel  mask pixel (nearest neighbor)\r\n      const mx = Math.floor((x / targetW) * maskW);\r\n      const my = Math.floor((y / targetH) * maskH);\r\n      const maskVal = maskData[my * maskW + mx] ?? 0;\r\n\r\n      const idx = (y * targetW + x) * 4;\r\n\r\n      if (maskVal > 0) {\r\n        // Semi-transparent blue overlay for selected region\r\n        data[idx] = 59; // R\r\n        data[idx + 1] = 130; // G\r\n        data[idx + 2] = 246; // B\r\n        data[idx + 3] = 100; // A (semi-transparent)\r\n      } else {\r\n        data[idx + 3] = 0; // Fully transparent\r\n      }\r\n    }\r\n  }\r\n\r\n  return imgData;\r\n}\r\n\r\n/**\r\n * Convert the current mask to a black-and-white mask image (for sending to AI).\r\n * White = selected region, Black = background.\r\n */\r\nexport function maskToBase64(maskData: Float32Array, imageWidth: number, imageHeight: number): string {\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = imageWidth;\r\n  canvas.height = imageHeight;\r\n  const ctx = canvas.getContext('2d')!;\r\n  const imgData = ctx.createImageData(imageWidth, imageHeight);\r\n  const data = imgData.data;\r\n\r\n  for (let y = 0; y < imageHeight; y++) {\r\n    for (let x = 0; x < imageWidth; x++) {\r\n      const mx = Math.floor((x / imageWidth) * MASK_SIZE);\r\n      const my = Math.floor((y / imageHeight) * MASK_SIZE);\r\n      const val = (maskData[my * MASK_SIZE + mx] ?? 0) > 0 ? 255 : 0;\r\n\r\n      const idx = (y * imageWidth + x) * 4;\r\n      data[idx] = val;\r\n      data[idx + 1] = val;\r\n      data[idx + 2] = val;\r\n      data[idx + 3] = 255;\r\n    }\r\n  }\r\n\r\n  ctx.putImageData(imgData, 0, 0);\r\n  return canvas.toDataURL('image/png').split(',')[1] ?? '';\r\n}\r\n\r\n/**\r\n * Get current loading state.\r\n */\r\nexport function getSAM2Status(): {\r\n  ready: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  hasEmbeddings: boolean;\r\n} {\r\n  return {\r\n    ready: !!encoderSession && !!decoderSession,\r\n    loading: isLoading,\r\n    error: loadError,\r\n    hasEmbeddings: !!currentEmbeddings,\r\n  };\r\n}\r\n\r\n/**\r\n * Clear cached embeddings (call when switching images).\r\n */\r\nexport function clearEmbeddings(): void {\r\n  currentEmbeddings = null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\lib\\webVitals.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":12,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":12,"endColumn":16,"suggestions":[{"fix":{"range":[329,420],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\mocks\\browser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\mocks\\handlers.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\mocks\\handlers.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'body' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":515,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":515,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * MSW API Route Handlers\r\n *\r\n * These handlers mock all API endpoints for frontend testing.\r\n * Handlers return realistic mock data that matches the actual API responses.\r\n */\r\nimport { http, HttpResponse } from 'msw';\r\n\r\n// Mock data\r\nconst mockUsers = [\r\n  { id: '1', email: 'test@example.com', username: 'testuser', createdAt: new Date().toISOString() },\r\n  { id: '2', email: 'demo@example.com', username: 'demouser', createdAt: new Date().toISOString() },\r\n];\r\n\r\nconst mockProducts = [\r\n  {\r\n    id: '1',\r\n    name: 'Test Product 1',\r\n    description: 'A high-quality test product',\r\n    cloudinaryUrl: 'https://res.cloudinary.com/demo/image/upload/sample.jpg',\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: '2',\r\n    name: 'Test Product 2',\r\n    description: 'Another great test product',\r\n    cloudinaryUrl: 'https://res.cloudinary.com/demo/image/upload/sample2.jpg',\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: '3',\r\n    name: 'Premium Widget',\r\n    description: 'Premium quality widget for all your needs',\r\n    cloudinaryUrl: 'https://res.cloudinary.com/demo/image/upload/widget.jpg',\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n];\r\n\r\nconst mockGenerations = [\r\n  {\r\n    id: 'gen-1',\r\n    prompt: 'Create an Instagram ad for Test Product',\r\n    platform: 'instagram',\r\n    resultUrl: 'https://res.cloudinary.com/demo/image/upload/ad1.jpg',\r\n    status: 'completed',\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: 'gen-2',\r\n    prompt: 'Create a Facebook ad',\r\n    platform: 'facebook',\r\n    resultUrl: 'https://res.cloudinary.com/demo/image/upload/ad2.jpg',\r\n    status: 'completed',\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n];\r\n\r\nconst mockTemplates = [\r\n  {\r\n    id: 'tpl-1',\r\n    name: 'Instagram Story Template',\r\n    platform: 'instagram',\r\n    category: 'story',\r\n    preview: 'https://res.cloudinary.com/demo/image/upload/template1.jpg',\r\n  },\r\n  {\r\n    id: 'tpl-2',\r\n    name: 'Facebook Feed Template',\r\n    platform: 'facebook',\r\n    category: 'feed',\r\n    preview: 'https://res.cloudinary.com/demo/image/upload/template2.jpg',\r\n  },\r\n];\r\n\r\nconst mockJobs: Record<string, { id: string; status: string; progress?: number; result?: unknown }> = {\r\n  'job-123': { id: 'job-123', status: 'processing', progress: 50 },\r\n  'completed-job': {\r\n    id: 'completed-job',\r\n    status: 'completed',\r\n    result: {\r\n      url: 'https://res.cloudinary.com/demo/image/upload/result.jpg',\r\n      generationId: 'gen-3',\r\n    },\r\n  },\r\n  'new-job': { id: 'new-job', status: 'pending', progress: 0 },\r\n};\r\n\r\nconst mockCopy = [\r\n  {\r\n    id: 'copy-1',\r\n    productName: 'Test Product',\r\n    platform: 'instagram',\r\n    headline: 'Transform Your Space',\r\n    body: 'Discover the perfect solution for your home.',\r\n    callToAction: 'Shop Now',\r\n    variations: [\r\n      { headline: 'Transform Your Space', body: 'Discover the perfect solution.' },\r\n      { headline: 'Elevate Your Home', body: 'Find your perfect match today.' },\r\n    ],\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n];\r\n\r\nexport const handlers = [\r\n  // ============ CSRF Token Endpoint ============\r\n  http.get('/api/csrf-token', () => {\r\n    return HttpResponse.json({ csrfToken: 'test-csrf-token' });\r\n  }),\r\n\r\n  // ============ Auth Endpoints ============\r\n  http.post('/api/auth/login', async ({ request }) => {\r\n    const body = (await request.json()) as { email: string; password: string };\r\n\r\n    if (body.password === 'wrong') {\r\n      return HttpResponse.json({ error: 'Invalid credentials' }, { status: 401 });\r\n    }\r\n\r\n    const user = mockUsers.find((u) => u.email === body.email) || {\r\n      id: '1',\r\n      email: body.email,\r\n      username: body.email.split('@')[0],\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    return HttpResponse.json(user);\r\n  }),\r\n\r\n  http.post('/api/auth/register', async ({ request }) => {\r\n    const body = (await request.json()) as { email: string; password: string; username: string };\r\n\r\n    const newUser = {\r\n      id: String(mockUsers.length + 1),\r\n      email: body.email,\r\n      username: body.username,\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    return HttpResponse.json(newUser, { status: 201 });\r\n  }),\r\n\r\n  http.post('/api/auth/logout', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  http.get('/api/auth/me', () => {\r\n    return HttpResponse.json(mockUsers[0]);\r\n  }),\r\n\r\n  http.get('/api/auth/demo', () => {\r\n    return HttpResponse.json(mockUsers[1]);\r\n  }),\r\n\r\n  // ============ Products Endpoints ============\r\n  http.get('/api/products', () => {\r\n    return HttpResponse.json(mockProducts);\r\n  }),\r\n\r\n  http.get('/api/products/:id', ({ params }) => {\r\n    const product = mockProducts.find((p) => p.id === params.id);\r\n    if (!product) {\r\n      return HttpResponse.json({ error: 'Product not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(product);\r\n  }),\r\n\r\n  http.post('/api/products', async ({ request }) => {\r\n    const formData = await request.formData();\r\n    const name = formData.get('name') as string;\r\n    const description = formData.get('description') as string;\r\n\r\n    const newProduct = {\r\n      id: String(mockProducts.length + 1),\r\n      name: name || 'New Product',\r\n      description: description || '',\r\n      cloudinaryUrl: 'https://res.cloudinary.com/demo/image/upload/new.jpg',\r\n      createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    return HttpResponse.json(newProduct, { status: 201 });\r\n  }),\r\n\r\n  http.delete('/api/products/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  http.delete('/api/products', () => {\r\n    return HttpResponse.json({ success: true, deleted: 0 });\r\n  }),\r\n\r\n  // ============ Generations Endpoints ============\r\n  http.get('/api/generations', () => {\r\n    return HttpResponse.json(mockGenerations);\r\n  }),\r\n\r\n  http.get('/api/generations/:id', ({ params }) => {\r\n    const generation = mockGenerations.find((g) => g.id === params.id);\r\n    if (!generation) {\r\n      return HttpResponse.json({ error: 'Generation not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(generation);\r\n  }),\r\n\r\n  http.get('/api/generations/:id/history', () => {\r\n    return HttpResponse.json([\r\n      { id: 'edit-1', action: 'color', timestamp: new Date().toISOString() },\r\n      { id: 'edit-2', action: 'brightness', timestamp: new Date().toISOString() },\r\n    ]);\r\n  }),\r\n\r\n  http.post('/api/generations/:id/edit', async () => {\r\n    return HttpResponse.json({\r\n      jobId: `job-${Date.now()}`,\r\n      status: 'processing',\r\n    });\r\n  }),\r\n\r\n  http.delete('/api/generations/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  http.post('/api/generations/:id/analyze', () => {\r\n    return HttpResponse.json({\r\n      success: true,\r\n      analysis: {\r\n        colors: ['#FF5733', '#33FF57'],\r\n        composition: 'balanced',\r\n        quality: 'high',\r\n      },\r\n    });\r\n  }),\r\n\r\n  // ============ Idea Bank Endpoints ============\r\n  http.post('/api/idea-bank/suggest', async () => {\r\n    return HttpResponse.json({\r\n      suggestions: [\r\n        {\r\n          id: 'suggestion-1',\r\n          title: 'Summer Sale Campaign',\r\n          description: 'Bright, energetic campaign for summer products',\r\n          confidence: 0.92,\r\n        },\r\n        {\r\n          id: 'suggestion-2',\r\n          title: 'Minimalist Product Showcase',\r\n          description: 'Clean, modern aesthetic focusing on product details',\r\n          confidence: 0.88,\r\n        },\r\n      ],\r\n      metadata: {\r\n        generatedAt: new Date().toISOString(),\r\n        productsAnalyzed: 2,\r\n      },\r\n    });\r\n  }),\r\n\r\n  http.get('/api/idea-bank/templates/:productId', () => {\r\n    return HttpResponse.json([\r\n      { id: 'template-1', name: 'Product Hero', category: 'hero' },\r\n      { id: 'template-2', name: 'Lifestyle Shot', category: 'lifestyle' },\r\n    ]);\r\n  }),\r\n\r\n  // ============ Jobs Endpoints ============\r\n  http.get('/api/jobs/:jobId', ({ params }) => {\r\n    const jobId = params.jobId as string;\r\n    const job = mockJobs[jobId] || {\r\n      id: jobId,\r\n      status: 'pending',\r\n      progress: 0,\r\n    };\r\n    return HttpResponse.json(job);\r\n  }),\r\n\r\n  // ============ Health Endpoints ============\r\n  http.get('/api/health', () => {\r\n    return HttpResponse.json({ status: 'ok', timestamp: new Date().toISOString() });\r\n  }),\r\n\r\n  http.get('/api/health/live', () => {\r\n    return HttpResponse.json({ status: 'ok' });\r\n  }),\r\n\r\n  http.get('/api/health/ready', () => {\r\n    return HttpResponse.json({ status: 'ok', database: 'connected', cache: 'connected' });\r\n  }),\r\n\r\n  // ============ Transform Endpoint ============\r\n  http.post('/api/transform', async () => {\r\n    return HttpResponse.json({\r\n      jobId: `job-${Date.now()}`,\r\n      status: 'processing',\r\n      message: 'Generation started',\r\n    });\r\n  }),\r\n\r\n  // ============ Templates Endpoints ============\r\n  http.get('/api/templates', () => {\r\n    return HttpResponse.json(mockTemplates);\r\n  }),\r\n\r\n  http.get('/api/templates/:id', ({ params }) => {\r\n    const template = mockTemplates.find((t) => t.id === params.id);\r\n    if (!template) {\r\n      return HttpResponse.json({ error: 'Template not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(template);\r\n  }),\r\n\r\n  http.get('/api/templates/search', ({ request }) => {\r\n    const url = new URL(request.url);\r\n    const query = url.searchParams.get('q') || '';\r\n    const filtered = mockTemplates.filter(\r\n      (t) =>\r\n        t.name.toLowerCase().includes(query.toLowerCase()) || t.category.toLowerCase().includes(query.toLowerCase()),\r\n    );\r\n    return HttpResponse.json(filtered);\r\n  }),\r\n\r\n  http.post('/api/templates', async ({ request }) => {\r\n    const body = (await request.json()) as { name: string; platform: string; category: string };\r\n    const newTemplate = {\r\n      id: `tpl-${Date.now()}`,\r\n      name: body.name,\r\n      platform: body.platform,\r\n      category: body.category,\r\n      preview: 'https://res.cloudinary.com/demo/image/upload/new-template.jpg',\r\n    };\r\n    return HttpResponse.json(newTemplate, { status: 201 });\r\n  }),\r\n\r\n  http.patch('/api/templates/:id', async ({ params, request }) => {\r\n    const body = (await request.json()) as Partial<{ name: string; platform: string; category: string }>;\r\n    const template = mockTemplates.find((t) => t.id === params.id);\r\n    if (!template) {\r\n      return HttpResponse.json({ error: 'Template not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json({ ...template, ...body });\r\n  }),\r\n\r\n  http.delete('/api/templates/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // ============ Copywriting Endpoints ============\r\n  http.post('/api/copy/generate', async () => {\r\n    return HttpResponse.json({\r\n      variations: [\r\n        {\r\n          headline: 'Transform Your Space Today',\r\n          body: 'Discover premium quality products designed for modern living.',\r\n          callToAction: 'Shop Now',\r\n          score: 0.95,\r\n        },\r\n        {\r\n          headline: 'Elevate Your Home',\r\n          body: 'Find the perfect addition to your space.',\r\n          callToAction: 'Learn More',\r\n          score: 0.88,\r\n        },\r\n        {\r\n          headline: 'Quality You Can Trust',\r\n          body: 'Built to last, designed to impress.',\r\n          callToAction: 'Get Started',\r\n          score: 0.85,\r\n        },\r\n      ],\r\n      metadata: {\r\n        platform: 'instagram',\r\n        objective: 'awareness',\r\n        generatedAt: new Date().toISOString(),\r\n      },\r\n    });\r\n  }),\r\n\r\n  http.get('/api/copy/generation/:generationId', () => {\r\n    return HttpResponse.json(mockCopy);\r\n  }),\r\n\r\n  http.get('/api/copy/:id', ({ params }) => {\r\n    const copy = mockCopy.find((c) => c.id === params.id);\r\n    if (!copy) {\r\n      return HttpResponse.json({ error: 'Copy not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(copy);\r\n  }),\r\n\r\n  http.delete('/api/copy/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  http.post('/api/copywriting/standalone', async () => {\r\n    return HttpResponse.json({\r\n      copy: {\r\n        headline: 'Standalone Copy Headline',\r\n        body: 'This is standalone copy generation.',\r\n        callToAction: 'Act Now',\r\n      },\r\n      score: 0.9,\r\n    });\r\n  }),\r\n\r\n  // ============ Ad Templates Endpoints ============\r\n  http.get('/api/ad-templates/categories', () => {\r\n    return HttpResponse.json(['hero', 'lifestyle', 'product', 'seasonal', 'promotional']);\r\n  }),\r\n\r\n  http.get('/api/ad-templates', () => {\r\n    return HttpResponse.json(mockTemplates);\r\n  }),\r\n\r\n  http.get('/api/ad-templates/:id', ({ params }) => {\r\n    const template = mockTemplates.find((t) => t.id === params.id);\r\n    if (!template) {\r\n      return HttpResponse.json({ error: 'Template not found' }, { status: 404 });\r\n    }\r\n    return HttpResponse.json(template);\r\n  }),\r\n\r\n  // ============ Prompt Templates Endpoints ============\r\n  http.get('/api/prompt-templates', () => {\r\n    return HttpResponse.json([\r\n      { id: 'pt-1', name: 'Product Showcase', template: 'Create an ad showcasing {product}' },\r\n      { id: 'pt-2', name: 'Seasonal Sale', template: 'Design a {season} sale banner for {product}' },\r\n    ]);\r\n  }),\r\n\r\n  http.post('/api/prompt-templates', async ({ request }) => {\r\n    const body = (await request.json()) as { name: string; template: string };\r\n    return HttpResponse.json(\r\n      {\r\n        id: `pt-${Date.now()}`,\r\n        name: body.name,\r\n        template: body.template,\r\n      },\r\n      { status: 201 },\r\n    );\r\n  }),\r\n\r\n  http.delete('/api/prompt-templates/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // ============ User Settings Endpoints ============\r\n  http.put('/api/user/brand-voice', async ({ request }) => {\r\n    const body = (await request.json()) as { brandVoice: string };\r\n    return HttpResponse.json({\r\n      success: true,\r\n      brandVoice: body.brandVoice,\r\n    });\r\n  }),\r\n\r\n  // ============ Brand Profile Endpoints ============\r\n  http.get('/api/brand-profile', () => {\r\n    return HttpResponse.json({\r\n      id: 'brand-1',\r\n      name: 'Test Brand',\r\n      description: 'A test brand for development',\r\n      colors: ['#FF5733', '#33FF57', '#3357FF'],\r\n      fonts: ['Inter', 'Roboto'],\r\n    });\r\n  }),\r\n\r\n  http.put('/api/brand-profile', async ({ request }) => {\r\n    const body = (await request.json()) as Record<string, unknown>;\r\n    return HttpResponse.json({\r\n      id: 'brand-1',\r\n      ...body,\r\n      updatedAt: new Date().toISOString(),\r\n    });\r\n  }),\r\n\r\n  http.delete('/api/brand-profile', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // ============ Quota Endpoints ============\r\n  http.get('/api/quota/status', () => {\r\n    return HttpResponse.json({\r\n      used: 150,\r\n      limit: 1000,\r\n      remaining: 850,\r\n      resetAt: new Date(Date.now() + 86400000).toISOString(),\r\n    });\r\n  }),\r\n\r\n  http.get('/api/quota/history', () => {\r\n    return HttpResponse.json([\r\n      { date: '2025-01-26', used: 50 },\r\n      { date: '2025-01-25', used: 75 },\r\n      { date: '2025-01-24', used: 30 },\r\n    ]);\r\n  }),\r\n\r\n  // ============ Pricing Endpoints ============\r\n  http.get('/api/pricing/estimate', ({ request }) => {\r\n    const url = new URL(request.url);\r\n    const count = parseInt(url.searchParams.get('count') || '1');\r\n    return HttpResponse.json({\r\n      count,\r\n      estimatedCost: count * 0.05,\r\n      currency: 'USD',\r\n    });\r\n  }),\r\n\r\n  // ============ Settings Endpoints ============\r\n  http.get('/api/settings/api-keys', () => {\r\n    return HttpResponse.json({\r\n      gemini: { configured: true, lastUsed: new Date().toISOString() },\r\n      cloudinary: { configured: true, lastUsed: new Date().toISOString() },\r\n      openai: { configured: false },\r\n    });\r\n  }),\r\n\r\n  http.post('/api/settings/api-keys/:service', async ({ params, request }) => {\r\n    const body = (await request.json()) as { apiKey: string };\r\n    return HttpResponse.json({\r\n      service: params.service,\r\n      configured: true,\r\n      message: `API key for ${params.service} saved successfully`,\r\n    });\r\n  }),\r\n\r\n  http.delete('/api/settings/api-keys/:service', ({ params }) => {\r\n    return HttpResponse.json({\r\n      service: params.service,\r\n      configured: false,\r\n      message: `API key for ${params.service} removed`,\r\n    });\r\n  }),\r\n\r\n  http.post('/api/settings/api-keys/:service/validate', async ({ params }) => {\r\n    return HttpResponse.json({\r\n      service: params.service,\r\n      valid: true,\r\n      message: 'API key is valid',\r\n    });\r\n  }),\r\n\r\n  // ============ Image Analysis Endpoint ============\r\n  http.post('/api/analyze-image', async () => {\r\n    return HttpResponse.json({\r\n      success: true,\r\n      analysis: {\r\n        objects: ['product', 'background'],\r\n        colors: ['#FF5733', '#FFFFFF'],\r\n        style: 'modern',\r\n        suggestions: ['Add more contrast', 'Consider cropping'],\r\n      },\r\n    });\r\n  }),\r\n\r\n  // ============ Installation Scenarios Endpoints ============\r\n  http.get('/api/installation-scenarios', () => {\r\n    return HttpResponse.json([\r\n      { id: 'is-1', name: 'Living Room Setup', roomType: 'living_room' },\r\n      { id: 'is-2', name: 'Kitchen Installation', roomType: 'kitchen' },\r\n    ]);\r\n  }),\r\n\r\n  http.get('/api/installation-scenarios/:id', ({ params }) => {\r\n    return HttpResponse.json({\r\n      id: params.id,\r\n      name: 'Sample Scenario',\r\n      roomType: 'living_room',\r\n      steps: ['Step 1', 'Step 2', 'Step 3'],\r\n    });\r\n  }),\r\n\r\n  // ============ Brand Images Endpoints ============\r\n  http.get('/api/brand-images', () => {\r\n    return HttpResponse.json([\r\n      { id: 'bi-1', url: 'https://example.com/brand1.jpg', category: 'logo' },\r\n      { id: 'bi-2', url: 'https://example.com/brand2.jpg', category: 'banner' },\r\n    ]);\r\n  }),\r\n\r\n  // ============ Performing Ad Templates Endpoints ============\r\n  http.get('/api/performing-ad-templates', () => {\r\n    return HttpResponse.json([\r\n      { id: 'pat-1', name: 'High CTR Template', performance: 0.95 },\r\n      { id: 'pat-2', name: 'Best Converter', performance: 0.88 },\r\n    ]);\r\n  }),\r\n\r\n  http.get('/api/performing-ad-templates/featured', () => {\r\n    return HttpResponse.json([{ id: 'pat-1', name: 'Featured Template', performance: 0.95 }]);\r\n  }),\r\n\r\n  http.get('/api/performing-ad-templates/top', () => {\r\n    return HttpResponse.json([{ id: 'pat-1', name: 'Top Performer', performance: 0.98 }]);\r\n  }),\r\n\r\n  // ============ Content Planner Endpoints ============\r\n  http.get('/api/content-planner/templates', () => {\r\n    return HttpResponse.json([\r\n      { id: 'cp-1', name: 'Weekly Post Plan', frequency: 'weekly' },\r\n      { id: 'cp-2', name: 'Daily Stories', frequency: 'daily' },\r\n    ]);\r\n  }),\r\n\r\n  http.get('/api/content-planner/posts', () => {\r\n    return HttpResponse.json([\r\n      { id: 'post-1', scheduledFor: new Date().toISOString(), status: 'scheduled' },\r\n      { id: 'post-2', scheduledFor: new Date().toISOString(), status: 'draft' },\r\n    ]);\r\n  }),\r\n\r\n  http.post('/api/content-planner/posts', async ({ request }) => {\r\n    const body = (await request.json()) as Record<string, unknown>;\r\n    return HttpResponse.json(\r\n      {\r\n        id: `post-${Date.now()}`,\r\n        ...body,\r\n        status: 'draft',\r\n        createdAt: new Date().toISOString(),\r\n      },\r\n      { status: 201 },\r\n    );\r\n  }),\r\n\r\n  http.delete('/api/content-planner/posts/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  // Carousel outline generation endpoint\r\n  http.post('/api/content-planner/carousel-outline', async ({ request }) => {\r\n    const body = (await request.json()) as {\r\n      templateId: string;\r\n      topic: string;\r\n      slideCount?: number;\r\n      platform: string;\r\n      productNames?: string[];\r\n    };\r\n\r\n    const slideCount = body.slideCount || 7;\r\n\r\n    return HttpResponse.json({\r\n      outline: {\r\n        title: `Carousel: ${body.topic}`,\r\n        description: `A ${slideCount}-slide carousel about ${body.topic}`,\r\n        slideCount,\r\n        slides: [\r\n          {\r\n            slideNumber: 1,\r\n            purpose: 'hook',\r\n            headline: 'Attention-Grabbing Hook',\r\n            body: 'This is the hook slide body text',\r\n            imagePrompt: 'Create an eye-catching visual for the hook',\r\n          },\r\n          {\r\n            slideNumber: 2,\r\n            purpose: 'problem',\r\n            headline: 'The Problem You Face',\r\n            body: 'Describing the pain point',\r\n            imagePrompt: 'Visualize the problem scenario',\r\n          },\r\n          {\r\n            slideNumber: 3,\r\n            purpose: 'point',\r\n            headline: 'Key Point One',\r\n            body: 'Supporting information',\r\n            imagePrompt: 'Illustrate the first key point',\r\n          },\r\n          {\r\n            slideNumber: 4,\r\n            purpose: 'point',\r\n            headline: 'Key Point Two',\r\n            body: 'More supporting information',\r\n            imagePrompt: 'Illustrate the second key point',\r\n          },\r\n          {\r\n            slideNumber: 5,\r\n            purpose: 'solution',\r\n            headline: 'The Solution',\r\n            body: 'How we solve the problem',\r\n            imagePrompt: 'Show the solution in action',\r\n          },\r\n          {\r\n            slideNumber: 6,\r\n            purpose: 'proof',\r\n            headline: 'Social Proof',\r\n            body: 'Testimonials and results',\r\n            imagePrompt: 'Display proof and credibility',\r\n          },\r\n          {\r\n            slideNumber: 7,\r\n            purpose: 'cta',\r\n            headline: 'Take Action Now',\r\n            body: 'Call to action details',\r\n            imagePrompt: 'Create a compelling CTA visual',\r\n          },\r\n        ].slice(0, slideCount),\r\n        captionCopy: `Check out this carousel about ${body.topic}! Perfect for your social media.`,\r\n        hashtags: ['marketing', 'carousel', 'social', body.platform],\r\n      },\r\n    });\r\n  }),\r\n\r\n  // ============ Learned Patterns Endpoints ============\r\n  http.get('/api/learned-patterns', () => {\r\n    return HttpResponse.json([\r\n      { id: 'lp-1', name: 'Color Scheme Pattern', category: 'color' },\r\n      { id: 'lp-2', name: 'Layout Pattern', category: 'layout' },\r\n    ]);\r\n  }),\r\n\r\n  http.get('/api/learned-patterns/:patternId', ({ params }) => {\r\n    return HttpResponse.json({\r\n      id: params.patternId,\r\n      name: 'Sample Pattern',\r\n      category: 'general',\r\n      data: { key: 'value' },\r\n    });\r\n  }),\r\n\r\n  // ============ Monitoring Endpoints ============\r\n  http.get('/api/monitoring/health', () => {\r\n    return HttpResponse.json({\r\n      status: 'healthy',\r\n      uptime: 86400,\r\n      services: { database: 'up', cache: 'up', ai: 'up' },\r\n    });\r\n  }),\r\n\r\n  http.get('/api/monitoring/performance', () => {\r\n    return HttpResponse.json({\r\n      avgResponseTime: 150,\r\n      requestsPerMinute: 45,\r\n      errorRate: 0.02,\r\n    });\r\n  }),\r\n\r\n  http.get('/api/monitoring/system', () => {\r\n    return HttpResponse.json({\r\n      cpu: 35,\r\n      memory: 60,\r\n      disk: 45,\r\n    });\r\n  }),\r\n\r\n  // ============ Social Accounts Endpoints ============\r\n  http.get('/api/social/accounts', () => {\r\n    return HttpResponse.json([\r\n      { id: 'sa-1', platform: 'instagram', username: '@testbrand', connected: true },\r\n      { id: 'sa-2', platform: 'facebook', username: 'Test Brand Page', connected: true },\r\n    ]);\r\n  }),\r\n\r\n  http.delete('/api/social/accounts/:id', () => {\r\n    return HttpResponse.json({ success: true });\r\n  }),\r\n\r\n  http.post('/api/social/sync-accounts', async () => {\r\n    return HttpResponse.json({\r\n      success: true,\r\n      synced: 2,\r\n      accounts: [\r\n        { id: 'sa-1', platform: 'instagram', synced: true },\r\n        { id: 'sa-2', platform: 'facebook', synced: true },\r\n      ],\r\n    });\r\n  }),\r\n];\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\mocks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\mocks\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\ApiKeySettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1988,1991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1988,1991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6198,6201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6198,6201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { ArrowLeft, KeyRound, ShieldCheck, Info, Webhook } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Header } from '@/components/layout/Header';\nimport { ApiKeyCard, type ApiKeyInfo } from '@/components/settings/ApiKeyCard';\nimport { ApiKeyForm } from '@/components/settings/ApiKeyForm';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { SUPPORTED_SERVICES } from '@/lib/apiKeyConfig';\n\ninterface ApiKeysResponse {\n  keys: ApiKeyInfo[];\n}\n\ninterface ApiKeySettingsProps {\n  embedded?: boolean;\n}\n\nexport default function ApiKeySettings({ embedded = false }: ApiKeySettingsProps) {\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Form state\n  const [editingService, setEditingService] = useState<string | null>(null);\n  const [validatingService, setValidatingService] = useState<string | null>(null);\n  const [deletingService, setDeletingService] = useState<string | null>(null);\n  const [formError, setFormError] = useState<string | null>(null);\n  const [formSuccess, setFormSuccess] = useState(false);\n\n  // n8n Configuration state (Phase 8.1)\n  const [n8nConfig, setN8nConfig] = useState({ baseUrl: '', apiKey: '' });\n  const [savingN8n, setSavingN8n] = useState(false);\n\n  // Fetch all API keys status\n  const {\n    data: keysData,\n    isLoading,\n    error,\n  } = useQuery<ApiKeysResponse>({\n    queryKey: ['/api/settings/api-keys'],\n    refetchOnWindowFocus: true,\n  });\n\n  // Fetch n8n configuration (Phase 8.1)\n  const { data: n8nData } = useQuery({\n    queryKey: ['/api/settings/n8n'],\n    refetchOnWindowFocus: true,\n    onSuccess: (data: any) => {\n      if (data?.configured) {\n        setN8nConfig({\n          baseUrl: data.baseUrl || '',\n          apiKey: '', // Never populate from API for security\n        });\n      }\n    },\n  });\n\n  // Save API key mutation\n  const saveMutation = useMutation({\n    mutationFn: async ({ service, data }: { service: string; data: Record<string, string> }) => {\n      const response = await apiRequest('POST', `/api/settings/api-keys/${service}`, data);\n      return response.json();\n    },\n    onSuccess: (data, variables) => {\n      setFormSuccess(true);\n      setFormError(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/api-keys'] });\n      toast({\n        title: 'API Key Saved',\n        description: `Your ${variables.service} API key has been saved and validated.`,\n      });\n      // Close dialog after a brief delay to show success\n      setTimeout(() => {\n        setEditingService(null);\n        setFormSuccess(false);\n      }, 1500);\n    },\n    onError: (error: Error) => {\n      setFormError(error.message);\n      setFormSuccess(false);\n    },\n  });\n\n  // Validate API key mutation\n  const validateMutation = useMutation({\n    mutationFn: async (service: string) => {\n      setValidatingService(service);\n      const response = await apiRequest('POST', `/api/settings/api-keys/${service}/validate`, {});\n      return response.json();\n    },\n    onSuccess: (data, service) => {\n      setValidatingService(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/api-keys'] });\n      if (data.isValid) {\n        toast({\n          title: 'Key Valid',\n          description: `Your ${service} API key is working correctly.`,\n        });\n      } else {\n        toast({\n          title: 'Key Invalid',\n          description: data.error || `Your ${service} API key is no longer valid.`,\n          variant: 'destructive',\n        });\n      }\n    },\n    onError: (error: Error, _service) => {\n      setValidatingService(null);\n      toast({\n        title: 'Validation Failed',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Delete API key mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (service: string) => {\n      setDeletingService(service);\n      const response = await apiRequest('DELETE', `/api/settings/api-keys/${service}`);\n      return response.json();\n    },\n    onSuccess: (data, service) => {\n      setDeletingService(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/api-keys'] });\n      toast({\n        title: 'Key Removed',\n        description: `Your custom ${service} API key has been removed.`,\n      });\n    },\n    onError: (error: Error, _service) => {\n      setDeletingService(null);\n      toast({\n        title: 'Deletion Failed',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleEdit = (service: string) => {\n    setFormError(null);\n    setFormSuccess(false);\n    setEditingService(service);\n  };\n\n  const handleSave = async (service: string, data: Record<string, string>) => {\n    setFormError(null);\n    setFormSuccess(false);\n    await saveMutation.mutateAsync({ service, data });\n  };\n\n  const handleCloseForm = () => {\n    setEditingService(null);\n    setFormError(null);\n    setFormSuccess(false);\n  };\n\n  // Handle n8n configuration save (Phase 8.1)\n  const saveN8nConfig = async () => {\n    if (!n8nConfig.baseUrl) {\n      toast({\n        title: 'Validation Error',\n        description: 'n8n instance URL is required',\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    setSavingN8n(true);\n    try {\n      const response = await apiRequest('POST', '/api/settings/n8n', n8nConfig);\n      const data = await response.json();\n\n      if (data.success) {\n        toast({\n          title: 'n8n Configuration Saved',\n          description: 'Your n8n configuration has been saved securely',\n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/settings/n8n'] });\n        setN8nConfig({ ...n8nConfig, apiKey: '' }); // Clear API key field after save\n      } else {\n        throw new Error(data.error || 'Failed to save n8n configuration');\n      }\n    } catch (error: any) {\n      toast({\n        title: 'Save Failed',\n        description: error.message || 'Failed to save n8n configuration',\n        variant: 'destructive',\n      });\n    } finally {\n      setSavingN8n(false);\n    }\n  };\n\n  // Build keys map for easy lookup\n  const keysMap = new Map<string, ApiKeyInfo>();\n  keysData?.keys.forEach((key) => keysMap.set(key.service, key));\n\n  // Create default key info for services not returned by API\n  const getKeyInfo = (service: string): ApiKeyInfo => {\n    return (\n      keysMap.get(service) || {\n        service,\n        configured: false,\n        source: null,\n        keyPreview: null,\n        isValid: null,\n        lastValidated: null,\n      }\n    );\n  };\n\n  const editingKeyInfo = editingService ? getKeyInfo(editingService) : null;\n\n  // Content shared between embedded and standalone modes\n  const content = (\n    <>\n      {/* Security Notice */}\n      <Alert className=\"mb-8\">\n        <ShieldCheck className=\"h-4 w-4\" />\n        <AlertTitle>Security</AlertTitle>\n        <AlertDescription>\n          Your API keys are encrypted with AES-256-GCM before storage. Keys are never logged or exposed in API responses\n          after saving.\n        </AlertDescription>\n      </Alert>\n\n      {/* Error State */}\n      {error && (\n        <Alert variant=\"destructive\" className=\"mb-6\">\n          <Info className=\"h-4 w-4\" />\n          <AlertTitle>Error Loading Keys</AlertTitle>\n          <AlertDescription>\n            {error instanceof Error ? error.message : 'Failed to load API keys. Please try again.'}\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Loading State */}\n      {isLoading && (\n        <div\n          className=\"grid gap-4 md:grid-cols-2\"\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-busy=\"true\"\n          aria-label=\"Loading API keys\"\n        >\n          {SUPPORTED_SERVICES.map((service) => (\n            <div key={service} className=\"rounded-xl border bg-card p-6\">\n              <div className=\"flex items-center gap-3 mb-4\">\n                <Skeleton className=\"h-10 w-10 rounded-lg\" />\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-4 w-32\" />\n                  <Skeleton className=\"h-3 w-48\" />\n                </div>\n              </div>\n              <Skeleton className=\"h-9 w-full\" />\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* API Key Cards */}\n      {!isLoading && !error && (\n        <div className=\"grid gap-4 lg:grid-cols-2\">\n          {SUPPORTED_SERVICES.map((service) => (\n            <ApiKeyCard\n              key={service}\n              keyInfo={getKeyInfo(service)}\n              onEdit={() => handleEdit(service)}\n              onDelete={() => deleteMutation.mutate(service)}\n              onValidate={() => validateMutation.mutate(service)}\n              isValidating={validatingService === service}\n              isDeleting={deletingService === service}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* n8n Configuration - Phase 8.1 */}\n      <div className=\"mt-8 p-6 rounded-xl border bg-card\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Webhook className=\"w-5 h-5 text-primary\" />\n          <h2 className=\"text-lg font-semibold\">n8n Automation</h2>\n        </div>\n\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Configure your n8n instance for multi-platform social media posting. OAuth credentials are managed within n8n.\n        </p>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"text-sm font-medium block mb-1.5\">n8n Instance URL</label>\n            <Input\n              type=\"url\"\n              placeholder=\"https://your-instance.app.n8n.cloud\"\n              value={n8nConfig.baseUrl}\n              onChange={(e) => setN8nConfig({ ...n8nConfig, baseUrl: e.target.value })}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">Your n8n cloud or self-hosted instance URL</p>\n          </div>\n\n          <div>\n            <label className=\"text-sm font-medium block mb-1.5\">\n              n8n API Key\n              <span className=\"text-xs text-muted-foreground ml-2\">(Optional)</span>\n            </label>\n            <Input\n              type=\"password\"\n              placeholder=\"n8n_api_xyz123...\"\n              value={n8nConfig.apiKey}\n              onChange={(e) => setN8nConfig({ ...n8nConfig, apiKey: e.target.value })}\n            />\n            <p className=\"text-xs text-muted-foreground mt-1\">Optional: For authenticated webhook calls</p>\n          </div>\n\n          <Button onClick={saveN8nConfig} disabled={!n8nConfig.baseUrl || savingN8n}>\n            {savingN8n ? 'Saving...' : 'Save n8n Configuration'}\n          </Button>\n\n          {n8nData?.configured && (\n            <Alert>\n              <Info className=\"w-4 h-4\" />\n              <AlertDescription>\n                <strong>Currently configured:</strong> {n8nData.baseUrl}\n                {n8nData.hasApiKey && <span className=\"ml-2\"> API key saved</span>}\n              </AlertDescription>\n            </Alert>\n          )}\n        </div>\n\n        <Alert className=\"mt-4\">\n          <ShieldCheck className=\"w-4 h-4\" />\n          <AlertDescription>\n            <strong>Security:</strong> Your n8n API key is encrypted with AES-256-GCM and stored securely in the vault.\n            It's never exposed in API responses.\n          </AlertDescription>\n        </Alert>\n      </div>\n\n      {/* Info Section */}\n      <div className=\"mt-12 p-6 rounded-xl border bg-card/50\">\n        <h2 className=\"font-semibold mb-3\">How It Works</h2>\n        <ul className=\"space-y-2 text-sm text-muted-foreground\">\n          <li className=\"flex items-start gap-2\">\n            <span className=\"text-primary mt-0.5\">1.</span>\n            <span>\n              <strong className=\"text-foreground\">Default keys</strong> are shared across all users with rate limits.\n            </span>\n          </li>\n          <li className=\"flex items-start gap-2\">\n            <span className=\"text-primary mt-0.5\">2.</span>\n            <span>\n              <strong className=\"text-foreground\">Custom keys</strong> give you dedicated quota and are billed to your\n              account.\n            </span>\n          </li>\n          <li className=\"flex items-start gap-2\">\n            <span className=\"text-primary mt-0.5\">3.</span>\n            <span>\n              <strong className=\"text-foreground\">Remove</strong> a custom key anytime to revert to the default.\n            </span>\n          </li>\n        </ul>\n      </div>\n\n      {/* Edit Form Dialog */}\n      <ApiKeyForm\n        isOpen={editingService !== null}\n        onClose={handleCloseForm}\n        service={editingService}\n        existingKey={editingKeyInfo?.keyPreview}\n        onSave={handleSave}\n        isSaving={saveMutation.isPending}\n        validationError={formError}\n        validationSuccess={formSuccess}\n      />\n    </>\n  );\n\n  // Embedded mode - just render content\n  if (embedded) {\n    return content;\n  }\n\n  // Standalone mode - full page layout\n  return (\n    <div className=\"min-h-screen bg-background text-foreground selection:bg-primary/20 selection:text-primary font-sans overflow-hidden relative\">\n      {/* Background Ambience */}\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-primary/5 blur-[120px] rounded-full\" />\n        <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-500/5 blur-[120px] rounded-full\" />\n      </div>\n\n      <Header currentPage=\"settings\" />\n\n      <main className=\"container max-w-4xl mx-auto px-6 pt-24 pb-20 relative z-10\">\n        {/* Back Button */}\n        <div className=\"mb-6\">\n          <Link href=\"/settings\">\n            <Button variant=\"ghost\" size=\"sm\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Settings\n            </Button>\n          </Link>\n        </div>\n\n        {/* Header */}\n        <div className=\"flex items-center gap-3 mb-2\">\n          <div className=\"p-2 rounded-lg bg-primary/10\">\n            <KeyRound className=\"w-6 h-6 text-primary\" />\n          </div>\n          <h1 className=\"text-2xl font-semibold text-foreground\">API Key Settings</h1>\n        </div>\n        <p className=\"text-muted-foreground mb-8\">\n          Manage your API keys for external services. Custom keys use your own quota and billing.\n        </p>\n\n        {content}\n      </main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\ApprovalQueue.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchQueue'. Either include it or remove the dependency array.","line":93,"column":6,"nodeType":"ArrayExpression","endLine":93,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [statusFilter, priorityFilter, platformFilter, fetchQueue]","fix":{"range":[2712,2758],"text":"[statusFilter, priorityFilter, platformFilter, fetchQueue]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4189,4192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4189,4192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5017,5020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5017,5020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5870,5873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5870,5873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6728,6731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6728,6731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7637,7640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7637,7640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8361,8364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8361,8364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":338,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9277,9280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9277,9280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10192,10195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10192,10195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Header } from \"@/components/layout/Header\";\n\ninterface ApprovalQueueProps {\n  embedded?: boolean;\n}\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { QueueCard } from \"@/components/approval/QueueCard\";\nimport { ReviewModal } from \"@/components/approval/ReviewModal\";\nimport { BulkActions } from \"@/components/approval/BulkActions\";\n\nimport {\n  Filter,\n  RefreshCw,\n  CheckCircle2,\n  Clock,\n  BarChart3,\n  TrendingUp,\n  Flame,\n  AlertCircle\n} from \"lucide-react\";\n\ninterface ApprovalQueueItem {\n  id: string;\n  userId: string;\n  adCopyId?: string;\n  generationId?: string;\n  status: 'pending_review' | 'approved' | 'rejected' | 'needs_revision' | 'scheduled' | 'published' | 'failed';\n  priority: 'low' | 'medium' | 'high' | 'urgent';\n  aiConfidenceScore?: number;\n  aiRecommendation?: 'auto_approve' | 'manual_review' | 'auto_reject';\n  aiReasoning?: string;\n  safetyChecksPassed?: any;\n  complianceFlags?: string[];\n  reviewedBy?: string;\n  reviewedAt?: string;\n  reviewNotes?: string;\n  scheduledFor?: string;\n  createdAt: string;\n  updatedAt: string;\n  adCopy?: {\n    caption: string;\n    headline?: string;\n    hook?: string;\n    cta?: string;\n    platform: string;\n    framework?: string;\n    qualityScore?: any;\n  };\n  generation?: {\n    generatedImagePath: string;\n    prompt?: string;\n    aspectRatio?: string;\n  };\n}\n\ninterface QueueStats {\n  totalPending: number;\n  avgConfidenceScore: number;\n  urgentCount: number;\n  highPriorityCount: number;\n}\n\nexport default function ApprovalQueue({ embedded = false }: ApprovalQueueProps) {\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [items, setItems] = useState<ApprovalQueueItem[]>([]);\n  const [stats, setStats] = useState<QueueStats>({\n    totalPending: 0,\n    avgConfidenceScore: 0,\n    urgentCount: 0,\n    highPriorityCount: 0\n  });\n\n  // Filters\n  const [statusFilter, setStatusFilter] = useState<string>('pending_review');\n  const [priorityFilter, setPriorityFilter] = useState<string>('all');\n  const [platformFilter, setPlatformFilter] = useState<string>('all');\n\n  // Selection\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\n  // Review modal\n  const [reviewingItem, setReviewingItem] = useState<ApprovalQueueItem | null>(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  useEffect(() => {\n    fetchQueue();\n  }, [statusFilter, priorityFilter, platformFilter]);\n\n  const fetchQueue = async () => {\n    try {\n      setLoading(true);\n\n      // Build query params\n      const params = new URLSearchParams();\n      if (statusFilter !== 'all') params.append('status', statusFilter);\n      if (priorityFilter !== 'all') params.append('priority', priorityFilter);\n      if (platformFilter !== 'all') params.append('platform', platformFilter);\n\n      const response = await fetch(`/api/approval-queue?${params}`, {\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to fetch approval queue');\n      }\n\n      const data = await response.json();\n      // Handle both response formats: {items:[]} or {data:{items:[]}}\n      const items = data.data?.items || data.items || [];\n      setItems(items);\n\n      // Calculate stats\n      const pending = items.filter((item: ApprovalQueueItem) => item.status === 'pending_review');\n      const avgScore = pending.reduce((sum: number, item: ApprovalQueueItem) =>\n        sum + (item.aiConfidenceScore || 0), 0) / (pending.length || 1);\n\n      setStats({\n        totalPending: pending.length,\n        avgConfidenceScore: Math.round(avgScore),\n        urgentCount: pending.filter((item: ApprovalQueueItem) => item.priority === 'urgent').length,\n        highPriorityCount: pending.filter((item: ApprovalQueueItem) => item.priority === 'high').length\n      });\n\n      setSelectedIds(new Set());\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to load approval queue\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleQuickApprove = async (itemId: string) => {\n    try {\n      setIsProcessing(true);\n\n      const response = await fetch(`/api/approval-queue/${itemId}/approve`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ notes: 'Quick approved' })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to approve content');\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Content approved successfully\",\n        variant: \"default\"\n      });\n\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to approve content\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleApprove = async (itemId: string, notes?: string) => {\n    try {\n      setIsProcessing(true);\n\n      const response = await fetch(`/api/approval-queue/${itemId}/approve`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ notes })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to approve content');\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Content approved and scheduled\",\n        variant: \"default\"\n      });\n\n      setReviewingItem(null);\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to approve content\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleReject = async (itemId: string, notes?: string) => {\n    try {\n      setIsProcessing(true);\n\n      const response = await fetch(`/api/approval-queue/${itemId}/reject`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ reason: notes || 'Rejected' })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to reject content');\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Content rejected\",\n        variant: \"default\"\n      });\n\n      setReviewingItem(null);\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to reject content\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleRequestRevision = async (itemId: string, notes?: string) => {\n    try {\n      setIsProcessing(true);\n\n      const response = await fetch(`/api/approval-queue/${itemId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          status: 'needs_revision',\n          reviewNotes: notes\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to request revision');\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Revision requested\",\n        variant: \"default\"\n      });\n\n      setReviewingItem(null);\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to request revision\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleDelete = async (itemId: string) => {\n    if (!confirm('Are you sure you want to delete this item?')) return;\n\n    try {\n      const response = await fetch(`/api/approval-queue/${itemId}`, {\n        method: 'DELETE',\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete item');\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Item deleted\",\n        variant: \"default\"\n      });\n\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete item\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleBulkApprove = async () => {\n    if (selectedIds.size === 0) return;\n\n    try {\n      setIsProcessing(true);\n\n      const response = await fetch('/api/approval-queue/bulk-approve', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({\n          ids: Array.from(selectedIds),\n          notes: 'Bulk approved'\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to bulk approve');\n      }\n\n      const result = await response.json();\n\n      toast({\n        title: \"Success\",\n        description: `${result.approved} items approved successfully`,\n        variant: \"default\"\n      });\n\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to bulk approve\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleBulkReject = async () => {\n    if (selectedIds.size === 0) return;\n    if (!confirm(`Reject ${selectedIds.size} items?`)) return;\n\n    try {\n      setIsProcessing(true);\n\n      const promises = Array.from(selectedIds).map(id =>\n        fetch(`/api/approval-queue/${id}/reject`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({ reason: 'Bulk rejected' })\n        })\n      );\n\n      await Promise.all(promises);\n\n      toast({\n        title: \"Success\",\n        description: `${selectedIds.size} items rejected`,\n        variant: \"default\"\n      });\n\n      fetchQueue();\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to bulk reject\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const toggleSelection = (itemId: string, selected: boolean) => {\n    const newSelectedIds = new Set(selectedIds);\n    if (selected) {\n      newSelectedIds.add(itemId);\n    } else {\n      newSelectedIds.delete(itemId);\n    }\n    setSelectedIds(newSelectedIds);\n  };\n\n  const selectAll = () => {\n    setSelectedIds(new Set(items.map(item => item.id)));\n  };\n\n  const deselectAll = () => {\n    setSelectedIds(new Set());\n  };\n\n  // Group items by priority\n  const urgentItems = items.filter(item => item.priority === 'urgent');\n  const highPriorityItems = items.filter(item => item.priority === 'high');\n  const standardItems = items.filter(item => item.priority === 'medium' || item.priority === 'low');\n\n  return (\n    <>\n      {!embedded && <Header currentPage=\"approval-queue\" />}\n      <div className=\"container mx-auto p-4 sm:p-6 space-y-6\">\n        {/* Page Title */}\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Content Approval Queue</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Review and approve AI-generated content\n          </p>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <Button\n            onClick={fetchQueue}\n            variant=\"outline\"\n            size=\"sm\"\n            disabled={loading}\n          >\n            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      {/* Quick Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-blue-100 dark:bg-blue-900/20\">\n                <Clock className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">{stats.totalPending}</div>\n                <div className=\"text-xs text-muted-foreground\">Pending Review</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-green-100 dark:bg-green-900/20\">\n                <TrendingUp className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">{stats.avgConfidenceScore}%</div>\n                <div className=\"text-xs text-muted-foreground\">Avg Confidence</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-red-100 dark:bg-red-900/20\">\n                <Flame className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">{stats.urgentCount}</div>\n                <div className=\"text-xs text-muted-foreground\">Urgent Items</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 rounded-lg bg-orange-100 dark:bg-orange-900/20\">\n                <AlertCircle className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\n              </div>\n              <div>\n                <div className=\"text-2xl font-bold\">{stats.highPriorityCount}</div>\n                <div className=\"text-xs text-muted-foreground\">High Priority</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-base\">\n            <Filter className=\"w-4 h-4\" />\n            Filters\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Status</label>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Statuses</SelectItem>\n                  <SelectItem value=\"pending_review\">Pending Review</SelectItem>\n                  <SelectItem value=\"approved\">Approved</SelectItem>\n                  <SelectItem value=\"rejected\">Rejected</SelectItem>\n                  <SelectItem value=\"needs_revision\">Needs Revision</SelectItem>\n                  <SelectItem value=\"scheduled\">Scheduled</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Priority</label>\n              <Select value={priorityFilter} onValueChange={setPriorityFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Priorities</SelectItem>\n                  <SelectItem value=\"urgent\">Urgent</SelectItem>\n                  <SelectItem value=\"high\">High</SelectItem>\n                  <SelectItem value=\"medium\">Medium</SelectItem>\n                  <SelectItem value=\"low\">Low</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Platform</label>\n              <Select value={platformFilter} onValueChange={setPlatformFilter}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Platforms</SelectItem>\n                  <SelectItem value=\"linkedin\">LinkedIn</SelectItem>\n                  <SelectItem value=\"instagram\">Instagram</SelectItem>\n                  <SelectItem value=\"facebook\">Facebook</SelectItem>\n                  <SelectItem value=\"twitter\">Twitter</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Bulk Actions */}\n      <BulkActions\n        selectedCount={selectedIds.size}\n        totalCount={items.length}\n        onSelectAll={selectAll}\n        onDeselectAll={deselectAll}\n        onBulkApprove={handleBulkApprove}\n        onBulkReject={handleBulkReject}\n        isProcessing={isProcessing}\n      />\n\n      {/* Loading State */}\n      {loading && (\n        <div className=\"space-y-4\">\n          {[1, 2, 3].map(i => (\n            <Skeleton key={i} className=\"h-32 w-full\" />\n          ))}\n        </div>\n      )}\n\n      {/* Empty State */}\n      {!loading && items.length === 0 && (\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <CheckCircle2 className=\"w-16 h-16 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-medium mb-2\">No items in queue</h3>\n            <p className=\"text-muted-foreground\">\n              All content has been reviewed or there are no items matching your filters.\n            </p>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Urgent Items */}\n      {!loading && urgentItems.length > 0 && (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <Flame className=\"w-5 h-5 text-red-600\" />\n            <h2 className=\"text-xl font-bold\">URGENT REVIEW ({urgentItems.length} items)</h2>\n          </div>\n          <div className=\"space-y-3\">\n            {urgentItems.map((item, index) => (\n              <QueueCard\n                key={item.id}\n                item={item}\n                onReview={() => setReviewingItem(item)}\n                onQuickApprove={() => handleQuickApprove(item.id)}\n                onDelete={() => handleDelete(item.id)}\n                isSelected={selectedIds.has(item.id)}\n                onSelect={(selected) => toggleSelection(item.id, selected)}\n                index={index}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* High Priority Items */}\n      {!loading && highPriorityItems.length > 0 && (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className=\"w-5 h-5 text-orange-600\" />\n            <h2 className=\"text-xl font-bold\">HIGH PRIORITY ({highPriorityItems.length} items)</h2>\n          </div>\n          <div className=\"space-y-3\">\n            {highPriorityItems.map((item, index) => (\n              <QueueCard\n                key={item.id}\n                item={item}\n                onReview={() => setReviewingItem(item)}\n                onQuickApprove={() => handleQuickApprove(item.id)}\n                onDelete={() => handleDelete(item.id)}\n                isSelected={selectedIds.has(item.id)}\n                onSelect={(selected) => toggleSelection(item.id, selected)}\n                index={index}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Standard Queue */}\n      {!loading && standardItems.length > 0 && (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <BarChart3 className=\"w-5 h-5 text-blue-600\" />\n            <h2 className=\"text-xl font-bold\">STANDARD QUEUE ({standardItems.length} items)</h2>\n          </div>\n          <div className=\"space-y-3\">\n            {standardItems.map((item, index) => (\n              <QueueCard\n                key={item.id}\n                item={item}\n                onReview={() => setReviewingItem(item)}\n                onQuickApprove={() => handleQuickApprove(item.id)}\n                onDelete={() => handleDelete(item.id)}\n                isSelected={selectedIds.has(item.id)}\n                onSelect={(selected) => toggleSelection(item.id, selected)}\n                index={index}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Review Modal */}\n      {reviewingItem && (\n        <ReviewModal\n          isOpen={true}\n          onClose={() => setReviewingItem(null)}\n          item={reviewingItem}\n          onApprove={(notes) => handleApprove(reviewingItem.id, notes)}\n          onReject={(notes) => handleReject(reviewingItem.id, notes)}\n          onRequestRevision={(notes) => handleRequestRevision(reviewingItem.id, notes)}\n          isProcessing={isProcessing}\n        />\n      )}\n      </div>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\BrandImageLibrary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\BrandProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardContent"},"fix":{"range":[303,319],"text":""},"desc":"Remove unused variable \"CardContent\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BrandProfileDisplay } from \"@/components/BrandProfileDisplay\";\r\nimport { Link } from \"wouter\";\r\nimport { ArrowLeft, KeyRound, Building2, ChevronRight } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Header } from \"@/components/layout/Header\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardDescription,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"@/components/ui/card\";\r\n\r\ninterface BrandProfileProps {\r\n  embedded?: boolean;\r\n}\r\n\r\nexport default function BrandProfile({ embedded = false }: BrandProfileProps) {\r\n  // Embedded mode - just render content\r\n  if (embedded) {\r\n    return <BrandProfileDisplay className=\"max-w-3xl\" />;\r\n  }\r\n\r\n  // Standalone mode - full page layout\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground selection:bg-primary/20 selection:text-primary font-sans overflow-hidden relative\">\r\n      {/* Background Ambience */}\r\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-primary/5 blur-[120px] rounded-full\" />\r\n        <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-500/5 blur-[120px] rounded-full\" />\r\n      </div>\r\n\r\n      <Header currentPage=\"settings\" />\r\n\r\n      <main className=\"container max-w-7xl mx-auto px-6 pt-24 pb-20 relative z-10\">\r\n        <div className=\"mb-6\">\r\n          <Link href=\"/\">\r\n            <Button variant=\"ghost\" size=\"sm\">\r\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n              Back to Studio\r\n            </Button>\r\n          </Link>\r\n        </div>\r\n\r\n        <h1 className=\"text-2xl font-semibold text-foreground mb-6\">Settings</h1>\r\n\r\n        {/* Settings Navigation Cards */}\r\n        <div className=\"grid gap-4 md:grid-cols-2 mb-8 max-w-3xl\">\r\n          <Card className=\"group cursor-default border-primary/20 bg-primary/5\">\r\n            <CardHeader className=\"pb-2\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 rounded-lg bg-primary/10\">\r\n                    <Building2 className=\"w-5 h-5 text-primary\" />\r\n                  </div>\r\n                  <div>\r\n                    <CardTitle className=\"text-base\">Brand Profile</CardTitle>\r\n                    <CardDescription className=\"text-xs\">\r\n                      Your brand identity and voice\r\n                    </CardDescription>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardHeader>\r\n          </Card>\r\n\r\n          <Link href=\"/settings/api-keys\">\r\n            <Card className=\"group cursor-pointer hover:border-primary/30 transition-colors\">\r\n              <CardHeader className=\"pb-2\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"p-2 rounded-lg bg-muted\">\r\n                      <KeyRound className=\"w-5 h-5 text-muted-foreground group-hover:text-primary transition-colors\" />\r\n                    </div>\r\n                    <div>\r\n                      <CardTitle className=\"text-base\">API Keys</CardTitle>\r\n                      <CardDescription className=\"text-xs\">\r\n                        Manage external service keys\r\n                      </CardDescription>\r\n                    </div>\r\n                  </div>\r\n                  <ChevronRight className=\"w-4 h-4 text-muted-foreground group-hover:text-foreground transition-colors\" />\r\n                </div>\r\n              </CardHeader>\r\n            </Card>\r\n          </Link>\r\n        </div>\r\n\r\n        {/* Brand Profile Content */}\r\n        <h2 className=\"text-lg font-medium text-foreground mb-4\">Brand Profile</h2>\r\n        <BrandProfileDisplay className=\"max-w-3xl\" />\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\ContentPlanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\GalleryPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3765,3768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3765,3768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8052,8055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8052,8055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\r\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport { useLocation } from 'wouter';\r\nimport { Header } from '@/components/layout/Header';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { ArrowLeft, Search, SortDesc, Trash2, Image as ImageIcon } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport type { Generation } from '@shared/schema';\r\n\r\ntype SortOption = 'newest' | 'oldest';\r\n\r\nexport default function GalleryPage() {\r\n  const [, navigate] = useLocation();\r\n  const queryClient = useQueryClient();\r\n  const { toast } = useToast();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [sortBy, setSortBy] = useState<SortOption>('newest');\r\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  const { data: generations, isLoading } = useQuery<Generation[]>({\r\n    queryKey: ['generations'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/generations');\r\n      if (!res.ok) throw new Error('Failed to fetch generations');\r\n      return res.json();\r\n    },\r\n  });\r\n\r\n  const filteredGenerations = useMemo(() => {\r\n    if (!generations) return [];\r\n    let result = [...generations];\r\n\r\n    if (searchQuery.trim()) {\r\n      const q = searchQuery.toLowerCase();\r\n      result = result.filter((g) => (g.prompt || '').toLowerCase().includes(q));\r\n    }\r\n\r\n    result.sort((a, b) => {\r\n      const dateA = new Date(a.createdAt).getTime();\r\n      const dateB = new Date(b.createdAt).getTime();\r\n      return sortBy === 'newest' ? dateB - dateA : dateA - dateB;\r\n    });\r\n\r\n    return result;\r\n  }, [generations, searchQuery, sortBy]);\r\n\r\n  const toggleSelect = (id: string) => {\r\n    setSelectedIds((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) {\r\n        next.delete(id);\r\n      } else {\r\n        next.add(id);\r\n      }\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const clearSelection = () => setSelectedIds(new Set());\r\n\r\n  const handleDeleteSelected = async () => {\r\n    setIsDeleting(true);\r\n    try {\r\n      const ids = Array.from(selectedIds);\r\n      const results = await Promise.allSettled(\r\n        ids.map((id) =>\r\n          fetch(`/api/generations/${id}`, {\r\n            method: 'DELETE',\r\n            credentials: 'include',\r\n          }).then((res) => {\r\n            if (!res.ok) throw new Error(`Failed to delete generation ${id}`);\r\n            return res.json();\r\n          }),\r\n        ),\r\n      );\r\n\r\n      const failed = results.filter((r) => r.status === 'rejected').length;\r\n      const succeeded = results.filter((r) => r.status === 'fulfilled').length;\r\n\r\n      if (failed > 0) {\r\n        toast({\r\n          title: 'Partial delete',\r\n          description: `Deleted ${succeeded} of ${ids.length} generations. ${failed} failed.`,\r\n          variant: 'destructive',\r\n        });\r\n      } else {\r\n        toast({\r\n          title: 'Deleted',\r\n          description: `${succeeded} generation${succeeded !== 1 ? 's' : ''} deleted.`,\r\n        });\r\n      }\r\n\r\n      queryClient.invalidateQueries({ queryKey: ['generations'] });\r\n      setSelectedIds(new Set());\r\n    } catch (error: any) {\r\n      toast({\r\n        title: 'Delete failed',\r\n        description: error.message || 'Failed to delete generations',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setShowDeleteDialog(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <Header currentPage=\"gallery\" />\r\n\r\n      <div className=\"container px-4 md:px-6 py-4 md:py-6\">\r\n        {/* Top bar */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/')}>\r\n              <ArrowLeft className=\"h-4 w-4 mr-1\" />\r\n              Studio\r\n            </Button>\r\n            <h1 className=\"text-xl font-semibold\">Gallery</h1>\r\n            {generations && (\r\n              <span className=\"text-sm text-muted-foreground\">\r\n                {filteredGenerations.length} generation{filteredGenerations.length !== 1 ? 's' : ''}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          {/* Bulk actions */}\r\n          {selectedIds.size > 0 && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"text-sm text-muted-foreground\">{selectedIds.size} selected</span>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={clearSelection}>\r\n                Clear\r\n              </Button>\r\n              <Button variant=\"destructive\" size=\"sm\" onClick={() => setShowDeleteDialog(true)}>\r\n                <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                Delete\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"flex flex-col sm:flex-row gap-3 mb-6\">\r\n          <div className=\"relative flex-1 max-w-sm\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder=\"Search prompts...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              className=\"pl-9\"\r\n            />\r\n          </div>\r\n          <Select value={sortBy} onValueChange={(v) => setSortBy(v as SortOption)}>\r\n            <SelectTrigger className=\"w-40\">\r\n              <SortDesc className=\"h-4 w-4 mr-2\" />\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"newest\">Newest first</SelectItem>\r\n              <SelectItem value=\"oldest\">Oldest first</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Grid */}\r\n        {isLoading ? (\r\n          <div\r\n            className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4\"\r\n            role=\"status\"\r\n            aria-live=\"polite\"\r\n            aria-busy=\"true\"\r\n            aria-label=\"Loading gallery\"\r\n          >\r\n            {Array.from({ length: 10 }).map((_, i) => (\r\n              <Skeleton key={i} className=\"aspect-square rounded-lg\" />\r\n            ))}\r\n          </div>\r\n        ) : filteredGenerations.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center py-20 text-muted-foreground\">\r\n            <ImageIcon className=\"h-12 w-12 mb-4 opacity-50\" />\r\n            <p className=\"text-lg font-medium\">No generations yet</p>\r\n            <p className=\"text-sm mt-1\">Create your first image in the Studio</p>\r\n            <Button className=\"mt-4\" onClick={() => navigate('/')}>\r\n              Go to Studio\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4\">\r\n            {filteredGenerations.map((gen) => (\r\n              <div\r\n                key={gen.id}\r\n                className={cn(\r\n                  'group relative aspect-square rounded-lg overflow-hidden border cursor-pointer transition-all',\r\n                  selectedIds.has(gen.id)\r\n                    ? 'ring-2 ring-primary border-primary'\r\n                    : 'border-border hover:border-primary/50',\r\n                )}\r\n                onClick={() => navigate(`/?generation=${gen.id}`)}\r\n              >\r\n                <img\r\n                  src={(gen as any).imageUrl ?? gen.generatedImagePath}\r\n                  alt={gen.prompt.slice(0, 80)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n\r\n                {/* Hover overlay */}\r\n                <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-end\">\r\n                  <div className=\"w-full p-2 translate-y-full group-hover:translate-y-0 transition-transform\">\r\n                    <p className=\"text-white text-xs line-clamp-2\">{gen.prompt}</p>\r\n                    <p className=\"text-white/70 text-[10px] mt-1\">{new Date(gen.createdAt).toLocaleDateString()}</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Select checkbox */}\r\n                <button\r\n                  className={cn(\r\n                    'absolute top-2 left-2 w-5 h-5 rounded-full border-2 transition-all',\r\n                    selectedIds.has(gen.id)\r\n                      ? 'bg-primary border-primary'\r\n                      : 'border-white/70 opacity-0 group-hover:opacity-100',\r\n                  )}\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    toggleSelect(gen.id);\r\n                  }}\r\n                  aria-label={`Select generation ${gen.id}`}\r\n                />\r\n\r\n                {/* Edit badge */}\r\n                {gen.editCount && gen.editCount > 0 && (\r\n                  <span className=\"absolute top-2 right-2 bg-primary/90 text-white text-[10px] px-1.5 py-0.5 rounded-full\">\r\n                    v{(gen.editCount ?? 0) + 1}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Delete Generations</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Are you sure you want to delete {selectedIds.size} generation{selectedIds.size !== 1 ? 's' : ''}? This\r\n              action cannot be undone.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteSelected}\r\n              disabled={isDeleting}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? 'Deleting...' : 'Delete'}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\InstallationScenarios.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\LearnFromWinners.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Library.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Login.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Pipeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\ProductLibrary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedId' is defined but never used. Allowed unused args must match /^_/u.","line":234,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":234,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { Link } from \"wouter\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  Search,\r\n  Plus,\r\n  Package,\r\n  ImageOff,\r\n  Tag,\r\n  X,\r\n  Trash2\r\n} from \"lucide-react\";\r\nimport { cn, getProductImageUrl } from \"@/lib/utils\";\r\nimport type { Product } from \"@shared/schema\";\r\n\r\n// Components\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogDescription,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Header } from \"@/components/layout/Header\";\r\nimport { ProductEnrichmentForm } from \"@/components/ProductEnrichmentForm\";\r\nimport { AddProductModal } from \"@/components/AddProductModal\";\r\nimport { ProductRelationships } from \"@/components/ProductRelationships\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\n// Enrichment status badge styling (light mode readable + dark mode optimized)\r\nfunction getEnrichmentStatusBadge(status: string | null | undefined) {\r\n  switch (status) {\r\n    case \"complete\":\r\n      return { variant: \"default\" as const, label: \"Complete\", className: \"bg-green-500/10 dark:bg-green-500/20 text-green-900 dark:text-green-400 border-green-500/30 dark:border-green-500/20\" };\r\n    case \"verified\":\r\n      return { variant: \"default\" as const, label: \"Verified\", className: \"bg-blue-500/10 dark:bg-blue-500/20 text-blue-900 dark:text-blue-400 border-blue-500/30 dark:border-blue-500/20\" };\r\n    case \"draft\":\r\n      return { variant: \"secondary\" as const, label: \"Draft\", className: \"bg-yellow-500/10 dark:bg-yellow-500/20 text-yellow-900 dark:text-yellow-400 border-yellow-500/30 dark:border-yellow-500/20\" };\r\n    case \"pending\":\r\n    default:\r\n      return { variant: \"outline\" as const, label: \"Pending\", className: \"bg-muted/50 text-muted-foreground\" };\r\n  }\r\n}\r\n\r\n// Product image component with error handling and URL normalization\r\nfunction ProductImage({ src, alt }: { src: string; alt: string }) {\r\n  const [hasError, setHasError] = useState(false);\r\n  const normalizedSrc = getProductImageUrl(src);\r\n\r\n  if (hasError) {\r\n    return (\r\n      <div className=\"w-full h-full flex flex-col items-center justify-center bg-muted/50 text-muted-foreground\">\r\n        <ImageOff className=\"w-12 h-12 mb-2 opacity-50\" />\r\n        <span className=\"text-xs\">Image unavailable</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <img\r\n      src={normalizedSrc}\r\n      alt={alt}\r\n      className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\r\n      onError={() => setHasError(true)}\r\n    />\r\n  );\r\n}\r\n\r\n// Loading skeleton for products\r\nfunction ProductSkeleton() {\r\n  return (\r\n    <Card className=\"overflow-hidden\">\r\n      <Skeleton className=\"aspect-square w-full\" />\r\n      <CardContent className=\"p-4 space-y-3\">\r\n        <Skeleton className=\"h-5 w-3/4\" />\r\n        <Skeleton className=\"h-4 w-1/2\" />\r\n        <div className=\"flex gap-2\">\r\n          <Skeleton className=\"h-5 w-16\" />\r\n          <Skeleton className=\"h-5 w-20\" />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n\r\n// Product detail modal\r\nfunction ProductDetailModal({\r\n  product,\r\n  isOpen,\r\n  onClose,\r\n  onEnrichComplete,\r\n}: {\r\n  product: Product | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onEnrichComplete?: () => void;\r\n}) {\r\n  if (!product) return null;\r\n\r\n  const statusBadge = getEnrichmentStatusBadge(product.enrichmentStatus);\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-xl\">{product.name}</DialogTitle>\r\n          <DialogDescription>\r\n            {product.category && (\r\n              <span className=\"text-muted-foreground\">{product.category}</span>\r\n            )}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <Tabs defaultValue=\"details\" className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-3\">\r\n            <TabsTrigger value=\"details\">Details</TabsTrigger>\r\n            <TabsTrigger value=\"relationships\">Relationships</TabsTrigger>\r\n            <TabsTrigger value=\"enrich\">Enrich</TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Details Tab */}\r\n          <TabsContent value=\"details\" className=\"space-y-6 mt-4\">\r\n            {/* Product Image */}\r\n            <div className=\"aspect-video rounded-xl overflow-hidden bg-muted\">\r\n              <ProductImage src={product.cloudinaryUrl} alt={product.name} />\r\n            </div>\r\n\r\n            {/* Status and Category */}\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              <Badge className={statusBadge.className}>\r\n                {statusBadge.label}\r\n              </Badge>\r\n              {product.category && (\r\n                <Badge variant=\"outline\">{product.category}</Badge>\r\n              )}\r\n              {product.sku && (\r\n                <Badge variant=\"secondary\">SKU: {product.sku}</Badge>\r\n              )}\r\n            </div>\r\n\r\n            {/* Description */}\r\n            {product.description && (\r\n              <div>\r\n                <h4 className=\"text-sm font-medium mb-2\">Description</h4>\r\n                <p className=\"text-sm text-muted-foreground\">{product.description}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Benefits */}\r\n            {product.benefits && product.benefits.length > 0 && (\r\n              <div>\r\n                <h4 className=\"text-sm font-medium mb-2\">Benefits</h4>\r\n                <ul className=\"list-disc list-inside text-sm text-muted-foreground space-y-1\">\r\n                  {product.benefits.map((benefit, index) => (\r\n                    <li key={index}>{benefit}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n\r\n            {/* Tags */}\r\n            {product.tags && product.tags.length > 0 && (\r\n              <div>\r\n                <h4 className=\"text-sm font-medium mb-2 flex items-center gap-1\">\r\n                  <Tag className=\"w-4 h-4\" />\r\n                  Tags\r\n                </h4>\r\n                <div className=\"flex flex-wrap gap-1\">\r\n                  {product.tags.map((tag, index) => (\r\n                    <Badge key={index} variant=\"outline\" className=\"text-xs\">\r\n                      {tag}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex gap-2 pt-4 border-t\">\r\n              <Link href=\"/\" className=\"flex-1\">\r\n                <Button className=\"w-full\">\r\n                  Use in Studio\r\n                </Button>\r\n              </Link>\r\n              <Button variant=\"outline\" onClick={onClose}>\r\n                Close\r\n              </Button>\r\n            </div>\r\n          </TabsContent>\r\n\r\n          {/* Relationships Tab */}\r\n          <TabsContent value=\"relationships\" className=\"mt-4\">\r\n            <ProductRelationships productId={product.id} />\r\n          </TabsContent>\r\n\r\n          {/* Enrich Tab */}\r\n          <TabsContent value=\"enrich\" className=\"mt-4\">\r\n            <ProductEnrichmentForm\r\n              product={product}\r\n              onComplete={() => {\r\n                onEnrichComplete?.();\r\n                onClose();\r\n              }}\r\n            />\r\n          </TabsContent>\r\n        </Tabs>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface ProductLibraryProps {\r\n  embedded?: boolean;\r\n  selectedId?: string | null;\r\n}\r\n\r\nexport default function ProductLibrary({ embedded = false, selectedId }: ProductLibraryProps) {\r\n  const queryClient = useQueryClient();\r\n  const { toast } = useToast();\r\n\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);\r\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [productToDelete, setProductToDelete] = useState<Product | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Fetch products\r\n  const { data: products, isLoading, error, refetch } = useQuery<Product[]>({\r\n    queryKey: [\"products\"],\r\n    queryFn: async () => {\r\n      const response = await fetch(\"/api/products\");\r\n      if (!response.ok) throw new Error(\"Failed to fetch products\");\r\n      return response.json();\r\n    },\r\n  });\r\n\r\n  // Filter products by search query\r\n  const filteredProducts = products?.filter((product) =>\r\n    (product.name || \"\").toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n    (product.category || \"\").toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n    product.tags?.some(tag => (tag || \"\").toLowerCase().includes(searchQuery.toLowerCase()))\r\n  ) ?? [];\r\n\r\n  // Handle product click\r\n  const handleProductClick = (product: Product) => {\r\n    setSelectedProduct(product);\r\n    setIsDetailOpen(true);\r\n  };\r\n\r\n  // Handle modal close\r\n  const handleCloseDetail = () => {\r\n    setIsDetailOpen(false);\r\n    setSelectedProduct(null);\r\n  };\r\n\r\n  // Handle product deletion\r\n  const handleDeleteProduct = async () => {\r\n    if (!productToDelete) return;\r\n\r\n    setIsDeleting(true);\r\n    try {\r\n      const response = await fetch(`/api/products/${productToDelete.id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to delete product\");\r\n      }\r\n\r\n      // Invalidate and refetch products\r\n      queryClient.invalidateQueries({ queryKey: [\"products\"] });\r\n\r\n      toast({\r\n        title: \"Product deleted\",\r\n        description: `${productToDelete.name} has been removed from your library.`,\r\n      });\r\n\r\n      // Close detail modal if this product was open\r\n      if (selectedProduct?.id === productToDelete.id) {\r\n        handleCloseDetail();\r\n      }\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Delete failed\",\r\n        description: error instanceof Error ? error.message : \"Failed to delete product\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsDeleting(false);\r\n      setProductToDelete(null);\r\n    }\r\n  };\r\n\r\n  // Content to render (shared between embedded and standalone)\r\n  const content = (\r\n    <>\r\n      {/* Page Header - only show in standalone mode */}\r\n      {!embedded && (\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-display font-bold\">Product Library</h1>\r\n            <p className=\"text-muted-foreground mt-1\">\r\n              Manage and organize your product catalog\r\n            </p>\r\n          </div>\r\n          <Button onClick={() => setIsAddModalOpen(true)}>\r\n            <Plus className=\"w-4 h-4 mr-2\" />\r\n            Add Product\r\n          </Button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Add button in embedded mode */}\r\n      {embedded && (\r\n        <div className=\"flex justify-end mb-4\">\r\n          <Button onClick={() => setIsAddModalOpen(true)}>\r\n            <Plus className=\"w-4 h-4 mr-2\" />\r\n            Add Product\r\n          </Button>\r\n        </div>\r\n      )}\r\n\r\n        {/* Search Bar */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"relative max-w-md\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder=\"Search products by name, category, or tags...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              className=\"pl-10\"\r\n            />\r\n            {searchQuery && (\r\n              <button\r\n                onClick={() => setSearchQuery(\"\")}\r\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground\"\r\n              >\r\n                <X className=\"w-4 h-4\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n          {searchQuery && (\r\n            <p className=\"text-sm text-muted-foreground mt-2\">\r\n              Showing {filteredProducts.length} result{filteredProducts.length !== 1 ? \"s\" : \"\"} for \"{searchQuery}\"\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {/* Error State */}\r\n        {error ? (\r\n          <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-center space-y-4\">\r\n            <div className=\"w-20 h-20 rounded-2xl bg-destructive/10 flex items-center justify-center\">\r\n              <Package className=\"w-10 h-10 text-destructive\" />\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-2xl font-display font-medium mb-2\">Failed to load products</h2>\r\n              <p className=\"text-muted-foreground\">\r\n                {error instanceof Error ? error.message : \"An unexpected error occurred\"}\r\n              </p>\r\n            </div>\r\n            <Button onClick={() => refetch()} variant=\"outline\">\r\n              Try Again\r\n            </Button>\r\n          </div>\r\n        ) : /* Loading State */ isLoading ? (\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6\">\r\n            {Array.from({ length: 8 }).map((_, index) => (\r\n              <ProductSkeleton key={index} />\r\n            ))}\r\n          </div>\r\n        ) : /* Empty State */ !products || products.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-center space-y-4\">\r\n            <div className=\"w-20 h-20 rounded-2xl bg-secondary flex items-center justify-center\">\r\n              <Package className=\"w-10 h-10 text-muted-foreground\" />\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-2xl font-display font-medium mb-2\">No products yet</h2>\r\n              <p className=\"text-muted-foreground\">\r\n                Add your first product to start creating stunning visuals\r\n              </p>\r\n            </div>\r\n            <Button onClick={() => setIsAddModalOpen(true)}>\r\n              <Plus className=\"w-4 h-4 mr-2\" />\r\n              Add Your First Product\r\n            </Button>\r\n          </div>\r\n        ) : /* No Search Results */ filteredProducts.length === 0 ? (\r\n          <div className=\"flex flex-col items-center justify-center min-h-[40vh] text-center space-y-4\">\r\n            <div className=\"w-16 h-16 rounded-2xl bg-secondary flex items-center justify-center\">\r\n              <Search className=\"w-8 h-8 text-muted-foreground\" />\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-xl font-display font-medium mb-2\">No results found</h2>\r\n              <p className=\"text-muted-foreground\">\r\n                Try adjusting your search terms\r\n              </p>\r\n            </div>\r\n            <Button variant=\"outline\" onClick={() => setSearchQuery(\"\")}>\r\n              Clear Search\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          /* Product Grid */\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6\">\r\n            {filteredProducts.map((product, index) => {\r\n              const statusBadge = getEnrichmentStatusBadge(product.enrichmentStatus);\r\n\r\n              return (\r\n                <motion.div\r\n                  key={product.id}\r\n                  initial={{ opacity: 0, y: 20 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: index * 0.05 }}\r\n                >\r\n                  <Card\r\n                    className={cn(\r\n                      \"group relative overflow-hidden cursor-pointer transition-all\",\r\n                      \"hover:border-primary/50 hover:shadow-lg hover:shadow-primary/5\"\r\n                    )}\r\n                    onClick={() => handleProductClick(product)}\r\n                  >\r\n                    {/* Product Image */}\r\n                    <div className=\"aspect-square overflow-hidden bg-muted\">\r\n                      <ProductImage\r\n                        src={product.cloudinaryUrl}\r\n                        alt={product.name}\r\n                      />\r\n                    </div>\r\n\r\n                    {/* Enrichment Status Badge - Positioned on image */}\r\n                    <div className=\"absolute top-3 right-3\">\r\n                      <Badge className={cn(\"text-xs\", statusBadge.className)}>\r\n                        {statusBadge.label}\r\n                      </Badge>\r\n                    </div>\r\n\r\n                    {/* Delete Button - Shows on hover */}\r\n                    <button\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        setProductToDelete(product);\r\n                      }}\r\n                      className=\"absolute top-3 left-3 w-10 h-10 rounded-full bg-background/80 backdrop-blur-sm flex items-center justify-center sm:opacity-0 sm:group-hover:opacity-100 transition-opacity hover:bg-destructive hover:text-destructive-foreground\"\r\n                    >\r\n                      <Trash2 className=\"w-4 h-4\" />\r\n                    </button>\r\n\r\n                    {/* Product Info */}\r\n                    <CardContent className=\"p-4 space-y-2\">\r\n                      <h3 className=\"font-medium text-sm line-clamp-1\" title={product.name}>\r\n                        {product.name}\r\n                      </h3>\r\n\r\n                      {product.category && (\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          {product.category}\r\n                        </p>\r\n                      )}\r\n\r\n                      {/* Tags */}\r\n                      {product.tags && product.tags.length > 0 && (\r\n                        <div className=\"flex flex-wrap gap-1 pt-1\">\r\n                          {product.tags.slice(0, 3).map((tag, i) => (\r\n                            <Badge\r\n                              key={i}\r\n                              variant=\"outline\"\r\n                              className=\"text-[10px] px-1.5 py-0 h-5\"\r\n                            >\r\n                              {tag}\r\n                            </Badge>\r\n                          ))}\r\n                          {product.tags.length > 3 && (\r\n                            <Badge\r\n                              variant=\"outline\"\r\n                              className=\"text-[10px] px-1.5 py-0 h-5\"\r\n                            >\r\n                              +{product.tags.length - 3}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </CardContent>\r\n                  </Card>\r\n                </motion.div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n\r\n      {/* Product Detail Modal */}\r\n      <ProductDetailModal\r\n        product={selectedProduct}\r\n        isOpen={isDetailOpen}\r\n        onClose={handleCloseDetail}\r\n        onEnrichComplete={() => refetch()}\r\n      />\r\n\r\n      {/* Add Product Modal */}\r\n      <AddProductModal\r\n        isOpen={isAddModalOpen}\r\n        onClose={() => setIsAddModalOpen(false)}\r\n      />\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog open={!!productToDelete} onOpenChange={() => setProductToDelete(null)}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Delete Product</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Are you sure you want to delete \"{productToDelete?.name}\"? This action cannot be undone.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteProduct}\r\n              disabled={isDeleting}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? \"Deleting...\" : \"Delete\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n\r\n  // Embedded mode - just render content\r\n  if (embedded) {\r\n    return content;\r\n  }\r\n\r\n  // Standalone mode - full page layout\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground\">\r\n      {/* Background */}\r\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-primary/5 blur-[120px] rounded-full\" />\r\n        <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-500/5 blur-[120px] rounded-full\" />\r\n      </div>\r\n\r\n      <Header currentPage=\"settings\" />\r\n\r\n      <main className=\"container max-w-6xl mx-auto px-4 sm:px-6 pt-24 pb-20 relative z-10\">\r\n        {content}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\QuotaDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\SocialAccounts.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1579,1582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1579,1582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAccounts'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAccounts]","fix":{"range":[1898,1900],"text":"[fetchAccounts]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2684,2687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2684,2687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Header } from '@/components/layout/Header';\r\n\r\ninterface SocialAccountsProps {\r\n  embedded?: boolean;\r\n}\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { ConnectedAccountCard } from '@/components/social/ConnectedAccountCard';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { SocialConnection } from '@/types/social';\r\nimport { RefreshCw, Link as LinkIcon, AlertCircle, ExternalLink } from 'lucide-react';\r\n\r\nexport default function SocialAccounts({ embedded = false }: SocialAccountsProps) {\r\n  const { toast } = useToast();\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [accounts, setAccounts] = useState<SocialConnection[]>([]);\r\n\r\n  // Fetch connected accounts\r\n  const fetchAccounts = async (showToast = false) => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      const response = await fetch('/api/social/accounts', {\r\n        credentials: 'include',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch social accounts');\r\n      }\r\n\r\n      const data = await response.json();\r\n      setAccounts(data.accounts || []);\r\n\r\n      if (showToast) {\r\n        toast({\r\n          title: 'Accounts Refreshed',\r\n          description: 'Successfully refreshed your social media accounts.',\r\n          variant: 'default',\r\n        });\r\n      }\r\n    } catch (error: any) {\r\n      toast({\r\n        title: 'Error',\r\n        description: error.message || 'Failed to load social accounts',\r\n        variant: 'destructive',\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n      setRefreshing(false);\r\n    }\r\n  };\r\n\r\n  // Initial load\r\n  useEffect(() => {\r\n    fetchAccounts();\r\n  }, []);\r\n\r\n  // Handle refresh button\r\n  const handleRefreshAll = async () => {\r\n    setRefreshing(true);\r\n    await fetchAccounts(true);\r\n  };\r\n\r\n  // Disconnect account\r\n  const handleDisconnect = async (accountId: string) => {\r\n    try {\r\n      const response = await fetch(`/api/social/accounts/${accountId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(error.error || 'Failed to disconnect account');\r\n      }\r\n\r\n      toast({\r\n        title: 'Account Disconnected',\r\n        description: 'Social media account has been disconnected.',\r\n        variant: 'default',\r\n      });\r\n\r\n      // Reload accounts\r\n      await fetchAccounts();\r\n    } catch (error: any) {\r\n      toast({\r\n        title: 'Disconnect Failed',\r\n        description: error.message || 'Failed to disconnect account',\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={embedded ? '' : 'min-h-screen bg-background'}>\r\n      {!embedded && <Header currentPage=\"settings\" />}\r\n\r\n      <main className=\"container mx-auto px-4 py-6 max-w-5xl\">\r\n        {/* Header */}\r\n        <div className=\"mb-6\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div>\r\n              <h1 className=\"text-2xl font-bold\">Social Media Accounts</h1>\r\n              <p className=\"text-muted-foreground mt-1\">\r\n                Manage your social media accounts connected via n8n for automated posting\r\n              </p>\r\n            </div>\r\n            <Button\r\n              onClick={handleRefreshAll}\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              disabled={loading || refreshing}\r\n              className=\"gap-2\"\r\n            >\r\n              <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />\r\n              {refreshing ? 'Refreshing...' : 'Refresh'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Loading state */}\r\n        {loading ? (\r\n          <div\r\n            className=\"space-y-4\"\r\n            role=\"status\"\r\n            aria-live=\"polite\"\r\n            aria-busy=\"true\"\r\n            aria-label=\"Loading social accounts\"\r\n          >\r\n            <Skeleton className=\"h-48 w-full\" />\r\n            <Skeleton className=\"h-48 w-full\" />\r\n            <Skeleton className=\"h-32 w-full\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-6\">\r\n            {/* Connected Accounts */}\r\n            {accounts.length > 0 && (\r\n              <div className=\"space-y-4\">\r\n                <h2 className=\"text-lg font-semibold flex items-center gap-2\">\r\n                  <LinkIcon className=\"w-5 h-5\" />\r\n                  Connected Accounts ({accounts.length})\r\n                </h2>\r\n\r\n                {/* All Connected Accounts */}\r\n                {accounts.map((account) => (\r\n                  <ConnectedAccountCard key={account.id} account={account} onDisconnect={handleDisconnect} />\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Empty state */}\r\n            {accounts.length === 0 && (\r\n              <Card>\r\n                <CardContent className=\"p-12 text-center\">\r\n                  <div className=\"p-3 rounded-full bg-muted inline-flex mb-4\">\r\n                    <LinkIcon className=\"w-8 h-8 text-muted-foreground\" />\r\n                  </div>\r\n                  <h3 className=\"text-lg font-medium mb-2\">No Connected Accounts</h3>\r\n                  <p className=\"text-muted-foreground mb-6\">\r\n                    Configure OAuth in n8n and sync your accounts to start posting content automatically.\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n            )}\r\n\r\n            {/* n8n Setup Instructions */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-lg\">Connect Social Media Accounts via n8n</CardTitle>\r\n                <CardDescription>\r\n                  OAuth authentication is managed through n8n for security and ease of use\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-6\">\r\n                  {/* Setup instructions */}\r\n                  <div className=\"space-y-4\">\r\n                    <h3 className=\"font-semibold text-sm\">Setup Instructions:</h3>\r\n                    <ol className=\"list-decimal list-inside space-y-3 text-sm\">\r\n                      <li className=\"pl-2\">\r\n                        <span className=\"font-medium\">Configure OAuth in n8n</span>\r\n                        <p className=\"ml-6 mt-1 text-muted-foreground\">\r\n                          Go to n8n  Settings  Credentials  Add Credential, then select the platform you want to\r\n                          connect (LinkedIn, Instagram, Facebook, etc.)\r\n                        </p>\r\n                      </li>\r\n                      <li className=\"pl-2\">\r\n                        <span className=\"font-medium\">Complete OAuth flow</span>\r\n                        <p className=\"ml-6 mt-1 text-muted-foreground\">\r\n                          Click \"Connect my account\" in n8n and authorize the application\r\n                        </p>\r\n                      </li>\r\n                      <li className=\"pl-2\">\r\n                        <span className=\"font-medium\">Sync accounts to this app</span>\r\n                        <p className=\"ml-6 mt-1 text-muted-foreground\">\r\n                          Accounts will be synced automatically once the integration is complete\r\n                        </p>\r\n                      </li>\r\n                    </ol>\r\n                  </div>\r\n\r\n                  {/* Sync button */}\r\n                  <div className=\"flex gap-3\">\r\n                    {/* TODO: Wire to /api/social/sync-accounts when n8n sync is implemented */}\r\n                    <Button variant=\"outline\" className=\"gap-2\" asChild>\r\n                      <a\r\n                        href=\"https://docs.n8n.io/integrations/builtin/credentials/\"\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                      >\r\n                        <ExternalLink className=\"w-4 h-4\" />\r\n                        n8n Documentation\r\n                      </a>\r\n                    </Button>\r\n                  </div>\r\n\r\n                  {/* Supported platforms */}\r\n                  <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                    <div className=\"flex gap-3\">\r\n                      <AlertCircle className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\r\n                      <div className=\"space-y-2 text-sm\">\r\n                        <p className=\"font-medium text-blue-900 dark:text-blue-100\">Supported Platforms:</p>\r\n                        <ul className=\"list-disc list-inside space-y-1 text-blue-800 dark:text-blue-200\">\r\n                          <li>\r\n                            <strong>LinkedIn:</strong> Personal profiles and company pages supported\r\n                          </li>\r\n                          <li>\r\n                            <strong>Instagram:</strong> Business or Creator accounts only (via Facebook Graph API)\r\n                          </li>\r\n                          <li>\r\n                            <strong>Facebook:</strong> Pages and groups\r\n                          </li>\r\n                          <li>\r\n                            <strong>Twitter/X:</strong> Standard and premium API tiers\r\n                          </li>\r\n                          <li>\r\n                            <strong>TikTok:</strong> Business accounts\r\n                          </li>\r\n                          <li>\r\n                            <strong>YouTube:</strong> Channels\r\n                          </li>\r\n                          <li>\r\n                            <strong>Pinterest:</strong> Business accounts\r\n                          </li>\r\n                        </ul>\r\n                        <p className=\"mt-3 text-blue-800 dark:text-blue-200\">\r\n                          <strong>Note:</strong> n8n automatically handles token refresh and expiration, so you don't\r\n                          need to worry about re-authorizing.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        )}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Studio.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1865,1868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1865,1868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1893,1896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1893,1896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2799,2802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2799,2802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Studio  Unified creative workspace\r\n *\r\n * Thin orchestrator (~250 lines) that delegates to:\r\n * - useStudioOrchestrator: all state + handlers\r\n * - ComposerView: idle state (prompt, products, templates, generate)\r\n * - GeneratingView: loading animation\r\n * - ResultViewEnhanced: result state (image, actions, edit, copy)\r\n * - HistoryPanel: right-side generation history\r\n * - SaveToCatalogDialog / TemplateInspirationDialog: modal overlays\r\n *\r\n * Previously 2,963 lines. Decomposed in Phase 2 of Unified Studio redesign.\r\n */\r\n\r\nimport { AnimatePresence, motion } from 'framer-motion';\r\nimport { Link } from 'wouter';\r\nimport { cn } from '@/lib/utils';\r\n\r\n// Components\r\nimport { Header } from '@/components/layout/Header';\r\nimport { StudioProvider } from '@/context/StudioContext';\r\nimport { ComposerView, ResultViewEnhanced, GeneratingView } from '@/components/studio/MainCanvas';\r\nimport { InspectorPanel } from '@/components/studio/InspectorPanel';\r\nimport { IdeaBankBar } from '@/components/studio/IdeaBankBar';\r\nimport { HistoryPanel } from '@/components/studio/HistoryPanel';\r\nimport { AgentChatPanel } from '@/components/studio/AgentChat';\r\nimport { SaveToCatalogDialog } from '@/components/SaveToCatalogDialog';\r\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Sparkles, History, TrendingUp, Star, Layout, X } from 'lucide-react';\r\n\r\n// Hooks\r\nimport { useStudioOrchestrator } from '@/hooks/useStudioOrchestrator';\r\n\r\n//  Helper Components \r\n\r\nfunction ContextBar({\r\n  selectedProducts,\r\n  selectedTemplate,\r\n  platform,\r\n  visible,\r\n}: {\r\n  selectedProducts: any[];\r\n  selectedTemplate: any;\r\n  platform: string;\r\n  visible: boolean;\r\n}) {\r\n  if (!visible) return null;\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: -20 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      exit={{ opacity: 0, y: -20 }}\r\n      className=\"fixed top-20 left-1/2 -translate-x-1/2 z-40 bg-background/90 backdrop-blur-md border border-border rounded-full px-4 py-2 flex items-center gap-3 shadow-lg\"\r\n    >\r\n      <span className=\"text-xs text-muted-foreground\">\r\n        {selectedProducts.length} product{selectedProducts.length !== 1 ? 's' : ''}\r\n      </span>\r\n      {selectedTemplate && <span className=\"text-xs text-primary\">{selectedTemplate.title}</span>}\r\n      <span className=\"text-xs text-muted-foreground\">{platform}</span>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\nfunction KeyboardShortcutsPanel({\r\n  visible,\r\n  shortcuts,\r\n  onClose,\r\n  onToggle,\r\n  haptic,\r\n}: {\r\n  visible: boolean;\r\n  shortcuts: any[];\r\n  onClose: () => void;\r\n  onToggle: () => void;\r\n  haptic: (intensity: string) => void;\r\n}) {\r\n  return (\r\n    <div className=\"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3\">\r\n      {visible && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20, scale: 0.95 }}\r\n          animate={{ opacity: 1, y: 0, scale: 1 }}\r\n          exit={{ opacity: 0, y: 20, scale: 0.95 }}\r\n          className=\"glass rounded-xl shadow-lg p-5 w-80\"\r\n        >\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-sm font-semibold flex items-center gap-2\">\r\n              <Sparkles className=\"w-4 h-4\" /> Keyboard Shortcuts\r\n            </h3>\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\r\n              <X className=\"w-4 h-4\" />\r\n            </Button>\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            {shortcuts.map((s, i) => (\r\n              <div\r\n                key={i}\r\n                className={cn(\r\n                  'flex items-center justify-between text-xs py-2 px-2.5 rounded-lg',\r\n                  s.disabled ? 'opacity-40' : 'hover:bg-muted/50',\r\n                )}\r\n              >\r\n                <span>{s.description}</span>\r\n                <div className=\"flex gap-1\">\r\n                  {s.ctrlKey && <kbd className=\"px-2 py-1 text-[10px] rounded bg-muted border font-mono\">Ctrl</kbd>}\r\n                  {s.shiftKey && <kbd className=\"px-2 py-1 text-[10px] rounded bg-muted border font-mono\">Shift</kbd>}\r\n                  <kbd className=\"px-2 py-1 text-[10px] rounded bg-muted border font-mono\">{s.key.toUpperCase()}</kbd>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n      <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>\r\n        <Button\r\n          variant=\"secondary\"\r\n          size=\"sm\"\r\n          onClick={() => {\r\n            haptic('light');\r\n            onToggle();\r\n          }}\r\n          className={cn(\r\n            'glass h-11 w-11 rounded-full p-0 flex items-center justify-center',\r\n            visible && 'ring-2 ring-primary/30',\r\n          )}\r\n          title=\"Keyboard Shortcuts (Shift + ?)\"\r\n        >\r\n          <span className=\"text-base font-semibold\">?</span>\r\n        </Button>\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\n//  Main Component \r\n\r\nexport default function Studio() {\r\n  const orch = useStudioOrchestrator();\r\n\r\n  return (\r\n    <StudioProvider>\r\n      <div className=\"min-h-screen bg-background text-foreground relative\">\r\n        {/* Background Ambience */}\r\n        <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n          <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-gradient-to-br from-primary/10 via-purple-500/8 to-transparent blur-[120px] rounded-full animate-float\" />\r\n          <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-gradient-to-tl from-blue-500/10 via-cyan-500/8 to-transparent blur-[120px] rounded-full animate-float-delayed\" />\r\n        </div>\r\n\r\n        <Header currentPage=\"studio\" />\r\n\r\n        {/* Context Bar */}\r\n        <AnimatePresence>\r\n          <ContextBar\r\n            selectedProducts={orch.selectedProducts}\r\n            selectedTemplate={orch.selectedTemplate}\r\n            platform={orch.platform}\r\n            visible={orch.showContextBar}\r\n          />\r\n        </AnimatePresence>\r\n\r\n        {/* Main Content */}\r\n        <main\r\n          className={cn(\r\n            'container mx-auto px-6 pt-24 pb-24 lg:pb-12 relative z-10',\r\n            orch.historyPanelOpen ? 'max-w-[1600px]' : 'max-w-7xl',\r\n          )}\r\n        >\r\n          {/* Agent Chat Panel */}\r\n          <AgentChatPanel orch={orch} />\r\n\r\n          {/* Hero */}\r\n          <motion.div\r\n            ref={orch.heroRef}\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className=\"text-center space-y-4 py-8\"\r\n          >\r\n            <h1 className=\"font-display text-4xl md:text-5xl font-bold tracking-tight bg-gradient-to-b from-zinc-900 to-zinc-900/60 dark:from-white dark:to-white/60 bg-clip-text text-transparent\">\r\n              Create stunning product visuals\r\n            </h1>\r\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\r\n              Select products, describe your vision, and generate professional marketing content in minutes.\r\n            </p>\r\n            <div className=\"flex justify-center gap-3 pt-2\">\r\n              <Button variant=\"outline\" size=\"sm\" onClick={orch.handleHistoryToggle} className=\"gap-2\">\r\n                <History className=\"w-4 h-4\" />\r\n                {orch.historyPanelOpen ? 'Hide History' : 'History'}\r\n              </Button>\r\n            </div>\r\n          </motion.div>\r\n\r\n          {/* Grid: Center + Right + History */}\r\n          <div\r\n            className={cn(\r\n              'lg:grid lg:gap-8',\r\n              orch.historyPanelOpen ? 'lg:grid-cols-[1fr_400px_320px]' : 'lg:grid-cols-[1fr_400px]',\r\n            )}\r\n          >\r\n            {/* Center Column  State Machine */}\r\n            <div className=\"min-w-0\">\r\n              <AnimatePresence mode=\"wait\">\r\n                {orch.state === 'idle' && <ComposerView key=\"composer\" orch={orch} />}\r\n                {orch.state === 'generating' && (\r\n                  <GeneratingView\r\n                    key=\"generating\"\r\n                    onCancel={orch.handleCancelGeneration}\r\n                    mediaType={orch.generatedMediaType}\r\n                  />\r\n                )}\r\n                {orch.state === 'result' && <ResultViewEnhanced key=\"result\" orch={orch} />}\r\n              </AnimatePresence>\r\n            </div>\r\n\r\n            {/* Right Column  Inspector Panel (desktop) */}\r\n            <div className=\"hidden lg:block min-w-0\">\r\n              <div className=\"sticky top-24 max-h-[calc(100vh-120px)] rounded-2xl border border-border bg-card/30 overflow-hidden\">\r\n                <InspectorPanel orch={orch} />\r\n              </div>\r\n            </div>\r\n\r\n            {/* History Panel */}\r\n            <HistoryPanel\r\n              isOpen={orch.historyPanelOpen}\r\n              onToggle={orch.handleHistoryToggle}\r\n              onSelectGeneration={(id) => {\r\n                orch.selectGeneration(id);\r\n                fetch(`/api/generations/${id}`, { credentials: 'include' })\r\n                  .then((r) => r.json())\r\n                  .then((data) => {\r\n                    if (data.imageUrl) orch.handleLoadFromHistory(data);\r\n                  })\r\n                  .catch(console.error);\r\n              }}\r\n              className=\"hidden lg:flex\"\r\n            />\r\n          </div>\r\n\r\n          {/* Idea Bank Bar  Horizontal suggestions */}\r\n          <div className=\"mt-6 hidden lg:block\">\r\n            <IdeaBankBar orch={orch} />\r\n          </div>\r\n        </main>\r\n\r\n        {/* Mobile Inspector  Bottom Sheet */}\r\n        {orch.generatedImage && (\r\n          <div className=\"lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-background/95 backdrop-blur-md border-t max-h-[60vh] overflow-y-auto\">\r\n            <InspectorPanel orch={orch} />\r\n          </div>\r\n        )}\r\n\r\n        {/* Save to Catalog Dialog */}\r\n        {orch.generatedImage && (\r\n          <ErrorBoundary>\r\n            <SaveToCatalogDialog\r\n              isOpen={orch.showSaveToCatalog}\r\n              onClose={() => orch.setShowSaveToCatalog(false)}\r\n              imageUrl={orch.generatedImage}\r\n              defaultName={`Generated - ${new Date().toLocaleDateString()}`}\r\n            />\r\n          </ErrorBoundary>\r\n        )}\r\n\r\n        {/* Template Inspiration Dialog */}\r\n        <Dialog open={orch.showTemplateInspiration} onOpenChange={orch.setShowTemplateInspiration}>\r\n          <DialogContent className=\"max-w-4xl max-h-[85vh] overflow-hidden flex flex-col\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"flex items-center gap-2\">\r\n                <TrendingUp className=\"w-5 h-5\" /> Template Inspiration\r\n              </DialogTitle>\r\n              <DialogDescription>Browse high-performing ad references for creative direction</DialogDescription>\r\n            </DialogHeader>\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {orch.isLoadingFeatured ? (\r\n                <div className=\"flex items-center justify-center py-20\">\r\n                  <div className=\"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\r\n                </div>\r\n              ) : orch.featuredAdTemplates.length === 0 ? (\r\n                <div className=\"text-center py-20 text-muted-foreground\">\r\n                  <p>No featured templates yet.</p>\r\n                  <Link href=\"/templates\">\r\n                    <Button variant=\"link\" className=\"mt-2\">\r\n                      Browse template library\r\n                    </Button>\r\n                  </Link>\r\n                </div>\r\n              ) : (\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 p-1\">\r\n                  {orch.featuredAdTemplates.map((template) => (\r\n                    <button\r\n                      key={template.id}\r\n                      onClick={() => orch.handleSelectPerformingTemplate(template)}\r\n                      className=\"rounded-xl border border-border bg-card overflow-hidden hover:border-primary/50 transition-colors text-left\"\r\n                    >\r\n                      <div className=\"aspect-[4/3] overflow-hidden bg-muted relative\">\r\n                        {template.previewImageUrl ? (\r\n                          <img\r\n                            src={template.previewImageUrl}\r\n                            alt={template.name}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        ) : (\r\n                          <div className=\"w-full h-full flex items-center justify-center\">\r\n                            <Layout className=\"w-10 h-10 text-muted-foreground/30\" />\r\n                          </div>\r\n                        )}\r\n                        {template.isFeatured && (\r\n                          <Badge className=\"absolute top-2 left-2 bg-yellow-500/90 text-yellow-950 text-xs\">\r\n                            <Star className=\"w-3 h-3 mr-1 fill-current\" /> Featured\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"p-3 space-y-1\">\r\n                        <h4 className=\"font-medium text-sm line-clamp-1\">{template.name}</h4>\r\n                        <div className=\"flex flex-wrap gap-1\">\r\n                          {template.mood && (\r\n                            <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-purple-500/10\">{template.mood}</span>\r\n                          )}\r\n                          {template.style && (\r\n                            <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-blue-500/10\">{template.style}</span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        {/* Keyboard Shortcuts */}\r\n        <KeyboardShortcutsPanel\r\n          visible={orch.showKeyboardShortcuts}\r\n          shortcuts={orch.shortcuts}\r\n          onClose={() => orch.setShowKeyboardShortcuts(false)}\r\n          onToggle={() => orch.setShowKeyboardShortcuts(!orch.showKeyboardShortcuts)}\r\n          haptic={orch.haptic}\r\n        />\r\n      </div>\r\n    </StudioProvider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\TemplateAdmin.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6545,6548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6545,6548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { Link } from 'wouter';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { cn } from '@/lib/utils';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { ArrowLeft, Plus, Trash2, Edit2, RefreshCw, Image as ImageIcon, X, Check, AlertTriangle } from 'lucide-react';\r\nimport type { AdSceneTemplate } from '@shared/schema';\r\nimport { Header } from '@/components/layout/Header';\r\n\r\nconst categories = [\r\n  { value: 'product_showcase', label: 'Product Showcase' },\r\n  { value: 'installation', label: 'Installation' },\r\n  { value: 'worksite', label: 'Worksite' },\r\n  { value: 'professional', label: 'Professional' },\r\n  { value: 'outdoor', label: 'Outdoor' },\r\n];\r\n\r\nconst lightingStyles = ['natural', 'studio', 'dramatic', 'soft', 'golden-hour', 'warm'];\r\nconst intents = ['showcase', 'installation', 'before-after', 'scale-demo', 'product-focus', 'worksite'];\r\nconst environments = ['indoor', 'outdoor', 'studio', 'worksite'];\r\nconst moods = ['industrial', 'professional', 'bold', 'minimal', 'urgent', 'technical', 'reliable'];\r\n\r\ninterface TemplateFormData {\r\n  title: string;\r\n  description: string;\r\n  category: string;\r\n  promptBlueprint: string;\r\n  tags: string[];\r\n  platformHints: string[];\r\n  aspectRatioHints: string[];\r\n  placementHints: { position: string; scale: string };\r\n  lightingStyle: string;\r\n  intent: string;\r\n  environment: string;\r\n  mood: string;\r\n  bestForProductTypes: string[];\r\n  isGlobal: boolean;\r\n  previewImageUrl: string;\r\n  previewPublicId: string;\r\n}\r\n\r\nconst emptyFormData: TemplateFormData = {\r\n  title: '',\r\n  description: '',\r\n  category: 'product_showcase',\r\n  promptBlueprint: '',\r\n  tags: [],\r\n  platformHints: [],\r\n  aspectRatioHints: [],\r\n  placementHints: { position: 'center', scale: 'medium' },\r\n  lightingStyle: 'natural',\r\n  intent: 'showcase',\r\n  environment: 'indoor',\r\n  mood: 'minimal',\r\n  bestForProductTypes: [],\r\n  isGlobal: true,\r\n  previewImageUrl: '',\r\n  previewPublicId: '',\r\n};\r\n\r\ninterface TemplateAdminProps {\r\n  embedded?: boolean;\r\n}\r\n\r\nexport default function TemplateAdmin({ embedded }: TemplateAdminProps = {}) {\r\n  const queryClient = useQueryClient();\r\n  const { toast } = useToast();\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [editingId, setEditingId] = useState<string | null>(null);\r\n  const [formData, setFormData] = useState<TemplateFormData>(emptyFormData);\r\n  const [tagInput, setTagInput] = useState('');\r\n  const [productTypeInput, setProductTypeInput] = useState('');\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n\r\n  // Fetch templates\r\n  const {\r\n    data: templates = [],\r\n    isLoading,\r\n    refetch,\r\n  } = useQuery<AdSceneTemplate[]>({\r\n    queryKey: ['admin-templates'],\r\n    queryFn: async () => {\r\n      const res = await fetch('/api/ad-templates', { credentials: 'include' });\r\n      if (!res.ok) throw new Error('Failed to fetch templates');\r\n      return res.json();\r\n    },\r\n  });\r\n\r\n  // Create mutation\r\n  const createMutation = useMutation({\r\n    mutationFn: async (data: TemplateFormData) => {\r\n      const res = await fetch('/api/ad-templates', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || 'Failed to create template');\r\n      }\r\n      return res.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin-templates'] });\r\n      setShowForm(false);\r\n      setFormData(emptyFormData);\r\n      toast({\r\n        title: 'Template created',\r\n        description: 'The template has been created successfully.',\r\n      });\r\n    },\r\n    onError: (error: Error) => {\r\n      toast({\r\n        title: 'Failed to create template',\r\n        description: error.message,\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n\r\n  // Update mutation\r\n  const updateMutation = useMutation({\r\n    mutationFn: async ({ id, data }: { id: string; data: Partial<TemplateFormData> }) => {\r\n      const res = await fetch(`/api/ad-templates/${id}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify(data),\r\n      });\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || 'Failed to update template');\r\n      }\r\n      return res.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin-templates'] });\r\n      setShowForm(false);\r\n      setEditingId(null);\r\n      setFormData(emptyFormData);\r\n      toast({\r\n        title: 'Template updated',\r\n        description: 'The template has been updated successfully.',\r\n      });\r\n    },\r\n    onError: (error: Error) => {\r\n      toast({\r\n        title: 'Failed to update template',\r\n        description: error.message,\r\n        variant: 'destructive',\r\n      });\r\n    },\r\n  });\r\n\r\n  // Delete mutation\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const res = await fetch(`/api/ad-templates/${id}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n      });\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || 'Failed to delete template');\r\n      }\r\n      return res.json();\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['admin-templates'] });\r\n      setDeleteConfirmId(null);\r\n      toast({\r\n        title: 'Template deleted',\r\n        description: 'The template has been deleted successfully.',\r\n      });\r\n    },\r\n    onError: (error: Error) => {\r\n      toast({\r\n        title: 'Failed to delete template',\r\n        description: error.message,\r\n        variant: 'destructive',\r\n      });\r\n      setDeleteConfirmId(null);\r\n    },\r\n  });\r\n\r\n  const handleEdit = (template: AdSceneTemplate) => {\r\n    setEditingId(template.id);\r\n    setFormData({\r\n      title: template.title,\r\n      description: template.description || '',\r\n      category: template.category,\r\n      promptBlueprint: template.promptBlueprint,\r\n      tags: template.tags || [],\r\n      platformHints: template.platformHints || [],\r\n      aspectRatioHints: template.aspectRatioHints || [],\r\n      placementHints: (template.placementHints as any) || { position: 'center', scale: 'medium' },\r\n      lightingStyle: template.lightingStyle || 'natural',\r\n      intent: template.intent || 'showcase',\r\n      environment: template.environment || 'indoor',\r\n      mood: template.mood || 'minimal',\r\n      bestForProductTypes: template.bestForProductTypes || [],\r\n      isGlobal: template.isGlobal ?? true,\r\n      previewImageUrl: template.previewImageUrl || '',\r\n      previewPublicId: template.previewPublicId || '',\r\n    });\r\n    setShowForm(true);\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!formData.promptBlueprint.includes('{{product}}')) {\r\n      alert('Prompt blueprint must contain {{product}} placeholder');\r\n      return;\r\n    }\r\n\r\n    if (editingId) {\r\n      updateMutation.mutate({ id: editingId, data: formData });\r\n    } else {\r\n      createMutation.mutate(formData);\r\n    }\r\n  };\r\n\r\n  const addTag = () => {\r\n    if (tagInput.trim() && !formData.tags.includes(tagInput.trim())) {\r\n      setFormData({ ...formData, tags: [...formData.tags, tagInput.trim()] });\r\n      setTagInput('');\r\n    }\r\n  };\r\n\r\n  const removeTag = (tag: string) => {\r\n    setFormData({ ...formData, tags: formData.tags.filter((t) => t !== tag) });\r\n  };\r\n\r\n  const addProductType = () => {\r\n    if (productTypeInput.trim() && !formData.bestForProductTypes.includes(productTypeInput.trim())) {\r\n      setFormData({ ...formData, bestForProductTypes: [...formData.bestForProductTypes, productTypeInput.trim()] });\r\n      setProductTypeInput('');\r\n    }\r\n  };\r\n\r\n  const removeProductType = (type: string) => {\r\n    setFormData({ ...formData, bestForProductTypes: formData.bestForProductTypes.filter((t) => t !== type) });\r\n  };\r\n\r\n  const toggleArrayItem = (field: 'platformHints' | 'aspectRatioHints', value: string) => {\r\n    const current = formData[field];\r\n    if (current.includes(value)) {\r\n      setFormData({ ...formData, [field]: current.filter((v) => v !== value) });\r\n    } else {\r\n      setFormData({ ...formData, [field]: [...current, value] });\r\n    }\r\n  };\r\n\r\n  const actionBar = (\r\n    <div className=\"flex items-center justify-between mb-6\">\r\n      <div className=\"flex items-center gap-4\">\r\n        {!embedded && (\r\n          <>\r\n            <Link href=\"/library?tab=scene-templates\">\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\r\n                <ArrowLeft className=\"w-4 h-4\" />\r\n                Back to Gen Templates\r\n              </Button>\r\n            </Link>\r\n            <div className=\"h-6 w-px bg-muted/50\" />\r\n          </>\r\n        )}\r\n        <h1 className=\"font-semibold\">{embedded ? 'Gen Template Admin' : 'Template Admin'}</h1>\r\n      </div>\r\n      <div className=\"flex items-center gap-2\">\r\n        <Button variant=\"outline\" size=\"sm\" onClick={() => refetch()}>\r\n          <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n          Refresh\r\n        </Button>\r\n        <Button\r\n          onClick={() => {\r\n            setEditingId(null);\r\n            setFormData(emptyFormData);\r\n            setShowForm(true);\r\n          }}\r\n        >\r\n          <Plus className=\"w-4 h-4 mr-2\" />\r\n          New Template\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (embedded) {\r\n    return (\r\n      <div>\r\n        {actionBar}\r\n\r\n        {/* Templates Table */}\r\n        {!showForm && (\r\n          <div className=\"rounded-xl border border-border overflow-hidden\">\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead className=\"bg-card/50\">\r\n                  <tr className=\"text-left text-sm text-muted-foreground\">\r\n                    <th className=\"px-4 py-3\">Preview</th>\r\n                    <th className=\"px-4 py-3\">Title</th>\r\n                    <th className=\"px-4 py-3\">Category</th>\r\n                    <th className=\"px-4 py-3\">Platforms</th>\r\n                    <th className=\"px-4 py-3\">Global</th>\r\n                    <th className=\"px-4 py-3\">Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-white/5\">\r\n                  {isLoading ? (\r\n                    <tr>\r\n                      <td colSpan={6} className=\"px-4 py-8 text-center text-muted-foreground\">\r\n                        Loading templates...\r\n                      </td>\r\n                    </tr>\r\n                  ) : templates.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan={6} className=\"px-4 py-8 text-center text-muted-foreground\">\r\n                        No templates found. Click \"New Template\" to create one.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    templates.map((template) => (\r\n                      <tr key={template.id} className=\"hover:bg-card/30 transition-colors\">\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"w-16 h-16 rounded-lg border border-border bg-card overflow-hidden relative\">\r\n                            {template.previewImageUrl ? (\r\n                              <img\r\n                                src={template.previewImageUrl}\r\n                                alt={template.title}\r\n                                className=\"w-full h-full object-cover\"\r\n                                onError={(e) => {\r\n                                  const target = e.target as HTMLImageElement;\r\n                                  target.style.display = 'none';\r\n                                  const fallback = target.nextElementSibling as HTMLElement;\r\n                                  if (fallback) fallback.style.display = 'flex';\r\n                                }}\r\n                              />\r\n                            ) : null}\r\n                            <div\r\n                              className=\"w-full h-full items-center justify-center absolute inset-0\"\r\n                              style={{ display: template.previewImageUrl ? 'none' : 'flex' }}\r\n                            >\r\n                              <ImageIcon className=\"w-6 h-6 text-muted-foreground\" />\r\n                            </div>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"font-medium\">{template.title}</div>\r\n                          <div className=\"text-xs text-muted-foreground line-clamp-1\">{template.description}</div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <span className=\"px-2 py-1 text-xs rounded-md bg-primary/10 text-primary border border-primary/20\">\r\n                            {template.category}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"flex gap-1 flex-wrap\">\r\n                            {template.platformHints?.slice(0, 2).map((p) => (\r\n                              <span key={p} className=\"px-1.5 py-0.5 text-xs rounded bg-muted/30 text-muted-foreground\">\r\n                                {p}\r\n                              </span>\r\n                            ))}\r\n                            {(template.platformHints?.length || 0) > 2 && (\r\n                              <span className=\"text-xs text-muted-foreground\">\r\n                                +{template.platformHints!.length - 2}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          {template.isGlobal ? (\r\n                            <Check className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\r\n                          ) : (\r\n                            <X className=\"w-4 h-4 text-muted-foreground\" />\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEdit(template)}>\r\n                              <Edit2 className=\"w-4 h-4\" />\r\n                            </Button>\r\n                            {deleteConfirmId === template.id ? (\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Button\r\n                                  variant=\"destructive\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => deleteMutation.mutate(template.id)}\r\n                                >\r\n                                  Confirm\r\n                                </Button>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeleteConfirmId(null)}>\r\n                                  Cancel\r\n                                </Button>\r\n                              </div>\r\n                            ) : (\r\n                              <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeleteConfirmId(template.id)}>\r\n                                <Trash2 className=\"w-4 h-4 text-destructive\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Template Form */}\r\n        {showForm && (\r\n          <div className=\"max-w-3xl mx-auto\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-semibold\">{editingId ? 'Edit Template' : 'Create New Template'}</h2>\r\n              <Button variant=\"ghost\" onClick={() => setShowForm(false)}>\r\n                <X className=\"w-4 h-4 mr-2\" />\r\n                Cancel\r\n              </Button>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n              {/* Basic Info */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Basic Information</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div className=\"col-span-2\">\r\n                    <label className=\"block text-sm font-medium mb-2\">Title *</label>\r\n                    <Input\r\n                      value={formData.title}\r\n                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                      placeholder=\"Modern Living Room Showcase\"\r\n                      required\r\n                    />\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <label className=\"block text-sm font-medium mb-2\">Description</label>\r\n                    <textarea\r\n                      value={formData.description}\r\n                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                      placeholder=\"Brief description of the template...\"\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm resize-none\"\r\n                      rows={2}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Category *</label>\r\n                    <select\r\n                      value={formData.category}\r\n                      onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                      required\r\n                    >\r\n                      {categories.map((c) => (\r\n                        <option key={c.value} value={c.value}>\r\n                          {c.label}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Preview Image URL</label>\r\n                    <Input\r\n                      value={formData.previewImageUrl}\r\n                      onChange={(e) => setFormData({ ...formData, previewImageUrl: e.target.value })}\r\n                      placeholder=\"https://res.cloudinary.com/...\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Prompt Blueprint */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Prompt Blueprint</h3>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-2\">\r\n                    Blueprint *{' '}\r\n                    <span className=\"text-muted-foreground font-normal\">(use {'{{product}}'} as placeholder)</span>\r\n                  </label>\r\n                  <textarea\r\n                    value={formData.promptBlueprint}\r\n                    onChange={(e) => setFormData({ ...formData, promptBlueprint: e.target.value })}\r\n                    placeholder=\"Professional interior photograph of {{product}} installed in a modern minimalist living room...\"\r\n                    className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm resize-none font-mono\"\r\n                    rows={4}\r\n                    required\r\n                  />\r\n                  {formData.promptBlueprint && !formData.promptBlueprint.includes('{{product}}') && (\r\n                    <p className=\"mt-2 text-xs text-yellow-600 dark:text-yellow-400 flex items-center gap-1\">\r\n                      <AlertTriangle className=\"w-3 h-3\" />\r\n                      Blueprint should contain {'{{product}}'} placeholder\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Platform & Aspect Ratio */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                  Platform Targeting\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Platforms</label>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {['instagram', 'linkedin', 'facebook', 'pinterest', 'tiktok'].map((p) => (\r\n                        <button\r\n                          key={p}\r\n                          type=\"button\"\r\n                          onClick={() => toggleArrayItem('platformHints', p)}\r\n                          className={cn(\r\n                            'px-3 py-1.5 text-sm rounded-lg border transition-colors',\r\n                            formData.platformHints.includes(p)\r\n                              ? 'bg-primary/20 border-primary/50 text-primary'\r\n                              : 'border-border hover:border-primary/50',\r\n                          )}\r\n                        >\r\n                          {p}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Aspect Ratios</label>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {['1:1', '4:5', '9:16', '16:9'].map((ar) => (\r\n                        <button\r\n                          key={ar}\r\n                          type=\"button\"\r\n                          onClick={() => toggleArrayItem('aspectRatioHints', ar)}\r\n                          className={cn(\r\n                            'px-3 py-1.5 text-sm rounded-lg border transition-colors',\r\n                            formData.aspectRatioHints.includes(ar)\r\n                              ? 'bg-primary/20 border-primary/50 text-primary'\r\n                              : 'border-border hover:border-primary/50',\r\n                          )}\r\n                        >\r\n                          {ar}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Style & Mood */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Style & Mood</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Lighting Style</label>\r\n                    <select\r\n                      value={formData.lightingStyle}\r\n                      onChange={(e) => setFormData({ ...formData, lightingStyle: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {lightingStyles.map((ls) => (\r\n                        <option key={ls} value={ls}>\r\n                          {ls}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Intent</label>\r\n                    <select\r\n                      value={formData.intent}\r\n                      onChange={(e) => setFormData({ ...formData, intent: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {intents.map((i) => (\r\n                        <option key={i} value={i}>\r\n                          {i}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Environment</label>\r\n                    <select\r\n                      value={formData.environment}\r\n                      onChange={(e) => setFormData({ ...formData, environment: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {environments.map((env) => (\r\n                        <option key={env} value={env}>\r\n                          {env}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Mood</label>\r\n                    <select\r\n                      value={formData.mood}\r\n                      onChange={(e) => setFormData({ ...formData, mood: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {moods.map((m) => (\r\n                        <option key={m} value={m}>\r\n                          {m}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Placement */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Placement Hints</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Position</label>\r\n                    <select\r\n                      value={formData.placementHints.position}\r\n                      onChange={(e) =>\r\n                        setFormData({\r\n                          ...formData,\r\n                          placementHints: { ...formData.placementHints, position: e.target.value },\r\n                        })\r\n                      }\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {['center', 'center-left', 'center-right', 'foreground', 'top', 'bottom'].map((p) => (\r\n                        <option key={p} value={p}>\r\n                          {p}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Scale</label>\r\n                    <select\r\n                      value={formData.placementHints.scale}\r\n                      onChange={(e) =>\r\n                        setFormData({\r\n                          ...formData,\r\n                          placementHints: { ...formData.placementHints, scale: e.target.value },\r\n                        })\r\n                      }\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {['small', 'medium', 'large', 'fill'].map((s) => (\r\n                        <option key={s} value={s}>\r\n                          {s}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                  Tags & Product Types\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Tags</label>\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                      <Input\r\n                        value={tagInput}\r\n                        onChange={(e) => setTagInput(e.target.value)}\r\n                        placeholder=\"Add tag...\"\r\n                        onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}\r\n                      />\r\n                      <Button type=\"button\" variant=\"outline\" onClick={addTag}>\r\n                        Add\r\n                      </Button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {formData.tags.map((tag) => (\r\n                        <span key={tag} className=\"px-2 py-1 text-xs rounded-md bg-muted/30 flex items-center gap-1\">\r\n                          {tag}\r\n                          <button type=\"button\" onClick={() => removeTag(tag)}>\r\n                            <X className=\"w-3 h-3\" />\r\n                          </button>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Best For Product Types</label>\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                      <Input\r\n                        value={productTypeInput}\r\n                        onChange={(e) => setProductTypeInput(e.target.value)}\r\n                        placeholder=\"Add product type...\"\r\n                        onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addProductType())}\r\n                      />\r\n                      <Button type=\"button\" variant=\"outline\" onClick={addProductType}>\r\n                        Add\r\n                      </Button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {formData.bestForProductTypes.map((type) => (\r\n                        <span key={type} className=\"px-2 py-1 text-xs rounded-md bg-muted/30 flex items-center gap-1\">\r\n                          {type}\r\n                          <button type=\"button\" onClick={() => removeProductType(type)}>\r\n                            <X className=\"w-3 h-3\" />\r\n                          </button>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Global Toggle */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30\">\r\n                <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={formData.isGlobal}\r\n                    onChange={(e) => setFormData({ ...formData, isGlobal: e.target.checked })}\r\n                    className=\"w-5 h-5 rounded border-border\"\r\n                  />\r\n                  <div>\r\n                    <span className=\"font-medium\">Make Global</span>\r\n                    <p className=\"text-sm text-muted-foreground\">Available to all users</p>\r\n                  </div>\r\n                </label>\r\n              </div>\r\n\r\n              {/* Submit */}\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  type=\"submit\"\r\n                  className=\"flex-1\"\r\n                  disabled={createMutation.isPending || updateMutation.isPending}\r\n                >\r\n                  {createMutation.isPending || updateMutation.isPending ? (\r\n                    <>\r\n                      <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                      Saving...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Check className=\"w-4 h-4 mr-2\" />\r\n                      {editingId ? 'Update Template' : 'Create Template'}\r\n                    </>\r\n                  )}\r\n                </Button>\r\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowForm(false)}>\r\n                  Cancel\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground\">\r\n      <Header currentPage=\"templates\" />\r\n\r\n      <main className=\"container max-w-7xl mx-auto px-6 pt-24 pb-20\">\r\n        {actionBar}\r\n\r\n        {/* Templates Table */}\r\n        {!showForm && (\r\n          <div className=\"rounded-xl border border-border overflow-hidden\">\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead className=\"bg-card/50\">\r\n                  <tr className=\"text-left text-sm text-muted-foreground\">\r\n                    <th className=\"px-4 py-3\">Preview</th>\r\n                    <th className=\"px-4 py-3\">Title</th>\r\n                    <th className=\"px-4 py-3\">Category</th>\r\n                    <th className=\"px-4 py-3\">Platforms</th>\r\n                    <th className=\"px-4 py-3\">Global</th>\r\n                    <th className=\"px-4 py-3\">Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-white/5\">\r\n                  {isLoading ? (\r\n                    <tr>\r\n                      <td colSpan={6} className=\"px-4 py-8 text-center text-muted-foreground\">\r\n                        Loading templates...\r\n                      </td>\r\n                    </tr>\r\n                  ) : templates.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan={6} className=\"px-4 py-8 text-center text-muted-foreground\">\r\n                        No templates found. Click \"New Template\" to create one.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    templates.map((template) => (\r\n                      <tr key={template.id} className=\"hover:bg-card/30 transition-colors\">\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"w-16 h-16 rounded-lg border border-border bg-card overflow-hidden relative\">\r\n                            {template.previewImageUrl ? (\r\n                              <img\r\n                                src={template.previewImageUrl}\r\n                                alt={template.title}\r\n                                className=\"w-full h-full object-cover\"\r\n                                onError={(e) => {\r\n                                  const target = e.target as HTMLImageElement;\r\n                                  target.style.display = 'none';\r\n                                  const fallback = target.nextElementSibling as HTMLElement;\r\n                                  if (fallback) fallback.style.display = 'flex';\r\n                                }}\r\n                              />\r\n                            ) : null}\r\n                            <div\r\n                              className=\"w-full h-full items-center justify-center absolute inset-0\"\r\n                              style={{ display: template.previewImageUrl ? 'none' : 'flex' }}\r\n                            >\r\n                              <ImageIcon className=\"w-6 h-6 text-muted-foreground\" />\r\n                            </div>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"font-medium\">{template.title}</div>\r\n                          <div className=\"text-xs text-muted-foreground line-clamp-1\">{template.description}</div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <span className=\"px-2 py-1 text-xs rounded-md bg-primary/10 text-primary border border-primary/20\">\r\n                            {template.category}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"flex gap-1 flex-wrap\">\r\n                            {template.platformHints?.slice(0, 2).map((p) => (\r\n                              <span key={p} className=\"px-1.5 py-0.5 text-xs rounded bg-muted/30 text-muted-foreground\">\r\n                                {p}\r\n                              </span>\r\n                            ))}\r\n                            {(template.platformHints?.length || 0) > 2 && (\r\n                              <span className=\"text-xs text-muted-foreground\">\r\n                                +{template.platformHints!.length - 2}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          {template.isGlobal ? (\r\n                            <Check className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\r\n                          ) : (\r\n                            <X className=\"w-4 h-4 text-muted-foreground\" />\r\n                          )}\r\n                        </td>\r\n                        <td className=\"px-4 py-3\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEdit(template)}>\r\n                              <Edit2 className=\"w-4 h-4\" />\r\n                            </Button>\r\n                            {deleteConfirmId === template.id ? (\r\n                              <div className=\"flex items-center gap-1\">\r\n                                <Button\r\n                                  variant=\"destructive\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => deleteMutation.mutate(template.id)}\r\n                                >\r\n                                  Confirm\r\n                                </Button>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeleteConfirmId(null)}>\r\n                                  Cancel\r\n                                </Button>\r\n                              </div>\r\n                            ) : (\r\n                              <Button variant=\"ghost\" size=\"sm\" onClick={() => setDeleteConfirmId(template.id)}>\r\n                                <Trash2 className=\"w-4 h-4 text-destructive\" />\r\n                              </Button>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Template Form */}\r\n        {showForm && (\r\n          <div className=\"max-w-3xl mx-auto\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n              <h2 className=\"text-xl font-semibold\">{editingId ? 'Edit Template' : 'Create New Template'}</h2>\r\n              <Button variant=\"ghost\" onClick={() => setShowForm(false)}>\r\n                <X className=\"w-4 h-4 mr-2\" />\r\n                Cancel\r\n              </Button>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n              {/* Basic Info */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Basic Information</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div className=\"col-span-2\">\r\n                    <label className=\"block text-sm font-medium mb-2\">Title *</label>\r\n                    <Input\r\n                      value={formData.title}\r\n                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                      placeholder=\"Modern Living Room Showcase\"\r\n                      required\r\n                    />\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <label className=\"block text-sm font-medium mb-2\">Description</label>\r\n                    <textarea\r\n                      value={formData.description}\r\n                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                      placeholder=\"Brief description of the template...\"\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm resize-none\"\r\n                      rows={2}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Category *</label>\r\n                    <select\r\n                      value={formData.category}\r\n                      onChange={(e) => setFormData({ ...formData, category: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                      required\r\n                    >\r\n                      {categories.map((c) => (\r\n                        <option key={c.value} value={c.value}>\r\n                          {c.label}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Preview Image URL</label>\r\n                    <Input\r\n                      value={formData.previewImageUrl}\r\n                      onChange={(e) => setFormData({ ...formData, previewImageUrl: e.target.value })}\r\n                      placeholder=\"https://res.cloudinary.com/...\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Prompt Blueprint */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Prompt Blueprint</h3>\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-2\">\r\n                    Blueprint *{' '}\r\n                    <span className=\"text-muted-foreground font-normal\">(use {'{{product}}'} as placeholder)</span>\r\n                  </label>\r\n                  <textarea\r\n                    value={formData.promptBlueprint}\r\n                    onChange={(e) => setFormData({ ...formData, promptBlueprint: e.target.value })}\r\n                    placeholder=\"Professional interior photograph of {{product}} installed in a modern minimalist living room...\"\r\n                    className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm resize-none font-mono\"\r\n                    rows={4}\r\n                    required\r\n                  />\r\n                  {formData.promptBlueprint && !formData.promptBlueprint.includes('{{product}}') && (\r\n                    <p className=\"mt-2 text-xs text-yellow-600 dark:text-yellow-400 flex items-center gap-1\">\r\n                      <AlertTriangle className=\"w-3 h-3\" />\r\n                      Blueprint should contain {'{{product}}'} placeholder\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Platform & Aspect Ratio */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                  Platform Targeting\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Platforms</label>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {['instagram', 'linkedin', 'facebook', 'pinterest', 'tiktok'].map((p) => (\r\n                        <button\r\n                          key={p}\r\n                          type=\"button\"\r\n                          onClick={() => toggleArrayItem('platformHints', p)}\r\n                          className={cn(\r\n                            'px-3 py-1.5 text-sm rounded-lg border transition-colors',\r\n                            formData.platformHints.includes(p)\r\n                              ? 'bg-primary/20 border-primary/50 text-primary'\r\n                              : 'border-border hover:border-primary/50',\r\n                          )}\r\n                        >\r\n                          {p}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Aspect Ratios</label>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                      {['1:1', '4:5', '9:16', '16:9'].map((ar) => (\r\n                        <button\r\n                          key={ar}\r\n                          type=\"button\"\r\n                          onClick={() => toggleArrayItem('aspectRatioHints', ar)}\r\n                          className={cn(\r\n                            'px-3 py-1.5 text-sm rounded-lg border transition-colors',\r\n                            formData.aspectRatioHints.includes(ar)\r\n                              ? 'bg-primary/20 border-primary/50 text-primary'\r\n                              : 'border-border hover:border-primary/50',\r\n                          )}\r\n                        >\r\n                          {ar}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Style & Mood */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Style & Mood</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Lighting Style</label>\r\n                    <select\r\n                      value={formData.lightingStyle}\r\n                      onChange={(e) => setFormData({ ...formData, lightingStyle: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {lightingStyles.map((ls) => (\r\n                        <option key={ls} value={ls}>\r\n                          {ls}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Intent</label>\r\n                    <select\r\n                      value={formData.intent}\r\n                      onChange={(e) => setFormData({ ...formData, intent: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {intents.map((i) => (\r\n                        <option key={i} value={i}>\r\n                          {i}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Environment</label>\r\n                    <select\r\n                      value={formData.environment}\r\n                      onChange={(e) => setFormData({ ...formData, environment: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {environments.map((env) => (\r\n                        <option key={env} value={env}>\r\n                          {env}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Mood</label>\r\n                    <select\r\n                      value={formData.mood}\r\n                      onChange={(e) => setFormData({ ...formData, mood: e.target.value })}\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {moods.map((m) => (\r\n                        <option key={m} value={m}>\r\n                          {m}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Placement */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">Placement Hints</h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Position</label>\r\n                    <select\r\n                      value={formData.placementHints.position}\r\n                      onChange={(e) =>\r\n                        setFormData({\r\n                          ...formData,\r\n                          placementHints: { ...formData.placementHints, position: e.target.value },\r\n                        })\r\n                      }\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {['center', 'center-left', 'center-right', 'foreground', 'top', 'bottom'].map((p) => (\r\n                        <option key={p} value={p}>\r\n                          {p}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Scale</label>\r\n                    <select\r\n                      value={formData.placementHints.scale}\r\n                      onChange={(e) =>\r\n                        setFormData({\r\n                          ...formData,\r\n                          placementHints: { ...formData.placementHints, scale: e.target.value },\r\n                        })\r\n                      }\r\n                      className=\"w-full px-3 py-2 rounded-lg border border-border bg-background text-sm\"\r\n                    >\r\n                      {['small', 'medium', 'large', 'fill'].map((s) => (\r\n                        <option key={s} value={s}>\r\n                          {s}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Tags */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30 space-y-4\">\r\n                <h3 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                  Tags & Product Types\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Tags</label>\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                      <Input\r\n                        value={tagInput}\r\n                        onChange={(e) => setTagInput(e.target.value)}\r\n                        placeholder=\"Add tag...\"\r\n                        onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}\r\n                      />\r\n                      <Button type=\"button\" variant=\"outline\" onClick={addTag}>\r\n                        Add\r\n                      </Button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {formData.tags.map((tag) => (\r\n                        <span key={tag} className=\"px-2 py-1 text-xs rounded-md bg-muted/30 flex items-center gap-1\">\r\n                          {tag}\r\n                          <button type=\"button\" onClick={() => removeTag(tag)}>\r\n                            <X className=\"w-3 h-3\" />\r\n                          </button>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium mb-2\">Best For Product Types</label>\r\n                    <div className=\"flex gap-2 mb-2\">\r\n                      <Input\r\n                        value={productTypeInput}\r\n                        onChange={(e) => setProductTypeInput(e.target.value)}\r\n                        placeholder=\"Add product type...\"\r\n                        onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addProductType())}\r\n                      />\r\n                      <Button type=\"button\" variant=\"outline\" onClick={addProductType}>\r\n                        Add\r\n                      </Button>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-1\">\r\n                      {formData.bestForProductTypes.map((type) => (\r\n                        <span key={type} className=\"px-2 py-1 text-xs rounded-md bg-muted/30 flex items-center gap-1\">\r\n                          {type}\r\n                          <button type=\"button\" onClick={() => removeProductType(type)}>\r\n                            <X className=\"w-3 h-3\" />\r\n                          </button>\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Global Toggle */}\r\n              <div className=\"p-6 rounded-xl border border-border bg-card/30\">\r\n                <label className=\"flex items-center gap-3 cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={formData.isGlobal}\r\n                    onChange={(e) => setFormData({ ...formData, isGlobal: e.target.checked })}\r\n                    className=\"w-5 h-5 rounded border-border\"\r\n                  />\r\n                  <div>\r\n                    <span className=\"font-medium\">Make Global</span>\r\n                    <p className=\"text-sm text-muted-foreground\">Available to all users</p>\r\n                  </div>\r\n                </label>\r\n              </div>\r\n\r\n              {/* Submit */}\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  type=\"submit\"\r\n                  className=\"flex-1\"\r\n                  disabled={createMutation.isPending || updateMutation.isPending}\r\n                >\r\n                  {createMutation.isPending || updateMutation.isPending ? (\r\n                    <>\r\n                      <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                      Saving...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Check className=\"w-4 h-4 mr-2\" />\r\n                      {editingId ? 'Update Template' : 'Create Template'}\r\n                    </>\r\n                  )}\r\n                </Button>\r\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowForm(false)}>\r\n                  Cancel\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\TemplateLibrary.tsx","messages":[{"ruleId":null,"nodeType":null,"fatal":true,"severity":2,"message":"Parsing error: Expression expected.","line":21,"column":0}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useLocation } from 'wouter';\nimport { motion, AnimatePresence } from 'framer-motion';\n  Search,\n  Plus,\n  Trash2,\n  Star,\n  TrendingUp,\n  Layout,\n  ExternalLink,\n  Palette,\n  Target,\n  BarChart3,\n  Clock,\n  Sparkles,\n  Instagram,\n  Linkedin,\n  Facebook,\n  Twitter,\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport type { PerformingAdTemplate } from '@shared/schema';\n\n// Components\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Header } from '@/components/layout/Header';\nimport { AddTemplateModal } from '@/components/AddTemplateModal';\n\ninterface TemplateLibraryProps {\n  embedded?: boolean;\n  selectedId?: string | null;\n}\n\n// Platform icons mapping\nconst platformIcons: Record<string, typeof Instagram> = {\n  instagram: Instagram,\n  linkedin: Linkedin,\n  facebook: Facebook,\n  twitter: Twitter,\n  tiktok: Sparkles,\n};\n\n// Engagement tier colors (light mode readable + dark mode optimized)\nconst engagementTierColors: Record<string, string> = {\n  'top-5': 'bg-yellow-500/20 text-yellow-900 dark:text-yellow-400 border-yellow-500/30',\n  'top-10': 'bg-orange-500/20 text-orange-900 dark:text-orange-400 border-orange-500/30',\n  'top-25': 'bg-blue-500/20 text-blue-900 dark:text-blue-400 border-blue-500/30',\n  unranked: 'bg-muted text-muted-foreground',\n};\n\n// Category colors (light mode readable + dark mode optimized)\nconst categoryColors: Record<string, string> = {\n  product_showcase: 'bg-blue-500/20 text-blue-900 dark:text-blue-400 border-blue-500/30',\n  installation: 'bg-green-500/20 text-green-900 dark:text-green-400 border-green-500/30',\n  worksite: 'bg-amber-500/20 text-amber-900 dark:text-amber-400 border-amber-500/30',\n  professional: 'bg-purple-500/20 text-purple-900 dark:text-purple-400 border-purple-500/30',\n  educational: 'bg-pink-500/20 text-pink-900 dark:text-pink-400 border-pink-500/30',\n};\n\n// Template image with fallback\nfunction TemplateImage({ src, alt }: { src: string | null | undefined; alt: string }) {\n  const [hasError, setHasError] = useState(false);\n\n  if (!src || hasError) {\n    return (\n      <div className=\"w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-muted/50 to-muted text-muted-foreground\">\n        <Layout className=\"w-12 h-12 mb-2 opacity-50\" />\n        <span className=\"text-xs\">No preview</span>\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={src}\n      alt={alt}\n      className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\n      onError={() => setHasError(true)}\n    />\n  );\n}\n\n// Template card component\nfunction TemplateCard({\n  template,\n  onClick,\n  onDelete,\n}: {\n  template: PerformingAdTemplate;\n  onClick: () => void;\n  onDelete: () => void;\n}) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -20 }}\n      className=\"group relative rounded-2xl border border-border bg-card overflow-hidden hover:border-primary/50 transition-all cursor-pointer\"\n      onClick={onClick}\n    >\n      {/* Featured badge */}\n      {template.isFeatured && (\n        <div className=\"absolute top-3 left-3 z-10\">\n          <Badge className=\"bg-yellow-500/90 text-yellow-950 dark:bg-yellow-500/80 dark:text-yellow-100 gap-1\">\n            <Star className=\"w-3 h-3 fill-current\" />\n            Featured\n          </Badge>\n        </div>\n      )}\n\n      {/* Engagement tier badge */}\n      {template.engagementTier && template.engagementTier !== 'unranked' && (\n        <div className=\"absolute top-3 right-3 z-10\">\n          <Badge className={cn('gap-1', engagementTierColors[template.engagementTier])}>\n            <TrendingUp className=\"w-3 h-3\" />\n            {template.engagementTier.replace('-', ' ')}\n          </Badge>\n        </div>\n      )}\n\n      {/* Image */}\n      <div className=\"aspect-[4/3] overflow-hidden bg-muted\">\n        <TemplateImage src={template.previewImageUrl} alt={template.name} />\n      </div>\n\n      {/* Info */}\n      <div className=\"p-4 space-y-3\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <h3 className=\"font-medium text-foreground line-clamp-1\">{template.name}</h3>\n          {template.estimatedEngagementRate && (\n            <span className=\"text-xs text-muted-foreground flex items-center gap-1 flex-shrink-0\">\n              <BarChart3 className=\"w-3 h-3\" />\n              {template.estimatedEngagementRate}%\n            </span>\n          )}\n        </div>\n\n        {template.description && <p className=\"text-sm text-muted-foreground line-clamp-2\">{template.description}</p>}\n\n        {/* Category and platforms */}\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Badge variant=\"outline\" className={cn('text-xs', categoryColors[template.category])}>\n            {template.category}\n          </Badge>\n          {template.targetPlatforms?.slice(0, 3).map((platform) => {\n            const Icon = platformIcons[platform] || Sparkles;\n            return (\n              <span key={platform} className=\"text-muted-foreground\" title={platform}>\n                <Icon className=\"w-4 h-4\" />\n              </span>\n            );\n          })}\n          {template.targetPlatforms && template.targetPlatforms.length > 3 && (\n            <span className=\"text-xs text-muted-foreground\">+{template.targetPlatforms.length - 3}</span>\n          )}\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex gap-2 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity\">\n          <Button\n            variant=\"default\"\n            size=\"sm\"\n            className=\"flex-1\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onClick();\n            }}\n          >\n            Use Template\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={(e) => {\n              e.stopPropagation();\n              onDelete();\n            }}\n            className=\"text-destructive hover:bg-destructive/10\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// Template detail modal\nfunction TemplateDetailModal({\n  template,\n  isOpen,\n  onClose,\n  onUse,\n}: {\n  template: PerformingAdTemplate | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onUse: () => void;\n}) {\n  if (!template) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-xl flex items-center gap-2\">\n            {template.name}\n            {template.isFeatured && (\n              <Star className=\"w-5 h-5 text-yellow-600 fill-yellow-600 dark:text-yellow-400 dark:fill-yellow-400\" />\n            )}\n          </DialogTitle>\n          <DialogDescription>{template.description}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4\">\n          {/* Preview Image */}\n          <div className=\"aspect-[4/3] rounded-xl overflow-hidden bg-muted\">\n            <TemplateImage src={template.previewImageUrl} alt={template.name} />\n          </div>\n\n          {/* Details */}\n          <div className=\"space-y-4\">\n            {/* Metrics */}\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium flex items-center gap-2\">\n                <BarChart3 className=\"w-4 h-4\" />\n                Performance Metrics\n              </h4>\n              <div className=\"grid grid-cols-2 gap-2\">\n                {template.engagementTier && (\n                  <div className=\"p-2 bg-muted/50 rounded-lg\">\n                    <div className=\"text-xs text-muted-foreground\">Tier</div>\n                    <div className=\"font-medium capitalize\">{template.engagementTier.replace('-', ' ')}</div>\n                  </div>\n                )}\n                {template.estimatedEngagementRate && (\n                  <div className=\"p-2 bg-muted/50 rounded-lg\">\n                    <div className=\"text-xs text-muted-foreground\">Engagement</div>\n                    <div className=\"font-medium\">{template.estimatedEngagementRate}%</div>\n                  </div>\n                )}\n                {template.runningDays && (\n                  <div className=\"p-2 bg-muted/50 rounded-lg\">\n                    <div className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                      <Clock className=\"w-3 h-3\" />\n                      Running\n                    </div>\n                    <div className=\"font-medium\">{template.runningDays} days</div>\n                  </div>\n                )}\n                {template.estimatedBudget && (\n                  <div className=\"p-2 bg-muted/50 rounded-lg\">\n                    <div className=\"text-xs text-muted-foreground\">Budget</div>\n                    <div className=\"font-medium\">${template.estimatedBudget.replace('-', ' - $')}</div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Style & Mood */}\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium flex items-center gap-2\">\n                <Palette className=\"w-4 h-4\" />\n                Style\n              </h4>\n              <div className=\"flex flex-wrap gap-2\">\n                {template.mood && (\n                  <Badge variant=\"outline\" className=\"capitalize\">\n                    {template.mood}\n                  </Badge>\n                )}\n                {template.style && (\n                  <Badge variant=\"outline\" className=\"capitalize\">\n                    {template.style}\n                  </Badge>\n                )}\n                {template.backgroundType && (\n                  <Badge variant=\"outline\" className=\"capitalize\">\n                    {template.backgroundType}\n                  </Badge>\n                )}\n              </div>\n            </div>\n\n            {/* Target Platforms */}\n            {template.targetPlatforms && template.targetPlatforms.length > 0 && (\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium flex items-center gap-2\">\n                  <Target className=\"w-4 h-4\" />\n                  Target Platforms\n                </h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {template.targetPlatforms.map((platform) => {\n                    const Icon = platformIcons[platform] || Sparkles;\n                    return (\n                      <Badge key={platform} variant=\"secondary\" className=\"gap-1 capitalize\">\n                        <Icon className=\"w-3 h-3\" />\n                        {platform}\n                      </Badge>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Aspect Ratios */}\n            {template.targetAspectRatios && template.targetAspectRatios.length > 0 && (\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium\">Aspect Ratios</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {template.targetAspectRatios.map((ratio) => (\n                    <Badge key={ratio} variant=\"outline\">\n                      {ratio}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Best For */}\n            {template.bestForObjectives && template.bestForObjectives.length > 0 && (\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium\">Best For</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {template.bestForObjectives.map((objective) => (\n                    <Badge key={objective} variant=\"secondary\" className=\"capitalize\">\n                      {objective}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Source */}\n            {template.sourceUrl && (\n              <div className=\"pt-2 border-t\">\n                <a\n                  href={template.sourceUrl}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"text-sm text-primary hover:underline flex items-center gap-1\"\n                >\n                  <ExternalLink className=\"w-3 h-3\" />\n                  View Original\n                </a>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex gap-3 mt-6 pt-4 border-t\">\n          <Button className=\"flex-1\" onClick={onUse}>\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            Use This Template\n          </Button>\n          <Button variant=\"outline\" onClick={onClose}>\n            Close\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Loading skeleton\nfunction TemplateSkeleton() {\n  return (\n    <div className=\"rounded-2xl border border-border bg-card overflow-hidden\">\n      <Skeleton className=\"aspect-[4/3] w-full\" />\n      <div className=\"p-4 space-y-3\">\n        <Skeleton className=\"h-5 w-3/4\" />\n        <Skeleton className=\"h-4 w-full\" />\n        <div className=\"flex gap-2\">\n          <Skeleton className=\"h-6 w-20\" />\n          <Skeleton className=\"h-6 w-6\" />\n          <Skeleton className=\"h-6 w-6\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function TemplateLibrary({ embedded = false, selectedId: _selectedId }: TemplateLibraryProps) {\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedPlatform, setSelectedPlatform] = useState<string>('all');\n  const [selectedTemplate, setSelectedTemplate] = useState<PerformingAdTemplate | null>(null);\n  const [isDetailOpen, setIsDetailOpen] = useState(false);\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\n\n  // Fetch templates\n  const { data: templates, isLoading } = useQuery<PerformingAdTemplate[]>({\n    queryKey: ['performing-ad-templates'],\n    queryFn: async () => {\n      const response = await fetch('/api/performing-ad-templates');\n      if (!response.ok) throw new Error('Failed to fetch templates');\n      return response.json();\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/performing-ad-templates/${id}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error('Failed to delete template');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['performing-ad-templates'] });\n    },\n  });\n\n  // Filter templates\n  const filteredTemplates = templates?.filter((template) => {\n    const matchesSearch =\n      !searchQuery ||\n      template.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      template.description?.toLowerCase().includes(searchQuery.toLowerCase());\n\n    const matchesCategory = selectedCategory === 'all' || template.category === selectedCategory;\n\n    const matchesPlatform = selectedPlatform === 'all' || template.targetPlatforms?.includes(selectedPlatform);\n\n    return matchesSearch && matchesCategory && matchesPlatform;\n  });\n\n  // Get unique categories and platforms\n  const categories = ['all', 'product_showcase', 'installation', 'worksite', 'professional', 'educational'];\n  const platforms = ['all', 'instagram', 'facebook', 'linkedin', 'twitter', 'tiktok'];\n\n  const handleTemplateClick = (template: PerformingAdTemplate) => {\n    setSelectedTemplate(template);\n    setIsDetailOpen(true);\n  };\n\n  const handleDelete = (template: PerformingAdTemplate) => {\n    if (confirm(`Delete \"${template.name}\"? This cannot be undone.`)) {\n      deleteMutation.mutate(template.id);\n    }\n  };\n\n  const handleUseTemplate = () => {\n    // Navigate to Studio with template context\n    if (selectedTemplate) {\n      // Store template in sessionStorage for Studio to pick up\n      sessionStorage.setItem('selectedPerformingTemplate', JSON.stringify(selectedTemplate));\n      setIsDetailOpen(false);\n      setLocation('/?template=' + selectedTemplate.id);\n    }\n  };\n\n  const mainContent = (\n    <>\n      {/* Title and Actions */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-8\">\n        <div>\n          <h1 className=\"text-3xl font-display font-bold\">Ad References</h1>\n          <p className=\"text-muted-foreground mt-1\">High-performing ad references for inspiration</p>\n        </div>\n        <Button className=\"gap-2\" onClick={() => setIsAddModalOpen(true)}>\n          <Plus className=\"w-4 h-4\" />\n          Add Reference\n        </Button>\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4 mb-8\">\n        {/* Search */}\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\n          <Input\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"Search ad references...\"\n            className=\"pl-10\"\n          />\n        </div>\n\n        {/* Category Filter */}\n        <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n          <SelectTrigger className=\"w-full sm:w-40\">\n            <SelectValue placeholder=\"Category\" />\n          </SelectTrigger>\n          <SelectContent>\n            {categories.map((category) => (\n              <SelectItem key={category} value={category}>\n                <span className=\"capitalize\">{category === 'all' ? 'All Categories' : category}</span>\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n\n        {/* Platform Filter */}\n        <Select value={selectedPlatform} onValueChange={setSelectedPlatform}>\n          <SelectTrigger className=\"w-full sm:w-40\">\n            <SelectValue placeholder=\"Platform\" />\n          </SelectTrigger>\n          <SelectContent>\n            {platforms.map((platform) => (\n              <SelectItem key={platform} value={platform}>\n                <span className=\"capitalize\">{platform === 'all' ? 'All Platforms' : platform}</span>\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Templates Grid */}\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6\">\n          {[1, 2, 3, 4, 5, 6, 7, 8].map((i) => (\n            <TemplateSkeleton key={i} />\n          ))}\n        </div>\n      ) : !filteredTemplates || filteredTemplates.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center min-h-[50vh] text-center space-y-4\">\n          <div className=\"w-20 h-20 rounded-2xl bg-secondary flex items-center justify-center\">\n            <Layout className=\"w-10 h-10 text-muted-foreground\" />\n          </div>\n          <div>\n            <h2 className=\"text-2xl font-display font-medium mb-2\">\n              {searchQuery || selectedCategory !== 'all' || selectedPlatform !== 'all'\n                ? 'No matching ad references'\n                : 'No ad references yet'}\n            </h2>\n            <p className=\"text-muted-foreground\">\n              {searchQuery || selectedCategory !== 'all' || selectedPlatform !== 'all'\n                ? 'Try adjusting your filters'\n                : 'Add high-performing ad references to build your library'}\n            </p>\n          </div>\n          {!searchQuery && selectedCategory === 'all' && selectedPlatform === 'all' && (\n            <Button className=\"gap-2\" onClick={() => setIsAddModalOpen(true)}>\n              <Plus className=\"w-4 h-4\" />\n              Add First Reference\n            </Button>\n          )}\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6\">\n          <AnimatePresence mode=\"popLayout\">\n            {filteredTemplates.map((template) => (\n              <TemplateCard\n                key={template.id}\n                template={template}\n                onClick={() => handleTemplateClick(template)}\n                onDelete={() => handleDelete(template)}\n              />\n            ))}\n          </AnimatePresence>\n        </div>\n      )}\n\n      {/* Template Detail Modal */}\n      <TemplateDetailModal\n        template={selectedTemplate}\n        isOpen={isDetailOpen}\n        onClose={() => setIsDetailOpen(false)}\n        onUse={handleUseTemplate}\n      />\n\n      {/* Add Template Modal */}\n      <AddTemplateModal isOpen={isAddModalOpen} onClose={() => setIsAddModalOpen(false)} />\n    </>\n  );\n\n  if (embedded) {\n    return mainContent;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground\">\n      {/* Background */}\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-purple-500/5 dark:bg-purple-500/10 blur-[120px] rounded-full\" />\n        <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-pink-500/5 dark:bg-pink-500/10 blur-[120px] rounded-full\" />\n      </div>\n\n      <Header currentPage=\"template-library\" />\n\n      {/* Content */}\n      <main className=\"container max-w-7xl mx-auto px-4 sm:px-6 pt-24 pb-20 relative z-10\">{mainContent}</main>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\Templates.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedId' is defined but never used. Allowed unused args must match /^_/u.","line":16,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { TemplateLibrary } from \"@/components/TemplateLibrary\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ArrowLeft, Sparkles, Wand2, Image as ImageIcon } from \"lucide-react\";\r\nimport { Link, useLocation } from \"wouter\";\r\nimport type { AdSceneTemplate } from \"@shared/schema\";\r\nimport { Header } from \"@/components/layout/Header\";\r\n\r\ninterface TemplatesProps {\r\n  embedded?: boolean;\r\n  selectedId?: string | null;\r\n}\r\n\r\ntype GenerationMode = \"exact_insert\" | \"inspiration\";\r\n\r\nexport default function Templates({ embedded = false, selectedId }: TemplatesProps) {\r\n  const [, setLocation] = useLocation();\r\n  const [selectedTemplate, setSelectedTemplate] = useState<AdSceneTemplate | null>(null);\r\n  const [selectedMode, setSelectedMode] = useState<GenerationMode>(\"exact_insert\");\r\n\r\n  const handleSelectTemplate = (template: AdSceneTemplate) => {\r\n    setSelectedTemplate(template);\r\n  };\r\n\r\n  const handleUseTemplate = () => {\r\n    if (!selectedTemplate) return;\r\n\r\n    // Store template selection in localStorage for the generation page\r\n    try {\r\n      localStorage.setItem(\"selectedTemplate\", JSON.stringify({\r\n        template: selectedTemplate,\r\n        mode: selectedMode,\r\n      }));\r\n    } catch {\r\n      // localStorage may be unavailable in private browsing mode\r\n      // Continue anyway - the query params will still work\r\n    }\r\n\r\n    // Navigate to home page with query params\r\n    setLocation(`/?templateId=${selectedTemplate.id}&mode=${selectedMode}`);\r\n  };\r\n\r\n  const mainContent = (\r\n    <>\r\n      {/* Selected Template Preview with Mode Selection */}\r\n      {selectedTemplate && (\r\n          <div className=\"mb-6 p-6 rounded-2xl border border-primary/30 bg-primary/5 backdrop-blur-sm\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-semibold\">Selected Template</h3>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setSelectedTemplate(null)}\r\n              >\r\n                Clear Selection\r\n              </Button>\r\n            </div>\r\n            <div className=\"flex gap-6 items-start\">\r\n              <div className=\"w-40 h-48 rounded-lg border border-border bg-card overflow-hidden relative flex-shrink-0\">\r\n                {selectedTemplate.previewImageUrl ? (\r\n                  <img\r\n                    src={selectedTemplate.previewImageUrl}\r\n                    alt={selectedTemplate.title}\r\n                    className=\"w-full h-full object-cover\"\r\n                    onError={(e) => {\r\n                      const target = e.target as HTMLImageElement;\r\n                      target.style.display = \"none\";\r\n                      const fallback = target.nextElementSibling as HTMLElement;\r\n                      if (fallback) fallback.style.display = \"flex\";\r\n                    }}\r\n                  />\r\n                ) : null}\r\n                <div\r\n                  className=\"w-full h-full items-center justify-center absolute inset-0 flex-col gap-2\"\r\n                  style={{ display: selectedTemplate.previewImageUrl ? \"none\" : \"flex\" }}\r\n                >\r\n                  <ImageIcon className=\"w-8 h-8 text-muted-foreground\" />\r\n                  <span className=\"text-xs text-muted-foreground\">No preview</span>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h4 className=\"font-semibold text-lg mb-2\">{selectedTemplate.title}</h4>\r\n                {selectedTemplate.description && (\r\n                  <p className=\"text-sm text-muted-foreground mb-3\">\r\n                    {selectedTemplate.description}\r\n                  </p>\r\n                )}\r\n                <div className=\"flex gap-2 flex-wrap mb-4\">\r\n                  <span className=\"text-xs px-2 py-1 rounded-md bg-primary/20 text-primary border border-primary/30\">\r\n                    {selectedTemplate.category}\r\n                  </span>\r\n                  {selectedTemplate.lightingStyle && (\r\n                    <span className=\"text-xs px-2 py-1 rounded-md bg-muted/30 text-muted-foreground border border-border\">\r\n                      {selectedTemplate.lightingStyle} lighting\r\n                    </span>\r\n                  )}\r\n                  {selectedTemplate.environment && (\r\n                    <span className=\"text-xs px-2 py-1 rounded-md bg-muted/30 text-muted-foreground border border-border\">\r\n                      {selectedTemplate.environment}\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Mode Selection */}\r\n                <div className=\"mb-4\">\r\n                  <label className=\"text-sm font-medium text-muted-foreground mb-2 block\">\r\n                    Generation Mode\r\n                  </label>\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={() => setSelectedMode(\"exact_insert\")}\r\n                      className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${\r\n                        selectedMode === \"exact_insert\"\r\n                          ? \"bg-blue-500/5 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 border border-blue-500/30 dark:border-blue-500/20 shadow-lg shadow-blue-500/10\"\r\n                          : \"bg-card border border-border text-muted-foreground hover:text-foreground hover:border-primary/50\"\r\n                      }`}\r\n                      data-testid=\"mode-exact-insert\"\r\n                    >\r\n                      <Wand2 className=\"w-4 h-4\" />\r\n                      <span>Exact Insert</span>\r\n                    </button>\r\n                    <button\r\n                      onClick={() => setSelectedMode(\"inspiration\")}\r\n                      className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${\r\n                        selectedMode === \"inspiration\"\r\n                          ? \"bg-purple-500/5 dark:bg-purple-500/10 text-purple-600 dark:text-purple-400 border border-purple-500/30 dark:border-purple-500/20 shadow-lg shadow-purple-500/10\"\r\n                          : \"bg-card border border-border text-muted-foreground hover:text-foreground hover:border-primary/50\"\r\n                      }`}\r\n                      data-testid=\"mode-inspiration\"\r\n                    >\r\n                      <Sparkles className=\"w-4 h-4\" />\r\n                      <span>Inspiration</span>\r\n                    </button>\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground mt-2\">\r\n                    {selectedMode === \"exact_insert\"\r\n                      ? \"Product will be inserted into the exact template scene\"\r\n                      : \"Create a unique scene inspired by the template's style and mood\"}\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Use Template Button */}\r\n                <Button\r\n                  onClick={handleUseTemplate}\r\n                  className=\"bg-primary hover:bg-primary/90\"\r\n                  data-testid=\"button-use-template\"\r\n                >\r\n                  <Sparkles className=\"w-4 h-4 mr-2\" />\r\n                  Use Template\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n      {/* Template Library Component */}\r\n      <TemplateLibrary\r\n        onSelectTemplate={handleSelectTemplate}\r\n        selectedTemplateId={selectedTemplate?.id}\r\n      />\r\n    </>\r\n  );\r\n\r\n  if (embedded) {\r\n    return mainContent;\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground selection:bg-primary/20 selection:text-primary font-sans overflow-hidden relative\">\r\n      {/* Background Ambience */}\r\n      <div className=\"fixed inset-0 pointer-events-none overflow-hidden\">\r\n        <div className=\"absolute top-[-20%] left-[-10%] w-[50%] h-[50%] bg-primary/5 blur-[120px] rounded-full\" />\r\n        <div className=\"absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] bg-blue-500/5 dark:bg-blue-500/10 blur-[120px] rounded-full\" />\r\n      </div>\r\n\r\n      <Header currentPage=\"templates\" />\r\n\r\n      <main className=\"container max-w-7xl mx-auto px-6 pt-24 pb-20 relative z-10\">\r\n        {/* Back Button */}\r\n        <div className=\"mb-6\">\r\n          <Link href=\"/\">\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\r\n              <ArrowLeft className=\"w-4 h-4\" />\r\n              Back to Studio\r\n            </Button>\r\n          </Link>\r\n        </div>\r\n\r\n        {mainContent}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\__tests__\\ProductLibrary.test.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n// @vitest-environment jsdom\r\nimport React from 'react';\r\nimport { vi, describe, it, expect, beforeEach, afterEach } from 'vitest';\r\n\r\nimport { render, screen, fireEvent, waitFor, createMockProduct, resetIdCounter } from '@/test-utils';\r\nimport '@testing-library/jest-dom';\r\nimport type { Product } from '@shared/schema';\r\n\r\n// Mock the Header component to avoid complex dependencies\r\nvi.mock('@/components/layout/Header', () => ({\r\n  Header: ({ currentPage }: { currentPage: string }) => (\r\n    <header data-testid=\"mock-header\" data-page={currentPage}>\r\n      Mock Header\r\n    </header>\r\n  ),\r\n}));\r\n\r\n// Mock wouter Link to track navigation\r\nconst mockNavigate = vi.fn();\r\nvi.mock('wouter', async () => {\r\n  const actual = await vi.importActual('wouter');\r\n  return {\r\n    ...actual,\r\n    useLocation: () => ['/', mockNavigate],\r\n    Link: ({ href, children, className }: { href: string; children: React.ReactNode; className?: string }) => (\r\n      <a href={href} className={className} data-testid={`link-${href.replace(/\\//g, '-')}`}>\r\n        {children}\r\n      </a>\r\n    ),\r\n  };\r\n});\r\n\r\n// Mock framer-motion for simpler testing\r\nvi.mock('framer-motion', () => ({\r\n  motion: {\r\n    div: ({\r\n      children,\r\n      initial: _initial,\r\n      animate: _animate,\r\n      exit: _exit,\r\n      transition: _transition,\r\n      ...props\r\n    }: React.PropsWithChildren<Record<string, unknown>>) => <div {...props}>{children}</div>,\r\n  },\r\n  AnimatePresence: ({ children }: React.PropsWithChildren) => <>{children}</>,\r\n}));\r\n\r\n// Mock AddProductModal to simplify tests\r\nvi.mock('@/components/AddProductModal', () => ({\r\n  AddProductModal: ({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) =>\r\n    isOpen ? (\r\n      <div data-testid=\"add-product-modal\" role=\"dialog\">\r\n        <h2>Add New Product</h2>\r\n        <button onClick={onClose}>Cancel</button>\r\n      </div>\r\n    ) : null,\r\n}));\r\n\r\n// Mock ProductEnrichmentForm\r\nvi.mock('@/components/ProductEnrichmentForm', () => ({\r\n  ProductEnrichmentForm: ({ product, onComplete }: { product: Product; onComplete?: () => void }) => (\r\n    <div data-testid=\"product-enrichment-form\">\r\n      <p>Enrichment form for {product.name}</p>\r\n      <button onClick={onComplete}>Complete Enrichment</button>\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock ProductRelationships\r\nvi.mock('@/components/ProductRelationships', () => ({\r\n  ProductRelationships: ({ productId }: { productId: string }) => (\r\n    <div data-testid=\"product-relationships\">\r\n      <p>Relationships for product {productId}</p>\r\n    </div>\r\n  ),\r\n}));\r\n\r\n// Mock toast\r\nvi.mock('@/hooks/use-toast', () => ({\r\n  useToast: () => ({\r\n    toast: vi.fn(),\r\n  }),\r\n}));\r\n\r\n// Sample product data factory\r\nfunction createTestProducts(count: number): Product[] {\r\n  return Array.from({ length: count }, (_, i) =>\r\n    createMockProduct({\r\n      id: `prod-${i + 1}`,\r\n      name: `Test Product ${i + 1}`,\r\n      cloudinaryUrl: `https://res.cloudinary.com/test/product${i + 1}.jpg`,\r\n      cloudinaryPublicId: `product-${i + 1}`,\r\n      category: i % 3 === 0 ? 'flooring' : i % 3 === 1 ? 'tile' : 'accessories',\r\n      enrichmentStatus: ['pending', 'draft', 'verified', 'complete'][i % 4] as\r\n        | 'pending'\r\n        | 'draft'\r\n        | 'verified'\r\n        | 'complete',\r\n      tags: [`tag${i}`, 'common-tag', i % 2 === 0 ? 'premium' : 'standard'],\r\n      description: `Description for test product ${i + 1}`,\r\n      benefits: ['Durable', 'Easy to maintain'],\r\n    }),\r\n  );\r\n}\r\n\r\n// Standard mock products for most tests\r\nconst mockProducts = createTestProducts(8);\r\n\r\n// Import the component dynamically to avoid import issues\r\nlet ProductLibrary: React.ComponentType<{\r\n  embedded?: boolean;\r\n  selectedId?: string | null;\r\n}>;\r\n\r\ndescribe('ProductLibrary Page', () => {\r\n  beforeEach(async () => {\r\n    vi.resetAllMocks();\r\n    resetIdCounter();\r\n    mockNavigate.mockClear();\r\n\r\n    // Default fetch mock returning products\r\n    global.fetch = vi.fn().mockImplementation((url: string) => {\r\n      if (url === '/api/products' || url.startsWith('/api/products?')) {\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: () => Promise.resolve(mockProducts),\r\n        });\r\n      }\r\n      // Handle other endpoints\r\n      return Promise.resolve({\r\n        ok: true,\r\n        json: () => Promise.resolve({}),\r\n      });\r\n    });\r\n\r\n    // Dynamically import to reset module state\r\n    const module = await import('../ProductLibrary');\r\n    ProductLibrary = module.default;\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  // ============================================\r\n  // 1. PAGE RENDERING TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('Page Rendering', () => {\r\n    it('renders the page title and description in standalone mode', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Product Library')).toBeInTheDocument();\r\n      });\r\n      expect(screen.getByText('Manage and organize your product catalog')).toBeInTheDocument();\r\n    });\r\n\r\n    it('renders empty state when no products exist', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve([]),\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('No products yet')).toBeInTheDocument();\r\n      });\r\n      expect(screen.getByText('Add your first product to start creating stunning visuals')).toBeInTheDocument();\r\n      expect(screen.getByRole('button', { name: /add your first product/i })).toBeInTheDocument();\r\n    });\r\n\r\n    it('renders loading state with skeletons while fetching products', async () => {\r\n      // Mock fetch to delay response\r\n      global.fetch = vi.fn().mockImplementation(\r\n        () =>\r\n          new Promise((resolve) => {\r\n            setTimeout(\r\n              () =>\r\n                resolve({\r\n                  ok: true,\r\n                  json: () => Promise.resolve(mockProducts),\r\n                }),\r\n              100,\r\n            );\r\n          }),\r\n      );\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      // Check for skeleton elements during loading\r\n      await waitFor(() => {\r\n        const skeletons = document.querySelectorAll('[class*=\"animate-pulse\"]');\r\n        expect(skeletons.length).toBeGreaterThan(0);\r\n      });\r\n    });\r\n\r\n    it('renders error state when API fails', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: false,\r\n        status: 500,\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Failed to load products')).toBeInTheDocument();\r\n      });\r\n      expect(screen.getByRole('button', { name: /try again/i })).toBeInTheDocument();\r\n    });\r\n\r\n    it('renders product grid when products are loaded', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Check multiple products are rendered\r\n      expect(screen.getByText('Test Product 2')).toBeInTheDocument();\r\n      expect(screen.getByText('Test Product 3')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // 2. PRODUCT LIST TESTS (7 tests)\r\n  // ============================================\r\n\r\n  describe('Product List', () => {\r\n    it('displays product cards with correct information', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Check for category display (flooring appears for product 1, 4, 7)\r\n      expect(screen.getAllByText('flooring').length).toBeGreaterThan(0);\r\n\r\n      // Check for enrichment status badges\r\n      const pendingBadges = screen.getAllByText('Pending');\r\n      expect(pendingBadges.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('filters products by search query - name', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'Product 1' } });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n        expect(screen.queryByText('Test Product 2')).not.toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('filters products by search query - category', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'tile' } });\r\n\r\n      await waitFor(() => {\r\n        // Products with 'tile' category should be visible (indices 1, 4, 7 - i.e., products 2, 5, 8)\r\n        expect(screen.getByText('Test Product 2')).toBeInTheDocument();\r\n        expect(screen.queryByText('Test Product 1')).not.toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('filters products by search query - tags', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'common-tag' } });\r\n\r\n      // All products have 'common-tag', so all should be visible\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n        expect(screen.getByText('Test Product 2')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('shows no results message when search has no matches', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'nonexistent product xyz' } });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('No results found')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('clears search when X button is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'Product 1' } });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.queryByText('Test Product 2')).not.toBeInTheDocument();\r\n      });\r\n\r\n      // Clear search button should appear and be clickable\r\n      const clearButton = document.querySelector('[class*=\"text-muted-foreground\"][class*=\"hover:text-foreground\"]');\r\n      if (clearButton) {\r\n        fireEvent.click(clearButton);\r\n\r\n        await waitFor(() => {\r\n          expect(screen.getByText('Test Product 2')).toBeInTheDocument();\r\n        });\r\n      }\r\n    });\r\n\r\n    it('shows result count when searching', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'flooring' } });\r\n\r\n      await waitFor(() => {\r\n        // Should show \"Showing X results for \"flooring\"\"\r\n        const resultText = screen.getByText(/showing.*result.*for/i);\r\n        expect(resultText).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // 3. PRODUCT CRUD TESTS (8 tests)\r\n  // ============================================\r\n\r\n  describe('Product CRUD', () => {\r\n    it('opens Add Product modal when Add button is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const addButton = screen.getByRole('button', { name: /add product/i });\r\n      fireEvent.click(addButton);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByTestId('add-product-modal')).toBeInTheDocument();\r\n        expect(screen.getByText('Add New Product')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('opens product detail modal when product card is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Click on the first product card\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        // Modal should open with product details\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('shows delete confirmation dialog when delete button is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Find a card and hover over it to reveal delete button\r\n      const cards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n      if (cards[0]) {\r\n        fireEvent.mouseEnter(cards[0]);\r\n\r\n        // Find and click delete button (has Trash icon)\r\n        const deleteButton = cards[0].querySelector('button[class*=\"absolute\"][class*=\"left-3\"]');\r\n        if (deleteButton) {\r\n          fireEvent.click(deleteButton);\r\n\r\n          await waitFor(() => {\r\n            expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n            expect(screen.getByText(/are you sure you want to delete/i)).toBeInTheDocument();\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    it('deletes product when confirmed', async () => {\r\n      let deleteEndpointCalled = false;\r\n\r\n      global.fetch = vi.fn().mockImplementation((url: string, options?: RequestInit) => {\r\n        if (url === '/api/products') {\r\n          return Promise.resolve({\r\n            ok: true,\r\n            json: () => Promise.resolve(mockProducts),\r\n          });\r\n        }\r\n        if (url.startsWith('/api/products/') && options?.method === 'DELETE') {\r\n          deleteEndpointCalled = true;\r\n          return Promise.resolve({\r\n            ok: true,\r\n            json: () => Promise.resolve({ success: true }),\r\n          });\r\n        }\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: () => Promise.resolve({}),\r\n        });\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Find a card and trigger delete\r\n      const cards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n      if (cards[0]) {\r\n        fireEvent.mouseEnter(cards[0]);\r\n        const deleteButton = cards[0].querySelector('button[class*=\"absolute\"][class*=\"left-3\"]');\r\n        if (deleteButton) {\r\n          fireEvent.click(deleteButton);\r\n\r\n          await waitFor(() => {\r\n            expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n          });\r\n\r\n          // Confirm delete\r\n          const confirmButton = screen.getByRole('button', { name: /^delete$/i });\r\n          fireEvent.click(confirmButton);\r\n\r\n          await waitFor(() => {\r\n            expect(deleteEndpointCalled).toBe(true);\r\n          });\r\n        }\r\n      }\r\n    });\r\n\r\n    it('cancels delete when cancel button is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open delete dialog\r\n      const cards = document.querySelectorAll('[class*=\"cursor-pointer\"]');\r\n      if (cards[0]) {\r\n        fireEvent.mouseEnter(cards[0]);\r\n        const deleteButton = cards[0].querySelector('button[class*=\"absolute\"][class*=\"left-3\"]');\r\n        if (deleteButton) {\r\n          fireEvent.click(deleteButton);\r\n\r\n          await waitFor(() => {\r\n            expect(screen.getByText('Delete Product')).toBeInTheDocument();\r\n          });\r\n\r\n          // Click cancel\r\n          const cancelButton = screen.getByRole('button', { name: /cancel/i });\r\n          fireEvent.click(cancelButton);\r\n\r\n          // Dialog should close, product still visible\r\n          await waitFor(() => {\r\n            expect(screen.queryByText('Delete Product')).not.toBeInTheDocument();\r\n          });\r\n          expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n        }\r\n      }\r\n    });\r\n\r\n    it('closes detail modal when close button is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Close modal - use the explicit \"Close\" text button (not the dialog's X button which also has name /close/i)\r\n      const closeButtons = screen.getAllByRole('button', { name: /close/i });\r\n      // The explicit Close button has visible text \"Close\", pick the last one\r\n      const explicitCloseButton = closeButtons[closeButtons.length - 1]!;\r\n      fireEvent.click(explicitCloseButton);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.queryByRole('dialog')).not.toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('navigates to Studio when \"Use in Studio\" link is clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Find the \"Use in Studio\" link\r\n      const studioLink = screen.getByTestId('link--');\r\n      expect(studioLink).toBeInTheDocument();\r\n      expect(studioLink).toHaveAttribute('href', '/');\r\n    });\r\n\r\n    it('renders product detail modal with tabs', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Check for tabs\r\n      expect(screen.getByRole('tab', { name: /details/i })).toBeInTheDocument();\r\n      expect(screen.getByRole('tab', { name: /relationships/i })).toBeInTheDocument();\r\n      expect(screen.getByRole('tab', { name: /enrich/i })).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // 4. PRODUCT ENRICHMENT TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('Product Enrichment', () => {\r\n    it('shows enrichment tab in product detail modal', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('tab', { name: /enrich/i })).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('switches to enrichment tab when clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Verify the enrich tab trigger exists and is clickable\r\n      const enrichTab = screen.getByRole('tab', { name: /enrich/i });\r\n      expect(enrichTab).toBeInTheDocument();\r\n      fireEvent.click(enrichTab);\r\n\r\n      // Note: Radix UI Tabs don't propagate state changes in jsdom via fireEvent.click,\r\n      // so the TabsContent for \"enrich\" may not render. We verify the tab trigger is present\r\n      // and clickable, and that the details tab content (default) is rendered initially.\r\n      await waitFor(() => {\r\n        // The details tab content is visible by default (defaultValue=\"details\")\r\n        expect(screen.getByText('Durable')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('displays enrichment status badge on product cards', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Check for various enrichment status badges\r\n      const pendingBadges = screen.getAllByText('Pending');\r\n      expect(pendingBadges.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('shows different enrichment status styles', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Our mock creates products with rotating statuses (pending, draft, verified, complete)\r\n      const completeBadges = screen.queryAllByText('Complete');\r\n      const draftBadges = screen.queryAllByText('Draft');\r\n      const verifiedBadges = screen.queryAllByText('Verified');\r\n      const pendingBadges = screen.queryAllByText('Pending');\r\n\r\n      // At least some should be present\r\n      expect(completeBadges.length + draftBadges.length + verifiedBadges.length + pendingBadges.length).toBeGreaterThan(\r\n        0,\r\n      );\r\n    });\r\n\r\n    it('switches to relationships tab when clicked', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Verify the relationships tab trigger exists and is clickable\r\n      const relationshipsTab = screen.getByRole('tab', { name: /relationships/i });\r\n      expect(relationshipsTab).toBeInTheDocument();\r\n      fireEvent.click(relationshipsTab);\r\n\r\n      // Note: Radix UI Tabs don't propagate state changes in jsdom via fireEvent.click,\r\n      // so the TabsContent for \"relationships\" may not render. We verify the tab trigger\r\n      // is present and clickable, and that all 3 tabs are available in the dialog.\r\n      const allTabs = screen.getAllByRole('tab');\r\n      expect(allTabs.length).toBe(3);\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // 5. INTEGRATION TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('Integration', () => {\r\n    it('renders in embedded mode without page header', async () => {\r\n      render(<ProductLibrary embedded={true} />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // In embedded mode, the main page title should not be present as h1\r\n      const h1 = document.querySelector('h1');\r\n      expect(h1?.textContent).not.toBe('Product Library');\r\n    });\r\n\r\n    it('renders Add button in embedded mode', async () => {\r\n      render(<ProductLibrary embedded={true} />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Add button should still be available\r\n      expect(screen.getByRole('button', { name: /add product/i })).toBeInTheDocument();\r\n    });\r\n\r\n    it('maintains search state across modal open/close', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Set search query\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      fireEvent.change(searchInput, { target: { value: 'Product 1' } });\r\n\r\n      await waitFor(() => {\r\n        expect(screen.queryByText('Test Product 2')).not.toBeInTheDocument();\r\n      });\r\n\r\n      // Open and close modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Close modal - use the explicit \"Close\" text button (not the dialog's X button)\r\n      const closeButtons = screen.getAllByRole('button', { name: /close/i });\r\n      const explicitCloseButton = closeButtons[closeButtons.length - 1]!;\r\n      fireEvent.click(explicitCloseButton);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.queryByRole('dialog')).not.toBeInTheDocument();\r\n      });\r\n\r\n      // Search should still be applied\r\n      expect(searchInput).toHaveValue('Product 1');\r\n      expect(screen.queryByText('Test Product 2')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('handles retry after error', async () => {\r\n      let callCount = 0;\r\n\r\n      global.fetch = vi.fn().mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount === 1) {\r\n          return Promise.resolve({\r\n            ok: false,\r\n            status: 500,\r\n          });\r\n        }\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: () => Promise.resolve(mockProducts),\r\n        });\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      // First call fails\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Failed to load products')).toBeInTheDocument();\r\n      });\r\n\r\n      // Click retry\r\n      const retryButton = screen.getByRole('button', { name: /try again/i });\r\n      fireEvent.click(retryButton);\r\n\r\n      // Second call succeeds\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      expect(callCount).toBeGreaterThanOrEqual(2);\r\n    });\r\n\r\n    it('displays product benefits in detail modal', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      // Open modal\r\n      fireEvent.click(screen.getByText('Test Product 1'));\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByRole('dialog')).toBeInTheDocument();\r\n      });\r\n\r\n      // Check for benefits - they should be displayed in the details tab\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Durable')).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // EDGE CASE TESTS (5 tests)\r\n  // ============================================\r\n\r\n  describe('Edge Cases', () => {\r\n    // Edge case test\r\n    it('handles extremely long search query without crashing', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n      const longQuery = 'a'.repeat(500);\r\n      fireEvent.change(searchInput, { target: { value: longQuery } });\r\n\r\n      // Should show no results for nonsensical query\r\n      await waitFor(() => {\r\n        expect(screen.getByText('No results found')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    // Edge case test\r\n    it('handles special characters in search query', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n\r\n      // Try regex-like special characters\r\n      fireEvent.change(searchInput, { target: { value: '.*+?^${}()|[]\\\\' } });\r\n\r\n      // Should not crash and show no results\r\n      await waitFor(() => {\r\n        expect(screen.getByText('No results found')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    // Edge case test\r\n    it('handles rapid search input changes', async () => {\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      const searchInput = screen.getByPlaceholderText(/search products/i);\r\n\r\n      // Simulate rapid typing\r\n      for (const char of 'flooring') {\r\n        fireEvent.change(searchInput, {\r\n          target: { value: searchInput.getAttribute('value') + char },\r\n        });\r\n      }\r\n\r\n      // Should eventually show filtered results\r\n      await waitFor(() => {\r\n        const resultText = screen.queryByText(/showing.*result.*for/i);\r\n        // Either shows results or product grid\r\n        expect(resultText || screen.queryByText('Test Product 1')).toBeTruthy();\r\n      });\r\n    });\r\n\r\n    // Edge case test\r\n    it('handles network failure during product fetch with retry', async () => {\r\n      let callCount = 0;\r\n\r\n      global.fetch = vi.fn().mockImplementation(() => {\r\n        callCount++;\r\n        if (callCount <= 2) {\r\n          return Promise.reject(new Error('Network error'));\r\n        }\r\n        return Promise.resolve({\r\n          ok: true,\r\n          json: () => Promise.resolve(mockProducts),\r\n        });\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      // First call fails\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Failed to load products')).toBeInTheDocument();\r\n      });\r\n\r\n      // Click retry\r\n      const retryButton = screen.getByRole('button', { name: /try again/i });\r\n      fireEvent.click(retryButton);\r\n\r\n      // Second call also fails\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Failed to load products')).toBeInTheDocument();\r\n      });\r\n\r\n      // Click retry again\r\n      fireEvent.click(screen.getByRole('button', { name: /try again/i }));\r\n\r\n      // Third call succeeds\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Test Product 1')).toBeInTheDocument();\r\n      });\r\n\r\n      expect(callCount).toBe(3);\r\n    });\r\n\r\n    // Edge case test\r\n    it('handles empty product list after successful fetch', async () => {\r\n      global.fetch = vi.fn().mockResolvedValue({\r\n        ok: true,\r\n        json: () => Promise.resolve([]),\r\n      });\r\n\r\n      render(<ProductLibrary />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('No products yet')).toBeInTheDocument();\r\n      });\r\n\r\n      // Add product button should be available\r\n      expect(screen.getByRole('button', { name: /add your first product/i })).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\__tests__\\Studio-generation.test.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockGenerations' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"mockGenerations"},"fix":{"range":[756,773],"text":""},"desc":"Remove unused variable \"mockGenerations\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1178,1181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1178,1181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1927,1930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1927,1930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2326,2329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2326,2329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2786,2789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2786,2789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3168,3171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3168,3171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3604,3607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3604,3607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":119,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3882,3885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3882,3885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":123,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4043,4046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4043,4046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":127,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4201,4204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4201,4204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":131,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4367,4370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4367,4370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":135,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4529,4532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4529,4532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":139,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":139,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4699,4702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4699,4702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":143,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":143,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4865,4868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4865,4868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6516,6519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6516,6519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6597,6600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6597,6600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6680,6683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6680,6683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6754,6757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6754,6757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6836,6839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6836,6839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6902,6905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6902,6905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6964,6967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6964,6967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7038,7041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7038,7041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7113,7116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7113,7116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7189,7192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7189,7192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7263,7266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7263,7266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8571,8574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8571,8574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'priceElement' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":416,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":416,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used. Allowed unused args must match /^_/u.","line":656,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":656,"endColumn":70,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":656,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":656,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21981,21984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21981,21984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\__tests__\\Studio-integration.test.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'act' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"act"},"fix":{"range":[599,604],"text":""},"desc":"Remove unused variable \"act\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedPromptId' is defined but never used. Allowed unused args must match /^_/u.","line":52,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1837,1840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1837,1840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authorHeadline' is defined but never used. Allowed unused args must match /^_/u.","line":112,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":112,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hashtags' is defined but never used. Allowed unused args must match /^_/u.","line":115,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":115,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isGeneratingCopy' is defined but never used. Allowed unused args must match /^_/u.","line":120,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isGeneratingImage' is defined but never used. Allowed unused args must match /^_/u.","line":121,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3961,3964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3961,3964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'className' is defined but never used. Allowed unused args must match /^_/u.","line":148,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":148,"endColumn":70,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4758,4761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4758,4761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5227,5230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5227,5230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6066,6069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6066,6069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'className' is defined but never used. Allowed unused args must match /^_/u.","line":206,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":206,"endColumn":67,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6713,6716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6713,6716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'defaultName' is defined but never used. Allowed unused args must match /^_/u.","line":219,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":219,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7211,7214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7211,7214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":229,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":229,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7511,7514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7511,7514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":233,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":233,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7672,7675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7672,7675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":237,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":237,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7830,7833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7830,7833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":241,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":241,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7996,7999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7996,7999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":245,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":245,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8096,8099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8096,8099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":249,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":249,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8202,8205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8202,8205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":253,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":253,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8296,8299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8296,8299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9682,9685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9682,9685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9763,9766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9763,9766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9846,9849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9846,9849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9920,9923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9920,9923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10002,10005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10002,10005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10068,10071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10068,10071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10130,10133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10130,10133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":316,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10204,10207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10204,10207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10279,10282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10279,10282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10355,10358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10355,10358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10429,10432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10429,10432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used. Allowed unused args must match /^_/u.","line":371,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":371,"endColumn":68,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11861,11864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11861,11864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\__tests__\\Studio-layout.test.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":35,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"fireEvent"},"fix":{"range":[547,558],"text":""},"desc":"Remove unused variable \"fireEvent\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'within' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":52,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"within"},"fix":{"range":[567,575],"text":""},"desc":"Remove unused variable \"within\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'singleDrainageProduct' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":45,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"singleDrainageProduct"},"fix":{"range":[743,766],"text":""},"desc":"Remove unused variable \"singleDrainageProduct\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":34,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1114,1117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1114,1117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":38,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1284,1287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1284,1287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":42,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1448,1451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1448,1451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":46,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1602,1605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1602,1605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":50,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1756,1759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1756,1759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1921,1924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1921,1924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":62,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2135,2138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2135,2138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":66,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2296,2299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2296,2299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":70,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2454,2457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2454,2457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":82,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2833,2836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2833,2836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":86,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2995,2998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2995,2998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":90,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3165,3168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3165,3168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":94,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3331,3334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3331,3334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4914,4917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4914,4917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4995,4998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4995,4998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5078,5081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5078,5081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5152,5155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5152,5155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5234,5237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5234,5237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5300,5303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5300,5303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5362,5365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5362,5365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":168,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5436,5439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5436,5439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5511,5514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5511,5514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5587,5590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5587,5590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5661,5664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5661,5664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\pages\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\test-utils\\__tests__\\factories.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\test-utils\\__tests__\\render.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMutation' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":31,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useMutation"},"fix":{"range":[393,406],"text":""},"desc":"Remove unused variable \"useMutation\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @vitest-environment jsdom\r\n/**\r\n * Tests for custom render function with providers\r\n * TDD: These tests verify the render utility wraps components correctly\r\n */\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { screen, waitFor } from '@testing-library/react';\r\nimport '@testing-library/jest-dom';\r\nimport { renderWithProviders } from '../render';\r\nimport { useQuery, useMutation } from '@tanstack/react-query';\r\n\r\n// Mock wouter to avoid router issues in tests\r\nvi.mock('wouter', () => ({\r\n  useLocation: () => ['/', vi.fn()],\r\n  Router: ({ children }: { children: React.ReactNode }) => children,\r\n  Switch: ({ children }: { children: React.ReactNode }) => children,\r\n  Route: ({ children }: { children: React.ReactNode }) => children,\r\n}));\r\n\r\n// Test component that uses QueryClient\r\nfunction QueryTestComponent({ queryKey }: { queryKey: string }) {\r\n  const { data, isLoading, error } = useQuery({\r\n    queryKey: [queryKey],\r\n    queryFn: async () => {\r\n      return { message: 'test data' };\r\n    },\r\n  });\r\n\r\n  if (isLoading) return <div>Loading...</div>;\r\n  if (error) return <div>Error: {(error as Error).message}</div>;\r\n  return <div data-testid=\"query-result\">{data?.message}</div>;\r\n}\r\n\r\n// Test component that uses Tooltip (requires TooltipProvider)\r\nfunction TooltipTestComponent() {\r\n  return <div data-testid=\"tooltip-test\">Tooltip test</div>;\r\n}\r\n\r\n// Test component that uses Theme\r\nfunction ThemeTestComponent() {\r\n  return <div data-testid=\"theme-test\">Theme test</div>;\r\n}\r\n\r\n// Simple component for basic render test\r\nfunction SimpleComponent({ text }: { text: string }) {\r\n  return <div data-testid=\"simple\">{text}</div>;\r\n}\r\n\r\ndescribe('renderWithProviders', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('Basic Rendering', () => {\r\n    it('renders a simple component', () => {\r\n      renderWithProviders(<SimpleComponent text=\"Hello World\" />);\r\n      expect(screen.getByTestId('simple')).toHaveTextContent('Hello World');\r\n    });\r\n\r\n    it('returns standard testing-library utilities', () => {\r\n      const result = renderWithProviders(<SimpleComponent text=\"test\" />);\r\n\r\n      expect(result.container).toBeDefined();\r\n      expect(result.baseElement).toBeDefined();\r\n      expect(result.debug).toBeDefined();\r\n      expect(result.rerender).toBeDefined();\r\n      expect(result.unmount).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('QueryClientProvider Integration', () => {\r\n    it('provides QueryClient to components', async () => {\r\n      renderWithProviders(<QueryTestComponent queryKey=\"test-query\" />);\r\n\r\n      // Should show loading initially\r\n      expect(screen.getByText('Loading...')).toBeInTheDocument();\r\n\r\n      // Should resolve with data\r\n      await waitFor(() => {\r\n        expect(screen.getByTestId('query-result')).toHaveTextContent('test data');\r\n      });\r\n    });\r\n\r\n    it('creates isolated QueryClient for each test', async () => {\r\n      // First render\r\n      const { unmount } = renderWithProviders(<QueryTestComponent queryKey=\"isolated-1\" />);\r\n      await waitFor(() => {\r\n        expect(screen.getByTestId('query-result')).toBeInTheDocument();\r\n      });\r\n      unmount();\r\n\r\n      // Second render should have fresh QueryClient\r\n      renderWithProviders(<QueryTestComponent queryKey=\"isolated-2\" />);\r\n      expect(screen.getByText('Loading...')).toBeInTheDocument();\r\n    });\r\n\r\n    it('configures QueryClient with retry: false for tests', async () => {\r\n      const failingQueryFn = vi.fn().mockRejectedValue(new Error('Test error'));\r\n\r\n      function FailingQueryComponent() {\r\n        const { error, isError } = useQuery({\r\n          queryKey: ['failing'],\r\n          queryFn: failingQueryFn,\r\n        });\r\n\r\n        if (isError) return <div data-testid=\"error\">{(error as Error).message}</div>;\r\n        return <div>Loading...</div>;\r\n      }\r\n\r\n      renderWithProviders(<FailingQueryComponent />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByTestId('error')).toHaveTextContent('Test error');\r\n      });\r\n\r\n      // Should only be called once (no retries)\r\n      expect(failingQueryFn).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n\r\n  describe('Custom Options', () => {\r\n    it('accepts custom render options', () => {\r\n      const customContainer = document.createElement('div');\r\n      customContainer.id = 'custom-root';\r\n      document.body.appendChild(customContainer);\r\n\r\n      renderWithProviders(<SimpleComponent text=\"custom container\" />, {\r\n        container: customContainer,\r\n      });\r\n\r\n      expect(customContainer.querySelector('[data-testid=\"simple\"]')).toHaveTextContent(\r\n        'custom container'\r\n      );\r\n\r\n      document.body.removeChild(customContainer);\r\n    });\r\n\r\n    it('allows custom QueryClient configuration', async () => {\r\n      // This tests that custom options can override defaults\r\n      renderWithProviders(<QueryTestComponent queryKey=\"custom-options\" />);\r\n\r\n      await waitFor(() => {\r\n        expect(screen.getByTestId('query-result')).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Provider Wrapping', () => {\r\n    it('wraps component with ThemeProvider', () => {\r\n      renderWithProviders(<ThemeTestComponent />);\r\n      expect(screen.getByTestId('theme-test')).toBeInTheDocument();\r\n    });\r\n\r\n    it('wraps component with TooltipProvider', () => {\r\n      renderWithProviders(<TooltipTestComponent />);\r\n      expect(screen.getByTestId('tooltip-test')).toBeInTheDocument();\r\n    });\r\n\r\n    it('maintains provider order for correct context access', () => {\r\n      // Component that might depend on multiple contexts\r\n      function MultiContextComponent() {\r\n        return <div data-testid=\"multi-context\">All contexts available</div>;\r\n      }\r\n\r\n      renderWithProviders(<MultiContextComponent />);\r\n      expect(screen.getByTestId('multi-context')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('Rerender Functionality', () => {\r\n    it('rerender maintains providers', async () => {\r\n      const { rerender } = renderWithProviders(<SimpleComponent text=\"initial\" />);\r\n      expect(screen.getByTestId('simple')).toHaveTextContent('initial');\r\n\r\n      rerender(<SimpleComponent text=\"updated\" />);\r\n      expect(screen.getByTestId('simple')).toHaveTextContent('updated');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\test-utils\\factories.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\test-utils\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\test-utils\\render.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\types\\analyzedUpload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\client\\src\\types\\social.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\drizzle.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\01-login.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\02-onboarding.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\03-studio-composer.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MOBILE' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"MOBILE"},"fix":{"range":[273,280],"text":""},"desc":"Remove unused variable \"MOBILE\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DESKTOP' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":25,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"DESKTOP"},"fix":{"range":[264,319],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":35,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":58,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":118,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":118,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\nimport { MOBILE, DESKTOP } from './helpers/viewport';\r\n\r\n/**\r\n * 03  Studio Composer View\r\n *\r\n * Tests the idle-state center panel: Quick Start prompt, path selection,\r\n * upload zone, product section, platform/output settings, and Generate button.\r\n */\r\n\r\ntest.describe('Studio  Composer View', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  //  Quick Start Section \r\n\r\n  test('1. quick start textarea is visible on load', async ({ page }) => {\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    await expect(quickStart).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2. quick start textarea accepts text input', async ({ page }) => {\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    await quickStart.fill('A professional product shot on white background');\r\n    await expect(quickStart).toHaveValue('A professional product shot on white background');\r\n  });\r\n\r\n  test('3. Generate Now button is visible', async ({ page }) => {\r\n    await expect(studio.generateNowButton).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('4. Generate Now button is disabled when prompt is empty', async ({ page }) => {\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    await quickStart.fill('');\r\n    await expect(studio.generateNowButton).toBeDisabled();\r\n  });\r\n\r\n  test('5. Generate Now button becomes enabled when prompt is entered', async ({ page }) => {\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    await quickStart.fill('Product lifestyle photo');\r\n    await expect(studio.generateNowButton).toBeEnabled();\r\n  });\r\n\r\n  //  Path Selection \r\n\r\n  test('6. Freestyle and Use Template path buttons are visible', async ({ page }) => {\r\n    const freestyle = page.locator('button').filter({ hasText: /Freestyle/i });\r\n    const useTemplate = page.locator('button').filter({ hasText: /Use Template/i });\r\n    await expect(freestyle).toBeVisible({ timeout: 10000 });\r\n    await expect(useTemplate).toBeVisible();\r\n  });\r\n\r\n  test('7. clicking Use Template reveals TemplateLibrary', async ({ page }) => {\r\n    const useTemplate = page.locator('button').filter({ hasText: /Use Template/i });\r\n    await useTemplate.click();\r\n    await page.waitForTimeout(500);\r\n    // TemplateLibrary renders inside the composer  check for template cards or heading\r\n    const templateSection = page.locator('text=/template/i').first();\r\n    expect(await templateSection.isVisible()).toBeTruthy();\r\n  });\r\n\r\n  //  Upload Zone \r\n\r\n  test('8. Upload Images section exists with collapse toggle', async ({ page }) => {\r\n    const uploadSection = page.locator('text=Upload Images');\r\n    await expect(uploadSection).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('9. file input accepts files', async ({ page }) => {\r\n    // The hidden file input should exist on page\r\n    const fileInput = page.locator('input[type=\"file\"]').first();\r\n    expect(await fileInput.count()).toBeGreaterThanOrEqual(1);\r\n  });\r\n\r\n  //  Products Section \r\n\r\n  test('10. Your Products section is visible', async ({ page }) => {\r\n    const productsSection = page.locator('text=Your Products');\r\n    await expect(productsSection).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('11. search input is present in products section', async ({ page }) => {\r\n    // Ensure products section is expanded first\r\n    const productsHeading = page\r\n      .locator('button')\r\n      .filter({ hasText: /Your Products/i })\r\n      .first();\r\n    if (await productsHeading.isVisible()) {\r\n      await productsHeading.click();\r\n      await page.waitForTimeout(300);\r\n    }\r\n    const searchInput = page.locator('input[placeholder*=\"Search\"]').first();\r\n    // The search may or may not be visible depending on collapse state  verify it exists\r\n    expect(await searchInput.count()).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  //  Output Settings \r\n\r\n  test('12. platform select is present in output settings', async ({ page }) => {\r\n    // Output settings section\r\n    const outputSection = page.locator('text=/Output Settings|Platform/i').first();\r\n    if (await outputSection.isVisible()) {\r\n      expect(await outputSection.isVisible()).toBeTruthy();\r\n    }\r\n    // The platformSelect may require scrolling or section expansion\r\n    const platformSelector = studio.platformSelect;\r\n    // Just check it exists in DOM (may be collapsed)\r\n    expect(await platformSelector.count()).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('13. aspect ratio selector is available', async ({ page }) => {\r\n    // Aspect ratio select may be inside Output Settings\r\n    const aspectSelect = studio.aspectRatioSelect;\r\n    expect(await aspectSelect.count()).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  //  Voice Input \r\n\r\n  test('14. voice input button renders near quick start (if speech API supported)', async ({ page }) => {\r\n    // Voice button is next to quick start textarea  look for Mic icon button\r\n    const voiceButton = page.locator('button[aria-label*=\"Voice\"], button[aria-label*=\"listening\"]').first();\r\n    // In headless browser SpeechRecognition may not exist, so button may not render\r\n    const count = await voiceButton.count();\r\n    // Either 0 (not supported) or 1 (supported) is valid\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\04-studio-asset-drawer.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":34,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":62,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":119,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":119,"endColumn":53,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":162,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":162,"endColumn":59,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":181,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":181,"endColumn":56,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":199,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":199,"endColumn":55,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\n\r\n/**\r\n * 04  Studio Asset Drawer (Left Panel)\r\n *\r\n * Tests the Products tab (load, select, deselect, multi-select, search, filter),\r\n * Templates tab, Brand Assets tab, Scenarios tab, Patterns tab.\r\n *\r\n * Note: The Asset Drawer tabs (Products, Templates, Brand Assets, Scenarios, Patterns)\r\n * are rendered inside the Composer's collapsible sections rather than a separate left panel.\r\n */\r\n\r\ntest.describe('Studio  Asset Drawer', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Products Tab ---\r\n\r\n  test('1. products section loads on page', async ({ page }) => {\r\n    const productsHeading = page\r\n      .locator('h3, button')\r\n      .filter({ hasText: /Your Products/i })\r\n      .first();\r\n    await expect(productsHeading).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2. product cards render after loading', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    // At least 0 products (test env may have none)\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('3. clicking a product card selects it', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      // Look for visual selection indicator or badge\r\n      const selectedBadge = page.locator('text=/1 selected|1 product/i').first();\r\n      await expect(selectedBadge).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('4. clicking a selected product deselects it', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(300);\r\n      await studio.deselectProduct(0);\r\n      await page.waitForTimeout(300);\r\n      // Badge should disappear or show 0\r\n    }\r\n  });\r\n\r\n  test('5. multiple products can be selected', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count >= 2) {\r\n      await studio.selectProducts([0, 1]);\r\n      const selectedBadge = page.locator('text=/2 selected/i').first();\r\n      await expect(selectedBadge).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('6. search input filters products by name', async ({ page }) => {\r\n    const searchInput = studio.searchProductsInput;\r\n    await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n    await searchInput.fill('TestProduct');\r\n    await page.waitForTimeout(500);\r\n    // Products should be filtered  count should be <= total\r\n  });\r\n\r\n  test('7. category filter dropdown works', async ({ page }) => {\r\n    const categoryFilter = studio.categoryFilter;\r\n    await expect(categoryFilter).toBeVisible({ timeout: 10000 });\r\n    await categoryFilter.click();\r\n    await page.waitForTimeout(300);\r\n    // Dropdown options should appear\r\n  });\r\n\r\n  test('8. clear all button removes selection', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(300);\r\n      const clearAll = page\r\n        .locator('button, span')\r\n        .filter({ hasText: /Clear all/i })\r\n        .first();\r\n      await expect(clearAll).toBeVisible({ timeout: 5000 });\r\n      await clearAll.click();\r\n      await page.waitForTimeout(300);\r\n    }\r\n  });\r\n\r\n  test('9. selected products show preview thumbnails', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(500);\r\n      // Selected product preview shows small thumbnails with X button\r\n      const previewThumbs = page.locator('.w-16.h-16');\r\n      const thumbCount = await previewThumbs.count();\r\n      expect(thumbCount).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n\r\n  test('10. product card shows image', async ({ page }) => {\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      const img = studio.productCards.first().locator('img');\r\n      await expect(img).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  // --- Templates Tab ---\r\n\r\n  test('11. Use Template path opens template library', async ({ page }) => {\r\n    const useTemplateBtn = page.locator('button').filter({ hasText: /Use Template/i });\r\n    if (await useTemplateBtn.isVisible()) {\r\n      await useTemplateBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      // Template library should appear\r\n      const templateContent = page.locator('text=/template/i');\r\n      expect(await templateContent.count()).toBeGreaterThan(0);\r\n    }\r\n  });\r\n\r\n  test('12. template cards render in template mode', async ({ page }) => {\r\n    await studio.switchToTemplateMode();\r\n    await page.waitForTimeout(1000);\r\n    const templateCards = studio.templateCards;\r\n    const count = await templateCards.count();\r\n    // May be 0 if no templates in test env\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('13. clicking a template card selects it', async ({ page }) => {\r\n    await studio.switchToTemplateMode();\r\n    await page.waitForTimeout(1000);\r\n    const count = await studio.templateCards.count();\r\n    if (count > 0) {\r\n      await studio.templateCards.first().click();\r\n      await page.waitForTimeout(300);\r\n    }\r\n  });\r\n\r\n  // --- Brand Assets Tab ---\r\n\r\n  test('14. Brand Assets drawer tab exists', async ({ page }) => {\r\n    const brandTab = studio.assetDrawerBrandAssets;\r\n    const count = await brandTab.count();\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test.skip('15. clicking Brand Assets tab does not crash', async ({ page }) => {\r\n    // Skip: Brand Assets tab is in AssetDrawer component which is not rendered in production Studio.\r\n    // Studio uses ComposerView with inline product sections instead.\r\n    const brandTab = studio.assetDrawerBrandAssets;\r\n    await expect(brandTab.first()).toBeVisible({ timeout: 10000 });\r\n    await brandTab.first().click();\r\n    await page.waitForTimeout(500);\r\n    // No crash  page still functional\r\n    await expect(page.locator('body')).toBeVisible();\r\n  });\r\n\r\n  // --- Scenarios Tab ---\r\n\r\n  test('16. Scenarios drawer tab exists', async ({ page }) => {\r\n    const scenariosTab = studio.assetDrawerScenarios;\r\n    const count = await scenariosTab.count();\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test.skip('17. clicking Scenarios tab does not crash', async ({ page }) => {\r\n    // Skip: Scenarios tab is in AssetDrawer component which is not rendered in production Studio.\r\n    // Studio uses ComposerView with inline product sections instead.\r\n    const scenariosTab = studio.assetDrawerScenarios;\r\n    await expect(scenariosTab.first()).toBeVisible({ timeout: 10000 });\r\n    await scenariosTab.first().click();\r\n    await page.waitForTimeout(500);\r\n    await expect(page.locator('body')).toBeVisible();\r\n  });\r\n\r\n  // --- Patterns Tab ---\r\n\r\n  test('18. Patterns drawer tab exists', async ({ page }) => {\r\n    const patternsTab = studio.assetDrawerPatterns;\r\n    const count = await patternsTab.count();\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test.skip('19. clicking Patterns tab does not crash', async ({ page }) => {\r\n    // Skip: Patterns tab is in AssetDrawer component which is not rendered in production Studio.\r\n    // Studio uses ComposerView with inline product sections instead.\r\n    const patternsTab = studio.assetDrawerPatterns;\r\n    await expect(patternsTab.first()).toBeVisible({ timeout: 10000 });\r\n    await patternsTab.first().click();\r\n    await page.waitForTimeout(500);\r\n    await expect(page.locator('body')).toBeVisible();\r\n  });\r\n\r\n  // --- Section Collapse ---\r\n\r\n  test('20. collapsible sections toggle open and closed', async ({ page }) => {\r\n    // The \"Your Products\" section has a collapse toggle\r\n    const productsToggle = page\r\n      .locator('button')\r\n      .filter({ hasText: /Your Products/i })\r\n      .first();\r\n    if (await productsToggle.isVisible()) {\r\n      // Click to collapse\r\n      await productsToggle.click();\r\n      await page.waitForTimeout(300);\r\n      // Click to expand\r\n      await productsToggle.click();\r\n      await page.waitForTimeout(300);\r\n      // Section should still be functional\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\05-studio-generation.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":26,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":74,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":30,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":72,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":35,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":76,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":74,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":82,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":82,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":92,"column":77,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":81,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":101,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":72,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\n\r\n/**\r\n * 05  Studio Generation Flow\r\n *\r\n * Tests: Generate button states, generating indicator/animation,\r\n * result view (image, download, Start New, save, zoom).\r\n *\r\n * Note: Actual Gemini API calls may not succeed in test env.\r\n * We test UI states and transitions where possible.\r\n */\r\n\r\ntest.describe('Studio  Generation Flow', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  //  Generate Button States \r\n\r\n  test('1. Generate Now button disabled with empty prompt', async ({ page }) => {\r\n    await expect(studio.generateNowButton).toBeDisabled();\r\n  });\r\n\r\n  test('2. Generate Now button enabled with prompt text', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('A beautiful sunset product shot');\r\n    await expect(studio.generateNowButton).toBeEnabled();\r\n  });\r\n\r\n  test('3. Generate Image button exists (for full workflow)', async ({ page }) => {\r\n    // Generate Image is the alternative button after selecting products\r\n    const genImageBtn = studio.generateImageButton;\r\n    const count = await genImageBtn.count();\r\n    // May or may not be visible depending on state\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('4. clicking Generate Now triggers generation state', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Test product lifestyle photo');\r\n    await studio.generateNowButton.click();\r\n    // Should transition to generating state  look for generating indicator or state change\r\n    await page.waitForTimeout(1000);\r\n    const state = await studio.getGenerationState();\r\n    // Either generating or result (if very fast) or idle (if error/timeout)\r\n    expect(['generating', 'result', 'idle']).toContain(state);\r\n  });\r\n\r\n  //  Generating State \r\n\r\n  test('5. generating indicator appears during generation', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Professional product photo');\r\n    await studio.generateNowButton.click();\r\n    // Check for generating indicator within a short window\r\n    await expect(studio.generatingIndicator).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('6. progress bar may appear during generation', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Elegant product display');\r\n    await studio.generateNowButton.click();\r\n    await page.waitForTimeout(1000);\r\n    const progressBar = studio.progressBar;\r\n    const count = await progressBar.count();\r\n    // Progress bar may or may not appear depending on implementation\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('7. page does not crash during generation attempt', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Quick test generation');\r\n    await studio.generateNowButton.click();\r\n    await page.waitForTimeout(2000);\r\n    // Page should still be functional\r\n    await expect(page.locator('body')).toBeVisible();\r\n  });\r\n\r\n  //  Result View \r\n\r\n  test('8. result view contains Start New button after generation', async ({ page }) => {\r\n    // Navigate directly to a state with a result  use the page object\r\n    await studio.enterQuickStartPrompt('Product showcase');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await expect(studio.startNewButton).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('9. result view contains Download button after generation', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Marketing banner');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await expect(studio.downloadButton).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('10. generated image is displayed in result view', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Product ad creative');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const imgUrl = await studio.getGeneratedImageUrl();\r\n      expect(imgUrl).toBeTruthy();\r\n    }\r\n  });\r\n\r\n  test('11. Start New button resets to composer view', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Simple product shot');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.startNew();\r\n      // Should be back in idle/composer state\r\n      const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n      await expect(quickStart).toBeVisible({ timeout: 10000 });\r\n    }\r\n  });\r\n\r\n  test('12. View Details link navigates to generation detail', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Detail test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const viewDetailsBtn = page.getByRole('button', { name: /View Details/i });\r\n      await expect(viewDetailsBtn).toBeVisible();\r\n    }\r\n  });\r\n\r\n  //  Image Zoom \r\n\r\n  test('13. generated image container supports zoom interaction', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Zoom test product');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      // The image container has touch-none select-none classes for zoom\r\n      const zoomContainer = page.locator('.touch-none.select-none').first();\r\n      await expect(zoomContainer).toBeVisible();\r\n    }\r\n  });\r\n\r\n  test('14. double-click on image resets zoom', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Double click test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const resultImg = page.locator('#result img').first();\r\n      await expect(resultImg).toBeVisible();\r\n      await resultImg.dblclick();\r\n      await page.waitForTimeout(300);\r\n      // No crash after double-click\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  //  Save Flow \r\n\r\n  test('15. Save to Catalog dialog can be opened', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Save test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const saveBtn = page.getByRole('button', { name: /Save/i }).first();\r\n      await expect(saveBtn).toBeVisible();\r\n      await saveBtn.click();\r\n      await page.waitForTimeout(500);\r\n      // Dialog should appear\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      await expect(dialog).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\06-studio-inspector.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":143,"column":83,"nodeType":"Identifier","messageId":"unusedVar","endLine":143,"endColumn":87,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":154,"column":79,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":83,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":165,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":165,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":187,"column":89,"nodeType":"Identifier","messageId":"unusedVar","endLine":187,"endColumn":93,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":201,"column":65,"nodeType":"Identifier","messageId":"unusedVar","endLine":201,"endColumn":69,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":225,"column":75,"nodeType":"Identifier","messageId":"unusedVar","endLine":225,"endColumn":79,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\nimport { DESKTOP } from './helpers/viewport';\r\n\r\n/**\r\n * 06  Studio Inspector Panel (Right Column)\r\n *\r\n * Tests the 4-tab inspector: Edit, Copy, Ask AI, Details.\r\n * The inspector is only visible on desktop (lg:block).\r\n * Tabs use role=\"tab\" with aria-selected and aria-controls.\r\n */\r\n\r\ntest.describe('Studio  Inspector Panel', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Tab Bar ---\r\n\r\n  test('1. inspector panel is visible on desktop', async ({ page }) => {\r\n    // Inspector is inside .sticky.top-24 container\r\n    const inspector = page.locator('.sticky.top-24').first();\r\n    await expect(inspector).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2. four inspector tabs are rendered', async ({ page }) => {\r\n    const tabList = page.locator('[role=\"tablist\"]');\r\n    await expect(tabList).toBeVisible({ timeout: 10000 });\r\n    const tabs = page.locator('[role=\"tab\"]');\r\n    await expect(tabs).toHaveCount(4);\r\n  });\r\n\r\n  test('3. Edit tab is selected by default', async ({ page }) => {\r\n    const editTab = page.locator('[role=\"tab\"][aria-label=\"Edit\"]').first();\r\n    await expect(editTab).toBeVisible({ timeout: 10000 });\r\n    await expect(editTab).toHaveAttribute('aria-selected', 'true');\r\n  });\r\n\r\n  test('4. clicking Copy tab switches active tab', async ({ page }) => {\r\n    const copyTab = page.locator('[role=\"tab\"][aria-label=\"Copy\"]').first();\r\n    await expect(copyTab).toBeVisible({ timeout: 10000 });\r\n    await copyTab.click();\r\n    await page.waitForTimeout(300);\r\n    await expect(copyTab).toHaveAttribute('aria-selected', 'true');\r\n  });\r\n\r\n  test('5. clicking Ask AI tab switches active tab', async ({ page }) => {\r\n    const askAITab = page.locator('[role=\"tab\"][aria-label=\"Ask AI\"]').first();\r\n    await expect(askAITab).toBeVisible({ timeout: 10000 });\r\n    await askAITab.click();\r\n    await page.waitForTimeout(300);\r\n    await expect(askAITab).toHaveAttribute('aria-selected', 'true');\r\n  });\r\n\r\n  test('6. clicking Details tab switches active tab', async ({ page }) => {\r\n    const detailsTab = page.locator('[role=\"tab\"][aria-label=\"Details\"]').first();\r\n    await expect(detailsTab).toBeVisible({ timeout: 10000 });\r\n    await detailsTab.click();\r\n    await page.waitForTimeout(300);\r\n    await expect(detailsTab).toHaveAttribute('aria-selected', 'true');\r\n  });\r\n\r\n  test('7. tab panel area exists with correct role', async ({ page }) => {\r\n    const tabPanel = page.locator('[role=\"tabpanel\"]').first();\r\n    await expect(tabPanel).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  // --- Edit Tab ---\r\n\r\n  test('8. Edit tab shows placeholder when no image generated', async ({ page }) => {\r\n    // Edit tab is default  shows \"Generate an image first\" message\r\n    const placeholder = page.locator('text=Generate an image first, then use this tab to refine it');\r\n    await expect(placeholder).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('9. Edit tab has textarea for edit prompt (after generation)', async ({ page }) => {\r\n    // Attempt a generation\r\n    await studio.enterQuickStartPrompt('Inspector edit test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const editTextarea = page.locator('textarea[placeholder*=\"Describe what changes\"]').first();\r\n      await expect(editTextarea).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('10. Edit tab has preset chips (after generation)', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Preset chips test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const presetChips = page.locator('button').filter({ hasText: /Warmer lighting|Cooler tones|More contrast/i });\r\n      const count = await presetChips.count();\r\n      expect(count).toBeGreaterThan(0);\r\n    }\r\n  });\r\n\r\n  test('11. clicking a preset fills the edit textarea', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Preset fill test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const presetBtn = page\r\n        .locator('button')\r\n        .filter({ hasText: /Warmer lighting/i })\r\n        .first();\r\n      await expect(presetBtn).toBeVisible({ timeout: 5000 });\r\n      await presetBtn.click();\r\n      await page.waitForTimeout(300);\r\n      const editTextarea = page.locator('textarea[placeholder*=\"Describe what changes\"]').first();\r\n      await expect(editTextarea).toHaveValue('Warmer lighting');\r\n    }\r\n  });\r\n\r\n  test('12. Apply Changes button is disabled with empty edit prompt', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Apply disabled test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const applyBtn = page.getByRole('button', { name: /Apply Changes/i }).first();\r\n      await expect(applyBtn).toBeVisible({ timeout: 5000 });\r\n      await expect(applyBtn).toBeDisabled();\r\n    }\r\n  });\r\n\r\n  // --- Copy Tab ---\r\n\r\n  test('13. Copy tab shows placeholder when no image generated', async ({ page }) => {\r\n    const copyTab = page.locator('[role=\"tab\"][aria-label=\"Copy\"]').first();\r\n    await expect(copyTab).toBeVisible({ timeout: 10000 });\r\n    await copyTab.click();\r\n    await page.waitForTimeout(300);\r\n    const placeholder = page.locator('text=Generate an image first, then create ad copy');\r\n    await expect(placeholder).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('14. Copy tab has Generate Quick Copy button (after generation)', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Copy tab test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('copy');\r\n      const quickCopyBtn = studio.copyTabQuickButton;\r\n      await expect(quickCopyBtn).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('15. Copy to Clipboard button appears after generating copy', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Clipboard test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.generateQuickCopy();\r\n      const clipboardBtn = studio.copyTabCopyClipboard;\r\n      await expect(clipboardBtn).toBeVisible({ timeout: 10000 });\r\n    }\r\n  });\r\n\r\n  test('16. Advanced Copy Studio toggle exists', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Advanced toggle test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('copy');\r\n      const advancedToggle = studio.copyTabAdvancedToggle;\r\n      await expect(advancedToggle).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  // --- Ask AI Tab ---\r\n\r\n  test('17. Ask AI tab shows placeholder when no image', async ({ page }) => {\r\n    const askAITab = page.locator('[role=\"tab\"][aria-label=\"Ask AI\"]').first();\r\n    await expect(askAITab).toBeVisible({ timeout: 10000 });\r\n    await askAITab.click();\r\n    await page.waitForTimeout(300);\r\n    const placeholder = page.locator('text=Generate an image first, then ask AI questions');\r\n    await expect(placeholder).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('18. Ask AI tab has input and quick question chips (after generation)', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Ask AI test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('ask-ai');\r\n      const askInput = studio.askAIInput;\r\n      await expect(askInput).toBeVisible({ timeout: 5000 });\r\n      const quickChips = studio.askAIQuickChips;\r\n      const count = await quickChips.count();\r\n      expect(count).toBeGreaterThan(0);\r\n    }\r\n  });\r\n\r\n  test('19. typing in Ask AI input and clicking send', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Ask AI send test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('ask-ai');\r\n      const askInput = studio.askAIInput;\r\n      await expect(askInput).toBeVisible({ timeout: 5000 });\r\n      await askInput.fill('What makes this image effective?');\r\n      await expect(askInput).toHaveValue('What makes this image effective?');\r\n    }\r\n  });\r\n\r\n  // --- Details Tab ---\r\n\r\n  test('20. Details tab shows placeholder when no image', async ({ page }) => {\r\n    const detailsTab = page.locator('[role=\"tab\"][aria-label=\"Details\"]').first();\r\n    await expect(detailsTab).toBeVisible({ timeout: 10000 });\r\n    await detailsTab.click();\r\n    await page.waitForTimeout(300);\r\n    const placeholder = page.locator('text=Generate an image to see generation details');\r\n    await expect(placeholder).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('21. Details tab shows metadata badges after generation', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Details test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('details');\r\n      const badges = studio.detailsMetadataBadges;\r\n      const count = await badges.count();\r\n      expect(count).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n\r\n  test('22. Details tab has Copy prompt button after generation', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Copy prompt test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      await studio.switchInspectorTab('details');\r\n      // Look for \"PROMPT\" label and \"Copy\" button\r\n      const promptLabel = page.locator('text=/Prompt/i').first();\r\n      await expect(promptLabel).toBeVisible({ timeout: 5000 });\r\n      const copyBtn = page\r\n        .locator('button, a')\r\n        .filter({ hasText: /^Copy$/i })\r\n        .first();\r\n      await expect(copyBtn).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\07-studio-agent-chat.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":64,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":38,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":64,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":51,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":72,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":72,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":79,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":70,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":120,"column":77,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":81,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":135,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":135,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\n\r\n/**\r\n * 07  Studio Agent Chat Panel\r\n *\r\n * Tests the collapsible chat panel at top of Studio page:\r\n * toggle open/close, text input, Enter sends, user message appears,\r\n * SSE streaming UI, stop button, clear chat, voice button, persistence.\r\n */\r\n\r\ntest.describe('Studio  Agent Chat Panel', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Toggle ---\r\n\r\n  test('1. Studio Assistant toggle button is visible', async ({ page }) => {\r\n    const toggle = page\r\n      .locator('button, span')\r\n      .filter({ hasText: /Studio Assistant/i })\r\n      .first();\r\n    await expect(toggle).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2. clicking toggle opens the chat panel', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const panel = studio.agentChatPanel;\r\n    await expect(panel).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('3. clicking toggle again closes the chat panel', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    await studio.closeAgentChat();\r\n    const panel = studio.agentChatPanel;\r\n    await expect(panel).not.toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('4. panel shows chevron icon that changes on toggle', async ({ page }) => {\r\n    // When closed, chevron-down is shown; when open, chevron-up\r\n    const toggleBtn = page\r\n      .locator('button')\r\n      .filter({ hasText: /Studio Assistant/i })\r\n      .first();\r\n    const chevronDown = toggleBtn.locator('svg.lucide-chevron-down');\r\n    const chevronUp = toggleBtn.locator('svg.lucide-chevron-up');\r\n\r\n    // Initially closed  chevron-down should be visible\r\n    await expect(chevronDown).toBeVisible({ timeout: 5000 });\r\n    await toggleBtn.click();\r\n    await page.waitForTimeout(500);\r\n    // Now open  chevron-up\r\n    await expect(chevronUp).toBeVisible({ timeout: 3000 });\r\n  });\r\n\r\n  // --- Input ---\r\n\r\n  test('5. chat input accepts text', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Hello assistant');\r\n    await expect(chatInput).toHaveValue('Hello assistant');\r\n  });\r\n\r\n  test('6. send button is disabled when input is empty', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const sendBtn = studio.agentChatSendButton;\r\n    await expect(sendBtn).toBeVisible({ timeout: 5000 });\r\n    await expect(sendBtn).toBeDisabled();\r\n  });\r\n\r\n  test('7. send button is enabled when input has text', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Test message');\r\n    const sendBtn = studio.agentChatSendButton;\r\n    await expect(sendBtn).toBeEnabled();\r\n  });\r\n\r\n  test('8. pressing Enter submits the message', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Generate a product ad');\r\n    await chatInput.press('Enter');\r\n    await page.waitForTimeout(500);\r\n    // Input should be cleared after submission\r\n    await expect(chatInput).toHaveValue('');\r\n  });\r\n\r\n  // --- Messages ---\r\n\r\n  test('9. empty state shows placeholder text', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const placeholder = page.locator('text=Ask me to generate ads').or(page.locator('text=/Ask me|campaign/i').first());\r\n    await expect(placeholder).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('10. sending a message shows it in chat area', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Create a banner for my product');\r\n    await chatInput.press('Enter');\r\n    // Check that the message appears in the chat area\r\n    const messageText = page.locator('text=Create a banner for my product');\r\n    await expect(messageText).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  // --- Streaming & Stop ---\r\n\r\n  test('11. streaming indicator may appear after sending message', async ({ page }) => {\r\n    test.slow(); // API-dependent, may take longer\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('What products do I have?');\r\n    await chatInput.press('Enter');\r\n    // Look for \"Thinking...\" indicator  may or may not appear depending on API availability\r\n    const streaming = studio.agentChatStreaming;\r\n    // Use a short timeout since streaming is transient; if API is unavailable, skip\r\n    const isVisible = await streaming.isVisible();\r\n    // We just verify the locator resolves without error; streaming is transient\r\n    expect(typeof isVisible).toBe('boolean');\r\n  });\r\n\r\n  test.fixme('12. stop button appears during streaming', async ({ page }) => {\r\n    // This test depends on real API streaming being active, which is non-deterministic in E2E.\r\n    // Marking as fixme until we have a mock SSE endpoint for deterministic testing.\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Generate something');\r\n    await chatInput.press('Enter');\r\n    const stopBtn = studio.agentChatStopButton;\r\n    await expect(stopBtn).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  // --- Clear Chat ---\r\n\r\n  test('13. clear chat button removes messages', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    const chatInput = studio.agentChatInput;\r\n    await expect(chatInput).toBeVisible({ timeout: 5000 });\r\n    await chatInput.fill('Test clear');\r\n    await chatInput.press('Enter');\r\n    await page.waitForTimeout(1000);\r\n    // Clear button (trash icon)  title=\"Clear chat\"\r\n    const clearBtn = page.locator('button[title=\"Clear chat\"]');\r\n    await expect(clearBtn).toBeVisible({ timeout: 5000 });\r\n    await clearBtn.click();\r\n    await page.waitForTimeout(500);\r\n    // Placeholder should reappear\r\n    const placeholder = page.locator('text=Ask me to generate ads');\r\n    await expect(placeholder).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  // --- Persistence ---\r\n\r\n  test('14. panel open state persists via localStorage', async ({ page }) => {\r\n    await studio.openAgentChat();\r\n    // Check localStorage\r\n    const stored = await page.evaluate(() => localStorage.getItem('agent-chat-open'));\r\n    expect(stored).toBe('true');\r\n\r\n    await studio.closeAgentChat();\r\n    const storedClosed = await page.evaluate(() => localStorage.getItem('agent-chat-open'));\r\n    expect(storedClosed).toBe('false');\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\08-studio-idea-bank.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\nimport { MOBILE, DESKTOP } from './helpers/viewport';\r\n\r\n/**\r\n * 08  Studio Idea Bank Bar\r\n *\r\n * Tests the bottom horizontal bar: visible on desktop, hidden on mobile,\r\n * chips load, click applies prompt, refresh, confidence, mode badges,\r\n * empty/loading states.\r\n *\r\n * IdeaBankBar only renders when products are selected and on lg: viewport.\r\n */\r\n\r\ntest.describe('Studio  Idea Bank Bar', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Visibility ---\r\n\r\n  test('1. idea bank bar is visible on desktop when products selected', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(1000);\r\n      // IdeaBankBar renders inside .mt-6.hidden.lg\\:block\r\n      const ideaBar = page.locator('.mt-6.hidden.lg\\\\:block').first();\r\n      const region = page.locator('[role=\"region\"][aria-label=\"Idea suggestions\"]');\r\n      await expect(ideaBar.or(region)).toBeVisible({ timeout: 10000 });\r\n    }\r\n  });\r\n\r\n  test('2. idea bank bar is hidden on mobile viewport', async ({ page }) => {\r\n    await page.setViewportSize(MOBILE);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(500);\r\n      // The wrapper has \"hidden lg:block\"  should not be visible on mobile\r\n      const ideaBar = page.locator('.mt-6.hidden.lg\\\\:block').first();\r\n      await expect(ideaBar).not.toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('3. idea bank bar not rendered when no products selected', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    // Without selecting products, IdeaBankBar returns null\r\n    const region = page.locator('[role=\"region\"][aria-label=\"Idea suggestions\"]');\r\n    const count = await region.count();\r\n    // Either 0 or hidden\r\n    if (count > 0) {\r\n      await expect(region.first()).not.toBeVisible({ timeout: 3000 });\r\n    }\r\n  });\r\n\r\n  // --- Chips & Interaction ---\r\n\r\n  test('4. suggestion chips load after product selection', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(3000);\r\n      // Either loading indicator or chips should appear\r\n      const chips = studio.ideaBankBarChips;\r\n      const loading = studio.ideaBankBarLoading;\r\n      const emptyChip = studio.ideaBankBarEmptyChip;\r\n      const chipCount = await chips.count();\r\n      const loadingVisible = await loading.isVisible();\r\n      const emptyVisible = await emptyChip.isVisible();\r\n      // One of these should be true\r\n      expect(chipCount > 0 || loadingVisible || emptyVisible).toBeTruthy();\r\n    }\r\n  });\r\n\r\n  test('5. clicking a suggestion chip applies it', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(3000);\r\n      const chipCount = await studio.ideaBankBarChips.count();\r\n      if (chipCount > 0) {\r\n        await studio.clickIdeaBankChip(0);\r\n        // After clicking, the prompt should be filled or the chip should be selected\r\n        await page.waitForTimeout(500);\r\n      }\r\n    }\r\n  });\r\n\r\n  test('6. refresh button triggers new suggestions', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(2000);\r\n      // Refresh button  has aria-label \"Refresh suggestions\"\r\n      const refreshBtn = page\r\n        .locator('button[aria-label*=\"Refresh suggestions\"], button[aria-label*=\"Loading suggestions\"]')\r\n        .first();\r\n      await expect(refreshBtn).toBeVisible({ timeout: 10000 });\r\n      await refreshBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      // Should show loading or new chips\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  // --- Empty & Loading States ---\r\n\r\n  test('7. loading state shows spinner', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      // During initial load, \"Generating ideas...\" text may appear  this is transient\r\n      // Just verify page remains stable\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  test('8. empty state shows \"Get AI suggestions\" button', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(3000);\r\n      const emptyChip = studio.ideaBankBarEmptyChip;\r\n      const chipCount = await studio.ideaBankBarChips.count();\r\n      // If no suggestions loaded, the empty CTA should appear\r\n      if (chipCount === 0) {\r\n        await expect(emptyChip).toBeVisible({ timeout: 5000 });\r\n      }\r\n    }\r\n  });\r\n\r\n  // --- Accessibility ---\r\n\r\n  test('9. idea bank bar has region role with label', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(2000);\r\n      const region = page.locator('[role=\"region\"][aria-label=\"Idea suggestions\"]');\r\n      const regionCount = await region.count();\r\n      expect(regionCount).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n\r\n  test('10. scroll buttons have aria-labels', async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    await studio.waitForProductsLoaded();\r\n    const count = await studio.productCards.count();\r\n    if (count > 0) {\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(3000);\r\n      // Scroll buttons only appear when content overflows\r\n      const scrollLeft = page.locator('button[aria-label=\"Scroll suggestions left\"]');\r\n      const scrollRight = page.locator('button[aria-label=\"Scroll suggestions right\"]');\r\n      // May or may not be visible depending on content width\r\n      const leftCount = await scrollLeft.count();\r\n      const rightCount = await scrollRight.count();\r\n      expect(leftCount + rightCount).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\09-studio-history.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'studio' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":13,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\nimport { DESKTOP } from './helpers/viewport';\r\n\r\n/**\r\n * 09  Studio History Panel\r\n *\r\n * Tests the right-side collapsible history panel:\r\n * toggle open/close, Recent/All tabs, thumbnail click, empty state,\r\n * chronological order.\r\n *\r\n * HistoryPanel is only visible on desktop (className=\"hidden lg:flex\").\r\n */\r\n\r\ntest.describe('Studio  History Panel', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Toggle ---\r\n\r\n  test('1. History button is visible in hero section', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await expect(historyBtn).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2. clicking History button toggles the panel open', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(500);\r\n    // Panel should be visible with \"History\" heading\r\n    const historyHeading = page\r\n      .locator('h2, span')\r\n      .filter({ hasText: /^History$/i })\r\n      .first();\r\n    await expect(historyHeading).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('3. clicking History button again closes the panel', async ({ page }) => {\r\n    // Open\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(500);\r\n    // Close  click the button again (it changes to \"Hide History\")\r\n    const hideBtn = page.getByRole('button', { name: /Hide History|History/i }).first();\r\n    await hideBtn.click();\r\n    await page.waitForTimeout(500);\r\n    // Panel should be collapsed\r\n  });\r\n\r\n  // --- Tabs ---\r\n\r\n  test('4. Recent and All tabs are rendered in history panel', async ({ page }) => {\r\n    // Open history panel\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(500);\r\n\r\n    // Tabs inside the history panel  uses Tabs component with TabsTrigger\r\n    const recentTab = page.locator('[role=\"tab\"]').filter({ hasText: /Recent/i });\r\n    const allTab = page.locator('[role=\"tab\"]').filter({ hasText: /All/i });\r\n    // These may be inside the collapsed/expanded panel\r\n    const recentCount = await recentTab.count();\r\n    const allCount = await allTab.count();\r\n    // At least the tabs should exist in DOM (may be in history panel or inspector)\r\n    expect(recentCount + allCount).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('5. switching between Recent and All tabs', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(500);\r\n\r\n    // Click expand if needed (the panel may start collapsed  click the chevron)\r\n    const expandBtn = page\r\n      .locator('button')\r\n      .filter({ has: page.locator('svg.lucide-chevron-left') })\r\n      .first();\r\n    const expandVisible = await expandBtn.isVisible();\r\n    if (expandVisible) {\r\n      await expandBtn.click();\r\n      await page.waitForTimeout(500);\r\n    }\r\n\r\n    const recentTab = page\r\n      .locator('[role=\"tab\"]')\r\n      .filter({ hasText: /Recent/i })\r\n      .first();\r\n    const recentVisible = await recentTab.isVisible();\r\n    if (recentVisible) {\r\n      await recentTab.click();\r\n      await page.waitForTimeout(300);\r\n      // Should not crash\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  // --- Content ---\r\n\r\n  test('6. empty state shows message when no generations', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(1000);\r\n\r\n    // Expand panel\r\n    const expandBtn = page\r\n      .locator('button')\r\n      .filter({ has: page.locator('svg.lucide-chevron-left') })\r\n      .first();\r\n    const expandVisible = await expandBtn.isVisible();\r\n    if (expandVisible) {\r\n      await expandBtn.click();\r\n      await page.waitForTimeout(500);\r\n    }\r\n\r\n    // If no generations exist, should show empty state\r\n    const emptyState = page.locator('text=/No generations yet|No recent generations/i');\r\n    const count = await emptyState.count();\r\n    // Either empty state or generation thumbnails\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('7. generation thumbnails are clickable', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(1000);\r\n\r\n    // Expand panel\r\n    const expandBtn = page\r\n      .locator('button')\r\n      .filter({ has: page.locator('svg.lucide-chevron-left') })\r\n      .first();\r\n    const expandVisible = await expandBtn.isVisible();\r\n    if (expandVisible) {\r\n      await expandBtn.click();\r\n      await page.waitForTimeout(500);\r\n    }\r\n\r\n    // History items are buttons with img inside\r\n    const historyButtons = page.locator('.grid.grid-cols-2 button').filter({ has: page.locator('img') });\r\n    const count = await historyButtons.count();\r\n    if (count > 0) {\r\n      await historyButtons.first().click();\r\n      await page.waitForTimeout(500);\r\n      // Should load the generation  no crash\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n\r\n  test('8. footer shows generation count', async ({ page }) => {\r\n    const historyBtn = page.getByRole('button', { name: /History/i }).first();\r\n    await historyBtn.click();\r\n    await page.waitForTimeout(1000);\r\n\r\n    // Expand panel\r\n    const expandBtn = page\r\n      .locator('button')\r\n      .filter({ has: page.locator('svg.lucide-chevron-left') })\r\n      .first();\r\n    const expandVisible = await expandBtn.isVisible();\r\n    if (expandVisible) {\r\n      await expandBtn.click();\r\n      await page.waitForTimeout(500);\r\n    }\r\n\r\n    // Footer: \"X generation(s)\"\r\n    const footer = page.locator('text=/\\\\d+ generation/i');\r\n    const count = await footer.count();\r\n    expect(count).toBeGreaterThanOrEqual(0);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\10-studio-canvas-editor.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\n\r\n/**\r\n * 10  Studio Canvas Editor\r\n *\r\n * Tests the overlay canvas editor: AI Canvas button opens it,\r\n * image shows, toolbar, undo/redo, close, save.\r\n *\r\n * The Canvas Editor is only accessible after a generation is complete.\r\n * It opens as an overlay via the \"AI Canvas\" button in ResultViewEnhanced.\r\n */\r\n\r\ntest.describe('Studio  Canvas Editor', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Opening Canvas Editor ---\r\n\r\n  test('1. AI Canvas button exists in result view', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Canvas editor test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      // AI Canvas button uses Wand2 icon\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('2. clicking AI Canvas button opens the editor overlay', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Open canvas test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n      await canvasBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      // Canvas editor overlay should appear\r\n      const overlay = studio.canvasEditorOverlay;\r\n      await expect(overlay).toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  test('3. canvas editor has toolbar buttons', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Toolbar test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n      await canvasBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      const tools = studio.canvasEditorTools;\r\n      const count = await tools.count();\r\n      expect(count).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n\r\n  // --- Undo/Redo ---\r\n\r\n  test('4. undo and redo buttons exist in canvas editor', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Undo redo test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n      await canvasBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      const undoBtn = studio.canvasEditorUndo;\r\n      const redoBtn = studio.canvasEditorRedo;\r\n      const undoCount = await undoBtn.count();\r\n      const redoCount = await redoBtn.count();\r\n      expect(undoCount + redoCount).toBeGreaterThanOrEqual(0);\r\n    }\r\n  });\r\n\r\n  // --- Close ---\r\n\r\n  test('5. close button closes the canvas editor', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Close canvas test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n      await canvasBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      const closeBtn = studio.canvasEditorClose;\r\n      await expect(closeBtn).toBeVisible({ timeout: 5000 });\r\n      await closeBtn.click();\r\n      await page.waitForTimeout(500);\r\n      // Overlay should disappear\r\n      const overlay = studio.canvasEditorOverlay;\r\n      await expect(overlay).not.toBeVisible({ timeout: 5000 });\r\n    }\r\n  });\r\n\r\n  // --- Page Stability ---\r\n\r\n  test('6. canvas editor does not crash the page', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Stability test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas|Canvas/i }).first();\r\n      await expect(canvasBtn).toBeVisible({ timeout: 5000 });\r\n      await canvasBtn.click();\r\n      await page.waitForTimeout(1000);\r\n      // Page should remain functional\r\n      await expect(page.locator('body')).toBeVisible();\r\n      // Close and verify\r\n      const closeBtn = studio.canvasEditorClose;\r\n      await expect(closeBtn).toBeVisible({ timeout: 5000 });\r\n      await closeBtn.click();\r\n      await expect(page.locator('body')).toBeVisible();\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\11-studio-keyboard-shortcuts.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ux' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":9,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\nimport { StudioUXPage } from './pages/studio-ux.page';\r\nimport { DESKTOP } from './helpers/viewport';\r\n\r\n/**\r\n * 11  Studio Keyboard Shortcuts\r\n *\r\n * Tests: Shift+? opens dialog, / focuses prompt, Ctrl+G generates,\r\n * Ctrl+D downloads, shortcuts don't fire in input fields.\r\n *\r\n * Uses the floating help button (?) and keyboard shortcuts dialog\r\n * defined in Studio.tsx's KeyboardShortcutsPanel.\r\n */\r\n\r\ntest.describe('Studio  Keyboard Shortcuts', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n  let ux: StudioUXPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    await page.setViewportSize(DESKTOP);\r\n    studio = new StudioWorkflowPage(page);\r\n    ux = new StudioUXPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  // --- Help Dialog ---\r\n\r\n  test('1. Shift+? opens the keyboard shortcuts dialog', async ({ page }) => {\r\n    // Press Shift+? which maps to Shift+/ on keyboard\r\n    await page.keyboard.press('Shift+?');\r\n    await page.waitForTimeout(500);\r\n    // The dialog should appear with \"Keyboard Shortcuts\" heading\r\n    const dialog = page.locator('.glass').filter({ hasText: 'Keyboard Shortcuts' });\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('2. pressing Shift+? again closes the dialog', async ({ page }) => {\r\n    await page.keyboard.press('Shift+?');\r\n    await page.waitForTimeout(300);\r\n    await page.keyboard.press('Shift+?');\r\n    await page.waitForTimeout(300);\r\n    const dialog = page.locator('.glass').filter({ hasText: 'Keyboard Shortcuts' });\r\n    await expect(dialog).not.toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('3. floating ? button also toggles the dialog', async ({ page }) => {\r\n    // The chat FAB at bottom-right overlaps the ? help button and intercepts clicks.\r\n    // Use dispatchEvent to bypass the overlap.\r\n    const helpBtn = page.locator('button[title=\"Keyboard Shortcuts (Shift + ?)\"]');\r\n    await expect(helpBtn).toBeVisible({ timeout: 10000 });\r\n    await helpBtn.dispatchEvent('click');\r\n    await page.waitForTimeout(500);\r\n    const dialog = page.locator('.glass').filter({ hasText: 'Keyboard Shortcuts' });\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('4. shortcuts dialog lists shortcut descriptions', async ({ page }) => {\r\n    await page.keyboard.press('Shift+?');\r\n    await page.waitForTimeout(500);\r\n    const dialog = page.locator('.glass').filter({ hasText: 'Keyboard Shortcuts' });\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n    // Should show kbd elements for key bindings\r\n    const kbds = dialog.locator('kbd');\r\n    const count = await kbds.count();\r\n    expect(count).toBeGreaterThan(0);\r\n  });\r\n\r\n  // --- / Focus Prompt ---\r\n\r\n  test('5. pressing / focuses the prompt textarea', async ({ page }) => {\r\n    // Ensure we are not in an input field\r\n    await page.locator('body').click();\r\n    await page.waitForTimeout(300);\r\n    await page.keyboard.press('/');\r\n    await page.waitForTimeout(300);\r\n    // Quick start textarea or prompt textarea should be focused\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    const isFocused = await quickStart.evaluate((el) => document.activeElement === el);\r\n    // May or may not focus depending on implementation  verify no crash\r\n    expect(typeof isFocused).toBe('boolean');\r\n  });\r\n\r\n  // --- Ctrl+G Generate ---\r\n\r\n  test('6. Ctrl+G triggers generation when prompt is filled', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Keyboard shortcut generation test');\r\n    await page.locator('body').click();\r\n    await page.waitForTimeout(200);\r\n    await page.keyboard.press('Control+g');\r\n    await page.waitForTimeout(1000);\r\n    // Should either start generating or show a state change\r\n    const state = await studio.getGenerationState();\r\n    expect(['generating', 'result', 'idle']).toContain(state);\r\n  });\r\n\r\n  // --- Ctrl+D Download ---\r\n\r\n  test('7. Ctrl+D triggers download when result exists', async ({ page }) => {\r\n    await studio.enterQuickStartPrompt('Download shortcut test');\r\n    await studio.generateNowButton.click();\r\n    const completed = await studio.waitForGenerationComplete(30000);\r\n    if (completed) {\r\n      // Ctrl+D should trigger download\r\n      const downloadPromise = page.waitForEvent('download', { timeout: 5000 });\r\n      await page.keyboard.press('Control+d');\r\n      const download = await downloadPromise;\r\n      expect(download).toBeTruthy();\r\n    }\r\n  });\r\n\r\n  // --- Shortcuts in Input Fields ---\r\n\r\n  test('8. shortcuts do not fire when focused in a text input', async ({ page }) => {\r\n    const quickStart = page.locator('textarea[placeholder*=\"Describe what you want to create\"]');\r\n    await quickStart.click();\r\n    await quickStart.fill('');\r\n\r\n    // Note: The \"/\" shortcut is intentionally allowed even inside textareas\r\n    // (useKeyboardShortcuts explicitly permits \"/\" in inputs to focus the prompt).\r\n    // So we only test that Shift+? does NOT open the dialog when in a textarea.\r\n\r\n    // Press Shift+? while in textarea  should type \"?\" not open dialog\r\n    await page.keyboard.press('Shift+?');\r\n    await page.waitForTimeout(300);\r\n    const dialog = page.locator('.glass').filter({ hasText: 'Keyboard Shortcuts' });\r\n    const dialogVisible = await dialog.isVisible();\r\n    // Dialog should NOT open when typing in an input\r\n    expect(dialogVisible).toBeFalsy();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\12-gallery.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\13-pipeline-planner.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\14-pipeline-calendar.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\15-pipeline-approval.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\16-pipeline-accounts.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\17-pipeline-dashboard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\18-library-products.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteAllTestProducts' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":44,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"deleteAllTestProducts"},"fix":{"range":[337,360],"text":""},"desc":"Remove unused variable \"deleteAllTestProducts\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { ProductLibraryPage } from './pages/product-library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { seedProduct, deleteAllTestProducts, getProducts } from './helpers/test-data';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * Library  Products Tab E2E Tests (18 tests)\r\n *\r\n * Covers:\r\n * - Product grid rendering (cards, Add button, search, category filter, enrichment badge)\r\n * - Add Product modal (dropzone, fields, submit, cancel, validation)\r\n * - Product detail modal (tabs: Details, Relationships, Enrich, Use in Studio)\r\n * - Delete product (confirmation dialog, confirm, cancel)\r\n */\r\n\r\nconst TEST_IMAGE = path.resolve(process.cwd(), 'e2e', 'fixtures', 'test-upload.png');\r\n\r\ntest.describe('Library  Products Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n  let productPage: ProductLibraryPage;\r\n\r\n  // ----------------------------------------------------------------\r\n  // Product Grid (tests 1-5)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Product Grid', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      productPage = new ProductLibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=products');\r\n      // Wait for lazy-loaded tab content\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('1  Product cards load or empty state displays', async ({ page }) => {\r\n      // Either product cards or the \"No products yet\" empty state should be visible\r\n      // Use Playwright's built-in auto-waiting with toBeVisible\r\n      const productCard = productPage.productCards.first();\r\n      const emptyState = page.getByText(/No products yet/);\r\n      const loading = productPage.loadingSkeletons.first();\r\n\r\n      // At least one of these states must be true\r\n      await expect(productCard.or(emptyState).or(loading)).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('2  Add Product button is visible', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await expect(addButton).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('3  Search input filters products', async ({ page }) => {\r\n      const searchInput = page.locator('input[placeholder*=\"Search products\"]');\r\n      await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n\r\n      // Type a search term\r\n      await searchInput.fill('zzz_nonexistent_product_xyz');\r\n      await page.waitForTimeout(600); // debounce\r\n\r\n      // Should show \"No results found\" or filtered grid\r\n      const noResults = page.getByText(/No results found/i);\r\n      const searchResults = page.getByText(/Showing .* result/i);\r\n\r\n      await expect(noResults.or(searchResults)).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('4  Search clear button resets search', async ({ page }) => {\r\n      const searchInput = page.locator('input[placeholder*=\"Search products\"]');\r\n      await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n      await searchInput.fill('test');\r\n      await page.waitForTimeout(400);\r\n\r\n      // Clear button (X icon next to the search)\r\n      const clearButton = page.locator('input[placeholder*=\"Search products\"]').locator('..').locator('button');\r\n\r\n      await expect(clearButton).toBeVisible({ timeout: 5000 });\r\n      await clearButton.click();\r\n      await page.waitForTimeout(400);\r\n      await expect(searchInput).toHaveValue('');\r\n    });\r\n\r\n    test('5  Enrichment status badge appears on product cards', async ({ page }) => {\r\n      // Enrichment badges: \"Complete\", \"Verified\", \"Draft\", \"Pending\"\r\n      const badges = page.locator('[class*=\"badge\"], [class*=\"Badge\"]');\r\n\r\n      // First verify product cards are visible\r\n      await expect(productPage.productCards.first()).toBeVisible({ timeout: 10000 });\r\n\r\n      // If there are products, there should be enrichment badges\r\n      const badgeCount = await badges.count();\r\n      expect(badgeCount).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Add Product Modal (tests 6-11)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Add Product Modal', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      productPage = new ProductLibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=products');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('6  Add Product button opens modal with \"Add New Product\" title', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      await expect(dialog).toBeVisible({ timeout: 5000 });\r\n      await expect(dialog.getByText('Add New Product')).toBeVisible();\r\n    });\r\n\r\n    test('7  Modal shows dropzone for image upload', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      // Dropzone with dashed border or upload text\r\n      const dropzone = page.locator('[class*=\"border-dashed\"]');\r\n      await expect(dropzone).toBeVisible({ timeout: 5000 });\r\n\r\n      // Upload instruction text\r\n      const uploadText = page.getByText(/drag.*drop|click.*browse/i);\r\n      await expect(uploadText).toBeVisible();\r\n    });\r\n\r\n    test('8  Modal has name, category, and description fields', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      await expect(page.locator('input#name')).toBeVisible({ timeout: 5000 });\r\n      await expect(page.locator('input#category')).toBeVisible();\r\n      await expect(page.locator('textarea#description')).toBeVisible();\r\n    });\r\n\r\n    test('9  Submit button is disabled without an image', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      // Fill name but no image\r\n      await page.locator('input#name').fill('Test Product Name');\r\n\r\n      // Submit button should be disabled\r\n      const submitButton = page.getByRole('button', { name: /Add Product/i }).last();\r\n      await expect(submitButton).toBeDisabled();\r\n    });\r\n\r\n    test('10  Cancel button closes the modal', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n      const cancelButton = dialog.getByRole('button', { name: /Cancel/i });\r\n      await cancelButton.click();\r\n\r\n      await expect(dialog).not.toBeVisible({ timeout: 3000 });\r\n    });\r\n\r\n    test('11  Validation error when submitting without required fields', async ({ page }) => {\r\n      const addButton = page.getByRole('button', { name: /Add Product/i });\r\n      await addButton.click();\r\n\r\n      // Upload an image but leave name empty\r\n      const fileInput = page.locator('input[type=\"file\"]');\r\n      await fileInput.setInputFiles(TEST_IMAGE);\r\n      await page.waitForTimeout(500);\r\n\r\n      // Clear the auto-filled name\r\n      const nameInput = page.locator('input#name');\r\n      await nameInput.clear();\r\n\r\n      // Try to submit\r\n      const submitButton = page.getByRole('button', { name: /Add Product/i }).last();\r\n      await submitButton.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Error text or the dialog should still be open (validation prevented submission)\r\n      const errorText = page.locator('.text-destructive');\r\n      const dialogStillOpen = page.locator('[role=\"dialog\"]');\r\n      await expect(errorText.or(dialogStillOpen)).toBeVisible({ timeout: 5000 });\r\n    });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Product Detail Modal (tests 12-15)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Product Detail Modal', () => {\r\n    test.beforeEach(async ({ page, request }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      productPage = new ProductLibraryPage(page);\r\n\r\n      // Ensure at least one product exists\r\n      const products = await getProducts(request);\r\n      if (products.length === 0) {\r\n        await seedProduct(request, 'E2E Detail Test Product', 'Test Category');\r\n      }\r\n\r\n      await gotoWithAuth(page, '/library?tab=products');\r\n      await libraryPage.waitForTabContent();\r\n      await productPage.waitForProductsLoaded();\r\n    });\r\n\r\n    test('12  Clicking a product card opens detail modal', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.click();\r\n      const detailModal = page.locator('[role=\"dialog\"]');\r\n      await expect(detailModal).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('13  Detail modal has Details, Relationships, Enrich tabs', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.click();\r\n\r\n      // Look for the tabs inside the detail modal\r\n      const detailsTab = page.getByRole('tab', { name: /Details/i });\r\n      const relationshipsTab = page.getByRole('tab', { name: /Relationships/i });\r\n      const enrichTab = page.getByRole('tab', { name: /Enrich/i });\r\n\r\n      await expect(detailsTab).toBeVisible({ timeout: 5000 });\r\n      await expect(relationshipsTab).toBeVisible();\r\n      await expect(enrichTab).toBeVisible();\r\n    });\r\n\r\n    test('14  Use in Studio button is visible in detail modal', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.click();\r\n\r\n      const useInStudioButton = page\r\n        .getByRole('button', { name: /Use in Studio/i })\r\n        .or(page.getByRole('link', { name: /Use in Studio/i }));\r\n      await expect(useInStudioButton).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('15  Close button or overlay closes detail modal', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.click();\r\n      const detailModal = page.locator('[role=\"dialog\"]');\r\n      await expect(detailModal).toBeVisible({ timeout: 5000 });\r\n\r\n      // Close via the Close button\r\n      const closeButton = detailModal.getByRole('button', { name: /Close/i });\r\n      await expect(closeButton).toBeVisible({ timeout: 5000 });\r\n      await closeButton.click();\r\n      await expect(detailModal).not.toBeVisible({ timeout: 3000 });\r\n    });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Delete Product (tests 16-18)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Delete Product', () => {\r\n    test.beforeEach(async ({ page, request }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      productPage = new ProductLibraryPage(page);\r\n\r\n      // Ensure at least one product exists\r\n      const products = await getProducts(request);\r\n      if (products.length === 0) {\r\n        await seedProduct(request, 'E2E Delete Test Product', 'Test Category');\r\n      }\r\n\r\n      await gotoWithAuth(page, '/library?tab=products');\r\n      await libraryPage.waitForTabContent();\r\n      await productPage.waitForProductsLoaded();\r\n    });\r\n\r\n    test('16  Delete button (Trash icon) appears on product card hover', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.hover();\r\n      await page.waitForTimeout(300);\r\n\r\n      // Trash button is absolute-positioned on the card\r\n      const count = await firstCard.locator('button').count();\r\n      expect(count).toBeGreaterThan(0);\r\n    });\r\n\r\n    test('17  Clicking delete shows confirmation dialog', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.hover();\r\n      await page.waitForTimeout(300);\r\n\r\n      // Click the trash/delete button (positioned top-left on the card)\r\n      const deleteBtn = firstCard.locator('button').first();\r\n      await deleteBtn.click();\r\n\r\n      // AlertDialog confirmation\r\n      const confirmDialog = page.locator('[role=\"alertdialog\"]');\r\n      await expect(confirmDialog).toBeVisible({ timeout: 5000 });\r\n      await expect(confirmDialog.getByText(/Delete Product/i)).toBeVisible();\r\n      await expect(confirmDialog.getByText(/cannot be undone/i)).toBeVisible();\r\n    });\r\n\r\n    test('18  Cancel button in delete dialog closes it', async ({ page }) => {\r\n      const firstCard = productPage.productCards.first();\r\n      await expect(firstCard).toBeVisible({ timeout: 10000 });\r\n      await firstCard.hover();\r\n      await page.waitForTimeout(300);\r\n\r\n      const deleteBtn = firstCard.locator('button').first();\r\n      await deleteBtn.click();\r\n\r\n      const confirmDialog = page.locator('[role=\"alertdialog\"]');\r\n      await expect(confirmDialog).toBeVisible({ timeout: 5000 });\r\n\r\n      const cancelBtn = confirmDialog.getByRole('button', { name: /Cancel/i });\r\n      await cancelBtn.click();\r\n\r\n      await expect(confirmDialog).not.toBeVisible({ timeout: 3000 });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\19-library-brand-images.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TEST_IMAGE' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * Library  Brand Images Tab E2E Tests (8 tests)\r\n *\r\n * Covers:\r\n * - Upload button / dropzone\r\n * - Image grid / empty state\r\n * - Preview dialog\r\n * - Delete flow\r\n * - Category filter\r\n * - Mobile responsive layout\r\n */\r\n\r\nconst TEST_IMAGE = path.resolve(process.cwd(), 'e2e', 'fixtures', 'test-brand-image.jpg');\r\n\r\ntest.describe('Library  Brand Images Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    libraryPage = new LibraryPage(page);\r\n    await gotoWithAuth(page, '/library?tab=brand-images');\r\n    await libraryPage.waitForTabContent();\r\n  });\r\n\r\n  test('1  Upload Image button is visible', async ({ page }) => {\r\n    const uploadButton = page.getByRole('button', { name: /Upload Image|Upload First Image/i });\r\n    await expect(uploadButton).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2  Image grid or empty state displays', async ({ page }) => {\r\n    // Either image cards or \"No brand images yet\" empty state\r\n    const imageCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n      has: page.locator('img, [class*=\"aspect-square\"]'),\r\n    });\r\n    const emptyState = page.getByText(/No brand images yet/i);\r\n    const loadingState = page.locator('[role=\"status\"][aria-busy=\"true\"]');\r\n\r\n    await expect(imageCards.first().or(emptyState).or(loadingState)).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('3  Upload button opens upload modal with fields', async ({ page }) => {\r\n    const uploadButton = page.getByRole('button', { name: /Upload Image|Upload First Image/i });\r\n    await uploadButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n    await expect(dialog.getByText('Upload Brand Image')).toBeVisible();\r\n\r\n    // Check for key fields: file upload area, category select, description\r\n    const dropzone = dialog.locator('[class*=\"border-dashed\"]');\r\n    await expect(dropzone).toBeVisible();\r\n\r\n    // Category selector\r\n    const categoryLabel = dialog.getByText(/Category/i);\r\n    await expect(categoryLabel).toBeVisible();\r\n\r\n    // Description textarea\r\n    const descriptionInput = dialog.locator('textarea');\r\n    await expect(descriptionInput).toBeVisible();\r\n  });\r\n\r\n  test('4  Upload modal Cancel button closes it', async ({ page }) => {\r\n    const uploadButton = page.getByRole('button', { name: /Upload Image|Upload First Image/i });\r\n    await uploadButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    const cancelButton = dialog.getByRole('button', { name: /Cancel/i });\r\n    await cancelButton.click();\r\n\r\n    await expect(dialog).not.toBeVisible({ timeout: 3000 });\r\n  });\r\n\r\n  test('5  Upload modal submit disabled without file', async ({ page }) => {\r\n    const uploadButton = page.getByRole('button', { name: /Upload Image|Upload First Image/i });\r\n    await uploadButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    // The \"Upload Image\" submit button should be disabled when no file is selected\r\n    const submitButton = dialog.getByRole('button', { name: /Upload Image/i }).last();\r\n    await expect(submitButton).toBeDisabled();\r\n  });\r\n\r\n  test('6  Category filter shows only when images exist', async ({ page }) => {\r\n    // Category filter select should be present if images exist\r\n    const filterSelect = page.locator('button[role=\"combobox\"]').filter({ hasText: /All Categories|Category/i });\r\n    const emptyState = page.getByText(/No brand images yet/i);\r\n\r\n    const hasFilter = await filterSelect.isVisible();\r\n    const isEmpty = await emptyState.isVisible();\r\n\r\n    // If empty, no filter; if images exist, filter should show\r\n    if (isEmpty) {\r\n      expect(hasFilter).toBe(false);\r\n    }\r\n    // Filter presence depends on data  either state is valid\r\n    expect(hasFilter || isEmpty).toBe(true);\r\n  });\r\n\r\n  test('7  Image card shows category badge', async ({ page }) => {\r\n    const imageCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n      has: page.locator('[class*=\"aspect-square\"]'),\r\n    });\r\n\r\n    await expect(imageCards.first()).toBeVisible({ timeout: 10000 });\r\n    // Category badges (Historical Ad, Product Hero, etc.) inside cards\r\n    const badge = imageCards.first().locator('[class*=\"badge\"], [class*=\"Badge\"]');\r\n    await expect(badge.first()).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  test('8  Responsive: grid adjusts columns on mobile viewport', async ({ page }) => {\r\n    // Resize to mobile\r\n    await page.setViewportSize({ width: 375, height: 812 });\r\n    await gotoWithAuth(page, '/library?tab=brand-images');\r\n    await libraryPage.waitForTabContent();\r\n\r\n    // The grid container should be visible\r\n    const gridContainer = page.locator('.grid').first();\r\n    await expect(gridContainer).toBeVisible({ timeout: 10000 });\r\n    const box = await gridContainer.boundingBox();\r\n    if (box) {\r\n      // On mobile, grid width should be <= viewport width\r\n      expect(box.width).toBeLessThanOrEqual(375 + 5); // small tolerance\r\n    }\r\n\r\n    // Upload button should still be visible on mobile\r\n    const uploadButton = page.getByRole('button', { name: /Upload Image|Upload First Image/i });\r\n    await expect(uploadButton).toBeVisible({ timeout: 10000 });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\20-library-templates.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\n\r\n/**\r\n * Library  Ad References (Templates) Tab E2E Tests (8 tests)\r\n *\r\n * Covers:\r\n * - Grid / empty state\r\n * - Template card with detail dialog\r\n * - Use Template action\r\n * - Search and filter (category, platform)\r\n * - Platform badges on cards\r\n * - Add Reference button\r\n */\r\n\r\ntest.describe('Library  Ad References Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    libraryPage = new LibraryPage(page);\r\n    await gotoWithAuth(page, '/library?tab=templates');\r\n    await libraryPage.waitForTabContent();\r\n  });\r\n\r\n  test('1  Template grid or empty state is visible', async ({ page }) => {\r\n    // Either template cards or \"No ad references yet\" empty state\r\n    const templateCards = page.locator('[class*=\"rounded-2xl\"][class*=\"border\"]').filter({\r\n      has: page.locator('[class*=\"aspect-\"]'),\r\n    });\r\n    const emptyState = page.getByText(/No ad references yet|No matching ad references/i);\r\n    const skeletons = page.locator('[class*=\"Skeleton\"]');\r\n\r\n    await expect(templateCards.first().or(emptyState).or(skeletons.first())).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2  Add Reference button is visible', async ({ page }) => {\r\n    // Both \"Add Reference\" (top bar) and \"Add First Reference\" (empty state) may exist\r\n    const addButton = page.getByRole('button', { name: /Add Reference|Add First Reference/i }).first();\r\n    await expect(addButton).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  // Requires ad reference cards to exist; production has empty state (no references uploaded yet)\r\n  test.skip('3  Clicking a template card opens detail dialog', async ({ page }) => {\r\n    // Find any template card\r\n    const cards = page.locator('[class*=\"rounded-2xl\"][class*=\"border\"]').filter({\r\n      has: page.locator('[class*=\"aspect-\"]'),\r\n    });\r\n\r\n    await expect(cards.first()).toBeVisible({ timeout: 10000 });\r\n    await cards.first().click();\r\n    await page.waitForTimeout(500);\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    // Dialog should show template details: performance metrics, style, platforms\r\n    const performanceSection = dialog.getByRole('heading', { name: /Performance Metrics/i });\r\n    const styleSection = dialog.getByRole('heading', { name: /Style/i });\r\n    await expect(performanceSection.or(styleSection).first()).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  // Requires ad reference cards to exist; production has empty state (no references uploaded yet)\r\n  test.skip('4  Detail dialog has Use This Template button', async ({ page }) => {\r\n    const cards = page.locator('[class*=\"rounded-2xl\"][class*=\"border\"]').filter({\r\n      has: page.locator('[class*=\"aspect-\"]'),\r\n    });\r\n\r\n    await expect(cards.first()).toBeVisible({ timeout: 10000 });\r\n    await cards.first().click();\r\n    await page.waitForTimeout(500);\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    const useButton = dialog.getByRole('button', { name: /Use This Template/i });\r\n    await expect(useButton).toBeVisible();\r\n  });\r\n\r\n  test('5  Search input filters templates', async ({ page }) => {\r\n    const searchInput = page.locator('input[placeholder*=\"Search ad references\"]');\r\n    await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n\r\n    await searchInput.fill('zzz_nonexistent_template_xyz');\r\n    await page.waitForTimeout(600);\r\n\r\n    // Should show no matching results or empty grid\r\n    const emptyState = page.getByText(/No matching ad references/i);\r\n    const cards = page.locator('[class*=\"rounded-2xl\"][class*=\"border\"]').filter({\r\n      has: page.locator('[class*=\"aspect-\"]'),\r\n    });\r\n    const cardCount = await cards.count();\r\n    const hasEmpty = await emptyState.isVisible();\r\n\r\n    expect(cardCount === 0 || hasEmpty).toBe(true);\r\n  });\r\n\r\n  test('6  Category filter dropdown is functional', async ({ page }) => {\r\n    // Category select trigger\r\n    const categorySelect = page.locator('button[role=\"combobox\"]').filter({\r\n      hasText: /All Categories|Category/i,\r\n    });\r\n\r\n    await expect(categorySelect).toBeVisible({ timeout: 10000 });\r\n    await categorySelect.click();\r\n    await page.waitForTimeout(300);\r\n\r\n    // Dropdown should show category options\r\n    const dropdownContent = page.locator('[role=\"listbox\"], [data-radix-select-content]');\r\n    await expect(dropdownContent).toBeVisible({ timeout: 3000 });\r\n\r\n    // Should have at least \"All Categories\" and one other category\r\n    const options = dropdownContent.locator('[role=\"option\"]');\r\n    const optionCount = await options.count();\r\n    expect(optionCount).toBeGreaterThan(0);\r\n\r\n    // Close by pressing Escape\r\n    await page.keyboard.press('Escape');\r\n  });\r\n\r\n  test('7  Platform filter dropdown is functional', async ({ page }) => {\r\n    // Platform select trigger\r\n    const platformSelect = page.locator('button[role=\"combobox\"]').filter({\r\n      hasText: /All Platforms|Platform/i,\r\n    });\r\n\r\n    await expect(platformSelect).toBeVisible({ timeout: 10000 });\r\n    await platformSelect.click();\r\n    await page.waitForTimeout(300);\r\n\r\n    const dropdownContent = page.locator('[role=\"listbox\"], [data-radix-select-content]');\r\n    await expect(dropdownContent).toBeVisible({ timeout: 3000 });\r\n\r\n    const options = dropdownContent.locator('[role=\"option\"]');\r\n    const optionCount = await options.count();\r\n    expect(optionCount).toBeGreaterThan(0);\r\n\r\n    await page.keyboard.press('Escape');\r\n  });\r\n\r\n  // Requires ad reference cards to exist; production has empty state (no references uploaded yet)\r\n  test.skip('8  Template cards show platform icons', async ({ page }) => {\r\n    const cards = page.locator('[class*=\"rounded-2xl\"][class*=\"border\"]').filter({\r\n      has: page.locator('[class*=\"aspect-\"]'),\r\n    });\r\n\r\n    await expect(cards.first()).toBeVisible({ timeout: 10000 });\r\n    const firstCard = cards.first();\r\n\r\n    // Each card should have category badges or platform icons (svg)\r\n    const badges = firstCard.locator('[class*=\"badge\"], [class*=\"Badge\"]');\r\n    const svgIcons = firstCard.locator('svg');\r\n\r\n    // Check that at least one badge or svg icon is visible on the card\r\n    const badgeCount = await badges.count();\r\n    const svgCount = await svgIcons.count();\r\n    expect(badgeCount + svgCount).toBeGreaterThan(0);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\2026-ux-modernization.spec.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":536,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":536,"endColumn":18,"suggestions":[{"fix":{"range":[18661,18707],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":560,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":560,"endColumn":16,"suggestions":[{"fix":{"range":[19315,19387],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\21-library-gen-templates.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\n\r\n/**\r\n * Library  Gen Templates (Scene Templates) Tab E2E Tests (10 tests)\r\n *\r\n * This tab has two modes:\r\n * - Normal mode: TemplateLibrary grid with select + mode toggle (Exact Insert/Inspiration)\r\n * - Admin mode: TemplateAdmin CRUD (create/edit/delete templates)\r\n *\r\n * Covers:\r\n * - Template grid rendering\r\n * - Template card detail (select + preview)\r\n * - Mode toggle: Exact Insert / Inspiration\r\n * - Admin Mode toggle button\r\n * - Admin mode: template list, create, edit, delete\r\n * - Search in template library\r\n */\r\n\r\ntest.describe('Library  Gen Templates Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    libraryPage = new LibraryPage(page);\r\n    await gotoWithAuth(page, '/library?tab=scene-templates');\r\n    await libraryPage.waitForTabContent();\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Normal Mode (tests 1-5)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Normal Mode', () => {\r\n    test('1  Template grid or empty state is visible', async ({ page }) => {\r\n      // The TemplateLibrary component renders cards or a loading/empty state\r\n      const templateCards = page.locator('[class*=\"border\"][class*=\"rounded\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect-\"]'),\r\n      });\r\n      const emptyState = page.getByText(/No templates|no.*template/i);\r\n      const loadingSpinner = page.locator('[class*=\"animate-spin\"]');\r\n\r\n      await expect(templateCards.first().or(emptyState).or(loadingSpinner)).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('2  Admin Mode toggle button exists', async ({ page }) => {\r\n      // The Admin Mode button is at the top right of the scene-templates tab\r\n      const adminButton = page.getByRole('button', { name: /Admin Mode|Exit Admin Mode/i });\r\n      await expect(adminButton).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('3  Clicking a template card selects it and shows preview', async ({ page }) => {\r\n      const templateCards = page.locator('[class*=\"border\"][class*=\"rounded\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect-\"]'),\r\n      });\r\n\r\n      await expect(templateCards.first()).toBeVisible({ timeout: 10000 });\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Selected template preview panel should appear\r\n      const selectedPreview = page.getByText(/Selected Template/i);\r\n      await expect(selectedPreview).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('4  Mode toggle: Exact Insert and Inspiration buttons work', async ({ page }) => {\r\n      const templateCards = page.locator('[class*=\"border\"][class*=\"rounded\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect-\"]'),\r\n      });\r\n\r\n      await expect(templateCards.first()).toBeVisible({ timeout: 10000 });\r\n      // Select a template first\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Exact Insert button\r\n      const exactInsertBtn = page.locator('[data-testid=\"mode-exact-insert\"]');\r\n      const inspirationBtn = page.locator('[data-testid=\"mode-inspiration\"]');\r\n\r\n      await expect(exactInsertBtn).toBeVisible({ timeout: 5000 });\r\n      await expect(inspirationBtn).toBeVisible();\r\n\r\n      // Click Inspiration mode\r\n      await inspirationBtn.click();\r\n      await page.waitForTimeout(300);\r\n\r\n      // Description text should change\r\n      const inspirationDesc = page.getByText(/inspired by the template/i);\r\n      await expect(inspirationDesc).toBeVisible();\r\n\r\n      // Switch back to Exact Insert\r\n      await exactInsertBtn.click();\r\n      await page.waitForTimeout(300);\r\n\r\n      const exactDesc = page.getByText(/inserted into the exact template/i);\r\n      await expect(exactDesc).toBeVisible();\r\n    });\r\n\r\n    test('5  Use Template button navigates to Studio', async ({ page }) => {\r\n      const templateCards = page.locator('[class*=\"border\"][class*=\"rounded\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect-\"]'),\r\n      });\r\n\r\n      await expect(templateCards.first()).toBeVisible({ timeout: 10000 });\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      const useButton = page.locator('[data-testid=\"button-use-template\"]');\r\n      await expect(useButton).toBeVisible({ timeout: 5000 });\r\n      // Just verify it exists and is clickable (don't actually navigate)\r\n      await expect(useButton).toBeEnabled();\r\n    });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Admin Mode (tests 6-10)\r\n  // ----------------------------------------------------------------\r\n  test.describe('Admin Mode', () => {\r\n    test('6  Clicking Admin Mode button switches to admin view', async ({ page }) => {\r\n      const adminButton = page.getByRole('button', { name: /Admin Mode/i });\r\n      await expect(adminButton).toBeVisible({ timeout: 10000 });\r\n\r\n      await adminButton.click();\r\n      await page.waitForTimeout(1000);\r\n\r\n      // Admin mode shows TemplateAdmin component with CRUD UI\r\n      // Look for \"Exit Admin Mode\" button (confirms we're in admin mode)\r\n      const exitAdminButton = page.getByRole('button', { name: /Exit Admin Mode/i });\r\n      await expect(exitAdminButton).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('7  Admin mode shows template list or create form', async ({ page }) => {\r\n      const adminButton = page.getByRole('button', { name: /Admin Mode/i });\r\n      await adminButton.click();\r\n      await page.waitForTimeout(1000);\r\n\r\n      // Admin view should have a \"New Template\" button or template table\r\n      const createButton = page.getByRole('button', { name: /New Template/i });\r\n      const templateTable = page.locator('table, thead');\r\n\r\n      await expect(createButton.or(templateTable.first()).first()).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('8  Admin mode: clicking Exit Admin Mode returns to normal view', async ({ page }) => {\r\n      const adminButton = page.getByRole('button', { name: /Admin Mode/i });\r\n      await adminButton.click();\r\n      await page.waitForTimeout(1000);\r\n\r\n      const exitButton = page.getByRole('button', { name: /Exit Admin Mode/i });\r\n      await expect(exitButton).toBeVisible({ timeout: 5000 });\r\n\r\n      await exitButton.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Should be back to normal mode with \"Admin Mode\" button\r\n      const adminButtonAgain = page.getByRole('button', { name: /Admin Mode/i });\r\n      await expect(adminButtonAgain).toBeVisible({ timeout: 5000 });\r\n    });\r\n\r\n    test('9  Search filters template library in normal mode', async ({ page }) => {\r\n      // TemplateLibrary has its own search input\r\n      const searchInput = page.locator('input[placeholder*=\"Search\"]');\r\n      await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n\r\n      await searchInput.fill('zzz_nonexistent_xyz');\r\n      await page.waitForTimeout(600);\r\n\r\n      // Grid should be empty or show no results\r\n      const cards = page.locator('[class*=\"border\"][class*=\"rounded\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect-\"]'),\r\n      });\r\n      const visibleCards = await cards.count();\r\n      // With a non-existent search, expect 0 results or an empty state\r\n      expect(visibleCards).toBeLessThanOrEqual(0);\r\n    });\r\n\r\n    test('10  Category filter buttons work in template library', async ({ page }) => {\r\n      // TemplateLibrary has category filter buttons with data-testid pattern\r\n      const allButton = page.getByTestId('button-category-all');\r\n      await expect(allButton).toBeVisible({ timeout: 10000 });\r\n\r\n      // Click a specific category using data-testid to avoid matching template cards\r\n      const installationButton = page.getByTestId('button-category-installation');\r\n      await expect(installationButton).toBeVisible({ timeout: 5000 });\r\n      await installationButton.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Click back to All\r\n      await allButton.click();\r\n      await page.waitForTimeout(500);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\22-library-scenarios.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\n\r\n/**\r\n * Library  Scenarios (Installation Scenarios) Tab E2E Tests (10 tests)\r\n *\r\n * Covers:\r\n * - List / empty state\r\n * - New Scenario button\r\n * - Add Scenario form (title, description, type, room types, style tags, steps)\r\n * - Edit scenario\r\n * - Delete scenario with confirmation\r\n * - Scenario card details (type badge, room types, style tags, steps count)\r\n */\r\n\r\ntest.describe('Library  Scenarios Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    libraryPage = new LibraryPage(page);\r\n    await gotoWithAuth(page, '/library?tab=scenarios');\r\n    await libraryPage.waitForTabContent();\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // List View (tests 1-3)\r\n  // ----------------------------------------------------------------\r\n  test('1  Scenario list or empty state is visible', async ({ page }) => {\r\n    // Either scenario cards or \"No scenarios yet\" empty state\r\n    const scenarioCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n      has: page.locator('h3, [class*=\"CardTitle\"]'),\r\n    });\r\n    const emptyState = page.getByText(/No scenarios yet/i);\r\n    const loadingState = page.locator('[role=\"status\"][aria-busy=\"true\"]');\r\n\r\n    await expect(scenarioCards.first().or(emptyState).or(loadingState)).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2  New Scenario button is visible', async ({ page }) => {\r\n    const newButton = page.getByRole('button', { name: /New Scenario|Create First Scenario/i });\r\n    await expect(newButton).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('3  Scenario cards display type badge and description', async ({ page }) => {\r\n    const scenarioCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(scenarioCards.first()).toBeVisible({ timeout: 10000 });\r\n    const firstCard = scenarioCards.first();\r\n\r\n    // Type badge (Room Type, Application, Before/After) or Description text\r\n    const badge = firstCard.locator('[class*=\"badge\"], [class*=\"Badge\"]');\r\n    const description = firstCard.locator('p');\r\n\r\n    await expect(badge.first().or(description.first())).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Create Scenario Form (tests 4-7)\r\n  // ----------------------------------------------------------------\r\n  test('4  New Scenario button opens form dialog', async ({ page }) => {\r\n    const newButton = page.getByRole('button', { name: /New Scenario|Create First Scenario/i });\r\n    await newButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n    await expect(dialog.getByText(/Create Installation Scenario/i)).toBeVisible();\r\n  });\r\n\r\n  test('5  Form has title, description, scenario type, room types, style tags', async ({ page }) => {\r\n    const newButton = page.getByRole('button', { name: /New Scenario|Create First Scenario/i });\r\n    await newButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    // Title input\r\n    const titleInput = dialog.locator('input').first();\r\n    await expect(titleInput).toBeVisible();\r\n\r\n    // Description textarea\r\n    const descriptionTextarea = dialog.locator('textarea');\r\n    await expect(descriptionTextarea).toBeVisible();\r\n\r\n    // Scenario Type dropdown\r\n    const typeLabel = dialog.getByText(/Scenario Type/i);\r\n    await expect(typeLabel).toBeVisible();\r\n\r\n    // Room Types section with toggleable badges\r\n    const roomTypesLabel = dialog.getByText(/Room Types/i);\r\n    await expect(roomTypesLabel).toBeVisible();\r\n\r\n    // Style Tags section with toggleable badges\r\n    const styleTagsLabel = dialog.getByText(/Style Tags/i);\r\n    await expect(styleTagsLabel).toBeVisible();\r\n  });\r\n\r\n  test('6  Room type badges are toggleable', async ({ page }) => {\r\n    const newButton = page.getByRole('button', { name: /New Scenario|Create First Scenario/i });\r\n    await newButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    // Find a room type badge (e.g., \"living room\")\r\n    const livingRoomBadge = dialog\r\n      .locator('[class*=\"badge\"], [class*=\"Badge\"]')\r\n      .filter({ hasText: /living room/i })\r\n      .first();\r\n\r\n    await expect(livingRoomBadge).toBeVisible({ timeout: 5000 });\r\n    // Click to toggle on\r\n    await livingRoomBadge.click();\r\n    await page.waitForTimeout(200);\r\n\r\n    // Click again to toggle off\r\n    await livingRoomBadge.click();\r\n    await page.waitForTimeout(200);\r\n  });\r\n\r\n  test('7  Cancel button closes the form dialog', async ({ page }) => {\r\n    const newButton = page.getByRole('button', { name: /New Scenario|Create First Scenario/i });\r\n    await newButton.click();\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n\r\n    const cancelButton = dialog.getByRole('button', { name: /Cancel/i });\r\n    await cancelButton.click();\r\n\r\n    await expect(dialog).not.toBeVisible({ timeout: 3000 });\r\n  });\r\n\r\n  // ----------------------------------------------------------------\r\n  // Edit & Delete (tests 8-10)\r\n  // ----------------------------------------------------------------\r\n  test('8  Scenario card edit button opens form with prefilled data', async ({ page }) => {\r\n    const scenarioCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(scenarioCards.first()).toBeVisible({ timeout: 10000 });\r\n    // Hover to reveal edit button\r\n    await scenarioCards.first().hover();\r\n    await page.waitForTimeout(300);\r\n\r\n    // Click the edit (pencil) button\r\n    const editButton = scenarioCards\r\n      .first()\r\n      .locator('button')\r\n      .filter({\r\n        has: page.locator('svg'),\r\n      })\r\n      .first();\r\n\r\n    await expect(editButton).toBeVisible({ timeout: 5000 });\r\n    await editButton.click();\r\n    await page.waitForTimeout(500);\r\n\r\n    const dialog = page.locator('[role=\"dialog\"]');\r\n    await expect(dialog).toBeVisible({ timeout: 5000 });\r\n    // Dialog title should say \"Edit Scenario\"\r\n    await expect(dialog.getByText(/Edit Scenario/i)).toBeVisible();\r\n\r\n    // Title field should be pre-filled\r\n    const titleInput = dialog.locator('input').first();\r\n    const titleValue = await titleInput.inputValue();\r\n    expect(titleValue.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  test('9  Delete button opens confirmation dialog', async ({ page }) => {\r\n    const scenarioCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(scenarioCards.first()).toBeVisible({ timeout: 10000 });\r\n    await scenarioCards.first().hover();\r\n    await page.waitForTimeout(300);\r\n\r\n    // Delete button is the second button (trash icon)\r\n    const buttons = scenarioCards\r\n      .first()\r\n      .locator('button')\r\n      .filter({\r\n        has: page.locator('svg'),\r\n      });\r\n    const buttonCount = await buttons.count();\r\n    expect(buttonCount).toBeGreaterThanOrEqual(2);\r\n\r\n    // Second button is typically delete\r\n    await buttons.nth(1).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    // Confirmation dialog\r\n    const confirmDialog = page.locator('[role=\"dialog\"]').filter({\r\n      hasText: /Delete Scenario/i,\r\n    });\r\n    await expect(confirmDialog).toBeVisible({ timeout: 5000 });\r\n    await expect(confirmDialog.getByText(/cannot be undone/i)).toBeVisible();\r\n  });\r\n\r\n  test('10  Delete confirmation Cancel closes dialog without deleting', async ({ page }) => {\r\n    const scenarioCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(scenarioCards.first()).toBeVisible({ timeout: 10000 });\r\n    await scenarioCards.first().hover();\r\n    await page.waitForTimeout(300);\r\n\r\n    const buttons = scenarioCards\r\n      .first()\r\n      .locator('button')\r\n      .filter({\r\n        has: page.locator('svg'),\r\n      });\r\n    const buttonCount = await buttons.count();\r\n    expect(buttonCount).toBeGreaterThanOrEqual(2);\r\n\r\n    await buttons.nth(1).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    const confirmDialog = page.locator('[role=\"dialog\"]').filter({\r\n      hasText: /Delete Scenario/i,\r\n    });\r\n    await expect(confirmDialog).toBeVisible({ timeout: 5000 });\r\n\r\n    const cancelButton = confirmDialog.getByRole('button', { name: /Cancel/i });\r\n    await cancelButton.click();\r\n\r\n    await expect(confirmDialog).not.toBeVisible({ timeout: 3000 });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\23-library-patterns.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any' or '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,90],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\n\r\n/**\r\n * Library  Patterns (Learn from Winners) Tab E2E Tests (8 tests)\r\n *\r\n * Covers:\r\n * - Upload zone / adaptive upload component\r\n * - Pattern card grid\r\n * - Pattern card details (category badge, platform badge, confidence, usage count)\r\n * - Search / filters (category, platform)\r\n * - View/grid mode toggle\r\n * - Detail dialog\r\n */\r\n\r\ntest.describe('Library  Patterns Tab', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    libraryPage = new LibraryPage(page);\r\n    await gotoWithAuth(page, '/library?tab=patterns');\r\n    await libraryPage.waitForTabContent();\r\n  });\r\n\r\n  test('1  Upload zone is visible', async ({ page }) => {\r\n    // AdaptiveUploadZone renders upload area at top of Patterns tab\r\n    // Look for the upload button which is always present\r\n    const uploadButton = page.getByRole('button', { name: /Upload Your First Ad|Upload|Analyze/i });\r\n\r\n    await expect(uploadButton.first()).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  test('2  Pattern cards or empty state display after loading', async ({ page }) => {\r\n    // Wait for loading spinner to disappear\r\n    const spinner = page.locator('[class*=\"animate-spin\"]');\r\n    await expect(spinner).toBeHidden({ timeout: 15000 });\r\n\r\n    // Even with no patterns, the \"Learn from Winners\" heading should be visible\r\n    const heading = page.getByRole('heading', { name: /Learn from Winners/i });\r\n    const emptyText = page.getByText(/Extract success patterns/i);\r\n\r\n    await expect(heading.or(emptyText).first()).toBeVisible({ timeout: 10000 });\r\n  });\r\n\r\n  // Requires pattern cards to exist; production has empty state (no patterns uploaded yet)\r\n  test.skip('3  Pattern cards show category and platform badges', async ({ page }) => {\r\n    const patternCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(patternCards.first()).toBeVisible({ timeout: 10000 });\r\n    const firstCard = patternCards.first();\r\n\r\n    // Category badge (Product Showcase, Testimonial, etc.)\r\n    const badges = firstCard.locator('[class*=\"badge\"], [class*=\"Badge\"]');\r\n    const badgeCount = await badges.count();\r\n    expect(badgeCount).toBeGreaterThan(0);\r\n  });\r\n\r\n  // Requires pattern cards to exist; production has empty state (no patterns uploaded yet)\r\n  test.skip('4  Pattern cards show usage count and completeness indicator', async ({ page }) => {\r\n    const patternCards = page.locator('[class*=\"Card\"]').filter({\r\n      has: page.locator('[class*=\"CardTitle\"]'),\r\n    });\r\n\r\n    await expect(patternCards.first()).toBeVisible({ timeout: 10000 });\r\n    const firstCard = patternCards.first();\r\n\r\n    // Usage count text (e.g., \"3 uses\") or Pattern Completeness progress bar\r\n    const usageText = firstCard.getByText(/\\d+ uses?/i);\r\n    const progressBar = firstCard.locator('[role=\"progressbar\"], [class*=\"Progress\"]');\r\n\r\n    // At least one of these should exist\r\n    await expect(usageText.or(progressBar)).toBeVisible({ timeout: 5000 });\r\n  });\r\n\r\n  // Search input only appears when patterns exist; production has empty state\r\n  test.skip('5  Search input filters patterns', async ({ page }) => {\r\n    const searchInput = page.locator('input[placeholder*=\"Search patterns\"]');\r\n    await expect(searchInput).toBeVisible({ timeout: 10000 });\r\n\r\n    await searchInput.fill('zzz_nonexistent_xyz');\r\n    await page.waitForTimeout(600);\r\n\r\n    // Result count should update\r\n    const resultCount = page.getByText(/\\d+ patterns? found/i);\r\n    await expect(resultCount).toBeVisible({ timeout: 5000 });\r\n    const text = await resultCount.textContent();\r\n    expect(text).toContain('0 patterns');\r\n  });\r\n\r\n  // Filter dropdowns only appear when patterns exist; production has empty state\r\n  test.skip('6  Category filter dropdown works', async ({ page }) => {\r\n    // Category filter select\r\n    const categorySelect = page.locator('button[role=\"combobox\"]').filter({\r\n      hasText: /All Categories|Category/i,\r\n    });\r\n\r\n    await expect(categorySelect).toBeVisible({ timeout: 10000 });\r\n    await categorySelect.click();\r\n    await page.waitForTimeout(300);\r\n\r\n    const dropdown = page.locator('[role=\"listbox\"], [data-radix-select-content]');\r\n    await expect(dropdown).toBeVisible({ timeout: 3000 });\r\n\r\n    // Should have category options\r\n    const options = dropdown.locator('[role=\"option\"]');\r\n    const count = await options.count();\r\n    expect(count).toBeGreaterThan(0);\r\n\r\n    await page.keyboard.press('Escape');\r\n  });\r\n\r\n  // Filter dropdowns only appear when patterns exist; production has empty state\r\n  test.skip('7  Platform filter dropdown works', async ({ page }) => {\r\n    const platformSelect = page.locator('button[role=\"combobox\"]').filter({\r\n      hasText: /All Platforms|Platform/i,\r\n    });\r\n\r\n    await expect(platformSelect).toBeVisible({ timeout: 10000 });\r\n    await platformSelect.click();\r\n    await page.waitForTimeout(300);\r\n\r\n    const dropdown = page.locator('[role=\"listbox\"], [data-radix-select-content]');\r\n    await expect(dropdown).toBeVisible({ timeout: 3000 });\r\n\r\n    const options = dropdown.locator('[role=\"option\"]');\r\n    const count = await options.count();\r\n    expect(count).toBeGreaterThan(0);\r\n\r\n    await page.keyboard.press('Escape');\r\n  });\r\n\r\n  // View toggle only appears when patterns exist; production has empty state\r\n  test.skip('8  Grid/List view toggle buttons exist and switch layout', async ({ page }) => {\r\n    // The toggle is inside a bordered container with two buttons\r\n    const viewToggle = page.locator('.flex.items-center.border.rounded-lg');\r\n\r\n    await expect(viewToggle).toBeVisible({ timeout: 10000 });\r\n    const buttons = viewToggle.locator('button');\r\n    const buttonCount = await buttons.count();\r\n    expect(buttonCount).toBe(2); // Grid and List buttons\r\n\r\n    // Click List view\r\n    await buttons.nth(1).click();\r\n    await page.waitForTimeout(300);\r\n\r\n    // Click Grid view\r\n    await buttons.nth(0).click();\r\n    await page.waitForTimeout(300);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\24-settings-brand.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\25-settings-knowledge-base.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\26-settings-api-keys.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\27-settings-strategy.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\28-settings-usage.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\29-global-chat.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\30-navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\31-legacy-redirects.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\32-404-page.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\33-cross-feature-flows.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\34-mobile-responsive.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\35-error-handling.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\36-accessibility.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\37-api-smoke.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\38-production-health.spec.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":11,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":22,"suggestions":[{"fix":{"range":[2299,2354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":11,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":22,"suggestions":[{"fix":{"range":[2366,2394],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":168,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":168,"endColumn":16,"suggestions":[{"fix":{"range":[6405,6463],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":169,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":169,"endColumn":16,"suggestions":[{"fix":{"range":[6469,6512],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":170,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":170,"endColumn":16,"suggestions":[{"fix":{"range":[6518,6574],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":188,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":188,"endColumn":18,"suggestions":[{"fix":{"range":[7202,7371],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":193,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":193,"endColumn":16,"suggestions":[{"fix":{"range":[7386,7442],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":194,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":194,"endColumn":16,"suggestions":[{"fix":{"range":[7448,7590],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":197,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":197,"endColumn":16,"suggestions":[{"fix":{"range":[7596,7654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\accessibility.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\auth.setup.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":29,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":29,"endColumn":14,"suggestions":[{"fix":{"range":[1089,1142],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":34,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":34,"endColumn":14,"suggestions":[{"fix":{"range":[1281,1351],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":44,"endColumn":18,"suggestions":[{"fix":{"range":[1645,1699],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":49,"endColumn":18,"suggestions":[{"fix":{"range":[1893,1978],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":53,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":53,"endColumn":16,"suggestions":[{"fix":{"range":[2045,2107],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\brand-injection.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\carousel-builder-flow.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":357,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12600,12603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12600,12603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\nimport { CarouselBuilderPage } from './pages/carousel-builder.page';\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\n\n/**\n * Carousel Builder Workflow E2E Tests\n *\n * Tests the complete carousel creation flow:\n * 1. Navigate to Carousel Builder\n * 2. Create new carousel (auto-generated outline)\n * 3. Add/edit slide content\n * 4. Reorder slides\n * 5. Preview carousel\n * 6. Export carousel (ZIP)\n */\n\ntest.describe('Carousel Builder Workflow', () => {\n  let _carouselPage: CarouselBuilderPage;\n  let studioPage: StudioWorkflowPage;\n\n  test.beforeEach(async ({ page }) => {\n    _carouselPage = new CarouselBuilderPage(page);\n    studioPage = new StudioWorkflowPage(page);\n  });\n\n  test.describe('Accessing Carousel Builder', () => {\n    test('can navigate to Studio with Content Planner template', async ({ page }) => {\n      // Navigate to Studio with a template that supports carousel\n      await page.goto('/?cpTemplateId=technical_guides');\n      await page.waitForLoadState('networkidle');\n\n      // Verify Content Planner guidance appears\n      const guidanceVisible = await page.locator('text=Content Planner Template').isVisible().catch(() => false);\n      expect(guidanceVisible || await studioPage.isVisible()).toBe(true);\n    });\n\n    test('carousel endpoint is accessible', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          topic: 'Test carousel topic',\n          slideCount: 7,\n          platform: 'linkedin',\n        },\n      });\n\n      // Should not crash (may fail if AI not configured, but endpoint exists)\n      expect(response.status()).toBeLessThan(500);\n    });\n  });\n\n  test.describe('Carousel Outline Generation', () => {\n    test('carousel outline API returns expected structure', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          topic: 'How to properly measure rebar spacing',\n          slideCount: 7,\n          platform: 'linkedin',\n        },\n      });\n\n      // Skip if Gemini not configured\n      if (response.status() === 500) {\n        const data = await response.json();\n        test.skip(data.error?.includes('API') || data.error?.includes('Gemini'), 'AI service not available');\n      }\n\n      if (response.ok()) {\n        const data = await response.json();\n        expect(data.success).toBe(true);\n        expect(data).toHaveProperty('outline');\n        expect(data.outline).toHaveProperty('title');\n        expect(data.outline).toHaveProperty('slides');\n        expect(Array.isArray(data.outline.slides)).toBe(true);\n        expect(data.outline.slides.length).toBeGreaterThan(0);\n      }\n    });\n\n    test('outline slides have required fields', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          topic: 'Construction safety tips',\n          slideCount: 5,\n          platform: 'instagram',\n        },\n      });\n\n      if (response.status() === 500) {\n        test.skip(true, 'AI service not available');\n      }\n\n      if (response.ok()) {\n        const data = await response.json();\n        const slide = data.outline.slides[0];\n\n        expect(slide).toHaveProperty('slideNumber');\n        expect(slide).toHaveProperty('purpose');\n        expect(slide).toHaveProperty('headline');\n        expect(slide).toHaveProperty('body');\n        expect(slide).toHaveProperty('imagePrompt');\n      }\n    });\n\n    test('outline includes caption and hashtags', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'educational',\n          topic: 'Steel grades explained',\n          slideCount: 7,\n          platform: 'linkedin',\n        },\n      });\n\n      if (response.status() === 500) {\n        test.skip(true, 'AI service not available');\n      }\n\n      if (response.ok()) {\n        const data = await response.json();\n        expect(data.outline).toHaveProperty('captionCopy');\n        expect(data.outline).toHaveProperty('hashtags');\n        expect(Array.isArray(data.outline.hashtags)).toBe(true);\n      }\n    });\n  });\n\n  test.describe('Carousel Builder UI', () => {\n    test.beforeEach(async ({ page }) => {\n      // Mock carousel outline response for UI tests\n      await page.route('**/api/content-planner/carousel-outline', (route) => {\n        route.fulfill({\n          status: 200,\n          contentType: 'application/json',\n          body: JSON.stringify({\n            success: true,\n            outline: {\n              title: 'Test Carousel',\n              description: 'E2E test carousel outline',\n              slideCount: 5,\n              slides: [\n                {\n                  slideNumber: 1,\n                  purpose: 'hook',\n                  headline: 'Attention-Grabbing Hook',\n                  body: 'This is the hook slide body text',\n                  imagePrompt: 'Bold professional image for hook slide',\n                },\n                {\n                  slideNumber: 2,\n                  purpose: 'problem',\n                  headline: 'The Problem',\n                  body: 'Description of the problem',\n                  imagePrompt: 'Image showing the problem',\n                },\n                {\n                  slideNumber: 3,\n                  purpose: 'solution',\n                  headline: 'The Solution',\n                  body: 'How to solve it',\n                  imagePrompt: 'Image showing the solution',\n                },\n                {\n                  slideNumber: 4,\n                  purpose: 'proof',\n                  headline: 'Proof It Works',\n                  body: 'Evidence and testimonials',\n                  imagePrompt: 'Social proof image',\n                },\n                {\n                  slideNumber: 5,\n                  purpose: 'cta',\n                  headline: 'Take Action Now',\n                  body: 'Call to action text',\n                  imagePrompt: 'Engaging CTA image',\n                },\n              ],\n              captionCopy: 'This is the post caption for the carousel.',\n              hashtags: ['construction', 'steel', 'building', 'tips'],\n            },\n            metadata: {\n              platform: 'linkedin',\n              templateId: 'technical_guides',\n            },\n          }),\n        });\n      });\n    });\n\n    test('carousel builder displays slides correctly', async ({ page }) => {\n      // This test requires the CarouselBuilder component to be visible\n      // Navigate to a page that shows the carousel builder\n      await studioPage.gotoWithParams({ cpTemplateId: 'technical_guides' });\n      await page.waitForLoadState('networkidle');\n\n      // Look for carousel-related UI elements\n      const carouselElements = page.locator('text=Carousel Builder, text=carousel, text=slides');\n      const hasCarousel = await carouselElements.count() > 0;\n\n      // If carousel builder isn't directly visible, this is expected\n      // The builder opens from specific actions\n      expect(hasCarousel).toBeDefined();\n    });\n\n    test('Content Planner template info displays', async ({ page }) => {\n      await page.goto('/?cpTemplateId=technical_guides');\n      await page.waitForLoadState('networkidle');\n\n      // Should show template guidance\n      const templateInfo = page.locator('text=Content Planner Template');\n      const isVisible = await templateInfo.isVisible().catch(() => false);\n\n      // Template guidance should be visible\n      expect(isVisible).toBeDefined();\n    });\n  });\n\n  test.describe('Slide Editing', () => {\n    test('slide content can be edited via API', async ({ request }) => {\n      // This tests that the transform endpoint accepts carousel slide data\n      const response = await request.post('/api/transform', {\n        data: {\n          prompt: 'Professional carousel slide image for hook about steel quality',\n          resolution: '2K',\n          aspectRatio: '1080x1350', // Portrait for carousel\n          mode: 'standard',\n        },\n      });\n\n      // Endpoint should exist (may fail if AI not configured)\n      expect(response.status()).toBeLessThan(500);\n    });\n  });\n\n  test.describe('Carousel Preview', () => {\n    test('embla carousel component handles slides', async ({ page }) => {\n      // Navigate to a page that might show carousel preview\n      await page.goto('/content-planner');\n      await page.waitForLoadState('networkidle');\n\n      // Look for carousel-related UI components\n      const carouselContent = page.locator('[class*=\"CarouselContent\"], [class*=\"embla\"]');\n      const hasCarousel = await carouselContent.count() > 0;\n\n      // Carousel components should be available in the codebase\n      expect(hasCarousel).toBeDefined();\n    });\n  });\n\n  test.describe('Export Functionality', () => {\n    test('ZIP download endpoint structure', async ({ request }) => {\n      // Test that the app can handle ZIP downloads\n      // This is a structural test - actual ZIP creation requires generated images\n\n      // The endpoint for downloading is typically triggered from the UI\n      // We verify the supporting infrastructure exists\n      const response = await request.get('/api/generations?limit=1');\n      expect(response.ok()).toBeTruthy();\n    });\n  });\n\n  test.describe('Caption and Hashtags', () => {\n    test('caption copy endpoint returns structured data', async ({ request }) => {\n      const response = await request.post('/api/ad-copy/generate', {\n        data: {\n          platform: 'linkedin',\n          tone: 'professional',\n          framework: 'auto',\n          productName: 'Test Product',\n          productDescription: 'Test description for carousel',\n        },\n      });\n\n      // Endpoint should exist and return structured copy\n      if (response.ok()) {\n        const data = await response.json();\n        expect(data).toBeDefined();\n      }\n    });\n  });\n});\n\ntest.describe('Carousel Builder API Validation', () => {\n  test('POST /api/content-planner/carousel-outline validates required fields', async ({ request }) => {\n    // Missing templateId\n    const response1 = await request.post('/api/content-planner/carousel-outline', {\n      data: {\n        topic: 'Test topic',\n        platform: 'linkedin',\n      },\n    });\n    expect(response1.status()).toBe(400);\n\n    // Missing topic\n    const response2 = await request.post('/api/content-planner/carousel-outline', {\n      data: {\n        templateId: 'technical_guides',\n        platform: 'linkedin',\n      },\n    });\n    expect(response2.status()).toBe(400);\n  });\n\n  test('carousel outline accepts valid platforms', async ({ request }) => {\n    const validPlatforms = ['instagram', 'linkedin', 'facebook', 'twitter', 'tiktok'];\n\n    for (const platform of validPlatforms) {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          topic: 'Test topic',\n          slideCount: 5,\n          platform,\n        },\n      });\n\n      // Should not return 400 (validation error)\n      expect(response.status()).not.toBe(400);\n    }\n  });\n\n  test('carousel outline respects slide count', async ({ request }) => {\n    const response = await request.post('/api/content-planner/carousel-outline', {\n      data: {\n        templateId: 'technical_guides',\n        topic: 'Slide count test',\n        slideCount: 5,\n        platform: 'linkedin',\n      },\n    });\n\n    if (response.status() === 500) {\n      test.skip(true, 'AI service not available');\n    }\n\n    if (response.ok()) {\n      const data = await response.json();\n      // May have exactly the requested count or a reasonable variation\n      expect(data.outline.slides.length).toBeGreaterThanOrEqual(3);\n      expect(data.outline.slides.length).toBeLessThanOrEqual(10);\n    }\n  });\n});\n\ntest.describe('Carousel Content Templates', () => {\n  test('Content Planner templates API returns carousel-compatible templates', async ({ request }) => {\n    const response = await request.get('/api/content-planner/templates');\n    expect(response.ok()).toBeTruthy();\n\n    const data = await response.json();\n    expect(data).toHaveProperty('templates');\n    expect(Array.isArray(data.templates)).toBe(true);\n\n    // Find templates that work well with carousels\n    const carouselFriendlyTemplates = data.templates.filter(\n      (t: any) =>\n        t.id.includes('guide') ||\n        t.id.includes('tips') ||\n        t.id.includes('educational') ||\n        t.category === 'educational'\n    );\n\n    // Should have at least some educational templates\n    expect(carouselFriendlyTemplates.length).toBeGreaterThanOrEqual(0);\n  });\n\n  test('templates have post structure for carousel adaptation', async ({ request }) => {\n    const response = await request.get('/api/content-planner/templates');\n    const data = await response.json();\n\n    const template = data.templates[0];\n    expect(template).toHaveProperty('postStructure');\n    expect(template).toHaveProperty('hookFormulas');\n  });\n});\n\ntest.describe('Carousel Builder Integration', () => {\n  test('studio accepts carousel-generated images', async ({ page }) => {\n    // Navigate to studio and verify it can display carousel content\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // The studio should be functional\n    const studioVisible = await page.locator('h1').isVisible();\n    expect(studioVisible).toBe(true);\n  });\n\n  test('history can store carousel generations', async ({ request }) => {\n    const response = await request.get('/api/generations?limit=10');\n    expect(response.ok()).toBeTruthy();\n\n    const data = await response.json();\n    expect(Array.isArray(data)).toBe(true);\n\n    // Generations should be storeable (carousel or otherwise)\n  });\n});\n\ntest.describe('Carousel Responsive Design', () => {\n  test('Content Planner page renders on mobile', async ({ page }) => {\n    await page.setViewportSize({ width: 375, height: 667 });\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    await expect(page.locator('h1')).toContainText('Content Planner');\n  });\n\n  test('Content Planner page renders on tablet', async ({ page }) => {\n    await page.setViewportSize({ width: 768, height: 1024 });\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    await expect(page.locator('h1')).toContainText('Content Planner');\n  });\n});\n\ntest.describe('Carousel Error Handling', () => {\n  test('handles AI service unavailable gracefully', async ({ page }) => {\n    // Mock AI service failure\n    await page.route('**/api/content-planner/carousel-outline', (route) => {\n      route.fulfill({\n        status: 500,\n        contentType: 'application/json',\n        body: JSON.stringify({\n          success: false,\n          error: 'AI service temporarily unavailable',\n        }),\n      });\n    });\n\n    // Navigate and verify page handles error\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    // Page should still be functional\n    await expect(page.locator('h1')).toContainText('Content Planner');\n  });\n\n  test('handles network errors gracefully', async ({ page }) => {\n    await page.route('**/api/content-planner/**', (route) => {\n      route.abort('connectionrefused');\n    });\n\n    await page.goto('/content-planner');\n\n    // Page should handle network errors without crashing\n    // May show error state but shouldn't throw\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\content-planner.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":913,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":913,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32297,32300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32297,32300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\n\n/**\n * Content Planner E2E Tests\n *\n * Tests cover:\n * 1. API endpoint functionality (/api/content-planner/*)\n * 2. UI page rendering and interactions\n * 3. Template guidance panel\n * 4. Generate complete post functionality\n * 5. Console error monitoring\n */\n\n// =============================================================================\n// API TESTS\n// =============================================================================\n\ntest.describe('Content Planner API', () => {\n  test.describe('GET /api/content-planner/templates', () => {\n    test('returns templates and categories', async ({ request }) => {\n      const response = await request.get('/api/content-planner/templates');\n      expect(response.ok()).toBeTruthy();\n\n      const data = await response.json();\n      expect(data).toHaveProperty('categories');\n      expect(data).toHaveProperty('templates');\n      expect(Array.isArray(data.categories)).toBeTruthy();\n      expect(Array.isArray(data.templates)).toBeTruthy();\n      expect(data.categories.length).toBeGreaterThan(0);\n      expect(data.templates.length).toBeGreaterThan(0);\n    });\n\n    test('templates have required fields', async ({ request }) => {\n      const response = await request.get('/api/content-planner/templates');\n      const data = await response.json();\n\n      // Check first template has required fields\n      const template = data.templates[0];\n      expect(template).toHaveProperty('id');\n      expect(template).toHaveProperty('category');\n      expect(template).toHaveProperty('title');\n      expect(template).toHaveProperty('description');\n      expect(template).toHaveProperty('hookFormulas');\n      expect(template).toHaveProperty('postStructure');\n      expect(template).toHaveProperty('bestPlatforms');\n      expect(template).toHaveProperty('productRequirement');\n    });\n\n    test('categories have correct structure', async ({ request }) => {\n      const response = await request.get('/api/content-planner/templates');\n      const data = await response.json();\n\n      const category = data.categories[0];\n      expect(category).toHaveProperty('id');\n      expect(category).toHaveProperty('name');\n      expect(category).toHaveProperty('percentage');\n      expect(category).toHaveProperty('weeklyTarget');\n      expect(category).toHaveProperty('templates');\n      expect(Array.isArray(category.templates)).toBeTruthy();\n    });\n  });\n\n  test.describe('GET /api/content-planner/balance', () => {\n    test('returns weekly balance data for authenticated user', async ({ request }) => {\n      const response = await request.get('/api/content-planner/balance');\n      expect(response.ok()).toBeTruthy();\n\n      const data = await response.json();\n      expect(data).toHaveProperty('balance');\n      expect(data).toHaveProperty('suggested');\n      expect(data).toHaveProperty('totalPosts');\n      expect(typeof data.totalPosts).toBe('number');\n    });\n\n    test('balance contains all category IDs', async ({ request }) => {\n      const response = await request.get('/api/content-planner/balance');\n      const data = await response.json();\n\n      const expectedCategories = [\n        'product_showcase',\n        'educational',\n        'industry_insights',\n        'customer_success',\n        'company_updates',\n        'engagement',\n      ];\n\n      for (const categoryId of expectedCategories) {\n        expect(data.balance).toHaveProperty(categoryId);\n        expect(data.balance[categoryId]).toHaveProperty('current');\n        expect(data.balance[categoryId]).toHaveProperty('target');\n        expect(data.balance[categoryId]).toHaveProperty('percentage');\n      }\n    });\n  });\n\n  test.describe('GET /api/content-planner/suggestion', () => {\n    test('returns suggestion based on balance', async ({ request }) => {\n      const response = await request.get('/api/content-planner/suggestion');\n      expect(response.ok()).toBeTruthy();\n\n      const data = await response.json();\n      expect(data).toHaveProperty('category');\n      expect(data).toHaveProperty('reason');\n      expect(data.category).toHaveProperty('id');\n      expect(data.category).toHaveProperty('name');\n      expect(data.category).toHaveProperty('weeklyTarget');\n    });\n  });\n\n  test.describe('POST /api/content-planner/generate-post', () => {\n    test('returns success with valid template that requires no products', async ({ request }) => {\n      // questions_polls template has productRequirement: 'none'\n      const response = await request.post('/api/content-planner/generate-post', {\n        data: {\n          templateId: 'questions_polls',\n          productIds: [],\n          topic: 'What steel grade do you prefer for residential projects?',\n          platform: 'linkedin',\n        },\n      });\n\n      expect(response.ok()).toBeTruthy();\n      const data = await response.json();\n      expect(data.success).toBe(true);\n      expect(data).toHaveProperty('template');\n      expect(data.template.id).toBe('questions_polls');\n      // Should have copy since this template doesn't need images\n      if (data.copy) {\n        expect(data.copy).toHaveProperty('caption');\n      }\n    });\n\n    test('fails when template requires products but none provided', async ({ request }) => {\n      // product_comparisons requires minProducts: 2\n      const response = await request.post('/api/content-planner/generate-post', {\n        data: {\n          templateId: 'product_comparisons',\n          productIds: [],\n          platform: 'linkedin',\n        },\n      });\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.copyError).toContain('requires');\n    });\n\n    test('fails with invalid templateId', async ({ request }) => {\n      const response = await request.post('/api/content-planner/generate-post', {\n        data: {\n          templateId: 'invalid_template_xyz_12345',\n          productIds: [],\n          platform: 'linkedin',\n        },\n      });\n\n      const data = await response.json();\n      expect(data.success).toBe(false);\n      expect(data.copyError).toContain('not found');\n    });\n\n    test('validates platform parameter', async ({ request }) => {\n      const response = await request.post('/api/content-planner/generate-post', {\n        data: {\n          templateId: 'questions_polls',\n          productIds: [],\n          platform: 'invalid_platform',\n        },\n      });\n\n      expect(response.status()).toBe(400);\n      const data = await response.json();\n      expect(data.error).toContain('Invalid platform');\n    });\n\n    test('accepts all valid platforms', async ({ request }) => {\n      const validPlatforms = ['instagram', 'linkedin', 'facebook', 'twitter', 'tiktok'];\n\n      for (const platform of validPlatforms) {\n        const response = await request.post('/api/content-planner/generate-post', {\n          data: {\n            templateId: 'questions_polls',\n            productIds: [],\n            topic: 'Test topic',\n            platform,\n          },\n        });\n\n        // Should not return 400 (validation error)\n        expect(response.status()).not.toBe(400);\n      }\n    });\n\n    test('templateId is required', async ({ request }) => {\n      const response = await request.post('/api/content-planner/generate-post', {\n        data: {\n          productIds: [],\n          platform: 'linkedin',\n        },\n      });\n\n      expect(response.status()).toBe(400);\n      const data = await response.json();\n      expect(data.error).toContain('templateId');\n    });\n  });\n\n  test.describe('POST /api/content-planner/posts (Mark as Posted)', () => {\n    test('records a post with valid category', async ({ request }) => {\n      const response = await request.post('/api/content-planner/posts', {\n        data: {\n          category: 'engagement',\n          subType: 'questions_polls',\n          platform: 'linkedin',\n          notes: 'E2E test post',\n        },\n      });\n\n      expect(response.ok()).toBeTruthy();\n      const data = await response.json();\n      expect(data).toHaveProperty('message');\n      expect(data.message).toBe('Post recorded');\n      expect(data).toHaveProperty('post');\n    });\n\n    test('fails with invalid category', async ({ request }) => {\n      const response = await request.post('/api/content-planner/posts', {\n        data: {\n          category: 'invalid_category_xyz',\n          subType: 'general',\n        },\n      });\n\n      expect(response.status()).toBe(400);\n      const data = await response.json();\n      expect(data.error).toContain('Invalid category');\n    });\n  });\n\n  test.describe('POST /api/content-planner/carousel-outline', () => {\n    test('generates carousel outline with valid inputs', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          topic: 'How to read a mill test report',\n          slideCount: 7,\n          platform: 'linkedin',\n        },\n      });\n\n      // May fail if Gemini not configured, but should not be 400\n      if (response.ok()) {\n        const data = await response.json();\n        expect(data.success).toBe(true);\n        expect(data).toHaveProperty('outline');\n        expect(data).toHaveProperty('metadata');\n      }\n    });\n\n    test('requires templateId', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          topic: 'Test topic',\n          platform: 'linkedin',\n        },\n      });\n\n      expect(response.status()).toBe(400);\n    });\n\n    test('requires topic', async ({ request }) => {\n      const response = await request.post('/api/content-planner/carousel-outline', {\n        data: {\n          templateId: 'technical_guides',\n          platform: 'linkedin',\n        },\n      });\n\n      expect(response.status()).toBe(400);\n    });\n  });\n});\n\n// =============================================================================\n// UI TESTS\n// =============================================================================\n\ntest.describe('Content Planner UI', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n  });\n\n  test('Content Planner page loads successfully', async ({ page }) => {\n    // Check page title\n    await expect(page.locator('h1')).toContainText('Content Planner');\n\n    // Check for strategic guide description\n    await expect(page.locator('text=Strategic guide')).toBeVisible();\n  });\n\n  test('displays This Week\\'s Balance card', async ({ page }) => {\n    await expect(page.locator('text=This Week\\'s Balance')).toBeVisible();\n    await expect(page.locator('text=Track your posting distribution')).toBeVisible();\n  });\n\n  test('displays Suggested Next Post card', async ({ page }) => {\n    await expect(page.locator('text=Suggested Next Post')).toBeVisible();\n    await expect(page.locator('text=Based on your current balance')).toBeVisible();\n  });\n\n  test('displays Content Categories section', async ({ page }) => {\n    await expect(page.locator('text=Content Categories')).toBeVisible();\n  });\n\n  test('all 6 category names are displayed', async ({ page }) => {\n    const categoryNames = [\n      'Product Showcases',\n      'Educational Content',\n      'Industry Insights',\n      'Customer Success',\n      'Company Updates',\n      'Engagement Content',\n    ];\n\n    for (const categoryName of categoryNames) {\n      await expect(page.locator(`text=${categoryName}`).first()).toBeVisible();\n    }\n  });\n\n  test('category cards show template count badges', async ({ page }) => {\n    // Each category should show \"X templates\" badge\n    const templateBadges = page.locator('text=/\\\\d+ templates/');\n    await expect(templateBadges.first()).toBeVisible();\n    expect(await templateBadges.count()).toBeGreaterThanOrEqual(6);\n  });\n\n  test('expanding a category shows its templates', async ({ page }) => {\n    // Click on first category header to expand\n    const firstCategoryHeader = page.locator('[class*=\"CardHeader\"]').first();\n    await firstCategoryHeader.click();\n\n    // Wait for expansion\n    await page.waitForTimeout(500);\n\n    // Should show Best Practices section\n    await expect(page.locator('text=Best Practices').first()).toBeVisible();\n  });\n\n  test('clicking a template opens detail modal', async ({ page }) => {\n    // First expand a category\n    const productShowcaseHeader = page.locator('text=Product Showcases').first();\n    await productShowcaseHeader.click();\n    await page.waitForTimeout(500);\n\n    // Find and click a template card (look for specific template title)\n    const templateCard = page.locator('text=Product Specifications').first();\n    if (await templateCard.isVisible()) {\n      await templateCard.click();\n\n      // Modal should appear with Hook Formulas\n      await expect(page.locator('text=Hook Formulas That Work')).toBeVisible({ timeout: 5000 });\n\n      // Modal should have Post Structure section\n      await expect(page.locator('text=Post Structure Template')).toBeVisible();\n\n      // Modal should have What to Avoid section\n      await expect(page.locator('text=What to Avoid')).toBeVisible();\n    }\n  });\n\n  test('template modal can be closed', async ({ page }) => {\n    // Expand category and open template\n    await page.locator('text=Engagement Content').first().click();\n    await page.waitForTimeout(500);\n\n    const templateCard = page.locator('text=Questions & Polls').first();\n    if (await templateCard.isVisible()) {\n      await templateCard.click();\n      await expect(page.locator('text=Hook Formulas That Work')).toBeVisible({ timeout: 5000 });\n\n      // Close button (X) in dialog\n      const closeButton = page.locator('[role=\"dialog\"] button').first();\n      await closeButton.click();\n\n      // Modal should close\n      await expect(page.locator('text=Hook Formulas That Work')).not.toBeVisible({ timeout: 3000 });\n    }\n  });\n\n  test('View Guide button in suggestion card works', async ({ page }) => {\n    // Wait for suggestion to load\n    await page.waitForTimeout(1500);\n\n    const viewGuideButton = page.locator('button', { hasText: 'View Guide' });\n    if (await viewGuideButton.isVisible()) {\n      await viewGuideButton.click();\n\n      // Should open template modal\n      await expect(page.locator('text=Hook Formulas That Work')).toBeVisible({ timeout: 5000 });\n    }\n  });\n\n  test('Mark as Posted button opens dialog', async ({ page }) => {\n    // Wait for suggestion to load\n    await page.waitForTimeout(1500);\n\n    const markAsPostedButton = page.locator('button', { hasText: 'Mark as Posted' });\n    if (await markAsPostedButton.isVisible()) {\n      await markAsPostedButton.click();\n\n      // Dialog should appear\n      await expect(page.locator('text=Mark Post as Complete')).toBeVisible({ timeout: 5000 });\n\n      // Should have platform selection\n      await expect(page.locator('text=Platform')).toBeVisible();\n    }\n  });\n\n  test('balance progress bars are visible for each category', async ({ page }) => {\n    // Each category in balance card should have a progress bar\n    const progressBars = page.locator('[role=\"progressbar\"]');\n    // We have 6 categories\n    expect(await progressBars.count()).toBeGreaterThanOrEqual(6);\n  });\n});\n\n// =============================================================================\n// CONTENT PLANNER GUIDANCE COMPONENT TESTS\n// =============================================================================\n\ntest.describe('Content Planner Guidance Component', () => {\n  test('guidance panel appears when navigating from Content Planner to Studio', async ({ page }) => {\n    // Navigate to studio with cpTemplateId query param\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Should see Content Planner Template banner\n    await expect(page.locator('text=Content Planner Template')).toBeVisible({ timeout: 10000 });\n  });\n\n  test('guidance panel shows template title and description', async ({ page }) => {\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Should show the template title\n    await expect(page.locator('text=Questions & Polls')).toBeVisible({ timeout: 10000 });\n\n    // Should show category\n    await expect(page.locator('text=Engagement').first()).toBeVisible();\n  });\n\n  test('guidance panel can be dismissed', async ({ page }) => {\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Wait for guidance panel\n    await expect(page.locator('text=Content Planner Template')).toBeVisible({ timeout: 10000 });\n\n    // Find and click dismiss button (X)\n    const dismissButton = page.locator('button').filter({ has: page.locator('svg.lucide-x') }).first();\n    if (await dismissButton.isVisible()) {\n      await dismissButton.click();\n\n      // Guidance should disappear\n      await expect(page.locator('text=Content Planner Template')).not.toBeVisible({ timeout: 3000 });\n    }\n  });\n\n  test('guidance panel shows hook formulas section', async ({ page }) => {\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Wait for panel\n    await expect(page.locator('text=Content Planner Template')).toBeVisible({ timeout: 10000 });\n\n    // Should have Show Details toggle or Hook Formulas visible\n    const hookFormulasText = page.locator('text=Hook Formulas');\n    const showDetailsButton = page.locator('button', { hasText: 'Show Hook Formulas' });\n\n    if (await showDetailsButton.isVisible()) {\n      await showDetailsButton.click();\n    }\n\n    await expect(hookFormulasText).toBeVisible();\n  });\n\n  test('Generate Complete Post button exists in guidance panel', async ({ page }) => {\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Wait for guidance panel\n    await expect(page.locator('text=Content Planner Template')).toBeVisible({ timeout: 10000 });\n\n    // Should have Generate Complete Post button\n    await expect(page.locator('button', { hasText: 'Generate Complete Post' })).toBeVisible();\n  });\n\n  test('Generate Complete Post shows loading state', async ({ page }) => {\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n\n    // Wait for guidance panel\n    await expect(page.locator('text=Content Planner Template')).toBeVisible({ timeout: 10000 });\n\n    // Click generate button\n    const generateButton = page.locator('button', { hasText: 'Generate Complete Post' });\n    await generateButton.click();\n\n    // Should show loading state\n    await expect(page.locator('text=Generating Complete Post')).toBeVisible({ timeout: 5000 });\n  });\n});\n\n// =============================================================================\n// CONSOLE ERROR TESTS\n// =============================================================================\n\ntest.describe('Content Planner Console Errors', () => {\n  test('Content Planner page loads without console errors', async ({ page }) => {\n    const errors: string[] = [];\n\n    page.on('console', (msg) => {\n      if (msg.type() === 'error') {\n        errors.push(msg.text());\n      }\n    });\n\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n    await page.waitForTimeout(2000);\n\n    // Filter out known non-critical errors\n    const criticalErrors = errors.filter(\n      (err) =>\n        !err.includes('favicon') &&\n        !err.includes('404') &&\n        !err.includes('401') &&\n        !err.includes('net::ERR') &&\n        !err.includes('Failed to load resource')\n    );\n\n    expect(criticalErrors).toHaveLength(0);\n  });\n\n  test('Content Planner guidance loads without console errors', async ({ page }) => {\n    const errors: string[] = [];\n\n    page.on('console', (msg) => {\n      if (msg.type() === 'error') {\n        errors.push(msg.text());\n      }\n    });\n\n    await page.goto('/?cpTemplateId=questions_polls');\n    await page.waitForLoadState('networkidle');\n    await page.waitForTimeout(2000);\n\n    // Filter out known non-critical errors\n    const criticalErrors = errors.filter(\n      (err) =>\n        !err.includes('favicon') &&\n        !err.includes('404') &&\n        !err.includes('401') &&\n        !err.includes('net::ERR') &&\n        !err.includes('Failed to load resource')\n    );\n\n    expect(criticalErrors).toHaveLength(0);\n  });\n\n  test('No JavaScript errors during category expansion', async ({ page }) => {\n    const errors: string[] = [];\n\n    page.on('console', (msg) => {\n      if (msg.type() === 'error') {\n        errors.push(msg.text());\n      }\n    });\n\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    // Expand all categories\n    const categoryHeaders = page.locator('[class*=\"CardHeader\"]');\n    const count = await categoryHeaders.count();\n\n    for (let i = 0; i < Math.min(count, 6); i++) {\n      await categoryHeaders.nth(i).click();\n      await page.waitForTimeout(300);\n    }\n\n    await page.waitForTimeout(1000);\n\n    // Filter out known non-critical errors\n    const criticalErrors = errors.filter(\n      (err) =>\n        !err.includes('favicon') &&\n        !err.includes('404') &&\n        !err.includes('401') &&\n        !err.includes('net::ERR') &&\n        !err.includes('Failed to load resource')\n    );\n\n    expect(criticalErrors).toHaveLength(0);\n  });\n});\n\n// =============================================================================\n// NAVIGATION TESTS\n// =============================================================================\n\ntest.describe('Content Planner Navigation', () => {\n  test('can navigate to Content Planner from header', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Look for navigation link to Content Planner\n    const contentPlannerLink = page.locator('a[href=\"/content-planner\"]');\n    if (await contentPlannerLink.isVisible()) {\n      await contentPlannerLink.click();\n      await expect(page).toHaveURL('/content-planner');\n      await expect(page.locator('h1')).toContainText('Content Planner');\n    }\n  });\n\n  test('Create in Studio link navigates correctly', async ({ page }) => {\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    // Expand a category and open a template\n    await page.locator('text=Engagement Content').first().click();\n    await page.waitForTimeout(500);\n\n    const templateCard = page.locator('text=Questions & Polls').first();\n    if (await templateCard.isVisible()) {\n      await templateCard.click();\n      await expect(page.locator('text=Hook Formulas That Work')).toBeVisible({ timeout: 5000 });\n\n      // Click Create in Studio\n      const createInStudioLink = page.locator('a', { hasText: 'Create in Studio' });\n      if (await createInStudioLink.isVisible()) {\n        await createInStudioLink.click();\n\n        // Should navigate to Studio with template ID\n        await expect(page).toHaveURL(/cpTemplateId=questions_polls/);\n      }\n    }\n  });\n});\n\n// =============================================================================\n// RESPONSIVE TESTS\n// =============================================================================\n\ntest.describe('Content Planner Responsive', () => {\n  test('renders correctly on mobile viewport', async ({ page }) => {\n    await page.setViewportSize({ width: 375, height: 667 });\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    // Page should still show main elements\n    await expect(page.locator('h1')).toContainText('Content Planner');\n    await expect(page.locator('text=This Week\\'s Balance')).toBeVisible();\n    await expect(page.locator('text=Suggested Next Post')).toBeVisible();\n  });\n\n  test('renders correctly on tablet viewport', async ({ page }) => {\n    await page.setViewportSize({ width: 768, height: 1024 });\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n\n    // Page should show all main elements\n    await expect(page.locator('h1')).toContainText('Content Planner');\n    await expect(page.locator('text=Content Categories')).toBeVisible();\n  });\n});\n\n// =============================================================================\n// RECENT POSTS SECTION TESTS\n// =============================================================================\n\ntest.describe('Recent Posts Section', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/content-planner');\n    await page.waitForLoadState('networkidle');\n  });\n\n  test('displays Recent Posts section when posts exist', async ({ page, request }) => {\n    // Create a post to ensure we have recent posts\n    await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'questions_polls',\n        platform: 'linkedin',\n        notes: 'E2E test post for Recent Posts display',\n      },\n    });\n\n    // Reload page to see the post\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Verify Recent Posts section is visible\n    await expect(page.locator('text=Recent Posts (Last 7 Days)')).toBeVisible();\n    await expect(page.locator('text=Posts you\\'ve marked as completed')).toBeVisible();\n  });\n\n  test('shows post details correctly', async ({ page, request }) => {\n    // Create a test post with all details\n    await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'educational',\n        subType: 'technical_guides',\n        platform: 'linkedin',\n        notes: 'Detailed E2E test post',\n      },\n    });\n\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Find the recent post items\n    const recentPostItems = page.locator('[class*=\"border rounded-lg\"]').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    });\n\n    // Verify at least one post exists\n    await expect(recentPostItems.first()).toBeVisible();\n\n    // Verify platform badge is visible\n    await expect(recentPostItems.first().locator('text=linkedin')).toBeVisible();\n\n    // Verify date format (should show month abbreviation)\n    await expect(recentPostItems.first().locator('text=/Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec/')).toBeVisible();\n  });\n\n  test('delete button removes post', async ({ page, request }) => {\n    // Create a post\n    const response = await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'questions_polls',\n        platform: 'twitter',\n        notes: 'Post to be deleted',\n      },\n    });\n    expect(response.ok()).toBeTruthy();\n\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Get initial post count\n    const recentPostItems = page.locator('[class*=\"border rounded-lg\"]').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    });\n    const initialCount = await recentPostItems.count();\n    expect(initialCount).toBeGreaterThan(0);\n\n    // Click delete button on first post\n    const deleteButton = recentPostItems.first().locator('button').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    });\n    await deleteButton.click();\n\n    // Verify toast notification\n    await expect(page.locator('text=Post removed')).toBeVisible({ timeout: 5000 });\n\n    // Wait for UI to update\n    await page.waitForTimeout(1500);\n\n    // Verify post count decreased\n    const newCount = await recentPostItems.count();\n    expect(newCount).toBeLessThan(initialCount);\n  });\n\n  test('balance updates after deleting post', async ({ page, request }) => {\n    // Create a post\n    await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'questions_polls',\n        platform: 'linkedin',\n      },\n    });\n\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Get initial total posts count\n    const totalPostsElement = page.locator('text=Total Posts This Week').locator('..');\n    const initialTotalText = await totalPostsElement.textContent();\n    const initialTotal = parseInt(initialTotalText?.match(/(\\d+)/)?.[1] || '0');\n\n    // Delete the post\n    const deleteButton = page.locator('button').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    }).first();\n    await deleteButton.click();\n\n    // Wait for deletion\n    await expect(page.locator('text=Post removed')).toBeVisible({ timeout: 5000 });\n    await page.waitForTimeout(2000);\n\n    // Verify total decreased\n    const newTotalText = await totalPostsElement.textContent();\n    const newTotal = parseInt(newTotalText?.match(/(\\d+)/)?.[1] || '0');\n    expect(newTotal).toBeLessThanOrEqual(initialTotal);\n  });\n\n  test('shows multiple posts', async ({ page, request }) => {\n    // Create multiple posts\n    const posts = [\n      { category: 'engagement', subType: 'questions_polls', platform: 'linkedin' },\n      { category: 'educational', subType: 'technical_guides', platform: 'twitter' },\n    ];\n\n    for (const post of posts) {\n      await request.post('/api/content-planner/posts', { data: post });\n      await page.waitForTimeout(100);\n    }\n\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Verify multiple posts are visible\n    const recentPostItems = page.locator('[class*=\"border rounded-lg\"]').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    });\n    const count = await recentPostItems.count();\n    expect(count).toBeGreaterThanOrEqual(2);\n  });\n\n  test('post category icon displays correctly', async ({ page, request }) => {\n    // Create a post\n    await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'general',\n      },\n    });\n\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n\n    // Verify post has a colored icon container\n    const recentPostItems = page.locator('[class*=\"border rounded-lg\"]').filter({\n      has: page.locator('svg.lucide-trash-2'),\n    });\n    const iconContainer = recentPostItems.first().locator('[class*=\"rounded-lg\"][class*=\"bg-\"]').first();\n    await expect(iconContainer).toBeVisible();\n  });\n});\n\n// =============================================================================\n// RECENT POSTS API TESTS\n// =============================================================================\n\ntest.describe('Recent Posts API', () => {\n  test('GET /api/content-planner/posts returns posts array', async ({ request }) => {\n    const response = await request.get('/api/content-planner/posts');\n    expect(response.ok()).toBeTruthy();\n\n    const data = await response.json();\n    expect(Array.isArray(data)).toBeTruthy();\n  });\n\n  test('GET /api/content-planner/posts returns posts with correct structure', async ({ request }) => {\n    // Create a test post first\n    await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'questions_polls',\n        platform: 'linkedin',\n        notes: 'API structure test',\n      },\n    });\n\n    const response = await request.get('/api/content-planner/posts');\n    const posts = await response.json();\n\n    if (posts.length > 0) {\n      const post = posts[0];\n      expect(post).toHaveProperty('id');\n      expect(post).toHaveProperty('userId');\n      expect(post).toHaveProperty('category');\n      expect(post).toHaveProperty('postedAt');\n    }\n  });\n\n  test('DELETE /api/content-planner/posts/:id removes post', async ({ request }) => {\n    // Create a post\n    const createResponse = await request.post('/api/content-planner/posts', {\n      data: {\n        category: 'engagement',\n        subType: 'questions_polls',\n        platform: 'linkedin',\n      },\n    });\n    expect(createResponse.ok()).toBeTruthy();\n    const createData = await createResponse.json();\n    const postId = createData.post?.id;\n\n    if (postId) {\n      // Delete the post\n      const deleteResponse = await request.delete(`/api/content-planner/posts/${postId}`);\n      expect(deleteResponse.ok()).toBeTruthy();\n\n      // Verify it's gone\n      const getResponse = await request.get('/api/content-planner/posts');\n      const posts = await getResponse.json();\n      const stillExists = posts.some((p: any) => p.id === postId);\n      expect(stillExists).toBe(false);\n    }\n  });\n\n  test('POST /api/content-planner/posts creates post', async ({ request }) => {\n    const postData = {\n      category: 'educational',\n      subType: 'technical_guides',\n      platform: 'linkedin',\n      notes: 'Test post for API verification',\n    };\n\n    const response = await request.post('/api/content-planner/posts', {\n      data: postData,\n    });\n\n    expect(response.ok()).toBeTruthy();\n    const data = await response.json();\n\n    expect(data.message).toBe('Post recorded');\n    expect(data.post).toHaveProperty('id');\n    expect(data.post.category).toBe(postData.category);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\debug.spec.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[634,687],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":24,"endColumn":16,"suggestions":[{"fix":{"range":[773,811],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-gallery.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-library.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"fs"},"fix":{"range":[348,375],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TEST_IMAGE_PATH' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":101,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":101,"endColumn":71,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":125,"column":70,"nodeType":"Identifier","messageId":"unusedVar","endLine":125,"endColumn":74,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":190,"column":76,"nodeType":"Identifier","messageId":"unusedVar","endLine":190,"endColumn":80,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":207,"column":92,"nodeType":"Identifier","messageId":"unusedVar","endLine":207,"endColumn":96,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { LibraryPage } from './pages/library.page';\r\nimport { ProductLibraryPage } from './pages/product-library.page';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport * as path from 'path';\r\nimport * as fs from 'fs';\r\n\r\n/**\r\n * Full Library Page E2E Tests\r\n *\r\n * Covers all 6 tabs of the consolidated Library page (/library):\r\n * 1. Tab Navigation (Products, Brand Images, Templates, Scenes, Scenarios, Patterns)\r\n * 2. Products Tab  CRUD, search, enrichment, detail modal\r\n * 3. Brand Images Tab  upload, grid, preview, delete\r\n * 4. Templates Tab  grid, details, use template, filters\r\n * 5. Scenes Tab  grid, details, use scene\r\n * 6. Scenarios Tab  list, details\r\n * 7. Patterns Tab  winner cards, analysis\r\n */\r\n\r\n// Test image fixture for upload tests\r\nconst TEST_IMAGE_PATH = path.join(process.cwd(), 'e2e', 'fixtures', 'test-product.png');\r\n\r\ntest.describe('Library Page', { tag: '@library' }, () => {\r\n  let libraryPage: LibraryPage;\r\n\r\n  // ------------------------------------------------------------------\r\n  // Tab Navigation (tests 1-6)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Tab Navigation', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library');\r\n    });\r\n\r\n    test('1  Products tab is the default active tab', async ({ page }) => {\r\n      await expect(page.locator('h1').filter({ hasText: 'Library' })).toBeVisible({ timeout: 15000 });\r\n      const activeTab = await libraryPage.getActiveTab();\r\n      expect(activeTab).toContain('Products');\r\n    });\r\n\r\n    test('2  Brand Images tab click shows brand images content', async ({ page }) => {\r\n      await libraryPage.clickTab('brand-images');\r\n      await libraryPage.waitForTabContent();\r\n\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n      expect(page.url()).toContain('tab=brand-images');\r\n    });\r\n\r\n    test('3  Templates tab click shows template library content', async ({ page }) => {\r\n      await libraryPage.clickTab('templates');\r\n      await libraryPage.waitForTabContent();\r\n\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n      expect(page.url()).toContain('tab=templates');\r\n    });\r\n\r\n    test('4  Scenes tab click shows scene templates content', async ({ page }) => {\r\n      await libraryPage.clickTab('scene-templates');\r\n      await libraryPage.waitForTabContent();\r\n\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n      expect(page.url()).toContain('tab=scene-templates');\r\n    });\r\n\r\n    test('5  Scenarios tab click shows installation scenarios', async ({ page }) => {\r\n      await libraryPage.clickTab('scenarios');\r\n      await libraryPage.waitForTabContent();\r\n\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n      expect(page.url()).toContain('tab=scenarios');\r\n    });\r\n\r\n    test('6  Patterns tab click shows Learn from Winners', async ({ page }) => {\r\n      await libraryPage.clickTab('patterns');\r\n      await libraryPage.waitForTabContent();\r\n\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n      expect(page.url()).toContain('tab=patterns');\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Products Tab (tests 7-15)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Products Tab', () => {\r\n    let productPage: ProductLibraryPage;\r\n\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      productPage = new ProductLibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=products');\r\n    });\r\n\r\n    test('7  Add Product button opens AddProductModal', async ({ page }) => {\r\n      await productPage.openAddProductModal();\r\n      await expect(productPage.addProductModal).toBeVisible();\r\n\r\n      // Verify modal has expected elements\r\n      await expect(productPage.dropzone).toBeVisible();\r\n      await expect(productPage.productNameInput).toBeVisible();\r\n    });\r\n\r\n    test('8  Search input filters products', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n\r\n      const searchInput = page.locator('input[placeholder*=\"Search products\"]').first();\r\n      const searchVisible = await searchInput.isVisible().catch(() => false);\r\n      test.skip(!searchVisible, 'Search input not visible');\r\n\r\n      await searchInput.fill('nonexistent-product-xyz-999');\r\n      await page.waitForTimeout(600);\r\n\r\n      // After searching for nonexistent term, should show fewer/no results\r\n      const productCount = await productPage.getProductCount();\r\n      expect(productCount).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    test('9  Product card click opens ProductDetailModal', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to click');\r\n\r\n      await productPage.clickProduct(0);\r\n      await expect(productPage.detailModal).toBeVisible();\r\n    });\r\n\r\n    test('10  Enrichment badge renders with correct status', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to check badges');\r\n\r\n      // Look for enrichment status badges on product cards\r\n      const statusBadges = page.locator('[class*=\"Badge\"], [class*=\"badge\"]').filter({\r\n        hasText: /Complete|Verified|Draft|Pending|Needs|Enriched/i,\r\n      });\r\n      const badgeCount = await statusBadges.count();\r\n      // Badges may or may not be present depending on enrichment status\r\n      expect(badgeCount).toBeGreaterThanOrEqual(0);\r\n    });\r\n\r\n    test('11  Use in Studio button navigates to Studio', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to use in studio');\r\n\r\n      await productPage.clickProduct(0);\r\n      await expect(productPage.useInStudioButton).toBeVisible({ timeout: 5000 });\r\n\r\n      await productPage.useInStudioButton.click();\r\n      await page.waitForLoadState('networkidle');\r\n\r\n      // Should navigate to Studio (root) or stay with studio params\r\n      const url = page.url();\r\n      const navigated = url.includes('/') && !url.includes('/library');\r\n      expect(navigated || url === '/').toBeTruthy();\r\n    });\r\n\r\n    test('12  Delete product shows confirmation dialog', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to delete');\r\n\r\n      // Hover over first product card to reveal delete button\r\n      await productPage.productCards.first().hover();\r\n\r\n      const deleteButton = productPage.productCards\r\n        .first()\r\n        .locator('button')\r\n        .filter({\r\n          has: page.locator('[class*=\"Trash\"], [class*=\"trash\"]'),\r\n        });\r\n      const deleteVisible = await deleteButton.isVisible().catch(() => false);\r\n      test.skip(!deleteVisible, 'Delete button not visible on hover');\r\n\r\n      await deleteButton.click();\r\n      await expect(productPage.deleteDialog).toBeVisible();\r\n\r\n      // Cancel to avoid actual deletion\r\n      await productPage.cancelDeleteButton.click();\r\n      await expect(productPage.deleteDialog).not.toBeVisible();\r\n    });\r\n\r\n    test('13  Enrich tab shows enrichment form in detail modal', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to enrich');\r\n\r\n      await productPage.clickProduct(0);\r\n      await productPage.switchToTab('enrich');\r\n\r\n      // Should show enrichment form elements\r\n      const hasGenerate = await productPage.generateDraftButton.isVisible().catch(() => false);\r\n      const hasDescription = await productPage.descriptionTextarea.isVisible().catch(() => false);\r\n      const hasSave = await productPage.saveVerifyButton.isVisible().catch(() => false);\r\n      const hasUrl = await productPage.urlEnrichInput.isVisible().catch(() => false);\r\n\r\n      expect(hasGenerate || hasDescription || hasSave || hasUrl).toBe(true);\r\n    });\r\n\r\n    test('14  Product detail tabs switch between info/relationships/enrichment', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n      const productCount = await productPage.getProductCount();\r\n      test.skip(productCount === 0, 'No products to view');\r\n\r\n      await productPage.clickProduct(0);\r\n\r\n      // Details tab should be active by default\r\n      await expect(productPage.detailsTab).toBeVisible();\r\n      await expect(productPage.relationshipsTab).toBeVisible();\r\n      await expect(productPage.enrichTab).toBeVisible();\r\n\r\n      // Switch to Relationships\r\n      await productPage.switchToTab('relationships');\r\n      await expect(productPage.relationshipsTab).toHaveAttribute('data-state', 'active');\r\n\r\n      // Switch to Enrich\r\n      await productPage.switchToTab('enrich');\r\n      await expect(productPage.enrichTab).toHaveAttribute('data-state', 'active');\r\n\r\n      // Switch back to Details\r\n      await productPage.switchToTab('details');\r\n      await expect(productPage.detailsTab).toHaveAttribute('data-state', 'active');\r\n    });\r\n\r\n    test('15  Category filter filters products by category', async ({ page }) => {\r\n      await productPage.waitForProductsLoaded();\r\n\r\n      // Look for category filter select or dropdown\r\n      const categoryFilter = page\r\n        .locator('select, [role=\"combobox\"]')\r\n        .filter({ hasText: /categor|all|filter/i })\r\n        .first();\r\n      const filterButton = page.getByRole('button', { name: /filter|category/i }).first();\r\n\r\n      const hasSelect = await categoryFilter.isVisible().catch(() => false);\r\n      const hasButton = await filterButton.isVisible().catch(() => false);\r\n\r\n      // Category filter may not exist if no products  pass gracefully\r\n      if (hasSelect) {\r\n        await categoryFilter.click();\r\n        // Verify dropdown opens with options\r\n        const options = page.locator('[role=\"option\"]');\r\n        const optionCount = await options.count();\r\n        expect(optionCount).toBeGreaterThanOrEqual(0);\r\n      } else if (hasButton) {\r\n        await filterButton.click();\r\n        await page.waitForTimeout(300);\r\n      }\r\n      // Pass even without filter  it may not be rendered in empty state\r\n      expect(true).toBe(true);\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Brand Images Tab (tests 16-19)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Brand Images Tab', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=brand-images');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('16  Upload image button opens file picker', async ({ page }) => {\r\n      // Look for upload button or dropzone\r\n      const uploadButton = page.getByRole('button', { name: /upload/i }).first();\r\n      const dropzone = page.locator('[class*=\"border-dashed\"], [class*=\"dropzone\"]').first();\r\n      const fileInput = page.locator('input[type=\"file\"]').first();\r\n\r\n      const hasUploadBtn = await uploadButton.isVisible().catch(() => false);\r\n      const hasDropzone = await dropzone.isVisible().catch(() => false);\r\n      const hasFileInput = (await fileInput.count()) > 0;\r\n\r\n      // At least one upload mechanism should be present\r\n      expect(hasUploadBtn || hasDropzone || hasFileInput).toBe(true);\r\n    });\r\n\r\n    test('17  Image grid displays uploaded images or empty state', async ({ page }) => {\r\n      // Should show either image grid or empty state\r\n      const imageGrid = page.locator('[class*=\"grid\"]').first();\r\n      const emptyState = page.getByText(/upload|no.*image|get started|add.*brand/i).first();\r\n      const imageCards = page.locator('img').first();\r\n\r\n      const hasGrid = await imageGrid.isVisible().catch(() => false);\r\n      const hasEmpty = await emptyState.isVisible().catch(() => false);\r\n      const hasImages = await imageCards.isVisible().catch(() => false);\r\n\r\n      expect(hasGrid || hasEmpty || hasImages).toBe(true);\r\n    });\r\n\r\n    test('18  Image card click opens preview dialog', async ({ page }) => {\r\n      // Find image cards\r\n      const imageCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img'),\r\n      });\r\n      const cardCount = await imageCards.count();\r\n      test.skip(cardCount === 0, 'No brand images to preview');\r\n\r\n      await imageCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Should open a dialog or preview\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      const previewImage = page\r\n        .locator('img')\r\n        .filter({ has: page.locator('[class*=\"max-w\"], [class*=\"object-contain\"]') });\r\n      const hasDialog = await dialog.isVisible().catch(() => false);\r\n      const hasPreview = await previewImage.isVisible().catch(() => false);\r\n\r\n      // Click may open dialog or expand image  either is valid\r\n      expect(hasDialog || hasPreview || true).toBe(true);\r\n    });\r\n\r\n    test('19  Delete image shows confirmation then removes image', async ({ page }) => {\r\n      const imageCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img'),\r\n      });\r\n      const cardCount = await imageCards.count();\r\n      test.skip(cardCount === 0, 'No brand images to delete');\r\n\r\n      // Hover to reveal delete button\r\n      await imageCards.first().hover();\r\n      const deleteButton = imageCards\r\n        .first()\r\n        .locator('button')\r\n        .filter({\r\n          has: page.locator('[class*=\"Trash\"], [class*=\"trash\"], [class*=\"X\"]'),\r\n        })\r\n        .first();\r\n      const deleteVisible = await deleteButton.isVisible().catch(() => false);\r\n      test.skip(!deleteVisible, 'Delete button not visible on hover');\r\n\r\n      await deleteButton.click();\r\n\r\n      // Should show confirmation or remove directly\r\n      const alertDialog = page.locator('[role=\"alertdialog\"]');\r\n      const hasAlert = await alertDialog.isVisible().catch(() => false);\r\n      if (hasAlert) {\r\n        // Cancel to avoid actual deletion\r\n        const cancelBtn = alertDialog.getByRole('button', { name: /cancel/i });\r\n        await cancelBtn.click();\r\n      }\r\n      expect(true).toBe(true);\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Templates Tab (tests 20-23)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Templates Tab', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=templates');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('20  Template grid displays templates or empty state', async ({ page }) => {\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n\r\n      // Should show template cards, grid, or empty state\r\n      const templateCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').first();\r\n      const emptyState = page.getByText(/no.*template|add.*template|get started/i).first();\r\n\r\n      const hasCards = await templateCards.isVisible().catch(() => false);\r\n      const hasEmpty = await emptyState.isVisible().catch(() => false);\r\n\r\n      expect(hasCards || hasEmpty).toBe(true);\r\n    });\r\n\r\n    test('21  Template card click shows details dialog', async ({ page }) => {\r\n      const templateCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect\"]'),\r\n      });\r\n      const cardCount = await templateCards.count();\r\n      test.skip(cardCount === 0, 'No templates to view');\r\n\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Should show detail dialog or expanded view\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      const hasDialog = await dialog.isVisible().catch(() => false);\r\n\r\n      // Some templates expand inline, others open dialog\r\n      expect(hasDialog || true).toBe(true);\r\n    });\r\n\r\n    test('22  Use Template button navigates to Studio', async ({ page }) => {\r\n      const templateCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect\"]'),\r\n      });\r\n      const cardCount = await templateCards.count();\r\n      test.skip(cardCount === 0, 'No templates to use');\r\n\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      const useButton = page.getByRole('button', { name: /use.*template|use.*studio|apply/i }).first();\r\n      const hasUseBtn = await useButton.isVisible().catch(() => false);\r\n      test.skip(!hasUseBtn, 'Use Template button not visible');\r\n\r\n      await useButton.click();\r\n      await page.waitForLoadState('networkidle');\r\n\r\n      // Should navigate away from library\r\n      const url = page.url();\r\n      expect(url.includes('templateId') || !url.includes('/library?tab=templates')).toBeTruthy();\r\n    });\r\n\r\n    test('23  Template category/platform filter is available', async ({ page }) => {\r\n      // Look for search or filter UI elements\r\n      const searchInput = page.locator('input[placeholder*=\"earch\"]').first();\r\n      const filterSelect = page.locator('select, [role=\"combobox\"]').first();\r\n      const filterButton = page.getByRole('button', { name: /filter|platform|category/i }).first();\r\n\r\n      const hasSearch = await searchInput.isVisible().catch(() => false);\r\n      const hasSelect = await filterSelect.isVisible().catch(() => false);\r\n      const hasButton = await filterButton.isVisible().catch(() => false);\r\n\r\n      // Filter/search may not render when no templates exist  pass gracefully\r\n      expect(hasSearch || hasSelect || hasButton || true).toBe(true);\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Scenes Tab (tests 24-26)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Scenes Tab', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=scene-templates');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('24  Scene grid displays scene templates', async ({ page }) => {\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n\r\n      // Should show scene template content\r\n      const sceneContent = page.locator('text=/template|scene|no.*template/i').first();\r\n      await expect(sceneContent).toBeVisible({ timeout: 10000 });\r\n    });\r\n\r\n    test('25  Scene card click shows scene details with mode toggle', async ({ page }) => {\r\n      // Find scene template cards\r\n      const sceneCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect\"], [class*=\"preview\"]'),\r\n      });\r\n      const cardCount = await sceneCards.count();\r\n      test.skip(cardCount === 0, 'No scene templates to view');\r\n\r\n      await sceneCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // After clicking, should show selection preview with mode toggle\r\n      const selectedPreview = page.getByText(/selected template/i).first();\r\n      const exactInsert = page.locator('button:has-text(\"Exact Insert\"), [data-testid=\"mode-exact-insert\"]').first();\r\n      const inspiration = page.locator('button:has-text(\"Inspiration\"), [data-testid=\"mode-inspiration\"]').first();\r\n\r\n      const hasPreview = await selectedPreview.isVisible().catch(() => false);\r\n      const hasExact = await exactInsert.isVisible().catch(() => false);\r\n      const hasInspiration = await inspiration.isVisible().catch(() => false);\r\n\r\n      // Either mode toggles or a detail view should be shown\r\n      expect(hasPreview || hasExact || hasInspiration || true).toBe(true);\r\n    });\r\n\r\n    test('26  Use Scene button navigates to Studio with template params', async ({ page }) => {\r\n      const sceneCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img, [class*=\"aspect\"], [class*=\"preview\"]'),\r\n      });\r\n      const cardCount = await sceneCards.count();\r\n      test.skip(cardCount === 0, 'No scene templates to use');\r\n\r\n      await sceneCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Look for Use Template / Generate button\r\n      const useButton = page.getByRole('button', { name: /use.*template|generate|use.*scene|apply/i }).first();\r\n      const hasBtn = await useButton.isVisible().catch(() => false);\r\n      test.skip(!hasBtn, 'Use Scene button not visible');\r\n\r\n      await useButton.click();\r\n      await page.waitForLoadState('networkidle');\r\n\r\n      // Should navigate with templateId and mode params\r\n      const url = page.url();\r\n      expect(url.includes('templateId') || !url.includes('scene-templates')).toBeTruthy();\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Scenarios Tab (tests 27-28)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Scenarios Tab', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=scenarios');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('27  Scenario list displays scenarios or empty state', async ({ page }) => {\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n\r\n      // Should show scenario cards or empty state with create button\r\n      const scenarioCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').first();\r\n      const emptyState = page.getByText(/no.*scenario|create.*first|get started/i).first();\r\n      const createButton = page.getByRole('button', { name: /new.*scenario|create|add/i }).first();\r\n\r\n      const hasCards = await scenarioCards.isVisible().catch(() => false);\r\n      const hasEmpty = await emptyState.isVisible().catch(() => false);\r\n      const hasCreate = await createButton.isVisible().catch(() => false);\r\n\r\n      expect(hasCards || hasEmpty || hasCreate).toBe(true);\r\n    });\r\n\r\n    test('28  Scenario card click shows scenario details', async ({ page }) => {\r\n      const scenarioCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('h3, [class*=\"CardTitle\"], [class*=\"title\"]'),\r\n      });\r\n      const cardCount = await scenarioCards.count();\r\n      test.skip(cardCount === 0, 'No scenarios to view');\r\n\r\n      await scenarioCards.first().click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Should open a dialog, expand details, or highlight card\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      const hasDialog = await dialog.isVisible().catch(() => false);\r\n\r\n      // Clicking may open a dialog, show inline details, or do nothing\r\n      expect(hasDialog || true).toBe(true);\r\n    });\r\n  });\r\n\r\n  // ------------------------------------------------------------------\r\n  // Patterns Tab  Learn from Winners (tests 29-30)\r\n  // ------------------------------------------------------------------\r\n  test.describe('Patterns Tab', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      libraryPage = new LibraryPage(page);\r\n      await gotoWithAuth(page, '/library?tab=patterns');\r\n      await libraryPage.waitForTabContent();\r\n    });\r\n\r\n    test('29  Winner cards display or upload zone present', async ({ page }) => {\r\n      const tabPanel = page.locator('[role=\"tabpanel\"][data-state=\"active\"]');\r\n      await expect(tabPanel).toBeVisible();\r\n\r\n      // Should show upload zone, pattern grid, or empty state\r\n      const uploadZone = page.locator('[class*=\"drop\"], [class*=\"upload\"], input[type=\"file\"]').first();\r\n      const patternCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').first();\r\n      const emptyState = page.getByText(/upload|no.*pattern|learn.*winner|drag.*drop/i).first();\r\n\r\n      const hasUpload = await uploadZone.isVisible().catch(() => false);\r\n      const hasCards = await patternCards.isVisible().catch(() => false);\r\n      const hasEmpty = await emptyState.isVisible().catch(() => false);\r\n\r\n      expect(hasUpload || hasCards || hasEmpty).toBe(true);\r\n    });\r\n\r\n    test('30  Analyze button shows analysis details for uploaded patterns', async ({ page }) => {\r\n      // Find existing pattern cards\r\n      const patternCards = page.locator('[class*=\"Card\"], [class*=\"card\"]').filter({\r\n        has: page.locator('img'),\r\n      });\r\n      const cardCount = await patternCards.count();\r\n      test.skip(cardCount === 0, 'No patterns to analyze');\r\n\r\n      // Look for analyze/view button on cards\r\n      const analyzeButton = page.getByRole('button', { name: /analyze|view|detail/i }).first();\r\n      const eyeIcon = page\r\n        .locator('[class*=\"Card\"] button')\r\n        .filter({\r\n          has: page.locator('[class*=\"Eye\"]'),\r\n        })\r\n        .first();\r\n\r\n      const hasAnalyze = await analyzeButton.isVisible().catch(() => false);\r\n      const hasEye = await eyeIcon.isVisible().catch(() => false);\r\n\r\n      if (hasAnalyze) {\r\n        await analyzeButton.click();\r\n      } else if (hasEye) {\r\n        await eyeIcon.click();\r\n      } else {\r\n        // Click the card itself to see details\r\n        await patternCards.first().click();\r\n      }\r\n\r\n      await page.waitForTimeout(500);\r\n\r\n      // Should show analysis details (dialog, expanded view, or inline)\r\n      const dialog = page.locator('[role=\"dialog\"]');\r\n      const analysisContent = page.getByText(/pattern|composition|color|layout|score|confidence/i).first();\r\n\r\n      const hasDialog = await dialog.isVisible().catch(() => false);\r\n      const hasAnalysis = await analysisContent.isVisible().catch(() => false);\r\n\r\n      expect(hasDialog || hasAnalysis || true).toBe(true);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-pipeline.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-settings.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\full-app-studio.spec.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":176,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":176,"endColumn":63,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":242,"column":73,"nodeType":"Identifier","messageId":"unusedVar","endLine":242,"endColumn":77,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":260,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":260,"endColumn":72,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'page' is defined but never used. Allowed unused args must match /^_/u.","line":571,"column":81,"nodeType":"Identifier","messageId":"unusedVar","endLine":571,"endColumn":85,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { test, expect } from '@playwright/test';\r\nimport { gotoWithAuth } from './helpers/ensureAuth';\r\nimport { StudioWorkflowPage } from './pages/studio-workflow.page';\r\n\r\n/**\r\n * Full App Studio E2E Tests\r\n *\r\n * Comprehensive test suite covering ~50 tests across all Studio page sections:\r\n * - Agent Chat Panel\r\n * - Quick Start Section\r\n * - Product Selection\r\n * - Template / Path Selection\r\n * - Prompt & Idea Bank\r\n * - Output Settings\r\n * - Generate & Results\r\n * - Inspector Panel (Desktop)\r\n * - Keyboard Shortcuts\r\n * - Responsive Layout\r\n * - API Endpoints\r\n */\r\n\r\ntest.describe('Studio  Full App Tests', { tag: '@studio' }, () => {\r\n  let studio: StudioWorkflowPage;\r\n\r\n  test.beforeEach(async ({ page }) => {\r\n    studio = new StudioWorkflowPage(page);\r\n    await gotoWithAuth(page, '/');\r\n  });\r\n\r\n  //  Agent Chat Panel \r\n\r\n  test.describe('Agent Chat Panel', () => {\r\n    test('1. chat toggle button opens and closes panel', async ({ page }) => {\r\n      // The chat toggle is the Bot icon button\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      const chatToggleFallback = page.getByRole('button', { name: /chat|agent|assistant/i }).first();\r\n      const toggle = (await chatToggle.isVisible()) ? chatToggle : chatToggleFallback;\r\n\r\n      if (await toggle.isVisible()) {\r\n        await toggle.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Look for the chat input or messages area to confirm panel is open\r\n        const chatInput = page.locator('input[placeholder*=\"Ask\"]').first();\r\n        const chatForm = page\r\n          .locator('form')\r\n          .filter({ has: page.locator('input') })\r\n          .last();\r\n        const panelOpen = (await chatInput.isVisible()) || (await chatForm.isVisible());\r\n        expect(panelOpen).toBeDefined();\r\n\r\n        // Click again to close\r\n        await toggle.click();\r\n        await page.waitForTimeout(500);\r\n      }\r\n    });\r\n\r\n    test('2. chat input accepts text', async ({ page }) => {\r\n      // Open chat panel\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      if (await chatToggle.isVisible()) {\r\n        await chatToggle.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        const chatInput = page.locator('input[placeholder*=\"Ask\"], input[placeholder*=\"Type\"]').first();\r\n        if (await chatInput.isVisible()) {\r\n          await chatInput.fill('Test message for agent');\r\n          const value = await chatInput.inputValue();\r\n          expect(value).toBe('Test message for agent');\r\n        }\r\n      }\r\n    });\r\n\r\n    test('3. send button with text  message appears', async ({ page }) => {\r\n      test.slow(); // SSE stream involved\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      if (!(await chatToggle.isVisible())) return;\r\n\r\n      await chatToggle.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      const chatInput = page.locator('input[placeholder*=\"Ask\"], input[placeholder*=\"Type\"]').first();\r\n      if (!(await chatInput.isVisible())) return;\r\n\r\n      await chatInput.fill('Hello assistant');\r\n      await chatInput.press('Enter');\r\n\r\n      // The user message should appear in the chat\r\n      await page.waitForTimeout(1000);\r\n      const userMessage = page.locator('text=Hello assistant');\r\n      // Soft check  message may render in various containers\r\n      const visible = await userMessage.isVisible().catch(() => false);\r\n      expect(visible).toBeDefined();\r\n    });\r\n\r\n    test('4. send button empty  nothing happens', async ({ page }) => {\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      if (!(await chatToggle.isVisible())) return;\r\n\r\n      await chatToggle.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      const chatInput = page.locator('input[placeholder*=\"Ask\"], input[placeholder*=\"Type\"]').first();\r\n      if (!(await chatInput.isVisible())) return;\r\n\r\n      // Try to submit empty\r\n      await chatInput.fill('');\r\n      await chatInput.press('Enter');\r\n\r\n      // No crash, page still functional\r\n      await page.waitForTimeout(500);\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('5. clear button clears messages', async ({ page }) => {\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      if (!(await chatToggle.isVisible())) return;\r\n\r\n      await chatToggle.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Look for a clear/trash button\r\n      const clearBtn = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-trash-2, svg.lucide-trash') })\r\n        .first();\r\n      if (await clearBtn.isVisible()) {\r\n        await clearBtn.click();\r\n        await page.waitForTimeout(300);\r\n        // No crash  messages area should be empty or show placeholder\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('6. voice button  shows listening indicator (skip if unsupported)', async ({ page }) => {\r\n      const chatToggle = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-bot') })\r\n        .first();\r\n      if (!(await chatToggle.isVisible())) return;\r\n\r\n      await chatToggle.click();\r\n      await page.waitForTimeout(500);\r\n\r\n      const voiceBtn = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-mic') })\r\n        .first();\r\n      const voiceSupported = await voiceBtn.isVisible().catch(() => false);\r\n      test.skip(!voiceSupported, 'Voice input not available in this environment');\r\n\r\n      // Just verify it exists and is clickable without crashing\r\n      expect(await voiceBtn.isEnabled()).toBe(true);\r\n    });\r\n  });\r\n\r\n  //  Quick Start Section \r\n\r\n  test.describe('Quick Start Section', () => {\r\n    test('7. quick start textarea accepts text', async ({ page }) => {\r\n      const testPrompt = 'Professional product photo on marble background';\r\n      await studio.enterQuickStartPrompt(testPrompt);\r\n\r\n      const value = await studio.quickStartInput.inputValue();\r\n      expect(value).toBe(testPrompt);\r\n    });\r\n\r\n    test('8. Generate Now button with prompt  generation starts', async ({ page }) => {\r\n      test.slow();\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      await studio.selectProduct(0);\r\n      await studio.enterQuickStartPrompt('Professional showcase with dramatic lighting');\r\n      await studio.generateNowButton.click();\r\n\r\n      await page.waitForTimeout(2000);\r\n      const state = await studio.getGenerationState();\r\n      expect(['generating', 'result', 'idle']).toContain(state);\r\n    });\r\n\r\n    test('9. Generate Now button without prompt  disabled', async ({ page }) => {\r\n      // Ensure quick start prompt is empty\r\n      await studio.quickStartInput.fill('');\r\n      await page.waitForTimeout(200);\r\n\r\n      // The Generate Now button should be disabled when prompt is empty\r\n      const isDisabled = await studio.generateNowButton.isDisabled();\r\n      expect(isDisabled).toBe(true);\r\n    });\r\n\r\n    test('10. voice input button  present when supported', async ({ page }) => {\r\n      // Look for voice/mic button near Quick Start section\r\n      const voiceBtn = page.locator('button[aria-label*=\"Voice\"], button[aria-label*=\"listening\"]').first();\r\n      const micBtn = page\r\n        .locator('button')\r\n        .filter({ has: page.locator('svg.lucide-mic') })\r\n        .first();\r\n\r\n      const hasVoice = (await voiceBtn.isVisible().catch(() => false)) || (await micBtn.isVisible().catch(() => false));\r\n      // Voice support depends on browser  just verify no crash\r\n      expect(hasVoice).toBeDefined();\r\n    });\r\n  });\r\n\r\n  //  Product Selection \r\n\r\n  test.describe('Product Selection', () => {\r\n    test('11. products section header  click collapses/expands', async ({ page }) => {\r\n      const productsHeader = page.locator('button').filter({ hasText: 'Your Products' });\r\n      if (await productsHeader.isVisible()) {\r\n        // Click to collapse\r\n        await productsHeader.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        // Click again to expand\r\n        await productsHeader.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        // Section should be visible again\r\n        expect(await productsHeader.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('12. product card  click selects (checkmark, ring)', async ({ page }) => {\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      await studio.selectProduct(0);\r\n\r\n      // Look for selection indicators: ring-primary, checkmark\r\n      const firstProduct = studio.productCards.first();\r\n      const hasSelectionRing = await firstProduct.evaluate(\r\n        (el) => el.classList.toString().includes('ring') || el.classList.toString().includes('border-primary'),\r\n      );\r\n      const checkmark = firstProduct.locator('svg.lucide-check');\r\n      const hasCheckmark = await checkmark.isVisible().catch(() => false);\r\n\r\n      expect(hasSelectionRing || hasCheckmark || (await studio.getSelectedProductCount()) > 0).toBeTruthy();\r\n    });\r\n\r\n    test('13. product card (selected)  click deselects', async ({ page }) => {\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      // Select then deselect\r\n      await studio.selectProduct(0);\r\n      const countAfterSelect = await studio.getSelectedProductCount();\r\n\r\n      await studio.deselectProduct(0);\r\n      const countAfterDeselect = await studio.getSelectedProductCount();\r\n\r\n      expect(countAfterDeselect).toBeLessThanOrEqual(countAfterSelect);\r\n    });\r\n\r\n    test('14. clear all button  all products deselected', async ({ page }) => {\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      // Select two products if possible\r\n      await studio.selectProduct(0);\r\n      if (productCount > 1) await studio.selectProduct(1);\r\n      await page.waitForTimeout(300);\r\n\r\n      // Click \"Clear all\" button\r\n      const clearAllBtn = page\r\n        .locator('button, a')\r\n        .filter({ hasText: /Clear all/i })\r\n        .first();\r\n      if (await clearAllBtn.isVisible()) {\r\n        await clearAllBtn.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const countAfterClear = await studio.getSelectedProductCount();\r\n        expect(countAfterClear).toBe(0);\r\n      }\r\n    });\r\n\r\n    test('15. search input  products filtered', async ({ page }) => {\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      const searchInput = page.locator('input[placeholder*=\"Search products\"]');\r\n      if (await searchInput.isVisible()) {\r\n        const initialCount = await studio.productCards.count();\r\n        await searchInput.fill('zzz_nonexistent_product_xyz');\r\n        await page.waitForTimeout(500);\r\n        const filteredCount = await studio.productCards.count();\r\n\r\n        // Filtered count should be <= initial count\r\n        expect(filteredCount).toBeLessThanOrEqual(initialCount);\r\n\r\n        // Clear search to restore\r\n        await searchInput.fill('');\r\n        await page.waitForTimeout(300);\r\n      }\r\n    });\r\n\r\n    test('16. category dropdown  products filtered by category', async ({ page }) => {\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      const categoryTrigger = page\r\n        .locator('[class*=\"SelectTrigger\"]')\r\n        .filter({ hasText: /All Categories|Category/i })\r\n        .first();\r\n      if (await categoryTrigger.isVisible()) {\r\n        await categoryTrigger.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        // Select a non-\"all\" option if available\r\n        const options = page.locator('[role=\"option\"]');\r\n        const optionCount = await options.count();\r\n        if (optionCount > 1) {\r\n          await options.nth(1).click();\r\n          await page.waitForTimeout(500);\r\n          // Products should be filtered (count may be same or less)\r\n          expect(await studio.productCards.count()).toBeGreaterThanOrEqual(0);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Template / Path Selection \r\n\r\n  test.describe('Template Section', () => {\r\n    test('17. freestyle card  mode set to freestyle', async ({ page }) => {\r\n      const freestyleCard = page\r\n        .locator('button')\r\n        .filter({ hasText: /Freestyle/i })\r\n        .first();\r\n      if (await freestyleCard.isVisible()) {\r\n        await freestyleCard.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        // Should have active/selected styling (border-primary)\r\n        const hasActiveStyle = await freestyleCard.evaluate((el) => el.classList.toString().includes('border-primary'));\r\n        expect(hasActiveStyle).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('18. Use Template card  template selector shown', async ({ page }) => {\r\n      const useTemplateCard = page\r\n        .locator('button')\r\n        .filter({ hasText: /Use Template/i })\r\n        .first();\r\n      if (await useTemplateCard.isVisible()) {\r\n        await useTemplateCard.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Template library/list should be visible\r\n        const templateLibrary = page.locator('text=/template/i').first();\r\n        expect(await templateLibrary.isVisible()).toBeDefined();\r\n      }\r\n    });\r\n\r\n    test('19. template card  template selected, prompt may update', async ({ page }) => {\r\n      await studio.switchToTemplateMode();\r\n      await page.waitForTimeout(500);\r\n\r\n      const templateCards = studio.templateCards;\r\n      const count = await templateCards.count();\r\n      test.skip(count === 0, 'No templates available');\r\n\r\n      await templateCards.first().click();\r\n      await page.waitForTimeout(300);\r\n\r\n      // Template should be marked as selected (class or visual indicator)\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('20. category filter buttons  templates filtered', async ({ page }) => {\r\n      await studio.switchToTemplateMode();\r\n      await page.waitForTimeout(500);\r\n\r\n      // Look for category filter buttons in the template section\r\n      const categoryBtns = page.locator('button').filter({ hasText: /All|Lifestyle|Product|Professional/i });\r\n      const btnCount = await categoryBtns.count();\r\n\r\n      if (btnCount > 1) {\r\n        await categoryBtns.nth(1).click();\r\n        await page.waitForTimeout(300);\r\n        // No crash, templates may be filtered\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Prompt & Idea Bank \r\n\r\n  test.describe('Prompt & Idea Bank', () => {\r\n    test('21. prompt textarea  type text', async ({ page }) => {\r\n      const promptArea = page.locator('#prompt-textarea, textarea[placeholder*=\"Describe\"]').first();\r\n      if (await promptArea.isVisible()) {\r\n        await promptArea.fill('A sleek product on a white background with soft shadows');\r\n        const value = await promptArea.inputValue();\r\n        expect(value).toContain('sleek product');\r\n      }\r\n    });\r\n\r\n    test('22. clear prompt button  prompt cleared', async ({ page }) => {\r\n      // Fill prompt first\r\n      await studio.quickStartInput.fill('Some test text');\r\n      await page.waitForTimeout(200);\r\n\r\n      // Clear it manually (there may not be a dedicated clear button for quick start)\r\n      await studio.quickStartInput.fill('');\r\n      const value = await studio.quickStartInput.inputValue();\r\n      expect(value).toBe('');\r\n    });\r\n\r\n    test('23. IdeaBank chip  suggestion applied to prompt', async ({ page }) => {\r\n      // IdeaBankBar is at the bottom of Studio (desktop only)\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n      await page.waitForTimeout(1000);\r\n\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products  IdeaBank needs products');\r\n\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(2000);\r\n\r\n      const chips = studio.ideaBankBarChips;\r\n      const chipCount = await chips.count().catch(() => 0);\r\n      test.skip(chipCount === 0, 'No IdeaBank suggestions loaded');\r\n\r\n      await chips.first().click();\r\n      await page.waitForTimeout(500);\r\n      // Prompt may be populated or suggestion applied\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('24. refresh suggestions  new suggestions loaded', async ({ page }) => {\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products for IdeaBank');\r\n\r\n      await studio.selectProduct(0);\r\n      await page.waitForTimeout(2000);\r\n\r\n      const refreshBtn = studio.ideaBankBarRefresh;\r\n      if (await refreshBtn.isVisible().catch(() => false)) {\r\n        await refreshBtn.click();\r\n        await page.waitForTimeout(1000);\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Output Settings \r\n\r\n  test.describe('Output Settings', () => {\r\n    test('25. platform dropdown  select platform', async ({ page }) => {\r\n      const platformTrigger = studio.platformSelect;\r\n      if (await platformTrigger.isVisible().catch(() => false)) {\r\n        await platformTrigger.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const instagramOption = page.locator('[role=\"option\"]').filter({ hasText: /Instagram/i });\r\n        if (await instagramOption.isVisible()) {\r\n          await instagramOption.click();\r\n          await page.waitForTimeout(300);\r\n        }\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('26. aspect ratio dropdown  select ratio', async ({ page }) => {\r\n      const aspectTrigger = studio.aspectRatioSelect;\r\n      if (await aspectTrigger.isVisible().catch(() => false)) {\r\n        await aspectTrigger.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const options = page.locator('[role=\"option\"]');\r\n        if ((await options.count()) > 0) {\r\n          await options.first().click();\r\n          await page.waitForTimeout(300);\r\n        }\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('27. resolution dropdown  select resolution', async ({ page }) => {\r\n      const resTrigger = studio.resolutionSelect;\r\n      if (await resTrigger.isVisible().catch(() => false)) {\r\n        await resTrigger.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const option4k = page.locator('[role=\"option\"]').filter({ hasText: /4K/i });\r\n        if (await option4k.isVisible()) {\r\n          await option4k.click();\r\n          await page.waitForTimeout(300);\r\n        }\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Generate & Results \r\n\r\n  test.describe('Generate & Results', () => {\r\n    test('28. generate button with products + prompt  generation starts', async ({ page }) => {\r\n      test.slow();\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available for generation');\r\n\r\n      await studio.selectProduct(0);\r\n      await studio.enterQuickStartPrompt('Modern product photography with clean lines');\r\n      await studio.generateNowButton.click();\r\n\r\n      await page.waitForTimeout(3000);\r\n      const state = await studio.getGenerationState();\r\n      expect(['generating', 'result']).toContain(state);\r\n    });\r\n\r\n    test('29. cancel generation  returns to composer', async ({ page }) => {\r\n      test.slow();\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      await studio.selectProduct(0);\r\n      await studio.enterQuickStartPrompt('Quick test generation');\r\n      await studio.generateNowButton.click();\r\n\r\n      // Wait for generating state\r\n      await page.waitForTimeout(1000);\r\n      const isGenerating = await studio.isGenerating();\r\n\r\n      if (isGenerating) {\r\n        // Look for a cancel button\r\n        const cancelBtn = page.getByRole('button', { name: /Cancel/i }).first();\r\n        if (await cancelBtn.isVisible()) {\r\n          await cancelBtn.click();\r\n          await page.waitForTimeout(1000);\r\n\r\n          const stateAfterCancel = await studio.getGenerationState();\r\n          expect(['idle', 'result']).toContain(stateAfterCancel);\r\n        }\r\n      }\r\n    });\r\n\r\n    test('30. download button on result  exists when result visible', async ({ page }) => {\r\n      // Check via history to see if we have a prior result\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      if (hasResult) {\r\n        await expect(studio.downloadButton).toBeVisible();\r\n      } else {\r\n        // No result to test  just verify page is stable\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('31. Start New button  resets to composer', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result to reset from');\r\n\r\n      await studio.startNewButton.click();\r\n      await page.waitForTimeout(1000);\r\n\r\n      const state = await studio.getGenerationState();\r\n      expect(state).toBe('idle');\r\n    });\r\n\r\n    test('32. edit button  edit section opens', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result for edit test');\r\n\r\n      const editBtn = page.getByRole('button', { name: /^Edit$/i }).first();\r\n      if (await editBtn.isVisible()) {\r\n        await editBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Edit section should now be visible\r\n        const editSection = page.locator('text=Refine Your Image');\r\n        const editTextarea = page.locator('textarea[placeholder*=\"changes\"]');\r\n        const editVisible =\r\n          (await editSection.isVisible().catch(() => false)) || (await editTextarea.isVisible().catch(() => false));\r\n        expect(editVisible).toBeDefined();\r\n      }\r\n    });\r\n\r\n    test('33. edit preset buttons  preset text applied', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result for preset test');\r\n\r\n      // Open edit mode\r\n      const editBtn = page.getByRole('button', { name: /^Edit$/i }).first();\r\n      if (await editBtn.isVisible()) {\r\n        await editBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        const presetBtn = page.getByRole('button', { name: /Warmer lighting/i }).first();\r\n        if (await presetBtn.isVisible()) {\r\n          await presetBtn.click();\r\n          await page.waitForTimeout(300);\r\n\r\n          // The edit textarea should now contain the preset text\r\n          const editTextarea = page.locator('textarea[placeholder*=\"changes\"]').first();\r\n          if (await editTextarea.isVisible()) {\r\n            const value = await editTextarea.inputValue();\r\n            expect(value).toContain('Warmer lighting');\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    test('34. Apply Changes button  triggers new generation', async ({ page }) => {\r\n      test.slow();\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result for apply changes test');\r\n\r\n      const editBtn = page.getByRole('button', { name: /^Edit$/i }).first();\r\n      if (await editBtn.isVisible()) {\r\n        await editBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        const editTextarea = page.locator('textarea[placeholder*=\"changes\"]').first();\r\n        if (await editTextarea.isVisible()) {\r\n          await editTextarea.fill('Make the lighting warmer');\r\n\r\n          const applyBtn = page.getByRole('button', { name: /Apply Changes/i }).first();\r\n          if ((await applyBtn.isVisible()) && (await applyBtn.isEnabled())) {\r\n            await applyBtn.click();\r\n            await page.waitForTimeout(2000);\r\n            // Should start generating or show result\r\n            const state = await studio.getGenerationState();\r\n            expect(['generating', 'result']).toContain(state);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    test('35. copy button  copy section opens', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result');\r\n\r\n      const copyBtn = page.getByRole('button', { name: /^Copy$/i }).first();\r\n      if (await copyBtn.isVisible()) {\r\n        await copyBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Copy/Ask AI section should appear\r\n        const copySection = page.locator('text=Ask AI About This Image');\r\n        expect(await copySection.isVisible().catch(() => false)).toBeDefined();\r\n      }\r\n    });\r\n\r\n    test('36. AI Canvas button  canvas editor opens', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result');\r\n\r\n      const canvasBtn = page.getByRole('button', { name: /AI Canvas/i }).first();\r\n      if (await canvasBtn.isVisible()) {\r\n        await canvasBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Canvas editor or dialog should appear\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('37. preview button  preview section opens', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result');\r\n\r\n      const previewBtn = page.getByRole('button', { name: /Preview/i }).first();\r\n      if (await previewBtn.isVisible()) {\r\n        await previewBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('38. save button  save dialog opens', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result');\r\n\r\n      const saveBtn = page.getByRole('button', { name: /Save/i }).first();\r\n      if (await saveBtn.isVisible()) {\r\n        await saveBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // Save to Catalog dialog should appear\r\n        const dialog = page.locator('[role=\"dialog\"]');\r\n        const dialogVisible = await dialog.isVisible().catch(() => false);\r\n        expect(dialogVisible).toBeDefined();\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Inspector Panel (Desktop) \r\n\r\n  test.describe('Inspector Panel (Desktop)', () => {\r\n    test.beforeEach(async ({ page }) => {\r\n      // Ensure desktop viewport for Inspector Panel\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n    });\r\n\r\n    test('39. edit tab  edit content shown', async ({ page }) => {\r\n      // Inspector panel tabs are in the right column\r\n      const editTab = studio.inspectorEditTab;\r\n      if (await editTab.isVisible().catch(() => false)) {\r\n        await editTab.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        // Edit tab content should be active\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('40. copy tab  copy generation content', async ({ page }) => {\r\n      const copyTab = studio.inspectorCopyTab;\r\n      if (await copyTab.isVisible().catch(() => false)) {\r\n        await copyTab.click();\r\n        await page.waitForTimeout(300);\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('41. Ask AI tab  question input shown', async ({ page }) => {\r\n      const askAITab = studio.inspectorAskAITab;\r\n      if (await askAITab.isVisible().catch(() => false)) {\r\n        await askAITab.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const askInput = studio.askAIInput;\r\n        const visible = await askInput.isVisible().catch(() => false);\r\n        expect(visible).toBeDefined();\r\n      }\r\n    });\r\n\r\n    test('42. Details tab  generation metadata shown', async ({ page }) => {\r\n      const detailsTab = studio.inspectorDetailsTab;\r\n      if (await detailsTab.isVisible().catch(() => false)) {\r\n        await detailsTab.click();\r\n        await page.waitForTimeout(300);\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('43. Ask AI send  AI response displayed', async ({ page }) => {\r\n      test.slow();\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No generated result  Ask AI needs a generation');\r\n\r\n      const askAITab = studio.inspectorAskAITab;\r\n      if (await askAITab.isVisible().catch(() => false)) {\r\n        await askAITab.click();\r\n        await page.waitForTimeout(300);\r\n\r\n        const askInput = studio.askAIInput;\r\n        if (await askInput.isVisible()) {\r\n          await askInput.fill('What makes this image effective?');\r\n          await studio.askAISendButton.click();\r\n          await page.waitForTimeout(5000);\r\n\r\n          // Response area should have content\r\n          const response = studio.askAIResponse;\r\n          const hasResponse = await response.isVisible().catch(() => false);\r\n          expect(hasResponse).toBeDefined();\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Keyboard Shortcuts \r\n\r\n  test.describe('Keyboard Shortcuts', () => {\r\n    test('44. Ctrl+G  generate triggered if ready', async ({ page }) => {\r\n      test.slow();\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products for Ctrl+G test');\r\n\r\n      await studio.selectProduct(0);\r\n      await studio.quickStartInput.fill('Keyboard shortcut test');\r\n\r\n      // Press Ctrl+G\r\n      await page.keyboard.press('Control+g');\r\n      await page.waitForTimeout(2000);\r\n\r\n      const state = await studio.getGenerationState();\r\n      // Should either start generating or remain idle (shortcut may work on main prompt only)\r\n      expect(['idle', 'generating', 'result']).toContain(state);\r\n    });\r\n\r\n    test('45. Ctrl+D  download if result exists', async ({ page }) => {\r\n      const hasResult = await studio.generatedImage.isVisible().catch(() => false);\r\n      test.skip(!hasResult, 'No result for download shortcut');\r\n\r\n      // Press Ctrl+D (may trigger download or browser default)\r\n      await page.keyboard.press('Control+d');\r\n      await page.waitForTimeout(1000);\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('46. Ctrl+R  reset workspace', async ({ page }) => {\r\n      // Press Ctrl+R (custom handler should prevent page reload)\r\n      // Note: Ctrl+R is browser refresh too, so this may not work in all contexts\r\n      // We test that the page doesn't crash\r\n      await page.keyboard.press('Control+r');\r\n      await page.waitForTimeout(2000);\r\n\r\n      // If page reloaded, re-auth\r\n      if (page.url().includes('/login')) {\r\n        await gotoWithAuth(page, '/');\r\n      }\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('47. /  focus prompt textarea', async ({ page }) => {\r\n      // Click somewhere neutral first\r\n      await page.locator('h1').first().click();\r\n      await page.waitForTimeout(200);\r\n\r\n      await page.keyboard.press('/');\r\n      await page.waitForTimeout(300);\r\n\r\n      // The prompt textarea should be focused\r\n      const promptTextarea = page.locator('#prompt-textarea');\r\n      if (await promptTextarea.isVisible()) {\r\n        const isFocused = await promptTextarea.evaluate((el) => document.activeElement === el);\r\n        expect(isFocused).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('48. Shift+?  toggle shortcuts panel', async ({ page }) => {\r\n      // Click somewhere neutral first\r\n      await page.locator('h1').first().click();\r\n      await page.waitForTimeout(200);\r\n\r\n      await page.keyboard.press('Shift+?');\r\n      await page.waitForTimeout(500);\r\n\r\n      // Look for the keyboard shortcuts panel\r\n      const shortcutsPanel = page.locator('text=Keyboard Shortcuts');\r\n      const visible = await shortcutsPanel.isVisible().catch(() => false);\r\n      // Should show the panel (or toggle it)\r\n      expect(visible).toBeDefined();\r\n\r\n      // Press again to close\r\n      await page.keyboard.press('Shift+?');\r\n      await page.waitForTimeout(300);\r\n    });\r\n  });\r\n\r\n  //  History Panel \r\n\r\n  test.describe('History Panel', () => {\r\n    test('49. history toggle  opens history panel', async ({ page }) => {\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n\r\n      const historyBtn = studio.historyToggle;\r\n      if (await historyBtn.isVisible()) {\r\n        await historyBtn.click();\r\n        await page.waitForTimeout(500);\r\n\r\n        // History panel or items should appear\r\n        expect(await studio.isVisible()).toBe(true);\r\n      }\r\n    });\r\n\r\n    test('50. history items clickable', async ({ page }) => {\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n\r\n      const historyBtn = studio.historyToggle;\r\n      if (await historyBtn.isVisible()) {\r\n        await historyBtn.click();\r\n        await page.waitForTimeout(1000);\r\n\r\n        const historyCount = await studio.historyItems.count().catch(() => 0);\r\n        if (historyCount > 0) {\r\n          await studio.historyItems.first().click();\r\n          await page.waitForTimeout(500);\r\n          // Should load the history item  state may change to result\r\n          expect(await studio.isVisible()).toBe(true);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  //  Responsive Layout \r\n\r\n  test.describe('Responsive Layout', () => {\r\n    test('51. studio renders on mobile viewport', async ({ page }) => {\r\n      await page.setViewportSize({ width: 375, height: 667 });\r\n      await gotoWithAuth(page, '/');\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('52. studio renders on tablet viewport', async ({ page }) => {\r\n      await page.setViewportSize({ width: 768, height: 1024 });\r\n      await gotoWithAuth(page, '/');\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('53. inspector panel hidden on mobile', async ({ page }) => {\r\n      await page.setViewportSize({ width: 375, height: 667 });\r\n      await gotoWithAuth(page, '/');\r\n\r\n      // Inspector panel has class \"hidden lg:block\"  should not be visible on mobile\r\n      const inspectorDesktop = page.locator('.hidden.lg\\\\:block .sticky.top-24').first();\r\n      const visible = await inspectorDesktop.isVisible().catch(() => false);\r\n      expect(visible).toBe(false);\r\n    });\r\n\r\n    test('54. studio renders on full desktop viewport', async ({ page }) => {\r\n      await page.setViewportSize({ width: 1920, height: 1080 });\r\n      await gotoWithAuth(page, '/');\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n  });\r\n\r\n  //  Error Handling \r\n\r\n  test.describe('Error Handling', () => {\r\n    test('55. handles API error on generation gracefully', async ({ page }) => {\r\n      // Intercept transform API to return error\r\n      await page.route('**/api/transform', (route) => {\r\n        route.fulfill({\r\n          status: 500,\r\n          contentType: 'application/json',\r\n          body: JSON.stringify({ error: 'Internal server error' }),\r\n        });\r\n      });\r\n\r\n      await gotoWithAuth(page, '/');\r\n      await studio.waitForProductsLoaded();\r\n      const productCount = await studio.productCards.count();\r\n      test.skip(productCount === 0, 'No products available');\r\n\r\n      await studio.selectProduct(0);\r\n      await studio.enterQuickStartPrompt('Error test prompt');\r\n      await studio.generateNowButton.click();\r\n\r\n      await page.waitForTimeout(5000);\r\n\r\n      // Page should still be functional (no crash)\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('56. handles products API failure', async ({ page }) => {\r\n      await page.route('**/api/products', (route) => {\r\n        route.fulfill({\r\n          status: 500,\r\n          contentType: 'application/json',\r\n          body: JSON.stringify({ error: 'Products service unavailable' }),\r\n        });\r\n      });\r\n\r\n      await gotoWithAuth(page, '/');\r\n      await page.waitForTimeout(2000);\r\n\r\n      // Page should still load without crashing\r\n      expect(await studio.isVisible()).toBe(true);\r\n    });\r\n\r\n    test('57. no console errors on initial load', async ({ page }) => {\r\n      const consoleErrors: string[] = [];\r\n      page.on('console', (msg) => {\r\n        if (msg.type() === 'error') {\r\n          consoleErrors.push(msg.text());\r\n        }\r\n      });\r\n\r\n      await gotoWithAuth(page, '/');\r\n      await page.waitForTimeout(3000);\r\n\r\n      // Filter known non-critical errors\r\n      const criticalErrors = consoleErrors.filter(\r\n        (err) =>\r\n          !err.includes('favicon') &&\r\n          !err.includes('404') &&\r\n          !err.includes('401') &&\r\n          !err.includes('net::ERR') &&\r\n          !err.includes('Failed to load resource') &&\r\n          !err.includes('ResizeObserver'),\r\n      );\r\n\r\n      expect(criticalErrors).toHaveLength(0);\r\n    });\r\n  });\r\n\r\n  //  API Endpoints \r\n\r\n  test.describe('Studio API Endpoints', () => {\r\n    test('58. GET /api/products returns products array', async ({ request }) => {\r\n      const response = await request.get('/api/products');\r\n      expect(response.ok()).toBeTruthy();\r\n\r\n      const data = await response.json();\r\n      expect(Array.isArray(data) || Array.isArray(data.products)).toBeTruthy();\r\n    });\r\n\r\n    test('59. GET /api/templates returns templates', async ({ request }) => {\r\n      const response = await request.get('/api/templates');\r\n      expect(response.ok()).toBeTruthy();\r\n\r\n      const data = await response.json();\r\n      expect(data).toHaveProperty('templates');\r\n    });\r\n\r\n    test('60. GET /api/generations returns history', async ({ request }) => {\r\n      const response = await request.get('/api/generations?limit=5');\r\n      expect(response.ok()).toBeTruthy();\r\n\r\n      const data = await response.json();\r\n      expect(Array.isArray(data)).toBeTruthy();\r\n    });\r\n\r\n    test('61. POST /api/idea-bank/suggest handles request', async ({ request }) => {\r\n      const response = await request.post('/api/idea-bank/suggest', {\r\n        data: {\r\n          productIds: [],\r\n          maxSuggestions: 3,\r\n        },\r\n      });\r\n\r\n      // Should not crash (may return error for empty products)\r\n      expect(response.status()).toBeLessThan(500);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\generation-scenarios.spec.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":69,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":69,"endColumn":18,"suggestions":[{"fix":{"range":[2324,2392],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\annotate-screenshot.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\consoleMonitor.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"use\" is called in function \"consoleMonitor\" that is neither a React function component nor a custom React Hook function. React component names must start with an uppercase letter. React Hook names must start with the word \"use\".","line":203,"column":11,"nodeType":"Identifier","endLine":203,"endColumn":14,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\ensureAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\test-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\helpers\\viewport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-cross-page-flows.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-error-recovery.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-first-time-user.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-gallery.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-library-tabs.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-mobile.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-pipeline-tabs.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-power-user.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\journey-settings.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\learn-from-winners.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\linkedin-preview.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\login.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\monitoring-production.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\monitoring.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6957,6960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6957,6960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13526,13529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13526,13529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\r\n\r\n/**\r\n * E2E tests for Production Monitoring Infrastructure\r\n * Tests all 4 monitoring endpoints and UI tabs\r\n */\r\n\r\ntest.describe('Monitoring API Endpoints', () => {\r\n  test.use({ storageState: 'e2e/.auth/user.json' });\r\n\r\n  test('GET /api/monitoring/health - returns system health status', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/health');\r\n\r\n    expect(response.ok()).toBeTruthy();\r\n    const data = await response.json();\r\n\r\n    // Verify response structure\r\n    expect(data).toHaveProperty('overall');\r\n    expect(data).toHaveProperty('timestamp');\r\n    expect(data).toHaveProperty('services');\r\n\r\n    // Verify overall status is valid\r\n    expect(['healthy', 'degraded', 'unhealthy']).toContain(data.overall);\r\n\r\n    // Verify database health\r\n    expect(data.services).toHaveProperty('database');\r\n    expect(data.services.database).toHaveProperty('status');\r\n    expect(data.services.database).toHaveProperty('totalConnections');\r\n    expect(data.services.database).toHaveProperty('idleConnections');\r\n    expect(data.services.database).toHaveProperty('activeConnections');\r\n    expect(data.services.database).toHaveProperty('averageQueryTime');\r\n\r\n    // Verify Redis health\r\n    expect(data.services).toHaveProperty('redis');\r\n    expect(data.services.redis).toHaveProperty('status');\r\n    expect(data.services.redis).toHaveProperty('connected');\r\n  });\r\n\r\n  test('GET /api/monitoring/performance - returns endpoint metrics', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/performance');\r\n\r\n    expect(response.ok()).toBeTruthy();\r\n    const data = await response.json();\r\n\r\n    // Verify it's an array\r\n    expect(Array.isArray(data)).toBeTruthy();\r\n\r\n    // If there are metrics, verify structure\r\n    if (data.length > 0) {\r\n      const metric = data[0];\r\n      expect(metric).toHaveProperty('endpoint');\r\n      expect(metric).toHaveProperty('method');\r\n      expect(metric).toHaveProperty('requests');\r\n      expect(metric).toHaveProperty('errors');\r\n      expect(metric).toHaveProperty('errorRate');\r\n      expect(metric).toHaveProperty('avgLatency');\r\n      expect(metric).toHaveProperty('minLatency');\r\n      expect(metric).toHaveProperty('maxLatency');\r\n      expect(metric).toHaveProperty('lastReset');\r\n\r\n      // Verify data types\r\n      expect(typeof metric.endpoint).toBe('string');\r\n      expect(typeof metric.method).toBe('string');\r\n      expect(typeof metric.requests).toBe('number');\r\n      expect(typeof metric.errors).toBe('number');\r\n      expect(typeof metric.errorRate).toBe('number');\r\n      expect(typeof metric.avgLatency).toBe('number');\r\n    }\r\n  });\r\n\r\n  test('GET /api/monitoring/errors - returns error tracking data', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/errors');\r\n\r\n    expect(response.ok()).toBeTruthy();\r\n    const data = await response.json();\r\n\r\n    // Verify response structure\r\n    expect(data).toHaveProperty('errors');\r\n    expect(data).toHaveProperty('stats');\r\n\r\n    // Verify errors array\r\n    expect(Array.isArray(data.errors)).toBeTruthy();\r\n\r\n    // Verify stats structure\r\n    expect(data.stats).toHaveProperty('total');\r\n    expect(data.stats).toHaveProperty('last5min');\r\n    expect(data.stats).toHaveProperty('last1hour');\r\n    expect(data.stats).toHaveProperty('byStatusCode');\r\n    expect(data.stats).toHaveProperty('byEndpoint');\r\n    expect(data.stats).toHaveProperty('byFingerprint');\r\n\r\n    // If there are errors, verify structure\r\n    if (data.errors.length > 0) {\r\n      const error = data.errors[0];\r\n      expect(error).toHaveProperty('timestamp');\r\n      expect(error).toHaveProperty('statusCode');\r\n      expect(error).toHaveProperty('method');\r\n      expect(error).toHaveProperty('endpoint');\r\n      expect(error).toHaveProperty('message');\r\n      expect(error).toHaveProperty('fingerprint');\r\n    }\r\n  });\r\n\r\n  test('GET /api/monitoring/system - returns full system health', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/system');\r\n\r\n    expect(response.ok()).toBeTruthy();\r\n    const data = await response.json();\r\n\r\n    // Verify overall status\r\n    expect(data).toHaveProperty('status');\r\n    expect(['healthy', 'degraded', 'unhealthy']).toContain(data.status);\r\n\r\n    // Verify timestamp\r\n    expect(data).toHaveProperty('timestamp');\r\n    expect(new Date(data.timestamp).getTime()).toBeGreaterThan(0);\r\n\r\n    // Verify services\r\n    expect(data).toHaveProperty('services');\r\n    expect(data.services).toHaveProperty('database');\r\n    expect(data.services).toHaveProperty('redis');\r\n\r\n    // Verify performance metrics\r\n    expect(data).toHaveProperty('performance');\r\n    expect(data.performance).toHaveProperty('totalRequests');\r\n    expect(data.performance).toHaveProperty('totalErrors');\r\n    expect(data.performance).toHaveProperty('avgResponseTime');\r\n    expect(data.performance).toHaveProperty('topEndpoints');\r\n\r\n    // Verify error tracking\r\n    expect(data).toHaveProperty('errors');\r\n    expect(data.errors).toHaveProperty('total');\r\n    expect(data.errors).toHaveProperty('recent');\r\n  });\r\n\r\n  test('Monitoring endpoints require authentication', async ({ browser }) => {\r\n    // Create a new context without auth (no storageState)\r\n    const context = await browser.newContext();\r\n    const page = await context.newPage();\r\n\r\n    const endpoints = [\r\n      '/api/monitoring/health',\r\n      '/api/monitoring/performance',\r\n      '/api/monitoring/errors',\r\n      '/api/monitoring/system',\r\n    ];\r\n\r\n    for (const endpoint of endpoints) {\r\n      const response = await page.goto(endpoint);\r\n      // Should redirect to login (200 with HTML) or return error\r\n      expect(response?.status()).toBeDefined();\r\n      // If we get JSON, we're authenticated (bad); if we get HTML/redirect, we're not (good)\r\n      const contentType = response?.headers()['content-type'] || '';\r\n      const isJson = contentType.includes('application/json');\r\n\r\n      if (isJson) {\r\n        // If we get JSON, it means we bypassed auth - this should NOT happen\r\n        const url = response?.url() || '';\r\n        // Unless it's the health endpoint which might be public\r\n        if (!endpoint.includes('/health')) {\r\n          throw new Error(`Endpoint ${endpoint} returned JSON without auth: ${url}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    await context.close();\r\n  });\r\n\r\n  test('Performance metrics track request latency', async ({ request }) => {\r\n    // Make a request to generate metrics\r\n    await request.get('/api/health');\r\n\r\n    // Wait a moment for metrics to be recorded\r\n    await new Promise(resolve => setTimeout(resolve, 100));\r\n\r\n    // Check if metrics were recorded\r\n    const response = await request.get('/api/monitoring/performance');\r\n    expect(response.ok()).toBeTruthy();\r\n\r\n    const data = await response.json();\r\n    const healthMetric = data.find((m: any) => m.endpoint === '/api/health');\r\n\r\n    // Should have recorded the health check\r\n    if (healthMetric) {\r\n      expect(healthMetric.requests).toBeGreaterThan(0);\r\n      expect(healthMetric.avgLatency).toBeGreaterThan(0);\r\n    }\r\n  });\r\n\r\n  test('Database health reflects connection pool status', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/health');\r\n    const data = await response.json();\r\n\r\n    const db = data.services.database;\r\n\r\n    // Verify pool metrics are realistic\r\n    expect(db.totalConnections).toBeGreaterThanOrEqual(0);\r\n    expect(db.idleConnections).toBeGreaterThanOrEqual(0);\r\n    expect(db.activeConnections).toBeGreaterThanOrEqual(0);\r\n    expect(db.totalConnections).toBe(db.idleConnections + db.activeConnections);\r\n\r\n    // Verify query time is measured\r\n    expect(db.averageQueryTime).toBeGreaterThanOrEqual(0);\r\n\r\n    // Verify status logic\r\n    if (db.averageQueryTime > 500) {\r\n      expect(db.status).toBe('unhealthy');\r\n    } else if (db.averageQueryTime > 100) {\r\n      expect(db.status).toBe('degraded');\r\n    } else {\r\n      expect(db.status).toBe('healthy');\r\n    }\r\n  });\r\n});\r\n\r\ntest.describe('Monitoring UI Dashboard', () => {\r\n  test.use({ storageState: 'e2e/.auth/user.json' });\r\n\r\n  test('Quota Dashboard shows monitoring tabs', async ({ page }) => {\r\n    // First ensure we're authenticated by checking /api/auth/me\r\n    const authResponse = await page.request.get('/api/auth/me');\r\n    if (!authResponse.ok()) {\r\n      // If not authenticated, get demo session first\r\n      await page.request.get('/api/auth/demo');\r\n    }\r\n\r\n    await page.goto('/usage');\r\n\r\n    // Wait for page to load (the page title is in the component)\r\n    await page.waitForSelector('text=Monitoring Dashboard', { timeout: 15000 });\r\n\r\n    // Verify all monitoring tabs are present (use role selector to avoid ambiguity)\r\n    await expect(page.getByRole('tab', { name: /API Quota/i })).toBeVisible();\r\n    await expect(page.getByRole('tab', { name: /System Health/i })).toBeVisible();\r\n    await expect(page.getByRole('tab', { name: /Performance/i })).toBeVisible();\r\n    await expect(page.getByRole('tab', { name: /Errors/i })).toBeVisible();\r\n  });\r\n\r\n  test('System Health tab displays service status', async ({ page }) => {\r\n    // Ensure authenticated\r\n    const authResponse = await page.request.get('/api/auth/me');\r\n    if (!authResponse.ok()) {\r\n      await page.request.get('/api/auth/demo');\r\n    }\r\n\r\n    await page.goto('/usage');\r\n    await page.waitForSelector('text=Monitoring Dashboard', { timeout: 15000 });\r\n\r\n    // Click System Health tab\r\n    await page.getByRole('tab', { name: /System Health/i }).click();\r\n\r\n    // Wait for content to load\r\n    await page.waitForSelector('text=/Database.*PostgreSQL/i', { timeout: 10000 });\r\n\r\n    // Verify database section exists\r\n    await expect(page.locator('text=/Database/i')).toBeVisible();\r\n\r\n    // Verify Redis section exists\r\n    await expect(page.locator('text=/Redis/i')).toBeVisible();\r\n\r\n    // Verify status indicators (should show healthy/degraded/unhealthy)\r\n    const statusElements = await page.locator('[class*=\"status\"]').count();\r\n    expect(statusElements).toBeGreaterThan(0);\r\n  });\r\n\r\n  test('Performance tab shows endpoint metrics', async ({ page }) => {\r\n    // Ensure authenticated\r\n    const authResponse = await page.request.get('/api/auth/me');\r\n    if (!authResponse.ok()) {\r\n      await page.request.get('/api/auth/demo');\r\n    }\r\n\r\n    await page.goto('/usage');\r\n    await page.waitForSelector('text=Monitoring Dashboard', { timeout: 15000 });\r\n\r\n    // Click Performance tab\r\n    await page.getByRole('tab', { name: /Performance/i }).click();\r\n\r\n    // Wait for metrics to load\r\n    await page.waitForTimeout(1000);\r\n\r\n    // Verify table or metrics display\r\n    const hasMetrics = await page.locator('text=/requests|latency|endpoint/i').count() > 0;\r\n    expect(hasMetrics).toBeTruthy();\r\n  });\r\n\r\n  test('Error Tracking tab displays error statistics', async ({ page }) => {\r\n    // Ensure authenticated\r\n    const authResponse = await page.request.get('/api/auth/me');\r\n    if (!authResponse.ok()) {\r\n      await page.request.get('/api/auth/demo');\r\n    }\r\n\r\n    await page.goto('/usage');\r\n    await page.waitForSelector('text=Monitoring Dashboard', { timeout: 15000 });\r\n\r\n    // Click Errors tab\r\n    await page.getByRole('tab', { name: /Errors/i }).click();\r\n\r\n    // Wait for content to load\r\n    await page.waitForTimeout(1000);\r\n\r\n    // Verify stats section\r\n    const hasStats = await page.locator('text=/total|errors|last/i').count() > 0;\r\n    expect(hasStats).toBeTruthy();\r\n  });\r\n\r\n  test('Monitoring data refreshes on tab switch', async ({ page }) => {\r\n    // Ensure authenticated\r\n    const authResponse = await page.request.get('/api/auth/me');\r\n    if (!authResponse.ok()) {\r\n      await page.request.get('/api/auth/demo');\r\n    }\r\n\r\n    await page.goto('/usage');\r\n\r\n    // Wait for dashboard to load\r\n    await page.waitForSelector('text=Monitoring Dashboard', { timeout: 15000 });\r\n\r\n    // Switch between tabs\r\n    await page.getByRole('tab', { name: /System Health/i }).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    await page.getByRole('tab', { name: /Performance/i }).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    await page.getByRole('tab', { name: /Errors/i }).click();\r\n    await page.waitForTimeout(500);\r\n\r\n    // Each tab should have loaded without errors\r\n    const errors = await page.locator('text=/error loading|failed to fetch/i').count();\r\n    expect(errors).toBe(0);\r\n  });\r\n});\r\n\r\ntest.describe('Monitoring Edge Cases', () => {\r\n  test.use({ storageState: 'e2e/.auth/user.json' });\r\n\r\n  test('Health endpoint handles database degradation gracefully', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/health');\r\n    const data = await response.json();\r\n\r\n    // Even if database is degraded, endpoint should still respond\r\n    expect(response.status()).toBe(200);\r\n    expect(data.overall).toBeDefined();\r\n  });\r\n\r\n  test('Performance metrics handle high request volume', async ({ request }) => {\r\n    // Make multiple requests rapidly\r\n    const requests = Array.from({ length: 10 }, () => request.get('/api/health'));\r\n    await Promise.all(requests);\r\n\r\n    // Verify metrics endpoint still responds\r\n    const metricsResponse = await request.get('/api/monitoring/performance');\r\n    expect(metricsResponse.ok()).toBeTruthy();\r\n\r\n    const data = await metricsResponse.json();\r\n    const healthMetrics = data.find((m: any) => m.endpoint === '/api/health');\r\n\r\n    // Should have counted all requests\r\n    if (healthMetrics) {\r\n      expect(healthMetrics.requests).toBeGreaterThanOrEqual(10);\r\n    }\r\n  });\r\n\r\n  test('Error tracking captures errors correctly', async ({ request }) => {\r\n    // Try to access a non-existent endpoint (should generate 404)\r\n    await request.get('/api/monitoring/nonexistent');\r\n\r\n    // Wait for error to be tracked\r\n    await new Promise(resolve => setTimeout(resolve, 200));\r\n\r\n    // Check error tracking\r\n    const response = await request.get('/api/monitoring/errors');\r\n    const data = await response.json();\r\n\r\n    // Stats should reflect the error\r\n    expect(data.stats.total).toBeGreaterThanOrEqual(0);\r\n  });\r\n\r\n  test('System health aggregation combines all metrics', async ({ request }) => {\r\n    const response = await request.get('/api/monitoring/system');\r\n    const data = await response.json();\r\n\r\n    // Verify aggregation logic\r\n    const hasUnhealthyService =\r\n      data.services.database.status === 'unhealthy' ||\r\n      data.services.redis.status === 'unhealthy';\r\n\r\n    const hasDegradedService =\r\n      data.services.database.status === 'degraded' ||\r\n      data.services.redis.status === 'degraded';\r\n\r\n    // Overall status should reflect worst service status\r\n    if (hasUnhealthyService) {\r\n      expect(data.status).toBe('unhealthy');\r\n    } else if (hasDegradedService) {\r\n      expect(data.status).toBe('degraded');\r\n    } else {\r\n      expect(data.status).toBe('healthy');\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\carousel-builder.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\content-planner.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\gallery.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\global-chat.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\learn-from-winners.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\library.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\login.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\not-found.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\onboarding.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\pipeline.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\product-library.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\settings.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\studio-ux.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\studio-workflow.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\pages\\studio.page.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\phase-8.1-full-app.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8710,8713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8710,8713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8740,8743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8740,8743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13029,13032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13029,13032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13128,13131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13128,13131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":395,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13668,13671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13668,13671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":503,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":503,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17230,17233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17230,17233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":631,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":631,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21098,21101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21098,21101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":346,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":346,"endColumn":16,"suggestions":[{"fix":{"range":[11887,11943],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":355,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":355,"endColumn":16,"suggestions":[{"fix":{"range":[12242,12300],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":364,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":364,"endColumn":16,"suggestions":[{"fix":{"range":[12589,12643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":399,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":399,"endColumn":16,"suggestions":[{"fix":{"range":[13777,13828],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":427,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":427,"endColumn":16,"suggestions":[{"fix":{"range":[14590,14659],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":460,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":460,"endColumn":16,"suggestions":[{"fix":{"range":[15638,15733],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":465,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":465,"endColumn":18,"suggestions":[{"fix":{"range":[15929,15999],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":493,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":493,"endColumn":16,"suggestions":[{"fix":{"range":[16854,16930],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":518,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":518,"endColumn":18,"suggestions":[{"fix":{"range":[17603,17654],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":535,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":535,"endColumn":16,"suggestions":[{"fix":{"range":[18150,18205],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":555,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":555,"endColumn":16,"suggestions":[{"fix":{"range":[18748,18824],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":594,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":594,"endColumn":16,"suggestions":[{"fix":{"range":[19922,19977],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":596,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":596,"endColumn":18,"suggestions":[{"fix":{"range":[20020,20064],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":621,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":621,"endColumn":16,"suggestions":[{"fix":{"range":[20716,20761],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\nimport { test, expect, Page } from '@playwright/test';\n\n/**\n * E2E Tests for Phase 8.1: Full Product Content Studio Application\n *\n * Tests cover:\n * 1. Authentication & Session Management\n * 2. Studio Page (Image Generation, Copy Generation, Preview)\n * 3. Library Page (Product Library, Brand Images, Templates)\n * 4. Social Accounts Page (n8n Integration, Account Management)\n * 5. Settings Page (API Keys, Brand Profile, n8n Config)\n * 6. Navigation (Between Pages, Performance)\n * 7. Phase 8.1 Performance Optimizations (Compression, Cache Headers, Fast Navigation)\n *\n * Production URL: https://automated-ads-agent-production.up.railway.app\n */\n\nconst PRODUCTION_URL = 'https://automated-ads-agent-production.up.railway.app';\n\n// Helper function to measure navigation performance\nasync function _measureNavigationTime(page: Page, targetUrl: string): Promise<number> {\n  const startTime = Date.now();\n  await page.goto(targetUrl);\n  await page.waitForLoadState('networkidle');\n  return Date.now() - startTime;\n}\n\ntest.describe('Phase 8.1: Authentication & Session', () => {\n  test('should load login page without errors', async ({ page }) => {\n    const consoleErrors: string[] = [];\n    page.on('console', (msg) => {\n      if (msg.type() === 'error' && !msg.text().includes('favicon') && !msg.text().includes('404')) {\n        consoleErrors.push(msg.text());\n      }\n    });\n\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Should either be logged in (Studio) or see login form\n    const studioHeading = page.locator('h1').first();\n    const isVisible = await studioHeading.isVisible();\n    expect(isVisible).toBe(true);\n\n    // No critical console errors\n    expect(consoleErrors.length).toBe(0);\n  });\n\n  test('should maintain session across page reloads', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // If logged in, verify user menu exists\n    const userMenu = page.locator('[data-testid=\"user-menu\"]');\n    const hasUserMenu = await userMenu.count() > 0;\n\n    if (hasUserMenu) {\n      // Reload the page\n      await page.reload();\n      await page.waitForLoadState('networkidle');\n\n      // User menu should still exist (session persisted)\n      await expect(userMenu).toBeVisible();\n    }\n  });\n});\n\ntest.describe('Phase 8.1: Studio Page - Core Functionality', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n  });\n\n  test('should display product selection grid', async ({ page }) => {\n    // Wait for products to load\n    await page.waitForTimeout(1500);\n\n    // Products should be displayed in grid\n    const productCards = page.locator('[data-testid=\"product-card\"]');\n    const count = await productCards.count();\n\n    // Should have at least 1 product\n    expect(count).toBeGreaterThan(0);\n  });\n\n  test('should allow product selection', async ({ page }) => {\n    await page.waitForTimeout(1500);\n\n    const firstProduct = page.locator('[data-testid=\"product-card\"]').first();\n    if (await firstProduct.isVisible()) {\n      await firstProduct.click();\n      await page.waitForTimeout(500);\n\n      // Product should be selected (visual feedback)\n      const isSelected = await firstProduct.evaluate((el) => {\n        return el.classList.contains('ring-2') || el.classList.contains('border-primary');\n      });\n\n      expect(isSelected).toBe(true);\n    }\n  });\n\n  test('should display idea bank suggestions', async ({ page }) => {\n    await page.waitForTimeout(1500);\n\n    // Select a product first\n    const firstProduct = page.locator('[data-testid=\"product-card\"]').first();\n    if (await firstProduct.isVisible()) {\n      await firstProduct.click();\n      await page.waitForTimeout(1000);\n\n      // Idea bank panel should appear\n      const ideaBankPanel = page.locator('[data-testid=\"idea-bank-panel\"]');\n      if (await ideaBankPanel.isVisible()) {\n        await expect(ideaBankPanel).toBeVisible();\n\n        // Should show suggestions\n        const suggestions = page.locator('[data-testid=\"idea-suggestion\"]');\n        const suggestionsCount = await suggestions.count();\n        expect(suggestionsCount).toBeGreaterThan(0);\n      }\n    }\n  });\n\n  test('should have image generation functionality', async ({ page }) => {\n    // Check for \"Generate\" or \"Generate Image\" button\n    const generateButton = page.locator('button:has-text(\"Generate\")').first();\n\n    if (await generateButton.isVisible()) {\n      await expect(generateButton).toBeVisible();\n\n      // Button should be enabled or disabled based on state\n      const _isDisabled = await generateButton.isDisabled();\n      // We just verify the button exists, not necessarily enabled\n    }\n  });\n\n  test('should have copy generation functionality', async ({ page }) => {\n    // Check for copy generation controls\n    const copySection = page.locator('text=Copy Generation');\n\n    // If copy generation exists, verify controls\n    if (await copySection.isVisible()) {\n      await expect(copySection).toBeVisible();\n    }\n  });\n\n  test('should display action buttons (Edit, Copy, Preview)', async ({ page }) => {\n    // Action buttons should exist for generated content\n    const editButton = page.locator('button:has-text(\"Edit\")');\n    const copyButton = page.locator('button:has-text(\"Copy\")');\n    const previewButton = page.locator('button:has-text(\"Preview\")');\n\n    // Count how many action buttons exist\n    const editCount = await editButton.count();\n    const copyCount = await copyButton.count();\n    const previewCount = await previewButton.count();\n\n    // At least one type of action button should exist\n    expect(editCount + copyCount + previewCount).toBeGreaterThan(0);\n  });\n});\n\ntest.describe('Phase 8.1: Library Page', () => {\n  test('should navigate to Library page', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Click Library in navigation\n    const libraryLink = page.locator('a[href=\"/library\"]');\n    await libraryLink.click();\n    await page.waitForLoadState('networkidle');\n\n    // Verify we're on Library page\n    await expect(page).toHaveURL(/\\/library/);\n\n    // Library heading should be visible\n    const libraryHeading = page.locator('h1:has-text(\"Library\")');\n    await expect(libraryHeading).toBeVisible();\n  });\n\n  test('should display product library', async ({ page }) => {\n    await page.goto('/library');\n    await page.waitForLoadState('networkidle');\n    await page.waitForTimeout(1000);\n\n    // Products should be displayed\n    const products = page.locator('[data-testid=\"library-product\"]');\n    const count = await products.count();\n\n    // Should have at least 1 product\n    expect(count).toBeGreaterThan(0);\n  });\n\n  test('should have brand images section', async ({ page }) => {\n    await page.goto('/library');\n    await page.waitForLoadState('networkidle');\n\n    // Check for Brand Images navigation or section\n    const brandImagesSection = page.locator('text=Brand Images');\n    if (await brandImagesSection.isVisible()) {\n      await expect(brandImagesSection).toBeVisible();\n    }\n  });\n\n  test('should have templates section', async ({ page }) => {\n    await page.goto('/library');\n    await page.waitForLoadState('networkidle');\n\n    // Check for Templates navigation or section\n    const templatesSection = page.locator('text=Templates');\n    if (await templatesSection.isVisible()) {\n      await expect(templatesSection).toBeVisible();\n    }\n  });\n});\n\ntest.describe('Phase 8.1: Social Accounts Page', () => {\n  test('should navigate to Social Accounts page', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Click Social Accounts in navigation\n    const socialAccountsLink = page.locator('a[href=\"/social-accounts\"]');\n    await socialAccountsLink.click();\n    await page.waitForLoadState('networkidle');\n\n    // Verify we're on Social Accounts page\n    await expect(page).toHaveURL(/\\/social-accounts/);\n  });\n\n  test('should display social accounts page without 500 error', async ({ page }) => {\n    await page.goto('/social-accounts');\n    await page.waitForLoadState('networkidle');\n\n    // Page should load successfully (no 500 error)\n    const pageError = page.locator('text=500');\n    const has500Error = await pageError.isVisible();\n    expect(has500Error).toBe(false);\n\n    // Should show social accounts UI\n    const socialAccountsHeading = page.locator('h1:has-text(\"Social Accounts\")');\n    await expect(socialAccountsHeading).toBeVisible();\n  });\n\n  test('should fetch /api/social/accounts successfully', async ({ page }) => {\n    let apiResponse: any = null;\n    let apiError: any = null;\n\n    // Listen for API response\n    page.on('response', async (response) => {\n      if (response.url().includes('/api/social/accounts')) {\n        apiResponse = response;\n        if (!response.ok()) {\n          apiError = await response.text();\n        }\n      }\n    });\n\n    await page.goto('/social-accounts');\n    await page.waitForLoadState('networkidle');\n    await page.waitForTimeout(1000);\n\n    // API should return 200 OK (not 500)\n    if (apiResponse) {\n      expect(apiResponse.status()).toBe(200);\n      expect(apiError).toBe(null);\n    }\n  });\n\n  test('should display empty state or account list', async ({ page }) => {\n    await page.goto('/social-accounts');\n    await page.waitForLoadState('networkidle');\n\n    // Should either show accounts or empty state\n    const accountsList = page.locator('[data-testid=\"social-accounts-list\"]');\n    const emptyState = page.locator('text=No social accounts connected');\n\n    const hasAccounts = await accountsList.isVisible();\n    const hasEmptyState = await emptyState.isVisible();\n\n    // At least one should be visible\n    expect(hasAccounts || hasEmptyState).toBe(true);\n  });\n});\n\ntest.describe('Phase 8.1: Settings Page', () => {\n  test('should navigate to Settings page', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Click Settings in navigation\n    const settingsLink = page.locator('a[href=\"/settings\"]');\n    await settingsLink.click();\n    await page.waitForLoadState('networkidle');\n\n    // Verify we're on Settings page\n    await expect(page).toHaveURL(/\\/settings/);\n  });\n\n  test('should display settings sections', async ({ page }) => {\n    await page.goto('/settings');\n    await page.waitForLoadState('networkidle');\n\n    // Settings heading should be visible\n    const settingsHeading = page.locator('h1:has-text(\"Settings\")');\n    await expect(settingsHeading).toBeVisible();\n\n    // Should have API Keys section\n    const apiKeysSection = page.locator('text=API Keys');\n    if (await apiKeysSection.isVisible()) {\n      await expect(apiKeysSection).toBeVisible();\n    }\n\n    // Should have Brand Profile section\n    const brandProfileSection = page.locator('text=Brand Profile');\n    if (await brandProfileSection.isVisible()) {\n      await expect(brandProfileSection).toBeVisible();\n    }\n  });\n\n  test('should have n8n configuration section', async ({ page }) => {\n    await page.goto('/settings');\n    await page.waitForLoadState('networkidle');\n\n    // Check for n8n configuration\n    const n8nSection = page.locator('text=n8n');\n    if (await n8nSection.isVisible()) {\n      await expect(n8nSection).toBeVisible();\n    }\n  });\n});\n\ntest.describe('Phase 8.1: Navigation Performance', () => {\n  test('should navigate between pages quickly (< 2 seconds)', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Measure navigation to Library\n    const libraryStartTime = Date.now();\n    await page.locator('a[href=\"/library\"]').click();\n    await page.waitForLoadState('networkidle');\n    const libraryLoadTime = Date.now() - libraryStartTime;\n\n    console.log(`Library navigation: ${libraryLoadTime}ms`);\n    expect(libraryLoadTime).toBeLessThan(2000);\n\n    // Measure navigation to Settings\n    const settingsStartTime = Date.now();\n    await page.locator('a[href=\"/settings\"]').click();\n    await page.waitForLoadState('networkidle');\n    const settingsLoadTime = Date.now() - settingsStartTime;\n\n    console.log(`Settings navigation: ${settingsLoadTime}ms`);\n    expect(settingsLoadTime).toBeLessThan(2000);\n\n    // Measure navigation back to Studio\n    const studioStartTime = Date.now();\n    await page.locator('a[href=\"/\"]').click();\n    await page.waitForLoadState('networkidle');\n    const studioLoadTime = Date.now() - studioStartTime;\n\n    console.log(`Studio navigation: ${studioLoadTime}ms`);\n    expect(studioLoadTime).toBeLessThan(2000);\n  });\n\n  test('Header should not re-render unnecessarily during navigation', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Add marker to track re-renders\n    await page.evaluate(() => {\n      const header = document.querySelector('header');\n      if (header) {\n        (header as any).__renderCount = 0;\n        const observer = new MutationObserver(() => {\n          (header as any).__renderCount++;\n        });\n        observer.observe(header, { childList: true, subtree: true });\n      }\n    });\n\n    // Navigate to Library\n    await page.locator('a[href=\"/library\"]').click();\n    await page.waitForLoadState('networkidle');\n\n    // Navigate to Settings\n    await page.locator('a[href=\"/settings\"]').click();\n    await page.waitForLoadState('networkidle');\n\n    // Check render count\n    const renderCount = await page.evaluate(() => {\n      const header = document.querySelector('header');\n      return (header as any).__renderCount || 0;\n    });\n\n    // Header should re-render minimally (< 5 times for 2 navigations)\n    console.log(`Header render count: ${renderCount}`);\n    expect(renderCount).toBeLessThan(5);\n  });\n});\n\ntest.describe('Phase 8.1: Performance Optimizations - Compression', () => {\n  test('should serve compressed assets (gzip or brotli)', async ({ page }) => {\n    let compressedAssets = 0;\n    let totalAssets = 0;\n\n    // Listen for responses\n    page.on('response', async (response) => {\n      const url = response.url();\n\n      // Check JS/CSS assets\n      if (url.endsWith('.js') || url.endsWith('.css')) {\n        totalAssets++;\n\n        const contentEncoding = response.headers()['content-encoding'];\n        if (contentEncoding === 'gzip' || contentEncoding === 'br') {\n          compressedAssets++;\n        }\n      }\n    });\n\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    console.log(`Compressed assets: ${compressedAssets}/${totalAssets}`);\n\n    // At least 80% of assets should be compressed\n    if (totalAssets > 0) {\n      const compressionRate = compressedAssets / totalAssets;\n      expect(compressionRate).toBeGreaterThan(0.8);\n    }\n  });\n\n  test('should reduce bundle size by ~65% with compression', async ({ page }) => {\n    let uncompressedSize = 0;\n    let compressedSize = 0;\n\n    page.on('response', async (response) => {\n      const url = response.url();\n\n      if (url.includes('index') && url.endsWith('.js')) {\n        const contentLength = response.headers()['content-length'];\n        const contentEncoding = response.headers()['content-encoding'];\n\n        if (contentLength) {\n          if (contentEncoding === 'gzip' || contentEncoding === 'br') {\n            compressedSize += parseInt(contentLength);\n          } else {\n            uncompressedSize += parseInt(contentLength);\n          }\n        }\n      }\n    });\n\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    console.log(`Bundle sizes - Uncompressed: ${uncompressedSize}, Compressed: ${compressedSize}`);\n\n    // If we have compressed size, it should be significantly smaller\n    if (compressedSize > 0) {\n      const reductionRate = 1 - (compressedSize / (compressedSize + uncompressedSize));\n      console.log(`Compression rate: ${(reductionRate * 100).toFixed(1)}%`);\n      expect(reductionRate).toBeGreaterThan(0.5); // At least 50% reduction\n    }\n  });\n});\n\ntest.describe('Phase 8.1: Performance Optimizations - Cache Headers', () => {\n  test('should have immutable cache headers on static assets', async ({ page }) => {\n    let assetsWithCache = 0;\n    let totalAssets = 0;\n\n    page.on('response', async (response) => {\n      const url = response.url();\n\n      // Check JS/CSS assets with content hash\n      if ((url.includes('assets/') && url.endsWith('.js')) || url.endsWith('.css')) {\n        totalAssets++;\n\n        const cacheControl = response.headers()['cache-control'];\n        if (cacheControl && (cacheControl.includes('immutable') || cacheControl.includes('max-age'))) {\n          assetsWithCache++;\n        }\n      }\n    });\n\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    console.log(`Assets with cache headers: ${assetsWithCache}/${totalAssets}`);\n\n    // All hashed assets should have cache headers\n    if (totalAssets > 0) {\n      const cacheRate = assetsWithCache / totalAssets;\n      expect(cacheRate).toBe(1.0); // 100% of assets should be cached\n    }\n  });\n\n  test('should NOT cache HTML files', async ({ page }) => {\n    let htmlResponse: any = null;\n\n    page.on('response', async (response) => {\n      const url = response.url();\n\n      if (url.endsWith('/') || url.endsWith('.html')) {\n        htmlResponse = response;\n      }\n    });\n\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    if (htmlResponse) {\n      const cacheControl = htmlResponse.headers()['cache-control'];\n      console.log(`HTML cache-control: ${cacheControl}`);\n\n      // HTML should have no-cache or no cache header\n      expect(cacheControl).toContain('no-cache');\n    }\n  });\n\n  test('should enable fast repeat visits with cached assets', async ({ page }) => {\n    // First visit\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    // Second visit (should be faster due to cache)\n    const startTime = Date.now();\n    await page.goto('/', { waitUntil: 'networkidle' });\n    const repeatVisitTime = Date.now() - startTime;\n\n    console.log(`Repeat visit time: ${repeatVisitTime}ms`);\n\n    // Repeat visit should be very fast (< 1 second)\n    expect(repeatVisitTime).toBeLessThan(1000);\n  });\n});\n\ntest.describe('Phase 8.1: Performance Optimizations - Overall Page Performance', () => {\n  test('should load Studio page within 3 seconds', async ({ page }) => {\n    const startTime = Date.now();\n\n    await page.goto('/');\n    await page.waitForLoadState('domcontentloaded');\n\n    const domLoadTime = Date.now() - startTime;\n\n    await page.waitForLoadState('networkidle');\n\n    const fullLoadTime = Date.now() - startTime;\n\n    console.log(`Performance - DOM: ${domLoadTime}ms, Full: ${fullLoadTime}ms`);\n\n    // DOM should load very quickly\n    expect(domLoadTime).toBeLessThan(1500);\n\n    // Full load should complete within 3 seconds\n    expect(fullLoadTime).toBeLessThan(3000);\n  });\n\n  test('should have no console errors during normal usage', async ({ page }) => {\n    const consoleErrors: string[] = [];\n\n    page.on('console', (msg) => {\n      if (msg.type() === 'error') {\n        const text = msg.text();\n        // Filter out known non-critical errors\n        if (!text.includes('favicon') &&\n            !text.includes('404') &&\n            !text.includes('401') &&\n            !text.includes('net::ERR') &&\n            !text.includes('Failed to load resource')) {\n          consoleErrors.push(text);\n        }\n      }\n    });\n\n    // Navigate through app\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n\n    await page.goto('/library');\n    await page.waitForLoadState('networkidle');\n\n    await page.goto('/social-accounts');\n    await page.waitForLoadState('networkidle');\n\n    await page.goto('/settings');\n    await page.waitForLoadState('networkidle');\n\n    console.log(`Console errors: ${consoleErrors.length}`);\n    if (consoleErrors.length > 0) {\n      console.log('Errors found:', consoleErrors);\n    }\n\n    expect(consoleErrors.length).toBe(0);\n  });\n\n  test('should have fast Time to Interactive (TTI)', async ({ page }) => {\n    await page.goto('/');\n\n    // Measure time until page is interactive\n    const tti = await page.evaluate(() => {\n      return new Promise<number>((resolve) => {\n        const startTime = performance.now();\n\n        // Wait for page to be interactive\n        if (document.readyState === 'complete') {\n          resolve(performance.now() - startTime);\n        } else {\n          window.addEventListener('load', () => {\n            resolve(performance.now() - startTime);\n          });\n        }\n      });\n    });\n\n    console.log(`Time to Interactive: ${tti}ms`);\n\n    // TTI should be under 2 seconds\n    expect(tti).toBeLessThan(2000);\n  });\n});\n\ntest.describe('Phase 8.1: Database Migration - Social Connections', () => {\n  test('should have social_connections table created', async ({ page }) => {\n    // This test verifies the migration was applied by checking API response\n    let apiResponse: any = null;\n\n    page.on('response', async (response) => {\n      if (response.url().includes('/api/social/accounts')) {\n        apiResponse = response;\n      }\n    });\n\n    await page.goto('/social-accounts');\n    await page.waitForLoadState('networkidle');\n    await page.waitForTimeout(1000);\n\n    // API should return 200 OK with valid JSON (not 500 error)\n    if (apiResponse) {\n      expect(apiResponse.status()).toBe(200);\n\n      const data = await apiResponse.json();\n      expect(data).toHaveProperty('accounts');\n      expect(Array.isArray(data.accounts)).toBe(true);\n    }\n  });\n});\n\n// Production-specific tests\ntest.describe('Phase 8.1: Production Validation', () => {\n  test.skip(({ }, testInfo) => !testInfo.project.name.includes('production'), 'Production only');\n\n  test('should load production site with all Phase 8.1 optimizations', async ({ page }) => {\n    await page.goto(PRODUCTION_URL);\n    await page.waitForLoadState('networkidle');\n\n    // Verify page loads\n    await expect(page).toHaveTitle(/Product Content Studio|Automated Ads/i);\n\n    // Verify no 500 errors\n    const errorPage = page.locator('text=500');\n    const has500Error = await errorPage.isVisible();\n    expect(has500Error).toBe(false);\n\n    // Verify compression is enabled\n    let hasCompression = false;\n    page.on('response', async (response) => {\n      const contentEncoding = response.headers()['content-encoding'];\n      if (contentEncoding === 'gzip' || contentEncoding === 'br') {\n        hasCompression = true;\n      }\n    });\n\n    await page.goto(PRODUCTION_URL);\n    await page.waitForLoadState('networkidle');\n\n    expect(hasCompression).toBe(true);\n\n    // Take production screenshot\n    await page.screenshot({\n      path: 'e2e/screenshots/production-phase-8.1.png',\n      fullPage: true,\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\phase3-routes.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\product-library-flow.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\studio-features.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\studio-flow.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\e2e\\visual-verification.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\knip.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\checkBrand.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":8,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":8,"endColumn":16,"suggestions":[{"fix":{"range":[241,295],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":10,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":10,"endColumn":20,"suggestions":[{"fix":{"range":[337,399],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":11,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":11,"endColumn":20,"suggestions":[{"fix":{"range":[409,464],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\migrate-api-keys.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[859,862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[859,862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":17,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":17,"endColumn":14,"suggestions":[{"fix":{"range":[390,444],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[490,529],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":34,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":34,"endColumn":18,"suggestions":[{"fix":{"range":[1006,1057],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":48,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":48,"endColumn":18,"suggestions":[{"fix":{"range":[1551,1600],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":18,"suggestions":[{"fix":{"range":[1905,1958],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":59,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":59,"endColumn":18,"suggestions":[{"fix":{"range":[1980,2046],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":64,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":64,"endColumn":18,"suggestions":[{"fix":{"range":[2170,2217],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":81,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":81,"endColumn":18,"suggestions":[{"fix":{"range":[2917,2962],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":90,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":90,"endColumn":18,"suggestions":[{"fix":{"range":[3259,3308],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":92,"endColumn":18,"suggestions":[{"fix":{"range":[3330,3392],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":95,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":95,"endColumn":16,"suggestions":[{"fix":{"range":[3407,3460],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport pg from \"pg\";\r\n\r\nconst { Client } = pg;\r\n\r\nasync function migrateApiKeysTables() {\r\n  const databaseUrl = process.env.DATABASE_URL;\r\n\r\n  if (!databaseUrl) {\r\n    console.error(\"DATABASE_URL environment variable is required\");\r\n    process.exit(1);\r\n  }\r\n\r\n  const client = new Client({ connectionString: databaseUrl });\r\n\r\n  console.log(\"Starting API Keys table migration...\\n\");\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log(\"Connected to database\\n\");\r\n\r\n    // Check if tables already exist\r\n    const existingTablesResult = await client.query(`\r\n      SELECT table_name FROM information_schema.tables\r\n      WHERE table_schema = 'public'\r\n      AND table_name IN ('user_api_keys', 'api_key_audit_log')\r\n    `);\r\n\r\n    const existingTableNames = existingTablesResult.rows.map((r: any) => r.table_name);\r\n\r\n    // Create api_key_audit_log table if not exists\r\n    if (!existingTableNames.includes('api_key_audit_log')) {\r\n      console.log(\"Creating api_key_audit_log table...\");\r\n      await client.query(`\r\n        CREATE TABLE \"api_key_audit_log\" (\r\n          \"id\" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n          \"user_id\" varchar NOT NULL,\r\n          \"service\" varchar(50) NOT NULL,\r\n          \"action\" varchar(20) NOT NULL,\r\n          \"ip_address\" varchar(45),\r\n          \"user_agent\" text,\r\n          \"success\" boolean NOT NULL,\r\n          \"error_message\" text,\r\n          \"created_at\" timestamp DEFAULT now() NOT NULL\r\n        )\r\n      `);\r\n      console.log(\" api_key_audit_log table created\");\r\n\r\n      // Add foreign key constraint\r\n      await client.query(`\r\n        ALTER TABLE \"api_key_audit_log\"\r\n        ADD CONSTRAINT \"api_key_audit_log_user_id_users_id_fk\"\r\n        FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n        ON DELETE cascade ON UPDATE no action\r\n      `);\r\n      console.log(\" api_key_audit_log foreign key added\");\r\n    } else {\r\n      console.log(\" api_key_audit_log table already exists, skipping\");\r\n    }\r\n\r\n    // Create user_api_keys table if not exists\r\n    if (!existingTableNames.includes('user_api_keys')) {\r\n      console.log(\"Creating user_api_keys table...\");\r\n      await client.query(`\r\n        CREATE TABLE \"user_api_keys\" (\r\n          \"id\" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n          \"user_id\" varchar NOT NULL,\r\n          \"service\" varchar(50) NOT NULL,\r\n          \"encrypted_key\" text NOT NULL,\r\n          \"iv\" text NOT NULL,\r\n          \"auth_tag\" text NOT NULL,\r\n          \"key_preview\" varchar(20),\r\n          \"is_valid\" boolean DEFAULT true NOT NULL,\r\n          \"last_validated_at\" timestamp,\r\n          \"created_at\" timestamp DEFAULT now() NOT NULL,\r\n          \"updated_at\" timestamp DEFAULT now() NOT NULL,\r\n          CONSTRAINT \"user_api_keys_user_id_service_unique\" UNIQUE(\"user_id\",\"service\")\r\n        )\r\n      `);\r\n      console.log(\" user_api_keys table created\");\r\n\r\n      // Add foreign key constraint\r\n      await client.query(`\r\n        ALTER TABLE \"user_api_keys\"\r\n        ADD CONSTRAINT \"user_api_keys_user_id_users_id_fk\"\r\n        FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"users\"(\"id\")\r\n        ON DELETE cascade ON UPDATE no action\r\n      `);\r\n      console.log(\" user_api_keys foreign key added\");\r\n    } else {\r\n      console.log(\" user_api_keys table already exists, skipping\");\r\n    }\r\n\r\n    console.log(\"\\n Migration completed successfully!\");\r\n  } catch (error) {\r\n    console.error(\"\\n Migration failed:\", error);\r\n    process.exit(1);\r\n  } finally {\r\n    await client.end();\r\n  }\r\n}\r\n\r\nmigrateApiKeysTables();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\run-migration.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":12,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":12,"endColumn":14,"suggestions":[{"fix":{"range":[287,333],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":25,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":25,"endColumn":16,"suggestions":[{"fix":{"range":[676,735],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":27,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":27,"endColumn":16,"suggestions":[{"fix":{"range":[831,873],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":30,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":30,"endColumn":16,"suggestions":[{"fix":{"range":[910,951],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":74,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":74,"endColumn":16,"suggestions":[{"fix":{"range":[2278,2317],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":77,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":77,"endColumn":16,"suggestions":[{"fix":{"range":[2348,2383],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":82,"endColumn":16,"suggestions":[{"fix":{"range":[2810,2843],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":85,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":85,"endColumn":16,"suggestions":[{"fix":{"range":[2890,2930],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":93,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":93,"endColumn":16,"suggestions":[{"fix":{"range":[3879,3911],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":95,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":95,"endColumn":16,"suggestions":[{"fix":{"range":[3919,3972],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\runEnrichment.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'runEnrichmentForPendingProducts' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":34,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"runEnrichmentForPendingProducts"},"fix":{"range":[685,721],"text":""},"desc":"Remove unused variable \"runEnrichmentForPendingProducts\"."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":65,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":65,"endColumn":14,"suggestions":[{"fix":{"range":[1777,2469],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":92,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":92,"endColumn":14,"suggestions":[{"fix":{"range":[2668,2716],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":93,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":93,"endColumn":14,"suggestions":[{"fix":{"range":[2720,2770],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":99,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":99,"endColumn":16,"suggestions":[{"fix":{"range":[2921,2980],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":110,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":110,"endColumn":16,"suggestions":[{"fix":{"range":[3249,3318],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":115,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":115,"endColumn":18,"suggestions":[{"fix":{"range":[3511,3546],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":116,"endColumn":18,"suggestions":[{"fix":{"range":[3554,3591],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":117,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":117,"endColumn":18,"suggestions":[{"fix":{"range":[3599,3680],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":118,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":118,"endColumn":18,"suggestions":[{"fix":{"range":[3688,3704],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":121,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":121,"endColumn":16,"suggestions":[{"fix":{"range":[3719,3783],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":129,"endColumn":16,"suggestions":[{"fix":{"range":[3962,4026],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":143,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":143,"endColumn":14,"suggestions":[{"fix":{"range":[4333,4446],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":165,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":165,"endColumn":14,"suggestions":[{"fix":{"range":[4885,4949],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":168,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":168,"endColumn":16,"suggestions":[{"fix":{"range":[4991,5045],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":181,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":181,"endColumn":16,"suggestions":[{"fix":{"range":[5391,5458],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":194,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":194,"endColumn":18,"suggestions":[{"fix":{"range":[5768,5812],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":197,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":197,"endColumn":20,"suggestions":[{"fix":{"range":[5891,5961],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":200,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":200,"endColumn":18,"suggestions":[{"fix":{"range":[5999,6032],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":203,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":203,"endColumn":16,"suggestions":[{"fix":{"range":[6047,6063],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":221,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":221,"endColumn":14,"suggestions":[{"fix":{"range":[6551,6579],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":224,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":224,"endColumn":16,"suggestions":[{"fix":{"range":[6612,6653],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":226,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":226,"endColumn":16,"suggestions":[{"fix":{"range":[6671,6708],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":228,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":228,"endColumn":18,"suggestions":[{"fix":{"range":[6741,6781],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":234,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":234,"endColumn":14,"suggestions":[{"fix":{"range":[6834,6880],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":235,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":235,"endColumn":14,"suggestions":[{"fix":{"range":[6884,6939],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":236,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":236,"endColumn":14,"suggestions":[{"fix":{"range":[6943,6997],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":237,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":237,"endColumn":14,"suggestions":[{"fix":{"range":[7001,7074],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":240,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":240,"endColumn":16,"suggestions":[{"fix":{"range":[7122,7152],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":242,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":242,"endColumn":18,"suggestions":[{"fix":{"range":[7212,7245],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":247,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":247,"endColumn":16,"suggestions":[{"fix":{"range":[7283,7317],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":250,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":250,"endColumn":16,"suggestions":[{"fix":{"range":[7340,7382],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":253,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":253,"endColumn":18,"suggestions":[{"fix":{"range":[7475,7536],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":257,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":257,"endColumn":16,"suggestions":[{"fix":{"range":[7566,7606],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":260,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":260,"endColumn":18,"suggestions":[{"fix":{"range":[7699,7774],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":264,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":264,"endColumn":16,"suggestions":[{"fix":{"range":[7804,7848],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":266,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":266,"endColumn":16,"suggestions":[{"fix":{"range":[7890,7972],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":269,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":269,"endColumn":20,"suggestions":[{"fix":{"range":[8065,8111],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":274,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":274,"endColumn":16,"suggestions":[{"fix":{"range":[8150,8198],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":276,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":276,"endColumn":16,"suggestions":[{"fix":{"range":[8240,8289],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":277,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":277,"endColumn":16,"suggestions":[{"fix":{"range":[8295,8348],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":278,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":278,"endColumn":16,"suggestions":[{"fix":{"range":[8354,8478],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":281,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":281,"endColumn":16,"suggestions":[{"fix":{"range":[8507,8541],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":282,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":282,"endColumn":16,"suggestions":[{"fix":{"range":[8547,8632],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":283,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":283,"endColumn":16,"suggestions":[{"fix":{"range":[8638,8735],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":286,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":286,"endColumn":14,"suggestions":[{"fix":{"range":[8746,8788],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":293,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":293,"endColumn":14,"suggestions":[{"fix":{"range":[8902,8937],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":294,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":294,"endColumn":14,"suggestions":[{"fix":{"range":[8941,8978],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":295,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":295,"endColumn":14,"suggestions":[{"fix":{"range":[8982,9017],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":314,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":314,"endColumn":14,"suggestions":[{"fix":{"range":[9453,9493],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":315,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":315,"endColumn":14,"suggestions":[{"fix":{"range":[9497,9581],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":316,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":316,"endColumn":14,"suggestions":[{"fix":{"range":[9585,9618],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":317,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":317,"endColumn":14,"suggestions":[{"fix":{"range":[9622,9667],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":318,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":318,"endColumn":14,"suggestions":[{"fix":{"range":[9671,9687],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":319,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":319,"endColumn":14,"suggestions":[{"fix":{"range":[9691,9721],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":320,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":320,"endColumn":14,"suggestions":[{"fix":{"range":[9725,9771],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":321,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":321,"endColumn":14,"suggestions":[{"fix":{"range":[9775,9823],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":322,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":322,"endColumn":14,"suggestions":[{"fix":{"range":[9827,9872],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":323,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":323,"endColumn":14,"suggestions":[{"fix":{"range":[9876,9892],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":336,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":336,"endColumn":16,"suggestions":[{"fix":{"range":[10145,10185],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env npx tsx\r\n/* eslint-disable no-console */\r\n/**\r\n * Product Enrichment CLI Runner\r\n *\r\n * Usage:\r\n *   npx tsx scripts/runEnrichment.ts                    # Enrich all pending products\r\n *   npx tsx scripts/runEnrichment.ts --product <id>     # Enrich specific product\r\n *   npx tsx scripts/runEnrichment.ts --all              # Force re-enrich all products\r\n *   npx tsx scripts/runEnrichment.ts --dry-run          # Show what would be enriched\r\n *\r\n * Environment:\r\n *   DATABASE_URL        - PostgreSQL connection string\r\n *   GOOGLE_API_KEY      - Gemini API key for AI operations\r\n */\r\n\r\nimport { storage } from \"../server/storage\";\r\nimport {\r\n  runEnrichmentPipeline,\r\n  runEnrichmentForPendingProducts,\r\n  type EnrichmentOutput,\r\n  type ConfidenceLevel,\r\n} from \"../server/services/enrichment\";\r\n\r\n// ============================================\r\n// CLI ARGUMENTS\r\n// ============================================\r\n\r\ninterface CliArgs {\r\n  productId?: string;\r\n  all: boolean;\r\n  dryRun: boolean;\r\n  verbose: boolean;\r\n}\r\n\r\nfunction parseArgs(): CliArgs {\r\n  const args = process.argv.slice(2);\r\n  const result: CliArgs = {\r\n    all: false,\r\n    dryRun: false,\r\n    verbose: false,\r\n  };\r\n\r\n  for (let i = 0; i < args.length; i++) {\r\n    const arg = args[i];\r\n\r\n    if (arg === \"--product\" || arg === \"-p\") {\r\n      result.productId = args[++i];\r\n    } else if (arg === \"--all\" || arg === \"-a\") {\r\n      result.all = true;\r\n    } else if (arg === \"--dry-run\" || arg === \"-d\") {\r\n      result.dryRun = true;\r\n    } else if (arg === \"--verbose\" || arg === \"-v\") {\r\n      result.verbose = true;\r\n    } else if (arg === \"--help\" || arg === \"-h\") {\r\n      printHelp();\r\n      process.exit(0);\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction printHelp(): void {\r\n  console.log(`\r\nProduct Enrichment Pipeline\r\n\r\nUsage:\r\n  npx tsx scripts/runEnrichment.ts [options]\r\n\r\nOptions:\r\n  --product, -p <id>   Enrich a specific product by ID\r\n  --all, -a            Force re-enrich all products (including already enriched)\r\n  --dry-run, -d        Show what would be enriched without making changes\r\n  --verbose, -v        Show detailed progress and gate results\r\n  --help, -h           Show this help message\r\n\r\nExamples:\r\n  npx tsx scripts/runEnrichment.ts                    # Enrich pending products\r\n  npx tsx scripts/runEnrichment.ts -p abc123          # Enrich specific product\r\n  npx tsx scripts/runEnrichment.ts --all --dry-run    # Preview all products\r\n`);\r\n}\r\n\r\n// ============================================\r\n// MAIN EXECUTION\r\n// ============================================\r\n\r\nasync function main(): Promise<void> {\r\n  const args = parseArgs();\r\n\r\n  console.log(\"\\n Product Enrichment Pipeline\");\r\n  console.log(\"================================\\n\");\r\n\r\n  // ============================================\r\n  // DRY RUN MODE\r\n  // ============================================\r\n  if (args.dryRun) {\r\n    console.log(\" DRY RUN MODE - No changes will be made\\n\");\r\n\r\n    const products = await storage.getProducts();\r\n    const needsEnrichment = products.filter(p =>\r\n      args.all ||\r\n      !p.description ||\r\n      p.description.length < 20 ||\r\n      p.enrichmentStatus === \"pending\" ||\r\n      !p.enrichmentStatus\r\n    );\r\n\r\n    console.log(`Found ${needsEnrichment.length} products to enrich:\\n`);\r\n\r\n    for (const product of needsEnrichment) {\r\n      const status = product.enrichmentStatus || \"none\";\r\n      const hasDesc = product.description && product.description.length > 20;\r\n      console.log(`  - ${product.name}`);\r\n      console.log(`    ID: ${product.id}`);\r\n      console.log(`    Status: ${status}, Has Description: ${hasDesc ? \"Yes\" : \"No\"}`);\r\n      console.log(\"\");\r\n    }\r\n\r\n    console.log(\"\\nRun without --dry-run to execute enrichment.\\n\");\r\n    return;\r\n  }\r\n\r\n  // ============================================\r\n  // SINGLE PRODUCT MODE\r\n  // ============================================\r\n  if (args.productId) {\r\n    console.log(` Enriching single product: ${args.productId}\\n`);\r\n\r\n    const result = await runEnrichmentPipeline({\r\n      productId: args.productId,\r\n      forceRefresh: true,\r\n    });\r\n\r\n    printResult(result, args.verbose);\r\n    return;\r\n  }\r\n\r\n  // ============================================\r\n  // BATCH MODE\r\n  // ============================================\r\n  console.log(args.all\r\n    ? \" Re-enriching ALL products...\\n\"\r\n    : \" Enriching pending products...\\n\"\r\n  );\r\n\r\n  let productIds: string[];\r\n\r\n  if (args.all) {\r\n    const products = await storage.getProducts();\r\n    productIds = products.map(p => p.id);\r\n  } else {\r\n    const products = await storage.getProducts();\r\n    productIds = products\r\n      .filter(p =>\r\n        !p.description ||\r\n        p.description.length < 20 ||\r\n        p.enrichmentStatus === \"pending\" ||\r\n        !p.enrichmentStatus\r\n      )\r\n      .map(p => p.id);\r\n  }\r\n\r\n  console.log(`Found ${productIds.length} products to process\\n`);\r\n\r\n  if (productIds.length === 0) {\r\n    console.log(\" All products are already enriched!\\n\");\r\n    return;\r\n  }\r\n\r\n  // Process each product\r\n  const results: Map<string, EnrichmentOutput> = new Map();\r\n  const startTime = Date.now();\r\n\r\n  for (let i = 0; i < productIds.length; i++) {\r\n    const productId = productIds[i];\r\n    const product = await storage.getProductById(productId);\r\n    const name = product?.name || productId;\r\n\r\n    console.log(`[${i + 1}/${productIds.length}] Processing: ${name}`);\r\n\r\n    try {\r\n      const result = await runEnrichmentPipeline({\r\n        productId,\r\n        forceRefresh: args.all,\r\n      });\r\n\r\n      results.set(productId, result);\r\n\r\n      // Print brief result\r\n      const icon = result.success ? \"\" : \"\";\r\n      const conf = result.report.overallConfidence;\r\n      console.log(`  ${icon} ${conf} confidence`);\r\n\r\n      if (args.verbose && result.report.adaptations.length > 0) {\r\n        console.log(`  Adaptations: ${result.report.adaptations.join(\", \")}`);\r\n      }\r\n    } catch (err) {\r\n      console.log(`   Error: ${err}`);\r\n    }\r\n\r\n    console.log(\"\");\r\n\r\n    // Small delay between products\r\n    await delay(500);\r\n  }\r\n\r\n  // ============================================\r\n  // SUMMARY\r\n  // ============================================\r\n  const duration = Math.round((Date.now() - startTime) / 1000);\r\n  printSummary(results, duration);\r\n}\r\n\r\n// ============================================\r\n// OUTPUT HELPERS\r\n// ============================================\r\n\r\nfunction printResult(result: EnrichmentOutput, verbose: boolean): void {\r\n  console.log(\"\".repeat(50));\r\n\r\n  if (result.success) {\r\n    console.log(\" ENRICHMENT SUCCESSFUL\\n\");\r\n  } else {\r\n    console.log(\" ENRICHMENT FAILED\\n\");\r\n    if (result.error) {\r\n      console.log(`Error: ${result.error}\\n`);\r\n    }\r\n  }\r\n\r\n  const report = result.report;\r\n\r\n  console.log(`Product: ${report.productName}`);\r\n  console.log(`Confidence: ${report.overallConfidence}`);\r\n  console.log(`Sources Used: ${report.sources.length}`);\r\n  console.log(`All Gates Passed: ${report.allGatesPassed ? \"Yes\" : \"No\"}`);\r\n\r\n  if (report.adaptations.length > 0) {\r\n    console.log(`\\nAdaptations:`);\r\n    for (const adaptation of report.adaptations) {\r\n      console.log(`   ${adaptation}`);\r\n    }\r\n  }\r\n\r\n  if (verbose) {\r\n    console.log(\"\\n Gate Results:\");\r\n\r\n    // Gate 1\r\n    console.log(`\\n  Gate 1 (Source Match):`);\r\n    for (const g of report.gates.gate1) {\r\n      const icon = g.passed ? \"\" : \"\";\r\n      console.log(`    ${icon} ${g.sourceUrl} (${g.confidence}%)`);\r\n    }\r\n\r\n    // Gate 2\r\n    console.log(`\\n  Gate 2 (Extraction):`);\r\n    for (const g of report.gates.gate2) {\r\n      const icon = g.passed ? \"\" : \"\";\r\n      console.log(`    ${icon} ${g.sourceUrl} (${g.overallAccuracy}% accurate)`);\r\n    }\r\n\r\n    // Gate 3\r\n    console.log(`\\n  Gate 3 (Database Write):`);\r\n    const g3 = report.gates.gate3;\r\n    console.log(`    ${g3.passed ? \"\" : \"\"} Passed after ${g3.retryCount} retries`);\r\n    if (g3.discrepancies.length > 0) {\r\n      for (const d of g3.discrepancies) {\r\n        console.log(`      - ${d.field}: ${d.issue}`);\r\n      }\r\n    }\r\n\r\n    // Gate 4\r\n    console.log(`\\n  Gate 4 (Cross-Source Truth):`);\r\n    const g4 = report.gates.gate4;\r\n    console.log(`    Verdict: ${g4.overallVerdict}`);\r\n    console.log(`    Conflicts: ${g4.conflicts.length}`);\r\n    console.log(`    Claims Verified: ${g4.truthChecks.filter(t => t.verdict === \"VERIFIED\").length}/${g4.truthChecks.length}`);\r\n\r\n    // Data Written\r\n    console.log(\"\\n Data Written:\");\r\n    console.log(`  Description: ${report.dataWritten.description.substring(0, 100)}...`);\r\n    console.log(`  Specifications: ${Object.keys(report.dataWritten.specifications).length} fields`);\r\n  }\r\n\r\n  console.log(\"\\n\" + \"\".repeat(50) + \"\\n\");\r\n}\r\n\r\nfunction printSummary(\r\n  results: Map<string, EnrichmentOutput>,\r\n  durationSeconds: number\r\n): void {\r\n  console.log(\"\\n\" + \"\".repeat(50));\r\n  console.log(\" ENRICHMENT SUMMARY\");\r\n  console.log(\"\".repeat(50) + \"\\n\");\r\n\r\n  const total = results.size;\r\n  const successful = Array.from(results.values()).filter(r => r.success).length;\r\n  const failed = total - successful;\r\n\r\n  // Count by confidence\r\n  const byConfidence: Record<ConfidenceLevel, number> = {\r\n    HIGH: 0,\r\n    MEDIUM: 0,\r\n    LOW: 0,\r\n  };\r\n\r\n  for (const result of results.values()) {\r\n    if (result.success) {\r\n      byConfidence[result.report.overallConfidence]++;\r\n    }\r\n  }\r\n\r\n  console.log(`Total Products: ${total}`);\r\n  console.log(`Successful: ${successful} (${Math.round(successful / total * 100)}%)`);\r\n  console.log(`Failed: ${failed}`);\r\n  console.log(`Duration: ${durationSeconds}s`);\r\n  console.log(\"\");\r\n  console.log(\"By Confidence:\");\r\n  console.log(`  HIGH:   ${byConfidence.HIGH}`);\r\n  console.log(`  MEDIUM: ${byConfidence.MEDIUM}`);\r\n  console.log(`  LOW:    ${byConfidence.LOW}`);\r\n  console.log(\"\");\r\n}\r\n\r\nfunction delay(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n// ============================================\r\n// RUN\r\n// ============================================\r\n\r\nmain()\r\n  .then(() => {\r\n    console.log(\" Enrichment complete!\\n\");\r\n    process.exit(0);\r\n  })\r\n  .catch(err => {\r\n    console.error(\" Fatal error:\", err);\r\n    process.exit(1);\r\n  });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\seed-nds-templates.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":321,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":321,"endColumn":14,"suggestions":[{"fix":{"range":[15224,15290],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":348,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":348,"endColumn":18,"suggestions":[{"fix":{"range":[16268,16337],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":356,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":356,"endColumn":14,"suggestions":[{"fix":{"range":[16479,16508],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":357,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":357,"endColumn":14,"suggestions":[{"fix":{"range":[16512,16560],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":358,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":358,"endColumn":14,"suggestions":[{"fix":{"range":[16564,16600],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":359,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":359,"endColumn":14,"suggestions":[{"fix":{"range":[16604,16655],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":362,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":362,"endColumn":16,"suggestions":[{"fix":{"range":[16686,16742],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":364,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":364,"endColumn":16,"suggestions":[{"fix":{"range":[16760,16830],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\test-schema.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":18,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":18,"endColumn":16,"suggestions":[{"fix":{"range":[379,404],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":21,"endColumn":16,"suggestions":[{"fix":{"range":[437,462],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":26,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":26,"endColumn":12,"suggestions":[{"fix":{"range":[489,547],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":52,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":52,"endColumn":12,"suggestions":[{"fix":{"range":[1469,1532],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":104,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":104,"endColumn":12,"suggestions":[{"fix":{"range":[3091,3153],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":139,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":139,"endColumn":12,"suggestions":[{"fix":{"range":[4140,4193],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":188,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":188,"endColumn":12,"suggestions":[{"fix":{"range":[5720,5778],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":189,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":189,"endColumn":12,"suggestions":[{"fix":{"range":[5780,5839],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":190,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":190,"endColumn":12,"suggestions":[{"fix":{"range":[5841,5899],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\scripts\\testPricingEstimator.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":59,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":59,"endColumn":12,"suggestions":[{"fix":{"range":[1655,1705],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\apiKeyValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\attack-scenarios.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\auth.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\cacheService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\contentPlannerService.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":57,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"afterEach"},"fix":{"range":[334,345],"text":""},"desc":"Remove unused variable \"afterEach\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockGetProduct' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1515,1518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1515,1518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":745,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":745,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26809,26812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26809,26812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\contentSafetyService.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SafetyChecks' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":47,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SafetyChecks"},"fix":{"range":[784,803],"text":""},"desc":"Remove unused variable \"SafetyChecks\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\n\r\n// Use vi.hoisted to define mocks that will be available to vi.mock factories\r\nconst { mockGenerateContentWithRetry, mockStorage } = vi.hoisted(() => {\r\n  const mockGenerateContentWithRetry = vi.fn();\r\n  const mockStorage = {\r\n    getBrandProfileByUserId: vi.fn(),\r\n  };\r\n  return { mockGenerateContentWithRetry, mockStorage };\r\n});\r\n\r\n// Mock the Gemini client\r\nvi.mock('../lib/geminiClient', () => ({\r\n  generateContentWithRetry: mockGenerateContentWithRetry,\r\n}));\r\n\r\n// Mock storage\r\nvi.mock('../storage', () => ({\r\n  storage: mockStorage,\r\n}));\r\n\r\n// Import the service after mocks are set up\r\nimport { checkContentSafety, type SafetyChecks, type CheckSafetyParams } from '../services/contentSafetyService';\r\nimport type { BrandProfile } from '@shared/schema';\r\n\r\ndescribe('ContentSafetyService', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('checkContentSafety', () => {\r\n    it('should pass all safety checks for clean content', async () => {\r\n      // Mock Gemini API response (all safe)\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      // Mock brand profile (no prohibited words)\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Check out our amazing new steel products!',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result).toEqual({\r\n        hateSpeech: true,\r\n        violence: true,\r\n        sexualContent: true,\r\n        piiDetection: true,\r\n        prohibitedWords: [],\r\n        competitorMentions: [],\r\n        brandSafetyScore: 100,\r\n      });\r\n    });\r\n\r\n    it('should detect PII in content', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Contact me at john@example.com or 555-123-4567',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result.piiDetection).toBe(false);\r\n      expect(result.brandSafetyScore).toBe(50); // -50 for PII\r\n    });\r\n\r\n    it('should detect prohibited words from brand profile', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: ['cheap', 'discount'] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Get our cheap products at discount prices!',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result.prohibitedWords).toEqual(['cheap', 'discount']);\r\n      expect(result.brandSafetyScore).toBe(80); // -10 for each prohibited word\r\n    });\r\n\r\n    it('should detect competitor mentions', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'We are better than Nucor and U.S. Steel!',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result.competitorMentions).toEqual(['Nucor', 'U.S. Steel']);\r\n      expect(result.brandSafetyScore).toBe(60); // -20 for each competitor mention\r\n    });\r\n\r\n    it('should fail hate speech check from Gemini', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'HIGH' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'SAFETY',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Inappropriate content with hate speech',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result.hateSpeech).toBe(false);\r\n      expect(result.brandSafetyScore).toBe(0); // Critical failure\r\n    });\r\n\r\n    it('should handle Gemini API failure gracefully', async () => {\r\n      // Mock Gemini API error\r\n      mockGenerateContentWithRetry.mockRejectedValue(new Error('API rate limit'));\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Test content',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      // Fail-CLOSED: On Gemini failure, defaults to BLOCK (all flags false = unsafe)\r\n      // unless SAFETY_FAIL_OPEN=true in non-production\r\n      expect(result.hateSpeech).toBe(false);\r\n      expect(result.violence).toBe(false);\r\n      expect(result.sexualContent).toBe(false);\r\n      expect(result.brandSafetyScore).toBe(0);\r\n    });\r\n\r\n    it('should handle missing brand profile gracefully', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      // Mock missing brand profile\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue(undefined);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Test content with words that would be prohibited',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      // Should still work without brand profile\r\n      expect(result.prohibitedWords).toEqual([]);\r\n      expect(result.brandSafetyScore).toBe(100);\r\n    });\r\n\r\n    it('should detect multiple PII types', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: [] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Call 555-1234 or email test@example.com, SSN: 123-45-6789',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      expect(result.piiDetection).toBe(false);\r\n    });\r\n\r\n    it('should calculate correct score for multiple issues', async () => {\r\n      mockGenerateContentWithRetry.mockResolvedValue({\r\n        candidates: [\r\n          {\r\n            safetyRatings: [\r\n              { category: 'HARM_CATEGORY_HATE_SPEECH', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', probability: 'NEGLIGIBLE' },\r\n              { category: 'HARM_CATEGORY_HARASSMENT', probability: 'NEGLIGIBLE' },\r\n            ],\r\n            finishReason: 'STOP',\r\n          },\r\n        ],\r\n      });\r\n\r\n      mockStorage.getBrandProfileByUserId.mockResolvedValue({\r\n        id: 'brand-123',\r\n        userId: 'user-123',\r\n        voice: { wordsToAvoid: ['cheap', 'discount', 'sale'] },\r\n      } as BrandProfile);\r\n\r\n      const params: CheckSafetyParams = {\r\n        caption: 'Cheap sale! Better than Nucor. Contact: test@example.com',\r\n        userId: 'user-123',\r\n      };\r\n\r\n      const result = await checkContentSafety(params);\r\n\r\n      // -50 for PII, -20 for competitor, -20 for prohibited words (cheap, sale)\r\n      expect(result.brandSafetyScore).toBe(10);\r\n      expect(result.piiDetection).toBe(false);\r\n      expect(result.prohibitedWords.length).toBeGreaterThan(0);\r\n      expect(result.competitorMentions).toEqual(['Nucor']);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\copywriting.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1459,1462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1459,1462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { storage } from '../storage';\r\nimport type { GenerateCopyInput } from '../validation/schemas';\r\n\r\n// Counter for generating unique variations\r\nlet callCount = 0;\r\n\r\n// Helper to create mock response\r\nfunction createMockResponse(framework: string = 'AIDA', variationNum: number = 1) {\r\n  return {\r\n    candidates: [{\r\n      content: {\r\n        parts: [{\r\n          text: JSON.stringify({\r\n            headline: `Test Headline V${variationNum}`,\r\n            hook: `Test Hook for Your Product V${variationNum}`,\r\n            bodyText: `This is test body text that describes the product benefits. Variation ${variationNum}.`,\r\n            primaryText: `Primary text for TikTok V${variationNum}`, // For TikTok tests\r\n            cta: 'Shop Now',\r\n            caption: `Check out our amazing product! V${variationNum} #test #product`,\r\n            hashtags: ['#test', '#product', '#quality', '#deal'],\r\n            framework: framework,\r\n            qualityScore: {\r\n              clarity: 8,\r\n              persuasiveness: 7,\r\n              platformFit: 9,\r\n              brandAlignment: 8,\r\n              overallScore: 8,\r\n              reasoning: `Well-structured ${framework} copy with clear value proposition`\r\n            }\r\n          })\r\n        }]\r\n      }\r\n    }]\r\n  };\r\n}\r\n\r\n// Mock the genAI module with dynamic responses\r\nvi.mock('../lib/gemini', () => ({\r\n  genAI: {\r\n    models: {\r\n      generateContent: vi.fn().mockImplementation((opts: any) => {\r\n        callCount++;\r\n        // Extract framework from prompt if specified\r\n        const promptText = opts.contents?.[0]?.parts?.[0]?.text || '';\r\n        let framework = 'AIDA';\r\n        if (promptText.includes('PAS')) framework = 'PAS';\r\n        else if (promptText.includes('BAB')) framework = 'BAB';\r\n        else if (promptText.includes('FAB')) framework = 'FAB';\r\n\r\n        return Promise.resolve(createMockResponse(framework, callCount));\r\n      })\r\n    }\r\n  }\r\n}));\r\n\r\n// Get mock for assertions\r\nconst _mockGenerateContent = vi.mocked((await import('../lib/gemini')).genAI.models.generateContent);\r\n\r\ndescribe('Copywriting Service', () => {\r\n  let testGenerationId: string;\r\n  let _testUserId: string;\r\n\r\n  beforeEach(() => {\r\n    // Reset call count before each test\r\n    callCount = 0;\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  beforeAll(async () => {\r\n    // Create test user with hashed password\r\n    const testEmail = `copytest-${Date.now()}@test.com`;\r\n    const testPasswordHash = 'hashedpassword123'; // In real code, use bcrypt\r\n    const testUser = await storage.createUser(testEmail, testPasswordHash);\r\n    _testUserId = testUser.id;\r\n\r\n    // Create test generation\r\n    const testGeneration = await storage.saveGeneration({\r\n      prompt: 'Test product image',\r\n      originalImagePaths: ['test.jpg'],\r\n      generatedImagePath: 'generated.jpg',\r\n      resolution: '2K',\r\n      conversationHistory: null,\r\n      parentGenerationId: null,\r\n      editPrompt: null,\r\n    });\r\n    testGenerationId = testGeneration.id;\r\n  });\r\n\r\n  afterAll(async () => {\r\n    // Cleanup would go here\r\n  });\r\n\r\n  describe('Platform Character Limits', () => {\r\n    it('should enforce Instagram headline limit (40 chars)', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'casual',\r\n        productName: 'T12 Rebar',\r\n        productDescription: '12mm reinforcement bar for concrete foundations, BS 4449 compliant',\r\n        industry: 'Construction Steel Supply',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations).toHaveLength(1);\r\n      expect(variations[0].headline.length).toBeLessThanOrEqual(40);\r\n      expect(variations[0].hook.length).toBeLessThanOrEqual(60);\r\n    });\r\n\r\n    it('should enforce LinkedIn headline limit (150 chars)', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'linkedin',\r\n        tone: 'professional',\r\n        productName: 'Steel Mesh A393',\r\n        productDescription: 'Welded reinforcement mesh for structural slabs, 8mm wires at 200mm centers',\r\n        industry: 'Building Materials',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].headline.length).toBeLessThanOrEqual(150);\r\n    });\r\n\r\n    it('should enforce Facebook headline limit (27 chars)', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'facebook',\r\n        tone: 'professional',\r\n        productName: 'Spacer Wheels',\r\n        productDescription: 'Plastic spacers for precise rebar positioning, 25mm-75mm cover range',\r\n        industry: 'Construction Steel Supply',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].headline.length).toBeLessThanOrEqual(27);\r\n    });\r\n\r\n    it('should enforce Twitter headline limit (23 chars)', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'twitter',\r\n        tone: 'casual',\r\n        productName: 'Tie Wire Coils',\r\n        productDescription: 'Annealed wire for binding rebar, 1.6mm gauge, 2kg coils',\r\n        industry: 'Building Materials',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].headline.length).toBeLessThanOrEqual(23);\r\n    });\r\n\r\n    it('should enforce TikTok limits', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'tiktok',\r\n        tone: 'professional',\r\n        productName: 'Continuous High Chairs',\r\n        productDescription: 'Support spacers for mesh reinforcement, maintains consistent cover',\r\n        industry: 'Construction Steel Supply',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].headline.length).toBeLessThanOrEqual(40);\r\n      expect(variations[0].primaryText.length).toBeLessThanOrEqual(150);\r\n    });\r\n  });\r\n\r\n  describe('Copywriting Frameworks', () => {\r\n    it('should use AIDA framework when specified', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'professional',\r\n        productName: 'A252 Mesh Reinforcement',\r\n        productDescription: 'Structural mesh sheets for ground-bearing slabs, 7mm wires at 200mm centers',\r\n        industry: 'Building Materials',\r\n        framework: 'aida',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].framework).toBe('AIDA');\r\n      expect(variations[0].qualityScore).toBeDefined();\r\n      expect(variations[0].qualityScore.reasoning).toContain('AIDA');\r\n    });\r\n\r\n    it('should use PAS framework when specified', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'linkedin',\r\n        tone: 'professional',\r\n        productName: 'SecureVault',\r\n        productDescription: 'Enterprise-grade data security solution',\r\n        industry: 'Cybersecurity',\r\n        framework: 'pas',\r\n        campaignObjective: 'conversion',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].framework).toBe('PAS');\r\n    });\r\n\r\n    it('should use BAB framework when specified', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'facebook',\r\n        tone: 'casual',\r\n        productName: 'Concrete Cover Spacers',\r\n        productDescription: 'Plastic clip-on spacers for vertical and horizontal applications, UV stabilized',\r\n        industry: 'Building Materials',\r\n        framework: 'bab',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].framework).toBe('BAB');\r\n    });\r\n\r\n    it('should use FAB framework when specified', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'linkedin',\r\n        tone: 'professional',\r\n        productName: 'Rebar Couplers',\r\n        productDescription: 'Mechanical splice connections for continuous reinforcement, parallel thread system',\r\n        industry: 'Construction Steel Supply',\r\n        framework: 'fab',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].framework).toBe('FAB');\r\n    });\r\n\r\n    it('should auto-select framework based on campaign objective', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'casual',\r\n        productName: 'Waterproof Membrane',\r\n        productDescription: 'DPM for foundations, 1200 gauge polyethylene sheeting for moisture protection',\r\n        industry: 'Building Materials',\r\n        framework: 'auto',\r\n        campaignObjective: 'awareness',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(['AIDA', 'PAS', 'BAB', 'FAB']).toContain(variations[0].framework);\r\n      expect(variations[0].qualityScore.reasoning).toBeTruthy();\r\n    });\r\n  });\r\n\r\n  describe('Multi-Variation Generation', () => {\r\n    it('should generate 3 variations by default', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'casual',\r\n        productName: 'Screed Rails',\r\n        productDescription: 'K-Form leveling rails for precision floor screeding, adjustable height system',\r\n        industry: 'Construction Steel Supply',\r\n        variations: 3,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations).toHaveLength(3);\r\n\r\n      // Each variation should be unique\r\n      const headlines = variations.map(v => v.headline);\r\n      const uniqueHeadlines = new Set(headlines);\r\n      expect(uniqueHeadlines.size).toBe(3);\r\n    });\r\n\r\n    it('should generate correct number of variations (1-5)', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      for (let count = 1; count <= 5; count++) {\r\n        const request: GenerateCopyInput = {\r\n          generationId: testGenerationId,\r\n          platform: 'instagram',\r\n          tone: 'casual',\r\n          productName: 'TestProduct',\r\n          productDescription: 'Test product description',\r\n          industry: 'Test',\r\n          variations: count,\r\n        };\r\n\r\n        const variations = await copywritingService.generateCopy(request);\r\n        expect(variations).toHaveLength(count);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('Quality Scoring', () => {\r\n    it('should include quality scores for all variations', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'linkedin',\r\n        tone: 'professional',\r\n        productName: 'AnalyticsHub',\r\n        productDescription: 'Advanced analytics platform for data-driven decisions',\r\n        industry: 'Analytics',\r\n        variations: 2,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      variations.forEach(variation => {\r\n        expect(variation.qualityScore).toBeDefined();\r\n        expect(variation.qualityScore.clarity).toBeGreaterThanOrEqual(1);\r\n        expect(variation.qualityScore.clarity).toBeLessThanOrEqual(10);\r\n        expect(variation.qualityScore.persuasiveness).toBeGreaterThanOrEqual(1);\r\n        expect(variation.qualityScore.platformFit).toBeGreaterThanOrEqual(1);\r\n        expect(variation.qualityScore.brandAlignment).toBeGreaterThanOrEqual(1);\r\n        expect(variation.qualityScore.overallScore).toBeGreaterThanOrEqual(1);\r\n        expect(variation.qualityScore.reasoning).toBeTruthy();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Advanced Features', () => {\r\n    it('should incorporate target audience in copy', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'facebook',\r\n        tone: 'casual',\r\n        productName: 'Rebar Safety Caps',\r\n        productDescription: 'Protective end caps for exposed rebar, high-visibility orange, meets OSHA requirements',\r\n        industry: 'Construction Steel Supply',\r\n        targetAudience: {\r\n          demographics: 'Site managers, ages 30-55',\r\n          psychographics: 'Safety-focused, compliance-driven',\r\n          painPoints: ['Worker safety concerns', 'OSHA compliance requirements'],\r\n        },\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].bodyText.length).toBeGreaterThan(0);\r\n      expect(variations[0].hook.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should incorporate brand voice', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'linkedin',\r\n        tone: 'professional',\r\n        productName: 'EnterpriseSuite',\r\n        productDescription: 'Comprehensive enterprise management platform',\r\n        industry: 'Enterprise Software',\r\n        brandVoice: {\r\n          principles: ['Innovative', 'Trustworthy', 'Results-driven'],\r\n          wordsToAvoid: ['cheap', 'easy', 'simple'],\r\n          wordsToUse: ['premium', 'powerful', 'enterprise-grade'],\r\n        },\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      const fullCopy = `${variations[0].headline} ${variations[0].bodyText} ${variations[0].caption}`.toLowerCase();\r\n\r\n      // Should avoid banned words\r\n      expect(fullCopy).not.toContain('cheap');\r\n\r\n      expect(variations[0].qualityScore.brandAlignment).toBeGreaterThan(5);\r\n    });\r\n\r\n    it('should incorporate social proof', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'professional',\r\n        productName: 'Tying Tools',\r\n        productDescription: 'Rebar binding hand tools for fast wire installation, ergonomic grip design',\r\n        industry: 'Building Materials',\r\n        socialProof: {\r\n          testimonial: 'Reduced our tying time by 40% on the last project - J. Smith, Site Foreman',\r\n          stats: '5000+ contractors, trusted by major UK builders',\r\n        },\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].bodyText.length).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should include product benefits when provided', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'facebook',\r\n        tone: 'professional',\r\n        productName: 'TaskMaster Pro',\r\n        productDescription: 'Advanced project management tool',\r\n        industry: 'Productivity',\r\n        productBenefits: [\r\n          'Increase team productivity by 40%',\r\n          'Automated workflow management',\r\n          'Real-time collaboration',\r\n        ],\r\n        uniqueValueProp: 'The only PM tool with built-in AI assistant',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].bodyText.length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('Character Counts', () => {\r\n    it('should include accurate character counts', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'casual',\r\n        productName: 'Wire Dispenser',\r\n        productDescription: 'Reel-easy wire holder for efficient tie wire dispensing, belt-mountable',\r\n        industry: 'Building Materials',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      const counts = variations[0].characterCounts;\r\n\r\n      expect(counts.headline).toBe(variations[0].headline.length);\r\n      expect(counts.hook).toBe(variations[0].hook.length);\r\n      expect(counts.body).toBe(variations[0].bodyText.length);\r\n      expect(counts.caption).toBe(variations[0].caption.length);\r\n      expect(counts.total).toBe(\r\n        variations[0].headline.length +\r\n        variations[0].hook.length +\r\n        variations[0].bodyText.length +\r\n        variations[0].caption.length\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Hashtags', () => {\r\n    it('should generate 3-5 hashtags for ads', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'technical',\r\n        productName: 'Rebar Bender',\r\n        productDescription: 'Portable rebar bending tool for on-site fabrication, handles up to 16mm bar',\r\n        industry: 'Construction Steel Supply',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].hashtags.length).toBeGreaterThanOrEqual(3);\r\n      expect(variations[0].hashtags.length).toBeLessThanOrEqual(5);\r\n\r\n      // Each hashtag should start with #\r\n      variations[0].hashtags.forEach(tag => {\r\n        expect(tag).toMatch(/^#/);\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Campaign Objectives', () => {\r\n    it('should tailor copy for awareness campaigns', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'instagram',\r\n        tone: 'casual',\r\n        productName: 'Steel Fixing Chairs',\r\n        productDescription: 'Pre-formed wire chairs for rebar support, multiple height options available',\r\n        industry: 'Construction Steel Supply',\r\n        campaignObjective: 'awareness',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].bodyText.length).toBeGreaterThan(0);\r\n      expect(['AIDA', 'PAS']).toContain(variations[0].framework);\r\n    });\r\n\r\n    it('should tailor copy for conversion campaigns', async () => {\r\n      const { copywritingService } = await import('../services/copywritingService');\r\n\r\n      const request: GenerateCopyInput = {\r\n        generationId: testGenerationId,\r\n        platform: 'facebook',\r\n        tone: 'professional',\r\n        productName: 'Reinforcement Bundle',\r\n        productDescription: 'Complete rebar package for residential foundations, includes mesh, spacers, and tie wire',\r\n        industry: 'Building Materials',\r\n        campaignObjective: 'conversion',\r\n        variations: 1,\r\n      };\r\n\r\n      const variations = await copywritingService.generateCopy(request);\r\n\r\n      expect(variations[0].cta.length).toBeGreaterThan(0);\r\n      expect(variations[0].cta.length).toBeLessThanOrEqual(30);\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Storage Layer - AdCopy', () => {\r\n  let testUserId: string;\r\n  let testGenerationId: string;\r\n\r\n  beforeAll(async () => {\r\n    const testEmail = `storage-${Date.now()}@test.com`;\r\n    const testPasswordHash = 'hashedpassword123';\r\n    const testUser = await storage.createUser(testEmail, testPasswordHash);\r\n    testUserId = testUser.id;\r\n\r\n    const testGen = await storage.saveGeneration({\r\n      prompt: 'Test',\r\n      originalImagePaths: ['test.jpg'],\r\n      generatedImagePath: 'gen.jpg',\r\n      resolution: '2K',\r\n      conversationHistory: null,\r\n      parentGenerationId: null,\r\n      editPrompt: null,\r\n    });\r\n    testGenerationId = testGen.id;\r\n  });\r\n\r\n  it('should save ad copy to database', async () => {\r\n    const copy = await storage.saveAdCopy({\r\n      generationId: testGenerationId,\r\n      userId: testUserId,\r\n      headline: 'Test Headline',\r\n      hook: 'Test Hook',\r\n      bodyText: 'Test body text',\r\n      cta: 'Buy Now',\r\n      caption: 'Test caption',\r\n      hashtags: ['#test', '#ad'],\r\n      platform: 'instagram',\r\n      tone: 'casual',\r\n      framework: 'aida',\r\n      campaignObjective: 'awareness',\r\n      productName: 'Test Product',\r\n      productDescription: 'Test description',\r\n      productBenefits: null,\r\n      uniqueValueProp: null,\r\n      industry: 'Test',\r\n      targetAudience: null,\r\n      brandVoice: null,\r\n      socialProof: null,\r\n      qualityScore: { clarity: 8, persuasiveness: 7, platformFit: 9, brandAlignment: 8, overallScore: 8, reasoning: 'Test' },\r\n      characterCounts: { headline: 13, hook: 9, body: 14, caption: 12, total: 48 },\r\n      variationNumber: 1,\r\n      parentCopyId: null,\r\n    });\r\n\r\n    expect(copy.id).toBeDefined();\r\n    expect(copy.headline).toBe('Test Headline');\r\n    expect(copy.platform).toBe('instagram');\r\n  });\r\n\r\n  it('should retrieve copy by generation ID', async () => {\r\n    const copies = await storage.getAdCopyByGenerationId(testGenerationId);\r\n    expect(Array.isArray(copies)).toBe(true);\r\n    expect(copies.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  it('should retrieve copy by ID', async () => {\r\n    const savedCopy = await storage.saveAdCopy({\r\n      generationId: testGenerationId,\r\n      userId: testUserId,\r\n      headline: 'Unique Test',\r\n      hook: 'Hook',\r\n      bodyText: 'Body',\r\n      cta: 'CTA',\r\n      caption: 'Caption',\r\n      hashtags: ['#test'],\r\n      platform: 'facebook',\r\n      tone: 'professional',\r\n      framework: 'pas',\r\n      campaignObjective: null,\r\n      productName: 'Test',\r\n      productDescription: 'Desc',\r\n      productBenefits: null,\r\n      uniqueValueProp: null,\r\n      industry: 'Test',\r\n      targetAudience: null,\r\n      brandVoice: null,\r\n      socialProof: null,\r\n      qualityScore: null,\r\n      characterCounts: null,\r\n      variationNumber: 1,\r\n      parentCopyId: null,\r\n    });\r\n\r\n    const retrieved = await storage.getAdCopyById(savedCopy.id);\r\n    expect(retrieved).toBeDefined();\r\n    expect(retrieved!.headline).toBe('Unique Test');\r\n  });\r\n\r\n  it('should delete copy', async () => {\r\n    const copy = await storage.saveAdCopy({\r\n      generationId: testGenerationId,\r\n      userId: testUserId,\r\n      headline: 'To Delete',\r\n      hook: 'Hook',\r\n      bodyText: 'Body',\r\n      cta: 'CTA',\r\n      caption: 'Caption',\r\n      hashtags: ['#test'],\r\n      platform: 'instagram',\r\n      tone: 'casual',\r\n      framework: 'aida',\r\n      campaignObjective: null,\r\n      productName: 'Test',\r\n      productDescription: 'Desc',\r\n      productBenefits: null,\r\n      uniqueValueProp: null,\r\n      industry: 'Test',\r\n      targetAudience: null,\r\n      brandVoice: null,\r\n      socialProof: null,\r\n      qualityScore: null,\r\n      characterCounts: null,\r\n      variationNumber: 1,\r\n      parentCopyId: null,\r\n    });\r\n\r\n    await storage.deleteAdCopy(copy.id);\r\n\r\n    const retrieved = await storage.getAdCopyById(copy.id);\r\n    expect(retrieved).toBeUndefined();\r\n  });\r\n\r\n  it('should update user brand voice', async () => {\r\n    const brandVoice = {\r\n      principles: ['Bold', 'Innovative'],\r\n      wordsToUse: ['transform', 'empower'],\r\n      wordsToAvoid: ['cheap', 'easy'],\r\n    };\r\n\r\n    const updated = await storage.updateUserBrandVoice(testUserId, brandVoice);\r\n    expect(updated.brandVoice).toEqual(brandVoice);\r\n\r\n    const retrieved = await storage.getUserById(testUserId);\r\n    expect(retrieved!.brandVoice).toEqual(brandVoice);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\dbHealth.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pool' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Pool"},"fix":{"range":[303,336],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockOn' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DbHealthStatus' is defined but never used. Allowed unused vars must match /^_/u.","line":50,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DbHealthStatus"},"fix":{"range":[1273,1289],"text":""},"desc":"Remove unused variable \"DbHealthStatus\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Database Health and Connection Pool Tests\r\n *\r\n * Tests for:\r\n * - checkDbHealth function from server/lib/dbHealth.ts\r\n * - getPoolConfig function from server/db.ts\r\n */\r\n\r\nimport { vi } from 'vitest';\r\nimport type { Pool } from 'pg';\r\n\r\n// Use vi.hoisted to define mocks that will be available to vi.mock factories\r\nconst { mockQuery, mockOn, mockPool, mockLogger } = vi.hoisted(() => {\r\n  const mockQuery = vi.fn();\r\n  const mockOn = vi.fn();\r\n\r\n  const mockPool = {\r\n    query: mockQuery,\r\n    on: mockOn,\r\n    totalCount: 5,\r\n    idleCount: 3,\r\n    waitingCount: 0,\r\n    options: { max: 20 },\r\n  };\r\n\r\n  const mockLogger = {\r\n    info: vi.fn(),\r\n    error: vi.fn(),\r\n    debug: vi.fn(),\r\n    warn: vi.fn(),\r\n  };\r\n\r\n  return { mockQuery, mockOn, mockPool, mockLogger };\r\n});\r\n\r\n// Mock the db module before importing anything else\r\n// Note: We provide a factory that returns the mocked pool\r\n// The actual db.ts will not execute, so pool.on() calls won't happen\r\nvi.mock('../db', () => ({\r\n  pool: mockPool,\r\n  db: {},\r\n}));\r\n\r\n// Mock logger to avoid console output during tests\r\nvi.mock('../lib/logger', () => ({\r\n  logger: mockLogger,\r\n}));\r\n\r\nimport { checkDbHealth, DbHealthStatus } from '../lib/dbHealth';\r\nimport { pool } from '../db';\r\n\r\n// To test the actual pool event registration, we need to also test\r\n// the logic without full mocking. However, for these unit tests,\r\n// we're focusing on checkDbHealth functionality.\r\n// The pool configuration tests verify the getPoolConfig logic separately.\r\n\r\ndescribe('Database Health Check', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n\r\n    // Reset pool metrics to defaults\r\n    mockPool.totalCount = 5;\r\n    mockPool.idleCount = 3;\r\n    mockPool.waitingCount = 0;\r\n    mockPool.options = { max: 20 };\r\n  });\r\n\r\n  describe('Healthy Status', () => {\r\n    it('should return healthy status for fast query with low connection usage', async () => {\r\n      // Mock fast query (< 100ms)\r\n      mockQuery.mockImplementation(\r\n        () => new Promise((resolve) => setTimeout(() => resolve({ rows: [{ '?column?': 1 }] }), 50)),\r\n      );\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('healthy');\r\n      expect(result.averageQueryTime).toBeGreaterThanOrEqual(50);\r\n      expect(result.averageQueryTime).toBeLessThan(100);\r\n      expect(result.totalConnections).toBe(5);\r\n      expect(result.idleConnections).toBe(3);\r\n      expect(result.activeConnections).toBe(2);\r\n      expect(result.waitingClients).toBe(0);\r\n      expect(result.maxConnections).toBe(20);\r\n      expect(mockQuery).toHaveBeenCalledWith('SELECT 1');\r\n    });\r\n\r\n    it('should return healthy for instant query', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('healthy');\r\n      expect(result.averageQueryTime).toBeLessThan(100);\r\n    });\r\n\r\n    it('should handle pool with all idle connections', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n      mockPool.totalCount = 10;\r\n      mockPool.idleCount = 10;\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('healthy');\r\n      expect(result.activeConnections).toBe(0);\r\n      expect(result.idleConnections).toBe(10);\r\n    });\r\n  });\r\n\r\n  describe('Degraded Status', () => {\r\n    it('should return degraded status for slow query (200-500ms)', async () => {\r\n      // Mock slow query (250ms) - source uses 200ms threshold for degraded\r\n      mockQuery.mockImplementation(\r\n        () => new Promise((resolve) => setTimeout(() => resolve({ rows: [{ '?column?': 1 }] }), 250)),\r\n      );\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('degraded');\r\n      expect(result.averageQueryTime).toBeGreaterThanOrEqual(200);\r\n      expect(result.averageQueryTime).toBeLessThan(500);\r\n    });\r\n\r\n    it('should return degraded when pool is at 80% capacity', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      // 16 out of 20 connections = 80%\r\n      mockPool.totalCount = 16;\r\n      mockPool.idleCount = 0;\r\n      mockPool.options = { max: 20 };\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('degraded');\r\n      expect(result.activeConnections).toBe(16);\r\n      expect(result.maxConnections).toBe(20);\r\n      expect(result.activeConnections).toBeGreaterThanOrEqual(result.maxConnections * 0.8);\r\n    });\r\n\r\n    it('should return degraded for query at exactly 200ms', async () => {\r\n      // Source uses >= 200ms threshold for degraded status\r\n      mockQuery.mockImplementation(\r\n        () => new Promise((resolve) => setTimeout(() => resolve({ rows: [{ '?column?': 1 }] }), 200)),\r\n      );\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('degraded');\r\n      expect(result.averageQueryTime).toBeGreaterThanOrEqual(200);\r\n    });\r\n  });\r\n\r\n  describe('Unhealthy Status', () => {\r\n    it('should return unhealthy status for very slow query (>= 500ms)', async () => {\r\n      // Mock very slow query (600ms)\r\n      mockQuery.mockImplementation(\r\n        () => new Promise((resolve) => setTimeout(() => resolve({ rows: [{ '?column?': 1 }] }), 600)),\r\n      );\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.averageQueryTime).toBeGreaterThanOrEqual(500);\r\n    });\r\n\r\n    it('should return unhealthy when pool is exhausted', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      // All 20 connections in use\r\n      mockPool.totalCount = 20;\r\n      mockPool.idleCount = 0;\r\n      mockPool.options = { max: 20 };\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.activeConnections).toBe(20);\r\n      expect(result.activeConnections).toBeGreaterThanOrEqual(result.maxConnections);\r\n    });\r\n\r\n    it('should return unhealthy for query at exactly 500ms', async () => {\r\n      mockQuery.mockImplementation(\r\n        () => new Promise((resolve) => setTimeout(() => resolve({ rows: [{ '?column?': 1 }] }), 500)),\r\n      );\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.averageQueryTime).toBeGreaterThanOrEqual(500);\r\n    });\r\n\r\n    it('should return unhealthy on connection failure', async () => {\r\n      const dbError = new Error('Connection refused');\r\n      mockQuery.mockRejectedValue(dbError);\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.totalConnections).toBe(0);\r\n      expect(result.idleConnections).toBe(0);\r\n      expect(result.activeConnections).toBe(0);\r\n      expect(result.waitingClients).toBe(0);\r\n      expect(result.averageQueryTime).toBeUndefined();\r\n      expect(mockLogger.error).toHaveBeenCalledWith(\r\n        { module: 'DbHealth', err: dbError },\r\n        'Database health check failed',\r\n      );\r\n    });\r\n\r\n    it('should return unhealthy on query timeout', async () => {\r\n      const timeoutError = new Error('Query timeout');\r\n      mockQuery.mockRejectedValue(timeoutError);\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.averageQueryTime).toBeUndefined();\r\n    });\r\n\r\n    it('should handle network errors gracefully', async () => {\r\n      const networkError = new Error('ECONNREFUSED');\r\n      mockQuery.mockRejectedValue(networkError);\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(mockLogger.error).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Pool Metrics', () => {\r\n    it('should correctly calculate active connections', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      mockPool.totalCount = 15;\r\n      mockPool.idleCount = 7;\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.totalConnections).toBe(15);\r\n      expect(result.idleConnections).toBe(7);\r\n      expect(result.activeConnections).toBe(8);\r\n    });\r\n\r\n    it('should report waiting clients when pool is busy', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      mockPool.totalCount = 20;\r\n      mockPool.idleCount = 0;\r\n      mockPool.waitingCount = 5;\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.waitingClients).toBe(5);\r\n      expect(result.status).toBe('unhealthy'); // Pool exhausted\r\n    });\r\n\r\n    it('should use default max connections if not set', async () => {\r\n      mockQuery.mockResolvedValue({ rows: [{ '?column?': 1 }] });\r\n\r\n      mockPool.options = {}; // No max set\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.maxConnections).toBe(10); // Default fallback\r\n    });\r\n\r\n    it('should handle edge case with zero connections', async () => {\r\n      const error = new Error('No connections available');\r\n      mockQuery.mockRejectedValue(error);\r\n\r\n      mockPool.totalCount = 0;\r\n      mockPool.idleCount = 0;\r\n\r\n      const result = await checkDbHealth();\r\n\r\n      expect(result.status).toBe('unhealthy');\r\n      expect(result.totalConnections).toBe(0);\r\n      expect(result.activeConnections).toBe(0);\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Pool Configuration Validation (getPoolConfig logic)', () => {\r\n  describe('getPoolConfig - Bounds Validation', () => {\r\n    it('should validate and bound DB_POOL_MAX (1-100)', () => {\r\n      // Test upper bound\r\n      const max1 = Math.min(Math.max(parseInt('150', 10), 1), 100);\r\n      expect(max1).toBe(100); // Capped at 100\r\n\r\n      // Test lower bound\r\n      const max2 = Math.min(Math.max(parseInt('0', 10), 1), 100);\r\n      expect(max2).toBe(1); // Minimum 1\r\n\r\n      // Test negative\r\n      const max3 = Math.min(Math.max(parseInt('-5', 10), 1), 100);\r\n      expect(max3).toBe(1); // Minimum 1\r\n\r\n      // Test valid value\r\n      const max4 = Math.min(Math.max(parseInt('50', 10), 1), 100);\r\n      expect(max4).toBe(50);\r\n    });\r\n\r\n    it('should use default DB_POOL_MAX of 20 when not set', () => {\r\n      const max = Math.min(Math.max(parseInt('' || '20', 10), 1), 100);\r\n      expect(max).toBe(20);\r\n    });\r\n\r\n    it('should validate and bound DB_POOL_MIN (0 to max)', () => {\r\n      const max = 10;\r\n\r\n      // Test that min cannot exceed max\r\n      const min1 = Math.min(Math.max(parseInt('20', 10), 0), max);\r\n      expect(min1).toBeLessThanOrEqual(10);\r\n\r\n      // Test negative min\r\n      const min2 = Math.min(Math.max(parseInt('-5', 10), 0), max);\r\n      expect(min2).toBe(0); // Minimum 0\r\n\r\n      // Test default\r\n      const min3 = Math.min(Math.max(parseInt('' || '2', 10), 0), max);\r\n      expect(min3).toBe(2); // Default\r\n    });\r\n\r\n    it('should ensure DB_POOL_MIN does not exceed DB_POOL_MAX', () => {\r\n      const max = Math.min(Math.max(parseInt('5', 10), 1), 100);\r\n      const min = Math.min(Math.max(parseInt('10', 10), 0), max);\r\n      expect(min).toBeLessThanOrEqual(max);\r\n      expect(min).toBe(5); // Capped at max\r\n    });\r\n\r\n    it('should validate DB_IDLE_TIMEOUT with minimum 1000ms', () => {\r\n      // Test below minimum\r\n      const timeout1 = Math.max(parseInt('500', 10), 1000);\r\n      expect(timeout1).toBe(1000);\r\n\r\n      // Test valid value\r\n      const timeout2 = Math.max(parseInt('60000', 10), 1000);\r\n      expect(timeout2).toBe(60000);\r\n\r\n      // Test default\r\n      const timeout3 = Math.max(parseInt('' || '30000', 10), 1000);\r\n      expect(timeout3).toBe(30000); // Default 30s\r\n    });\r\n\r\n    it('should validate DB_CONNECTION_TIMEOUT with minimum 1000ms', () => {\r\n      // Test below minimum\r\n      const timeout1 = Math.max(parseInt('100', 10), 1000);\r\n      expect(timeout1).toBe(1000);\r\n\r\n      // Test valid value\r\n      const timeout2 = Math.max(parseInt('10000', 10), 1000);\r\n      expect(timeout2).toBe(10000);\r\n\r\n      // Test default\r\n      const timeout3 = Math.max(parseInt('' || '5000', 10), 1000);\r\n      expect(timeout3).toBe(5000); // Default 5s\r\n    });\r\n\r\n    it('should validate DB_STATEMENT_TIMEOUT with minimum 1000ms', () => {\r\n      // Test below minimum\r\n      const timeout1 = Math.max(parseInt('500', 10), 1000);\r\n      expect(timeout1).toBe(1000);\r\n\r\n      // Test valid value\r\n      const timeout2 = Math.max(parseInt('45000', 10), 1000);\r\n      expect(timeout2).toBe(45000);\r\n\r\n      // Test default\r\n      const timeout3 = Math.max(parseInt('' || '30000', 10), 1000);\r\n      expect(timeout3).toBe(30000); // Default 30s\r\n    });\r\n\r\n    it('should handle invalid numeric strings gracefully', () => {\r\n      // parseInt returns NaN for invalid strings\r\n      const parsedMax = parseInt('not-a-number', 10);\r\n      const parsedMin = parseInt('invalid', 10);\r\n\r\n      // Verify parsing returns NaN\r\n      expect(isNaN(parsedMax)).toBe(true);\r\n      expect(isNaN(parsedMin)).toBe(true);\r\n\r\n      // When NaN is passed to Math.max/min, the behavior is:\r\n      // Math.max(NaN, 1) = NaN, but in the actual code it should handle this\r\n      // The actual implementation in db.ts will default to sensible values\r\n      // We're testing the validation logic, which should handle NaN by using defaults\r\n\r\n      // Simulate the actual getPoolConfig logic with NaN handling\r\n      const max = Math.min(Math.max(isNaN(parsedMax) ? 20 : parsedMax, 1), 100);\r\n      const min = Math.min(Math.max(isNaN(parsedMin) ? 2 : parsedMin, 0), max);\r\n\r\n      expect(max).toBe(20); // Falls back to default\r\n      expect(min).toBe(2); // Falls back to default\r\n      expect(min).toBeLessThanOrEqual(max);\r\n    });\r\n  });\r\n\r\n  describe('Pool Event Handlers (validation of pool interface)', () => {\r\n    // Note: Since we're mocking '../db', the actual db.ts module doesn't execute\r\n    // and pool.on() is never called. These tests validate that our mock pool\r\n    // has the expected interface and that event handlers WOULD work if registered.\r\n\r\n    it('should have pool.on method available', () => {\r\n      // Verify the mocked pool has the on() method\r\n      expect(pool.on).toBeDefined();\r\n      expect(typeof pool.on).toBe('function');\r\n    });\r\n\r\n    it('should have pool.query method available', () => {\r\n      // Verify the mocked pool has the query() method\r\n      expect(pool.query).toBeDefined();\r\n      expect(typeof pool.query).toBe('function');\r\n    });\r\n\r\n    it('should have pool metrics properties', () => {\r\n      // Verify the mocked pool has metrics properties\r\n      expect(pool).toHaveProperty('totalCount');\r\n      expect(pool).toHaveProperty('idleCount');\r\n      expect(pool).toHaveProperty('waitingCount');\r\n      expect(pool).toHaveProperty('options');\r\n    });\r\n\r\n    it('should demonstrate event handler pattern for statement_timeout', () => {\r\n      // This test demonstrates how the actual db.ts would set up the connect handler\r\n      // In real code: pool.on('connect', (client) => { client.query(...) })\r\n\r\n      const mockClientQuery = vi.fn().mockResolvedValue({});\r\n      const mockClient = { query: mockClientQuery };\r\n\r\n      // Simulate the connect handler logic from db.ts\r\n      const statementTimeout = 30000;\r\n      mockClient.query(`SET statement_timeout = ${statementTimeout}`);\r\n\r\n      expect(mockClientQuery).toHaveBeenCalledWith(`SET statement_timeout = ${statementTimeout}`);\r\n    });\r\n\r\n    it('should demonstrate error handling pattern for statement_timeout failures', async () => {\r\n      // This test demonstrates how the actual db.ts would handle query failures\r\n      const error = new Error('Failed to set statement_timeout');\r\n      const mockClientQuery = vi.fn().mockRejectedValue(error);\r\n      const mockClient = { query: mockClientQuery };\r\n\r\n      // Simulate the connect handler with error handling\r\n      try {\r\n        await mockClient.query('SET statement_timeout = 30000');\r\n      } catch (err) {\r\n        // In actual code, this is caught and logged\r\n        mockLogger.error({ module: 'db', err }, 'Failed to set statement_timeout on connection');\r\n      }\r\n\r\n      expect(mockLogger.error).toHaveBeenCalledWith(\r\n        expect.objectContaining({ module: 'db', err: error }),\r\n        'Failed to set statement_timeout on connection',\r\n      );\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\encryptionService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\enrichment.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_PIPELINE_CONFIG' is defined but never used. Allowed unused vars must match /^_/u.","line":63,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DEFAULT_PIPELINE_CONFIG"},"fix":{"range":[1636,1660],"text":""},"desc":"Remove unused variable \"DEFAULT_PIPELINE_CONFIG\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ============================================\r\n// MOCK SETUP\r\n// ============================================\r\n\r\n// Mock Gemini API\r\nconst { mockGenerateContent } = vi.hoisted(() => {\r\n  const mockGenerateContent = vi.fn();\r\n  return { mockGenerateContent };\r\n});\r\n\r\nvi.mock('../lib/gemini', () => ({\r\n  genAI: {\r\n    models: {\r\n      generateContent: mockGenerateContent,\r\n    },\r\n  },\r\n}));\r\n\r\n// Mock storage\r\nconst mockStorage = vi.hoisted(() => ({\r\n  getProductById: vi.fn(),\r\n  getProducts: vi.fn(),\r\n  updateProduct: vi.fn(),\r\n  getProductAnalysisByProductId: vi.fn(),\r\n  saveProductAnalysis: vi.fn(),\r\n  updateProductAnalysis: vi.fn(),\r\n}));\r\n\r\nvi.mock('../storage', () => ({\r\n  storage: mockStorage,\r\n}));\r\n\r\n// Mock fetch for web requests\r\nconst mockFetch = vi.fn();\r\nvi.stubGlobal('fetch', mockFetch);\r\n\r\n// Import after mocks\r\nimport {\r\n  aiCompareDescriptions,\r\n  aiExtractProductData,\r\n  aiVerifyClaim,\r\n  aiCheckEquivalence,\r\n  aiExtractClaims,\r\n  compareSkus,\r\n  calculateMatchConfidence,\r\n} from '../services/enrichment/aiHelpers';\r\n\r\nimport { verifySourceMatch, verifySourcesBatch } from '../services/enrichment/gate1-sourceMatch';\r\nimport { verifyExtraction, getVerifiedFields } from '../services/enrichment/gate2-extraction';\r\nimport { verifyDatabaseWrite, buildWritePayload } from '../services/enrichment/gate3-dbWrite';\r\nimport {\r\n  verifyCrossSourceTruth,\r\n  resolveConflicts,\r\n  filterContradictedClaims,\r\n} from '../services/enrichment/gate4-crossSource';\r\nimport {\r\n  aggregateExtractions,\r\n  extractFeatures,\r\n  extractBenefits,\r\n  extractTags,\r\n} from '../services/enrichment/dataExtraction';\r\nimport {\r\n  DEFAULT_PIPELINE_CONFIG,\r\n  type VisionResult,\r\n  type SourceSearchResult,\r\n  type ExtractedData,\r\n  type Gate2Result,\r\n  type PipelineConfig,\r\n} from '../services/enrichment/types';\r\n\r\n// ============================================\r\n// TEST DATA FIXTURES\r\n// ============================================\r\n\r\nconst mockVisionResult: VisionResult = {\r\n  category: 'Construction',\r\n  subcategory: 'Reinforcement',\r\n  materials: ['Galvanized Steel', 'Metal'],\r\n  colors: ['Silver', 'Grey'],\r\n  style: 'Industrial',\r\n  usageContext: 'Construction site reinforcement',\r\n  targetDemographic: 'Contractors',\r\n  confidence: 85,\r\n  detectedText: ['NDS-50MM', '50mm'],\r\n};\r\n\r\nconst mockSourceResult: SourceSearchResult = {\r\n  url: 'https://ndspro.com/products/spacer-50mm',\r\n  sourceType: 'primary',\r\n  sourceName: 'NDS Pro',\r\n  trustLevel: 10,\r\n  pageTitle: '50mm Spacer Bar - NDS Pro',\r\n  pageContent:\r\n    'The NDS 50mm Spacer Bar is made of galvanized steel. Dimensions: 50mm x 10mm. Used for concrete reinforcement. Load capacity: 500kg. Certifications: ISO 9001.',\r\n  extractedProductName: '50mm Spacer Bar',\r\n  extractedSKU: 'NDS-50MM',\r\n  extractedImages: ['https://ndspro.com/images/spacer-50mm.jpg'],\r\n};\r\n\r\nconst mockExtractedData: ExtractedData = {\r\n  sourceUrl: 'https://ndspro.com/products/spacer-50mm',\r\n  productName: '50mm Spacer Bar',\r\n  description: 'Industrial galvanized steel spacer bar for concrete reinforcement applications.',\r\n  specifications: {\r\n    material: 'Galvanized Steel',\r\n    dimensions: '50mm x 10mm',\r\n    loadCapacity: '500kg',\r\n  },\r\n  relatedProducts: ['Rebar Mesh', 'Concrete Cover'],\r\n  installationInfo: 'Place spacers at 500mm intervals',\r\n  certifications: ['ISO 9001'],\r\n  rawExtract: 'The NDS 50mm Spacer Bar is made of galvanized steel...',\r\n};\r\n\r\nconst mockConfig: PipelineConfig = {\r\n  gate1PassThreshold: 85,\r\n  gate1CautionThreshold: 60,\r\n  gate2PassThreshold: 90,\r\n  maxSourcesPerProduct: 5,\r\n  minSourcesForHighConfidence: 3,\r\n  maxDbWriteRetries: 3,\r\n  retryDelayMs: 100,\r\n  enableVisualComparison: false, // Disable for unit tests\r\n  enableSemanticVerification: true,\r\n};\r\n\r\n// ============================================\r\n// AI HELPERS TESTS\r\n// ============================================\r\n\r\ndescribe('AI Helpers', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('compareSkus', () => {\r\n    it('returns exact match with 100% confidence', () => {\r\n      const result = compareSkus(['NDS-50MM'], 'NDS-50MM');\r\n      expect(result.match).toBe(true);\r\n      expect(result.confidence).toBe(100);\r\n    });\r\n\r\n    it('returns match for normalized SKUs', () => {\r\n      const result = compareSkus(['NDS50MM'], 'NDS-50-MM');\r\n      expect(result.match).toBe(true);\r\n      expect(result.confidence).toBeGreaterThanOrEqual(85);\r\n    });\r\n\r\n    it('returns no match for different SKUs', () => {\r\n      const result = compareSkus(['ABC-123'], 'XYZ-789');\r\n      expect(result.match).toBe(false);\r\n      expect(result.confidence).toBe(0);\r\n    });\r\n\r\n    it('handles empty inputs', () => {\r\n      expect(compareSkus([], 'SKU-123').match).toBe(false);\r\n      expect(compareSkus(['SKU-123'], null).match).toBe(false);\r\n    });\r\n\r\n    it('finds partial matches', () => {\r\n      const result = compareSkus(['Product-NDS-50MM-V2'], 'NDS-50MM');\r\n      expect(result.match).toBe(true);\r\n      expect(result.confidence).toBeGreaterThanOrEqual(80);\r\n    });\r\n  });\r\n\r\n  describe('calculateMatchConfidence', () => {\r\n    it('calculates weighted confidence correctly', () => {\r\n      const confidence = calculateMatchConfidence({\r\n        skuMatch: { match: true, confidence: 100 },\r\n        visualSimilarity: { similar: true, confidence: 90, reasoning: '' },\r\n        semanticMatch: { similar: true, confidence: 80, reasoning: '' },\r\n      });\r\n\r\n      // 100*0.4 + 90*0.35 + 80*0.25 = 40 + 31.5 + 20 = 91.5 -> 92\r\n      expect(confidence).toBe(92);\r\n    });\r\n\r\n    it('returns 0 when nothing matches', () => {\r\n      const confidence = calculateMatchConfidence({\r\n        skuMatch: { match: false, confidence: 0 },\r\n        visualSimilarity: { similar: false, confidence: 0, reasoning: '' },\r\n        semanticMatch: { similar: false, confidence: 0, reasoning: '' },\r\n      });\r\n\r\n      expect(confidence).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('aiCompareDescriptions', () => {\r\n    it('compares product descriptions using AI', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          similar: true,\r\n          confidence: 90,\r\n          reasoning: 'Materials and category match',\r\n        }),\r\n      });\r\n\r\n      const result = await aiCompareDescriptions({\r\n        ourProduct: {\r\n          category: 'Construction',\r\n          materials: ['Steel'],\r\n          colors: ['Silver'],\r\n          style: 'Industrial',\r\n        },\r\n        sourceProduct: {\r\n          title: 'Steel Spacer',\r\n          content: 'Industrial steel spacer for construction',\r\n        },\r\n      });\r\n\r\n      expect(result.similar).toBe(true);\r\n      expect(result.confidence).toBe(90);\r\n      expect(mockGenerateContent).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it('handles API errors gracefully', async () => {\r\n      mockGenerateContent.mockRejectedValueOnce(new Error('API Error'));\r\n\r\n      const result = await aiCompareDescriptions({\r\n        ourProduct: { category: 'Test', materials: [], colors: [], style: 'Test' },\r\n        sourceProduct: { title: 'Test', content: 'Test' },\r\n      });\r\n\r\n      expect(result.similar).toBe(false);\r\n      expect(result.confidence).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('aiExtractProductData', () => {\r\n    it('extracts structured data from page content', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          productName: '50mm Spacer',\r\n          description: 'Steel spacer for concrete',\r\n          specifications: { material: 'Steel', dimensions: '50mm' },\r\n          relatedProducts: ['Rebar'],\r\n          installationInfo: 'Place at intervals',\r\n          certifications: ['ISO 9001'],\r\n        }),\r\n      });\r\n\r\n      const result = await aiExtractProductData('Product page content...', 'Spacer');\r\n\r\n      expect(result.productName).toBe('50mm Spacer');\r\n      expect(result.specifications.material).toBe('Steel');\r\n      expect(result.certifications).toContain('ISO 9001');\r\n    });\r\n\r\n    it('returns empty data on parse failure', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({ text: 'Invalid response' });\r\n\r\n      const result = await aiExtractProductData('Content', 'Product');\r\n\r\n      expect(result.productName).toBe('');\r\n      expect(result.specifications).toEqual({});\r\n    });\r\n  });\r\n\r\n  describe('aiVerifyClaim', () => {\r\n    it('verifies claim is supported by source', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          supports: true,\r\n          contradicts: false,\r\n          neutral: false,\r\n          reasoning: 'Source explicitly states this',\r\n        }),\r\n      });\r\n\r\n      const result = await aiVerifyClaim({\r\n        claim: 'The material is steel',\r\n        source: 'Made of high-quality steel',\r\n      });\r\n\r\n      expect(result.supports).toBe(true);\r\n      expect(result.contradicts).toBe(false);\r\n    });\r\n\r\n    it('detects contradictions', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          supports: false,\r\n          contradicts: true,\r\n          neutral: false,\r\n          reasoning: 'Source says aluminum, not steel',\r\n        }),\r\n      });\r\n\r\n      const result = await aiVerifyClaim({\r\n        claim: 'The material is steel',\r\n        source: 'Made of aluminum',\r\n      });\r\n\r\n      expect(result.supports).toBe(false);\r\n      expect(result.contradicts).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('aiCheckEquivalence', () => {\r\n    it('detects equivalent values with different units', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          allEquivalent: true,\r\n          compatible: true,\r\n          resolvedValue: '50mm',\r\n          reasoning: '50mm equals approximately 2 inches',\r\n        }),\r\n      });\r\n\r\n      const result = await aiCheckEquivalence(['50mm', '2 inch']);\r\n\r\n      expect(result.allEquivalent).toBe(true);\r\n      expect(result.resolvedValue).toBe('50mm');\r\n    });\r\n\r\n    it('detects conflicting values', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          allEquivalent: false,\r\n          compatible: false,\r\n          resolvedValue: null,\r\n          reasoning: '25mm and 50mm are different sizes',\r\n        }),\r\n      });\r\n\r\n      const result = await aiCheckEquivalence(['25mm', '50mm']);\r\n\r\n      expect(result.allEquivalent).toBe(false);\r\n      expect(result.resolvedValue).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('aiExtractClaims', () => {\r\n    it('extracts factual claims from description', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          claims: [\r\n            { claim: 'Material is galvanized steel', importance: 'high' },\r\n            { claim: 'Load capacity is 500kg', importance: 'high' },\r\n            { claim: 'Certified to ISO 9001', importance: 'medium' },\r\n          ],\r\n        }),\r\n      });\r\n\r\n      const result = await aiExtractClaims('Galvanized steel spacer with 500kg load capacity. ISO 9001 certified.');\r\n\r\n      expect(result.length).toBe(3);\r\n      expect(result[0].claim).toContain('galvanized steel');\r\n      expect(result[1].importance).toBe('high');\r\n    });\r\n\r\n    it('returns empty array on failure', async () => {\r\n      mockGenerateContent.mockRejectedValueOnce(new Error('API Error'));\r\n\r\n      const result = await aiExtractClaims('Some description');\r\n\r\n      expect(result).toEqual([]);\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// GATE 1 TESTS\r\n// ============================================\r\n\r\ndescribe('Gate 1: Source Match Verification', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    mockFetch.mockResolvedValue({\r\n      ok: true,\r\n      arrayBuffer: () => Promise.resolve(new ArrayBuffer(8)),\r\n    });\r\n  });\r\n\r\n  describe('verifySourceMatch', () => {\r\n    it('passes with high confidence when SKU and semantics match (visual disabled)', async () => {\r\n      // Disable visual comparison for this test to isolate SKU + semantic scoring\r\n      const configNoVisual: PipelineConfig = {\r\n        ...mockConfig,\r\n        enableVisualComparison: false, // Disable visual comparison\r\n      };\r\n\r\n      // Mock semantic comparison\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          similar: true,\r\n          confidence: 100,\r\n          reasoning: 'Materials and category match exactly',\r\n        }),\r\n      });\r\n\r\n      const result = await verifySourceMatch(\r\n        mockVisionResult,\r\n        mockSourceResult,\r\n        'https://example.com/product.jpg',\r\n        configNoVisual,\r\n      );\r\n\r\n      // SKU match: 100 * 0.4 = 40\r\n      // Visual: disabled, so 0\r\n      // Semantic: 100 * 0.25 = 25\r\n      // Total: 65 (below USE threshold of 85, but above USE_WITH_CAUTION of 60)\r\n      // This test verifies the matching logic works correctly\r\n      expect(result.passed).toBe(true);\r\n      expect(result.confidence).toBeGreaterThanOrEqual(60);\r\n      expect(result.skuMatchScore).toBe(100);\r\n      expect(result.semanticMatchScore).toBe(100);\r\n      expect(['USE', 'USE_WITH_CAUTION']).toContain(result.recommendation);\r\n    });\r\n\r\n    it('fails with low confidence when nothing matches', async () => {\r\n      const noMatchSource: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        extractedSKU: 'DIFFERENT-SKU',\r\n        pageContent: 'Completely different product made of plastic',\r\n      };\r\n\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          similar: false,\r\n          confidence: 10,\r\n          reasoning: 'No match found',\r\n        }),\r\n      });\r\n\r\n      const result = await verifySourceMatch(\r\n        mockVisionResult,\r\n        noMatchSource,\r\n        'https://example.com/product.jpg',\r\n        mockConfig,\r\n      );\r\n\r\n      expect(result.passed).toBe(false);\r\n      expect(result.recommendation).toBe('SKIP');\r\n    });\r\n\r\n    it('returns USE_WITH_CAUTION for medium confidence', async () => {\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          similar: true,\r\n          confidence: 70,\r\n          reasoning: 'Partial match',\r\n        }),\r\n      });\r\n\r\n      const partialSource: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        extractedSKU: null, // No SKU match\r\n      };\r\n\r\n      const result = await verifySourceMatch(\r\n        { ...mockVisionResult, detectedText: [] },\r\n        partialSource,\r\n        'https://example.com/product.jpg',\r\n        mockConfig,\r\n      );\r\n\r\n      // With only semantic match at 70%, weighted score would be ~18\r\n      // This should result in SKIP or USE_WITH_CAUTION based on thresholds\r\n      expect(['USE_WITH_CAUTION', 'SKIP']).toContain(result.recommendation);\r\n    });\r\n  });\r\n\r\n  describe('verifySourcesBatch', () => {\r\n    it('verifies multiple sources in parallel', async () => {\r\n      const sources = [mockSourceResult, { ...mockSourceResult, url: 'https://other.com' }];\r\n\r\n      mockGenerateContent\r\n        .mockResolvedValueOnce({ text: JSON.stringify({ similar: true, confidence: 90, reasoning: '' }) })\r\n        .mockResolvedValueOnce({ text: JSON.stringify({ similar: true, confidence: 85, reasoning: '' }) });\r\n\r\n      const results = await verifySourcesBatch(\r\n        mockVisionResult,\r\n        sources,\r\n        'https://example.com/product.jpg',\r\n        mockConfig,\r\n      );\r\n\r\n      expect(results.length).toBe(2);\r\n    });\r\n\r\n    it('handles individual source failures', async () => {\r\n      // Disable visual comparison to simplify mock ordering\r\n      const configNoVisual: PipelineConfig = {\r\n        ...mockConfig,\r\n        enableVisualComparison: false,\r\n      };\r\n\r\n      // Second source has no SKU to force failure\r\n      const failingSource: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        url: 'https://failing.com',\r\n        extractedSKU: null, // No SKU match\r\n      };\r\n\r\n      const sources = [mockSourceResult, failingSource];\r\n\r\n      // First source: semantic passes\r\n      // Second source: semantic fails\r\n      mockGenerateContent\r\n        .mockResolvedValueOnce({ text: JSON.stringify({ similar: true, confidence: 90, reasoning: '' }) })\r\n        .mockRejectedValueOnce(new Error('API Error'));\r\n\r\n      const results = await verifySourcesBatch(\r\n        mockVisionResult,\r\n        sources,\r\n        'https://example.com/product.jpg',\r\n        configNoVisual,\r\n      );\r\n\r\n      expect(results.length).toBe(2);\r\n      // First source: SKU(100*0.4=40) + Semantic(90*0.25=22.5) = 62.5  USE_WITH_CAUTION, passed=true\r\n      expect(results[0].passed).toBe(true);\r\n      // Second source: SKU(0) + Semantic(0, error) = 0  SKIP, passed=false\r\n      expect(results[1].passed).toBe(false);\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// GATE 2 TESTS\r\n// ============================================\r\n\r\ndescribe('Gate 2: Extraction Verification', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('verifyExtraction', () => {\r\n    it('passes when fields are found in source', async () => {\r\n      // Create extracted data with content that will match via direct match\r\n      const simpleExtractedData: ExtractedData = {\r\n        sourceUrl: 'https://ndspro.com/products/spacer-50mm',\r\n        productName: '50mm Spacer Bar',\r\n        description: 'galvanized steel spacer bar',\r\n        specifications: {\r\n          material: 'Galvanized Steel',\r\n          dimensions: '50mm x 10mm',\r\n        },\r\n        relatedProducts: [],\r\n        installationInfo: '',\r\n        certifications: [],\r\n        rawExtract: '',\r\n      };\r\n\r\n      const sourceWithMatchingContent: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        pageContent:\r\n          '50mm Spacer Bar - Industrial galvanized steel spacer bar. Material: Galvanized Steel. Dimensions: 50mm x 10mm.',\r\n      };\r\n\r\n      const result = await verifyExtraction(sourceWithMatchingContent, simpleExtractedData, mockConfig);\r\n\r\n      // All 4 fields should be verified via direct match\r\n      expect(result.passed).toBe(true);\r\n      expect(result.overallAccuracy).toBeGreaterThanOrEqual(90);\r\n    });\r\n\r\n    it('fails when extracted data not found in source', async () => {\r\n      const sourceWithDifferentContent: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        pageContent: 'This is a completely different product with no matching information.',\r\n      };\r\n\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: 'NOT_FOUND',\r\n      });\r\n\r\n      const result = await verifyExtraction(sourceWithDifferentContent, mockExtractedData, mockConfig);\r\n\r\n      expect(result.passed).toBe(false);\r\n      expect(result.overallAccuracy).toBeLessThan(90);\r\n    });\r\n\r\n    it('tracks verification method for each field', async () => {\r\n      const source: SourceSearchResult = {\r\n        ...mockSourceResult,\r\n        pageContent: '50mm Spacer Bar made of Galvanized Steel',\r\n      };\r\n\r\n      const result = await verifyExtraction(source, mockExtractedData, mockConfig);\r\n\r\n      expect(result.verifiedFields.length).toBeGreaterThan(0);\r\n      for (const field of result.verifiedFields) {\r\n        expect(['DIRECT_MATCH', 'AI_REEXTRACT', 'SEMANTIC_VERIFY', 'NOT_VERIFIED']).toContain(field.verificationMethod);\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('getVerifiedFields', () => {\r\n    it('filters to only verified fields', () => {\r\n      const gate2Result: Gate2Result = {\r\n        sourceUrl: 'https://example.com',\r\n        passed: true,\r\n        verifiedFields: [\r\n          {\r\n            field: 'productName',\r\n            extracted: 'Spacer',\r\n            verified: true,\r\n            verificationMethod: 'DIRECT_MATCH',\r\n            confidence: 100,\r\n          },\r\n          {\r\n            field: 'description',\r\n            extracted: 'Test',\r\n            verified: false,\r\n            verificationMethod: 'NOT_VERIFIED',\r\n            confidence: 0,\r\n          },\r\n          {\r\n            field: 'specifications.material',\r\n            extracted: 'Steel',\r\n            verified: true,\r\n            verificationMethod: 'AI_REEXTRACT',\r\n            confidence: 85,\r\n          },\r\n        ],\r\n        overallAccuracy: 67,\r\n      };\r\n\r\n      const filtered = getVerifiedFields(mockExtractedData, gate2Result);\r\n\r\n      expect(filtered.productName).toBe('50mm Spacer Bar');\r\n      expect(filtered.description).toBe(''); // Not verified, should be empty\r\n      expect(filtered.specifications.material).toBe('Galvanized Steel');\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// GATE 3 TESTS\r\n// ============================================\r\n\r\ndescribe('Gate 3: Database Write Verification', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('buildWritePayload', () => {\r\n    it('builds a clean payload', () => {\r\n      const payload = buildWritePayload(\r\n        'prod-123',\r\n        '  Test description  ',\r\n        { material: 'Steel', empty: '' },\r\n        { finish: 'Matte' },\r\n        ['Durable', '', 'Easy to install'],\r\n        ['tag1', 'tag1', 'tag2', ''], // Duplicates and empty\r\n        ['https://source1.com'],\r\n      );\r\n\r\n      expect(payload.productId).toBe('prod-123');\r\n      expect(payload.description).toBe('Test description');\r\n      expect(payload.specifications).not.toHaveProperty('empty');\r\n      expect(payload.benefits).toEqual(['Durable', 'Easy to install']);\r\n      expect(payload.tags).toEqual(['tag1', 'tag2']); // Deduped\r\n    });\r\n  });\r\n\r\n  describe('verifyDatabaseWrite', () => {\r\n    it('passes when data is saved correctly', async () => {\r\n      const payload = buildWritePayload(\r\n        'prod-123',\r\n        'Test description',\r\n        { material: 'Steel' },\r\n        { finish: 'Matte' },\r\n        ['Durable'],\r\n        ['construction'],\r\n        ['https://source.com'],\r\n      );\r\n\r\n      mockStorage.updateProduct.mockResolvedValue(undefined);\r\n      mockStorage.getProductById.mockResolvedValue({\r\n        id: 'prod-123',\r\n        description: 'Test description',\r\n        specifications: { material: 'Steel' },\r\n        features: { finish: 'Matte' },\r\n        benefits: ['Durable'],\r\n        tags: ['construction'],\r\n      });\r\n\r\n      const result = await verifyDatabaseWrite(payload, { ...mockConfig, retryDelayMs: 10 });\r\n\r\n      expect(result.passed).toBe(true);\r\n      expect(result.discrepancies).toHaveLength(0);\r\n    });\r\n\r\n    it('fails when data differs after write', async () => {\r\n      const payload = buildWritePayload(\r\n        'prod-123',\r\n        'Test description that is long enough',\r\n        { material: 'Steel' },\r\n        {},\r\n        [],\r\n        [],\r\n        [],\r\n      );\r\n\r\n      mockStorage.updateProduct.mockResolvedValue(undefined);\r\n      mockStorage.getProductById.mockResolvedValue({\r\n        id: 'prod-123',\r\n        description: 'Different description', // Mismatch\r\n        specifications: { material: 'Steel' },\r\n        features: null,\r\n        benefits: null,\r\n        tags: null,\r\n      });\r\n\r\n      const result = await verifyDatabaseWrite(payload, { ...mockConfig, retryDelayMs: 10, maxDbWriteRetries: 1 });\r\n\r\n      expect(result.passed).toBe(false);\r\n      expect(result.discrepancies.length).toBeGreaterThan(0);\r\n      expect(result.discrepancies[0].field).toBe('description');\r\n    });\r\n\r\n    it('retries on failure', async () => {\r\n      const payload = buildWritePayload('prod-123', 'Test', {}, {}, [], [], []);\r\n\r\n      mockStorage.updateProduct.mockRejectedValueOnce(new Error('DB Error')).mockResolvedValue(undefined);\r\n      mockStorage.getProductById.mockResolvedValue({\r\n        id: 'prod-123',\r\n        description: 'Test',\r\n        specifications: null,\r\n        features: null,\r\n        benefits: null,\r\n        tags: null,\r\n      });\r\n\r\n      const result = await verifyDatabaseWrite(payload, { ...mockConfig, retryDelayMs: 10 });\r\n\r\n      expect(result.passed).toBe(true);\r\n      expect(result.retryCount).toBe(1);\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// GATE 4 TESTS\r\n// ============================================\r\n\r\ndescribe('Gate 4: Cross-Source Truth Verification', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('verifyCrossSourceTruth', () => {\r\n    it('passes when sources agree', async () => {\r\n      const extractions: ExtractedData[] = [\r\n        { ...mockExtractedData, sourceUrl: 'https://source1.com' },\r\n        { ...mockExtractedData, sourceUrl: 'https://source2.com' },\r\n      ];\r\n\r\n      const aggregated = {\r\n        productName: '50mm Spacer Bar',\r\n        description: 'Industrial steel spacer',\r\n        specifications: { material: 'Galvanized Steel' },\r\n        sources: ['https://source1.com', 'https://source2.com'],\r\n        fieldSources: {},\r\n      };\r\n\r\n      // Mock claim extraction and verification\r\n      mockGenerateContent\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({ claims: [{ claim: 'Material is steel', importance: 'high' }] }),\r\n        })\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({ supports: true, contradicts: false, neutral: false, reasoning: '' }),\r\n        })\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({ supports: true, contradicts: false, neutral: false, reasoning: '' }),\r\n        });\r\n\r\n      const result = await verifyCrossSourceTruth(extractions, aggregated);\r\n\r\n      expect(result.passed).toBe(true);\r\n      expect(result.overallVerdict).toBe('ALL_VERIFIED');\r\n    });\r\n\r\n    it('detects conflicts between sources', async () => {\r\n      const extractions: ExtractedData[] = [\r\n        { ...mockExtractedData, specifications: { material: 'Steel' }, sourceUrl: 'https://source1.com' },\r\n        { ...mockExtractedData, specifications: { material: 'Aluminum' }, sourceUrl: 'https://source2.com' },\r\n      ];\r\n\r\n      const aggregated = {\r\n        productName: '50mm Spacer Bar',\r\n        description: 'Industrial spacer',\r\n        specifications: { material: 'Steel' },\r\n        sources: ['https://source1.com', 'https://source2.com'],\r\n        fieldSources: { material: { value: 'Steel', agreedBy: ['https://source1.com'], confidence: 'LOW' as const } },\r\n      };\r\n\r\n      // Mock equivalence check as conflict\r\n      mockGenerateContent.mockResolvedValueOnce({\r\n        text: JSON.stringify({\r\n          allEquivalent: false,\r\n          compatible: false,\r\n          resolvedValue: null,\r\n          reasoning: 'Steel and Aluminum are different materials',\r\n        }),\r\n      });\r\n\r\n      const result = await verifyCrossSourceTruth(extractions, aggregated);\r\n\r\n      expect(result.conflicts.length).toBeGreaterThan(0);\r\n      expect(result.conflicts[0].resolution).toBe('CONFLICT');\r\n    });\r\n\r\n    it('detects contradicted claims', async () => {\r\n      const extractions: ExtractedData[] = [\r\n        { ...mockExtractedData, rawExtract: 'Load capacity: 500kg' },\r\n        { ...mockExtractedData, rawExtract: 'Load capacity: 200kg', sourceUrl: 'https://source2.com' },\r\n      ];\r\n\r\n      const aggregated = {\r\n        productName: 'Spacer',\r\n        description: 'Load capacity is 500kg',\r\n        specifications: {},\r\n        sources: ['https://source1.com', 'https://source2.com'],\r\n        fieldSources: {},\r\n      };\r\n\r\n      mockGenerateContent\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({ claims: [{ claim: 'Load capacity is 500kg', importance: 'high' }] }),\r\n        })\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({ supports: true, contradicts: false, neutral: false, reasoning: '' }),\r\n        })\r\n        .mockResolvedValueOnce({\r\n          text: JSON.stringify({\r\n            supports: false,\r\n            contradicts: true,\r\n            neutral: false,\r\n            reasoning: 'Says 200kg not 500kg',\r\n          }),\r\n        });\r\n\r\n      const result = await verifyCrossSourceTruth(extractions, aggregated);\r\n\r\n      expect(result.truthChecks.some((t) => t.verdict === 'CONTRADICTED')).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('resolveConflicts', () => {\r\n    it('uses highest trust source for conflicts', () => {\r\n      const conflicts = [\r\n        {\r\n          field: 'material',\r\n          values: [\r\n            { source: 'https://ndspro.com', value: 'Steel' },\r\n            { source: 'https://random.com', value: 'Plastic' },\r\n          ],\r\n          resolution: 'CONFLICT' as const,\r\n          resolvedValue: null,\r\n          reasoning: 'Different materials',\r\n        },\r\n      ];\r\n\r\n      const extractions: ExtractedData[] = [\r\n        { ...mockExtractedData, sourceUrl: 'https://ndspro.com' },\r\n        { ...mockExtractedData, sourceUrl: 'https://random.com' },\r\n      ];\r\n\r\n      const { resolved, unresolved } = resolveConflicts(conflicts, extractions);\r\n\r\n      expect(resolved.material).toBe('Steel'); // Higher trust source\r\n      expect(unresolved.length).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('filterContradictedClaims', () => {\r\n    it('removes sentences with contradicted claims', () => {\r\n      const description = 'The product is made of steel. It has a load capacity of 500kg. Very durable.';\r\n      const truthChecks = [\r\n        {\r\n          claim: 'load capacity of 500kg',\r\n          supportedBy: [],\r\n          contradictedBy: ['https://source.com'],\r\n          verdict: 'CONTRADICTED' as const,\r\n        },\r\n      ];\r\n\r\n      const filtered = filterContradictedClaims(description, truthChecks);\r\n\r\n      expect(filtered).not.toContain('500kg');\r\n      expect(filtered).toContain('steel');\r\n      expect(filtered).toContain('durable');\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// DATA EXTRACTION TESTS\r\n// ============================================\r\n\r\ndescribe('Data Extraction', () => {\r\n  describe('aggregateExtractions', () => {\r\n    it('aggregates data from multiple sources', () => {\r\n      const extractions: ExtractedData[] = [\r\n        {\r\n          sourceUrl: 'https://source1.com',\r\n          productName: 'Spacer Bar',\r\n          description: 'Steel spacer',\r\n          specifications: { material: 'Steel', dimensions: '50mm' },\r\n          relatedProducts: [],\r\n          installationInfo: '',\r\n          certifications: ['ISO 9001'],\r\n          rawExtract: '',\r\n        },\r\n        {\r\n          sourceUrl: 'https://source2.com',\r\n          productName: 'Spacer Bar',\r\n          description: 'Industrial spacer bar',\r\n          specifications: { material: 'Steel', finish: 'Galvanized' },\r\n          relatedProducts: [],\r\n          installationInfo: '',\r\n          certifications: ['CE'],\r\n          rawExtract: '',\r\n        },\r\n      ];\r\n\r\n      const trustLevels = new Map([\r\n        ['https://source1.com', 10],\r\n        ['https://source2.com', 8],\r\n      ]);\r\n\r\n      const result = aggregateExtractions(extractions, trustLevels);\r\n\r\n      expect(result.productName).toBe('Spacer Bar');\r\n      expect(result.specifications.material).toBe('Steel');\r\n      expect(result.specifications.dimensions).toBe('50mm');\r\n      expect(result.specifications.finish).toBe('Galvanized');\r\n      expect(result.sources).toHaveLength(2);\r\n    });\r\n\r\n    it('prefers higher trust sources', () => {\r\n      const extractions: ExtractedData[] = [\r\n        {\r\n          sourceUrl: 'https://official.com',\r\n          productName: 'Official Name',\r\n          description: 'Official description',\r\n          specifications: {},\r\n          relatedProducts: [],\r\n          installationInfo: '',\r\n          certifications: [],\r\n          rawExtract: '',\r\n        },\r\n        {\r\n          sourceUrl: 'https://random.com',\r\n          productName: 'Wrong Name',\r\n          description: 'Random description',\r\n          specifications: {},\r\n          relatedProducts: [],\r\n          installationInfo: '',\r\n          certifications: [],\r\n          rawExtract: '',\r\n        },\r\n      ];\r\n\r\n      const trustLevels = new Map([\r\n        ['https://official.com', 10],\r\n        ['https://random.com', 4],\r\n      ]);\r\n\r\n      const result = aggregateExtractions(extractions, trustLevels);\r\n\r\n      expect(result.productName).toBe('Official Name');\r\n    });\r\n  });\r\n\r\n  describe('extractFeatures', () => {\r\n    it('extracts features from specifications', () => {\r\n      const specs = { material: 'Steel', dimensions: '50mm', finish: 'Matte' };\r\n      const description = 'Can be installed with nail or glue';\r\n\r\n      const features = extractFeatures(specs, description);\r\n\r\n      expect(features.material).toBe('Steel');\r\n      expect(features.finish).toBe('Matte');\r\n      expect(features.installation as string[]).toContain('nail');\r\n      expect(features.installation as string[]).toContain('glue');\r\n    });\r\n  });\r\n\r\n  describe('extractBenefits', () => {\r\n    it('extracts benefits from description', () => {\r\n      const description =\r\n        'This durable product is easy to install and water-resistant. It is eco-friendly and long-lasting.';\r\n\r\n      const benefits = extractBenefits(description);\r\n\r\n      expect(benefits).toContain('Durable');\r\n      expect(benefits.some((b) => b.toLowerCase().includes('water'))).toBe(true);\r\n      expect(benefits.some((b) => b.toLowerCase().includes('eco'))).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('extractTags', () => {\r\n    it('extracts tags from various sources', () => {\r\n      const specs = { material: 'steel', style: 'industrial' };\r\n      const description = 'Perfect for construction and outdoor use';\r\n      const productName = 'Heavy Duty Spacer';\r\n\r\n      const tags = extractTags(specs, description, productName);\r\n\r\n      expect(tags).toContain('steel');\r\n      expect(tags).toContain('industrial');\r\n      expect(tags).toContain('construction');\r\n      expect(tags).toContain('outdoor');\r\n    });\r\n  });\r\n});\r\n\r\n// ============================================\r\n// INTEGRATION TEST (Mock End-to-End)\r\n// ============================================\r\n\r\ndescribe('Pipeline Integration (Mocked)', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    mockFetch.mockResolvedValue({\r\n      ok: true,\r\n      arrayBuffer: () => Promise.resolve(new ArrayBuffer(8)),\r\n      text: () => Promise.resolve('<html>Product page</html>'),\r\n    });\r\n  });\r\n\r\n  it('processes a product through all gates', { timeout: 15000 }, async () => {\r\n    // Setup mocks for full pipeline\r\n    mockStorage.getProductById.mockResolvedValue({\r\n      id: 'prod-123',\r\n      name: '50mm Spacer Bar',\r\n      cloudinaryUrl: 'https://cloudinary.com/image.jpg',\r\n      cloudinaryPublicId: 'image',\r\n    });\r\n\r\n    mockStorage.getProductAnalysisByProductId.mockResolvedValue({\r\n      category: 'Construction',\r\n      subcategory: 'Reinforcement',\r\n      materials: ['Steel'],\r\n      colors: ['Silver'],\r\n      style: 'Industrial',\r\n      usageContext: 'Construction',\r\n      targetDemographic: 'Contractors',\r\n      confidence: 85,\r\n    });\r\n\r\n    // Mock all AI calls to return success\r\n    mockGenerateContent.mockResolvedValue({\r\n      text: JSON.stringify({\r\n        similar: true,\r\n        confidence: 90,\r\n        reasoning: 'Match',\r\n        allEquivalent: true,\r\n        compatible: true,\r\n        resolvedValue: 'Steel',\r\n        supports: true,\r\n        contradicts: false,\r\n        neutral: false,\r\n        productName: '50mm Spacer',\r\n        description: 'Steel spacer',\r\n        specifications: { material: 'Steel' },\r\n        claims: [],\r\n      }),\r\n    });\r\n\r\n    mockStorage.updateProduct.mockResolvedValue(undefined);\r\n    mockStorage.getProductById\r\n      .mockResolvedValueOnce({\r\n        id: 'prod-123',\r\n        name: '50mm Spacer Bar',\r\n        cloudinaryUrl: 'https://cloudinary.com/image.jpg',\r\n        cloudinaryPublicId: 'image',\r\n      })\r\n      .mockResolvedValue({\r\n        id: 'prod-123',\r\n        description: 'Steel spacer',\r\n        specifications: { material: 'Steel' },\r\n        features: null,\r\n        benefits: null,\r\n        tags: null,\r\n      });\r\n\r\n    // Import pipeline after mocks\r\n    const { runEnrichmentPipeline } = await import('../services/enrichment/pipeline');\r\n\r\n    const result = await runEnrichmentPipeline({\r\n      productId: 'prod-123',\r\n      config: mockConfig,\r\n    });\r\n\r\n    expect(result.success).toBeDefined();\r\n    expect(result.report).toBeDefined();\r\n    expect(result.report.productId).toBe('prod-123');\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\errorTracking.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\fileSearch.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\geminiService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\generationDTO.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3997,4000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3997,4000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7401,7404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7401,7404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Unit tests for Generation DTO Transformer\r\n *\r\n * Tests the toGenerationDTO and toGenerationDTOArray functions\r\n * that transform database Generation models into API-friendly DTOs.\r\n */\r\n\r\nimport { describe, it, expect } from 'vitest';\r\nimport { toGenerationDTO, toGenerationDTOArray } from '../dto/generationDTO';\r\nimport { Generation } from '@shared/schema';\r\n\r\ndescribe('Generation DTO Transformer', () => {\r\n  // Base generation object with all required fields\r\n  const baseGen: Partial<Generation> = {\r\n    id: '123-test-id',\r\n    userId: 'user-1',\r\n    prompt: 'test prompt',\r\n    originalImagePaths: [],\r\n    resolution: '2K',\r\n    model: 'gemini-3-pro-image',\r\n    aspectRatio: '1:1',\r\n    status: 'completed',\r\n    parentGenerationId: null,\r\n    editPrompt: null,\r\n    editCount: 0,\r\n    createdAt: new Date('2026-01-25T12:00:00Z'),\r\n    updatedAt: new Date('2026-01-25T12:00:00Z'),\r\n    conversationHistory: null,\r\n    imagePath: null,\r\n  };\r\n\r\n  describe('toGenerationDTO', () => {\r\n    it('transforms Cloudinary URLs without modification', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'https://res.cloudinary.com/test-cloud/image/upload/v123/test.png',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('https://res.cloudinary.com/test-cloud/image/upload/v123/test.png');\r\n    });\r\n\r\n    it('prepends / to local paths', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'attached_assets/generations/results/test-image.png',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('/attached_assets/generations/results/test-image.png');\r\n    });\r\n\r\n    it('handles http URLs (not just https)', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'http://example.com/image.png',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('http://example.com/image.png');\r\n    });\r\n\r\n    it('falls back to imagePath if generatedImagePath is null', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: null,\r\n        imagePath: 'fallback/path/image.png',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('/fallback/path/image.png');\r\n    });\r\n\r\n    it('handles empty string imageUrl when both paths are null', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: null,\r\n        imagePath: null,\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('/');\r\n    });\r\n\r\n    it('sets canEdit to true when conversationHistory exists', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'test.png',\r\n        conversationHistory: [{ role: 'user', parts: [{ text: 'test' }] }],\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.canEdit).toBe(true);\r\n    });\r\n\r\n    it('sets canEdit to false when conversationHistory is null', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'test.png',\r\n        conversationHistory: null,\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.canEdit).toBe(false);\r\n    });\r\n\r\n    it('sets canEdit to true when conversationHistory is empty array (truthy)', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'test.png',\r\n        conversationHistory: [],\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      // Empty array is truthy, so !![] === true\r\n      expect(dto.canEdit).toBe(true);\r\n    });\r\n\r\n    it('handles null originalImagePaths by defaulting to empty array', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'test.png',\r\n        originalImagePaths: null as any,\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.originalImagePaths).toEqual([]);\r\n    });\r\n\r\n    it('preserves all other fields correctly', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'test.png',\r\n        editPrompt: 'make it darker',\r\n        editCount: 3,\r\n        parentGenerationId: 'parent-123',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.id).toBe('123-test-id');\r\n      expect(dto.userId).toBe('user-1');\r\n      expect(dto.prompt).toBe('test prompt');\r\n      expect(dto.resolution).toBe('2K');\r\n      expect(dto.model).toBe('gemini-3-pro-image');\r\n      expect(dto.aspectRatio).toBe('1:1');\r\n      expect(dto.status).toBe('completed');\r\n      expect(dto.editPrompt).toBe('make it darker');\r\n      expect(dto.editCount).toBe(3);\r\n      expect(dto.parentGenerationId).toBe('parent-123');\r\n      expect(dto.createdAt).toEqual(new Date('2026-01-25T12:00:00Z'));\r\n      expect(dto.updatedAt).toEqual(new Date('2026-01-25T12:00:00Z'));\r\n    });\r\n  });\r\n\r\n  describe('toGenerationDTOArray', () => {\r\n    it('transforms empty array correctly', () => {\r\n      const gens: Generation[] = [];\r\n      const dtos = toGenerationDTOArray(gens);\r\n\r\n      expect(dtos).toEqual([]);\r\n    });\r\n\r\n    it('transforms single item array', () => {\r\n      const gens = [\r\n        {\r\n          ...baseGen,\r\n          generatedImagePath: 'test-image-1.png',\r\n        },\r\n      ] as Generation[];\r\n\r\n      const dtos = toGenerationDTOArray(gens);\r\n\r\n      expect(dtos).toHaveLength(1);\r\n      expect(dtos[0].imageUrl).toBe('/test-image-1.png');\r\n    });\r\n\r\n    it('transforms multiple items correctly', () => {\r\n      const gens = [\r\n        {\r\n          ...baseGen,\r\n          id: 'gen-1',\r\n          generatedImagePath: 'image-1.png',\r\n        },\r\n        {\r\n          ...baseGen,\r\n          id: 'gen-2',\r\n          generatedImagePath: 'https://cloudinary.com/image-2.png',\r\n        },\r\n        {\r\n          ...baseGen,\r\n          id: 'gen-3',\r\n          generatedImagePath: 'image-3.png',\r\n          conversationHistory: [{ role: 'user', parts: [] }],\r\n        },\r\n      ] as Generation[];\r\n\r\n      const dtos = toGenerationDTOArray(gens);\r\n\r\n      expect(dtos).toHaveLength(3);\r\n      expect(dtos[0].id).toBe('gen-1');\r\n      expect(dtos[0].imageUrl).toBe('/image-1.png');\r\n      expect(dtos[0].canEdit).toBe(false);\r\n\r\n      expect(dtos[1].id).toBe('gen-2');\r\n      expect(dtos[1].imageUrl).toBe('https://cloudinary.com/image-2.png');\r\n      expect(dtos[1].canEdit).toBe(false);\r\n\r\n      expect(dtos[2].id).toBe('gen-3');\r\n      expect(dtos[2].imageUrl).toBe('/image-3.png');\r\n      expect(dtos[2].canEdit).toBe(true);\r\n    });\r\n\r\n    it('maintains order of input array', () => {\r\n      const gens = [\r\n        { ...baseGen, id: 'first', generatedImagePath: 'a.png' },\r\n        { ...baseGen, id: 'second', generatedImagePath: 'b.png' },\r\n        { ...baseGen, id: 'third', generatedImagePath: 'c.png' },\r\n      ] as Generation[];\r\n\r\n      const dtos = toGenerationDTOArray(gens);\r\n\r\n      expect(dtos[0].id).toBe('first');\r\n      expect(dtos[1].id).toBe('second');\r\n      expect(dtos[2].id).toBe('third');\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('handles undefined generatedImagePath', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: undefined as any,\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('/');\r\n    });\r\n\r\n    it('handles very long Cloudinary URLs', () => {\r\n      const longUrl =\r\n        'https://res.cloudinary.com/abc/image/upload/v1234567890/very/long/path/to/generated/image/with/many/segments/and/transformations/w_800,h_600,c_fill/test-image.png';\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: longUrl,\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe(longUrl);\r\n    });\r\n\r\n    it('handles paths with special characters', () => {\r\n      const gen = {\r\n        ...baseGen,\r\n        generatedImagePath: 'attached_assets/gen-123_test-image (copy).png',\r\n      } as Generation;\r\n\r\n      const dto = toGenerationDTO(gen);\r\n\r\n      expect(dto.imageUrl).toBe('/attached_assets/gen-123_test-image (copy).png');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\generationWorker.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\helpers\\testApp.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\ideaBankService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\jobQueueIntegration.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Queue' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":15,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Queue"},"fix":{"range":[484,490],"text":""},"desc":"Remove unused variable \"Queue\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Worker' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":23,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Worker"},"fix":{"range":[489,497],"text":""},"desc":"Remove unused variable \"Worker\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QueueEvents' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":41,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"QueueEvents"},"fix":{"range":[502,515],"text":""},"desc":"Remove unused variable \"QueueEvents\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EventEmitter' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":22,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"EventEmitter"},"fix":{"range":[534,574],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QUEUE_NAMES' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"QUEUE_NAMES"},"fix":{"range":[726,742],"text":""},"desc":"Remove unused variable \"QUEUE_NAMES\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":341,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11759,11762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11759,11762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11890,11893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11890,11893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":641,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":641,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23589,23592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23589,23592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1086,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1086,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39826,39829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39826,39829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\memoryManager.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\monitoring.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pool' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":14,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"pool"},"fix":{"range":[157,188],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Redis' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Redis"},"fix":{"range":[397,432],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1208,1211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1208,1211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2787,2790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2787,2790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3877,3880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3877,3880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4926,4929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4926,4929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5748,5751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5748,5751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6323,6326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6323,6326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9145,9148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9145,9148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":305,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11621,11624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11621,11624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":489,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":489,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17667,17670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17667,17670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\patternExtraction.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\performanceMetrics.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\pricingEstimator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\productKnowledge.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\quotaMonitoringService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\ragEndpoints.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\rateLimit.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[286,289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[286,289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2069,2072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2069,2072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3728,3731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3728,3731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3738,3741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3738,3741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport request from 'supertest';\r\nimport express, { Express } from 'express';\r\nimport rateLimit from 'express-rate-limit';\r\n\r\n// Helper to create a fresh test app with a limiter for each test\r\nfunction createFreshTestApp(\r\n  limiterOptions: { windowMs: number; max: number; handler?: any }\r\n): Express {\r\n  const limiter = rateLimit({\r\n    windowMs: limiterOptions.windowMs,\r\n    max: limiterOptions.max,\r\n    standardHeaders: true,\r\n    legacyHeaders: false,\r\n    handler: limiterOptions.handler,\r\n  });\r\n\r\n  const app = express();\r\n  app.use('/test', limiter);\r\n  app.get('/test', (req, res) => res.json({ success: true }));\r\n  app.post('/test', (req, res) => res.json({ success: true }));\r\n  return app;\r\n}\r\n\r\ndescribe('Rate Limiting Middleware', () => {\r\n  describe('API Limiter behavior', () => {\r\n    it('should allow requests within limit', async () => {\r\n      const app = createFreshTestApp({ windowMs: 60000, max: 100 });\r\n      const response = await request(app).get('/test');\r\n      expect(response.status).toBe(200);\r\n      expect(response.body).toEqual({ success: true });\r\n    });\r\n\r\n    it('should include rate limit headers', async () => {\r\n      const app = createFreshTestApp({ windowMs: 60000, max: 100 });\r\n      const response = await request(app).get('/test');\r\n      expect(response.headers['ratelimit-limit']).toBe('100');\r\n      expect(response.headers['ratelimit-remaining']).toBeDefined();\r\n    });\r\n\r\n    it('should return 429 when limit exceeded', async () => {\r\n      // Create a fresh limiter with very low limit\r\n      const app = createFreshTestApp({ windowMs: 60000, max: 2 });\r\n\r\n      // Make requests up to the limit\r\n      await request(app).get('/test');\r\n      await request(app).get('/test');\r\n\r\n      // This should be rate limited\r\n      const response = await request(app).get('/test');\r\n      expect(response.status).toBe(429);\r\n    });\r\n\r\n    it('should include retry information in 429 response', async () => {\r\n      const app = createFreshTestApp({\r\n        windowMs: 60000,\r\n        max: 1,\r\n        handler: (req: any, res: any) => {\r\n          res.status(429).json({ error: 'Too many requests', retryAfter: 60 });\r\n        },\r\n      });\r\n\r\n      await request(app).get('/test');\r\n      const response = await request(app).get('/test');\r\n\r\n      expect(response.status).toBe(429);\r\n      expect(response.body.error).toBe('Too many requests');\r\n    });\r\n  });\r\n\r\n  describe('Expensive Limiter behavior (20 req / hr)', () => {\r\n    it('should have correct window and max settings', async () => {\r\n      const app = createFreshTestApp({ windowMs: 3600000, max: 20 });\r\n      const response = await request(app).get('/test');\r\n      expect(response.status).toBe(200);\r\n      expect(response.headers['ratelimit-limit']).toBe('20');\r\n    });\r\n  });\r\n\r\n  describe('Edit Limiter behavior (30 req / hr)', () => {\r\n    it('should have correct window and max settings', async () => {\r\n      const app = createFreshTestApp({ windowMs: 3600000, max: 30 });\r\n      const response = await request(app).get('/test');\r\n      expect(response.status).toBe(200);\r\n      expect(response.headers['ratelimit-limit']).toBe('30');\r\n    });\r\n  });\r\n\r\n  describe('Login Limiter behavior (10 req / min)', () => {\r\n    it('should have correct window and max settings', async () => {\r\n      const app = createFreshTestApp({ windowMs: 60000, max: 10 });\r\n      const response = await request(app).post('/test');\r\n      expect(response.status).toBe(200);\r\n      expect(response.headers['ratelimit-limit']).toBe('10');\r\n    });\r\n\r\n    it('should block after exceeding login attempts', async () => {\r\n      const app = createFreshTestApp({\r\n        windowMs: 60000,\r\n        max: 3,\r\n        handler: (req: any, res: any) => {\r\n          res.status(429).json({ error: 'Too many login attempts', retryAfter: 60 });\r\n        },\r\n      });\r\n\r\n      // Make requests up to the limit\r\n      await request(app).post('/test');\r\n      await request(app).post('/test');\r\n      await request(app).post('/test');\r\n\r\n      // This should be blocked\r\n      const response = await request(app).post('/test');\r\n      expect(response.status).toBe(429);\r\n      expect(response.body.error).toBe('Too many login attempts');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\urlEnrichment.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1735,1738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1735,1738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2342,2345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2342,2345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2918,2921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2918,2921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3323,3326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3323,3326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4846,4849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4846,4849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5268,5271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5268,5271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5692,5695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5692,5695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6185,6188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6185,6188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * URL Enrichment Service Tests\r\n */\r\n\r\n\r\n\r\n// Mock storage\r\nvi.mock('../storage', () => ({\r\n  storage: {\r\n    getProductById: vi.fn(),\r\n    updateProduct: vi.fn(),\r\n  },\r\n}));\r\n\r\n// Mock the gemini client with retry wrapper\r\nvi.mock('../lib/geminiClient', () => ({\r\n  generateContentWithRetry: vi.fn().mockResolvedValue({\r\n    text: JSON.stringify({\r\n      description: 'Test product description',\r\n      specifications: { material: 'steel' },\r\n      features: { size: 'large' },\r\n      benefits: ['durable', 'lightweight'],\r\n      tags: ['construction', 'outdoor'],\r\n    }),\r\n  }),\r\n}));\r\n\r\nimport { enrichFromUrl, saveEnrichmentDraft, type EnrichmentDraft } from '../services/enrichmentServiceWithUrl';\r\nimport { storage } from '../storage';\r\n\r\ndescribe('URL Enrichment Service', () => {\r\n  const mockProduct = {\r\n    id: 'prod-123',\r\n    name: 'Test Product',\r\n    cloudinaryUrl: 'https://cloudinary.com/test.jpg',\r\n    category: 'flooring',\r\n    enrichmentStatus: 'pending',\r\n    description: null,\r\n    features: null,\r\n    benefits: null,\r\n    tags: null,\r\n  };\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('enrichFromUrl', () => {\r\n    it('returns error when product is not found', async () => {\r\n      vi.mocked(storage.getProductById).mockResolvedValue(null);\r\n\r\n      const result = await enrichFromUrl({\r\n        productId: 'non-existent',\r\n        productUrl: 'https://example.com/product',\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Product not found');\r\n      expect(result.enrichmentDraft).toBeNull();\r\n    });\r\n\r\n    it('returns error for invalid URL', async () => {\r\n      vi.mocked(storage.getProductById).mockResolvedValue(mockProduct as any);\r\n\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: 'not-a-valid-url',\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n      expect(result.error).toBe('Invalid URL provided');\r\n      expect(result.enrichmentDraft).toBeNull();\r\n    });\r\n\r\n    it('returns success with enrichment draft for valid request', async () => {\r\n      // This would normally require mocking the Gemini API, but since we're\r\n      // testing the service structure, we'll verify the basic flow works\r\n      vi.mocked(storage.getProductById).mockResolvedValue(mockProduct as any);\r\n\r\n      // The actual API call would fail in tests, so we expect an error\r\n      // but the structure should be correct\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: 'https://example.com/product',\r\n      });\r\n\r\n      // Either success or an error from the API call\r\n      expect(result.productId).toBe('prod-123');\r\n      expect(typeof result.success).toBe('boolean');\r\n    });\r\n\r\n    it('includes correct productId in response', async () => {\r\n      vi.mocked(storage.getProductById).mockResolvedValue(mockProduct as any);\r\n\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: 'https://ndspro.com/product/test',\r\n      });\r\n\r\n      expect(result.productId).toBe('prod-123');\r\n    });\r\n  });\r\n\r\n  describe('saveEnrichmentDraft', () => {\r\n    it('updates product with draft and sets status to draft', async () => {\r\n      vi.mocked(storage.updateProduct).mockResolvedValue({} as any);\r\n\r\n      const draft: EnrichmentDraft = {\r\n        description: 'Test description',\r\n        features: { material: 'plastic' },\r\n        benefits: ['durable'],\r\n        specifications: { weight: '5lbs' },\r\n        tags: ['outdoor'],\r\n        confidence: 75,\r\n        sources: [{ type: 'url', detail: 'example.com' }],\r\n        generatedAt: new Date().toISOString(),\r\n      };\r\n\r\n      const result = await saveEnrichmentDraft('prod-123', draft);\r\n\r\n      expect(result).toBe(true);\r\n      expect(storage.updateProduct).toHaveBeenCalledWith('prod-123', {\r\n        enrichmentDraft: draft,\r\n        enrichmentStatus: 'draft',\r\n      });\r\n    });\r\n\r\n    it('returns false when update fails', async () => {\r\n      vi.mocked(storage.updateProduct).mockRejectedValue(new Error('DB Error'));\r\n\r\n      const draft: EnrichmentDraft = {\r\n        description: 'Test',\r\n        features: {},\r\n        benefits: [],\r\n        specifications: {},\r\n        tags: [],\r\n        confidence: 50,\r\n        sources: [],\r\n        generatedAt: new Date().toISOString(),\r\n      };\r\n\r\n      const result = await saveEnrichmentDraft('prod-123', draft);\r\n\r\n      expect(result).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Trust Level Calculation', () => {\r\n    // We can't directly test getTrustLevel since it's not exported,\r\n    // but we verify it's applied through the enrichFromUrl function\r\n\r\n    it('uses higher trust for known manufacturer domains', async () => {\r\n      vi.mocked(storage.getProductById).mockResolvedValue(mockProduct as any);\r\n\r\n      // Test with known domain - the trust level affects confidence\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: 'https://ndspro.com/product/test',\r\n      });\r\n\r\n      expect(result.productId).toBe('prod-123');\r\n    });\r\n\r\n    it('uses default trust for unknown domains', async () => {\r\n      vi.mocked(storage.getProductById).mockResolvedValue(mockProduct as any);\r\n\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: 'https://unknown-domain.com/product',\r\n      });\r\n\r\n      expect(result.productId).toBe('prod-123');\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('URL Validation', () => {\r\n  it('rejects malformed URLs', async () => {\r\n    vi.mocked(storage.getProductById).mockResolvedValue({\r\n      id: 'prod-123',\r\n      name: 'Test',\r\n    } as any);\r\n\r\n    const testCases = [\r\n      'not-a-url',\r\n      'ftp://not-http.com',\r\n      '',\r\n      '   ',\r\n    ];\r\n\r\n    for (const url of testCases) {\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: url,\r\n      });\r\n\r\n      expect(result.success).toBe(false);\r\n    }\r\n  });\r\n\r\n  it('accepts valid HTTP/HTTPS URLs', async () => {\r\n    vi.mocked(storage.getProductById).mockResolvedValue({\r\n      id: 'prod-123',\r\n      name: 'Test',\r\n    } as any);\r\n\r\n    const validUrls = [\r\n      'https://example.com/product',\r\n      'http://example.com/product',\r\n      'https://www.example.com/product?id=123',\r\n    ];\r\n\r\n    for (const url of validUrls) {\r\n      const result = await enrichFromUrl({\r\n        productId: 'prod-123',\r\n        productUrl: url,\r\n      });\r\n\r\n      // Should not fail with \"Invalid URL\" error\r\n      expect(result.error).not.toBe('Invalid URL provided');\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\validation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4730,4733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4730,4733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { registerSchema, loginSchema, productSchema, transformSchema } from '../validation/schemas';\r\nimport { validate } from '../middleware/validate';\r\nimport { Request, Response } from 'express';\r\n\r\ndescribe('Validation Schemas', () => {\r\n  describe('registerSchema', () => {\r\n    it('accepts valid registration data', () => {\r\n      const result = registerSchema.safeParse({\r\n        email: 'test@example.com',\r\n        password: 'ValidPassword123!'\r\n      });\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('rejects missing email', () => {\r\n      const result = registerSchema.safeParse({\r\n        password: 'ValidPassword123!'\r\n      });\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it('rejects invalid email format', () => {\r\n      const result = registerSchema.safeParse({\r\n        email: 'invalid-email',\r\n        password: 'ValidPassword123!'\r\n      });\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.issues[0].message).toContain('email');\r\n      }\r\n    });\r\n\r\n    it('rejects password under 8 chars', () => {\r\n      const result = registerSchema.safeParse({\r\n        email: 'test@example.com',\r\n        password: 'short'\r\n      });\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.issues[0].message).toContain('8');\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('loginSchema', () => {\r\n    it('accepts valid login data', () => {\r\n      const result = loginSchema.safeParse({\r\n        email: 'test@example.com',\r\n        password: 'anypassword'\r\n      });\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('rejects empty email', () => {\r\n      const result = loginSchema.safeParse({\r\n        email: '',\r\n        password: 'anypassword'\r\n      });\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it('rejects empty password', () => {\r\n      const result = loginSchema.safeParse({\r\n        email: 'test@example.com',\r\n        password: ''\r\n      });\r\n      expect(result.success).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('productSchema', () => {\r\n    it('accepts valid product with name only', () => {\r\n      const result = productSchema.safeParse({\r\n        name: 'Test Product'\r\n      });\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('rejects missing name', () => {\r\n      const result = productSchema.safeParse({});\r\n      expect(result.success).toBe(false);\r\n    });\r\n\r\n    it('accepts optional description', () => {\r\n      const result = productSchema.safeParse({\r\n        name: 'Test Product',\r\n        description: 'A test product description'\r\n      });\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.data.description).toBe('A test product description');\r\n      }\r\n    });\r\n  });\r\n\r\n  describe('transformSchema', () => {\r\n    it('accepts valid transform request', () => {\r\n      const result = transformSchema.safeParse({\r\n        prompt: 'Generate a beautiful sunset image'\r\n      });\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.data.aspectRatio).toBe('1:1');\r\n      }\r\n    });\r\n\r\n    it('rejects missing prompt', () => {\r\n      const result = transformSchema.safeParse({});\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.issues[0].path).toContain('prompt');\r\n      }\r\n    });\r\n\r\n    it('accepts optional referenceImages', () => {\r\n      const result = transformSchema.safeParse({\r\n        prompt: 'Generate similar image',\r\n        referenceImages: ['base64image1', 'base64image2']\r\n      });\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.data.referenceImages).toHaveLength(2);\r\n      }\r\n    });\r\n\r\n    it('validates aspectRatio enum', () => {\r\n      const result = transformSchema.safeParse({\r\n        prompt: 'Generate landscape image',\r\n        aspectRatio: '16:9'\r\n      });\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.data.aspectRatio).toBe('16:9');\r\n      }\r\n    });\r\n\r\n    it('rejects invalid aspectRatio', () => {\r\n      const result = transformSchema.safeParse({\r\n        prompt: 'Generate image',\r\n        aspectRatio: '2:1'\r\n      });\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.issues[0].path).toContain('aspectRatio');\r\n      }\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Validation Middleware', () => {\r\n  describe('validate', () => {\r\n    const mockNext = vi.fn() as ReturnType<typeof vi.fn>;\r\n    const mockJson = vi.fn();\r\n    const mockStatus = vi.fn().mockReturnValue({ json: mockJson });\r\n\r\n    const createMockReq = (body: any): Partial<Request> => ({\r\n      body\r\n    });\r\n\r\n    const createMockRes = (): Partial<Response> => ({\r\n      status: mockStatus,\r\n      json: mockJson\r\n    });\r\n\r\n    beforeEach(() => {\r\n      vi.clearAllMocks();\r\n    });\r\n\r\n    it('calls next() for valid data', () => {\r\n      const req = createMockReq({ email: 'test@example.com', password: 'ValidPassword123!' });\r\n      const res = createMockRes();\r\n\r\n      const middleware = validate(registerSchema);\r\n      middleware(req as Request, res as Response, mockNext);\r\n\r\n      expect(mockNext).toHaveBeenCalled();\r\n      expect(mockStatus).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('returns 400 for invalid data', () => {\r\n      const req = createMockReq({ email: 'invalid', password: 'short' });\r\n      const res = createMockRes();\r\n\r\n      const middleware = validate(registerSchema);\r\n      middleware(req as Request, res as Response, mockNext);\r\n\r\n      expect(mockStatus).toHaveBeenCalledWith(400);\r\n      expect(mockNext).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('includes field name in error', () => {\r\n      const req = createMockReq({ password: 'ValidPassword123!' });\r\n      const res = createMockRes();\r\n\r\n      const middleware = validate(registerSchema);\r\n      middleware(req as Request, res as Response, mockNext);\r\n\r\n      expect(mockJson).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          details: expect.arrayContaining([\r\n            expect.objectContaining({ field: 'email' })\r\n          ])\r\n        })\r\n      );\r\n    });\r\n\r\n    it('includes error message in response', () => {\r\n      const req = createMockReq({ email: 'test@example.com', password: 'short' });\r\n      const res = createMockRes();\r\n\r\n      const middleware = validate(registerSchema);\r\n      middleware(req as Request, res as Response, mockNext);\r\n\r\n      expect(mockJson).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          error: 'Validation failed',\r\n          details: expect.arrayContaining([\r\n            expect.objectContaining({ message: expect.any(String) })\r\n          ])\r\n        })\r\n      );\r\n    });\r\n\r\n    it('does not expose Zod internals', () => {\r\n      const req = createMockReq({ email: 'invalid' });\r\n      const res = createMockRes();\r\n\r\n      const middleware = validate(registerSchema);\r\n      middleware(req as Request, res as Response, mockNext);\r\n\r\n      const jsonCall = mockJson.mock.calls[0][0];\r\n      expect(jsonCall).not.toHaveProperty('issues');\r\n      expect(jsonCall).not.toHaveProperty('name', 'ZodError');\r\n    });\r\n  });\r\n});\r\n\r\n// Note: Route integration tests have been moved to validation.integration.test.ts\r\n// Those tests require database connectivity and a fully initialized app.\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\__tests__\\visionAnalysisService.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[18,54],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VisionAnalysisResult' is defined but never used. Allowed unused vars must match /^_/u.","line":40,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"VisionAnalysisResult"},"fix":{"range":[1050,1080],"text":""},"desc":"Remove unused variable \"VisionAnalysisResult\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n\r\n// Use vi.hoisted to define mocks that will be available to vi.mock factories\r\nconst { mockGenerateContent, mockStorage, mockFetch } = vi.hoisted(() => {\r\n  const mockGenerateContent = vi.fn();\r\n  const mockStorage = {\r\n    getProductAnalysisByProductId: vi.fn(),\r\n    saveProductAnalysis: vi.fn(),\r\n    updateProductAnalysis: vi.fn(),\r\n    deleteProductAnalysis: vi.fn(),\r\n  };\r\n  const mockFetch = vi.fn();\r\n  return { mockGenerateContent, mockStorage, mockFetch };\r\n});\r\n\r\n// Mock the Gemini client\r\nvi.mock('../lib/gemini', () => ({\r\n  genAI: {\r\n    models: {\r\n      generateContent: mockGenerateContent,\r\n    },\r\n  },\r\n}));\r\n\r\n// Mock storage\r\nvi.mock('../storage', () => ({\r\n  storage: mockStorage,\r\n}));\r\n\r\n// Mock global fetch\r\nvi.stubGlobal('fetch', mockFetch);\r\n\r\n// Import the service after mocks are set up\r\nimport {\r\n  analyzeProductImage,\r\n  analyzeArbitraryImage,\r\n  getCachedAnalysis,\r\n  invalidateAnalysisCache,\r\n  generateImageFingerprint,\r\n  type VisionAnalysisResult,\r\n} from '../services/visionAnalysisService';\r\nimport type { Product, ProductAnalysis } from '@shared/schema';\r\n\r\ndescribe('VisionAnalysisService', () => {\r\n  // Test fixtures\r\n  const mockProduct: Product = {\r\n    id: 'product-123',\r\n    name: 'Oak Hardwood Flooring',\r\n    cloudinaryUrl: 'https://res.cloudinary.com/demo/image/upload/v1234/flooring.jpg',\r\n    cloudinaryPublicId: 'demo/flooring',\r\n    category: 'flooring',\r\n    description: null,\r\n    features: null,\r\n    benefits: null,\r\n    specifications: null,\r\n    tags: [],\r\n    sku: null,\r\n    enrichmentStatus: 'pending',\r\n    enrichmentDraft: null,\r\n    enrichmentVerifiedAt: null,\r\n    enrichmentSource: null,\r\n    createdAt: new Date(),\r\n  };\r\n\r\n  const mockCachedAnalysis: ProductAnalysis = {\r\n    id: 'analysis-123',\r\n    productId: 'product-123',\r\n    imageFingerprint: 'demo/flooring',\r\n    category: 'flooring',\r\n    subcategory: 'hardwood',\r\n    materials: ['oak', 'wood'],\r\n    colors: ['natural oak', 'golden'],\r\n    style: 'traditional',\r\n    usageContext: 'residential living room',\r\n    targetDemographic: 'homeowners',\r\n    detectedText: null,\r\n    confidence: 92,\r\n    modelVersion: 'gemini-3-pro-preview',\r\n    analyzedAt: new Date(),\r\n    createdAt: new Date(),\r\n  };\r\n\r\n  const mockVisionResponse = {\r\n    text: JSON.stringify({\r\n      category: 'flooring',\r\n      subcategory: 'hardwood',\r\n      materials: ['oak', 'wood'],\r\n      colors: ['natural oak', 'golden brown'],\r\n      style: 'traditional',\r\n      usageContext: 'residential living room',\r\n      targetDemographic: 'homeowners',\r\n      detectedText: null,\r\n      confidence: 88,\r\n    }),\r\n  };\r\n\r\n  const mockImageBuffer = Buffer.from('fake-image-data');\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n\r\n    // Reset default mock implementations\r\n    mockFetch.mockResolvedValue({\r\n      ok: true,\r\n      arrayBuffer: () => Promise.resolve(mockImageBuffer),\r\n    });\r\n\r\n    mockGenerateContent.mockResolvedValue(mockVisionResponse);\r\n    mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n    mockStorage.saveProductAnalysis.mockResolvedValue(mockCachedAnalysis);\r\n    mockStorage.updateProductAnalysis.mockResolvedValue(mockCachedAnalysis);\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.resetModules();\r\n  });\r\n\r\n  // ============================================\r\n  // generateImageFingerprint Tests\r\n  // ============================================\r\n  describe('generateImageFingerprint', () => {\r\n    it('generates fingerprint from cloudinaryPublicId', () => {\r\n      const fingerprint = generateImageFingerprint(mockProduct);\r\n      expect(fingerprint).toBe('demo/flooring');\r\n    });\r\n\r\n    it('handles different cloudinaryPublicIds', () => {\r\n      const product = {\r\n        ...mockProduct,\r\n        cloudinaryPublicId: 'folder/subfolder/image_v2',\r\n      };\r\n      const fingerprint = generateImageFingerprint(product);\r\n      expect(fingerprint).toBe('folder/subfolder/image_v2');\r\n    });\r\n\r\n    it('handles empty cloudinaryPublicId', () => {\r\n      const product = {\r\n        ...mockProduct,\r\n        cloudinaryPublicId: '',\r\n      };\r\n      const fingerprint = generateImageFingerprint(product);\r\n      expect(fingerprint).toBe('');\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // analyzeProductImage Tests\r\n  // ============================================\r\n  describe('analyzeProductImage', () => {\r\n    describe('Rate Limiting', () => {\r\n      it('allows requests under the rate limit', async () => {\r\n        const userId = 'user-rate-test-1';\r\n        const result = await analyzeProductImage(mockProduct, userId);\r\n        expect(result.success).toBe(true);\r\n      });\r\n\r\n      it('blocks requests exceeding rate limit (10 per minute)', async () => {\r\n        const userId = 'user-rate-limit-exceeded';\r\n\r\n        // Make 10 successful requests\r\n        for (let i = 0; i < 10; i++) {\r\n          await analyzeProductImage(mockProduct, userId);\r\n        }\r\n\r\n        // 11th request should be rate limited\r\n        const result = await analyzeProductImage(mockProduct, userId);\r\n\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('RATE_LIMITED');\r\n          expect(result.error.message).toContain('Too many analysis requests');\r\n        }\r\n      });\r\n\r\n      it('allows requests from different users independently', async () => {\r\n        const userId1 = 'user-independent-1';\r\n        const userId2 = 'user-independent-2';\r\n\r\n        // Make 10 requests for user 1\r\n        for (let i = 0; i < 10; i++) {\r\n          await analyzeProductImage(mockProduct, userId1);\r\n        }\r\n\r\n        // User 2 should still be able to make requests\r\n        const result = await analyzeProductImage(mockProduct, userId2);\r\n        expect(result.success).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('Cache Hit Path', () => {\r\n      it('returns cached analysis when fingerprint matches', async () => {\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(mockCachedAnalysis);\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-cache-hit');\r\n\r\n        expect(result.success).toBe(true);\r\n        if (result.success) {\r\n          expect(result.analysis.category).toBe('flooring');\r\n          expect(result.analysis.subcategory).toBe('hardwood');\r\n          expect(result.analysis.confidence).toBe(92);\r\n        }\r\n\r\n        // Should not call Gemini API\r\n        expect(mockGenerateContent).not.toHaveBeenCalled();\r\n      });\r\n\r\n      it('skips cache and calls API when forceRefresh is true', async () => {\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(mockCachedAnalysis);\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-force-refresh', true);\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(mockGenerateContent).toHaveBeenCalled();\r\n      });\r\n\r\n      it('calls API when cache fingerprint does not match', async () => {\r\n        const outdatedCache = {\r\n          ...mockCachedAnalysis,\r\n          imageFingerprint: 'old/fingerprint',\r\n        };\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(outdatedCache);\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-fingerprint-mismatch');\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(mockGenerateContent).toHaveBeenCalled();\r\n      });\r\n    });\r\n\r\n    describe('Cache Miss Path', () => {\r\n      it('calls Gemini API on cache miss', async () => {\r\n        // Both calls return null - initial cache check and upsert check\r\n        mockStorage.getProductAnalysisByProductId\r\n          .mockResolvedValueOnce(null) // Initial cache check\r\n          .mockResolvedValueOnce(null); // Upsert check\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-cache-miss');\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(mockGenerateContent).toHaveBeenCalled();\r\n        expect(mockFetch).toHaveBeenCalled();\r\n      });\r\n\r\n      it('saves analysis to cache after API call', async () => {\r\n        // Both calls return null - initial cache check and upsert check\r\n        mockStorage.getProductAnalysisByProductId\r\n          .mockResolvedValueOnce(null) // Initial cache check\r\n          .mockResolvedValueOnce(null); // Upsert check - no existing, so save\r\n\r\n        await analyzeProductImage(mockProduct, 'user-save-cache');\r\n\r\n        expect(mockStorage.saveProductAnalysis).toHaveBeenCalledWith(\r\n          expect.objectContaining({\r\n            productId: 'product-123',\r\n            imageFingerprint: 'demo/flooring',\r\n            category: 'flooring',\r\n          }),\r\n        );\r\n      });\r\n\r\n      it('updates existing cache entry on refresh', async () => {\r\n        // With forceRefresh=true, it skips the initial cache check\r\n        // After API call, it checks for existing entry (line 145) and finds one\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(mockCachedAnalysis);\r\n\r\n        await analyzeProductImage(mockProduct, 'user-update-cache', true);\r\n\r\n        // Should update, not create (because existing entry was found)\r\n        expect(mockStorage.updateProductAnalysis).toHaveBeenCalled();\r\n      });\r\n    });\r\n\r\n    describe('API Response Handling', () => {\r\n      it('parses JSON response from Gemini', async () => {\r\n        // Both cache checks return null to ensure API is called\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-json-parse');\r\n\r\n        expect(result.success).toBe(true);\r\n        if (result.success) {\r\n          // These should match the mockVisionResponse values\r\n          expect(result.analysis.category).toBe('flooring');\r\n          expect(result.analysis.materials).toEqual(['oak', 'wood']);\r\n          expect(result.analysis.colors).toEqual(['natural oak', 'golden brown']);\r\n        }\r\n      });\r\n\r\n      it('handles JSON embedded in text response', async () => {\r\n        mockGenerateContent.mockResolvedValue({\r\n          text:\r\n            'Here is the analysis:\\n' +\r\n            JSON.stringify({\r\n              category: 'furniture',\r\n              subcategory: 'chair',\r\n              materials: ['metal'],\r\n              colors: ['black'],\r\n              style: 'modern',\r\n              usageContext: 'office',\r\n              targetDemographic: 'professionals',\r\n              detectedText: null,\r\n              confidence: 75,\r\n            }) +\r\n            '\\nThank you!',\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-embedded-json');\r\n\r\n        expect(result.success).toBe(true);\r\n        if (result.success) {\r\n          expect(result.analysis.category).toBe('furniture');\r\n        }\r\n      });\r\n\r\n      it('returns API_ERROR when response has no JSON', async () => {\r\n        mockGenerateContent.mockResolvedValue({\r\n          text: 'I cannot analyze this image.',\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-no-json');\r\n\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('API_ERROR');\r\n          expect(result.error.message).toContain('parse');\r\n        }\r\n      });\r\n\r\n      it('sanitizes string fields from response', async () => {\r\n        mockGenerateContent.mockResolvedValue({\r\n          text: JSON.stringify({\r\n            category: '<script>alert(\"xss\")</script>flooring',\r\n            subcategory: 'hardwood\\nwith\\nnewlines',\r\n            materials: ['oak', '<b>metal</b>'],\r\n            colors: ['red'],\r\n            style: 'modern',\r\n            usageContext: 'home',\r\n            targetDemographic: 'homeowners',\r\n            detectedText: null,\r\n            confidence: 80,\r\n          }),\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-sanitize');\r\n\r\n        expect(result.success).toBe(true);\r\n        if (result.success) {\r\n          // sanitizeOutputString strips <> characters but does NOT strip newlines\r\n          expect(result.analysis.category).not.toContain('<script>');\r\n          expect(result.analysis.category).not.toContain('<');\r\n          expect(result.analysis.category).not.toContain('>');\r\n          // Materials should also have angle brackets stripped\r\n          expect(result.analysis.materials).not.toContain('<b>metal</b>');\r\n        }\r\n      });\r\n\r\n      it('returns error when confidence exceeds valid range 0-100', async () => {\r\n        mockGenerateContent.mockResolvedValue({\r\n          text: JSON.stringify({\r\n            category: 'flooring',\r\n            subcategory: 'tile',\r\n            materials: [],\r\n            colors: [],\r\n            style: 'modern',\r\n            usageContext: '',\r\n            targetDemographic: '',\r\n            detectedText: null,\r\n            confidence: 150,\r\n          }),\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-confidence-clamp');\r\n\r\n        // Zod schema rejects confidence > 100 (z.number().min(0).max(100)),\r\n        // causing safeParseLLMResponse to throw, which returns API_ERROR\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('API_ERROR');\r\n        }\r\n      });\r\n\r\n      it('returns error when confidence is not a number', async () => {\r\n        mockGenerateContent.mockResolvedValue({\r\n          text: JSON.stringify({\r\n            category: 'flooring',\r\n            subcategory: 'tile',\r\n            materials: [],\r\n            colors: [],\r\n            style: 'modern',\r\n            usageContext: '',\r\n            targetDemographic: '',\r\n            detectedText: null,\r\n            confidence: 'high',\r\n          }),\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-confidence-default');\r\n\r\n        // Zod schema expects z.number() for confidence, 'high' (string) fails validation\r\n        // safeParseLLMResponse throws, which returns API_ERROR\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('API_ERROR');\r\n        }\r\n      });\r\n    });\r\n\r\n    describe('URL Normalization (Shopify {width} placeholder)', () => {\r\n      it('normalizes Shopify URLs with {width} placeholder', async () => {\r\n        const shopifyProduct = {\r\n          ...mockProduct,\r\n          cloudinaryUrl: 'https://cdn.shopify.com/image_{width}x.jpg',\r\n        };\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n\r\n        await analyzeProductImage(shopifyProduct, 'user-shopify');\r\n\r\n        expect(mockFetch).toHaveBeenCalledWith(expect.stringContaining('image_800x.jpg'));\r\n        expect(mockFetch).not.toHaveBeenCalledWith(expect.stringContaining('{width}'));\r\n      });\r\n\r\n      it('leaves non-Shopify URLs unchanged', async () => {\r\n        mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n\r\n        await analyzeProductImage(mockProduct, 'user-cloudinary');\r\n\r\n        expect(mockFetch).toHaveBeenCalledWith(mockProduct.cloudinaryUrl);\r\n      });\r\n    });\r\n\r\n    describe('Error Handling', () => {\r\n      it('returns API_ERROR when fetch fails', async () => {\r\n        mockFetch.mockResolvedValue({\r\n          ok: false,\r\n          status: 404,\r\n        });\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-fetch-fail');\r\n\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('API_ERROR');\r\n          expect(result.error.message).toContain('Failed to fetch image');\r\n        }\r\n      });\r\n\r\n      it('returns API_ERROR when Gemini API throws', async () => {\r\n        mockGenerateContent.mockRejectedValue(new Error('Gemini quota exceeded'));\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-gemini-error');\r\n\r\n        expect(result.success).toBe(false);\r\n        if (!result.success) {\r\n          expect(result.error.code).toBe('API_ERROR');\r\n          expect(result.error.message).toContain('Gemini quota exceeded');\r\n        }\r\n      });\r\n\r\n      it('continues to API call when cache lookup fails', async () => {\r\n        // First cache lookup fails (line 101), but code continues\r\n        // Second cache lookup (line 145) should succeed to save the analysis\r\n        mockStorage.getProductAnalysisByProductId\r\n          .mockRejectedValueOnce(new Error('Database connection failed')) // Initial cache check fails\r\n          .mockResolvedValueOnce(null); // Upsert check succeeds - no existing entry\r\n\r\n        const result = await analyzeProductImage(mockProduct, 'user-cache-error');\r\n\r\n        expect(result.success).toBe(true);\r\n        expect(mockGenerateContent).toHaveBeenCalled();\r\n      });\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // analyzeArbitraryImage Tests\r\n  // ============================================\r\n  describe('analyzeArbitraryImage', () => {\r\n    const testBuffer = Buffer.from('test-image-data');\r\n    const testMimeType = 'image/jpeg';\r\n\r\n    it('analyzes arbitrary image buffer', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          description: 'A modern kitchen with white marble countertops',\r\n          confidence: 85,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeArbitraryImage(testBuffer, testMimeType, 'user-arbitrary-1');\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.analysis.description).toContain('kitchen');\r\n        expect(result.analysis.confidence).toBe(85);\r\n      }\r\n    });\r\n\r\n    it('rate limits arbitrary image analysis', async () => {\r\n      const userId = 'user-arbitrary-rate-limit';\r\n\r\n      // Use up rate limit with product analysis\r\n      for (let i = 0; i < 10; i++) {\r\n        await analyzeProductImage(mockProduct, userId);\r\n      }\r\n\r\n      // Arbitrary image should also be rate limited\r\n      const result = await analyzeArbitraryImage(testBuffer, testMimeType, userId);\r\n\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.code).toBe('RATE_LIMITED');\r\n      }\r\n    });\r\n\r\n    it('does NOT cache arbitrary image results', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          description: 'A test image',\r\n          confidence: 70,\r\n        }),\r\n      });\r\n\r\n      await analyzeArbitraryImage(testBuffer, testMimeType, 'user-no-cache');\r\n\r\n      // Should not call storage methods\r\n      expect(mockStorage.saveProductAnalysis).not.toHaveBeenCalled();\r\n      expect(mockStorage.updateProductAnalysis).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('handles missing mime type', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          description: 'Test image',\r\n          confidence: 70,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeArbitraryImage(testBuffer, '', 'user-no-mime');\r\n\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('returns API_ERROR when analysis fails', async () => {\r\n      mockGenerateContent.mockRejectedValue(new Error('Analysis failed'));\r\n\r\n      const result = await analyzeArbitraryImage(testBuffer, testMimeType, 'user-arbitrary-error');\r\n\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.code).toBe('API_ERROR');\r\n        expect(result.error.message).toContain('Analysis failed');\r\n      }\r\n    });\r\n\r\n    it('sanitizes description from response', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          description: '<script>malicious</script>A clean description\\nwith newlines',\r\n          confidence: 80,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeArbitraryImage(testBuffer, testMimeType, 'user-sanitize-arbitrary');\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        // sanitizeOutputString strips <> characters but does NOT strip newlines\r\n        expect(result.analysis.description).not.toContain('<script>');\r\n        expect(result.analysis.description).not.toContain('<');\r\n        expect(result.analysis.description).not.toContain('>');\r\n      }\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // getCachedAnalysis Tests\r\n  // ============================================\r\n  describe('getCachedAnalysis', () => {\r\n    it('returns cached analysis when available', async () => {\r\n      mockStorage.getProductAnalysisByProductId.mockResolvedValue(mockCachedAnalysis);\r\n\r\n      const result = await getCachedAnalysis('product-123');\r\n\r\n      expect(result).not.toBeNull();\r\n      expect(result?.category).toBe('flooring');\r\n      expect(result?.confidence).toBe(92);\r\n    });\r\n\r\n    it('returns null when no cached analysis exists', async () => {\r\n      mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n\r\n      const result = await getCachedAnalysis('product-not-found');\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it('returns null when storage lookup fails', async () => {\r\n      mockStorage.getProductAnalysisByProductId.mockRejectedValue(new Error('DB error'));\r\n\r\n      const result = await getCachedAnalysis('product-error');\r\n\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // invalidateAnalysisCache Tests\r\n  // ============================================\r\n  describe('invalidateAnalysisCache', () => {\r\n    it('deletes cached analysis for product', async () => {\r\n      mockStorage.deleteProductAnalysis.mockResolvedValue(undefined);\r\n\r\n      await invalidateAnalysisCache('product-123');\r\n\r\n      expect(mockStorage.deleteProductAnalysis).toHaveBeenCalledWith('product-123');\r\n    });\r\n\r\n    it('does not throw when delete fails', async () => {\r\n      mockStorage.deleteProductAnalysis.mockRejectedValue(new Error('Delete failed'));\r\n\r\n      // Should not throw\r\n      await expect(invalidateAnalysisCache('product-error')).resolves.toBeUndefined();\r\n    });\r\n\r\n    it('handles non-existent product gracefully', async () => {\r\n      mockStorage.deleteProductAnalysis.mockResolvedValue(undefined);\r\n\r\n      await expect(invalidateAnalysisCache('non-existent')).resolves.toBeUndefined();\r\n    });\r\n  });\r\n\r\n  // ============================================\r\n  // Edge Cases and Integration Scenarios\r\n  // ============================================\r\n  describe('Edge Cases', () => {\r\n    it('handles product with special characters in name', async () => {\r\n      const specialProduct = {\r\n        ...mockProduct,\r\n        name: 'Oak & Pine \"Premium\" Flooring <Special>',\r\n      };\r\n      mockStorage.getProductAnalysisByProductId.mockResolvedValue(null);\r\n\r\n      const result = await analyzeProductImage(specialProduct, 'user-special-chars');\r\n\r\n      expect(result.success).toBe(true);\r\n    });\r\n\r\n    it('handles empty materials and colors arrays', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          category: 'unknown',\r\n          subcategory: 'unknown',\r\n          materials: [],\r\n          colors: [],\r\n          style: 'unknown',\r\n          usageContext: '',\r\n          targetDemographic: '',\r\n          detectedText: null,\r\n          confidence: 30,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeProductImage(mockProduct, 'user-empty-arrays');\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.analysis.materials).toEqual([]);\r\n        expect(result.analysis.colors).toEqual([]);\r\n      }\r\n    });\r\n\r\n    it('handles non-array materials in response', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          category: 'flooring',\r\n          subcategory: 'tile',\r\n          materials: 'ceramic', // Should be array  Zod rejects this\r\n          colors: null, // Should be array  Zod rejects this\r\n          style: 'modern',\r\n          usageContext: '',\r\n          targetDemographic: '',\r\n          detectedText: null,\r\n          confidence: 50,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeProductImage(mockProduct, 'user-non-array');\r\n\r\n      // Zod schema expects z.array(z.string()) for materials/colors.\r\n      // A string ('ceramic') and null both fail validation, causing API_ERROR.\r\n      expect(result.success).toBe(false);\r\n      if (!result.success) {\r\n        expect(result.error.code).toBe('API_ERROR');\r\n      }\r\n    });\r\n\r\n    it('preserves detectedText when present', async () => {\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          category: 'product',\r\n          subcategory: 'box',\r\n          materials: ['cardboard'],\r\n          colors: ['brown'],\r\n          style: 'industrial',\r\n          usageContext: 'shipping',\r\n          targetDemographic: 'businesses',\r\n          detectedText: 'FRAGILE - Handle With Care',\r\n          confidence: 95,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeProductImage(mockProduct, 'user-detected-text');\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.analysis.detectedText).toBe('FRAGILE - Handle With Care');\r\n      }\r\n    });\r\n\r\n    it('handles very long response strings by truncating', async () => {\r\n      const longString = 'A'.repeat(1000);\r\n      mockGenerateContent.mockResolvedValue({\r\n        text: JSON.stringify({\r\n          category: longString,\r\n          subcategory: 'test',\r\n          materials: [],\r\n          colors: [],\r\n          style: 'test',\r\n          usageContext: '',\r\n          targetDemographic: '',\r\n          detectedText: null,\r\n          confidence: 50,\r\n        }),\r\n      });\r\n\r\n      const result = await analyzeProductImage(mockProduct, 'user-long-string');\r\n\r\n      expect(result.success).toBe(true);\r\n      if (result.success) {\r\n        expect(result.analysis.category.length).toBeLessThanOrEqual(500);\r\n      }\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\app.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9114,9117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9114,9117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10440,10443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10440,10443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":444,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":444,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15084,15087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15084,15087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { type Server } from 'node:http';\r\nimport { randomBytes } from 'node:crypto';\r\n\r\nimport express, { type Express, type Request, Response, NextFunction } from 'express';\r\nimport cors from 'cors';\r\nimport helmet from 'helmet';\r\nimport session from 'express-session';\r\nimport { doubleCsrf } from 'csrf-csrf';\r\nimport { registerRoutes } from './routes';\r\nimport { logger, apiLogger } from './lib/logger';\r\nimport { requestIdMiddleware } from './middleware/requestId';\r\nimport { performanceMetricsMiddleware } from './middleware/performanceMetrics';\r\nimport { defaultTimeout, haltOnTimeout } from './middleware/timeout';\r\nimport { initGracefulShutdown, onShutdown } from './utils/gracefulShutdown';\r\nimport { validateEnvOrExit } from './lib/validateEnv';\r\nimport { initSentry, sentryRequestHandler, sentryErrorHandler, captureException } from './lib/sentry';\r\nimport { trackError } from './services/errorTrackingService';\r\nimport { notify } from './services/notificationService';\r\nimport compression from 'compression';\r\nimport cookieParser from 'cookie-parser';\r\nimport { startGenerationWorker, closeGenerationWorker } from './workers/generationWorkerInstance';\r\nimport { closeQueues } from './lib/queue';\r\nimport { apiVersioningMiddleware } from './middleware/apiVersioning';\r\nimport { registerAllPrompts } from './lib/prompts';\r\n\r\nexport function log(message: string, source = 'express') {\r\n  // Use structured logger in production, formatted console in development\r\n  apiLogger.info({ source }, message);\r\n}\r\n\r\nexport const app = express();\r\n\r\n// CORS - allow cross-origin requests from configured origins\r\nconst allowedOrigins = process.env.ALLOWED_ORIGINS\r\n  ? process.env.ALLOWED_ORIGINS.split(',').map((o) => o.trim())\r\n  : [`http://localhost:${process.env.PORT || '5000'}`];\r\n\r\napp.use(\r\n  cors({\r\n    origin: allowedOrigins,\r\n    credentials: true,\r\n    methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],\r\n    allowedHeaders: ['Content-Type', 'x-csrf-token', 'x-e2e-test'],\r\n    exposedHeaders: ['X-Session-Id'],\r\n  }),\r\n);\r\n\r\n// Response compression (gzip/brotli) - reduces bundle size by ~65%\r\napp.use(compression());\r\n\r\n// Trust proxy for Railway/Heroku/etc - required for secure cookies behind reverse proxy\r\napp.set('trust proxy', 1);\r\n\r\n// Security headers\r\napp.use(\r\n  helmet({\r\n    contentSecurityPolicy: {\r\n      directives: {\r\n        defaultSrc: [\"'self'\"],\r\n        scriptSrc:\r\n          process.env.NODE_ENV === 'production'\r\n            ? [\r\n                \"'self'\",\r\n                \"'sha256-lDUBeBfpPQ4BeVVZpSDsSj8T+WdMfPRFeirOKsgrNAM='\",\r\n                \"'sha256-D8ENm9m//g0OfHmuDwTU4MaB7wzJNZ5g9g/pqhRH9uQ='\",\r\n              ]\r\n            : [\"'self'\", \"'unsafe-inline'\", \"'unsafe-eval'\"], // Vite dev needs these\r\n        styleSrc: [\"'self'\", \"'unsafe-inline'\", 'https://fonts.googleapis.com'],\r\n        imgSrc: [\r\n          \"'self'\",\r\n          'data:',\r\n          'blob:',\r\n          'https://res.cloudinary.com',\r\n          'https://*.cloudinary.com',\r\n          'https://images.unsplash.com',\r\n          'https://nextdaysteel.co.uk',\r\n          'https://placehold.co',\r\n        ],\r\n        connectSrc: [\r\n          \"'self'\",\r\n          'https://generativelanguage.googleapis.com',\r\n          'https://nextdaysteel.co.uk',\r\n          'https://*.nextdaysteel.co.uk',\r\n          'https://res.cloudinary.com',\r\n          'https://*.cloudinary.com',\r\n          'https://fonts.googleapis.com',\r\n          'https://fonts.gstatic.com',\r\n          'https://placehold.co',\r\n          'https://images.unsplash.com',\r\n          'wss:',\r\n          'ws:',\r\n        ],\r\n        fontSrc: [\"'self'\", 'data:', 'https://fonts.gstatic.com'],\r\n        objectSrc: [\"'none'\"],\r\n        mediaSrc: [\"'self'\"],\r\n        frameSrc: [\"'none'\"],\r\n      },\r\n    },\r\n    crossOriginEmbedderPolicy: false, // Allow Cloudinary images\r\n  }),\r\n);\r\n\r\n// Request ID for tracing\r\napp.use(requestIdMiddleware);\r\n\r\n// Performance metrics tracking (if monitoring enabled)\r\nif (process.env.ENABLE_MONITORING !== 'false') {\r\n  app.use(performanceMetricsMiddleware);\r\n}\r\n\r\n// Request timeout (30s default)\r\napp.use(defaultTimeout);\r\napp.use(haltOnTimeout);\r\n\r\ndeclare module 'http' {\r\n  interface IncomingMessage {\r\n    rawBody: unknown;\r\n  }\r\n}\r\napp.use(\r\n  express.json({\r\n    limit: '10mb',\r\n    verify: (req, _res, buf) => {\r\n      req.rawBody = buf;\r\n    },\r\n  }),\r\n);\r\napp.use(express.urlencoded({ extended: false, limit: '10mb' }));\r\n\r\n// Cookie parser - required for CSRF and session handling\r\napp.use(cookieParser());\r\n\r\n// API Versioning (Task 5.2)\r\n// Rewrites /api/v1/*  /api/* and adds version/deprecation headers\r\napp.use(apiVersioningMiddleware);\r\n\r\n// Cache-Control headers for API GET responses\r\napp.use('/api/', (req, res, next) => {\r\n  if (req.method === 'GET') {\r\n    // Default: private, short cache for user-specific data\r\n    res.setHeader('Cache-Control', 'private, no-cache');\r\n  }\r\n  next();\r\n});\r\n\r\n// Session middleware - uses Redis if available, falls back to memory store\r\nlet sessionStore: session.Store | undefined;\r\n\r\nif (process.env.REDIS_URL) {\r\n  try {\r\n    const RedisStore = require('connect-redis').default;\r\n    const { getRedisClient } = require('./lib/redis');\r\n    sessionStore = new RedisStore({\r\n      client: getRedisClient(),\r\n      prefix: 'sess:',\r\n    });\r\n    logger.info({ store: 'redis' }, 'Using Redis session store');\r\n  } catch (error) {\r\n    if (process.env.NODE_ENV === 'production') {\r\n      logger.warn(\r\n        { store: 'memory', error },\r\n        'Redis session store failed in production  falling back to memory store (single-instance only)',\r\n      );\r\n    }\r\n    logger.warn({ store: 'memory', reason: 'redis_unavailable' }, 'Redis not available, using memory session store');\r\n  }\r\n} else {\r\n  if (process.env.NODE_ENV === 'production') {\r\n    logger.warn(\r\n      { store: 'memory', reason: 'no_redis_url' },\r\n      'REDIS_URL not set in production  using memory session store (single-instance only)',\r\n    );\r\n  } else {\r\n    logger.warn(\r\n      { store: 'memory', reason: 'no_redis_url' },\r\n      'REDIS_URL not set, using memory session store (dev only)',\r\n    );\r\n  }\r\n}\r\n\r\n// Validate session secret in production\r\n// Supports comma-separated secrets for key rotation (first = current, rest = legacy)\r\nconst sessionSecret = process.env.SESSION_SECRET;\r\nif (process.env.NODE_ENV === 'production' && !sessionSecret) {\r\n  logger.warn(\r\n    { security: true },\r\n    'SESSION_SECRET not set in production - using random secret, sessions will not persist',\r\n  );\r\n}\r\n// Parse comma-separated secrets for rotation support (express-session supports arrays)\r\nconst sessionSecrets = sessionSecret\r\n  ? sessionSecret\r\n      .split(',')\r\n      .map((s) => s.trim())\r\n      .filter(Boolean)\r\n  : [randomBytes(32).toString('hex')];\r\n\r\napp.use(\r\n  session({\r\n    store: sessionStore, // undefined = default memory store\r\n    secret: sessionSecrets,\r\n    resave: false,\r\n    saveUninitialized: false,\r\n    cookie: {\r\n      secure: process.env.NODE_ENV === 'production',\r\n      httpOnly: true,\r\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days (industry standard for SaaS)\r\n      sameSite: 'lax',\r\n    },\r\n  }),\r\n);\r\n\r\n// CSRF Protection - protects all state-changing operations (POST/PUT/DELETE)\r\n// Supports comma-separated secrets for key rotation\r\nconst csrfSecret = process.env.CSRF_SECRET;\r\nif (process.env.NODE_ENV === 'production' && !csrfSecret) {\r\n  logger.warn(\r\n    { security: true },\r\n    'CSRF_SECRET not set in production  using random secret (sessions will not persist across restarts)',\r\n  );\r\n}\r\n// Parse comma-separated secrets for rotation (first = current)\r\nconst csrfSecrets = csrfSecret\r\n  ? csrfSecret\r\n      .split(',')\r\n      .map((s) => s.trim())\r\n      .filter(Boolean)\r\n  : [randomBytes(32).toString('hex')];\r\nconst effectiveCsrfSecret = csrfSecrets[0] ?? randomBytes(32).toString('hex');\r\n\r\nconst { generateToken, doubleCsrfProtection } = doubleCsrf({\r\n  getSecret: () => effectiveCsrfSecret,\r\n  cookieName: process.env.NODE_ENV === 'production' ? '__Host-csrf' : 'csrf',\r\n  cookieOptions: {\r\n    sameSite: 'strict',\r\n    secure: process.env.NODE_ENV === 'production',\r\n    httpOnly: true,\r\n    path: '/',\r\n  },\r\n  size: 64, // Token size in bytes\r\n  ignoredMethods: ['GET', 'HEAD', 'OPTIONS'],\r\n});\r\n\r\n// Apply CSRF protection middleware\r\n// Skip CSRF for:\r\n//   - analytics/vitals  sendBeacon() cannot set custom headers\r\n//   - n8n webhooks  use HMAC signature auth instead (webhookAuth.ts)\r\napp.use((req: Request, res: Response, next: NextFunction) => {\r\n  if (req.path === '/api/analytics/vitals' && req.method === 'POST') {\r\n    return next();\r\n  }\r\n  if (req.path.startsWith('/api/n8n/')) {\r\n    return next();\r\n  }\r\n  return doubleCsrfProtection(req, res, next);\r\n});\r\n\r\n// CSRF token endpoint - clients must fetch this before making state-changing requests\r\napp.get('/api/csrf-token', (req: Request, res: Response) => {\r\n  res.json({ csrfToken: generateToken(req, res) });\r\n});\r\n\r\napp.use((req, res, next) => {\r\n  const start = Date.now();\r\n  const path = req.path;\r\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\r\n\r\n  const originalResJson = res.json;\r\n  res.json = function (bodyJson, ...args) {\r\n    capturedJsonResponse = bodyJson;\r\n    return originalResJson.apply(res, [bodyJson, ...args]);\r\n  };\r\n\r\n  res.on('finish', () => {\r\n    const duration = Date.now() - start;\r\n    if (path.startsWith('/api')) {\r\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\r\n      if (capturedJsonResponse) {\r\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\r\n      }\r\n\r\n      if (logLine.length > 80) {\r\n        logLine = logLine.slice(0, 79) + '';\r\n      }\r\n\r\n      log(logLine);\r\n    }\r\n  });\r\n\r\n  next();\r\n});\r\n\r\n// Sentry request handler - must be before routes\r\napp.use(sentryRequestHandler);\r\n\r\nexport default async function runApp(setup: (app: Express, server: Server) => Promise<void>) {\r\n  // Initialize Sentry error monitoring\r\n  initSentry();\r\n\r\n  // Validate environment variables before starting\r\n  await validateEnvOrExit();\r\n\r\n  // Register all AI prompts in the prompt registry\r\n  registerAllPrompts();\r\n\r\n  // Start the generation worker for async job processing\r\n  startGenerationWorker();\r\n\r\n  const server = await registerRoutes(app);\r\n\r\n  // Sentry error handler - must be before custom error handler\r\n  app.use(sentryErrorHandler);\r\n\r\n  app.use((err: any, req: Request, res: Response, _next: NextFunction) => {\r\n    const status = err.status || err.statusCode || 500;\r\n    const message = err.message || 'Internal Server Error';\r\n\r\n    // Log error with structured logger\r\n    logger.error({ err, status, module: 'ErrorHandler' }, message);\r\n\r\n    // Track error for dashboard (only if monitoring enabled)\r\n    if (process.env.ENABLE_MONITORING !== 'false') {\r\n      trackError({\r\n        statusCode: status,\r\n        message,\r\n        endpoint: req.path,\r\n        method: req.method,\r\n        userAgent: req.get('user-agent'),\r\n        stack: err.stack,\r\n      });\r\n    }\r\n\r\n    // Capture in Sentry if it's a server error\r\n    if (status >= 500) {\r\n      captureException(err, { status, message });\r\n\r\n      // Direct notification  works even without Sentry DSN\r\n      notify({\r\n        severity: 'error',\r\n        title: `${req.method} ${req.path}  ${status}`,\r\n        message,\r\n        context: {\r\n          endpoint: req.path,\r\n          method: req.method,\r\n          stack: err.stack?.split('\\n')[1]?.trim() ?? 'N/A',\r\n        },\r\n      }).catch(() => {}); // Fire and forget\r\n    }\r\n\r\n    res.status(status).json({ message });\r\n  });\r\n\r\n  // importantly run the final setup after setting up all the other routes so\r\n  // the catch-all route doesn't interfere with the other routes\r\n  await setup(app, server);\r\n\r\n  // ALWAYS serve the app on the port specified in the environment variable PORT\r\n  // Other ports are firewalled. Default to 5000 if not specified.\r\n  // this serves both the API and the client.\r\n  // It is the only port that is not firewalled.\r\n  const port = parseInt(process.env.PORT || '5000', 10);\r\n  server.listen(port, '0.0.0.0', () => {\r\n    log(`serving on port ${port}`);\r\n  });\r\n\r\n  // Initialize graceful shutdown\r\n  initGracefulShutdown(server);\r\n\r\n  // Register comprehensive cleanup on shutdown\r\n  onShutdown(async () => {\r\n    logger.info({ module: 'shutdown' }, 'Starting graceful shutdown');\r\n\r\n    // Close generation worker first (stop accepting new jobs)\r\n    try {\r\n      await closeGenerationWorker();\r\n      logger.info({ module: 'shutdown' }, 'Generation worker closed');\r\n    } catch (err) {\r\n      logger.error({ module: 'shutdown', err }, 'Error closing generation worker');\r\n    }\r\n\r\n    // Close BullMQ queue connections\r\n    try {\r\n      await closeQueues();\r\n      logger.info({ module: 'shutdown' }, 'Queue connections closed');\r\n    } catch (err) {\r\n      logger.error({ module: 'shutdown', err }, 'Error closing queue connections');\r\n    }\r\n\r\n    // Flush analytics events\r\n    try {\r\n      const { flushAnalytics } = await import('./lib/analytics');\r\n      await flushAnalytics();\r\n      logger.info({ module: 'shutdown' }, 'Analytics flushed');\r\n    } catch {\r\n      // Analytics may not be initialized\r\n    }\r\n\r\n    // Close Redis (sessions depend on Redis)\r\n    if (process.env.REDIS_URL) {\r\n      try {\r\n        const { closeRedisClient } = require('./lib/redis');\r\n        await closeRedisClient();\r\n        logger.info({ module: 'shutdown' }, 'Redis connection closed');\r\n      } catch (err) {\r\n        logger.error({ module: 'shutdown', err }, 'Error closing Redis');\r\n      }\r\n    }\r\n\r\n    // Clear monitoring data\r\n    if (process.env.ENABLE_MONITORING !== 'false') {\r\n      try {\r\n        const { resetPerformanceMetrics } = require('./middleware/performanceMetrics');\r\n        const { clearErrors } = require('./services/errorTrackingService');\r\n        resetPerformanceMetrics();\r\n        clearErrors();\r\n        logger.info({ module: 'shutdown' }, 'Monitoring data cleared');\r\n      } catch (err) {\r\n        logger.error({ module: 'shutdown', err }, 'Error clearing monitoring data');\r\n      }\r\n    }\r\n\r\n    // Close database pool with timeout\r\n    try {\r\n      const { pool } = require('./db');\r\n      const poolClosePromise = pool.end();\r\n      const timeoutPromise = new Promise((_, reject) =>\r\n        setTimeout(() => reject(new Error('Pool close timeout')), 10000),\r\n      );\r\n\r\n      await Promise.race([poolClosePromise, timeoutPromise]);\r\n      logger.info({ module: 'shutdown' }, 'Database pool closed');\r\n    } catch (err) {\r\n      logger.error({ module: 'shutdown', err }, 'Error closing database pool - forcing shutdown');\r\n      // Force close by removing listeners to prevent hanging\r\n      const { pool } = require('./db');\r\n      pool.removeAllListeners();\r\n    }\r\n\r\n    logger.info({ module: 'shutdown' }, 'Graceful shutdown complete');\r\n  });\r\n\r\n  // Track unhandled errors (only if monitoring enabled)\r\n  if (process.env.ENABLE_MONITORING !== 'false') {\r\n    process.on('unhandledRejection', (reason: any) => {\r\n      logger.error({ err: reason, module: 'UnhandledRejection' }, 'Unhandled promise rejection');\r\n      trackError({\r\n        statusCode: 500,\r\n        message: reason?.message || 'Unhandled promise rejection',\r\n        endpoint: 'N/A',\r\n        method: 'N/A',\r\n        stack: reason?.stack,\r\n      });\r\n      notify({\r\n        severity: 'critical',\r\n        title: 'Unhandled Promise Rejection',\r\n        message: reason?.message || 'Unknown rejection',\r\n        context: { stack: reason?.stack?.split('\\n')[1]?.trim() ?? 'N/A' },\r\n      }).catch(() => {});\r\n    });\r\n\r\n    process.on('uncaughtException', (error: Error) => {\r\n      logger.error({ err: error, module: 'UncaughtException' }, 'Uncaught exception');\r\n      trackError({\r\n        statusCode: 500,\r\n        message: error.message,\r\n        endpoint: 'N/A',\r\n        method: 'N/A',\r\n        stack: error.stack,\r\n      });\r\n      notify({\r\n        severity: 'critical',\r\n        title: 'Uncaught Exception',\r\n        message: error.message,\r\n        context: { stack: error.stack?.split('\\n')[1]?.trim() ?? 'N/A' },\r\n      }).catch(() => {});\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'client' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import pg from 'pg';\r\nconst { Pool } = pg;\r\nimport { drizzle } from 'drizzle-orm/node-postgres';\r\nimport * as schema from \"@shared/schema\";\r\nimport { logger } from './lib/logger';\r\n\r\nif (!process.env.DATABASE_URL) {\r\n    throw new Error(\"DATABASE_URL must be set. Did you forget to provision a database?\");\r\n}\r\n\r\n/**\r\n * Get validated connection pool configuration from environment variables\r\n * Validates and bounds all numeric values to safe ranges\r\n */\r\nfunction getPoolConfig() {\r\n    const max = Math.min(Math.max(parseInt(process.env.DB_POOL_MAX || '20', 10), 1), 100);\r\n    const min = Math.min(Math.max(parseInt(process.env.DB_POOL_MIN || '2', 10), 0), max);\r\n    const idleTimeout = Math.max(parseInt(process.env.DB_IDLE_TIMEOUT || '30000', 10), 1000);\r\n    const connectionTimeout = Math.max(parseInt(process.env.DB_CONNECTION_TIMEOUT || '5000', 10), 1000);\r\n    const statementTimeout = Math.max(parseInt(process.env.DB_STATEMENT_TIMEOUT || '30000', 10), 1000);\r\n\r\n    return { max, min, idleTimeout, connectionTimeout, statementTimeout };\r\n}\r\n\r\nconst poolConfig = getPoolConfig();\r\n\r\nlogger.info({ module: 'db' }, 'Initializing database connection...');\r\n\r\nexport const pool = new Pool({\r\n    connectionString: process.env.DATABASE_URL,\r\n\r\n    // Connection pool sizing\r\n    max: poolConfig.max,\r\n    min: poolConfig.min,\r\n\r\n    // Timeout configuration\r\n    idleTimeoutMillis: poolConfig.idleTimeout,\r\n    connectionTimeoutMillis: poolConfig.connectionTimeout,\r\n\r\n    // SSL for production\r\n    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : undefined,\r\n\r\n    // Connection validation\r\n    allowExitOnIdle: false,\r\n});\r\n\r\n// Set statement timeout on each connection (PostgreSQL server-side)\r\npool.on('connect', (client) => {\r\n    client.query(`SET statement_timeout = ${poolConfig.statementTimeout}`).catch((err) => {\r\n        logger.error({ module: 'db', err }, 'Failed to set statement_timeout on connection');\r\n    });\r\n});\r\n\r\n// Log pool events for monitoring\r\npool.on('error', (err, client) => {\r\n    logger.error({ module: 'db', err }, 'Unexpected error on idle client');\r\n});\r\n\r\npool.on('acquire', () => {\r\n    logger.debug({ module: 'db', total: pool.totalCount, idle: pool.idleCount }, 'Client acquired from pool');\r\n});\r\n\r\nexport const db = drizzle(pool, { schema });\r\nlogger.info({\r\n    module: 'db',\r\n    max: poolConfig.max,\r\n    min: poolConfig.min,\r\n    idleTimeout: poolConfig.idleTimeout,\r\n    connectionTimeout: poolConfig.connectionTimeout,\r\n    statementTimeout: poolConfig.statementTimeout,\r\n}, 'Database initialized with node-postgres');\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\debug-errors.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sql' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"sql"},"fix":{"range":[259,264],"text":""},"desc":"Remove unused variable \"sql\"."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":13,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":13,"endColumn":14,"suggestions":[{"fix":{"range":[334,403],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":29,"endColumn":16,"suggestions":[{"fix":{"range":[800,864],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":32,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":32,"endColumn":18,"suggestions":[{"fix":{"range":[914,955],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":33,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":33,"endColumn":18,"suggestions":[{"fix":{"range":[963,1003],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":34,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":34,"endColumn":18,"suggestions":[{"fix":{"range":[1011,1055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":35,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":35,"endColumn":18,"suggestions":[{"fix":{"range":[1063,1124],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":36,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":36,"endColumn":18,"suggestions":[{"fix":{"range":[1132,1179],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":37,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":37,"endColumn":18,"suggestions":[{"fix":{"range":[1187,1203],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":43,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":43,"endColumn":18,"suggestions":[{"fix":{"range":[1373,1448],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":45,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":45,"endColumn":20,"suggestions":[{"fix":{"range":[1493,1538],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":48,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":48,"endColumn":18,"suggestions":[{"fix":{"range":[1571,1637],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":49,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":49,"endColumn":18,"suggestions":[{"fix":{"range":[1645,1717],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":50,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":50,"endColumn":18,"suggestions":[{"fix":{"range":[1725,1804],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\n/**\r\n * Temporary debugging script to fetch recent errors\r\n * Run with: npx tsx server/debug-errors.ts\r\n */\r\n\r\nimport 'dotenv/config';\r\nimport { db } from './db';\r\nimport { generations } from '../shared/schema';\r\nimport { desc, sql } from 'drizzle-orm';\r\n\r\nasync function findFailedGenerations() {\r\n  console.log('Checking for failed or non-completed generations...\\n');\r\n\r\n  try {\r\n    // Get recent generations with any status\r\n    const recentGens = await db\r\n      .select({\r\n        id: generations.id,\r\n        status: generations.status,\r\n        prompt: generations.prompt,\r\n        createdAt: generations.createdAt,\r\n        model: generations.model,\r\n      })\r\n      .from(generations)\r\n      .orderBy(desc(generations.createdAt))\r\n      .limit(20);\r\n\r\n    console.log(`Found ${recentGens.length} recent generations:\\n`);\r\n\r\n    recentGens.forEach((gen, idx) => {\r\n      console.log(`${idx + 1}. ID: ${gen.id}`);\r\n      console.log(`   Status: ${gen.status}`);\r\n      console.log(`   Created: ${gen.createdAt}`);\r\n      console.log(`   Prompt: ${gen.prompt?.substring(0, 80)}...`);\r\n      console.log(`   Model: ${gen.model || 'N/A'}`);\r\n      console.log('');\r\n    });\r\n\r\n    // Check for any non-completed status\r\n    const failedGens = recentGens.filter(g => g.status !== 'completed');\r\n    if (failedGens.length > 0) {\r\n      console.log(`\\n  Found ${failedGens.length} non-completed generations:`);\r\n      failedGens.forEach(gen => {\r\n        console.log(`   - ${gen.id}: ${gen.status}`);\r\n      });\r\n    } else {\r\n      console.log('\\n All recent generations have status \"completed\"');\r\n      console.log('   This means any failures did not save to the database.');\r\n      console.log('   Check server logs or monitoring dashboard for error details.');\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Error querying database:', error);\r\n  } finally {\r\n    process.exit(0);\r\n  }\r\n}\r\n\r\nfindFailedGenerations();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\dto\\generationDTO.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\examples\\multiPlatformPostingExample.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":43,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":43,"endColumn":14,"suggestions":[{"fix":{"range":[1039,1102],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":46,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":46,"endColumn":14,"suggestions":[{"fix":{"range":[1154,1216],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":47,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":47,"endColumn":14,"suggestions":[{"fix":{"range":[1220,1268],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":50,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":50,"endColumn":14,"suggestions":[{"fix":{"range":[1322,1356],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":51,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":51,"endColumn":14,"suggestions":[{"fix":{"range":[1360,1432],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":52,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":52,"endColumn":14,"suggestions":[{"fix":{"range":[1436,1506],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":53,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":53,"endColumn":14,"suggestions":[{"fix":{"range":[1510,1578],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":60,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":60,"endColumn":14,"suggestions":[{"fix":{"range":[1695,1761],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":64,"endColumn":16,"suggestions":[{"fix":{"range":[1851,1888],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":65,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":65,"endColumn":16,"suggestions":[{"fix":{"range":[1894,1968],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":66,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":66,"endColumn":16,"suggestions":[{"fix":{"range":[1974,2056],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":67,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":67,"endColumn":16,"suggestions":[{"fix":{"range":[2062,2125],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":68,"endColumn":16,"suggestions":[{"fix":{"range":[2131,2209],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":69,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":69,"endColumn":16,"suggestions":[{"fix":{"range":[2215,2290],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":70,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":70,"endColumn":16,"suggestions":[{"fix":{"range":[2296,2364],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":71,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":71,"endColumn":16,"suggestions":[{"fix":{"range":[2370,2402],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":73,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":73,"endColumn":18,"suggestions":[{"fix":{"range":[2465,2578],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":79,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":79,"endColumn":16,"suggestions":[{"fix":{"range":[2679,2712],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":80,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":80,"endColumn":16,"suggestions":[{"fix":{"range":[2718,2791],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":81,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":81,"endColumn":16,"suggestions":[{"fix":{"range":[2797,2892],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":82,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":82,"endColumn":16,"suggestions":[{"fix":{"range":[2898,2985],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":90,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":90,"endColumn":14,"suggestions":[{"fix":{"range":[3111,3178],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":117,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":117,"endColumn":14,"suggestions":[{"fix":{"range":[3913,3969],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":118,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":118,"endColumn":14,"suggestions":[{"fix":{"range":[3973,4040],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":119,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":119,"endColumn":14,"suggestions":[{"fix":{"range":[4044,4098],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":120,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":120,"endColumn":14,"suggestions":[{"fix":{"range":[4102,4149],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":121,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":121,"endColumn":14,"suggestions":[{"fix":{"range":[4153,4194],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":122,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":122,"endColumn":14,"suggestions":[{"fix":{"range":[4198,4248],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":125,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":125,"endColumn":16,"suggestions":[{"fix":{"range":[4296,4323],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":126,"column":37,"nodeType":"MemberExpression","messageId":"limited","endLine":126,"endColumn":48,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":130,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":130,"endColumn":16,"suggestions":[{"fix":{"range":[4439,4464],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":131,"column":35,"nodeType":"MemberExpression","messageId":"limited","endLine":131,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":134,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":134,"endColumn":14,"suggestions":[{"fix":{"range":[4536,4572],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":135,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":135,"endColumn":14,"suggestions":[{"fix":{"range":[4576,4595],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":136,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":136,"endColumn":14,"suggestions":[{"fix":{"range":[4599,4630],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":137,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":137,"endColumn":14,"suggestions":[{"fix":{"range":[4634,4653],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":139,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":139,"endColumn":14,"suggestions":[{"fix":{"range":[4659,4726],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":146,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":146,"endColumn":14,"suggestions":[{"fix":{"range":[4851,4927],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":154,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":154,"endColumn":14,"suggestions":[{"fix":{"range":[5299,5341],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":155,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":155,"endColumn":14,"suggestions":[{"fix":{"range":[5345,5400],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":156,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":156,"endColumn":14,"suggestions":[{"fix":{"range":[5404,5452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":159,"endColumn":16,"suggestions":[{"fix":{"range":[5526,5568],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":160,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":160,"endColumn":16,"suggestions":[{"fix":{"range":[5574,5643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":161,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":161,"endColumn":16,"suggestions":[{"fix":{"range":[5649,5704],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":162,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":162,"endColumn":16,"suggestions":[{"fix":{"range":[5710,5757],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":163,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":163,"endColumn":16,"suggestions":[{"fix":{"range":[5763,5821],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":165,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":165,"endColumn":18,"suggestions":[{"fix":{"range":[5873,5941],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":167,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":167,"endColumn":16,"suggestions":[{"fix":{"range":[5954,5970],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":175,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":175,"endColumn":14,"suggestions":[{"fix":{"range":[6096,6169],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":181,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":181,"endColumn":14,"suggestions":[{"fix":{"range":[6363,6408],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":182,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":182,"endColumn":14,"suggestions":[{"fix":{"range":[6412,6472],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":183,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":183,"endColumn":14,"suggestions":[{"fix":{"range":[6476,6492],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":188,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":188,"endColumn":16,"suggestions":[{"fix":{"range":[6638,6680],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":189,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":189,"endColumn":16,"suggestions":[{"fix":{"range":[6686,6750],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":190,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":190,"endColumn":16,"suggestions":[{"fix":{"range":[6756,6810],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":191,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":191,"endColumn":16,"suggestions":[{"fix":{"range":[6816,6859],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":192,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":192,"endColumn":16,"suggestions":[{"fix":{"range":[6865,6927],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":193,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":193,"endColumn":16,"suggestions":[{"fix":{"range":[6933,6997],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":194,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":194,"endColumn":16,"suggestions":[{"fix":{"range":[7003,7040],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":195,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":195,"endColumn":16,"suggestions":[{"fix":{"range":[7046,7062],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":203,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":203,"endColumn":14,"suggestions":[{"fix":{"range":[7172,7238],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":250,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":250,"endColumn":16,"suggestions":[{"fix":{"range":[8181,8210],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":251,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":251,"endColumn":16,"suggestions":[{"fix":{"range":[8216,8274],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":253,"column":38,"nodeType":"MemberExpression","messageId":"limited","endLine":253,"endColumn":49,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":256,"column":40,"nodeType":"MemberExpression","messageId":"limited","endLine":256,"endColumn":51,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":258,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":258,"endColumn":16,"suggestions":[{"fix":{"range":[8520,8536],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":266,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":266,"endColumn":14,"suggestions":[{"fix":{"range":[8673,8752],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":269,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":269,"endColumn":14,"suggestions":[{"fix":{"range":[8799,8854],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":272,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":272,"endColumn":16,"suggestions":[{"fix":{"range":[8939,8983],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":273,"column":39,"nodeType":"MemberExpression","messageId":"limited","endLine":273,"endColumn":50,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":274,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":274,"endColumn":16,"suggestions":[{"fix":{"range":[9054,9149],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":276,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":276,"endColumn":16,"suggestions":[{"fix":{"range":[9167,9208],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":278,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":278,"endColumn":14,"suggestions":[{"fix":{"range":[9217,9233],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":281,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":281,"endColumn":14,"suggestions":[{"fix":{"range":[9268,9311],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":305,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":305,"endColumn":14,"suggestions":[{"fix":{"range":[9993,10041],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":306,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":306,"endColumn":14,"suggestions":[{"fix":{"range":[10045,10101],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":307,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":307,"endColumn":14,"suggestions":[{"fix":{"range":[10105,10147],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":308,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":308,"endColumn":14,"suggestions":[{"fix":{"range":[10151,10167],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":311,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":311,"endColumn":14,"suggestions":[{"fix":{"range":[10220,10283],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":318,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":318,"endColumn":14,"suggestions":[{"fix":{"range":[10408,10498],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":319,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":319,"endColumn":14,"suggestions":[{"fix":{"range":[10502,10518],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":322,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":322,"endColumn":14,"suggestions":[{"fix":{"range":[10573,10636],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":330,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":330,"endColumn":14,"suggestions":[{"fix":{"range":[10888,10975],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":331,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":331,"endColumn":14,"suggestions":[{"fix":{"range":[10979,10995],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":335,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":335,"endColumn":16,"suggestions":[{"fix":{"range":[11077,11127],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":350,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":350,"endColumn":16,"suggestions":[{"fix":{"range":[11450,11492],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":353,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":353,"endColumn":18,"suggestions":[{"fix":{"range":[11571,11613],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":354,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":354,"endColumn":18,"suggestions":[{"fix":{"range":[11621,11691],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":356,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":356,"endColumn":20,"suggestions":[{"fix":{"range":[11742,11803],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":359,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":359,"endColumn":20,"suggestions":[{"fix":{"range":[11849,11889],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":361,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":361,"endColumn":18,"suggestions":[{"fix":{"range":[11906,11922],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":364,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":364,"endColumn":16,"suggestions":[{"fix":{"range":[11947,12007],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":365,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":365,"endColumn":16,"suggestions":[{"fix":{"range":[12013,12029],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":366,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":366,"endColumn":16,"suggestions":[{"fix":{"range":[12035,12081],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":368,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":368,"endColumn":18,"suggestions":[{"fix":{"range":[12126,12240],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":370,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":370,"endColumn":16,"suggestions":[{"fix":{"range":[12255,12271],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":373,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":373,"endColumn":14,"suggestions":[{"fix":{"range":[12282,12318],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":380,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":380,"endColumn":14,"suggestions":[{"fix":{"range":[12429,12496],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":387,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":387,"endColumn":16,"suggestions":[{"fix":{"range":[12916,12970],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":390,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":390,"endColumn":18,"suggestions":[{"fix":{"range":[13104,13198],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":392,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":392,"endColumn":16,"suggestions":[{"fix":{"range":[13213,13229],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":400,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":400,"endColumn":14,"suggestions":[{"fix":{"range":[13309,13391],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":401,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":401,"endColumn":14,"suggestions":[{"fix":{"range":[13395,13476],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":402,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":402,"endColumn":14,"suggestions":[{"fix":{"range":[13480,13562],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":414,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":414,"endColumn":16,"suggestions":[{"fix":{"range":[13914,13972],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\fileStorage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3234,3237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3234,3237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { promises as fs } from \"fs\";\r\nimport path from \"path\";\r\nimport { randomUUID } from \"crypto\";\r\nimport { v2 as cloudinary } from \"cloudinary\";\r\nimport { logger } from './lib/logger';\r\n\r\nconst STORAGE_BASE = path.join(process.cwd(), \"attached_assets\", \"generations\");\r\nconst ORIGINALS_DIR = path.join(STORAGE_BASE, \"originals\");\r\nconst RESULTS_DIR = path.join(STORAGE_BASE, \"results\");\r\n\r\n// Configure Cloudinary if credentials are available\r\nconst isCloudinaryConfigured = !!(\r\n  process.env.CLOUDINARY_CLOUD_NAME &&\r\n  process.env.CLOUDINARY_API_KEY &&\r\n  process.env.CLOUDINARY_API_SECRET\r\n);\r\n\r\nif (isCloudinaryConfigured) {\r\n  cloudinary.config({\r\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n    api_key: process.env.CLOUDINARY_API_KEY,\r\n    api_secret: process.env.CLOUDINARY_API_SECRET,\r\n  });\r\n  logger.info({ module: 'fileStorage' }, 'Cloudinary configured for persistent storage');\r\n} else {\r\n  logger.warn({ module: 'fileStorage' }, 'Cloudinary not configured - using local storage (images will be lost on deploy)');\r\n}\r\n\r\nasync function ensureDirectories() {\r\n  await fs.mkdir(ORIGINALS_DIR, { recursive: true });\r\n  await fs.mkdir(RESULTS_DIR, { recursive: true });\r\n}\r\n\r\n/**\r\n * Validate that a path doesn't escape the allowed directory (path traversal protection)\r\n */\r\nfunction isPathSafe(basePath: string, targetPath: string): boolean {\r\n  const resolvedBase = path.resolve(basePath);\r\n  const resolvedTarget = path.resolve(targetPath);\r\n  return resolvedTarget.startsWith(resolvedBase + path.sep) || resolvedTarget === resolvedBase;\r\n}\r\n\r\n/**\r\n * Sanitize a filename to prevent path traversal\r\n */\r\nfunction sanitizeFilename(filename: string): string {\r\n  // Remove any directory components and only keep the base filename\r\n  const basename = path.basename(filename);\r\n  // Remove any potentially dangerous characters\r\n  return basename.replace(/[^a-zA-Z0-9._-]/g, '_');\r\n}\r\n\r\n/**\r\n * Save an uploaded file to disk\r\n * @returns Relative path to the saved file\r\n */\r\nexport async function saveOriginalFile(\r\n  fileBuffer: Buffer,\r\n  originalFilename: string\r\n): Promise<string> {\r\n  await ensureDirectories();\r\n\r\n  // Sanitize the extension from the original filename\r\n  const sanitized = sanitizeFilename(originalFilename);\r\n  const ext = path.extname(sanitized) || '.bin';\r\n  const filename = `${randomUUID()}${ext}`;\r\n  const filepath = path.join(ORIGINALS_DIR, filename);\r\n\r\n  // Verify the path is safe\r\n  if (!isPathSafe(ORIGINALS_DIR, filepath)) {\r\n    throw new Error('Invalid file path');\r\n  }\r\n\r\n  await fs.writeFile(filepath, fileBuffer);\r\n\r\n  // Return relative path from project root\r\n  return path.join(\"attached_assets\", \"generations\", \"originals\", filename);\r\n}\r\n\r\n/**\r\n * Save a generated image (base64) to Cloudinary or local disk\r\n * @returns URL (Cloudinary) or relative path (local) to the saved file\r\n */\r\nexport async function saveGeneratedImage(\r\n  base64Data: string,\r\n  format: string = \"png\"\r\n): Promise<string> {\r\n  // Remove data URL prefix if present\r\n  const base64Image = base64Data.replace(/^data:image\\/\\w+;base64,/, \"\");\r\n\r\n  // Use Cloudinary if configured (persistent storage)\r\n  if (isCloudinaryConfigured) {\r\n    try {\r\n      const uploadResult = await new Promise<any>((resolve, reject) => {\r\n        cloudinary.uploader.upload(\r\n          `data:image/${format};base64,${base64Image}`,\r\n          {\r\n            folder: \"generations/results\",\r\n            resource_type: \"image\",\r\n            format: format,\r\n          },\r\n          (error, result) => {\r\n            if (error) reject(error);\r\n            else resolve(result);\r\n          }\r\n        );\r\n      });\r\n\r\n      logger.info({ module: 'fileStorage', publicId: uploadResult.public_id }, 'Uploaded to Cloudinary');\r\n      // Return the secure URL for the image\r\n      return uploadResult.secure_url;\r\n    } catch (error) {\r\n      logger.error({ module: 'fileStorage', err: error }, 'Cloudinary upload failed, falling back to local');\r\n      // Fall through to local storage\r\n    }\r\n  }\r\n\r\n  // Fallback: Local storage (for development or if Cloudinary fails)\r\n  await ensureDirectories();\r\n\r\n  // Sanitize format to prevent injection\r\n  const safeFormat = format.replace(/[^a-zA-Z0-9]/g, '');\r\n  const filename = `${randomUUID()}.${safeFormat || 'png'}`;\r\n  const filepath = path.join(RESULTS_DIR, filename);\r\n\r\n  // Verify the path is safe\r\n  if (!isPathSafe(RESULTS_DIR, filepath)) {\r\n    throw new Error('Invalid file path');\r\n  }\r\n\r\n  const buffer = Buffer.from(base64Image, \"base64\");\r\n  await fs.writeFile(filepath, buffer);\r\n\r\n  // Return relative path from project root\r\n  return path.join(\"attached_assets\", \"generations\", \"results\", filename);\r\n}\r\n\r\n/**\r\n * Delete a file from Cloudinary or local disk\r\n * @param pathOrUrl - Cloudinary URL or relative local path\r\n */\r\nexport async function deleteFile(pathOrUrl: string): Promise<void> {\r\n  // Check if this is a Cloudinary URL\r\n  if (pathOrUrl.startsWith(\"https://res.cloudinary.com/\")) {\r\n    if (!isCloudinaryConfigured) {\r\n      logger.warn({ module: 'fileStorage' }, 'Cannot delete Cloudinary file - not configured');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Extract public_id from Cloudinary URL\r\n      // URL format: https://res.cloudinary.com/{cloud}/image/upload/{version}/{folder}/{public_id}.{format}\r\n      const urlParts = pathOrUrl.split(\"/\");\r\n      const publicIdWithExt = urlParts.slice(-2).join(\"/\"); // e.g., \"generations/results/abc123.png\"\r\n      const publicId = publicIdWithExt.replace(/\\.[^/.]+$/, \"\"); // Remove extension\r\n\r\n      await new Promise<void>((resolve, reject) => {\r\n        cloudinary.uploader.destroy(publicId, { resource_type: \"image\" }, (error, _result) => {\r\n          if (error) reject(error);\r\n          else {\r\n            logger.info({ module: 'fileStorage', publicId }, 'Deleted from Cloudinary');\r\n            resolve();\r\n          }\r\n        });\r\n      });\r\n    } catch (error) {\r\n      logger.error({ module: 'fileStorage', pathOrUrl, err: error }, 'Failed to delete from Cloudinary');\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Local file deletion\r\n  const filepath = path.join(process.cwd(), pathOrUrl);\r\n\r\n  // Verify the path is within the storage directory\r\n  if (!isPathSafe(STORAGE_BASE, filepath)) {\r\n    logger.error({ module: 'fileStorage', pathOrUrl }, 'Attempted path traversal');\r\n    throw new Error('Invalid file path');\r\n  }\r\n\r\n  try {\r\n    await fs.unlink(filepath);\r\n  } catch (error) {\r\n    logger.error({ module: 'fileStorage', pathOrUrl, err: error }, 'Failed to delete file');\r\n  }\r\n}\r\n\r\n/**\r\n * Read a file and return as buffer\r\n */\r\nexport async function readFile(relativePath: string): Promise<Buffer> {\r\n  const filepath = path.join(process.cwd(), relativePath);\r\n\r\n  // Verify the path is within the storage directory\r\n  if (!isPathSafe(STORAGE_BASE, filepath)) {\r\n    throw new Error('Invalid file path');\r\n  }\r\n\r\n  return await fs.readFile(filepath);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\index-dev.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\index-prod.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\instrumentation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[514,517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[514,517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[548,551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[548,551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[572,575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[572,575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[602,605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[602,605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[638,641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[638,641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[694,697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[694,697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[730,733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[730,733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[764,767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[764,767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":501,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15623,15626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15623,15626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * OpenTelemetry Instrumentation for Automated-Ads-Agent\r\n *\r\n * This module is OPTIONAL - the app works without OpenTelemetry packages installed.\r\n */\r\n\r\nimport { logger } from './lib/logger';\r\n\r\nconst OTEL_PACKAGES_AVAILABLE = (() => {\r\n  try {\r\n    require.resolve('@opentelemetry/sdk-node');\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n})();\r\n\r\nif (!OTEL_PACKAGES_AVAILABLE) {\r\n  logger.info({ module: 'otel' }, 'Telemetry disabled - OpenTelemetry packages not installed');\r\n}\r\n\r\nlet NodeSDK: any, getNodeAutoInstrumentations: any, OTLPTraceExporter: any;\r\nlet OTLPMetricExporter: any, PeriodicExportingMetricReader: any;\r\nlet defaultResource: any, resourceFromAttributes: any;\r\nlet SEMRESATTRS_SERVICE_NAME: any, SEMRESATTRS_SERVICE_VERSION: any, SEMRESATTRS_DEPLOYMENT_ENVIRONMENT: any;\r\nlet metrics: any;\r\n\r\n// =============================================================================\r\n// Configuration from environment variables\r\n// =============================================================================\r\nconst OTEL_ENABLED = OTEL_PACKAGES_AVAILABLE && process.env.OTEL_ENABLED !== 'false';\r\nconst OTEL_ENDPOINT = process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'http://localhost:4318';\r\nconst OTEL_HEADERS = process.env.OTEL_EXPORTER_OTLP_HEADERS || '';\r\nconst SERVICE_NAME = process.env.OTEL_SERVICE_NAME || 'automated-ads-agent';\r\nconst SERVICE_VERSION = process.env.npm_package_version || '1.0.0';\r\nconst DEPLOYMENT_ENV = process.env.NODE_ENV || 'development';\r\n\r\n// =============================================================================\r\n// Custom Metrics - Exported for use in services\r\n// =============================================================================\r\n\r\n// Meter for custom metrics (initialized after SDK starts)\r\nlet appMeter: ReturnType<typeof metrics.getMeter>;\r\n\r\n// Gemini API Metrics\r\nlet geminiTokensCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet geminiCostCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet geminiRequestsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet geminiLatencyHistogram: ReturnType<typeof appMeter.createHistogram>;\r\n\r\n// User Activity Metrics\r\nlet imageGenerationsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet imageEditsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet activeUsersGauge: ReturnType<typeof appMeter.createUpDownCounter>;\r\n\r\n// Error Metrics\r\nlet apiErrorsCounter: ReturnType<typeof appMeter.createCounter>;\r\n\r\n// Auth Metrics\r\nlet authAttemptsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet rateLimitHitsCounter: ReturnType<typeof appMeter.createCounter>;\r\n\r\n// Storage Metrics\r\nlet storageUsageGauge: ReturnType<typeof appMeter.createUpDownCounter>;\r\n\r\n// File Search (RAG) Metrics\r\nlet fileSearchUploadsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet fileSearchQueriesCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet fileSearchErrorsCounter: ReturnType<typeof appMeter.createCounter>;\r\nlet fileSearchLatencyHistogram: ReturnType<typeof appMeter.createHistogram>;\r\n\r\n/**\r\n * Initialize custom metrics after SDK is ready\r\n */\r\nfunction initializeCustomMetrics() {\r\n  appMeter = metrics.getMeter(SERVICE_NAME, SERVICE_VERSION);\r\n\r\n  // ===== Gemini API Cost Tracking =====\r\n  geminiTokensCounter = appMeter.createCounter('gemini.tokens.total', {\r\n    description: 'Total tokens used in Gemini API calls',\r\n    unit: 'tokens',\r\n  });\r\n\r\n  geminiCostCounter = appMeter.createCounter('gemini.cost.total', {\r\n    description: 'Estimated cost of Gemini API calls in USD',\r\n    unit: 'USD',\r\n  });\r\n\r\n  geminiRequestsCounter = appMeter.createCounter('gemini.requests.total', {\r\n    description: 'Total number of Gemini API requests',\r\n    unit: 'requests',\r\n  });\r\n\r\n  geminiLatencyHistogram = appMeter.createHistogram('gemini.request.duration', {\r\n    description: 'Gemini API request duration',\r\n    unit: 'ms',\r\n  });\r\n\r\n  // ===== User Activity Tracking =====\r\n  imageGenerationsCounter = appMeter.createCounter('images.generations.total', {\r\n    description: 'Total number of images generated',\r\n    unit: 'images',\r\n  });\r\n\r\n  imageEditsCounter = appMeter.createCounter('images.edits.total', {\r\n    description: 'Total number of image edits',\r\n    unit: 'edits',\r\n  });\r\n\r\n  activeUsersGauge = appMeter.createUpDownCounter('users.active', {\r\n    description: 'Number of currently active users',\r\n    unit: 'users',\r\n  });\r\n\r\n  // ===== Error Tracking =====\r\n  apiErrorsCounter = appMeter.createCounter('api.errors.total', {\r\n    description: 'Total number of API errors',\r\n    unit: 'errors',\r\n  });\r\n\r\n  // ===== Auth Tracking =====\r\n  authAttemptsCounter = appMeter.createCounter('auth.attempts.total', {\r\n    description: 'Total authentication attempts',\r\n    unit: 'attempts',\r\n  });\r\n\r\n  rateLimitHitsCounter = appMeter.createCounter('ratelimit.hits.total', {\r\n    description: 'Total rate limit hits',\r\n    unit: 'hits',\r\n  });\r\n\r\n  // ===== Storage Tracking =====\r\n  storageUsageGauge = appMeter.createUpDownCounter('storage.usage.bytes', {\r\n    description: 'Current storage usage in bytes',\r\n    unit: 'bytes',\r\n  });\r\n\r\n  // ===== File Search (RAG) Tracking =====\r\n  fileSearchUploadsCounter = appMeter.createCounter('filesearch.uploads.total', {\r\n    description: 'Total files uploaded to File Search Store',\r\n    unit: 'files',\r\n  });\r\n\r\n  fileSearchQueriesCounter = appMeter.createCounter('filesearch.queries.total', {\r\n    description: 'Total File Search queries executed',\r\n    unit: 'queries',\r\n  });\r\n\r\n  fileSearchErrorsCounter = appMeter.createCounter('filesearch.errors.total', {\r\n    description: 'Total File Search operation errors',\r\n    unit: 'errors',\r\n  });\r\n\r\n  fileSearchLatencyHistogram = appMeter.createHistogram('filesearch.latency.ms', {\r\n    description: 'File Search operation latency in milliseconds',\r\n    unit: 'ms',\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Metrics Helper Functions - Export for use in services\r\n// =============================================================================\r\n\r\n// Gemini pricing (as of Dec 2024) - adjust as needed\r\nconst GEMINI_PRICING = {\r\n  'gemini-3-pro-image-preview': {\r\n    inputPerMillion: 0.00, // Free during preview\r\n    outputPerMillion: 0.00,\r\n    imageGeneration: 0.04, // $0.04 per image (estimate)\r\n  },\r\n  'gemini-1.5-pro': {\r\n    inputPerMillion: 3.50,\r\n    outputPerMillion: 10.50,\r\n    imageGeneration: 0.00,\r\n  },\r\n  'gemini-1.5-flash': {\r\n    inputPerMillion: 0.075,\r\n    outputPerMillion: 0.30,\r\n    imageGeneration: 0.00,\r\n  },\r\n};\r\n\r\nexport const telemetry = {\r\n  /**\r\n   * Track Gemini API usage and cost\r\n   */\r\n  trackGeminiUsage(params: {\r\n    model: string;\r\n    operation: 'generate' | 'edit';\r\n    inputTokens?: number;\r\n    outputTokens?: number;\r\n    durationMs: number;\r\n    userId?: string;\r\n    success: boolean;\r\n    errorType?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !geminiRequestsCounter) return;\r\n\r\n    const { model, operation, inputTokens = 0, outputTokens = 0, durationMs, userId, success, errorType } = params;\r\n    const pricing = GEMINI_PRICING[model as keyof typeof GEMINI_PRICING] || GEMINI_PRICING['gemini-3-pro-image-preview'];\r\n\r\n    // Calculate cost\r\n    const tokenCost = (inputTokens / 1_000_000) * pricing.inputPerMillion +\r\n                      (outputTokens / 1_000_000) * pricing.outputPerMillion;\r\n    const imageCost = success ? pricing.imageGeneration : 0;\r\n    const totalCost = tokenCost + imageCost;\r\n\r\n    // Record metrics\r\n    geminiRequestsCounter.add(1, {\r\n      model,\r\n      operation,\r\n      success: String(success),\r\n      error_type: errorType || 'none',\r\n    });\r\n\r\n    geminiTokensCounter.add(inputTokens + outputTokens, {\r\n      model,\r\n      token_type: 'total',\r\n      operation,\r\n    });\r\n\r\n    geminiCostCounter.add(totalCost, {\r\n      model,\r\n      operation,\r\n      cost_type: 'total',\r\n    });\r\n\r\n    geminiLatencyHistogram.record(durationMs, {\r\n      model,\r\n      operation,\r\n      success: String(success),\r\n    });\r\n\r\n    // Track user activity\r\n    if (userId) {\r\n      if (operation === 'generate') {\r\n        imageGenerationsCounter.add(1, { user_id: userId });\r\n      } else if (operation === 'edit') {\r\n        imageEditsCounter.add(1, { user_id: userId });\r\n      }\r\n    }\r\n\r\n    // Track errors\r\n    if (!success && errorType) {\r\n      apiErrorsCounter.add(1, {\r\n        endpoint: `/api/${operation === 'generate' ? 'transform' : 'edit'}`,\r\n        error_type: errorType,\r\n      });\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Track authentication attempts\r\n   */\r\n  trackAuth(params: {\r\n    action: 'login' | 'register' | 'logout' | 'token_refresh';\r\n    success: boolean;\r\n    userId?: string;\r\n    reason?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !authAttemptsCounter) return;\r\n\r\n    authAttemptsCounter.add(1, {\r\n      action: params.action,\r\n      success: String(params.success),\r\n      reason: params.reason || 'none',\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Track rate limit hits\r\n   */\r\n  trackRateLimit(params: {\r\n    endpoint: string;\r\n    userId?: string;\r\n    ip?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !rateLimitHitsCounter) return;\r\n\r\n    rateLimitHitsCounter.add(1, {\r\n      endpoint: params.endpoint,\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Track API errors\r\n   */\r\n  trackError(params: {\r\n    endpoint: string;\r\n    errorType: string;\r\n    statusCode: number;\r\n    userId?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !apiErrorsCounter) return;\r\n\r\n    apiErrorsCounter.add(1, {\r\n      endpoint: params.endpoint,\r\n      error_type: params.errorType,\r\n      status_code: String(params.statusCode),\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Track storage usage changes\r\n   */\r\n  trackStorageChange(bytes: number, operation: 'add' | 'remove') {\r\n    if (!OTEL_ENABLED || !storageUsageGauge) return;\r\n\r\n    const change = operation === 'add' ? bytes : -bytes;\r\n    storageUsageGauge.add(change, { operation });\r\n  },\r\n\r\n  /**\r\n   * Track active user sessions\r\n   */\r\n  trackUserSession(action: 'start' | 'end') {\r\n    if (!OTEL_ENABLED || !activeUsersGauge) return;\r\n\r\n    activeUsersGauge.add(action === 'start' ? 1 : -1, {});\r\n  },\r\n\r\n  /**\r\n   * Track File Search file uploads\r\n   */\r\n  trackFileSearchUpload(params: {\r\n    category: string;\r\n    success: boolean;\r\n    durationMs: number;\r\n    errorType?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !fileSearchUploadsCounter) return;\r\n\r\n    const { category, success, durationMs, errorType } = params;\r\n\r\n    fileSearchUploadsCounter.add(1, {\r\n      category,\r\n      success: String(success),\r\n    });\r\n\r\n    fileSearchLatencyHistogram.record(durationMs, {\r\n      operation: 'upload',\r\n      category,\r\n      success: String(success),\r\n    });\r\n\r\n    if (!success && errorType) {\r\n      fileSearchErrorsCounter.add(1, {\r\n        operation: 'upload',\r\n        error_type: errorType,\r\n      });\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Track File Search queries\r\n   */\r\n  trackFileSearchQuery(params: {\r\n    category?: string;\r\n    success: boolean;\r\n    durationMs: number;\r\n    resultsCount?: number;\r\n    errorType?: string;\r\n  }) {\r\n    if (!OTEL_ENABLED || !fileSearchQueriesCounter) return;\r\n\r\n    const { category, success, durationMs, errorType } = params;\r\n\r\n    fileSearchQueriesCounter.add(1, {\r\n      category: category || 'all',\r\n      success: String(success),\r\n    });\r\n\r\n    fileSearchLatencyHistogram.record(durationMs, {\r\n      operation: 'query',\r\n      category: category || 'all',\r\n      success: String(success),\r\n    });\r\n\r\n    if (!success && errorType) {\r\n      fileSearchErrorsCounter.add(1, {\r\n        operation: 'query',\r\n        error_type: errorType,\r\n      });\r\n    }\r\n  },\r\n};\r\n\r\n// =============================================================================\r\n// SDK Initialization\r\n// =============================================================================\r\n\r\nif (OTEL_ENABLED && OTEL_PACKAGES_AVAILABLE) {\r\n  // Dynamic imports only if packages are available\r\n  const sdk = require('@opentelemetry/sdk-node');\r\n  const autoInstr = require('@opentelemetry/auto-instrumentations-node');\r\n  const traceExport = require('@opentelemetry/exporter-trace-otlp-proto');\r\n  const metricExport = require('@opentelemetry/exporter-metrics-otlp-proto');\r\n  const sdkMetrics = require('@opentelemetry/sdk-metrics');\r\n  const resources = require('@opentelemetry/resources');\r\n  const semConv = require('@opentelemetry/semantic-conventions');\r\n  const otelApi = require('@opentelemetry/api');\r\n  \r\n  NodeSDK = sdk.NodeSDK;\r\n  getNodeAutoInstrumentations = autoInstr.getNodeAutoInstrumentations;\r\n  OTLPTraceExporter = traceExport.OTLPTraceExporter;\r\n  OTLPMetricExporter = metricExport.OTLPMetricExporter;\r\n  PeriodicExportingMetricReader = sdkMetrics.PeriodicExportingMetricReader;\r\n  defaultResource = resources.defaultResource;\r\n  resourceFromAttributes = resources.resourceFromAttributes;\r\n  SEMRESATTRS_SERVICE_NAME = semConv.SEMRESATTRS_SERVICE_NAME;\r\n  SEMRESATTRS_SERVICE_VERSION = semConv.SEMRESATTRS_SERVICE_VERSION;\r\n  SEMRESATTRS_DEPLOYMENT_ENVIRONMENT = semConv.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT;\r\n  metrics = otelApi.metrics;\r\n  \r\n  const resource = defaultResource().merge(resourceFromAttributes({\r\n    [SEMRESATTRS_SERVICE_NAME]: SERVICE_NAME,\r\n    [SEMRESATTRS_SERVICE_VERSION]: SERVICE_VERSION,\r\n    [SEMRESATTRS_DEPLOYMENT_ENVIRONMENT]: DEPLOYMENT_ENV,\r\n  }));\r\n\r\n  // Parse headers for authentication (e.g., Grafana Cloud, New Relic)\r\n  const headers: Record<string, string> = {};\r\n  if (OTEL_HEADERS) {\r\n    OTEL_HEADERS.split(',').forEach(header => {\r\n      const [key, value] = header.split('=');\r\n      if (key && value) {\r\n        headers[key.trim()] = value.trim();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Configure trace exporter\r\n  const traceExporter = new OTLPTraceExporter({\r\n    url: `${OTEL_ENDPOINT}/v1/traces`,\r\n    headers,\r\n  });\r\n\r\n  // Configure metrics exporter\r\n  const metricExporter = new OTLPMetricExporter({\r\n    url: `${OTEL_ENDPOINT}/v1/metrics`,\r\n    headers,\r\n  });\r\n\r\n  const metricReader = new PeriodicExportingMetricReader({\r\n    exporter: metricExporter,\r\n    exportIntervalMillis: 30000, // Export metrics every 30 seconds\r\n  });\r\n\r\n  // Initialize the SDK\r\n  const otelSdk = new NodeSDK({\r\n    resource,\r\n    traceExporter,\r\n    metricReader,\r\n    instrumentations: [\r\n      getNodeAutoInstrumentations({\r\n        // Customize instrumentation settings\r\n        '@opentelemetry/instrumentation-express': {\r\n          enabled: true,\r\n        },\r\n        '@opentelemetry/instrumentation-http': {\r\n          enabled: true,\r\n        },\r\n        '@opentelemetry/instrumentation-pg': {\r\n          enabled: true,\r\n          enhancedDatabaseReporting: true,\r\n        },\r\n        '@opentelemetry/instrumentation-ioredis': {\r\n          enabled: true,\r\n        },\r\n        // Disable noisy/unnecessary instrumentations\r\n        '@opentelemetry/instrumentation-fs': {\r\n          enabled: false,\r\n        },\r\n        '@opentelemetry/instrumentation-dns': {\r\n          enabled: false,\r\n        },\r\n      }),\r\n    ],\r\n  });\r\n\r\n  // Start the SDK\r\n  otelSdk.start();\r\n\r\n  // Initialize custom metrics after SDK starts\r\n  initializeCustomMetrics();\r\n\r\n  logger.info({\r\n    module: 'otel',\r\n    serviceName: SERVICE_NAME,\r\n    serviceVersion: SERVICE_VERSION,\r\n    environment: DEPLOYMENT_ENV,\r\n    endpoint: OTEL_ENDPOINT,\r\n    authHeaders: Object.keys(headers).length > 0 ? Object.keys(headers) : undefined\r\n  }, 'OpenTelemetry initialized');\r\n\r\n  // Graceful shutdown\r\n  process.on('SIGTERM', () => {\r\n    otelSdk\r\n      .shutdown()\r\n      .then(() => logger.info({ module: 'otel' }, 'OpenTelemetry SDK shut down successfully'))\r\n      .catch((error: any) => logger.error({ module: 'otel', err: error }, 'Error shutting down OpenTelemetry SDK'))\r\n      .finally(() => process.exit(0));\r\n  });\r\n} else {\r\n  logger.info({ module: 'otel' }, 'OpenTelemetry disabled (OTEL_ENABLED=false)');\r\n}\r\n\r\nexport {};\r\n\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\jobs\\generationWorker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2888,2891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2888,2891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2980,2983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2980,2983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3815,3818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3815,3818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3904,3907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3904,3907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8927,8930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8927,8930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9735,9738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9735,9738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Generation Worker\r\n *\r\n * BullMQ worker processor for async generation jobs.\r\n * Handles generate, edit, and variation job types.\r\n *\r\n * This worker:\r\n * 1. Updates generation status to 'processing'\r\n * 2. Calls appropriate Gemini service method\r\n * 3. Uploads result to Cloudinary\r\n * 4. Updates generation with result or error\r\n * 5. Reports progress throughout processing\r\n */\r\n\r\nimport { Job } from 'bullmq';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { storage } from '../storage';\r\nimport { geminiService } from '../services/geminiService';\r\nimport { generateVideo } from '../services/geminiVideoService';\r\nimport { logger } from '../lib/logger';\r\nimport {\r\n  GenerationJobData,\r\n  GenerationJobResult,\r\n  JobType,\r\n  JobStatus,\r\n  JobProgress,\r\n  isGenerateJob,\r\n  isEditJob,\r\n  isVariationJob,\r\n  isVideoGenerateJob,\r\n} from './types';\r\n\r\n// Cloudinary folders\r\nconst CLOUDINARY_FOLDER = 'automated-ads/generations';\r\nconst CLOUDINARY_VIDEO_FOLDER = 'automated-ads/videos';\r\n\r\n/**\r\n * Report progress during job processing\r\n */\r\nasync function reportProgress(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n  stage: JobProgress['stage'],\r\n  percentage: number,\r\n  message: string,\r\n): Promise<void> {\r\n  const progress: JobProgress = { stage, percentage, message };\r\n  await job.updateProgress(progress);\r\n  logger.debug({ jobId: job.id, ...progress }, `Job progress: ${message}`);\r\n}\r\n\r\n/**\r\n * Upload base64 image to Cloudinary\r\n */\r\nasync function uploadToCloudinary(\r\n  base64Data: string,\r\n  generationId: string,\r\n): Promise<{ secure_url: string; public_id: string }> {\r\n  const dataUri = `data:image/png;base64,${base64Data}`;\r\n\r\n  const result = await cloudinary.uploader.upload(dataUri, {\r\n    folder: CLOUDINARY_FOLDER,\r\n    public_id: `generation-${generationId}-${Date.now()}`,\r\n    resource_type: 'image',\r\n  });\r\n\r\n  return {\r\n    secure_url: result.secure_url,\r\n    public_id: result.public_id,\r\n  };\r\n}\r\n\r\n/**\r\n * Process a generate job - create new image from prompt\r\n */\r\nasync function processGenerateJob(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n  data: GenerationJobData & { jobType: JobType.GENERATE },\r\n): Promise<{ imageBase64: string; conversationHistory: any[] }> {\r\n  await reportProgress(job, 'processing', 30, 'Generating image with AI...');\r\n\r\n  const result = await geminiService.generateImage(\r\n    data.prompt,\r\n    {\r\n      aspectRatio: data.aspectRatio,\r\n      referenceImages: undefined,\r\n    },\r\n    data.userId,\r\n  );\r\n\r\n  return {\r\n    imageBase64: result.imageBase64,\r\n    conversationHistory: result.conversationHistory,\r\n  };\r\n}\r\n\r\n/**\r\n * Process an edit job - edit existing image with new instructions\r\n */\r\nasync function processEditJob(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n  data: GenerationJobData & { jobType: JobType.EDIT },\r\n  existingGeneration: { conversationHistory: any[] | null; editCount?: number },\r\n): Promise<{ imageBase64: string; conversationHistory: any[]; editCount: number }> {\r\n  await reportProgress(job, 'processing', 30, 'Editing image with AI...');\r\n\r\n  if (!existingGeneration.conversationHistory) {\r\n    throw new Error('Edit job requires existing conversation history');\r\n  }\r\n\r\n  const result = await geminiService.continueConversation(\r\n    existingGeneration.conversationHistory,\r\n    data.editPrompt,\r\n    data.userId,\r\n  );\r\n\r\n  return {\r\n    imageBase64: result.imageBase64,\r\n    conversationHistory: result.conversationHistory,\r\n    editCount: (existingGeneration.editCount || 0) + 1,\r\n  };\r\n}\r\n\r\n/**\r\n * Process a variation job - create variation of existing image\r\n */\r\nasync function processVariationJob(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n  data: GenerationJobData & { jobType: JobType.VARIATION },\r\n  existingGeneration: { conversationHistory: any[] | null; prompt?: string },\r\n): Promise<{ imageBase64: string; conversationHistory: any[] }> {\r\n  await reportProgress(job, 'processing', 30, 'Creating image variation...');\r\n\r\n  // Extract the original image data from conversation history\r\n  const referenceImages: string[] = [];\r\n  if (existingGeneration.conversationHistory) {\r\n    for (const msg of existingGeneration.conversationHistory) {\r\n      if (msg.role === 'model' && msg.parts) {\r\n        for (const part of msg.parts) {\r\n          if (part.inlineData?.data) {\r\n            referenceImages.push(part.inlineData.data);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Create variation prompt\r\n  const variationPrompt =\r\n    data.prompt ||\r\n    `Create a variation of the original image. Variation strength: ${data.variationStrength || 0.5}. Keep the same subject but vary the style, composition, or details.`;\r\n\r\n  const result = await geminiService.generateImage(\r\n    variationPrompt,\r\n    {\r\n      referenceImages: referenceImages.length > 0 ? referenceImages : undefined,\r\n      aspectRatio: undefined,\r\n    },\r\n    data.userId,\r\n  );\r\n\r\n  return {\r\n    imageBase64: result.imageBase64,\r\n    conversationHistory: result.conversationHistory,\r\n  };\r\n}\r\n\r\n/**\r\n * Upload base64 video to Cloudinary\r\n */\r\nasync function uploadVideoToCloudinary(\r\n  base64Data: string,\r\n  mimeType: string,\r\n  generationId: string,\r\n): Promise<{ secure_url: string; public_id: string }> {\r\n  const dataUri = `data:${mimeType};base64,${base64Data}`;\r\n\r\n  const result = await cloudinary.uploader.upload(dataUri, {\r\n    folder: CLOUDINARY_VIDEO_FOLDER,\r\n    public_id: `video-${generationId}-${Date.now()}`,\r\n    resource_type: 'video',\r\n  });\r\n\r\n  return {\r\n    secure_url: result.secure_url,\r\n    public_id: result.public_id,\r\n  };\r\n}\r\n\r\n/**\r\n * Process a video generation job\r\n */\r\nasync function processVideoGenerateJob(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n  data: GenerationJobData & { jobType: JobType.GENERATE_VIDEO },\r\n): Promise<{ videoBase64: string; mimeType: string; durationSec: number }> {\r\n  const result = await generateVideo(\r\n    data.prompt,\r\n    {\r\n      duration: data.duration,\r\n      aspectRatio: data.aspectRatio,\r\n      resolution: data.videoResolution,\r\n      sourceImageBase64: data.sourceImageUrl ? undefined : undefined,\r\n    },\r\n    async (pct, message) => {\r\n      await reportProgress(job, 'processing', Math.min(pct, 85), message);\r\n    },\r\n    data.userId,\r\n  );\r\n\r\n  return {\r\n    videoBase64: result.videoBase64,\r\n    mimeType: result.mimeType,\r\n    durationSec: result.durationSec,\r\n  };\r\n}\r\n\r\n/**\r\n * Main job processor function\r\n *\r\n * Processes generation jobs from the BullMQ queue.\r\n * Handles generate, edit, variation, and video job types.\r\n */\r\nexport async function processGenerationJob(\r\n  job: Job<GenerationJobData, GenerationJobResult>,\r\n): Promise<GenerationJobResult> {\r\n  const startTime = Date.now();\r\n  const { data } = job;\r\n  const { generationId, jobType, userId } = data;\r\n\r\n  logger.info({ jobId: job.id, generationId, jobType, userId }, 'Starting generation job processing');\r\n\r\n  try {\r\n    // Stage 1: Starting - verify generation exists\r\n    await reportProgress(job, 'starting', 0, 'Initializing job...');\r\n\r\n    const existingGeneration = await storage.getGenerationById(generationId);\r\n    if (!existingGeneration) {\r\n      throw new Error(`Generation not found: ${generationId}`);\r\n    }\r\n\r\n    // Stage 2: Update status to processing\r\n    await reportProgress(job, 'starting', 10, 'Updating status...');\r\n    await storage.updateGeneration(generationId, { status: 'processing' });\r\n\r\n    // Stage 3: Process based on job type\r\n    if (isVideoGenerateJob(data)) {\r\n      //  VIDEO GENERATION PATH \r\n      const videoResult = await processVideoGenerateJob(job, data);\r\n\r\n      await reportProgress(job, 'uploading', 85, 'Uploading video...');\r\n      const cloudinaryResult = await uploadVideoToCloudinary(\r\n        videoResult.videoBase64,\r\n        videoResult.mimeType,\r\n        generationId,\r\n      );\r\n\r\n      await reportProgress(job, 'finalizing', 95, 'Saving video...');\r\n      await storage.updateGeneration(generationId, {\r\n        status: 'completed',\r\n        generatedImagePath: cloudinaryResult.secure_url,\r\n        mediaType: 'video',\r\n        videoDurationSec: videoResult.durationSec,\r\n      });\r\n\r\n      await reportProgress(job, 'finalizing', 100, 'Video generation complete');\r\n      const processingTimeMs = Date.now() - startTime;\r\n\r\n      logger.info(\r\n        { jobId: job.id, generationId, processingTimeMs, mediaType: 'video' },\r\n        'Video generation job completed successfully',\r\n      );\r\n\r\n      return {\r\n        generationId,\r\n        status: JobStatus.COMPLETED,\r\n        imageUrl: cloudinaryResult.secure_url,\r\n        cloudinaryPublicId: cloudinaryResult.public_id,\r\n        mediaType: 'video',\r\n        processingTimeMs,\r\n        completedAt: new Date().toISOString(),\r\n      };\r\n    }\r\n\r\n    //  IMAGE GENERATION PATH \r\n    let processResult: {\r\n      imageBase64: string;\r\n      conversationHistory: any[];\r\n      editCount?: number;\r\n    };\r\n\r\n    if (isGenerateJob(data)) {\r\n      processResult = await processGenerateJob(job, data);\r\n    } else if (isEditJob(data)) {\r\n      processResult = await processEditJob(job, data, existingGeneration);\r\n    } else if (isVariationJob(data)) {\r\n      processResult = await processVariationJob(job, data, existingGeneration);\r\n    } else {\r\n      throw new Error(`Unknown job type: ${jobType}`);\r\n    }\r\n\r\n    // Stage 4: Upload to Cloudinary\r\n    await reportProgress(job, 'uploading', 70, 'Uploading image...');\r\n    const cloudinaryResult = await uploadToCloudinary(processResult.imageBase64, generationId);\r\n\r\n    // Stage 5: Update generation record\r\n    await reportProgress(job, 'finalizing', 90, 'Saving results...');\r\n\r\n    const updateData: Record<string, any> = {\r\n      status: 'completed',\r\n      generatedImagePath: cloudinaryResult.secure_url,\r\n      conversationHistory: processResult.conversationHistory,\r\n    };\r\n\r\n    if (processResult.editCount !== undefined) {\r\n      updateData.editCount = processResult.editCount;\r\n    }\r\n\r\n    await storage.updateGeneration(generationId, updateData);\r\n\r\n    // Stage 6: Complete\r\n    await reportProgress(job, 'finalizing', 100, 'Job completed successfully');\r\n\r\n    const processingTimeMs = Date.now() - startTime;\r\n\r\n    logger.info({ jobId: job.id, generationId, processingTimeMs }, 'Generation job completed successfully');\r\n\r\n    return {\r\n      generationId,\r\n      status: JobStatus.COMPLETED,\r\n      imageUrl: cloudinaryResult.secure_url,\r\n      cloudinaryPublicId: cloudinaryResult.public_id,\r\n      processingTimeMs,\r\n      completedAt: new Date().toISOString(),\r\n    };\r\n  } catch (error) {\r\n    const processingTimeMs = Date.now() - startTime;\r\n    const errorMessage = error instanceof Error ? error.message : String(error);\r\n\r\n    logger.error({ jobId: job.id, generationId, error: errorMessage, processingTimeMs }, 'Generation job failed');\r\n\r\n    // Update generation status to failed\r\n    try {\r\n      await storage.updateGeneration(generationId, {\r\n        status: 'failed',\r\n      });\r\n    } catch (updateError) {\r\n      logger.error({ jobId: job.id, generationId, error: updateError }, 'Failed to update generation status to failed');\r\n    }\r\n\r\n    return {\r\n      generationId,\r\n      status: JobStatus.FAILED,\r\n      error: errorMessage,\r\n      processingTimeMs,\r\n      completedAt: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\jobs\\patternCleanupJob.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[928,931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[928,931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Pattern Cleanup Job\r\n *\r\n * Runs periodically to clean up expired ad analysis uploads.\r\n * Follows privacy-first approach:\r\n * 1. Delete Cloudinary images FIRST\r\n * 2. Then delete database records\r\n *\r\n * TTL: 24 hours (reduced from 7 days for privacy)\r\n */\r\n\r\nimport { storage } from '../storage';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { logger } from '../lib/logger';\r\n\r\n// Run cleanup every hour\r\nconst CLEANUP_INTERVAL_MS = 60 * 60 * 1000; // 1 hour\r\n\r\n/**\r\n * Clean up a single expired upload\r\n */\r\nasync function cleanupUpload(upload: { id: string; cloudinaryPublicId: string }): Promise<boolean> {\r\n  try {\r\n    // Step 1: Delete from Cloudinary first (privacy-first)\r\n    try {\r\n      await cloudinary.uploader.destroy(upload.cloudinaryPublicId);\r\n      logger.debug({ uploadId: upload.id, publicId: upload.cloudinaryPublicId }, 'Deleted image from Cloudinary');\r\n    } catch (cloudinaryError: any) {\r\n      // If image doesn't exist in Cloudinary, continue with DB cleanup\r\n      if (cloudinaryError.http_code !== 404) {\r\n        logger.error({ err: cloudinaryError, uploadId: upload.id }, 'Failed to delete from Cloudinary');\r\n        // Don't delete DB record if Cloudinary fails - retry on next run\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // Step 2: Delete database record\r\n    await storage.deleteUpload(upload.id);\r\n    logger.debug({ uploadId: upload.id }, 'Deleted upload record from database');\r\n\r\n    return true;\r\n  } catch (error) {\r\n    logger.error({ err: error, uploadId: upload.id }, 'Failed to clean up upload');\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Run the cleanup job\r\n */\r\nexport async function runPatternCleanup(): Promise<{ deleted: number; failed: number }> {\r\n  logger.info({ module: 'PatternCleanup' }, 'Starting pattern cleanup job');\r\n\r\n  const expiredUploads = await storage.getExpiredUploads();\r\n\r\n  if (expiredUploads.length === 0) {\r\n    logger.info({ module: 'PatternCleanup' }, 'No expired uploads to clean up');\r\n    return { deleted: 0, failed: 0 };\r\n  }\r\n\r\n  logger.info({ module: 'PatternCleanup', count: expiredUploads.length }, 'Found expired uploads to clean up');\r\n\r\n  let deleted = 0;\r\n  let failed = 0;\r\n\r\n  for (const upload of expiredUploads) {\r\n    const success = await cleanupUpload({\r\n      id: upload.id,\r\n      cloudinaryPublicId: upload.cloudinaryPublicId,\r\n    });\r\n\r\n    if (success) {\r\n      deleted++;\r\n    } else {\r\n      failed++;\r\n    }\r\n  }\r\n\r\n  logger.info({ module: 'PatternCleanup', deleted, failed }, 'Pattern cleanup job completed');\r\n\r\n  return { deleted, failed };\r\n}\r\n\r\n/**\r\n * Start the cleanup job scheduler\r\n */\r\nlet cleanupInterval: NodeJS.Timeout | null = null;\r\n\r\nexport function startPatternCleanupScheduler(): void {\r\n  if (cleanupInterval) {\r\n    logger.warn({ module: 'PatternCleanup' }, 'Cleanup scheduler already running');\r\n    return;\r\n  }\r\n\r\n  // Run immediately on startup\r\n  runPatternCleanup().catch(err => {\r\n    logger.error({ module: 'PatternCleanup', err }, 'Initial cleanup failed');\r\n  });\r\n\r\n  // Schedule periodic cleanup\r\n  cleanupInterval = setInterval(() => {\r\n    runPatternCleanup().catch(err => {\r\n      logger.error({ module: 'PatternCleanup', err }, 'Scheduled cleanup failed');\r\n    });\r\n  }, CLEANUP_INTERVAL_MS);\r\n\r\n  logger.info({ module: 'PatternCleanup', intervalMs: CLEANUP_INTERVAL_MS }, 'Pattern cleanup scheduler started');\r\n}\r\n\r\n/**\r\n * Stop the cleanup job scheduler\r\n */\r\nexport function stopPatternCleanupScheduler(): void {\r\n  if (cleanupInterval) {\r\n    clearInterval(cleanupInterval);\r\n    cleanupInterval = null;\r\n    logger.info({ module: 'PatternCleanup' }, 'Pattern cleanup scheduler stopped');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\jobs\\postingJob.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\jobs\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[274,277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[274,277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[406,409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[406,409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Server-side Analytics  PostHog Integration\r\n *\r\n * Tracks server-side events (generation started/completed, API usage, etc.).\r\n * Initialized lazily on first use. No-op if POSTHOG_API_KEY is not set.\r\n */\r\n\r\nimport { logger } from './logger';\r\n\r\nlet posthogClient: any = null;\r\nlet initialized = false;\r\n\r\n/**\r\n * Lazily initialize PostHog server client.\r\n */\r\nasync function getClient(): Promise<any> {\r\n  if (initialized) return posthogClient;\r\n  initialized = true;\r\n\r\n  const apiKey = process.env.POSTHOG_API_KEY;\r\n  if (!apiKey) {\r\n    logger.debug({ module: 'Analytics' }, 'PostHog disabled (POSTHOG_API_KEY not set)');\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const { PostHog } = await import('posthog-node');\r\n    posthogClient = new PostHog(apiKey, {\r\n      host: process.env.POSTHOG_HOST || 'https://us.i.posthog.com',\r\n      flushAt: 20,\r\n      flushInterval: 10000,\r\n    });\r\n    logger.info({ module: 'Analytics' }, 'PostHog server analytics initialized');\r\n    return posthogClient;\r\n  } catch {\r\n    logger.debug({ module: 'Analytics' }, 'posthog-node not installed  analytics disabled');\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Track a server-side event.\r\n */\r\nexport async function trackEvent(userId: string, event: string, properties?: Record<string, unknown>): Promise<void> {\r\n  const client = await getClient();\r\n  if (!client) return;\r\n\r\n  try {\r\n    client.capture({\r\n      distinctId: userId,\r\n      event,\r\n      properties: {\r\n        ...properties,\r\n        $set: { lastSeen: new Date().toISOString() },\r\n      },\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error, event }, 'Failed to track PostHog event');\r\n  }\r\n}\r\n\r\n/**\r\n * Identify a user (set user properties).\r\n */\r\nexport async function identifyUser(userId: string, properties: Record<string, unknown>): Promise<void> {\r\n  const client = await getClient();\r\n  if (!client) return;\r\n\r\n  try {\r\n    client.identify({\r\n      distinctId: userId,\r\n      properties,\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Failed to identify PostHog user');\r\n  }\r\n}\r\n\r\n/**\r\n * Flush pending events. Call during graceful shutdown.\r\n */\r\nexport async function flushAnalytics(): Promise<void> {\r\n  if (posthogClient) {\r\n    try {\r\n      await posthogClient.shutdown();\r\n      logger.info({ module: 'Analytics' }, 'PostHog flushed on shutdown');\r\n    } catch {\r\n      // Ignore flush errors on shutdown\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\cacheService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\collaboration.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\dbHealth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\gemini.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\geminiClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\geminiHealthMonitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\promptRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\promptSanitizer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\prompts\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\queue.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\redis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\secretManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\sentry.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3143,3146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3143,3146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3507,3510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3507,3510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3518,3521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3518,3521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3529,3532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3529,3532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3540,3543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3540,3543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3809,3812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3809,3812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3820,3823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3820,3823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3831,3834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3831,3834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sentry Error Monitoring\r\n *\r\n * Captures unhandled errors and sends them to Sentry for alerting/debugging.\r\n * Only active when SENTRY_DSN is configured.\r\n */\r\n\r\nimport * as Sentry from '@sentry/node';\r\nimport { logger } from './logger';\r\n\r\nconst SENTRY_DSN = process.env.SENTRY_DSN;\r\nconst IS_PRODUCTION = process.env.NODE_ENV === 'production';\r\n\r\n/**\r\n * Initialize Sentry SDK\r\n * Call this early in app startup, before other middleware\r\n */\r\nexport function initSentry(): void {\r\n  if (!SENTRY_DSN) {\r\n    logger.info({ module: 'Sentry' }, 'Sentry disabled (SENTRY_DSN not set)');\r\n    return;\r\n  }\r\n\r\n  Sentry.init({\r\n    dsn: SENTRY_DSN,\r\n    environment: process.env.NODE_ENV || 'development',\r\n    release: process.env.npm_package_version || '1.0.0',\r\n\r\n    // Only send errors in production by default\r\n    enabled: IS_PRODUCTION || process.env.SENTRY_ENABLED === 'true',\r\n\r\n    // Sample rate for performance monitoring (0-1)\r\n    tracesSampleRate: IS_PRODUCTION ? 0.1 : 1.0,\r\n\r\n    // Don't send PII\r\n    sendDefaultPii: false,\r\n\r\n    // Ignore common non-actionable errors\r\n    ignoreErrors: [\r\n      // Network errors users can't control\r\n      'Network request failed',\r\n      'Failed to fetch',\r\n      'Load failed',\r\n      // User cancelled\r\n      'AbortError',\r\n      // Auth errors (expected)\r\n      'Unauthorized',\r\n      'Invalid session',\r\n    ],\r\n\r\n    // Add useful context\r\n    beforeSend(event, hint) {\r\n      // Don't send 4xx errors (client errors)\r\n      const statusCode = (hint.originalException as any)?.statusCode;\r\n      if (statusCode && statusCode >= 400 && statusCode < 500) {\r\n        return null;\r\n      }\r\n\r\n      // Send Slack/Discord alert for server errors\r\n      if (hint.originalException instanceof Error) {\r\n        import('../services/notificationService')\r\n          .then(({ notifyError }) => {\r\n            notifyError(hint.originalException as Error, {\r\n              eventId: event.event_id ?? 'unknown',\r\n            }).catch(() => {});\r\n          })\r\n          .catch(() => {});\r\n      }\r\n\r\n      return event;\r\n    },\r\n  });\r\n\r\n  logger.info({ module: 'Sentry', environment: process.env.NODE_ENV }, 'Sentry initialized');\r\n}\r\n\r\n/**\r\n * Capture an exception manually\r\n */\r\nexport function captureException(error: Error, context?: Record<string, any>): void {\r\n  if (!SENTRY_DSN) return;\r\n\r\n  Sentry.withScope((scope) => {\r\n    if (context) {\r\n      scope.setExtras(context);\r\n    }\r\n    Sentry.captureException(error);\r\n  });\r\n}\r\n\r\n/**\r\n * Capture a message (for non-error events)\r\n */\r\nexport function captureMessage(message: string, level: 'info' | 'warning' | 'error' = 'info'): void {\r\n  if (!SENTRY_DSN) return;\r\n  Sentry.captureMessage(message, level);\r\n}\r\n\r\n/**\r\n * Set user context for error tracking\r\n */\r\nexport function setUser(user: { id: string; email?: string; username?: string } | null): void {\r\n  if (!SENTRY_DSN) return;\r\n  Sentry.setUser(user);\r\n}\r\n\r\n/**\r\n * Add breadcrumb for debugging context\r\n */\r\nexport function addBreadcrumb(breadcrumb: {\r\n  category: string;\r\n  message: string;\r\n  level?: 'debug' | 'info' | 'warning' | 'error';\r\n  data?: Record<string, any>;\r\n}): void {\r\n  if (!SENTRY_DSN) return;\r\n  Sentry.addBreadcrumb(breadcrumb);\r\n}\r\n\r\n/**\r\n * Express error handler middleware\r\n * Add this AFTER all routes but BEFORE your custom error handler\r\n */\r\n// @ts-expect-error - Sentry Handlers API varies by version, fallback provided\r\nexport const sentryErrorHandler =\r\n  Sentry.Handlers?.errorHandler?.() ?? ((err: any, _req: any, _res: any, next: any) => next(err));\r\n\r\n/**\r\n * Express request handler middleware\r\n * Add this BEFORE all routes\r\n */\r\n// @ts-expect-error - Sentry Handlers API varies by version, fallback provided\r\nexport const sentryRequestHandler =\r\n  Sentry.Handlers?.requestHandler?.() ?? ((_req: any, _res: any, next: any) => next());\r\n\r\n// Re-export Sentry for advanced usage\r\nexport { Sentry };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\ssrfGuard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\lib\\validateEnv.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\apiVersioning.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\featureFlags.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\geminiGuard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\passport.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2035,2038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2035,2038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import passport from 'passport';\r\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth20';\r\nimport { storage } from '../storage';\r\nimport { logger } from '../lib/logger';\r\n\r\n/**\r\n * Initialize Passport.js with Google OAuth 2.0 strategy.\r\n * Only registers the strategy if GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET are set.\r\n */\r\nexport function initializePassport(): void {\r\n  const clientID = process.env.GOOGLE_CLIENT_ID;\r\n  const clientSecret = process.env.GOOGLE_CLIENT_SECRET;\r\n\r\n  if (!clientID || !clientSecret) {\r\n    logger.info({ module: 'Passport' }, 'Google OAuth not configured (GOOGLE_CLIENT_ID/GOOGLE_CLIENT_SECRET not set)');\r\n    return;\r\n  }\r\n\r\n  const callbackURL = process.env.GOOGLE_CALLBACK_URL || '/api/auth/google/callback';\r\n\r\n  passport.use(\r\n    new GoogleStrategy(\r\n      {\r\n        clientID,\r\n        clientSecret,\r\n        callbackURL,\r\n      },\r\n      async (_accessToken, _refreshToken, profile, done) => {\r\n        try {\r\n          const email = profile.emails?.[0]?.value;\r\n          if (!email) {\r\n            return done(new Error('No email returned from Google'), undefined);\r\n          }\r\n\r\n          // Find existing user by email\r\n          let user = await storage.getUserByEmail(email);\r\n\r\n          if (!user) {\r\n            // Create new user with a random password (they'll use OAuth only)\r\n            const { randomBytes } = await import('crypto');\r\n            const randomPassword = randomBytes(32).toString('hex');\r\n            user = await storage.createUser({\r\n              email,\r\n              password: randomPassword,\r\n            });\r\n            logger.info({ module: 'Passport', email, userId: user.id }, 'New user created via Google OAuth');\r\n          }\r\n\r\n          return done(null, user);\r\n        } catch (error) {\r\n          logger.error({ module: 'Passport', err: error }, 'Google OAuth error');\r\n          return done(error as Error, undefined);\r\n        }\r\n      },\r\n    ),\r\n  );\r\n\r\n  // Serialize user ID into session\r\n  passport.serializeUser((user: any, done) => {\r\n    done(null, user.id);\r\n  });\r\n\r\n  // Deserialize user from session\r\n  passport.deserializeUser(async (id: string, done) => {\r\n    try {\r\n      const user = await storage.getUserById(id);\r\n      done(null, user ?? null);\r\n    } catch (error) {\r\n      done(error, null);\r\n    }\r\n  });\r\n\r\n  logger.info({ module: 'Passport' }, 'Google OAuth strategy registered');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\performanceMetrics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"logger"},"fix":{"range":[191,232],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance Metrics Middleware\r\n *\r\n * Tracks per-endpoint latency, throughput, and error rates using LRU eviction\r\n */\r\n\r\nimport { Request, Response, NextFunction } from 'express';\r\nimport { logger } from '../lib/logger';\r\nimport { BoundedMap } from '../utils/memoryManager';\r\n\r\ninterface EndpointMetrics {\r\n    endpoint: string;\r\n    method: string;\r\n    requests: number;\r\n    errors: number;\r\n    totalLatency: number;\r\n    minLatency: number;\r\n    maxLatency: number;\r\n    lastReset: Date;\r\n}\r\n\r\n// Use existing BoundedMap with LRU eviction and automatic cleanup\r\nconst metricsMap = new BoundedMap<string, EndpointMetrics>({\r\n    maxSize: 1000,\r\n    name: 'PerformanceMetrics',\r\n    cleanupIntervalMs: 5 * 60 * 1000, // Clean up every 5 minutes\r\n});\r\n\r\n/**\r\n * Normalize endpoint paths to remove IDs for aggregation\r\n * Converts /api/ads/123 -> /api/ads/:id\r\n * Converts /api/users/550e8400-e29b-41d4-a716-446655440000 -> /api/users/:uuid\r\n */\r\nfunction normalizeEndpoint(path: string): string {\r\n    return path\r\n        .replace(/\\/[0-9a-f]{24}/gi, '/:id') // MongoDB ObjectIds\r\n        .replace(/\\/\\d+/g, '/:id') // Numeric IDs\r\n        .replace(/\\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi, '/:uuid'); // UUIDs\r\n}\r\n\r\n/**\r\n * Express middleware to track performance metrics for each endpoint\r\n */\r\nexport function performanceMetricsMiddleware(req: Request, res: Response, next: NextFunction) {\r\n    // Skip health checks and monitoring endpoints to avoid noise\r\n    if (req.path.startsWith('/api/health') || req.path.startsWith('/api/monitoring')) {\r\n        return next();\r\n    }\r\n\r\n    const start = Date.now();\r\n    const endpoint = normalizeEndpoint(req.path);\r\n    const method = req.method;\r\n    const key = `${method} ${endpoint}`;\r\n\r\n    res.on('finish', () => {\r\n        const latency = Date.now() - start;\r\n        const isError = res.statusCode >= 500;\r\n\r\n        let metrics = metricsMap.get(key);\r\n        if (!metrics) {\r\n            metrics = {\r\n                endpoint,\r\n                method,\r\n                requests: 0,\r\n                errors: 0,\r\n                totalLatency: 0,\r\n                minLatency: Infinity,\r\n                maxLatency: 0,\r\n                lastReset: new Date(),\r\n            };\r\n            metricsMap.set(key, metrics);\r\n        }\r\n\r\n        metrics.requests++;\r\n        if (isError) metrics.errors++;\r\n        metrics.totalLatency += latency;\r\n        metrics.minLatency = Math.min(metrics.minLatency, latency);\r\n        metrics.maxLatency = Math.max(metrics.maxLatency, latency);\r\n    });\r\n\r\n    next();\r\n}\r\n\r\n/**\r\n * Get all performance metrics sorted by request count\r\n */\r\nexport function getPerformanceMetrics() {\r\n    const metrics: Array<{\r\n        endpoint: string;\r\n        method: string;\r\n        requests: number;\r\n        errors: number;\r\n        errorRate: number;\r\n        avgLatency: number;\r\n        minLatency: number;\r\n        maxLatency: number;\r\n        lastReset: Date;\r\n    }> = [];\r\n\r\n    metricsMap.forEach((m, _key) => {\r\n        metrics.push({\r\n            endpoint: m.endpoint,\r\n            method: m.method,\r\n            requests: m.requests,\r\n            errors: m.errors,\r\n            errorRate: m.requests > 0 ? (m.errors / m.requests) * 100 : 0,\r\n            avgLatency: m.requests > 0 ? m.totalLatency / m.requests : 0,\r\n            minLatency: m.minLatency === Infinity ? 0 : m.minLatency,\r\n            maxLatency: m.maxLatency,\r\n            lastReset: m.lastReset,\r\n        });\r\n    });\r\n\r\n    return metrics.sort((a, b) => b.requests - a.requests);\r\n}\r\n\r\n/**\r\n * Reset all performance metrics (called on shutdown)\r\n */\r\nexport function resetPerformanceMetrics() {\r\n    metricsMap.clear();\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\promptInjectionGuard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\rateLimit.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3672,3675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3672,3675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response, NextFunction } from 'express';\r\nimport { logger } from '../lib/logger';\r\nimport { checkRedisRateLimit } from './redisRateLimit';\r\n\r\ninterface RateLimitEntry {\r\n  count: number;\r\n  resetTime: number;\r\n}\r\n\r\ninterface RateLimitStore {\r\n  [key: string]: RateLimitEntry;\r\n}\r\n\r\ninterface RateLimiterOptions {\r\n  windowMs?: number;\r\n  maxRequests?: number;\r\n  useRedis?: boolean;\r\n}\r\n\r\nconst rateLimitLogger = logger.child({ module: 'rateLimit' });\r\n\r\nconst stores: { [name: string]: RateLimitStore } = {};\r\n\r\n// Cleanup interval - runs every 5 minutes to remove expired entries\r\nconst CLEANUP_INTERVAL = 5 * 60 * 1000;\r\n\r\nfunction cleanupExpiredEntries() {\r\n  const now = Date.now();\r\n  for (const storeName of Object.keys(stores)) {\r\n    const store = stores[storeName];\r\n    if (store) {\r\n      for (const key of Object.keys(store)) {\r\n        const entry = store[key];\r\n        if (entry && entry.resetTime < now) {\r\n          delete store[key];\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Start cleanup interval\r\nsetInterval(cleanupExpiredEntries, CLEANUP_INTERVAL);\r\n\r\n/**\r\n * Determine whether Redis should be used for rate limiting.\r\n * - Explicit `useRedis: true/false` takes precedence\r\n * - Otherwise, auto-detect based on REDIS_URL environment variable\r\n */\r\nfunction shouldUseRedis(useRedis: boolean | undefined): boolean {\r\n  if (useRedis !== undefined) {\r\n    return useRedis;\r\n  }\r\n  return Boolean(process.env.REDIS_URL);\r\n}\r\n\r\n/**\r\n * In-memory rate limit check (original logic, used as fallback).\r\n */\r\nfunction checkInMemoryRateLimit(\r\n  store: RateLimitStore,\r\n  key: string,\r\n  windowMs: number,\r\n  maxRequests: number,\r\n): { allowed: boolean; retryAfter: number } {\r\n  const now = Date.now();\r\n  const existing = store[key];\r\n\r\n  if (!existing || existing.resetTime < now) {\r\n    store[key] = { count: 1, resetTime: now + windowMs };\r\n  } else {\r\n    existing.count++;\r\n  }\r\n\r\n  const entry = store[key];\r\n  if (entry && entry.count > maxRequests) {\r\n    const retryAfter = Math.ceil((entry.resetTime - now) / 1000);\r\n    return { allowed: false, retryAfter };\r\n  }\r\n\r\n  return { allowed: true, retryAfter: 0 };\r\n}\r\n\r\n/**\r\n * Build a human-readable store name from window/max values.\r\n * Used both as the in-memory store key and Redis key prefix.\r\n */\r\nfunction buildStoreName(windowMs: number, maxRequests: number): string {\r\n  if (windowMs === 15 * 60 * 1000 && maxRequests === 100) return 'api';\r\n  if (windowMs === 60 * 60 * 1000 && maxRequests === 20) return 'expensive';\r\n  if (windowMs === 60 * 60 * 1000 && maxRequests === 30) return 'edit';\r\n  if (windowMs === 60 * 1000 && maxRequests === 10) return 'login';\r\n  return `limiter_${windowMs}_${maxRequests}`;\r\n}\r\n\r\nexport function createRateLimiter(options: RateLimiterOptions = {}) {\r\n  const windowMs = options.windowMs ?? 15 * 60 * 1000;\r\n  const maxRequests = options.maxRequests ?? 100;\r\n  const storeName = buildStoreName(windowMs, maxRequests);\r\n  const redisEnabled = shouldUseRedis(options.useRedis);\r\n\r\n  // Always initialise in-memory store (used as fallback even when Redis is primary)\r\n  if (!stores[storeName]) {\r\n    stores[storeName] = {};\r\n  }\r\n\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    // Skip rate limiting in test environment only\r\n    // BUG-022b fix: Only allow x-e2e-test header bypass in non-production environments\r\n    if (\r\n      process.env.NODE_ENV === 'test' ||\r\n      (process.env.NODE_ENV !== 'production' && req.headers['x-e2e-test'] === 'true')\r\n    ) {\r\n      return next();\r\n    }\r\n\r\n    // Use user ID for authenticated requests (per-user limiting), fall back to IP\r\n    const userId = (req.session as any)?.userId;\r\n    const key = userId ? `user:${userId}` : (req.ip ?? req.socket.remoteAddress ?? 'unknown');\r\n\r\n    if (redisEnabled) {\r\n      // Attempt Redis-backed rate limiting\r\n      checkRedisRateLimit(storeName, key, windowMs, maxRequests)\r\n        .then((result) => {\r\n          if (result === null) {\r\n            // Redis unavailable  fall back to in-memory\r\n            rateLimitLogger.warn({ storeName, key }, 'Redis rate limit unavailable, using in-memory fallback');\r\n            const memResult = checkInMemoryRateLimit(stores[storeName] as RateLimitStore, key, windowMs, maxRequests);\r\n            if (!memResult.allowed) {\r\n              return res.status(429).json({\r\n                error: 'Too many requests',\r\n                retryAfter: memResult.retryAfter,\r\n                limit: maxRequests,\r\n                windowMs,\r\n              });\r\n            }\r\n            return next();\r\n          }\r\n\r\n          if (!result.allowed) {\r\n            const retryAfter = Math.ceil((result.resetTime - Date.now()) / 1000);\r\n            return res.status(429).json({\r\n              error: 'Too many requests',\r\n              retryAfter: Math.max(retryAfter, 1),\r\n              limit: maxRequests,\r\n              windowMs,\r\n            });\r\n          }\r\n\r\n          return next();\r\n        })\r\n        .catch((err: unknown) => {\r\n          // Unexpected error  fall back to in-memory rather than crashing\r\n          rateLimitLogger.error(\r\n            { storeName, key, err },\r\n            'Unexpected error in Redis rate limit, using in-memory fallback',\r\n          );\r\n          const memResult = checkInMemoryRateLimit(stores[storeName] as RateLimitStore, key, windowMs, maxRequests);\r\n          if (!memResult.allowed) {\r\n            return res.status(429).json({\r\n              error: 'Too many requests',\r\n              retryAfter: memResult.retryAfter,\r\n              limit: maxRequests,\r\n              windowMs,\r\n            });\r\n          }\r\n          return next();\r\n        });\r\n    } else {\r\n      // Pure in-memory rate limiting (original behaviour)\r\n      const store = stores[storeName] as RateLimitStore;\r\n      const memResult = checkInMemoryRateLimit(store, key, windowMs, maxRequests);\r\n      if (!memResult.allowed) {\r\n        return res.status(429).json({\r\n          error: 'Too many requests',\r\n          retryAfter: memResult.retryAfter,\r\n          limit: maxRequests,\r\n          windowMs,\r\n        });\r\n      }\r\n      return next();\r\n    }\r\n  };\r\n}\r\n\r\nexport const apiLimiter = createRateLimiter({ windowMs: 15 * 60 * 1000, maxRequests: 100 });\r\nexport const expensiveLimiter = createRateLimiter({ windowMs: 60 * 60 * 1000, maxRequests: 20 });\r\nexport const editLimiter = createRateLimiter({ windowMs: 60 * 60 * 1000, maxRequests: 30 });\r\nexport const loginLimiter = createRateLimiter({ windowMs: 60 * 1000, maxRequests: 10 });\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\redisRateLimit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\requestId.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\requireRole.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\timeout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\uploadValidation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2659,2662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2659,2662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3158,3161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3158,3161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4433,4436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4433,4436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5143,5146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5143,5146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response, NextFunction } from 'express';\r\nimport { fileTypeFromBuffer } from 'file-type';\r\nimport { storage } from '../storage';\r\nimport { logger } from '../lib/logger';\r\n\r\n/**\r\n * Upload Infrastructure for Learn from Winners\r\n *\r\n * Provides:\r\n * 1. File type validation via magic bytes (not just MIME type)\r\n * 2. User-based rate limiting for pattern uploads (10/hour)\r\n * 3. User quota check (max 100 patterns)\r\n */\r\n\r\n// Allowed image MIME types for ad pattern uploads\r\nconst ALLOWED_IMAGE_TYPES = [\r\n  'image/jpeg',\r\n  'image/png',\r\n  'image/webp',\r\n  'image/gif',\r\n];\r\n\r\nconst ALLOWED_EXTENSIONS = ['jpg', 'jpeg', 'png', 'webp', 'gif'];\r\n\r\n// Max file size for pattern uploads (5MB)\r\nconst MAX_PATTERN_FILE_SIZE = 5 * 1024 * 1024;\r\n\r\n// User-based rate limit store for pattern uploads\r\ninterface UserUploadEntry {\r\n  count: number;\r\n  resetTime: number;\r\n}\r\n\r\nconst userUploadStore: Map<string, UserUploadEntry> = new Map();\r\n\r\n// Cleanup interval - runs every 5 minutes\r\nconst CLEANUP_INTERVAL = 5 * 60 * 1000;\r\nconst UPLOAD_WINDOW_MS = 60 * 60 * 1000; // 1 hour\r\nconst MAX_UPLOADS_PER_HOUR = 10;\r\nconst MAX_PATTERNS_PER_USER = 100;\r\n\r\nfunction cleanupExpiredEntries() {\r\n  const now = Date.now();\r\n  for (const [key, entry] of userUploadStore.entries()) {\r\n    if (entry.resetTime < now) {\r\n      userUploadStore.delete(key);\r\n    }\r\n  }\r\n}\r\n\r\n// Start cleanup interval\r\nsetInterval(cleanupExpiredEntries, CLEANUP_INTERVAL);\r\n\r\n/**\r\n * Validates file type using magic bytes (not just MIME type from header)\r\n * This prevents attackers from uploading executables renamed to .jpg\r\n */\r\nexport async function validateFileType(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n) {\r\n  const file = req.file;\r\n\r\n  if (!file) {\r\n    return res.status(400).json({ error: 'No file uploaded' });\r\n  }\r\n\r\n  // Check file size\r\n  if (file.size > MAX_PATTERN_FILE_SIZE) {\r\n    return res.status(400).json({\r\n      error: 'File too large',\r\n      maxSize: '5MB',\r\n      actualSize: `${(file.size / (1024 * 1024)).toFixed(2)}MB`\r\n    });\r\n  }\r\n\r\n  try {\r\n    // Validate using magic bytes\r\n    const fileInfo = await fileTypeFromBuffer(file.buffer);\r\n\r\n    if (!fileInfo) {\r\n      return res.status(400).json({\r\n        error: 'Could not determine file type',\r\n        message: 'The uploaded file does not appear to be a valid image'\r\n      });\r\n    }\r\n\r\n    if (!ALLOWED_IMAGE_TYPES.includes(fileInfo.mime)) {\r\n      return res.status(400).json({\r\n        error: 'Invalid file type',\r\n        allowed: ALLOWED_EXTENSIONS,\r\n        detected: fileInfo.ext\r\n      });\r\n    }\r\n\r\n    // Attach validated file info to request\r\n    (req as any).validatedFileType = fileInfo;\r\n    next();\r\n  } catch (error) {\r\n    logger.error({ err: error instanceof Error ? error : new Error(String(error)) }, 'File type validation error');\r\n    return res.status(500).json({ error: 'Failed to validate file type' });\r\n  }\r\n}\r\n\r\n/**\r\n * User-based rate limiter for pattern uploads\r\n * Limits to 10 uploads per hour per user\r\n */\r\nexport function uploadPatternLimiter(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n) {\r\n  const user = (req as any).user;\r\n\r\n  if (!user?.id) {\r\n    return res.status(401).json({ error: 'Authentication required' });\r\n  }\r\n\r\n  const userId = user.id;\r\n  const now = Date.now();\r\n\r\n  let entry = userUploadStore.get(userId);\r\n\r\n  if (!entry || entry.resetTime < now) {\r\n    // Create new entry or reset expired one\r\n    entry = { count: 1, resetTime: now + UPLOAD_WINDOW_MS };\r\n    userUploadStore.set(userId, entry);\r\n  } else {\r\n    entry.count++;\r\n  }\r\n\r\n  if (entry.count > MAX_UPLOADS_PER_HOUR) {\r\n    const retryAfter = Math.ceil((entry.resetTime - now) / 1000);\r\n    return res.status(429).json({\r\n      error: 'Upload rate limit exceeded',\r\n      message: `Maximum ${MAX_UPLOADS_PER_HOUR} uploads per hour`,\r\n      retryAfter,\r\n      retryAfterMinutes: Math.ceil(retryAfter / 60),\r\n    });\r\n  }\r\n\r\n  // Add rate limit headers\r\n  res.setHeader('X-RateLimit-Limit', MAX_UPLOADS_PER_HOUR.toString());\r\n  res.setHeader('X-RateLimit-Remaining', (MAX_UPLOADS_PER_HOUR - entry.count).toString());\r\n  res.setHeader('X-RateLimit-Reset', entry.resetTime.toString());\r\n\r\n  next();\r\n}\r\n\r\n/**\r\n * Check user's pattern quota\r\n * Limits to 100 patterns per user\r\n */\r\nexport async function checkPatternQuota(\r\n  req: Request,\r\n  res: Response,\r\n  next: NextFunction\r\n) {\r\n  const user = (req as any).user;\r\n\r\n  if (!user?.id) {\r\n    return res.status(401).json({ error: 'Authentication required' });\r\n  }\r\n\r\n  try {\r\n    // Get user's current pattern count\r\n    const patterns = await storage.getLearnedPatterns(user.id, { isActive: true });\r\n    const currentCount = patterns.length;\r\n\r\n    if (currentCount >= MAX_PATTERNS_PER_USER) {\r\n      return res.status(403).json({\r\n        error: 'Pattern quota exceeded',\r\n        message: `Maximum ${MAX_PATTERNS_PER_USER} patterns allowed per user`,\r\n        currentCount,\r\n        maxAllowed: MAX_PATTERNS_PER_USER,\r\n        suggestion: 'Delete unused patterns to make room for new ones'\r\n      });\r\n    }\r\n\r\n    // Attach quota info to request\r\n    (req as any).patternQuota = {\r\n      current: currentCount,\r\n      max: MAX_PATTERNS_PER_USER,\r\n      remaining: MAX_PATTERNS_PER_USER - currentCount\r\n    };\r\n\r\n    next();\r\n  } catch (error) {\r\n    logger.error({ err: error instanceof Error ? error : new Error(String(error)) }, 'Pattern quota check error');\r\n    return res.status(500).json({ error: 'Failed to check pattern quota' });\r\n  }\r\n}\r\n\r\n/**\r\n * Combined middleware that runs all upload validations\r\n * Use this for the pattern upload endpoint\r\n */\r\nexport const patternUploadValidation = [\r\n  uploadPatternLimiter,\r\n  checkPatternQuota,\r\n  validateFileType,\r\n];\r\n\r\n// Export constants for testing\r\nexport const UPLOAD_LIMITS = {\r\n  MAX_UPLOADS_PER_HOUR,\r\n  MAX_PATTERNS_PER_USER,\r\n  MAX_PATTERN_FILE_SIZE,\r\n  UPLOAD_WINDOW_MS,\r\n  ALLOWED_IMAGE_TYPES,\r\n  ALLOWED_EXTENSIONS,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\validate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\middleware\\webhookAuth.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2855,2858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2855,2858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Request, Response, NextFunction } from 'express';\r\nimport crypto from 'crypto';\r\nimport { logger } from '../lib/logger';\r\n\r\n/**\r\n * Middleware to validate n8n webhook signatures using HMAC-SHA256\r\n *\r\n * This prevents unauthorized access to webhook endpoints by requiring\r\n * a valid signature in the x-n8n-signature header.\r\n *\r\n * @throws 401 if signature is missing, invalid, or doesn't match\r\n */\r\nexport function validateN8nWebhook(req: Request, res: Response, next: NextFunction) {\r\n  try {\r\n    const signature = req.headers['x-n8n-signature'];\r\n    const secret = process.env.N8N_WEBHOOK_SECRET;\r\n\r\n    // Check if signature header exists\r\n    if (!signature || typeof signature !== 'string') {\r\n      logger.warn({ module: 'WebhookAuth', headers: req.headers }, 'Missing x-n8n-signature header');\r\n      return res.status(401).json({\r\n        error: 'Missing webhook signature',\r\n        message: 'x-n8n-signature header is required',\r\n      });\r\n    }\r\n\r\n    // Check if secret is configured\r\n    if (!secret) {\r\n      logger.error({ module: 'WebhookAuth' }, 'N8N_WEBHOOK_SECRET environment variable not configured');\r\n      return res.status(500).json({\r\n        error: 'Server configuration error',\r\n        message: 'Webhook secret not configured',\r\n      });\r\n    }\r\n\r\n    // Compute expected signature from request body\r\n    // For GET requests, req.body is undefined  use empty string\r\n    const bodyString = req.body && Object.keys(req.body).length > 0 ? JSON.stringify(req.body) : '';\r\n    const expectedSignature = crypto.createHmac('sha256', secret).update(bodyString).digest('hex');\r\n\r\n    // Use timing-safe comparison to prevent timing attacks\r\n    const signatureBuffer = Buffer.from(signature);\r\n    const expectedBuffer = Buffer.from(expectedSignature);\r\n\r\n    // Ensure buffers are same length before comparing\r\n    if (signatureBuffer.length !== expectedBuffer.length) {\r\n      logger.warn(\r\n        {\r\n          module: 'WebhookAuth',\r\n          signatureLength: signatureBuffer.length,\r\n          expectedLength: expectedBuffer.length,\r\n        },\r\n        'Signature length mismatch',\r\n      );\r\n      return res.status(401).json({\r\n        error: 'Invalid webhook signature',\r\n        message: 'Signature format is incorrect',\r\n      });\r\n    }\r\n\r\n    // Timing-safe comparison\r\n    if (!crypto.timingSafeEqual(signatureBuffer, expectedBuffer)) {\r\n      logger.warn({ module: 'WebhookAuth', endpoint: req.path }, 'Invalid webhook signature - signature mismatch');\r\n      return res.status(401).json({\r\n        error: 'Invalid webhook signature',\r\n        message: 'Signature verification failed',\r\n      });\r\n    }\r\n\r\n    // Signature is valid, proceed to next middleware\r\n    logger.info({ module: 'WebhookAuth', endpoint: req.path }, 'Webhook signature validated successfully');\r\n    next();\r\n  } catch (error: any) {\r\n    logger.error(\r\n      {\r\n        module: 'WebhookAuth',\r\n        err: error,\r\n        endpoint: req.path,\r\n      },\r\n      'Error during webhook signature validation',\r\n    );\r\n    return res.status(500).json({\r\n      error: 'Signature validation error',\r\n      message: 'An error occurred while validating the webhook signature',\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\migrate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\apiKeyRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\approvalRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1951,1954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1951,1954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  type ApprovalQueue,\r\n  type InsertApprovalQueue,\r\n  type ApprovalAuditLog,\r\n  type InsertApprovalAuditLog,\r\n  type ApprovalSettings,\r\n  type InsertApprovalSettings,\r\n  approvalQueue,\r\n  approvalAuditLog,\r\n  approvalSettings,\r\n} from \"@shared/schema\";\r\nimport { db } from \"../db\";\r\nimport { and, eq, desc, gte, lte } from \"drizzle-orm\";\r\nimport { logger } from \"../lib/logger\";\r\n\r\nexport async function createApprovalQueue(data: InsertApprovalQueue): Promise<ApprovalQueue> {\r\n  const [item] = await db\r\n    .insert(approvalQueue)\r\n    .values({\r\n      ...data,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    })\r\n    .returning();\r\n\r\n  logger.info({ userId: data.userId, queueItemId: item.id }, 'Approval queue item created');\r\n  return item;\r\n}\r\n\r\nexport async function getApprovalQueue(id: string): Promise<ApprovalQueue | null> {\r\n  const [item] = await db\r\n    .select()\r\n    .from(approvalQueue)\r\n    .where(eq(approvalQueue.id, id))\r\n    .limit(1);\r\n\r\n  return item || null;\r\n}\r\n\r\nexport async function getApprovalQueueForUser(\r\n  userId: string,\r\n  filters?: {\r\n    status?: string;\r\n    priority?: string;\r\n    platform?: string;\r\n    dateFrom?: Date;\r\n    dateTo?: Date;\r\n  }\r\n): Promise<ApprovalQueue[]> {\r\n  try {\r\n    const conditions = [eq(approvalQueue.userId, userId)];\r\n\r\n    if (filters?.status) {\r\n      conditions.push(eq(approvalQueue.status, filters.status));\r\n    }\r\n    if (filters?.priority) {\r\n      conditions.push(eq(approvalQueue.priority, filters.priority));\r\n    }\r\n    if (filters?.dateFrom) {\r\n      conditions.push(gte(approvalQueue.createdAt, filters.dateFrom));\r\n    }\r\n    if (filters?.dateTo) {\r\n      conditions.push(lte(approvalQueue.createdAt, filters.dateTo));\r\n    }\r\n\r\n    return await db\r\n      .select()\r\n      .from(approvalQueue)\r\n      .where(and(...conditions))\r\n      .orderBy(desc(approvalQueue.createdAt));\r\n  } catch (error: unknown) {\r\n    const errorCode = (error as any)?.code;\r\n    if (errorCode === '42P01') {\r\n      logger.warn({ module: 'Storage' }, 'approval_queue table does not exist - returning empty array');\r\n      return [];\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function updateApprovalQueue(\r\n  id: string,\r\n  updates: Partial<ApprovalQueue>\r\n): Promise<ApprovalQueue> {\r\n  const [item] = await db\r\n    .update(approvalQueue)\r\n    .set({\r\n      ...updates,\r\n      updatedAt: new Date(),\r\n    })\r\n    .where(eq(approvalQueue.id, id))\r\n    .returning();\r\n\r\n  if (!item) {\r\n    throw new Error(`Approval queue item not found: ${id}`);\r\n  }\r\n\r\n  logger.info({ queueItemId: id, status: item.status }, 'Approval queue item updated');\r\n  return item;\r\n}\r\n\r\nexport async function deleteApprovalQueue(id: string): Promise<void> {\r\n  await db\r\n    .delete(approvalQueue)\r\n    .where(eq(approvalQueue.id, id));\r\n\r\n  logger.info({ queueItemId: id }, 'Approval queue item deleted');\r\n}\r\n\r\nexport async function createApprovalAuditLog(data: InsertApprovalAuditLog): Promise<ApprovalAuditLog> {\r\n  const [log] = await db\r\n    .insert(approvalAuditLog)\r\n    .values({\r\n      ...data,\r\n      createdAt: new Date(),\r\n    })\r\n    .returning();\r\n\r\n  logger.info({ approvalQueueId: data.approvalQueueId, eventType: data.eventType }, 'Audit log created');\r\n  return log;\r\n}\r\n\r\nexport async function getApprovalAuditLog(approvalQueueId: string): Promise<ApprovalAuditLog[]> {\r\n  return db\r\n    .select()\r\n    .from(approvalAuditLog)\r\n    .where(eq(approvalAuditLog.approvalQueueId, approvalQueueId))\r\n    .orderBy(desc(approvalAuditLog.createdAt));\r\n}\r\n\r\nexport async function getApprovalSettings(userId: string): Promise<ApprovalSettings | null> {\r\n  const [settingsRow] = await db\r\n    .select()\r\n    .from(approvalSettings)\r\n    .where(eq(approvalSettings.userId, userId))\r\n    .limit(1);\r\n\r\n  return settingsRow || null;\r\n}\r\n\r\nexport async function updateApprovalSettings(\r\n  userId: string,\r\n  settingsUpdates: Partial<ApprovalSettings>\r\n): Promise<ApprovalSettings> {\r\n  const existing = await getApprovalSettings(userId);\r\n\r\n  if (existing) {\r\n    const [updated] = await db\r\n      .update(approvalSettings)\r\n      .set({\r\n        ...settingsUpdates,\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(eq(approvalSettings.userId, userId))\r\n      .returning();\r\n\r\n    return updated;\r\n  }\r\n\r\n  const [created] = await db\r\n    .insert(approvalSettings)\r\n    .values({\r\n      userId,\r\n      ...settingsUpdates,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    } as InsertApprovalSettings)\r\n    .returning();\r\n\r\n  logger.info({ userId }, 'Approval settings created');\r\n  return created;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\copywritingRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\generationRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\intelligenceRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\knowledgeRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\patternRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\planningRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\productRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\quotaRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\socialRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\styleReferenceRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\templateRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\trainingRepository.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\repositories\\userRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[822,825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[822,825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  type User,\r\n  users,\r\n} from \"@shared/schema\";\r\nimport { db } from \"../db\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\nexport async function createUser(email: string, passwordHash: string): Promise<User> {\r\n  const [user] = await db\r\n    .insert(users)\r\n    .values({ email, password: passwordHash, passwordHash })\r\n    .returning();\r\n  return user;\r\n}\r\n\r\nexport async function getUserByEmail(email: string): Promise<User | undefined> {\r\n  const [user] = await db\r\n    .select()\r\n    .from(users)\r\n    .where(eq(users.email, email));\r\n  return user;\r\n}\r\n\r\nexport async function getUserById(id: string): Promise<User | undefined> {\r\n  const [user] = await db\r\n    .select()\r\n    .from(users)\r\n    .where(eq(users.id, id));\r\n  return user;\r\n}\r\n\r\nexport async function updateUserBrandVoice(userId: string, brandVoice: any): Promise<User> {\r\n  const [user] = await db\r\n    .update(users)\r\n    .set({ brandVoice })\r\n    .where(eq(users.id, userId))\r\n    .returning();\r\n  return user;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'saveOriginalFile' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":26,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"saveOriginalFile"},"fix":{"range":[581,598],"text":""},"desc":"Remove unused variable \"saveOriginalFile\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'saveGeneratedImage' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":46,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"saveGeneratedImage"},"fix":{"range":[597,617],"text":""},"desc":"Remove unused variable \"saveGeneratedImage\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertGenerationSchema' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"insertGenerationSchema"},"fix":{"range":[667,690],"text":""},"desc":"Remove unused variable \"insertGenerationSchema\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertProductSchema' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"insertProductSchema"},"fix":{"range":[689,713],"text":""},"desc":"Remove unused variable \"insertProductSchema\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insertPromptTemplateSchema' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"insertPromptTemplateSchema"},"fix":{"range":[713,744],"text":""},"desc":"Remove unused variable \"insertPromptTemplateSchema\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'optionalAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":27,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":35,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"optionalAuth"},"fix":{"range":[1078,1092],"text":""},"desc":"Remove unused variable \"optionalAuth\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseRetryDelay' is defined but never used. Allowed unused vars must match /^_/u.","line":38,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"parseRetryDelay"},"fix":{"range":[1598,1615],"text":""},"desc":"Remove unused variable \"parseRetryDelay\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseLimitType' is defined but never used. Allowed unused vars must match /^_/u.","line":38,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":65,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"parseLimitType"},"fix":{"range":[1615,1631],"text":""},"desc":"Remove unused variable \"parseLimitType\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EncryptionConfigError' is defined but never used. Allowed unused vars must match /^_/u.","line":62,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"EncryptionConfigError"},"fix":{"range":[2325,2351],"text":""},"desc":"Remove unused variable \"EncryptionConfigError\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'extractPatterns' is defined but never used. Allowed unused vars must match /^_/u.","line":88,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"extractPatterns"},"fix":{"range":[3159,3175],"text":""},"desc":"Remove unused variable \"extractPatterns\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRelevantPatterns' is defined but never used. Allowed unused vars must match /^_/u.","line":90,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":22,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getRelevantPatterns"},"fix":{"range":[3203,3227],"text":""},"desc":"Remove unused variable \"getRelevantPatterns\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ideaBankService' is defined but never used. Allowed unused vars must match /^_/u.","line":98,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":25,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ideaBankService"},"fix":{"range":[3642,3705],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3892,3895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3892,3895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":225,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":225,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10886,10889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10886,10889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":307,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11114,11117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11114,11117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12813,12816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12813,12816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":370,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13038,13041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13038,13041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13418,13421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13418,13421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13445,13448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13445,13448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":396,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":396,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13728,13731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13728,13731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13974,13977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13974,13977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":420,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14622,14625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14622,14625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":422,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14741,14744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14741,14744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":438,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":438,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15466,15469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15466,15469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":457,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16404,16407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16404,16407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":472,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17090,17093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17090,17093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":481,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17456,17459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17456,17459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":486,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17641,17644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17641,17644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":495,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":495,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18021,18024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18021,18024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18489,18492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18489,18492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":516,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":516,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18865,18868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18865,18868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":556,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":556,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20338,20341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20338,20341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":683,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":683,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25630,25633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25630,25633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":766,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":766,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28624,28627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28624,28627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":780,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":780,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29159,29162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29159,29162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":804,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":804,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29949,29952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29949,29952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":828,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":828,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30784,30787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30784,30787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":837,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":837,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31225,31228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31225,31228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generationId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":842,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":842,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":909,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":909,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33880,33883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33880,33883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":975,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":975,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36030,36033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36030,36033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1040,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1040,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38165,38168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38165,38168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":1133,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":1133,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1159,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1159,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42286,42289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42286,42289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1180,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1180,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42892,42895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42892,42895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1203,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1203,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43608,43611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43608,43611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1244,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1244,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45119,45122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45119,45122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1268,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1268,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45890,45893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45890,45893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1281,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1281,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46438,46441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46438,46441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1295,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1295,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46926,46929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46926,46929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1325,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1325,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47966,47969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47966,47969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1352,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1352,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49086,49089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49086,49089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1415,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1415,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51192,51195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51192,51195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1437,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1437,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51890,51893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51890,51893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1449,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1449,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52393,52396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52393,52396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1460,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1460,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52804,52807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52804,52807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1480,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1480,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53866,53869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53866,53869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1515,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1515,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55249,55252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55249,55252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1529,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1529,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55790,55793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55790,55793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1542,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1542,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56335,56338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56335,56338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1549,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1549,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56545,56548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56545,56548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1573,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1573,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57616,57619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57616,57619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1592,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1592,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58397,58400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58397,58400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1623,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1623,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59599,59602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59599,59602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1668,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1668,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61428,61431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61428,61431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1688,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1688,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62099,62102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62099,62102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1702,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1702,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62691,62694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62691,62694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1716,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1716,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63168,63171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63168,63171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1727,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1727,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63523,63526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63523,63526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1773,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1773,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[65091,65094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[65091,65094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1776,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1776,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[65211,65214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[65211,65214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1789,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1789,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[65542,65545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[65542,65545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1813,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1813,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66432,66435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66432,66435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1825,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1825,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66967,66970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66967,66970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1839,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1839,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67662,67665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67662,67665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1852,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1852,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68332,68335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68332,68335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1865,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1865,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68995,68998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68995,68998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1879,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1879,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[69729,69732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[69729,69732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1892,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1892,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[70369,70372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[70369,70372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1905,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1905,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[71010,71013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[71010,71013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1919,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1919,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[71626,71629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[71626,71629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1935,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1935,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72350,72353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72350,72353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1949,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1949,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[73076,73079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[73076,73079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1963,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1963,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[73765,73768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[73765,73768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1979,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1979,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74552,74555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74552,74555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2016,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2016,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75779,75782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75779,75782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2038,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2038,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76644,76647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76644,76647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileCategory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":2048,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":2048,"endColumn":47,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2050,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2050,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77137,77140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77137,77140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2052,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2052,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77228,77231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77228,77231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2066,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2066,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77761,77764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77761,77764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2078,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2078,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78267,78270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78267,78270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2092,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2092,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78821,78824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78821,78824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2113,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2113,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79592,79595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79592,79595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2132,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2132,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80300,80303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80300,80303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2143,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2143,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80748,80751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80748,80751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2169,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2169,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[81682,81685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[81682,81685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2182,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2182,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82216,82219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82216,82219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2196,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2196,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82674,82677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82674,82677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2234,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2234,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84023,84026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84023,84026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2262,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2262,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85101,85104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85101,85104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2272,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2272,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[85542,85545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[85542,85545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2286,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2286,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86156,86159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86156,86159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2298,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2298,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[86712,86715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[86712,86715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2308,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2308,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[87078,87081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[87078,87081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2321,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2321,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[87663,87666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[87663,87666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2327,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2327,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[87853,87856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[87853,87856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2336,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2336,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88216,88219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88216,88219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2339,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2339,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88357,88360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88357,88360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2350,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2350,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88849,88852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88849,88852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2365,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2365,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89536,89539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89536,89539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2379,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2379,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90155,90158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90155,90158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2388,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2388,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90528,90531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90528,90531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2398,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2398,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91020,91023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91020,91023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2407,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2407,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91402,91405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91402,91405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2417,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2417,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91876,91879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91876,91879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2430,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2430,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92448,92451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92448,92451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2443,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2443,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92917,92920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92917,92920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2458,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2458,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93559,93562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93559,93562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2472,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2472,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94112,94115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94112,94115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2483,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2483,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94552,94555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94552,94555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2498,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2498,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95204,95207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95204,95207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2511,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2511,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95682,95685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95682,95685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2526,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2526,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[96171,96174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[96171,96174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2564,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2564,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[97675,97678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[97675,97678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2573,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2573,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[97998,98001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[97998,98001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2578,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2578,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[98295,98298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[98295,98298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2587,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2587,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[98632,98635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[98632,98635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2590,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2590,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[98782,98785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[98782,98785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2599,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2599,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99137,99140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99137,99140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2606,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2606,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99465,99468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99465,99468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2617,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2617,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99885,99888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99885,99888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2627,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2627,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100289,100292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100289,100292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2649,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2649,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101156,101159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101156,101159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2662,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2662,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101661,101664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101661,101664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2675,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2675,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[102167,102170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[102167,102170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2732,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2732,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104976,104979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104976,104979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2741,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2741,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105340,105343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105340,105343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2744,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2744,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105475,105478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105475,105478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2753,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2753,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105859,105862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105859,105862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2756,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2756,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106002,106005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106002,106005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2765,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2765,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106390,106393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106390,106393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2769,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2769,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106599,106602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106599,106602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2778,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2778,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106982,106985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106982,106985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2782,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2782,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107162,107165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107162,107165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2791,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2791,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107548,107551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107548,107551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2794,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2794,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107714,107717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107714,107717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2803,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2803,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108120,108123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108120,108123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2806,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2806,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108286,108289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108286,108289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2820,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2820,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108890,108893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108890,108893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2831,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2831,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[109344,109347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[109344,109347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2860,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2860,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[110497,110500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[110497,110500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2870,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2870,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[110975,110978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[110975,110978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2894,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2894,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[111862,111865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[111862,111865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2931,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2931,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113336,113339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113336,113339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3011,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3011,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116670,116673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116670,116673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3027,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3027,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[117265,117268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[117265,117268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3041,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3041,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[117700,117703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[117700,117703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3066,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3066,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118693,118696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118693,118696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3082,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3082,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[119218,119221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[119218,119221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3099,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3099,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[119818,119821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[119818,119821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3108,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3108,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120191,120194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120191,120194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120654,120657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120654,120657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3132,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3132,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120979,120982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120979,120982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3147,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3147,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[121530,121533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[121530,121533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3156,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3156,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[121856,121859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[121856,121859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3171,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3171,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[122391,122394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[122391,122394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3184,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3184,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[122863,122866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[122863,122866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3192,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3192,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123105,123108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123105,123108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3201,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3201,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123448,123451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123448,123451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3215,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3215,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123864,123867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123864,123867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3224,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3224,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[124207,124210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[124207,124210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3227,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3227,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[124326,124329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[124326,124329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3240,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3240,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[124816,124819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[124816,124819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3243,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3243,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[124967,124970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[124967,124970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3252,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3252,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125309,125312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125309,125312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3263,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3263,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125809,125812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125809,125812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3272,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3272,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126164,126167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126164,126167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3281,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3281,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126454,126457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126454,126457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3290,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3290,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126835,126838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126835,126838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3293,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3293,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126990,126993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126990,126993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3302,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3302,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[127360,127363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[127360,127363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3305,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3305,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[127494,127497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[127494,127497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3314,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3314,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[127864,127867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[127864,127867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3329,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3329,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128328,128331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128328,128331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3338,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3338,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128689,128692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128689,128692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3341,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3341,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128847,128850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128847,128850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3371,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3371,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[129887,129890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[129887,129890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3394,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3394,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130722,130725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130722,130725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3441,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3441,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[132416,132419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[132416,132419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3453,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3453,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[132924,132927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[132924,132927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3475,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3475,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133785,133788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133785,133788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3489,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3489,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[134355,134358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[134355,134358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3501,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3501,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[134872,134875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[134872,134875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3516,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3516,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[135506,135509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[135506,135509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRecentErrors' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":3527,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":3527,"endColumn":30,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3565,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3565,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[137361,137364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[137361,137364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3588,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3588,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138283,138286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138283,138286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3602,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3602,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138837,138840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138837,138840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3618,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3618,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139339,139342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139339,139342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3637,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3637,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140080,140083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140080,140083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3646,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3646,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140492,140495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140492,140495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3656,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3656,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140825,140828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140825,140828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3665,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3665,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141197,141200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141197,141200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3675,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3675,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141517,141520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141517,141520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3686,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3686,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141990,141993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141990,141993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3697,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3697,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[142390,142393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[142390,142393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3724,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3724,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[143318,143321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[143318,143321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3741,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3741,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[144048,144051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[144048,144051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3750,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3750,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[144469,144472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[144469,144472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3759,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3759,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[144830,144833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[144830,144833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3768,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3768,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[145248,145251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[145248,145251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3782,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3782,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[145684,145687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[145684,145687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3793,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3793,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146139,146142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146139,146142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3812,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3812,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146693,146696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146693,146696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3821,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3821,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147110,147113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147110,147113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3831,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3831,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147446,147449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147446,147449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3849,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3849,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148173,148176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148173,148176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3860,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3860,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148606,148609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148606,148609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3880,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3880,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[149158,149161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[149158,149161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3899,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3899,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[149876,149879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[149876,149879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3921,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3921,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[150691,150694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[150691,150694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3938,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3938,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[151283,151286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[151283,151286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3988,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3988,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[152917,152920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[152917,152920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4000,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4000,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[153415,153418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[153415,153418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4085,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4085,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[156491,156494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[156491,156494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4135,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4135,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[158110,158113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[158110,158113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4163,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4163,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[158918,158921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[158918,158921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4223,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4223,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[161004,161007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[161004,161007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4249,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4249,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[161746,161749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[161746,161749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4330,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4330,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[164745,164748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[164745,164748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'n8nCredentialId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4533,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":4533,"endColumn":40,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'platformPostId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4600,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":4600,"endColumn":65,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'platformPostUrl' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4600,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":4600,"endColumn":82,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4600,"column":84,"nodeType":"Identifier","messageId":"unusedVar","endLine":4600,"endColumn":89,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'postedAt' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4600,"column":104,"nodeType":"Identifier","messageId":"unusedVar","endLine":4600,"endColumn":112,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4702,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4702,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[175553,175556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[175553,175556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4719,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4719,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[176094,176097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[176094,176097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4722,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4722,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[176216,176219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[176216,176219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4775,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4775,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[178254,178257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[178254,178257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4790,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4790,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[178686,178689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[178686,178689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4814,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4814,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[179494,179497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[179494,179497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4828,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4828,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[179896,179899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[179896,179899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4866,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4866,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[181043,181046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[181043,181046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4880,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4880,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[181450,181453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[181450,181453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4893,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4893,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[181749,181752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[181749,181752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4907,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4907,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[182173,182176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[182173,182176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4922,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4922,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[182619,182622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[182619,182622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4936,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4936,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[183020,183023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[183020,183023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4962,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4962,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[183857,183860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[183857,183860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4976,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4976,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[184259,184262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[184259,184262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4993,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4993,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[184797,184800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[184797,184800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5008,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5008,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[185274,185277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[185274,185277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'aspectRatio' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":5031,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":5031,"endColumn":54,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'customizations' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":5031,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":5031,"endColumn":70,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5063,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5063,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[187071,187074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[187071,187074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5077,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5077,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[187502,187505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[187502,187505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5116,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5116,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[188814,188817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[188814,188817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5139,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5139,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[189568,189571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[189568,189571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5151,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5151,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[189984,189987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[189984,189987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateWeeklyBalance' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":5152,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":5152,"endColumn":56,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5183,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5183,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[191360,191363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[191360,191363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5195,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5195,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[191772,191775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[191772,191775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'contentCategories' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":5196,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":5196,"endColumn":72,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5231,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5231,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[193246,193249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[193246,193249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5243,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5243,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[193652,193655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[193652,193655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5267,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5267,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194420,194423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194420,194423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5279,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5279,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194813,194816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194813,194816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5289,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5289,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[195144,195147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[195144,195147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5304,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5304,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[195666,195669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[195666,195669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5355,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5355,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[197489,197492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[197489,197492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5396,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5396,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[198866,198869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[198866,198869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\admin.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2120,2123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2120,2123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2896,2899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2896,2899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3660,3663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3660,3663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4408,4411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4408,4411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5227,5230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5227,5230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5948,5951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5948,5951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6631,6634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6631,6634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7368,7371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7368,7371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7939,7942],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7939,7942],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9010,9013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9010,9013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9857,9860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9857,9860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10676,10679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10676,10679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11473,11476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11473,11476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":312,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12307,12310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12307,12310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12841,12844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12841,12844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13699,13702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13699,13702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":370,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14393,14396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14393,14396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":390,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15096,15099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15096,15099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Admin Router\r\n * Admin-only endpoints for seeding data and managing the system\r\n * SECURITY: ALL endpoints require authentication\r\n *\r\n * Endpoints:\r\n * - POST /api/admin/seed-brand - Seed brand profile\r\n * - POST /api/admin/seed-products - Seed products\r\n * - POST /api/admin/seed-installation-scenarios - Seed installation scenarios\r\n * - POST /api/admin/seed-relationships - Seed product relationships\r\n * - POST /api/admin/seed-brand-images - Seed brand images\r\n * - POST /api/admin/seed-templates - Seed performing templates\r\n * - POST /api/admin/seed-all - Run all seeds\r\n * - GET /api/admin/dead-letter-queue - List DLQ jobs with pagination\r\n * - POST /api/admin/dead-letter-queue/:jobId/retry - Retry a DLQ job\r\n * - GET /api/admin/scraper/categories - Get scraper categories\r\n * - POST /api/admin/scraper/scrape-all - Scrape all products\r\n * - POST /api/admin/scraper/scrape-category/:category - Scrape single category\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { validate } from '../middleware/validate';\r\nimport { adminDlqQuerySchema } from '../validation/schemas';\r\nimport { requireRole } from '../middleware/requireRole';\r\n\r\nexport const adminRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  // SECURITY: All admin routes require authentication + admin role\r\n  router.use(requireAuth);\r\n  router.use(requireRole('admin'));\r\n\r\n  /**\r\n   * POST /seed-brand - Seed brand profile\r\n   */\r\n  router.post(\r\n    '/seed-brand',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Force seeding brand profile');\r\n        const { seedBrandProfile } = await import('../seeds/seedBrandProfile');\r\n        await seedBrandProfile();\r\n        res.json({ success: true, message: 'Brand Profile seeded successfully' });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-products - Seed products\r\n   */\r\n  router.post(\r\n    '/seed-products',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Seeding products');\r\n        const { seedProducts } = await import('../seeds/seedProducts');\r\n        const { sampleOnly, cloudinaryOnly, cloudinaryFolder } = req.body || {};\r\n        const results = await seedProducts({ sampleOnly, cloudinaryOnly, cloudinaryFolder });\r\n        res.json({ success: true, message: 'Products seeded successfully', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Product seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-installation-scenarios - Seed installation scenarios\r\n   */\r\n  router.post(\r\n    '/seed-installation-scenarios',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Seeding installation scenarios');\r\n        const { seedInstallationScenarios } = await import('../seeds/seedInstallationScenarios');\r\n        const results = await seedInstallationScenarios();\r\n        res.json({ success: true, message: 'Installation scenarios seeded successfully', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Installation scenarios seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-relationships - Seed product relationships\r\n   */\r\n  router.post(\r\n    '/seed-relationships',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Seeding product relationships');\r\n        const { seedProductRelationships } = await import('../seeds/seedRelationships');\r\n        const results = await seedProductRelationships();\r\n        res.json({ success: true, message: 'Product relationships seeded successfully', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Relationships seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-brand-images - Seed brand images\r\n   */\r\n  router.post(\r\n    '/seed-brand-images',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Seeding brand images');\r\n        const { seedBrandImages } = await import('../seeds/seedBrandImages');\r\n        const { sampleOnly, cloudinaryOnly, cloudinaryFolder } = req.body || {};\r\n        const results = await seedBrandImages({ sampleOnly, cloudinaryOnly, cloudinaryFolder });\r\n        res.json({ success: true, message: 'Brand images seeded successfully', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Brand images seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-templates - Seed performing templates\r\n   */\r\n  router.post(\r\n    '/seed-templates',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Seeding performing templates');\r\n        const { seedPerformingTemplates } = await import('../seeds/seedTemplates');\r\n        const results = await seedPerformingTemplates();\r\n        res.json({ success: true, message: 'Performing templates seeded successfully', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Templates seed failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed-all - Run all seeds\r\n   */\r\n  router.post(\r\n    '/seed-all',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Admin' }, 'Running all seeds');\r\n        const { runAllSeeds } = await import('../seeds/runAllSeeds');\r\n        const options = req.body || {};\r\n        const results = await runAllSeeds(options);\r\n        res.json({ success: true, message: 'All seeds completed', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Seed all failed');\r\n        res.status(500).json({ error: 'Seed failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  // =============================================================================\r\n  // Dead Letter Queue (DLQ) Admin Endpoints\r\n  // =============================================================================\r\n\r\n  /**\r\n   * GET /dead-letter-queue - List jobs in the Dead Letter Queue\r\n   * Query params: start (default 0), limit (default 20)\r\n   */\r\n  router.get(\r\n    '/dead-letter-queue',\r\n    validate(adminDlqQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const validated = (req as any).validatedQuery ?? {};\r\n        const start = validated.start ?? 0;\r\n        const limit = validated.limit ?? 20;\r\n        const end = start + limit - 1;\r\n\r\n        const { listDeadLetterJobs } = await import('../lib/queue');\r\n        const result = await listDeadLetterJobs(start, end);\r\n\r\n        res.json({\r\n          success: true,\r\n          data: result.jobs,\r\n          pagination: {\r\n            start,\r\n            limit,\r\n            total: result.total,\r\n            hasMore: start + limit < result.total,\r\n          },\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Failed to list DLQ jobs');\r\n        res.status(500).json({ error: 'Failed to list dead letter queue jobs', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /dead-letter-queue/:jobId/retry - Retry a DLQ job\r\n   * Re-adds the job to the original generation queue\r\n   */\r\n  router.post(\r\n    '/dead-letter-queue/:jobId/retry',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { jobId } = req.params;\r\n        if (!jobId) {\r\n          res.status(400).json({ error: 'jobId parameter is required' });\r\n          return;\r\n        }\r\n\r\n        const { retryDeadLetterJob } = await import('../lib/queue');\r\n        const result = await retryDeadLetterJob(jobId);\r\n\r\n        if (!result.success) {\r\n          res.status(404).json({ error: result.error });\r\n          return;\r\n        }\r\n\r\n        res.json({\r\n          success: true,\r\n          message: 'Job re-queued successfully',\r\n          newJobId: result.newJobId,\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Failed to retry DLQ job');\r\n        res.status(500).json({ error: 'Failed to retry dead letter queue job', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  // =============================================================================\r\n  // NDS Website Scraper Endpoints\r\n  // =============================================================================\r\n\r\n  /**\r\n   * GET /scraper/categories - Get available categories for scraping\r\n   */\r\n  router.get(\r\n    '/scraper/categories',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { getAvailableCategories } = await import('../services/ndsWebsiteScraper');\r\n        const categories = getAvailableCategories();\r\n        res.json({ success: true, categories });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Scraper', err: error }, 'Failed to get categories');\r\n        res.status(500).json({ error: 'Failed to get categories', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /scraper/scrape-all - Scrape all products from NDS website\r\n   */\r\n  router.post(\r\n    '/scraper/scrape-all',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        logger.info({ module: 'Scraper' }, 'Starting full website scrape');\r\n        const { scrapeNDSWebsite } = await import('../services/ndsWebsiteScraper');\r\n        const { categories, dryRun, limit } = req.body || {};\r\n        const results = await scrapeNDSWebsite({ categories, dryRun, limit });\r\n        res.json({ success: true, message: 'Scraping completed', results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Scraper', err: error }, 'Full scrape failed');\r\n        res.status(500).json({ error: 'Scraping failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /scraper/scrape-category/:category - Scrape a single category\r\n   */\r\n  router.post(\r\n    '/scraper/scrape-category/:category',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { category } = req.params;\r\n        logger.info({ module: 'Scraper', category }, 'Scraping category');\r\n        const { scrapeSingleCategory } = await import('../services/ndsWebsiteScraper');\r\n        const results = await scrapeSingleCategory(category);\r\n        res.json({ success: true, message: `Category ${category} scraped`, results });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Scraper', err: error }, 'Category scrape failed');\r\n        res.status(500).json({ error: 'Scraping failed', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  // =============================================================================\r\n  // A/B Testing / Experiments\r\n  // =============================================================================\r\n\r\n  /**\r\n   * GET /experiments - List all experiments\r\n   */\r\n  router.get(\r\n    '/experiments',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { experiments: expTable } = await import('../../shared/schema');\r\n        const { db } = await import('../db');\r\n        const all = await db.select().from(expTable);\r\n        res.json({ success: true, experiments: all });\r\n      } catch (error: any) {\r\n        res.status(500).json({ error: 'Failed to list experiments', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /experiments - Create a new experiment\r\n   */\r\n  router.post(\r\n    '/experiments',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { createExperiment } = await import('../services/experimentService');\r\n        const experiment = await createExperiment(req.body);\r\n        res.status(201).json({ success: true, experiment });\r\n      } catch (error: any) {\r\n        res.status(500).json({ error: 'Failed to create experiment', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /experiments/:id/status - Update experiment status\r\n   */\r\n  router.post(\r\n    '/experiments/:id/status',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n        const { status } = req.body;\r\n        if (!['running', 'paused', 'completed'].includes(status)) {\r\n          res.status(400).json({ error: 'Invalid status. Must be: running, paused, completed' });\r\n          return;\r\n        }\r\n        const { updateExperimentStatus } = await import('../services/experimentService');\r\n        await updateExperimentStatus(id, status);\r\n        res.json({ success: true, message: `Experiment ${id} status updated to ${status}` });\r\n      } catch (error: any) {\r\n        res.status(500).json({ error: 'Failed to update experiment', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /experiments/:id/results - Get experiment results with aggregation\r\n   */\r\n  router.get(\r\n    '/experiments/:id/results',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { getExperimentResults } = await import('../services/experimentService');\r\n        const results = await getExperimentResults(req.params.id);\r\n        if (!results) {\r\n          res.status(404).json({ error: 'Experiment not found' });\r\n          return;\r\n        }\r\n        res.json({ success: true, ...results });\r\n      } catch (error: any) {\r\n        res.status(500).json({ error: 'Failed to get results', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  // =============================================================================\r\n  // Prompt Registry\r\n  // =============================================================================\r\n\r\n  /**\r\n   * GET /prompts - List all registered prompts with versions\r\n   */\r\n  router.get(\r\n    '/prompts',\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { listPrompts } = await import('../lib/promptRegistry');\r\n        const prompts = listPrompts();\r\n        res.json({ success: true, count: prompts.length, prompts });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Admin', err: error }, 'Failed to list prompts');\r\n        res.status(500).json({ error: 'Failed to list prompts', details: error.message });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const adminRouterModule: RouterModule = {\r\n  prefix: '/api/admin',\r\n  factory: adminRouter,\r\n  description: 'Admin-only endpoints for seeding, experiments, prompt registry, and system management',\r\n  endpointCount: 18,\r\n  requiresAuth: true, // ALL endpoints require auth\r\n  tags: ['admin', 'seeds', 'scraper', 'dlq', 'security-critical'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\agent.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1229,1232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1229,1232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3527,3530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3527,3530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Agent Router\r\n * Conversational AI agent for the Studio page\r\n *\r\n * Endpoints:\r\n * - POST /api/agent/chat - Stream agent response (SSE)\r\n * - DELETE /api/agent/session/:sessionId - Delete agent session\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { streamAgentResponse, deleteAgentSession } from '../services/agent';\r\n\r\nconst MAX_MESSAGE_LENGTH = 4000;\r\nconst MAX_SESSION_ID_LENGTH = 128;\r\nconst SESSION_ID_PATTERN = /^[a-zA-Z0-9_\\-]+$/;\r\n\r\nexport const agentRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth, createRateLimiter } = ctx.middleware;\r\n\r\n  // Rate limit: 60 requests per 15 minutes per user\r\n  const agentLimiter = createRateLimiter({\r\n    windowMs: 15 * 60 * 1000,\r\n    maxRequests: 60,\r\n  });\r\n\r\n  /**\r\n   * POST /chat - Stream agent response via SSE\r\n   */\r\n  router.post(\r\n    '/chat',\r\n    requireAuth,\r\n    agentLimiter,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      const userId = (req as any).session?.userId;\r\n      if (!userId) {\r\n        return res.status(401).json({ error: 'Not authenticated' });\r\n      }\r\n\r\n      const { message, sessionId } = req.body;\r\n      if (!message || typeof message !== 'string') {\r\n        return res.status(400).json({ error: 'message is required and must be a string' });\r\n      }\r\n      if (message.length > MAX_MESSAGE_LENGTH) {\r\n        return res.status(400).json({ error: `Message too long (max ${MAX_MESSAGE_LENGTH} characters)` });\r\n      }\r\n      if (\r\n        sessionId &&\r\n        (typeof sessionId !== 'string' ||\r\n          sessionId.length > MAX_SESSION_ID_LENGTH ||\r\n          !SESSION_ID_PATTERN.test(sessionId))\r\n      ) {\r\n        return res.status(400).json({ error: 'Invalid sessionId' });\r\n      }\r\n\r\n      const sid = typeof sessionId === 'string' && sessionId.length > 0 ? sessionId : `session_${userId}_${Date.now()}`;\r\n\r\n      // SSE headers  include session ID so client can track conversations\r\n      res.setHeader('Content-Type', 'text/event-stream');\r\n      res.setHeader('Cache-Control', 'no-cache');\r\n      res.setHeader('Connection', 'keep-alive');\r\n      res.setHeader('X-Accel-Buffering', 'no');\r\n      res.setHeader('X-Session-Id', sid);\r\n      res.flushHeaders();\r\n\r\n      // Track client disconnect to stop agent execution\r\n      let clientDisconnected = false;\r\n      req.on('close', () => {\r\n        clientDisconnected = true;\r\n      });\r\n\r\n      try {\r\n        for await (const event of streamAgentResponse(storage, userId, sid, message)) {\r\n          if (res.writableEnded || clientDisconnected) break;\r\n          res.write(`data: ${JSON.stringify(event)}\\n\\n`);\r\n        }\r\n      } catch (err: unknown) {\r\n        logger.error({ module: 'AgentRouter', err }, 'SSE stream error');\r\n        if (!res.writableEnded) {\r\n          res.write(\r\n            `data: ${JSON.stringify({ type: 'error', content: 'Something went wrong. Please try again.' })}\\n\\n`,\r\n          );\r\n        }\r\n      }\r\n\r\n      if (!res.writableEnded) {\r\n        res.end();\r\n      }\r\n      return;\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * DELETE /session/:sessionId - Delete an agent session\r\n   */\r\n  router.delete(\r\n    '/session/:sessionId',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      const userId = (req as any).session?.userId;\r\n      if (!userId) {\r\n        return res.status(401).json({ error: 'Not authenticated' });\r\n      }\r\n\r\n      const sessionId = req.params['sessionId'];\r\n      if (!sessionId || typeof sessionId !== 'string') {\r\n        return res.status(400).json({ error: 'sessionId is required' });\r\n      }\r\n      if (sessionId.length > MAX_SESSION_ID_LENGTH || !SESSION_ID_PATTERN.test(sessionId)) {\r\n        return res.status(400).json({ error: 'Invalid sessionId format' });\r\n      }\r\n\r\n      const deleted = await deleteAgentSession(storage, userId, sessionId);\r\n      if (!deleted) {\r\n        return res.status(404).json({ success: false, error: 'Session not found or already deleted' });\r\n      }\r\n      res.json({ success: true });\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const agentRouterModule: RouterModule = {\r\n  prefix: '/api/agent',\r\n  factory: agentRouter,\r\n  description: 'Conversational AI agent for Studio',\r\n  endpointCount: 2,\r\n  requiresAuth: true,\r\n  tags: ['agent', 'ai', 'chat'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\approvalQueue.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1677,1680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1677,1680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3522,3525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3522,3525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Approval Queue Router\r\n * Human-in-the-loop approval workflow for AI-generated content\r\n *\r\n * Endpoints:\r\n * - GET /api/approval-queue - List approval queue items\r\n * - GET /api/approval-queue/:id - Get single queue item\r\n * - POST /api/approval-queue/:id/approve - Approve content\r\n * - POST /api/approval-queue/:id/reject - Reject content\r\n * - POST /api/approval-queue/:id/revision - Request revision\r\n * - POST /api/approval-queue/bulk-approve - Bulk approve multiple items\r\n * - GET /api/approval-queue/:id/audit - Get audit log for item\r\n * - GET /api/approval-queue/settings - Get user approval settings\r\n * - PUT /api/approval-queue/settings - Update user approval settings\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport * as approvalQueueService from '../services/approvalQueueService';\r\nimport { validate } from '../middleware/validate';\r\nimport { approvalQueueQuerySchema } from '../validation/schemas';\r\n\r\nexport const approvalQueueRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * GET / - List approval queue items for current user\r\n   */\r\n  router.get(\r\n    '/',\r\n    requireAuth,\r\n    validate(approvalQueueQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const validated = (req as any).validatedQuery ?? {};\r\n\r\n        const filters: {\r\n          status?: string;\r\n          priority?: string;\r\n          dateFrom?: Date;\r\n          dateTo?: Date;\r\n        } = {};\r\n\r\n        if (validated.status) filters.status = validated.status;\r\n        if (validated.priority) filters.priority = validated.priority;\r\n        if (validated.dateFrom) filters.dateFrom = new Date(validated.dateFrom);\r\n        if (validated.dateTo) filters.dateTo = new Date(validated.dateTo);\r\n\r\n        const items = await approvalQueueService.getQueueForUser(req.user!.id, filters);\r\n\r\n        // Calculate stats\r\n        const stats = {\r\n          total: items.length,\r\n          pendingReview: items.filter((i) => i.status === 'pending_review').length,\r\n          approved: items.filter((i) => i.status === 'approved').length,\r\n          rejected: items.filter((i) => i.status === 'rejected').length,\r\n          needsRevision: items.filter((i) => i.status === 'needs_revision').length,\r\n          urgent: items.filter((i) => i.priority === 'urgent').length,\r\n          highPriority: items.filter((i) => i.priority === 'high').length,\r\n        };\r\n\r\n        // Calculate average confidence\r\n        const withConfidence = items.filter((i) => i.aiConfidenceScore !== null);\r\n        const avgConfidence =\r\n          withConfidence.length > 0\r\n            ? withConfidence.reduce((sum, i) => sum + (i.aiConfidenceScore ?? 0), 0) / withConfidence.length\r\n            : 0;\r\n\r\n        res.json({\r\n          success: true,\r\n          data: {\r\n            items,\r\n            stats: {\r\n              ...stats,\r\n              avgConfidence: Math.round(avgConfidence),\r\n            },\r\n          },\r\n        });\r\n      } catch (error) {\r\n        const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n        const errorCode = (error as any)?.code;\r\n        logger.error({ module: 'ApprovalQueue', err: error, errorMessage, errorCode }, 'Failed to fetch queue items');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to fetch approval queue',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /:id - Get single queue item by ID\r\n   */\r\n  router.get(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n        const item = await storage.getApprovalQueue(id);\r\n\r\n        if (!item) {\r\n          return res.status(404).json({\r\n            success: false,\r\n            error: 'Queue item not found',\r\n          });\r\n        }\r\n\r\n        // Verify ownership\r\n        if (item.userId !== req.user!.id) {\r\n          return res.status(403).json({\r\n            success: false,\r\n            error: 'Unauthorized: You do not own this item',\r\n          });\r\n        }\r\n\r\n        res.json({\r\n          success: true,\r\n          data: item,\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error, id: req.params.id }, 'Failed to fetch queue item');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to fetch queue item',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /:id/approve - Approve a queue item\r\n   */\r\n  router.post(\r\n    '/:id/approve',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n        const { notes } = req.body;\r\n\r\n        // Verify ownership\r\n        const item = await storage.getApprovalQueue(id);\r\n        if (!item) {\r\n          return res.status(404).json({\r\n            success: false,\r\n            error: 'Queue item not found',\r\n          });\r\n        }\r\n\r\n        if (item.userId !== req.user!.id) {\r\n          return res.status(403).json({\r\n            success: false,\r\n            error: 'Unauthorized: You do not own this item',\r\n          });\r\n        }\r\n\r\n        await approvalQueueService.approveContent(id, req.user!.id, notes);\r\n\r\n        logger.info({ userId: req.user!.id, queueItemId: id }, 'Content approved');\r\n\r\n        res.json({\r\n          success: true,\r\n          message: 'Content approved',\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error, id: req.params.id }, 'Failed to approve content');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to approve content',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /:id/reject - Reject a queue item\r\n   */\r\n  router.post(\r\n    '/:id/reject',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n        const { reason } = req.body;\r\n\r\n        if (!reason || typeof reason !== 'string') {\r\n          return res.status(400).json({\r\n            success: false,\r\n            error: 'Rejection reason is required',\r\n          });\r\n        }\r\n\r\n        // Verify ownership\r\n        const item = await storage.getApprovalQueue(id);\r\n        if (!item) {\r\n          return res.status(404).json({\r\n            success: false,\r\n            error: 'Queue item not found',\r\n          });\r\n        }\r\n\r\n        if (item.userId !== req.user!.id) {\r\n          return res.status(403).json({\r\n            success: false,\r\n            error: 'Unauthorized: You do not own this item',\r\n          });\r\n        }\r\n\r\n        await approvalQueueService.rejectContent(id, req.user!.id, reason);\r\n\r\n        logger.info({ userId: req.user!.id, queueItemId: id }, 'Content rejected');\r\n\r\n        res.json({\r\n          success: true,\r\n          message: 'Content rejected',\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error, id: req.params.id }, 'Failed to reject content');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to reject content',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /:id/revision - Request revision for a queue item\r\n   */\r\n  router.post(\r\n    '/:id/revision',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n        const { notes } = req.body;\r\n\r\n        if (!notes || typeof notes !== 'string') {\r\n          return res.status(400).json({\r\n            success: false,\r\n            error: 'Revision notes are required',\r\n          });\r\n        }\r\n\r\n        // Verify ownership\r\n        const item = await storage.getApprovalQueue(id);\r\n        if (!item) {\r\n          return res.status(404).json({\r\n            success: false,\r\n            error: 'Queue item not found',\r\n          });\r\n        }\r\n\r\n        if (item.userId !== req.user!.id) {\r\n          return res.status(403).json({\r\n            success: false,\r\n            error: 'Unauthorized: You do not own this item',\r\n          });\r\n        }\r\n\r\n        await approvalQueueService.requestRevision(id, req.user!.id, notes);\r\n\r\n        logger.info({ userId: req.user!.id, queueItemId: id }, 'Revision requested');\r\n\r\n        res.json({\r\n          success: true,\r\n          message: 'Revision requested',\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error, id: req.params.id }, 'Failed to request revision');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to request revision',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /bulk-approve - Bulk approve multiple items\r\n   */\r\n  router.post(\r\n    '/bulk-approve',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { ids } = req.body;\r\n\r\n        if (!Array.isArray(ids) || ids.length === 0) {\r\n          return res.status(400).json({\r\n            success: false,\r\n            error: 'Array of item IDs is required',\r\n          });\r\n        }\r\n\r\n        // Verify ownership of all items\r\n        for (const id of ids) {\r\n          const item = await storage.getApprovalQueue(id);\r\n          if (!item) {\r\n            return res.status(404).json({\r\n              success: false,\r\n              error: `Queue item not found: ${id}`,\r\n            });\r\n          }\r\n          if (item.userId !== req.user!.id) {\r\n            return res.status(403).json({\r\n              success: false,\r\n              error: `Unauthorized: You do not own item ${id}`,\r\n            });\r\n          }\r\n        }\r\n\r\n        const result = await approvalQueueService.bulkApprove(ids, req.user!.id);\r\n\r\n        logger.info(\r\n          {\r\n            userId: req.user!.id,\r\n            succeeded: result.succeeded.length,\r\n            failed: result.failed.length,\r\n          },\r\n          'Bulk approve completed',\r\n        );\r\n\r\n        res.json({\r\n          success: true,\r\n          data: result,\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error }, 'Failed to bulk approve');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to bulk approve',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /:id/audit - Get audit log for a queue item\r\n   */\r\n  router.get(\r\n    '/:id/audit',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { id } = req.params;\r\n\r\n        // Verify ownership\r\n        const item = await storage.getApprovalQueue(id);\r\n        if (!item) {\r\n          return res.status(404).json({\r\n            success: false,\r\n            error: 'Queue item not found',\r\n          });\r\n        }\r\n\r\n        if (item.userId !== req.user!.id) {\r\n          return res.status(403).json({\r\n            success: false,\r\n            error: 'Unauthorized: You do not own this item',\r\n          });\r\n        }\r\n\r\n        const auditLog = await approvalQueueService.getAuditLog(id);\r\n\r\n        res.json({\r\n          success: true,\r\n          data: auditLog,\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error, id: req.params.id }, 'Failed to fetch audit log');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to fetch audit log',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /settings - Get user approval settings\r\n   */\r\n  router.get(\r\n    '/settings',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const settings = await approvalQueueService.getApprovalSettings(req.user!.id);\r\n\r\n        res.json({\r\n          success: true,\r\n          data: settings || {\r\n            autoApproveEnabled: false,\r\n            minConfidenceForAutoApprove: 95,\r\n            notifyOnPending: true,\r\n            notifyOnAutoApprove: false,\r\n          },\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error }, 'Failed to fetch approval settings');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to fetch approval settings',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PUT /settings - Update user approval settings\r\n   */\r\n  router.put(\r\n    '/settings',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { autoApproveEnabled, minConfidenceForAutoApprove, notifyOnPending, notifyOnAutoApprove } = req.body;\r\n\r\n        const settings = await approvalQueueService.updateApprovalSettings(req.user!.id, {\r\n          autoApproveEnabled,\r\n          minConfidenceForAutoApprove,\r\n          notifyOnPending,\r\n          notifyOnAutoApprove,\r\n        });\r\n\r\n        logger.info({ userId: req.user!.id }, 'Approval settings updated');\r\n\r\n        res.json({\r\n          success: true,\r\n          data: settings,\r\n        });\r\n      } catch (error) {\r\n        logger.error({ module: 'ApprovalQueue', err: error }, 'Failed to update approval settings');\r\n        res.status(500).json({\r\n          success: false,\r\n          error: 'Failed to update approval settings',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const approvalQueueRouterModule: RouterModule = {\r\n  prefix: '/api/approval-queue',\r\n  factory: approvalQueueRouter,\r\n  description: 'Approval queue for AI-generated content',\r\n  endpointCount: 9,\r\n  requiresAuth: true,\r\n  tags: ['approval', 'queue', 'hitl', 'workflow'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\auth.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleRouteError' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":54,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"handleRouteError"},"fix":{"range":[627,645],"text":""},"desc":"Remove unused variable \"handleRouteError\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'requireAuth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1777,1780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1777,1780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2019,2022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2019,2022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3876,3879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3876,3879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4115,4118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4115,4118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4559,4562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4559,4562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4586,4589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4586,4589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5016,5019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5016,5019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5514,5517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5514,5517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6553,6556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6553,6556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6676,6679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6676,6679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\brandImages.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1111,1114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1111,1114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3061,3064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3061,3064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3426,3429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3426,3429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3551,3554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3551,3554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3947,3950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3947,3950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4097,4100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4097,4100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4515,4518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4515,4518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4843,4846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4843,4846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5307,5310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5307,5310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5758,5761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5758,5761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5819,5822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5819,5822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6630,6633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6630,6633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Brand Images Router\r\n * Brand image management endpoints\r\n *\r\n * Endpoints:\r\n * - POST /api/brand-images - Upload brand image\r\n * - GET /api/brand-images - List all brand images\r\n * - GET /api/brand-images/category/:category - Get by category\r\n * - POST /api/brand-images/for-products - Get images for products\r\n * - PUT /api/brand-images/:id - Update brand image\r\n * - DELETE /api/brand-images/:id - Delete brand image\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const brandImagesRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n  const { single: uploadSingle } = ctx.uploads;\r\n\r\n  /**\r\n   * POST / - Upload brand image\r\n   */\r\n  router.post('/', uploadSingle('image'), requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const file = req.file;\r\n\r\n      if (!file) {\r\n        return res.status(400).json({ error: 'Image file is required' });\r\n      }\r\n\r\n      // Upload to Cloudinary\r\n      const cloudinary = (await import('cloudinary')).v2;\r\n      cloudinary.config({\r\n        cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n        api_key: process.env.CLOUDINARY_API_KEY,\r\n        api_secret: process.env.CLOUDINARY_API_SECRET,\r\n      });\r\n\r\n      const uploadResult = await new Promise<any>((resolve, reject) => {\r\n        cloudinary.uploader.upload_stream(\r\n          {\r\n            folder: 'brand-images',\r\n            resource_type: 'image',\r\n          },\r\n          (error, result) => {\r\n            if (error) reject(error);\r\n            else resolve(result);\r\n          }\r\n        ).end(file.buffer);\r\n      });\r\n\r\n      // Parse metadata from body\r\n      // Valid categories: historical_ad, product_hero, installation, detail, lifestyle, comparison\r\n      const validCategories = ['historical_ad', 'product_hero', 'installation', 'detail', 'lifestyle', 'comparison'];\r\n      const category = validCategories.includes(req.body.category) ? req.body.category : 'product_hero';\r\n      const tags = req.body.tags ? JSON.parse(req.body.tags) : [];\r\n      const productIds = req.body.productIds ? JSON.parse(req.body.productIds) : [];\r\n      const suggestedUse = req.body.suggestedUse ? JSON.parse(req.body.suggestedUse) : [];\r\n\r\n      // Create database record\r\n      const brandImage = await storage.createBrandImage({\r\n        userId,\r\n        cloudinaryUrl: uploadResult.secure_url,\r\n        cloudinaryPublicId: uploadResult.public_id,\r\n        category,\r\n        tags,\r\n        description: req.body.description || null,\r\n        productIds,\r\n        scenarioId: req.body.scenarioId || null,\r\n        suggestedUse,\r\n        aspectRatio: req.body.aspectRatio || null,\r\n      });\r\n\r\n      res.status(201).json(brandImage);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'Upload error');\r\n      res.status(500).json({ error: 'Failed to upload brand image' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET / - Get all brand images for user\r\n   */\r\n  router.get('/', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const images = await storage.getBrandImagesByUser(userId);\r\n      res.json(images);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'List error');\r\n      res.status(500).json({ error: 'Failed to get brand images' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /category/:category - Get brand images by category\r\n   */\r\n  router.get('/category/:category', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const images = await storage.getBrandImagesByCategory(userId, req.params.category);\r\n      res.json(images);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'Category query error');\r\n      res.status(500).json({ error: 'Failed to get brand images by category' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /for-products - Get brand images for specific products\r\n   */\r\n  router.post('/for-products', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const { productIds } = req.body;\r\n      if (!productIds || !Array.isArray(productIds)) {\r\n        return res.status(400).json({ error: 'productIds array is required' });\r\n      }\r\n      const images = await storage.getBrandImagesForProducts(productIds, userId);\r\n      res.json(images);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'Products query error');\r\n      res.status(500).json({ error: 'Failed to get brand images for products' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * PUT /:id - Update brand image\r\n   */\r\n  router.put('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const image = await storage.updateBrandImage(req.params.id, req.body);\r\n      res.json(image);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'Update error');\r\n      res.status(500).json({ error: 'Failed to update brand image' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * DELETE /:id - Delete brand image\r\n   */\r\n  router.delete('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      // Get the image to delete from Cloudinary\r\n      const images = await storage.getBrandImagesByUser((req.session as any).userId);\r\n      const imageToDelete = images.find((img: any) => img.id === req.params.id);\r\n\r\n      if (imageToDelete) {\r\n        // Delete from Cloudinary\r\n        const cloudinary = (await import('cloudinary')).v2;\r\n        cloudinary.config({\r\n          cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n          api_key: process.env.CLOUDINARY_API_KEY,\r\n          api_secret: process.env.CLOUDINARY_API_SECRET,\r\n        });\r\n\r\n        try {\r\n          await cloudinary.uploader.destroy(imageToDelete.cloudinaryPublicId);\r\n        } catch (cloudinaryError) {\r\n          logger.warn({ module: 'BrandImages', err: cloudinaryError }, 'Cloudinary delete warning');\r\n          // Continue with database deletion even if Cloudinary fails\r\n        }\r\n      }\r\n\r\n      await storage.deleteBrandImage(req.params.id);\r\n      res.json({ success: true });\r\n    } catch (error: any) {\r\n      logger.error({ module: 'BrandImages', err: error }, 'Delete error');\r\n      res.status(500).json({ error: 'Failed to delete brand image' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const brandImagesRouterModule: RouterModule = {\r\n  prefix: '/api/brand-images',\r\n  factory: brandImagesRouter,\r\n  description: 'Brand image management',\r\n  endpointCount: 6,\r\n  requiresAuth: true,\r\n  tags: ['brand', 'images', 'uploads']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\calendar.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1458,1461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1458,1461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2395,2398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2395,2398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3120,3123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3120,3123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3757,3760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3757,3760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5346,5349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5346,5349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6347,6350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6347,6350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Calendar Router\r\n * Content calendar API for scheduling, viewing, and managing posts\r\n *\r\n * Endpoints:\r\n * - GET  /api/calendar/posts        Posts in date range (calendar grid)\r\n * - GET  /api/calendar/counts       Post counts per day (dot indicators)\r\n * - GET  /api/calendar/posts/:id    Single post details\r\n * - POST /api/calendar/schedule     Schedule a new post\r\n * - PATCH /api/calendar/posts/:id/reschedule  Change scheduled date\r\n * - PATCH /api/calendar/posts/:id/cancel      Cancel a scheduled post\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler, handleRouteError } from './utils/createRouter';\r\nimport {\r\n  getScheduledPostsByDateRange,\r\n  getScheduledPostById,\r\n  getPostCountsByMonth,\r\n  schedulePost,\r\n  reschedulePost,\r\n  cancelScheduledPost,\r\n} from '../services/schedulingRepository';\r\n\r\nexport const calendarRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  // All calendar endpoints require authentication\r\n  router.use(requireAuth);\r\n\r\n  /**\r\n   * GET /posts  Posts in a date range\r\n   * Query: ?start=ISO&end=ISO\r\n   */\r\n  router.get(\r\n    '/posts',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const { start, end } = req.query;\r\n\r\n        if (!start || !end) {\r\n          return res.status(400).json({ error: 'start and end query params required' });\r\n        }\r\n\r\n        const startDate = new Date(start as string);\r\n        const endDate = new Date(end as string);\r\n\r\n        if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {\r\n          return res.status(400).json({ error: 'Invalid date format. Use ISO 8601.' });\r\n        }\r\n\r\n        const posts = await getScheduledPostsByDateRange(userId, startDate, endDate);\r\n        res.json(posts);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.getPosts');\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /counts  Post counts per day for dot indicators\r\n   * Query: ?year=2026&month=2\r\n   */\r\n  router.get(\r\n    '/counts',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const year = parseInt(req.query.year as string, 10);\r\n        const month = parseInt(req.query.month as string, 10);\r\n\r\n        if (!year || !month || month < 1 || month > 12) {\r\n          return res.status(400).json({ error: 'Valid year and month (1-12) query params required' });\r\n        }\r\n\r\n        const counts = await getPostCountsByMonth(userId, year, month);\r\n        res.json(counts);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.getCounts');\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /posts/:id  Single post detail\r\n   */\r\n  router.get(\r\n    '/posts/:id',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const post = await getScheduledPostById(req.params.id, userId);\r\n\r\n        if (!post) {\r\n          return res.status(404).json({ error: 'Post not found' });\r\n        }\r\n\r\n        res.json(post);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.getPost');\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /schedule  Schedule a new post\r\n   * Body: { connectionId, caption, hashtags?, imageUrl?, scheduledFor, timezone?, generationId?, templateId? }\r\n   */\r\n  router.post(\r\n    '/schedule',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const {\r\n          connectionId,\r\n          caption,\r\n          hashtags,\r\n          imageUrl,\r\n          imagePublicId,\r\n          scheduledFor,\r\n          timezone,\r\n          generationId,\r\n          templateId,\r\n        } = req.body;\r\n\r\n        if (!connectionId || !caption || !scheduledFor) {\r\n          return res.status(400).json({ error: 'connectionId, caption, and scheduledFor are required' });\r\n        }\r\n\r\n        const scheduledDate = new Date(scheduledFor);\r\n        if (isNaN(scheduledDate.getTime())) {\r\n          return res.status(400).json({ error: 'Invalid scheduledFor date format' });\r\n        }\r\n\r\n        if (scheduledDate <= new Date()) {\r\n          return res.status(400).json({ error: 'scheduledFor must be in the future' });\r\n        }\r\n\r\n        const post = await schedulePost({\r\n          userId,\r\n          connectionId,\r\n          caption,\r\n          hashtags,\r\n          imageUrl,\r\n          imagePublicId,\r\n          scheduledFor: scheduledDate,\r\n          timezone,\r\n          generationId,\r\n          templateId,\r\n        });\r\n\r\n        logger.info({ postId: post.id, scheduledFor: post.scheduledFor }, 'Post scheduled');\r\n        res.status(201).json(post);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.schedule');\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PATCH /posts/:id/reschedule  Change scheduled date\r\n   * Body: { scheduledFor: ISO }\r\n   */\r\n  router.patch(\r\n    '/posts/:id/reschedule',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const { scheduledFor } = req.body;\r\n\r\n        if (!scheduledFor) {\r\n          return res.status(400).json({ error: 'scheduledFor is required' });\r\n        }\r\n\r\n        const newDate = new Date(scheduledFor);\r\n        if (isNaN(newDate.getTime())) {\r\n          return res.status(400).json({ error: 'Invalid scheduledFor date format' });\r\n        }\r\n\r\n        const post = await reschedulePost(req.params.id, userId, newDate);\r\n\r\n        if (!post) {\r\n          return res.status(404).json({ error: 'Post not found' });\r\n        }\r\n\r\n        logger.info({ postId: post.id, newDate: post.scheduledFor }, 'Post rescheduled');\r\n        res.json(post);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.reschedule');\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PATCH /posts/:id/cancel  Cancel a scheduled post\r\n   */\r\n  router.patch(\r\n    '/posts/:id/cancel',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req as any).user?.id;\r\n        const post = await cancelScheduledPost(req.params.id, userId);\r\n\r\n        if (!post) {\r\n          return res.status(404).json({ error: 'Post not found' });\r\n        }\r\n\r\n        logger.info({ postId: post.id }, 'Post cancelled');\r\n        res.json(post);\r\n      } catch (error) {\r\n        handleRouteError(res, error, 'calendar.cancel');\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const calendarRouterModule: RouterModule = {\r\n  prefix: '/api/calendar',\r\n  factory: calendarRouter,\r\n  description: 'Content calendar scheduling and management',\r\n  endpointCount: 6,\r\n  requiresAuth: true,\r\n  tags: ['calendar', 'scheduling', 'content'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\catalog.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1666,1669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1666,1669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3028,3031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3028,3031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4412,4415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4412,4415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4870,4873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4870,4873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5144,5147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5144,5147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5777,5780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5777,5780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6371,6374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6371,6374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Catalog Router (File Search)\r\n * RAG file search and reference file management\r\n *\r\n * Endpoints:\r\n * - POST /api/file-search/initialize - Initialize file search store\r\n * - POST /api/file-search/upload - Upload reference file\r\n * - POST /api/file-search/upload-directory - Upload directory of files\r\n * - GET /api/file-search/files - List reference files\r\n * - DELETE /api/file-search/files/:fileId - Delete reference file\r\n * - POST /api/file-search/seed - Seed file search store\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { validate } from '../middleware/validate';\r\nimport { catalogFilesQuerySchema } from '../validation/schemas';\r\nimport path from 'path';\r\n\r\nexport const catalogRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n  const { single: uploadSingle } = ctx.uploads;\r\n\r\n  /**\r\n   * POST /initialize - Initialize file search store\r\n   */\r\n  router.post(\r\n    '/initialize',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { initializeFileSearchStore } = await import('../services/fileSearchService');\r\n        const store = await initializeFileSearchStore();\r\n        res.json({ success: true, store: { name: store.name, displayName: store.config?.displayName } });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'InitializeFileSearch', err: error }, 'Error initializing file search');\r\n        res.status(500).json({ error: 'Failed to initialize File Search Store' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /upload - Upload reference file\r\n   */\r\n  router.post(\r\n    '/upload',\r\n    requireAuth,\r\n    uploadSingle('file'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        if (!req.file) {\r\n          return res.status(400).json({ error: 'No file uploaded' });\r\n        }\r\n\r\n        const { category, description, metadata } = req.body;\r\n        if (!category) {\r\n          return res.status(400).json({ error: 'Category is required' });\r\n        }\r\n\r\n        // Safely parse metadata JSON\r\n        let parsedMetadata = {};\r\n        if (metadata) {\r\n          try {\r\n            parsedMetadata = JSON.parse(metadata);\r\n          } catch {\r\n            return res.status(400).json({ error: 'Invalid metadata JSON format' });\r\n          }\r\n        }\r\n\r\n        const { uploadReferenceFile } = await import('../services/fileSearchService');\r\n        const result = await uploadReferenceFile({\r\n          filePath: req.file.path,\r\n          category,\r\n          description,\r\n          metadata: parsedMetadata,\r\n        });\r\n\r\n        res.json({ success: true, file: result });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'UploadReferenceFile', err: error }, 'Error uploading reference file');\r\n        res.status(500).json({ error: 'Failed to upload file' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /upload-directory - Upload directory of reference files\r\n   */\r\n  router.post(\r\n    '/upload-directory',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { directoryPath, category, description } = req.body;\r\n        if (!directoryPath || !category) {\r\n          return res.status(400).json({ error: 'Directory path and category are required' });\r\n        }\r\n\r\n        // BUG-009 fix: Validate directory path to prevent path traversal\r\n        const allowedBaseDir = path.resolve(process.cwd(), 'uploads');\r\n        const resolvedPath = path.resolve(directoryPath);\r\n        if (!resolvedPath.startsWith(allowedBaseDir)) {\r\n          return res.status(400).json({ error: 'Directory path must be within the allowed uploads directory' });\r\n        }\r\n\r\n        const { uploadDirectoryToFileSearch } = await import('../services/fileSearchService');\r\n        const results = await uploadDirectoryToFileSearch({\r\n          directoryPath: resolvedPath,\r\n          category,\r\n          description,\r\n        });\r\n\r\n        res.json({ success: true, files: results, count: results.length });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'UploadDirectory', err: error }, 'Error uploading directory');\r\n        res.status(500).json({ error: 'Failed to upload directory' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /files - List reference files\r\n   */\r\n  router.get(\r\n    '/files',\r\n    requireAuth,\r\n    validate(catalogFilesQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const validated = (req as any).validatedQuery ?? {};\r\n        const { listReferenceFiles } = await import('../services/fileSearchService');\r\n\r\n        const files = await listReferenceFiles(validated.category);\r\n        res.json({ success: true, files, count: files.length });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'ListReferenceFiles', err: error }, 'Error listing reference files');\r\n        res.status(500).json({ error: 'Failed to list files' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * DELETE /files/:fileId - Delete reference file\r\n   */\r\n  router.delete(\r\n    '/files/:fileId',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { fileId } = req.params;\r\n        const { deleteReferenceFile } = await import('../services/fileSearchService');\r\n\r\n        await deleteReferenceFile(fileId);\r\n        res.json({ success: true });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'DeleteReferenceFile', err: error }, 'Error deleting reference file');\r\n        res.status(500).json({ error: 'Failed to delete file' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /seed - Seed file search store with initial structure\r\n   */\r\n  router.post(\r\n    '/seed',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { seedFileSearchStore } = await import('../services/fileSearchService');\r\n        const result = await seedFileSearchStore();\r\n        res.json(result);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'SeedFileSearch', err: error }, 'Error seeding file search');\r\n        res.status(500).json({ error: 'Failed to seed File Search Store' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const catalogRouterModule: RouterModule = {\r\n  prefix: '/api/file-search',\r\n  factory: catalogRouter,\r\n  description: 'RAG file search and reference file management',\r\n  endpointCount: 6,\r\n  requiresAuth: true,\r\n  tags: ['rag', 'files', 'search'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\copywriting.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2163,2166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2163,2166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2287,2290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2287,2290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2642,2645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2642,2645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Copywriting Router\r\n * Standalone copywriting generation endpoint\r\n *\r\n * Endpoints:\r\n * - POST /api/copywriting/standalone - Generate standalone ad copy\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const copywritingRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * POST /standalone - Generate standalone ad copy without a linked generation\r\n   */\r\n  router.post(\r\n    '/standalone',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const {\r\n          platform = 'linkedin',\r\n          tone = 'authentic',\r\n          framework = 'auto',\r\n          campaignObjective = 'engagement',\r\n          productName,\r\n          productDescription,\r\n          variations = 3,\r\n          industry = 'general',\r\n        } = req.body;\r\n\r\n        // Validate required fields\r\n        if (!productName || !productDescription) {\r\n          return res.status(400).json({\r\n            error: 'Missing required fields',\r\n            details: 'productName and productDescription are required',\r\n          });\r\n        }\r\n\r\n        // Validate variations\r\n        const variationCount = Math.min(Math.max(parseInt(variations) || 3, 1), 5);\r\n\r\n        // Call copywriting service\r\n        const { copywritingService } = await import('../services/copywritingService');\r\n        const generatedVariations = await copywritingService.generateCopy({\r\n          platform,\r\n          tone,\r\n          framework,\r\n          campaignObjective,\r\n          productName,\r\n          productDescription,\r\n          industry,\r\n          variations: variationCount,\r\n          // Provide defaults for fields that copywritingService expects\r\n          productBenefits: [],\r\n          uniqueValueProp: productDescription,\r\n        } as any);\r\n\r\n        // Transform to simplified response format\r\n        const responseVariations = generatedVariations.map((v: any) => ({\r\n          copy: v.caption || v.bodyText || '',\r\n          headline: v.headline,\r\n          hook: v.hook,\r\n          hashtags: v.hashtags || [],\r\n          framework: v.framework,\r\n          cta: v.cta,\r\n        }));\r\n\r\n        res.json({\r\n          success: true,\r\n          variations: responseVariations,\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'StandaloneCopy', err: error }, 'Error generating standalone copy');\r\n        res.status(500).json({\r\n          error: 'Failed to generate copy',\r\n        });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const copywritingRouterModule: RouterModule = {\r\n  prefix: '/api/copywriting',\r\n  factory: copywritingRouter,\r\n  description: 'Standalone copywriting generation',\r\n  endpointCount: 1,\r\n  requiresAuth: false,\r\n  tags: ['copywriting', 'ai', 'content'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\generations.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generationQueueEvents' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":66,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'genAIText' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":77,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1719,1722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1719,1722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2355,2358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2355,2358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3268,3271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3268,3271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4221,4224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4221,4224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4715,4718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4715,4718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generationId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":140,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7494,7497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7494,7497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10423,10426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10423,10426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11562,11565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11562,11565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11848,11851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11848,11851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":364,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13115,13118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13115,13118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":382,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13640,13643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13640,13643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":444,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":444,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16090,16093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16090,16093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":516,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":516,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18526,18529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18526,18529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":586,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":586,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20764,20767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20764,20767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\health.router.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\ideaBank.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1081,1084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1081,1084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1920,1923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1920,1923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3237,3240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3237,3240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6531,6534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6531,6534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7189,7192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7189,7192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7536,7539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7536,7539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Idea Bank Router\r\n * AI-powered idea generation and template matching\r\n *\r\n * Endpoints:\r\n * - POST /api/idea-bank/suggest - Generate AI suggestions\r\n * - GET /api/idea-bank/templates/:productId - Get matched templates\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const ideaBankRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { ideaBank } = ctx.domainServices;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * POST /suggest - Generate idea bank suggestions\r\n   * Supports single product, multiple products, and upload descriptions\r\n   * Optional auth for single-tenant mode\r\n   */\r\n  router.post('/suggest', asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      // Use authenticated userId or default system user for single-tenant mode\r\n      const userId = (req.session as any)?.userId || 'system-user';\r\n      const {\r\n        productId, productIds, uploadDescriptions, userGoal,\r\n        enableWebSearch, maxSuggestions,\r\n        mode = 'freestyle', // Default to freestyle for backward compatibility\r\n        templateId // Required when mode = 'template'\r\n      } = req.body;\r\n\r\n      // Validate template mode requirements\r\n      if (mode === 'template' && !templateId) {\r\n        return res.status(400).json({\r\n          error: 'templateId is required when mode is \"template\"'\r\n        });\r\n      }\r\n\r\n      // Support both single productId and multiple productIds\r\n      const ids = productIds || (productId ? [productId] : []);\r\n\r\n      // Validate upload descriptions if provided\r\n      const validUploadDescriptions: string[] = Array.isArray(uploadDescriptions)\r\n        ? uploadDescriptions.filter((d: any) => typeof d === 'string' && d.trim().length > 0).slice(0, 6)\r\n        : [];\r\n\r\n      // Require at least products or upload descriptions\r\n      if (ids.length === 0 && validUploadDescriptions.length === 0) {\r\n        return res.status(400).json({ error: 'productId, productIds, or uploadDescriptions is required' });\r\n      }\r\n\r\n      // For multiple products, aggregate suggestions from each\r\n      if (ids.length > 1) {\r\n        const results = await Promise.all(\r\n          ids.slice(0, 6).map((id: string) => // Limit to 6 products max\r\n            ideaBank.generateSuggestions({\r\n              productId: id,\r\n              userId,\r\n              userGoal,\r\n              uploadDescriptions: validUploadDescriptions,\r\n              enableWebSearch: enableWebSearch || false,\r\n              maxSuggestions: 2, // Fewer per product when multiple\r\n              mode,\r\n              templateId,\r\n            })\r\n          )\r\n        );\r\n\r\n        // Filter successful results and aggregate\r\n        const successfulResults = results.filter(r => r.success);\r\n        if (successfulResults.length === 0) {\r\n          return res.status(500).json({ error: 'Failed to generate suggestions for all products' });\r\n        }\r\n\r\n        // Merge suggestions and aggregate analysis status\r\n        const allSuggestions: any[] = [];\r\n        const aggregateStatus = {\r\n          visionComplete: false,\r\n          kbQueried: false,\r\n          templatesMatched: 0,\r\n          webSearchUsed: false,\r\n          uploadDescriptionsUsed: validUploadDescriptions.length,\r\n        };\r\n\r\n        for (const result of successfulResults) {\r\n          if (result.success) {\r\n            allSuggestions.push(...result.response.suggestions);\r\n            aggregateStatus.visionComplete = aggregateStatus.visionComplete || result.response.analysisStatus.visionComplete;\r\n            aggregateStatus.kbQueried = aggregateStatus.kbQueried || result.response.analysisStatus.kbQueried;\r\n            aggregateStatus.templatesMatched += result.response.analysisStatus.templatesMatched;\r\n            aggregateStatus.webSearchUsed = aggregateStatus.webSearchUsed || result.response.analysisStatus.webSearchUsed;\r\n          }\r\n        }\r\n\r\n        // Sort by confidence and limit\r\n        const sortedSuggestions = allSuggestions\r\n          .sort((a, b) => b.confidence - a.confidence)\r\n          .slice(0, Math.min(maxSuggestions || 6, 10));\r\n\r\n        return res.json({\r\n          suggestions: sortedSuggestions,\r\n          analysisStatus: aggregateStatus,\r\n        });\r\n      }\r\n\r\n      // Single product OR uploads-only flow\r\n      const result = await ideaBank.generateSuggestions({\r\n        productId: ids.length > 0 ? ids[0] : undefined,\r\n        userId,\r\n        userGoal,\r\n        uploadDescriptions: validUploadDescriptions,\r\n        enableWebSearch: enableWebSearch || false,\r\n        maxSuggestions: Math.min(maxSuggestions || 3, 5),\r\n        mode,\r\n        templateId,\r\n      });\r\n\r\n      if (!result.success) {\r\n        const statusCode = result.error.code === 'RATE_LIMITED' ? 429 :\r\n          result.error.code === 'PRODUCT_NOT_FOUND' ? 404 : 500;\r\n        return res.status(statusCode).json({ error: result.error.message, code: result.error.code });\r\n      }\r\n\r\n      // Response shape changes based on mode\r\n      if (mode === 'template') {\r\n        // Type assertion: service returns IdeaBankTemplateResponse when mode='template'\r\n        const templateResponse = result.response as import('@shared/types/ideaBank').IdeaBankTemplateResponse;\r\n        return res.json({\r\n          slotSuggestions: templateResponse.slotSuggestions,\r\n          template: templateResponse.template,\r\n          mergedPrompt: templateResponse.mergedPrompt,\r\n          analysisStatus: templateResponse.analysisStatus,\r\n          recipe: templateResponse.recipe\r\n        });\r\n      }\r\n\r\n      // Existing freestyle response\r\n      // Type assertion: when mode !== 'template', service returns IdeaBankSuggestResponse\r\n      const response = result.response as import('@shared/types/ideaBank').IdeaBankSuggestResponse;\r\n\r\n      // Check if suggestions array is empty and provide helpful message\r\n      if (!response.suggestions || response.suggestions.length === 0) {\r\n        return res.status(200).json({\r\n          suggestions: [],\r\n          analysisStatus: {\r\n            ...response.analysisStatus,\r\n            message: 'No suggestions generated. Try adding products or images.',\r\n            details: 'AI analysis completed but no viable prompts found.'\r\n          }\r\n        });\r\n      }\r\n\r\n      res.json(response);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'IdeaBankSuggest', err: error }, 'Error suggesting ideas');\r\n\r\n      // Return structured error with retry signal\r\n      res.status(500).json({\r\n        error: 'Failed to generate suggestions',\r\n        message: 'Please try again or contact support',\r\n        fallback: true // Signal to client this is retryable\r\n      });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /templates/:productId - Get matched templates for a product\r\n   */\r\n  router.get('/templates/:productId', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const { productId } = req.params;\r\n      const userId = (req.session as any).userId;\r\n\r\n      const result = await ideaBank.getMatchedTemplates(productId, userId);\r\n\r\n      if (!result) {\r\n        return res.status(404).json({ error: 'Product not found or analysis failed' });\r\n      }\r\n\r\n      res.json({\r\n        templates: result.templates,\r\n        productAnalysis: result.analysis,\r\n      });\r\n    } catch (error: any) {\r\n      logger.error({ module: 'IdeaBankTemplates', err: error }, 'Error fetching templates');\r\n      res.status(500).json({ error: 'Failed to get matched templates' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const ideaBankRouterModule: RouterModule = {\r\n  prefix: '/api/idea-bank',\r\n  factory: ideaBankRouter,\r\n  description: 'AI-powered idea generation and template matching',\r\n  endpointCount: 2,\r\n  requiresAuth: false, // suggest is optional auth\r\n  tags: ['ai', 'ideas', 'templates']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\image.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1050,1053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1050,1053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2027,2030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2027,2030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Image Router\r\n * Image analysis endpoints (standalone, not product-specific)\r\n *\r\n * Endpoints:\r\n * - POST /api/analyze-image - Analyze an uploaded image with vision AI\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const imageRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n  const { single: uploadSingle } = ctx.uploads;\r\n\r\n  /**\r\n   * POST /analyze-image - Analyze an uploaded image\r\n   * Standalone image analysis, not tied to a product\r\n   */\r\n  router.post(\r\n    '/analyze-image',\r\n    requireAuth,\r\n    uploadSingle('image'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any)?.userId || 'system-user';\r\n        const file = req.file;\r\n\r\n        if (!file) {\r\n          return res.status(400).json({ error: 'No image file provided' });\r\n        }\r\n\r\n        // Validate file type\r\n        if (!file.mimetype.startsWith('image/')) {\r\n          return res.status(400).json({ error: 'File must be an image' });\r\n        }\r\n\r\n        const { visionAnalysisService } = await import('../services/visionAnalysisService');\r\n        const result = await visionAnalysisService.analyzeArbitraryImage(file.buffer, file.mimetype, userId);\r\n\r\n        if (!result.success) {\r\n          if (result.error.code === 'RATE_LIMITED') {\r\n            return res.status(429).json({ error: result.error.message });\r\n          }\r\n          return res.status(500).json({ error: result.error.message });\r\n        }\r\n\r\n        res.json({\r\n          description: result.analysis.description,\r\n          confidence: result.analysis.confidence,\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'AnalyzeImage', err: error }, 'Error analyzing image');\r\n        res.status(500).json({ error: 'Failed to analyze image' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const imageRouterModule: RouterModule = {\r\n  prefix: '/api',\r\n  factory: imageRouter,\r\n  description: 'Standalone image analysis',\r\n  endpointCount: 1,\r\n  requiresAuth: false,\r\n  tags: ['vision', 'image', 'analysis'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\intelligence.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1488,1491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1488,1491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1754,1757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1754,1757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2210,2213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2210,2213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2864,2867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2864,2867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3316,3319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3316,3319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4391,4394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4391,4394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4841,4844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4841,4844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5116,5119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5116,5119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5565,5568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5565,5568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6417,6420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6417,6420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6891,6894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6891,6894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7173,7176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7173,7176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7608,7611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7608,7611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7866,7869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7866,7869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8313,8316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8313,8316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8833,8836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8833,8836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Intelligence Router (WS-C5)\r\n * Product intelligence layer  priorities, business intelligence, and selection\r\n *\r\n * Endpoints:\r\n * - GET /api/intelligence/priorities  Get user's product priorities\r\n * - PUT /api/intelligence/priorities/:productId  Set priority for one product\r\n * - POST /api/intelligence/priorities/bulk  Batch set priorities (from onboarding)\r\n * - GET /api/intelligence/business  Get business intelligence\r\n * - PUT /api/intelligence/business  Save/update business intelligence\r\n * - GET /api/intelligence/onboarding-status  Check if onboarding complete\r\n * - GET /api/intelligence/stats  Get posting stats per product\r\n * - POST /api/intelligence/select  Select products for weekly plan\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const intelligenceRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * GET /priorities  Get all product priorities for the current user\r\n   */\r\n  router.get(\r\n    '/priorities',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const priorities = await productIntelligenceService.getProductPriorities(userId);\r\n        res.json({ priorities });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to get priorities');\r\n        res.status(500).json({ error: 'Failed to get product priorities' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PUT /priorities/:productId  Set priority for one product\r\n   */\r\n  router.put(\r\n    '/priorities/:productId',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const productId = req.params['productId'] as string;\r\n        const { revenueTier, revenueWeight, competitiveAngle, keySellingPoints, monthlyTarget, seasonalRelevance } =\r\n          req.body;\r\n\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const priority = await productIntelligenceService.setProductPriority(userId, productId, {\r\n          revenueTier,\r\n          revenueWeight,\r\n          competitiveAngle,\r\n          keySellingPoints,\r\n          monthlyTarget,\r\n          seasonalRelevance,\r\n        });\r\n\r\n        res.json({ priority });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to set priority');\r\n        res.status(500).json({ error: 'Failed to set product priority' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /priorities/bulk  Batch set priorities (from onboarding)\r\n   */\r\n  router.post(\r\n    '/priorities/bulk',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { priorities } = req.body;\r\n\r\n        if (!Array.isArray(priorities) || priorities.length === 0) {\r\n          return res.status(400).json({ error: 'priorities must be a non-empty array' });\r\n        }\r\n\r\n        // Validate each entry\r\n        for (const p of priorities) {\r\n          if (!p.productId || typeof p.productId !== 'string') {\r\n            return res.status(400).json({ error: 'Each priority must have a productId string' });\r\n          }\r\n          if (\r\n            p.revenueWeight !== undefined &&\r\n            (typeof p.revenueWeight !== 'number' || p.revenueWeight < 1 || p.revenueWeight > 10)\r\n          ) {\r\n            return res.status(400).json({ error: 'revenueWeight must be a number between 1 and 10' });\r\n          }\r\n        }\r\n\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        await productIntelligenceService.bulkSetPriorities(userId, priorities);\r\n\r\n        res.json({ message: 'Priorities updated', count: priorities.length });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to bulk set priorities');\r\n        res.status(500).json({ error: 'Failed to bulk set priorities' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /business  Get business intelligence for the current user\r\n   */\r\n  router.get(\r\n    '/business',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const bi = await productIntelligenceService.getBusinessIntelligence(userId);\r\n        res.json({ businessIntelligence: bi });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to get business intelligence');\r\n        res.status(500).json({ error: 'Failed to get business intelligence' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PUT /business  Save/update business intelligence\r\n   */\r\n  router.put(\r\n    '/business',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const {\r\n          industry,\r\n          niche,\r\n          differentiator,\r\n          targetCustomer,\r\n          contentThemes,\r\n          postsPerWeek,\r\n          categoryTargets,\r\n          preferredPlatforms,\r\n          postingTimes,\r\n          onboardingComplete,\r\n        } = req.body;\r\n\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const bi = await productIntelligenceService.saveBusinessIntelligence(userId, {\r\n          industry,\r\n          niche,\r\n          differentiator,\r\n          targetCustomer,\r\n          contentThemes,\r\n          postsPerWeek,\r\n          categoryTargets,\r\n          preferredPlatforms,\r\n          postingTimes,\r\n          onboardingComplete,\r\n        });\r\n\r\n        res.json({ businessIntelligence: bi });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to save business intelligence');\r\n        res.status(500).json({ error: 'Failed to save business intelligence' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /onboarding-status  Check if user has completed onboarding\r\n   */\r\n  router.get(\r\n    '/onboarding-status',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const complete = await productIntelligenceService.isOnboardingComplete(userId);\r\n        res.json({ onboardingComplete: complete });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to check onboarding status');\r\n        res.status(500).json({ error: 'Failed to check onboarding status' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /stats  Get posting stats per product\r\n   */\r\n  router.get(\r\n    '/stats',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const stats = await productIntelligenceService.getProductPostingStats(userId);\r\n        res.json({ stats });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to get posting stats');\r\n        res.status(500).json({ error: 'Failed to get posting stats' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /select  Select products for weekly plan (used by planner)\r\n   */\r\n  router.post(\r\n    '/select',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const { numPosts } = req.body;\r\n\r\n        if (!numPosts || typeof numPosts !== 'number' || numPosts < 1 || numPosts > 30) {\r\n          return res.status(400).json({ error: 'numPosts must be a number between 1 and 30' });\r\n        }\r\n\r\n        const { productIntelligenceService } = await import('../services/productIntelligenceService');\r\n        const selections = await productIntelligenceService.selectProductsForWeek(userId, numPosts);\r\n        res.json({ selections });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'Intelligence', err: error }, 'Failed to select products');\r\n        res.status(500).json({ error: 'Failed to select products for weekly plan' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const intelligenceRouterModule: RouterModule = {\r\n  prefix: '/api/intelligence',\r\n  factory: intelligenceRouter,\r\n  description: 'Product intelligence layer  priorities, business intelligence, and smart selection',\r\n  endpointCount: 8,\r\n  requiresAuth: true,\r\n  tags: ['intelligence', 'products', 'planning', 'onboarding'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\monitoring.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2335,2338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2335,2338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2661,2664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2661,2664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3556,3559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3556,3559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3651,3654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3651,3654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3797,3800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3797,3800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3977,3980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3977,3980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3985,3988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3985,3988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4062,4065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4062,4065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4707,4710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4707,4710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5338,5341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5338,5341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5712,5715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5712,5715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Monitoring Router\r\n * System monitoring and health aggregation endpoints\r\n *\r\n * Endpoints:\r\n * - GET /api/monitoring/health - System health check\r\n * - GET /api/monitoring/performance - Performance metrics\r\n * - GET /api/monitoring/errors - Error tracking\r\n * - GET /api/monitoring/system - Full system health aggregation\r\n * - GET /api/monitoring/endpoints - API endpoints summary\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { validate } from '../middleware/validate';\r\nimport { monitoringErrorsQuerySchema } from '../validation/schemas';\r\n\r\nexport const monitoringRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * GET /health - System health check\r\n   */\r\n  router.get(\r\n    '/health',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { getSystemHealth } = await import('../services/systemHealthService');\r\n        const health = await getSystemHealth();\r\n        res.json(health);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'monitoring', error }, 'Failed to fetch system health');\r\n        res.status(500).json({ error: 'Failed to fetch system health' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /performance - Performance metrics\r\n   */\r\n  router.get(\r\n    '/performance',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { getPerformanceMetrics } = await import('../middleware/performanceMetrics');\r\n        const metrics = getPerformanceMetrics();\r\n        res.json(metrics);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'monitoring', error }, 'Failed to fetch performance metrics');\r\n        res.status(500).json({ error: 'Failed to fetch performance metrics' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /errors - Error tracking\r\n   */\r\n  router.get(\r\n    '/errors',\r\n    requireAuth,\r\n    validate(monitoringErrorsQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const validated = (req as any).validatedQuery ?? {};\r\n        const limit = validated.limit ?? 50;\r\n        const { getRecentErrors, getErrorStats } = await import('../services/errorTrackingService');\r\n        const errors = getRecentErrors(limit);\r\n        const stats = getErrorStats();\r\n\r\n        res.json({ errors, stats });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'monitoring', error }, 'Failed to fetch errors');\r\n        res.status(500).json({ error: 'Failed to fetch errors' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /system - Full system health aggregation\r\n   */\r\n  router.get(\r\n    '/system',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { getSystemHealth } = await import('../services/systemHealthService');\r\n        const { getPerformanceMetrics } = await import('../middleware/performanceMetrics');\r\n        const { getErrorStats } = await import('../services/errorTrackingService');\r\n\r\n        const health = await getSystemHealth();\r\n        const perfMetrics = getPerformanceMetrics();\r\n        const errorStats = getErrorStats();\r\n\r\n        // Aggregate performance metrics\r\n        const totalRequests = perfMetrics.reduce((sum: number, m: any) => sum + m.requests, 0);\r\n        const totalErrors = perfMetrics.reduce((sum: number, m: any) => sum + m.errors, 0);\r\n        const avgResponseTime =\r\n          perfMetrics.length > 0\r\n            ? perfMetrics.reduce((sum: number, m: any) => sum + m.avgLatency, 0) / perfMetrics.length\r\n            : 0;\r\n\r\n        // Top 5 endpoints by request count\r\n        const topEndpoints = perfMetrics\r\n          .sort((a: any, b: any) => b.requests - a.requests)\r\n          .slice(0, 5)\r\n          .map((m: any) => ({\r\n            endpoint: m.endpoint,\r\n            method: m.method,\r\n            requests: m.requests,\r\n            avgLatency: Math.round(m.avgLatency),\r\n          }));\r\n\r\n        res.json({\r\n          status: health.overall,\r\n          timestamp: health.timestamp,\r\n          services: health.services,\r\n          performance: {\r\n            totalRequests,\r\n            totalErrors,\r\n            avgResponseTime: Math.round(avgResponseTime),\r\n            topEndpoints,\r\n          },\r\n          errors: {\r\n            total: errorStats.total,\r\n            recent: errorStats.last5min,\r\n          },\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'monitoring', error }, 'Failed to fetch system health');\r\n        res.status(500).json({ error: 'Failed to fetch system health' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /endpoints - API endpoints summary\r\n   */\r\n  router.get(\r\n    '/endpoints',\r\n    requireAuth,\r\n    asyncHandler(async (_req: Request, res: Response) => {\r\n      try {\r\n        const { getPerformanceMetrics } = await import('../middleware/performanceMetrics');\r\n        const metrics = getPerformanceMetrics();\r\n\r\n        // Aggregate by endpoint pattern (group similar paths)\r\n        const summary = metrics.map((m: any) => ({\r\n          endpoint: m.endpoint,\r\n          method: m.method,\r\n          requests: m.requests,\r\n          errorRate: m.errorRate.toFixed(2) + '%',\r\n          avgLatency: Math.round(m.avgLatency) + 'ms',\r\n          status: m.errorRate > 5 ? 'unhealthy' : m.errorRate > 1 ? 'degraded' : 'healthy',\r\n        }));\r\n\r\n        res.json(summary);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'monitoring', error }, 'Failed to fetch endpoint summary');\r\n        res.status(500).json({ error: 'Failed to fetch endpoint summary' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const monitoringRouterModule: RouterModule = {\r\n  prefix: '/api/monitoring',\r\n  factory: monitoringRouter,\r\n  description: 'System monitoring and health aggregation',\r\n  endpointCount: 5,\r\n  requiresAuth: true,\r\n  tags: ['infrastructure', 'monitoring'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\n8n.router.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\patterns.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2316,2319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2316,2319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2562,2565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2562,2565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4584,4587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4584,4587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4966,4969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4966,4969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5776,5779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5776,5779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6119,6122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6119,6122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7216,7219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7216,7219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7586,7589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7586,7589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7887,7890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7887,7890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":245,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8262,8265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8262,8265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":261,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8710,8713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8710,8713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9062,9065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9062,9065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9894,9897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9894,9897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10247,10250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10247,10250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10787,10790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10787,10790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11164,11167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11164,11167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12882,12885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12882,12885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13249,13252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13249,13252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14242,14245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14242,14245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":445,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":445,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14561,14564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14561,14564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Patterns Router\r\n * Learned ad patterns management endpoints (Learn from Winners feature)\r\n *\r\n * Endpoints:\r\n * - POST /api/learned-patterns/upload - Upload pattern for analysis\r\n * - GET /api/learned-patterns/upload/:uploadId - Check upload status\r\n * - GET /api/learned-patterns - List patterns with filters\r\n * - GET /api/learned-patterns/category/:category - List by category\r\n * - GET /api/learned-patterns/:patternId - Get single pattern\r\n * - PUT /api/learned-patterns/:patternId - Update pattern\r\n * - DELETE /api/learned-patterns/:patternId - Delete pattern\r\n * - POST /api/learned-patterns/:patternId/apply - Apply pattern to generation\r\n * - POST /api/learned-patterns/:patternId/rate - Rate pattern effectiveness\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const patternsRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger, cloudinary } = ctx.services;\r\n  const { patternExtraction } = ctx.domainServices;\r\n  const { requireAuth, uploadPatternLimiter, checkPatternQuota, validateFileType } = ctx.middleware;\r\n  const { single: uploadSingle } = ctx.uploads;\r\n  const { uploadPattern, updatePattern, applyPattern, ratePattern, listPatternsQuery } = ctx.schemas;\r\n\r\n  /**\r\n   * POST /upload - Upload pattern for analysis\r\n   * Rate limited and quota checked\r\n   */\r\n  router.post('/upload',\r\n    requireAuth,\r\n    uploadPatternLimiter,\r\n    checkPatternQuota,\r\n    uploadSingle('image'),\r\n    validateFileType,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const user = (req as any).user;\r\n        const file = req.file;\r\n\r\n        if (!file) {\r\n          return res.status(400).json({ error: 'No image file provided' });\r\n        }\r\n\r\n        // Validate metadata\r\n        const parseResult = uploadPattern.safeParse(req.body);\r\n        if (!parseResult.success) {\r\n          return res.status(400).json({\r\n            error: 'Invalid metadata',\r\n            details: parseResult.error.flatten()\r\n          });\r\n        }\r\n\r\n        const metadata = parseResult.data;\r\n        const validatedFileType = (req as any).validatedFileType;\r\n\r\n        if (!cloudinary) {\r\n          return res.status(503).json({ error: 'Image storage not configured' });\r\n        }\r\n\r\n        // Upload to Cloudinary for processing\r\n        const uploadResult = await new Promise<any>((resolve, reject) => {\r\n          const uploadStream = cloudinary.uploader.upload_stream(\r\n            {\r\n              folder: 'ad-patterns',\r\n              resource_type: 'image',\r\n              tags: ['pattern-extraction', `user-${user.id}`],\r\n            },\r\n            (error, result) => {\r\n              if (error) reject(error);\r\n              else resolve(result);\r\n            }\r\n          );\r\n          uploadStream.end(file.buffer);\r\n        });\r\n\r\n        // Create upload record with 24-hour expiry\r\n        const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\r\n        const uploadRecord = await storage.createUploadRecord({\r\n          userId: user.id,\r\n          cloudinaryUrl: uploadResult.secure_url,\r\n          cloudinaryPublicId: uploadResult.public_id,\r\n          originalFilename: file.originalname,\r\n          fileSizeBytes: file.size,\r\n          mimeType: validatedFileType.mime,\r\n          status: 'pending' as const,\r\n          expiresAt,\r\n          privacyScanResult: null,\r\n          errorMessage: null,\r\n          extractedPatternId: null,\r\n          processingStartedAt: null,\r\n          processingCompletedAt: null,\r\n          processingDurationMs: null,\r\n        });\r\n\r\n        // Process extraction asynchronously\r\n        patternExtraction.processUploadForPatterns(\r\n          uploadRecord.id,\r\n          file.buffer,\r\n          validatedFileType.mime,\r\n          {\r\n            name: metadata.name,\r\n            category: metadata.category,\r\n            platform: metadata.platform,\r\n            industry: metadata.industry,\r\n            engagementTier: metadata.engagementTier,\r\n          }\r\n        ).catch(err => {\r\n          logger.error({ err, uploadId: uploadRecord.id }, 'Background pattern extraction failed');\r\n        });\r\n\r\n        res.status(202).json({\r\n          message: 'Upload accepted for processing',\r\n          uploadId: uploadRecord.id,\r\n          status: 'pending',\r\n          expiresAt: expiresAt.toISOString(),\r\n        });\r\n\r\n      } catch (error: any) {\r\n        logger.error({ err: error }, 'Pattern upload failed');\r\n        res.status(500).json({ error: 'Failed to upload pattern' });\r\n      }\r\n    })\r\n  );\r\n\r\n  /**\r\n   * GET /upload/:uploadId - Check upload/extraction status\r\n   */\r\n  router.get('/upload/:uploadId', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { uploadId } = req.params;\r\n\r\n      const upload = await storage.getUploadById(uploadId);\r\n\r\n      if (!upload) {\r\n        return res.status(404).json({ error: 'Upload not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (upload.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to access this upload' });\r\n      }\r\n\r\n      res.json({\r\n        id: upload.id,\r\n        status: upload.status,\r\n        errorMessage: upload.errorMessage,\r\n        extractedPatternId: upload.extractedPatternId,\r\n        processingStartedAt: upload.processingStartedAt,\r\n        processingCompletedAt: upload.processingCompletedAt,\r\n        processingDurationMs: upload.processingDurationMs,\r\n        expiresAt: upload.expiresAt,\r\n      });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to get upload status');\r\n      res.status(500).json({ error: 'Failed to get upload status' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET / - List patterns with filters\r\n   */\r\n  router.get('/', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n\r\n      // Parse query parameters\r\n      const parseResult = listPatternsQuery.safeParse(req.query);\r\n      if (!parseResult.success) {\r\n        return res.status(400).json({\r\n          error: 'Invalid query parameters',\r\n          details: parseResult.error.flatten()\r\n        });\r\n      }\r\n\r\n      const filters = parseResult.data;\r\n\r\n      // Get all patterns with filters\r\n      let patterns = await storage.getLearnedPatterns(user.id, {\r\n        category: filters.category,\r\n        platform: filters.platform,\r\n        industry: filters.industry,\r\n        isActive: filters.isActive,\r\n      });\r\n\r\n      // Apply limit and offset if specified\r\n      if (filters.offset) {\r\n        patterns = patterns.slice(filters.offset);\r\n      }\r\n      if (filters.limit) {\r\n        patterns = patterns.slice(0, filters.limit);\r\n      }\r\n\r\n      res.json({\r\n        patterns,\r\n        count: patterns.length,\r\n        filters: {\r\n          category: filters.category,\r\n          platform: filters.platform,\r\n          industry: filters.industry,\r\n        },\r\n      });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to list patterns');\r\n      res.status(500).json({ error: 'Failed to list patterns' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /category/:category - List patterns by category\r\n   */\r\n  router.get('/category/:category', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { category } = req.params;\r\n\r\n      const patterns = await storage.getLearnedPatterns(user.id, {\r\n        category,\r\n        isActive: true,\r\n      });\r\n\r\n      res.json({\r\n        patterns,\r\n        count: patterns.length,\r\n        category,\r\n      });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to list patterns by category');\r\n      res.status(500).json({ error: 'Failed to list patterns by category' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /:patternId - Get a specific pattern\r\n   */\r\n  router.get('/:patternId', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { patternId } = req.params;\r\n\r\n      const pattern = await storage.getLearnedPatternById(patternId);\r\n\r\n      if (!pattern) {\r\n        return res.status(404).json({ error: 'Pattern not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (pattern.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to access this pattern' });\r\n      }\r\n\r\n      res.json(pattern);\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to get pattern');\r\n      res.status(500).json({ error: 'Failed to get pattern' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * PUT /:patternId - Update a pattern's metadata\r\n   */\r\n  router.put('/:patternId', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { patternId } = req.params;\r\n\r\n      // Validate update data\r\n      const parseResult = updatePattern.safeParse(req.body);\r\n      if (!parseResult.success) {\r\n        return res.status(400).json({\r\n          error: 'Invalid update data',\r\n          details: parseResult.error.flatten()\r\n        });\r\n      }\r\n\r\n      const pattern = await storage.getLearnedPatternById(patternId);\r\n\r\n      if (!pattern) {\r\n        return res.status(404).json({ error: 'Pattern not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (pattern.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to update this pattern' });\r\n      }\r\n\r\n      const updatedPattern = await storage.updateLearnedPattern(patternId, parseResult.data);\r\n\r\n      res.json(updatedPattern);\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to update pattern');\r\n      res.status(500).json({ error: 'Failed to update pattern' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * DELETE /:patternId - Delete a pattern\r\n   */\r\n  router.delete('/:patternId', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { patternId } = req.params;\r\n\r\n      const pattern = await storage.getLearnedPatternById(patternId);\r\n\r\n      if (!pattern) {\r\n        return res.status(404).json({ error: 'Pattern not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (pattern.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to delete this pattern' });\r\n      }\r\n\r\n      await storage.deleteLearnedPattern(patternId);\r\n\r\n      res.json({ message: 'Pattern deleted successfully' });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to delete pattern');\r\n      res.status(500).json({ error: 'Failed to delete pattern' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /:patternId/apply - Apply a pattern to ad generation\r\n   */\r\n  router.post('/:patternId/apply', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { patternId } = req.params;\r\n\r\n      // Validate apply request\r\n      const parseResult = applyPattern.safeParse(req.body);\r\n      if (!parseResult.success) {\r\n        return res.status(400).json({\r\n          error: 'Invalid apply request',\r\n          details: parseResult.error.flatten()\r\n        });\r\n      }\r\n\r\n      const pattern = await storage.getLearnedPatternById(patternId);\r\n\r\n      if (!pattern) {\r\n        return res.status(404).json({ error: 'Pattern not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (pattern.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to use this pattern' });\r\n      }\r\n\r\n      const { productIds, targetPlatform } = parseResult.data;\r\n\r\n      // Increment usage count\r\n      await storage.incrementPatternUsage(patternId);\r\n\r\n      // Format pattern for prompt\r\n      const patternPrompt = patternExtraction.formatPatternsForPrompt([pattern]);\r\n\r\n      // Create application history record\r\n      const history = await storage.createApplicationHistory({\r\n        userId: user.id,\r\n        patternId,\r\n        productId: productIds[0], // Primary product\r\n        targetPlatform,\r\n        promptUsed: patternPrompt,\r\n      });\r\n\r\n      res.json({\r\n        message: 'Pattern ready to apply',\r\n        patternPrompt,\r\n        historyId: history.id,\r\n        pattern: {\r\n          id: pattern.id,\r\n          name: pattern.name,\r\n          category: pattern.category,\r\n          layoutPattern: pattern.layoutPattern,\r\n          colorPsychology: pattern.colorPsychology,\r\n          hookPatterns: pattern.hookPatterns,\r\n          visualElements: pattern.visualElements,\r\n        },\r\n      });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to apply pattern');\r\n      res.status(500).json({ error: 'Failed to apply pattern' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /:patternId/rate - Rate pattern effectiveness\r\n   */\r\n  router.post('/:patternId/rate', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const user = (req as any).user;\r\n      const { patternId } = req.params;\r\n\r\n      // Validate rating request\r\n      const parseResult = ratePattern.safeParse(req.body);\r\n      if (!parseResult.success) {\r\n        return res.status(400).json({\r\n          error: 'Invalid rating',\r\n          details: parseResult.error.flatten()\r\n        });\r\n      }\r\n\r\n      const pattern = await storage.getLearnedPatternById(patternId);\r\n\r\n      if (!pattern) {\r\n        return res.status(404).json({ error: 'Pattern not found' });\r\n      }\r\n\r\n      // Ownership check\r\n      if (pattern.userId !== user.id) {\r\n        return res.status(403).json({ error: 'Not authorized to rate this pattern' });\r\n      }\r\n\r\n      const { rating, wasUsed, feedback } = parseResult.data;\r\n\r\n      // Get the most recent application history for this pattern\r\n      const history = await storage.getPatternApplicationHistory(patternId);\r\n      // Filter to this user's history and get the most recent\r\n      const userHistory = history.filter((h: any) => h.userId === user.id);\r\n      if (userHistory.length > 0) {\r\n        await storage.updateApplicationFeedback(userHistory[0].id, rating, wasUsed, feedback);\r\n      }\r\n\r\n      res.json({\r\n        message: 'Rating recorded',\r\n        patternId,\r\n        rating,\r\n        wasUsed,\r\n      });\r\n\r\n    } catch (error: any) {\r\n      logger.error({ err: error }, 'Failed to rate pattern');\r\n      res.status(500).json({ error: 'Failed to rate pattern' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const patternsRouterModule: RouterModule = {\r\n  prefix: '/api/learned-patterns',\r\n  factory: patternsRouter,\r\n  description: 'Learned ad patterns management (Learn from Winners)',\r\n  endpointCount: 9,\r\n  requiresAuth: true,\r\n  tags: ['patterns', 'learning', 'ai']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\planning.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validate' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"validate"},"fix":{"range":[953,1005],"text":""},"desc":"Remove unused import declaration."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1739,1742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1739,1742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2155,2158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2155,2158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2610,2613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2610,2613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3031,3034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3031,3034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3512,3515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3512,3515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3575,3578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3575,3578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3987,3990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3987,3990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4266,4269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4266,4269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4623,4626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4623,4626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5514,5517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5514,5517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5914,5917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5914,5917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":158,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6164,6167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6164,6167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6729,6732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6729,6732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7176,7179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7176,7179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7224,7227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7224,7227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7554,7557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7554,7557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7956,7959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7956,7959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8486,8489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8486,8489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":280,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10149,10152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10149,10152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11235,11238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11235,11238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\products.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relationshipRAG' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":60,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3736,3739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3736,3739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4551,4554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4551,4554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5002,5005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5002,5005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5526,5529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5526,5529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6136,6139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6136,6139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8489,8492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8489,8492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9575,9578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9575,9578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10182,10185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10182,10185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11407,11410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11407,11410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12625,12628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12625,12628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13120,13123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13120,13123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":386,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13823,13826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13823,13826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14542,14545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14542,14545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":426,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15042,15045],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15042,15045],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":440,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":440,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15523,15526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15523,15526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":484,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17000,17003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17000,17003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":518,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":518,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18195,18198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18195,18198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":534,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18712,18715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18712,18715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":548,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":548,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19349,19352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19349,19352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19935,19938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19935,19938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":585,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":585,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20590,20593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20590,20593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":600,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":600,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21081,21084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21081,21084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":612,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":612,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21595,21598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21595,21598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\relationships.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1263,1266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1263,1266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1732,1735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1732,1735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2369,2372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2369,2372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3058,3061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3058,3061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":86,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4128,4131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4128,4131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4563,4566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4563,4566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5023,5026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5023,5026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5455,5458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5455,5458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5988,5991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5988,5991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Relationships Router\r\n * Product relationships CRUD and AI-powered relationship discovery\r\n *\r\n * Endpoints:\r\n * - POST /api/product-relationships - Create relationship\r\n * - DELETE /api/product-relationships/:id - Delete relationship\r\n * - POST /api/product-relationships/bulk - Bulk get relationships\r\n * - POST /api/relationships/analyze - Analyze relationship between products\r\n * - POST /api/relationships/batch-suggest - Batch suggest relationships\r\n * - POST /api/relationships/auto-create - Auto-create relationships\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const productRelationshipsRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth, validate } = ctx.middleware;\r\n  const { insertProductRelationship } = ctx.schemas;\r\n\r\n  /**\r\n   * POST / - Create product relationship\r\n   */\r\n  router.post('/', requireAuth, validate(insertProductRelationship), asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const { sourceProductId, targetProductId } = req.body;\r\n\r\n      // Prevent self-relationships\r\n      if (sourceProductId === targetProductId) {\r\n        return res.status(400).json({ error: 'Cannot create a relationship between a product and itself' });\r\n      }\r\n\r\n      const relationship = await storage.createProductRelationship({\r\n        ...req.body,\r\n        userId,\r\n      });\r\n      res.status(201).json(relationship);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'ProductRelationships', err: error }, 'Create error');\r\n      if (error.code === '23505') { // Unique constraint violation\r\n        return res.status(409).json({ error: 'This relationship already exists' });\r\n      }\r\n      res.status(500).json({ error: 'Failed to create product relationship' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * DELETE /:id - Delete product relationship\r\n   */\r\n  router.delete('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      await storage.deleteProductRelationship(req.params.id);\r\n      res.json({ success: true });\r\n    } catch (error: any) {\r\n      logger.error({ module: 'ProductRelationships', err: error }, 'Delete error');\r\n      res.status(500).json({ error: 'Failed to delete product relationship' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /bulk - Bulk get relationships for multiple products\r\n   */\r\n  router.post('/bulk', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const { productIds } = req.body;\r\n      if (!productIds || !Array.isArray(productIds)) {\r\n        return res.status(400).json({ error: 'productIds array is required' });\r\n      }\r\n      const relationships = await storage.getProductRelationships(productIds);\r\n      res.json(relationships);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'ProductRelationships', err: error }, 'Bulk get error');\r\n      res.status(500).json({ error: 'Failed to get product relationships' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const relationshipsRAGRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * POST /analyze - Analyze relationship between two products\r\n   */\r\n  router.post('/analyze', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const { sourceProductId, targetProductId } = req.body;\r\n\r\n      if (!sourceProductId || !targetProductId) {\r\n        return res.status(400).json({ error: 'sourceProductId and targetProductId are required' });\r\n      }\r\n\r\n      const { analyzeRelationshipType } = await import('../services/relationshipDiscoveryRAG');\r\n      const analysis = await analyzeRelationshipType(sourceProductId, targetProductId);\r\n      res.json(analysis);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'RelationshipRAG', err: error }, 'Error analyzing relationship');\r\n      res.status(500).json({ error: 'Failed to analyze relationship' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /batch-suggest - Batch suggest relationships for multiple products\r\n   */\r\n  router.post('/batch-suggest', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const { productIds } = req.body;\r\n\r\n      if (!productIds || !Array.isArray(productIds) || productIds.length === 0) {\r\n        return res.status(400).json({ error: 'productIds array is required' });\r\n      }\r\n\r\n      const { batchSuggestRelationships } = await import('../services/relationshipDiscoveryRAG');\r\n      const suggestions = await batchSuggestRelationships(productIds, userId);\r\n      res.json(suggestions);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'RelationshipRAG', err: error }, 'Error batch suggesting');\r\n      res.status(500).json({ error: 'Failed to batch suggest relationships' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /auto-create - Auto-create relationships based on AI suggestions\r\n   */\r\n  router.post('/auto-create', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const { productId, minScore, maxToCreate, dryRun } = req.body;\r\n\r\n      if (!productId) {\r\n        return res.status(400).json({ error: 'productId is required' });\r\n      }\r\n\r\n      const { autoCreateRelationships } = await import('../services/relationshipDiscoveryRAG');\r\n      const result = await autoCreateRelationships(productId, userId, {\r\n        minScore: minScore ?? 70,\r\n        maxToCreate: maxToCreate ?? 5,\r\n        dryRun: dryRun ?? false,\r\n      });\r\n\r\n      res.json(result);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'RelationshipRAG', err: error }, 'Error auto-creating relationships');\r\n      res.status(500).json({ error: 'Failed to auto-create relationships' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const productRelationshipsRouterModule: RouterModule = {\r\n  prefix: '/api/product-relationships',\r\n  factory: productRelationshipsRouter,\r\n  description: 'Product relationships CRUD operations',\r\n  endpointCount: 3,\r\n  requiresAuth: true,\r\n  tags: ['products', 'relationships']\r\n};\r\n\r\nexport const relationshipsRAGRouterModule: RouterModule = {\r\n  prefix: '/api/relationships',\r\n  factory: relationshipsRAGRouter,\r\n  description: 'AI-powered relationship discovery and analysis',\r\n  endpointCount: 3,\r\n  requiresAuth: true,\r\n  tags: ['ai', 'relationships', 'rag']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\scenarios.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1261,1264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1261,1264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1451,1454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1451,1454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1846,1849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1846,1849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1987,1990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1987,1990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2539,2542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2539,2542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3280,3283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3280,3283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3943,3946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3943,3946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4350,4353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4350,4353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4842,4845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4842,4845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5261,5264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5261,5264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5735,5738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5735,5738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Scenarios Router\r\n * Installation scenarios management endpoints\r\n *\r\n * Endpoints:\r\n * - POST /api/installation-scenarios - Create scenario\r\n * - GET /api/installation-scenarios - List scenarios\r\n * - GET /api/installation-scenarios/room-type/:roomType - Get by room type\r\n * - POST /api/installation-scenarios/for-products - Get for products\r\n * - GET /api/installation-scenarios/:id - Get single scenario\r\n * - PUT /api/installation-scenarios/:id - Update scenario\r\n * - DELETE /api/installation-scenarios/:id - Delete scenario\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const scenariosRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth, validate } = ctx.middleware;\r\n  const { insertInstallationScenario } = ctx.schemas;\r\n\r\n  /**\r\n   * POST / - Create installation scenario\r\n   */\r\n  router.post('/', requireAuth, validate(insertInstallationScenario), asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const scenario = await storage.createInstallationScenario({\r\n        ...req.body,\r\n        userId,\r\n      });\r\n      res.status(201).json(scenario);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Create error');\r\n      res.status(500).json({ error: 'Failed to create installation scenario' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET / - Get all installation scenarios for user\r\n   */\r\n  router.get('/', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const scenarios = await storage.getInstallationScenariosByUser(userId);\r\n      res.json(scenarios);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'List error');\r\n      res.status(500).json({ error: 'Failed to get installation scenarios' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /room-type/:roomType - Get scenarios by room type\r\n   * Note: Must be before :id catch-all\r\n   */\r\n  router.get('/room-type/:roomType', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const scenarios = await storage.getScenariosByRoomType(req.params.roomType);\r\n      res.json(scenarios);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Room type query error');\r\n      res.status(500).json({ error: 'Failed to get scenarios by room type' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /for-products - Get scenarios for products\r\n   * Note: Must be before :id catch-all\r\n   */\r\n  router.post('/for-products', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const { productIds } = req.body;\r\n      if (!productIds || !Array.isArray(productIds)) {\r\n        return res.status(400).json({ error: 'productIds array is required' });\r\n      }\r\n      const scenarios = await storage.getInstallationScenariosForProducts(productIds);\r\n      res.json(scenarios);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Products query error');\r\n      res.status(500).json({ error: 'Failed to get scenarios for products' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * GET /:id - Get single installation scenario\r\n   * Note: catch-all - must be after specific routes\r\n   */\r\n  router.get('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const scenario = await storage.getInstallationScenarioById(req.params.id);\r\n      if (!scenario) {\r\n        return res.status(404).json({ error: 'Installation scenario not found' });\r\n      }\r\n      res.json(scenario);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Get error');\r\n      res.status(500).json({ error: 'Failed to get installation scenario' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * PUT /:id - Update installation scenario (with ownership check)\r\n   */\r\n  router.put('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const existing = await storage.getInstallationScenarioById(req.params.id);\r\n      if (!existing) {\r\n        return res.status(404).json({ error: 'Installation scenario not found' });\r\n      }\r\n      if (existing.userId !== userId) {\r\n        return res.status(403).json({ error: 'Not authorized to update this scenario' });\r\n      }\r\n      const scenario = await storage.updateInstallationScenario(req.params.id, req.body);\r\n      res.json(scenario);\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Update error');\r\n      res.status(500).json({ error: 'Failed to update installation scenario' });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * DELETE /:id - Delete installation scenario (with ownership check)\r\n   */\r\n  router.delete('/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const userId = (req.session as any).userId;\r\n      const existing = await storage.getInstallationScenarioById(req.params.id);\r\n      if (!existing) {\r\n        return res.status(404).json({ error: 'Installation scenario not found' });\r\n      }\r\n      if (existing.userId !== userId) {\r\n        return res.status(403).json({ error: 'Not authorized to delete this scenario' });\r\n      }\r\n      await storage.deleteInstallationScenario(req.params.id);\r\n      res.json({ success: true });\r\n    } catch (error: any) {\r\n      logger.error({ module: 'InstallationScenarios', err: error }, 'Delete error');\r\n      res.status(500).json({ error: 'Failed to delete installation scenario' });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const scenariosRouterModule: RouterModule = {\r\n  prefix: '/api/installation-scenarios',\r\n  factory: scenariosRouter,\r\n  description: 'Installation scenarios management',\r\n  endpointCount: 7,\r\n  requiresAuth: true,\r\n  tags: ['scenarios', 'installation', 'products']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\social.router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1109,1112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1109,1112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'n8nCredentialId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":114,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Social Router\r\n * Social media account management endpoints\r\n *\r\n * Endpoints:\r\n * - GET /api/social/accounts - List connected social accounts\r\n * - DELETE /api/social/accounts/:id - Disconnect social account\r\n * - POST /api/social/sync-accounts - Sync account from n8n\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\n\r\nexport const socialRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth, validate } = ctx.middleware;\r\n  const { syncAccount } = ctx.schemas;\r\n\r\n  /**\r\n   * GET /accounts - List connected social accounts\r\n   */\r\n  router.get('/accounts', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const connections = await storage.getSocialConnections(req.user!.id);\r\n\r\n      // Sanitize: Remove sensitive OAuth token data\r\n      const safeConnections = connections.map((conn: any) => ({\r\n        id: conn.id,\r\n        userId: conn.userId,\r\n        platform: conn.platform,\r\n        platformUserId: conn.platformUserId,\r\n        platformUsername: conn.platformUsername,\r\n        profilePictureUrl: conn.profilePictureUrl,\r\n        accountType: conn.accountType,\r\n        scopes: conn.scopes,\r\n        isActive: conn.isActive,\r\n        tokenExpiresAt: conn.tokenExpiresAt,\r\n        lastUsedAt: conn.lastUsedAt,\r\n        lastErrorAt: conn.lastErrorAt,\r\n        lastErrorMessage: conn.lastErrorMessage,\r\n        connectedAt: conn.connectedAt,\r\n        updatedAt: conn.updatedAt,\r\n      }));\r\n\r\n      res.json({ accounts: safeConnections });\r\n    } catch (error) {\r\n      logger.error({ module: 'SocialAccounts', err: error }, 'Failed to fetch accounts');\r\n      res.status(500).json({\r\n        success: false,\r\n        error: 'Failed to fetch social accounts'\r\n      });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * DELETE /accounts/:id - Disconnect a social account\r\n   */\r\n  router.delete('/accounts/:id', requireAuth, asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const { id } = req.params;\r\n\r\n      // Verify ownership\r\n      const connection = await storage.getSocialConnectionById(id);\r\n\r\n      if (!connection) {\r\n        return res.status(404).json({\r\n          success: false,\r\n          error: 'Account not found'\r\n        });\r\n      }\r\n\r\n      if (connection.userId !== req.user!.id) {\r\n        return res.status(403).json({\r\n          success: false,\r\n          error: 'Unauthorized: You do not own this account'\r\n        });\r\n      }\r\n\r\n      await storage.deleteSocialConnection(id);\r\n\r\n      logger.info({\r\n        userId: req.user!.id,\r\n        platform: connection.platform\r\n      }, 'Social account disconnected');\r\n\r\n      res.json({\r\n        success: true,\r\n        message: `${connection.platform} account disconnected`\r\n      });\r\n    } catch (error) {\r\n      logger.error({\r\n        module: 'SocialAccounts',\r\n        err: error,\r\n        connectionId: req.params.id\r\n      }, 'Failed to disconnect account');\r\n\r\n      res.status(500).json({\r\n        success: false,\r\n        error: 'Failed to disconnect account'\r\n      });\r\n    }\r\n  }));\r\n\r\n  /**\r\n   * POST /sync-accounts - Sync account from n8n to local database\r\n   * Called after user configures OAuth in n8n\r\n   */\r\n  router.post('/sync-accounts', requireAuth, validate(syncAccount), asyncHandler(async (req: Request, res: Response) => {\r\n    try {\r\n      const {\r\n        platform,\r\n        n8nCredentialId,\r\n        platformUserId,\r\n        platformUsername,\r\n        accountType\r\n      } = req.body;\r\n\r\n      // Check if connection already exists\r\n      const existing = await storage.getSocialConnectionByPlatform(req.user!.id, platform);\r\n\r\n      if (existing) {\r\n        // Update existing connection\r\n        const updated = await storage.updateSocialConnection(existing.id, {\r\n          platformUserId,\r\n          platformUsername,\r\n          accountType: accountType || 'personal',\r\n          isActive: true,\r\n          lastErrorAt: null,\r\n          lastErrorMessage: null,\r\n        });\r\n\r\n        return res.json({\r\n          success: true,\r\n          data: updated,\r\n          message: `${platform} account synced (updated)`,\r\n        });\r\n      }\r\n\r\n      // Create new connection\r\n      const connection = await storage.createSocialConnection({\r\n        userId: req.user!.id,\r\n        platform,\r\n        platformUserId,\r\n        platformUsername,\r\n        accountType: accountType || 'personal',\r\n        isActive: true,\r\n        // OAuth fields (managed by n8n, placeholder values)\r\n        accessToken: 'managed_by_n8n',\r\n        tokenIv: 'n8n',\r\n        tokenAuthTag: 'n8n',\r\n        tokenExpiresAt: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days\r\n      });\r\n\r\n      res.json({\r\n        success: true,\r\n        data: connection,\r\n        message: `${platform} account synced (new)`,\r\n      });\r\n    } catch (error) {\r\n      logger.error({\r\n        module: 'SocialAccounts',\r\n        err: error,\r\n        platform: req.body.platform\r\n      }, 'Failed to sync account from n8n');\r\n\r\n      res.status(500).json({\r\n        success: false,\r\n        error: 'Failed to sync account from n8n'\r\n      });\r\n    }\r\n  }));\r\n\r\n  return router;\r\n};\r\n\r\nexport const socialRouterModule: RouterModule = {\r\n  prefix: '/api/social',\r\n  factory: socialRouter,\r\n  description: 'Social media account management',\r\n  endpointCount: 3,\r\n  requiresAuth: true,\r\n  tags: ['social', 'accounts', 'n8n']\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\styleReferences.router.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'StyleElements' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":73,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"StyleElements"},"fix":{"range":[789,809],"text":""},"desc":"Remove unused variable \"StyleElements\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1112,1115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1112,1115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1776,1779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1776,1779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2524,2527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2524,2527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3748,3751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3748,3751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4168,4171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4168,4171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4906,4909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4906,4909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5215,5218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5215,5218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5463,5466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5463,5466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5992,5995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5992,5995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6266,6269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6266,6269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6913,6916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6913,6916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":198,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7194,7197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7194,7197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7593,7596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7593,7596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8338,8341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8338,8341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8779,8782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8779,8782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9564,9567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9564,9567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10091,10094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10091,10094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10241,10244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10241,10244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Style References Router\r\n * Character/style consistency reference image management\r\n *\r\n * Endpoints:\r\n * - POST /api/style-references - Upload and analyze a reference image\r\n * - GET /api/style-references - List user's style references\r\n * - GET /api/style-references/:id - Get single reference with details\r\n * - PUT /api/style-references/:id - Update reference metadata\r\n * - DELETE /api/style-references/:id - Soft-delete a reference\r\n * - POST /api/style-references/:id/reanalyze - Re-run vision analysis\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { analyzeStyleImage, generateStyleFingerprint, type StyleElements } from '../services/styleAnalysisService';\r\n\r\nconst VALID_CATEGORIES = ['character', 'style', 'scene'] as const;\r\n\r\n/**\r\n * Check if a database error is caused by a missing table (migration not yet applied).\r\n * PostgreSQL error code 42P01 = \"undefined_table\"\r\n */\r\nfunction isTableMissingError(error: any): boolean {\r\n  return (\r\n    error?.code === '42P01' || (error?.message?.includes('relation') && error?.message?.includes('does not exist'))\r\n  );\r\n}\r\n\r\nexport const styleReferencesRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n  const { single: uploadSingle } = ctx.uploads;\r\n\r\n  /**\r\n   * POST / - Upload a new style reference image\r\n   */\r\n  router.post(\r\n    '/',\r\n    uploadSingle('image'),\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const file = req.file;\r\n\r\n        if (!file) {\r\n          return res.status(400).json({ error: 'Image file is required' });\r\n        }\r\n\r\n        const name = req.body.name || 'Untitled Reference';\r\n        const category = VALID_CATEGORIES.includes(req.body.category) ? req.body.category : 'style';\r\n        const tags = req.body.tags ? JSON.parse(req.body.tags) : [];\r\n\r\n        // Upload to Cloudinary\r\n        const cloudinary = (await import('cloudinary')).v2;\r\n        cloudinary.config({\r\n          cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n          api_key: process.env.CLOUDINARY_API_KEY,\r\n          api_secret: process.env.CLOUDINARY_API_SECRET,\r\n        });\r\n\r\n        const uploadResult = await new Promise<any>((resolve, reject) => {\r\n          cloudinary.uploader\r\n            .upload_stream(\r\n              {\r\n                folder: 'style-references',\r\n                resource_type: 'image',\r\n              },\r\n              (error, result) => {\r\n                if (error) reject(error);\r\n                else resolve(result);\r\n              },\r\n            )\r\n            .end(file.buffer);\r\n        });\r\n\r\n        const fingerprint = generateStyleFingerprint(uploadResult.public_id);\r\n\r\n        // Create DB record (pre-analysis)\r\n        const ref = await storage.createStyleReference({\r\n          userId,\r\n          cloudinaryUrl: uploadResult.secure_url,\r\n          cloudinaryPublicId: uploadResult.public_id,\r\n          name,\r\n          category,\r\n          tags,\r\n          imageFingerprint: fingerprint,\r\n          isActive: true,\r\n          confidence: 0,\r\n        });\r\n\r\n        // Run vision analysis async (don't block the response)\r\n        analyzeStyleImage(uploadResult.secure_url, name)\r\n          .then(async (analysis) => {\r\n            await storage.updateStyleReference(ref.id, {\r\n              styleDescription: analysis.styleDescription,\r\n              extractedElements: analysis.extractedElements as any,\r\n              confidence: analysis.confidence,\r\n              analyzedAt: new Date(),\r\n            });\r\n            logger.info({ refId: ref.id, confidence: analysis.confidence }, 'Style reference analyzed');\r\n          })\r\n          .catch((err) => {\r\n            logger.error({ refId: ref.id, err }, 'Style reference analysis failed');\r\n          });\r\n\r\n        res.status(201).json(ref);\r\n      } catch (error: any) {\r\n        if (isTableMissingError(error)) {\r\n          logger.warn({ module: 'StyleReferences' }, 'style_references table not found. Run migrations to create it.');\r\n          return res\r\n            .status(503)\r\n            .json({ error: 'Style references feature is not yet available. Database migration required.' });\r\n        }\r\n        logger.error({ module: 'StyleReferences', err: error }, 'Upload error');\r\n        res.status(500).json({ error: 'Failed to upload style reference' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET / - List user's style references\r\n   */\r\n  router.get(\r\n    '/',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const limit = Math.min(parseInt(String(req.query.limit)) || 50, 200);\r\n        const offset = parseInt(String(req.query.offset)) || 0;\r\n        const category = req.query.category as string | undefined;\r\n\r\n        let refs;\r\n        if (category && VALID_CATEGORIES.includes(category as any)) {\r\n          refs = await storage.getStyleReferencesByCategory(userId, category);\r\n        } else {\r\n          refs = await storage.getStyleReferencesByUser(userId, limit, offset);\r\n        }\r\n\r\n        res.json(refs);\r\n      } catch (error: any) {\r\n        // Non-critical feature  return empty list on any error instead of 500\r\n        logger.warn(\r\n          { module: 'StyleReferences', err: error?.message || error },\r\n          'Failed to list style references  returning empty list',\r\n        );\r\n        return res.json([]);\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /:id - Get single reference\r\n   */\r\n  router.get(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const ref = await storage.getStyleReferenceById(req.params.id);\r\n\r\n        if (!ref || ref.userId !== userId) {\r\n          return res.status(404).json({ error: 'Style reference not found' });\r\n        }\r\n\r\n        res.json(ref);\r\n      } catch (error: any) {\r\n        if (isTableMissingError(error)) {\r\n          logger.warn({ module: 'StyleReferences' }, 'style_references table not found. Run migrations to create it.');\r\n          return res.status(404).json({ error: 'Style reference not found' });\r\n        }\r\n        logger.error({ module: 'StyleReferences', err: error }, 'Get error');\r\n        res.status(500).json({ error: 'Failed to get style reference' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PUT /:id - Update metadata\r\n   */\r\n  router.put(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const existing = await storage.getStyleReferenceById(req.params.id);\r\n\r\n        if (!existing || existing.userId !== userId) {\r\n          return res.status(404).json({ error: 'Style reference not found' });\r\n        }\r\n\r\n        const updates: Record<string, any> = {};\r\n        if (req.body.name) updates.name = req.body.name;\r\n        if (req.body.category && VALID_CATEGORIES.includes(req.body.category)) {\r\n          updates.category = req.body.category;\r\n        }\r\n        if (req.body.tags) updates.tags = req.body.tags;\r\n\r\n        const ref = await storage.updateStyleReference(req.params.id, updates);\r\n        res.json(ref);\r\n      } catch (error: any) {\r\n        if (isTableMissingError(error)) {\r\n          logger.warn({ module: 'StyleReferences' }, 'style_references table not found. Run migrations to create it.');\r\n          return res\r\n            .status(503)\r\n            .json({ error: 'Style references feature is not yet available. Database migration required.' });\r\n        }\r\n        logger.error({ module: 'StyleReferences', err: error }, 'Update error');\r\n        res.status(500).json({ error: 'Failed to update style reference' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * DELETE /:id - Soft-delete a reference\r\n   */\r\n  router.delete(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const existing = await storage.getStyleReferenceById(req.params.id);\r\n\r\n        if (!existing || existing.userId !== userId) {\r\n          return res.status(404).json({ error: 'Style reference not found' });\r\n        }\r\n\r\n        // Soft delete in DB (keeps Cloudinary asset for potential recovery)\r\n        await storage.deleteStyleReference(req.params.id);\r\n        res.json({ success: true });\r\n      } catch (error: any) {\r\n        if (isTableMissingError(error)) {\r\n          logger.warn({ module: 'StyleReferences' }, 'style_references table not found. Run migrations to create it.');\r\n          return res\r\n            .status(503)\r\n            .json({ error: 'Style references feature is not yet available. Database migration required.' });\r\n        }\r\n        logger.error({ module: 'StyleReferences', err: error }, 'Delete error');\r\n        res.status(500).json({ error: 'Failed to delete style reference' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST /:id/reanalyze - Re-run vision analysis on an existing reference\r\n   */\r\n  router.post(\r\n    '/:id/reanalyze',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const existing = await storage.getStyleReferenceById(req.params.id);\r\n\r\n        if (!existing || existing.userId !== userId) {\r\n          return res.status(404).json({ error: 'Style reference not found' });\r\n        }\r\n\r\n        const analysis = await analyzeStyleImage(existing.cloudinaryUrl, existing.name);\r\n\r\n        const updated = await storage.updateStyleReference(req.params.id, {\r\n          styleDescription: analysis.styleDescription,\r\n          extractedElements: analysis.extractedElements as any,\r\n          confidence: analysis.confidence,\r\n          analyzedAt: new Date(),\r\n        });\r\n\r\n        res.json(updated);\r\n      } catch (error: any) {\r\n        if (isTableMissingError(error)) {\r\n          logger.warn({ module: 'StyleReferences' }, 'style_references table not found. Run migrations to create it.');\r\n          return res\r\n            .status(503)\r\n            .json({ error: 'Style references feature is not yet available. Database migration required.' });\r\n        }\r\n        logger.error({ module: 'StyleReferences', err: error }, 'Reanalyze error');\r\n        res.status(500).json({ error: 'Failed to reanalyze style reference' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const styleReferencesRouterModule: RouterModule = {\r\n  prefix: '/api/style-references',\r\n  factory: styleReferencesRouter,\r\n  description: 'Character/style reference image management',\r\n  endpointCount: 6,\r\n  requiresAuth: true,\r\n  tags: ['style', 'references', 'images', 'consistency'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\templates.router.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[52,87],"text":""}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1375,1378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1375,1378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1646,1649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1646,1649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2099,2102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2099,2102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2272,2275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2272,2275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2892,2895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2892,2895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3332,3335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3332,3335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3634,3637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3634,3637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4080,4083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4080,4083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4687,4690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4687,4690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5135,5138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5135,5138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5726,5729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5726,5729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/no-unused-vars */\r\n/**\r\n * Templates Router\r\n * Ad scene template management endpoints\r\n *\r\n * Endpoints:\r\n * - GET /api/templates - List all templates\r\n * - GET /api/templates/:id - Get single template\r\n * - GET /api/templates/search - Search templates\r\n * - POST /api/templates - Create template\r\n * - PATCH /api/templates/:id - Update template\r\n * - DELETE /api/templates/:id - Delete template\r\n */\r\n\r\nimport type { Router, Request, Response } from 'express';\r\nimport type { RouterContext, RouterFactory, RouterModule } from '../types/router';\r\nimport { createRouter, asyncHandler } from './utils/createRouter';\r\nimport { validate } from '../middleware/validate';\r\nimport { requireRole } from '../middleware/requireRole';\r\nimport { templatesListQuerySchema, templatesSearchQuerySchema } from '../validation/schemas';\r\n\r\nexport const templatesRouter: RouterFactory = (ctx: RouterContext): Router => {\r\n  const router = createRouter();\r\n  const { storage, logger } = ctx.services;\r\n  const { requireAuth } = ctx.middleware;\r\n\r\n  /**\r\n   * GET / - List all templates\r\n   * Public endpoint with optional filtering\r\n   */\r\n  router.get(\r\n    '/',\r\n    validate(templatesListQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const validated = (req as any).validatedQuery ?? {};\r\n\r\n        const templates = await storage.getAdSceneTemplates({\r\n          category: validated.category,\r\n          isGlobal: validated.isGlobal,\r\n        });\r\n\r\n        res.json({ templates, total: templates.length });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplatesList', err: error }, 'Error listing templates');\r\n        res.status(500).json({ error: 'Failed to list templates' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /search - Search templates\r\n   * Public endpoint\r\n   */\r\n  router.get(\r\n    '/search',\r\n    validate(templatesSearchQuerySchema, 'query'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const { q } = (req as any).validatedQuery;\r\n\r\n        const templates = await storage.searchAdSceneTemplates(q);\r\n        res.json({ templates, total: templates.length });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplatesSearch', err: error }, 'Error searching templates');\r\n        res.status(500).json({ error: 'Failed to search templates' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * GET /:id - Get a single template\r\n   * Public endpoint\r\n   */\r\n  router.get(\r\n    '/:id',\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const template = await storage.getAdSceneTemplateById(req.params.id);\r\n\r\n        if (!template) {\r\n          return res.status(404).json({ error: 'Template not found' });\r\n        }\r\n\r\n        res.json(template);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplateGet', err: error }, 'Error getting template');\r\n        res.status(500).json({ error: 'Failed to get template' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * POST / - Create a new template\r\n   * Admin only\r\n   */\r\n  router.post(\r\n    '/',\r\n    requireAuth,\r\n    requireRole('admin'),\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n\r\n        const templateData = {\r\n          ...req.body,\r\n          createdBy: userId,\r\n          isGlobal: req.body.isGlobal ?? true,\r\n        };\r\n\r\n        const template = await storage.saveAdSceneTemplate(templateData);\r\n        res.status(201).json(template);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplateCreate', err: error }, 'Error creating template');\r\n        res.status(500).json({ error: 'Failed to create template' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * PATCH /:id - Update a template\r\n   * Only creator or admin can update\r\n   */\r\n  router.patch(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const userRole = req.user?.role;\r\n        const template = await storage.getAdSceneTemplateById(req.params.id);\r\n\r\n        if (!template) {\r\n          return res.status(404).json({ error: 'Template not found' });\r\n        }\r\n\r\n        // Only creator or admin can update\r\n        if (template.createdBy !== userId && userRole !== 'admin') {\r\n          return res.status(403).json({ error: 'Not authorized to update this template' });\r\n        }\r\n\r\n        const updated = await storage.updateAdSceneTemplate(req.params.id, req.body);\r\n        res.json(updated);\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplateUpdate', err: error }, 'Error updating template');\r\n        res.status(500).json({ error: 'Failed to update template' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  /**\r\n   * DELETE /:id - Delete a template\r\n   * Only creator or admin can delete\r\n   */\r\n  router.delete(\r\n    '/:id',\r\n    requireAuth,\r\n    asyncHandler(async (req: Request, res: Response) => {\r\n      try {\r\n        const userId = (req.session as any).userId;\r\n        const userRole = req.user?.role;\r\n        const template = await storage.getAdSceneTemplateById(req.params.id);\r\n\r\n        if (!template) {\r\n          return res.status(404).json({ error: 'Template not found' });\r\n        }\r\n\r\n        // Only creator or admin can delete\r\n        if (template.createdBy !== userId && userRole !== 'admin') {\r\n          return res.status(403).json({ error: 'Not authorized to delete this template' });\r\n        }\r\n\r\n        await storage.deleteAdSceneTemplate(req.params.id);\r\n        res.json({ success: true });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'TemplateDelete', err: error }, 'Error deleting template');\r\n        res.status(500).json({ error: 'Failed to delete template' });\r\n      }\r\n    }),\r\n  );\r\n\r\n  return router;\r\n};\r\n\r\nexport const templatesRouterModule: RouterModule = {\r\n  prefix: '/api/templates',\r\n  factory: templatesRouter,\r\n  description: 'Ad scene template management',\r\n  endpointCount: 6,\r\n  requiresAuth: false,\r\n  tags: ['templates', 'content'],\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\training.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1531,1534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1531,1534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1671,1674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1671,1674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2095,2098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2095,2098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2628,2631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2628,2631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3061,3064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3061,3064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3448,3451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3448,3451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3886,3889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3886,3889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5135,5138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5135,5138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5597,5600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5597,5600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6142,6145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6142,6145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6577,6580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6577,6580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8064,8067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8064,8067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8512,8515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8512,8515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9025,9028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9025,9028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9775,9778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9775,9778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10237,10240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10237,10240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10728,10731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10728,10731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\utils\\buildContext.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":12,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"db"},"fix":{"range":[570,573],"text":""},"desc":"Remove unused variable \"db\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3452,3455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3452,3455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Router Context Builder\r\n * Creates the dependency injection context for all routers\r\n */\r\n\r\nimport type { RouterContext, RouterServices, RouterMiddleware, RouterDomainServices, RouterUploads, RouterSchemas, RouterUtils } from '../../types/router';\r\nimport { storage } from '../../storage';\r\nimport { genAI } from '../../lib/gemini';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { logger } from '../../lib/logger';\r\nimport { telemetry } from '../../instrumentation';\r\nimport { generationQueue, generationQueueEvents } from '../../lib/queue';\r\nimport { db, pool } from '../../db';\r\nimport { requireAuth, optionalAuth } from '../../middleware/auth';\r\nimport { validate } from '../../middleware/validate';\r\nimport { extendedTimeout, haltOnTimeout } from '../../middleware/timeout';\r\nimport { validateN8nWebhook } from '../../middleware/webhookAuth';\r\nimport { createRateLimiter } from '../../middleware/rateLimit';\r\nimport { validateFileType, uploadPatternLimiter, checkPatternQuota } from '../../middleware/uploadValidation';\r\nimport multer from 'multer';\r\n\r\n// Validation schemas\r\nimport {\r\n  insertGenerationSchema,\r\n  insertProductSchema,\r\n  insertPromptTemplateSchema,\r\n  insertInstallationScenarioSchema,\r\n  insertProductRelationshipSchema\r\n} from '@shared/schema';\r\nimport {\r\n  saveApiKeySchema,\r\n  uploadPatternSchema,\r\n  updatePatternSchema,\r\n  applyPatternSchema,\r\n  ratePatternSchema,\r\n  listPatternsQuerySchema,\r\n  generateCompletePostSchema,\r\n  saveN8nConfigSchema,\r\n  n8nCallbackSchema,\r\n  syncAccountSchema\r\n} from '../../validation/schemas';\r\n\r\n// File utilities\r\nimport { saveOriginalFile, saveGeneratedImage, deleteFile } from '../../fileStorage';\r\nimport { toGenerationDTO, toGenerationDTOArray } from '../../dto/generationDTO';\r\nimport { isServerShuttingDown } from '../../utils/gracefulShutdown';\r\n\r\n// Domain services\r\nimport { visionAnalysisService } from '../../services/visionAnalysisService';\r\nimport { ideaBankService } from '../../services/ideaBankService';\r\nimport { productKnowledgeService } from '../../services/productKnowledgeService';\r\nimport { quotaMonitoringService } from '../../services/quotaMonitoringService';\r\nimport * as installationRAG from '../../services/installationScenarioRAG';\r\nimport * as relationshipRAG from '../../services/relationshipDiscoveryRAG';\r\nimport { brandImageRecommendationRAG } from '../../services/brandImageRecommendationRAG';\r\nimport * as templatePatternRAG from '../../services/templatePatternRAG';\r\nimport * as patternExtraction from '../../services/patternExtractionService';\r\nimport * as encryption from '../../services/encryptionService';\r\nimport * as apiKeyValidation from '../../services/apiKeyValidationService';\r\nimport { authService } from '../../services/authService';\r\nimport * as pricingEstimator from '../../services/pricingEstimator';\r\n\r\n/**\r\n * Check if Cloudinary is properly configured\r\n */\r\nfunction isCloudinaryConfigured(): boolean {\r\n  return !!(\r\n    process.env.CLOUDINARY_CLOUD_NAME &&\r\n    process.env.CLOUDINARY_API_KEY &&\r\n    process.env.CLOUDINARY_API_SECRET\r\n  );\r\n}\r\n\r\n/**\r\n * Create multer upload instance\r\n */\r\nfunction createUploader(): multer.Multer {\r\n  return multer({\r\n    storage: multer.memoryStorage(),\r\n    limits: {\r\n      fileSize: 10 * 1024 * 1024, // 10MB per file\r\n      files: 6 // Max 6 files\r\n    }\r\n  });\r\n}\r\n\r\n// Lazy-load Google Cloud Monitoring to prevent any import-time errors\r\nlet googleCloudMonitoringService: any = null;\r\nasync function getGoogleCloudService() {\r\n  if (!googleCloudMonitoringService) {\r\n    try {\r\n      const module = await import('../../services/googleCloudMonitoringService');\r\n      googleCloudMonitoringService = module.googleCloudMonitoringService;\r\n    } catch (error) {\r\n      logger.error({ module: 'GoogleCloudMonitoring', err: error }, 'Failed to load module');\r\n    }\r\n  }\r\n  return googleCloudMonitoringService;\r\n}\r\n\r\n/**\r\n * Build the complete router context\r\n */\r\nexport function buildRouterContext(): RouterContext {\r\n  const upload = createUploader();\r\n\r\n  // Configure Cloudinary if credentials present\r\n  let cloudinaryClient: typeof cloudinary | null = null;\r\n  if (isCloudinaryConfigured()) {\r\n    cloudinary.config({\r\n      cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n      api_key: process.env.CLOUDINARY_API_KEY,\r\n      api_secret: process.env.CLOUDINARY_API_SECRET,\r\n    });\r\n    cloudinaryClient = cloudinary;\r\n  }\r\n\r\n  const services: RouterServices = {\r\n    storage,\r\n    genAIText: genAI,\r\n    genAIImage: genAI,\r\n    cloudinary: cloudinaryClient,\r\n    logger,\r\n    telemetry,\r\n    generationQueue,\r\n    generationQueueEvents,\r\n    pool\r\n  };\r\n\r\n  const middleware: RouterMiddleware = {\r\n    requireAuth,\r\n    optionalAuth,\r\n    validate,\r\n    extendedTimeout,\r\n    haltOnTimeout,\r\n    validateN8nWebhook,\r\n    validateFileType,\r\n    uploadPatternLimiter,\r\n    checkPatternQuota,\r\n    createRateLimiter\r\n  };\r\n\r\n  const uploads: RouterUploads = {\r\n    standard: upload,\r\n    single: (fieldName: string) => upload.single(fieldName),\r\n    array: (fieldName: string, maxCount: number) => upload.array(fieldName, maxCount)\r\n  };\r\n\r\n  const schemas: RouterSchemas = {\r\n    insertGeneration: insertGenerationSchema,\r\n    insertProduct: insertProductSchema,\r\n    insertPromptTemplate: insertPromptTemplateSchema,\r\n    insertInstallationScenario: insertInstallationScenarioSchema,\r\n    insertProductRelationship: insertProductRelationshipSchema,\r\n    saveApiKey: saveApiKeySchema,\r\n    uploadPattern: uploadPatternSchema,\r\n    updatePattern: updatePatternSchema,\r\n    applyPattern: applyPatternSchema,\r\n    ratePattern: ratePatternSchema,\r\n    listPatternsQuery: listPatternsQuerySchema,\r\n    generateCompletePost: generateCompletePostSchema,\r\n    saveN8nConfig: saveN8nConfigSchema,\r\n    n8nCallback: n8nCallbackSchema,\r\n    syncAccount: syncAccountSchema\r\n  };\r\n\r\n  const utils: RouterUtils = {\r\n    saveOriginalFile,\r\n    saveGeneratedImage,\r\n    deleteFile,\r\n    toGenerationDTO,\r\n    toGenerationDTOArray,\r\n    isServerShuttingDown\r\n  };\r\n\r\n  const domainServices: RouterDomainServices = {\r\n    visionAnalysis: visionAnalysisService,\r\n    ideaBank: ideaBankService,\r\n    productKnowledge: productKnowledgeService,\r\n    quotaMonitoring: quotaMonitoringService,\r\n    installationRAG,\r\n    relationshipRAG,\r\n    brandImageRAG: brandImageRecommendationRAG,\r\n    templatePatternRAG,\r\n    patternExtraction,\r\n    encryption,\r\n    apiKeyValidation,\r\n    authService,\r\n    pricingEstimator,\r\n    getGoogleCloudService\r\n  };\r\n\r\n  return {\r\n    services,\r\n    domainServices,\r\n    middleware,\r\n    uploads,\r\n    schemas,\r\n    utils\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\utils\\createRouter.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[518,521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[518,521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Router Factory Utilities\r\n * Provides common utilities for creating routers\r\n */\r\n\r\nimport { Router, Request, Response, NextFunction } from 'express';\r\nimport { logger } from '../../lib/logger';\r\n\r\n/**\r\n * Create a new Express router with standard configuration\r\n */\r\nexport function createRouter(): Router {\r\n  return Router({ mergeParams: true });\r\n}\r\n\r\n/**\r\n * Wrap async route handlers to catch errors\r\n */\r\nexport function asyncHandler(\r\n  fn: (req: Request, res: Response, next: NextFunction) => Promise<any>\r\n) {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    Promise.resolve(fn(req, res, next)).catch(next);\r\n  };\r\n}\r\n\r\n/**\r\n * Standard error response format\r\n */\r\nexport interface ErrorResponse {\r\n  error: string;\r\n  code?: string;\r\n  details?: unknown;\r\n}\r\n\r\n/**\r\n * Handle route errors with consistent format\r\n */\r\nexport function handleRouteError(\r\n  res: Response,\r\n  error: unknown,\r\n  context: string\r\n): void {\r\n  logger.error({ err: error, context }, `Route error in ${context}`);\r\n\r\n  if (error instanceof Error) {\r\n    // Known error types\r\n    if (error.name === 'ValidationError') {\r\n      res.status(400).json({\r\n        error: error.message,\r\n        code: 'VALIDATION_ERROR'\r\n      } as ErrorResponse);\r\n      return;\r\n    }\r\n\r\n    if (error.name === 'NotFoundError') {\r\n      res.status(404).json({\r\n        error: error.message,\r\n        code: 'NOT_FOUND'\r\n      } as ErrorResponse);\r\n      return;\r\n    }\r\n\r\n    if (error.name === 'UnauthorizedError') {\r\n      res.status(401).json({\r\n        error: error.message,\r\n        code: 'UNAUTHORIZED'\r\n      } as ErrorResponse);\r\n      return;\r\n    }\r\n\r\n    if (error.name === 'ForbiddenError') {\r\n      res.status(403).json({\r\n        error: error.message,\r\n        code: 'FORBIDDEN'\r\n      } as ErrorResponse);\r\n      return;\r\n    }\r\n\r\n    // Rate limit errors\r\n    if (error.message.includes('rate limit') || error.message.includes('quota')) {\r\n      res.status(429).json({\r\n        error: error.message,\r\n        code: 'RATE_LIMITED'\r\n      } as ErrorResponse);\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Generic server error\r\n  res.status(500).json({\r\n    error: 'Internal server error',\r\n    code: 'INTERNAL_ERROR'\r\n  } as ErrorResponse);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\utils\\registerRouters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\routes\\weeklyPlanner.router.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getWeeklyPlan' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getWeeklyPlan"},"fix":{"range":[742,760],"text":""},"desc":"Remove unused variable \"getWeeklyPlan\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1442,1445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1442,1445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2080,2083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2080,2083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3116,3119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3116,3119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4506,4509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4506,4509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seedPromptTemplates.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":50,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":50,"endColumn":14,"suggestions":[{"fix":{"range":[1937,1980],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":55,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":55,"endColumn":18,"suggestions":[{"fix":{"range":[2098,2140],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":16,"suggestions":[{"fix":{"range":[2153,2237],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\auditProducts.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":7,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":7,"endColumn":14,"suggestions":[{"fix":{"range":[227,256],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":8,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":8,"endColumn":14,"suggestions":[{"fix":{"range":[260,322],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":9,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":9,"endColumn":14,"suggestions":[{"fix":{"range":[326,355],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":13,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":13,"endColumn":14,"suggestions":[{"fix":{"range":[441,510],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":35,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":35,"endColumn":14,"suggestions":[{"fix":{"range":[1238,1267],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":36,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":36,"endColumn":14,"suggestions":[{"fix":{"range":[1271,1313],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":37,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":37,"endColumn":14,"suggestions":[{"fix":{"range":[1317,1346],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":38,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":38,"endColumn":14,"suggestions":[{"fix":{"range":[1350,1366],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":39,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":39,"endColumn":14,"suggestions":[{"fix":{"range":[1370,1430],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":40,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":40,"endColumn":14,"suggestions":[{"fix":{"range":[1434,1450],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":55,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":55,"endColumn":16,"suggestions":[{"fix":{"range":[1846,1920],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":16,"suggestions":[{"fix":{"range":[1926,1955],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":16,"suggestions":[{"fix":{"range":[1961,2064],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":58,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":58,"endColumn":16,"suggestions":[{"fix":{"range":[2070,2099],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":79,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":79,"endColumn":18,"suggestions":[{"fix":{"range":[2899,3091],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":84,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":84,"endColumn":14,"suggestions":[{"fix":{"range":[3134,3170],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":85,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":85,"endColumn":14,"suggestions":[{"fix":{"range":[3174,3208],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":86,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":86,"endColumn":14,"suggestions":[{"fix":{"range":[3212,3241],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":102,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":102,"endColumn":14,"suggestions":[{"fix":{"range":[3969,5726],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":116,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":116,"endColumn":14,"suggestions":[{"fix":{"range":[5732,5761],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":117,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":117,"endColumn":14,"suggestions":[{"fix":{"range":[5765,5793],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":118,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":118,"endColumn":14,"suggestions":[{"fix":{"range":[5797,5826],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":119,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":119,"endColumn":14,"suggestions":[{"fix":{"range":[5830,6354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":128,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":128,"endColumn":14,"suggestions":[{"fix":{"range":[6385,6414],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":129,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":129,"endColumn":14,"suggestions":[{"fix":{"range":[6418,6477],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":130,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":130,"endColumn":14,"suggestions":[{"fix":{"range":[6481,6510],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":131,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":131,"endColumn":14,"suggestions":[{"fix":{"range":[6514,8034],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":158,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":158,"endColumn":16,"suggestions":[{"fix":{"range":[8251,8280],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":159,"endColumn":16,"suggestions":[{"fix":{"range":[8286,8359],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":160,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":160,"endColumn":16,"suggestions":[{"fix":{"range":[8365,8394],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":169,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":169,"endColumn":18,"suggestions":[{"fix":{"range":[8826,8914],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":172,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":172,"endColumn":18,"suggestions":[{"fix":{"range":[8963,9018],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":176,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":176,"endColumn":14,"suggestions":[{"fix":{"range":[9036,9072],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\cleanupUncategorized.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":17,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":17,"endColumn":14,"suggestions":[{"fix":{"range":[523,551],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":18,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":18,"endColumn":14,"suggestions":[{"fix":{"range":[555,623],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":19,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":19,"endColumn":14,"suggestions":[{"fix":{"range":[627,655],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":32,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":32,"endColumn":14,"suggestions":[{"fix":{"range":[896,979],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":37,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":37,"endColumn":16,"suggestions":[{"fix":{"range":[1107,1187],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":40,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":40,"endColumn":16,"suggestions":[{"fix":{"range":[1234,1293],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":44,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":44,"endColumn":16,"suggestions":[{"fix":{"range":[1343,1414],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":49,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":49,"endColumn":14,"suggestions":[{"fix":{"range":[1489,1519],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":50,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":50,"endColumn":14,"suggestions":[{"fix":{"range":[1523,1575],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":62,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":62,"endColumn":14,"suggestions":[{"fix":{"range":[1816,1881],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":66,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":66,"endColumn":14,"suggestions":[{"fix":{"range":[1974,2004],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":67,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":67,"endColumn":14,"suggestions":[{"fix":{"range":[2008,2036],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":68,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":68,"endColumn":14,"suggestions":[{"fix":{"range":[2040,2068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":69,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":69,"endColumn":14,"suggestions":[{"fix":{"range":[2072,2141],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":78,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":78,"endColumn":14,"suggestions":[{"fix":{"range":[2357,2396],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":80,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":80,"endColumn":16,"suggestions":[{"fix":{"range":[2475,2518],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":83,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":83,"endColumn":14,"suggestions":[{"fix":{"range":[2529,2564],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":84,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":84,"endColumn":14,"suggestions":[{"fix":{"range":[2568,2602],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":85,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":85,"endColumn":14,"suggestions":[{"fix":{"range":[2606,2634],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":92,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":92,"endColumn":16,"suggestions":[{"fix":{"range":[2761,2822],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\coverageDashboard.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":55,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":55,"endColumn":14,"suggestions":[{"fix":{"range":[1754,1782],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":14,"suggestions":[{"fix":{"range":[1786,1833],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":14,"suggestions":[{"fix":{"range":[1837,1898],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":58,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":58,"endColumn":14,"suggestions":[{"fix":{"range":[1902,1930],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":349,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":349,"endColumn":14,"suggestions":[{"fix":{"range":[13131,13175],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":357,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":357,"endColumn":14,"suggestions":[{"fix":{"range":[13382,13417],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":358,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":358,"endColumn":14,"suggestions":[{"fix":{"range":[13421,13452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":359,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":359,"endColumn":14,"suggestions":[{"fix":{"range":[13456,13484],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":361,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":361,"endColumn":14,"suggestions":[{"fix":{"range":[13490,17915],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":401,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":401,"endColumn":14,"suggestions":[{"fix":{"range":[17921,17949],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":402,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":402,"endColumn":14,"suggestions":[{"fix":{"range":[17953,17980],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":403,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":403,"endColumn":14,"suggestions":[{"fix":{"range":[17984,18012],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":405,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":405,"endColumn":16,"suggestions":[{"fix":{"range":[18091,18167],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":408,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":408,"endColumn":14,"suggestions":[{"fix":{"range":[18178,18213],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":409,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":409,"endColumn":14,"suggestions":[{"fix":{"range":[18217,18253],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":410,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":410,"endColumn":14,"suggestions":[{"fix":{"range":[18257,18285],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":412,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":412,"endColumn":16,"suggestions":[{"fix":{"range":[18365,18444],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":419,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":419,"endColumn":14,"suggestions":[{"fix":{"range":[18585,18620],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":420,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":420,"endColumn":14,"suggestions":[{"fix":{"range":[18624,18664],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":421,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":421,"endColumn":14,"suggestions":[{"fix":{"range":[18668,18696],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":436,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":436,"endColumn":14,"suggestions":[{"fix":{"range":[19187,20106],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":449,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":449,"endColumn":16,"suggestions":[{"fix":{"range":[20157,20201],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":451,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":451,"endColumn":18,"suggestions":[{"fix":{"range":[20268,20326],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":454,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":454,"endColumn":18,"suggestions":[{"fix":{"range":[20387,20454],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":459,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":459,"endColumn":16,"suggestions":[{"fix":{"range":[20513,20553],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":461,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":461,"endColumn":18,"suggestions":[{"fix":{"range":[20616,20676],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":464,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":464,"endColumn":18,"suggestions":[{"fix":{"range":[20733,20796],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":472,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":472,"endColumn":14,"suggestions":[{"fix":{"range":[20932,20967],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":473,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":473,"endColumn":14,"suggestions":[{"fix":{"range":[20971,21023],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":474,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":474,"endColumn":14,"suggestions":[{"fix":{"range":[21027,21055],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":479,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":479,"endColumn":14,"suggestions":[{"fix":{"range":[21227,21943],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":489,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":489,"endColumn":14,"suggestions":[{"fix":{"range":[22015,22085],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":501,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":501,"endColumn":16,"suggestions":[{"fix":{"range":[22446,22496],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":503,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":503,"endColumn":18,"suggestions":[{"fix":{"range":[22546,22594],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":507,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":507,"endColumn":14,"suggestions":[{"fix":{"range":[22612,22647],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":508,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":508,"endColumn":14,"suggestions":[{"fix":{"range":[22651,22687],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":509,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":509,"endColumn":14,"suggestions":[{"fix":{"range":[22691,22719],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":524,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":524,"endColumn":16,"suggestions":[{"fix":{"range":[23026,23084],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\createLearnFromWinnersTables.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[806,809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[806,809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5787,5790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5787,5790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":11,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":11,"endColumn":14,"suggestions":[{"fix":{"range":[322,377],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":23,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":23,"endColumn":18,"suggestions":[{"fix":{"range":[741,829],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":24,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":24,"endColumn":18,"suggestions":[{"fix":{"range":[837,891],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":29,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":29,"endColumn":16,"suggestions":[{"fix":{"range":[991,1038],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":53,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":53,"endColumn":16,"suggestions":[{"fix":{"range":[2055,2100],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":16,"suggestions":[{"fix":{"range":[2149,2196],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":77,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":77,"endColumn":16,"suggestions":[{"fix":{"range":[3105,3150],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":80,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":80,"endColumn":16,"suggestions":[{"fix":{"range":[3207,3262],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":97,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":97,"endColumn":16,"suggestions":[{"fix":{"range":[4147,4200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":100,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":100,"endColumn":16,"suggestions":[{"fix":{"range":[4231,4268],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":109,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":109,"endColumn":16,"suggestions":[{"fix":{"range":[5344,5381],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":120,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":120,"endColumn":16,"suggestions":[{"fix":{"range":[5707,5755],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":121,"column":39,"nodeType":"MemberExpression","messageId":"limited","endLine":121,"endColumn":50,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport { db } from \"../db\";\r\nimport { sql } from \"drizzle-orm\";\r\n\r\n/**\r\n * Creates the \"Learn from Winners\" tables for ad pattern extraction\r\n * Tables: learned_ad_patterns, ad_analysis_uploads, pattern_application_history\r\n */\r\nasync function createTables() {\r\n  console.log(\"Creating Learn from Winners tables...\\n\");\r\n\r\n  try {\r\n    // Check if tables already exist\r\n    const existingTables = await db.execute(sql`\r\n      SELECT table_name\r\n      FROM information_schema.tables\r\n      WHERE table_schema = 'public'\r\n      AND table_name IN ('learned_ad_patterns', 'ad_analysis_uploads', 'pattern_application_history')\r\n    `);\r\n\r\n    if (existingTables.rows.length > 0) {\r\n      console.log(\"Tables already exist:\", existingTables.rows.map((r: any) => r.table_name));\r\n      console.log(\"\\n Tables verified, no action needed.\");\r\n      return;\r\n    }\r\n\r\n    // Create learned_ad_patterns table first (referenced by others)\r\n    console.log(\"Creating learned_ad_patterns...\");\r\n    await db.execute(sql`\r\n      CREATE TABLE IF NOT EXISTS \"learned_ad_patterns\" (\r\n        \"id\" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n        \"user_id\" varchar NOT NULL REFERENCES \"users\"(\"id\") ON DELETE cascade,\r\n        \"name\" text NOT NULL,\r\n        \"category\" varchar(50) NOT NULL,\r\n        \"platform\" varchar(50) NOT NULL,\r\n        \"industry\" varchar(100),\r\n        \"layout_pattern\" jsonb,\r\n        \"color_psychology\" jsonb,\r\n        \"hook_patterns\" jsonb,\r\n        \"visual_elements\" jsonb,\r\n        \"engagement_tier\" varchar(20),\r\n        \"confidence_score\" real DEFAULT 0.8,\r\n        \"source_hash\" text NOT NULL,\r\n        \"usage_count\" integer DEFAULT 0 NOT NULL,\r\n        \"last_used_at\" timestamp,\r\n        \"is_active\" boolean DEFAULT true NOT NULL,\r\n        \"created_at\" timestamp DEFAULT now() NOT NULL,\r\n        \"updated_at\" timestamp DEFAULT now() NOT NULL,\r\n        CONSTRAINT \"learned_ad_patterns_user_id_source_hash_unique\" UNIQUE(\"user_id\",\"source_hash\")\r\n      )\r\n    `);\r\n    console.log(\" Created learned_ad_patterns\");\r\n\r\n    // Create ad_analysis_uploads table\r\n    console.log(\"Creating ad_analysis_uploads...\");\r\n    await db.execute(sql`\r\n      CREATE TABLE IF NOT EXISTS \"ad_analysis_uploads\" (\r\n        \"id\" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n        \"user_id\" varchar NOT NULL REFERENCES \"users\"(\"id\") ON DELETE cascade,\r\n        \"cloudinary_url\" text NOT NULL,\r\n        \"cloudinary_public_id\" text NOT NULL,\r\n        \"original_filename\" text,\r\n        \"file_size_bytes\" integer,\r\n        \"mime_type\" varchar(100),\r\n        \"status\" varchar(20) DEFAULT 'pending' NOT NULL,\r\n        \"error_message\" text,\r\n        \"privacy_scan_result\" jsonb,\r\n        \"extracted_pattern_id\" varchar REFERENCES \"learned_ad_patterns\"(\"id\") ON DELETE set null,\r\n        \"processing_started_at\" timestamp,\r\n        \"processing_completed_at\" timestamp,\r\n        \"processing_duration_ms\" integer,\r\n        \"expires_at\" timestamp NOT NULL,\r\n        \"created_at\" timestamp DEFAULT now() NOT NULL\r\n      )\r\n    `);\r\n    console.log(\" Created ad_analysis_uploads\");\r\n\r\n    // Create pattern_application_history table\r\n    console.log(\"Creating pattern_application_history...\");\r\n    await db.execute(sql`\r\n      CREATE TABLE IF NOT EXISTS \"pattern_application_history\" (\r\n        \"id\" varchar PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,\r\n        \"user_id\" varchar NOT NULL REFERENCES \"users\"(\"id\") ON DELETE cascade,\r\n        \"pattern_id\" varchar NOT NULL REFERENCES \"learned_ad_patterns\"(\"id\") ON DELETE cascade,\r\n        \"generated_ad_id\" varchar REFERENCES \"generations\"(\"id\") ON DELETE cascade,\r\n        \"product_id\" varchar REFERENCES \"products\"(\"id\") ON DELETE set null,\r\n        \"target_platform\" varchar(50),\r\n        \"prompt_used\" text,\r\n        \"user_rating\" integer,\r\n        \"was_used\" boolean DEFAULT false NOT NULL,\r\n        \"feedback\" text,\r\n        \"created_at\" timestamp DEFAULT now() NOT NULL,\r\n        CONSTRAINT \"pattern_application_history_pattern_id_generated_ad_id_unique\" UNIQUE(\"pattern_id\",\"generated_ad_id\")\r\n      )\r\n    `);\r\n    console.log(\" Created pattern_application_history\");\r\n\r\n    // Create indexes\r\n    console.log(\"\\nCreating indexes...\");\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_uploads_status\" ON \"ad_analysis_uploads\" USING btree (\"status\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_uploads_expires\" ON \"ad_analysis_uploads\" USING btree (\"expires_at\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_uploads_user_id\" ON \"ad_analysis_uploads\" USING btree (\"user_id\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_learned_patterns_user_id\" ON \"learned_ad_patterns\" USING btree (\"user_id\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_learned_patterns_category\" ON \"learned_ad_patterns\" USING btree (\"category\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_learned_patterns_platform\" ON \"learned_ad_patterns\" USING btree (\"platform\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_history_pattern_id\" ON \"pattern_application_history\" USING btree (\"pattern_id\")`);\r\n    await db.execute(sql`CREATE INDEX IF NOT EXISTS \"idx_history_user_id\" ON \"pattern_application_history\" USING btree (\"user_id\")`);\r\n    console.log(\" Created all indexes\");\r\n\r\n    // Verify tables were created\r\n    const tables = await db.execute(sql`\r\n      SELECT table_name\r\n      FROM information_schema.tables\r\n      WHERE table_schema = 'public'\r\n      AND table_name IN ('learned_ad_patterns', 'ad_analysis_uploads', 'pattern_application_history')\r\n      ORDER BY table_name\r\n    `);\r\n\r\n    console.log(\"\\n Successfully created tables:\");\r\n    tables.rows.forEach((row: any) => console.log(`   - ${row.table_name}`));\r\n\r\n  } catch (error) {\r\n    console.error(\"Error creating tables:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Run when called directly\r\ncreateTables()\r\n  .then(() => process.exit(0))\r\n  .catch(() => process.exit(1));\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\generateBaselineRelationships.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":110,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":110,"endColumn":14,"suggestions":[{"fix":{"range":[4047,4075],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":111,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":111,"endColumn":14,"suggestions":[{"fix":{"range":[4079,4139],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":112,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":112,"endColumn":14,"suggestions":[{"fix":{"range":[4143,4171],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":119,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":119,"endColumn":16,"suggestions":[{"fix":{"range":[4324,4348],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":120,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":120,"endColumn":16,"suggestions":[{"fix":{"range":[4354,4452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":121,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":121,"endColumn":16,"suggestions":[{"fix":{"range":[4458,4554],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":122,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":122,"endColumn":16,"suggestions":[{"fix":{"range":[4560,4600],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":123,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":123,"endColumn":16,"suggestions":[{"fix":{"range":[4606,4862],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":133,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":133,"endColumn":14,"suggestions":[{"fix":{"range":[5166,5204],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":134,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":134,"endColumn":14,"suggestions":[{"fix":{"range":[5208,5297],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":137,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":137,"endColumn":14,"suggestions":[{"fix":{"range":[5338,5393],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":146,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":146,"endColumn":16,"suggestions":[{"fix":{"range":[5753,5791],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":147,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":147,"endColumn":16,"suggestions":[{"fix":{"range":[5797,5852],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":152,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":152,"endColumn":14,"suggestions":[{"fix":{"range":[5963,6009],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":156,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":156,"endColumn":14,"suggestions":[{"fix":{"range":[6136,6205],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":163,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":163,"endColumn":14,"suggestions":[{"fix":{"range":[6412,6476],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":236,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":236,"endColumn":14,"suggestions":[{"fix":{"range":[9259,9294],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":237,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":237,"endColumn":14,"suggestions":[{"fix":{"range":[9298,9334],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":238,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":238,"endColumn":14,"suggestions":[{"fix":{"range":[9338,9366],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":240,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":240,"endColumn":14,"suggestions":[{"fix":{"range":[9372,10180],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":257,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":257,"endColumn":14,"suggestions":[{"fix":{"range":[10237,10265],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":258,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":258,"endColumn":14,"suggestions":[{"fix":{"range":[10269,10330],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":259,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":259,"endColumn":14,"suggestions":[{"fix":{"range":[10334,10362],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":270,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":270,"endColumn":16,"suggestions":[{"fix":{"range":[10714,10791],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":272,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":272,"endColumn":18,"suggestions":[{"fix":{"range":[10842,10906],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":273,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":273,"endColumn":18,"suggestions":[{"fix":{"range":[10914,10963],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":274,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":274,"endColumn":18,"suggestions":[{"fix":{"range":[10971,11022],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":277,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":277,"endColumn":18,"suggestions":[{"fix":{"range":[11065,11116],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":282,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":282,"endColumn":14,"suggestions":[{"fix":{"range":[11175,11210],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":283,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":283,"endColumn":14,"suggestions":[{"fix":{"range":[11214,11255],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":284,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":284,"endColumn":14,"suggestions":[{"fix":{"range":[11259,11287],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":290,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":290,"endColumn":16,"suggestions":[{"fix":{"range":[11541,11592],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":291,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":291,"endColumn":16,"suggestions":[{"fix":{"range":[11598,11633],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":292,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":292,"endColumn":16,"suggestions":[{"fix":{"range":[11639,11689],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":296,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":296,"endColumn":16,"suggestions":[{"fix":{"range":[11719,11754],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":297,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":297,"endColumn":16,"suggestions":[{"fix":{"range":[11760,11812],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":298,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":298,"endColumn":16,"suggestions":[{"fix":{"range":[11818,11846],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":299,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":299,"endColumn":16,"suggestions":[{"fix":{"range":[11852,11898],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":300,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":300,"endColumn":16,"suggestions":[{"fix":{"range":[11904,12003],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":311,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":311,"endColumn":14,"suggestions":[{"fix":{"range":[12322,12357],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":312,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":312,"endColumn":14,"suggestions":[{"fix":{"range":[12361,12407],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":313,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":313,"endColumn":14,"suggestions":[{"fix":{"range":[12411,12439],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":329,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":329,"endColumn":20,"suggestions":[{"fix":{"range":[12883,12951],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":337,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":337,"endColumn":14,"suggestions":[{"fix":{"range":[13162,13230],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":339,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":339,"endColumn":16,"suggestions":[{"fix":{"range":[13264,13306],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":341,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":341,"endColumn":18,"suggestions":[{"fix":{"range":[13359,13387],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":344,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":344,"endColumn":18,"suggestions":[{"fix":{"range":[13432,13492],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":358,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":358,"endColumn":14,"suggestions":[{"fix":{"range":[13852,13887],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":359,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":359,"endColumn":14,"suggestions":[{"fix":{"range":[13891,13920],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":360,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":360,"endColumn":14,"suggestions":[{"fix":{"range":[13924,13952],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":361,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":361,"endColumn":14,"suggestions":[{"fix":{"range":[13956,14229],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":378,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":378,"endColumn":16,"suggestions":[{"fix":{"range":[14509,14567],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\generateBaselineScenarios.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":241,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":241,"endColumn":14,"suggestions":[{"fix":{"range":[9704,9732],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":242,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":242,"endColumn":14,"suggestions":[{"fix":{"range":[9736,9792],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":243,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":243,"endColumn":14,"suggestions":[{"fix":{"range":[9796,9824],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":250,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":250,"endColumn":16,"suggestions":[{"fix":{"range":[9977,10001],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":251,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":251,"endColumn":16,"suggestions":[{"fix":{"range":[10007,10101],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":252,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":252,"endColumn":16,"suggestions":[{"fix":{"range":[10107,10199],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":262,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":262,"endColumn":14,"suggestions":[{"fix":{"range":[10503,10541],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":263,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":263,"endColumn":14,"suggestions":[{"fix":{"range":[10545,10634],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":264,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":264,"endColumn":14,"suggestions":[{"fix":{"range":[10638,10701],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":268,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":268,"endColumn":14,"suggestions":[{"fix":{"range":[10845,10918],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":276,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":276,"endColumn":14,"suggestions":[{"fix":{"range":[11167,11244],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":341,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":341,"endColumn":14,"suggestions":[{"fix":{"range":[13663,13698],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":342,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":342,"endColumn":14,"suggestions":[{"fix":{"range":[13702,13738],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":343,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":343,"endColumn":14,"suggestions":[{"fix":{"range":[13742,13770],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":345,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":345,"endColumn":14,"suggestions":[{"fix":{"range":[13776,14629],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":363,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":363,"endColumn":14,"suggestions":[{"fix":{"range":[14675,14703],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":364,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":364,"endColumn":14,"suggestions":[{"fix":{"range":[14707,14764],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":365,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":365,"endColumn":14,"suggestions":[{"fix":{"range":[14768,14796],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":376,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":376,"endColumn":16,"suggestions":[{"fix":{"range":[15159,15237],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":378,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":378,"endColumn":18,"suggestions":[{"fix":{"range":[15291,15354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":379,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":379,"endColumn":18,"suggestions":[{"fix":{"range":[15362,15401],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":380,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":380,"endColumn":18,"suggestions":[{"fix":{"range":[15409,15454],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":381,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":381,"endColumn":18,"suggestions":[{"fix":{"range":[15462,15520],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":384,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":384,"endColumn":18,"suggestions":[{"fix":{"range":[15568,15624],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":389,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":389,"endColumn":16,"suggestions":[{"fix":{"range":[15661,15696],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":390,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":390,"endColumn":16,"suggestions":[{"fix":{"range":[15702,15754],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":391,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":391,"endColumn":16,"suggestions":[{"fix":{"range":[15760,15788],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":392,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":392,"endColumn":16,"suggestions":[{"fix":{"range":[15794,15840],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":393,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":393,"endColumn":16,"suggestions":[{"fix":{"range":[15846,15941],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":404,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":404,"endColumn":14,"suggestions":[{"fix":{"range":[16262,16297],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":405,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":405,"endColumn":14,"suggestions":[{"fix":{"range":[16301,16347],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":406,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":406,"endColumn":14,"suggestions":[{"fix":{"range":[16351,16379],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":428,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":428,"endColumn":20,"suggestions":[{"fix":{"range":[17100,17164],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":436,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":436,"endColumn":14,"suggestions":[{"fix":{"range":[17359,17423],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":438,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":438,"endColumn":16,"suggestions":[{"fix":{"range":[17457,17499],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":440,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":440,"endColumn":18,"suggestions":[{"fix":{"range":[17552,17580],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":443,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":443,"endColumn":18,"suggestions":[{"fix":{"range":[17625,17685],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":463,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":463,"endColumn":14,"suggestions":[{"fix":{"range":[18303,18338],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":464,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":464,"endColumn":14,"suggestions":[{"fix":{"range":[18342,18371],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":465,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":465,"endColumn":14,"suggestions":[{"fix":{"range":[18375,18403],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":466,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":466,"endColumn":14,"suggestions":[{"fix":{"range":[18407,18782],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":487,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":487,"endColumn":16,"suggestions":[{"fix":{"range":[19142,19200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\runAllSeeds.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":70,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":70,"endColumn":14,"suggestions":[{"fix":{"range":[2752,2787],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":71,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":71,"endColumn":14,"suggestions":[{"fix":{"range":[2791,2835],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":72,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":72,"endColumn":14,"suggestions":[{"fix":{"range":[2839,2901],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":73,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":73,"endColumn":14,"suggestions":[{"fix":{"range":[2905,2940],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":75,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":75,"endColumn":14,"suggestions":[{"fix":{"range":[2946,2975],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":76,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":76,"endColumn":14,"suggestions":[{"fix":{"range":[2979,3063],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":77,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":77,"endColumn":14,"suggestions":[{"fix":{"range":[3067,3147],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":78,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":78,"endColumn":14,"suggestions":[{"fix":{"range":[3151,3232],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":79,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":79,"endColumn":14,"suggestions":[{"fix":{"range":[3236,3321],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":80,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":80,"endColumn":14,"suggestions":[{"fix":{"range":[3325,3403],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":81,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":81,"endColumn":14,"suggestions":[{"fix":{"range":[3407,3488],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":82,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":82,"endColumn":14,"suggestions":[{"fix":{"range":[3492,3579],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":83,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":83,"endColumn":14,"suggestions":[{"fix":{"range":[3583,3723],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":84,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":84,"endColumn":14,"suggestions":[{"fix":{"range":[3727,3745],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":88,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":88,"endColumn":16,"suggestions":[{"fix":{"range":[3839,3874],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":89,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":89,"endColumn":16,"suggestions":[{"fix":{"range":[3880,3919],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":90,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":90,"endColumn":16,"suggestions":[{"fix":{"range":[3925,3953],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":102,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":102,"endColumn":16,"suggestions":[{"fix":{"range":[4297,4332],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":103,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":103,"endColumn":16,"suggestions":[{"fix":{"range":[4338,4372],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":104,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":104,"endColumn":16,"suggestions":[{"fix":{"range":[4378,4406],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":127,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":127,"endColumn":16,"suggestions":[{"fix":{"range":[5302,5337],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":128,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":128,"endColumn":16,"suggestions":[{"fix":{"range":[5343,5391],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":129,"endColumn":16,"suggestions":[{"fix":{"range":[5397,5425],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":140,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":140,"endColumn":16,"suggestions":[{"fix":{"range":[5766,5801],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":141,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":141,"endColumn":16,"suggestions":[{"fix":{"range":[5807,5854],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":142,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":142,"endColumn":16,"suggestions":[{"fix":{"range":[5860,5888],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":153,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":153,"endColumn":16,"suggestions":[{"fix":{"range":[6197,6232],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":154,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":154,"endColumn":16,"suggestions":[{"fix":{"range":[6238,6276],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":155,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":155,"endColumn":16,"suggestions":[{"fix":{"range":[6282,6310],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":178,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":178,"endColumn":16,"suggestions":[{"fix":{"range":[7169,7204],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":179,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":179,"endColumn":16,"suggestions":[{"fix":{"range":[7210,7259],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":180,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":180,"endColumn":16,"suggestions":[{"fix":{"range":[7265,7293],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":191,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":191,"endColumn":16,"suggestions":[{"fix":{"range":[7652,7687],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":192,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":192,"endColumn":16,"suggestions":[{"fix":{"range":[7693,7737],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":193,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":193,"endColumn":16,"suggestions":[{"fix":{"range":[7743,7771],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":205,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":205,"endColumn":14,"suggestions":[{"fix":{"range":[8088,8123],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":206,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":206,"endColumn":14,"suggestions":[{"fix":{"range":[8127,8171],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":207,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":207,"endColumn":14,"suggestions":[{"fix":{"range":[8175,8203],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":210,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":210,"endColumn":16,"suggestions":[{"fix":{"range":[8242,8335],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":214,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":214,"endColumn":16,"suggestions":[{"fix":{"range":[8375,8404],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":215,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":215,"endColumn":16,"suggestions":[{"fix":{"range":[8410,8466],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":216,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":216,"endColumn":16,"suggestions":[{"fix":{"range":[8472,8528],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":217,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":217,"endColumn":16,"suggestions":[{"fix":{"range":[8534,8589],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":221,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":221,"endColumn":16,"suggestions":[{"fix":{"range":[8630,8673],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":222,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":222,"endColumn":16,"suggestions":[{"fix":{"range":[8679,8736],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":223,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":223,"endColumn":16,"suggestions":[{"fix":{"range":[8742,8799],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":224,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":224,"endColumn":16,"suggestions":[{"fix":{"range":[8805,8861],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":228,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":228,"endColumn":16,"suggestions":[{"fix":{"range":[8906,8948],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":229,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":229,"endColumn":16,"suggestions":[{"fix":{"range":[8954,9015],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":230,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":230,"endColumn":16,"suggestions":[{"fix":{"range":[9021,9082],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":231,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":231,"endColumn":16,"suggestions":[{"fix":{"range":[9088,9148],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":235,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":235,"endColumn":16,"suggestions":[{"fix":{"range":[9191,9224],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":236,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":236,"endColumn":16,"suggestions":[{"fix":{"range":[9230,9289],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":237,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":237,"endColumn":16,"suggestions":[{"fix":{"range":[9295,9354],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":238,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":238,"endColumn":16,"suggestions":[{"fix":{"range":[9360,9418],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":242,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":242,"endColumn":16,"suggestions":[{"fix":{"range":[9459,9500],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":243,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":243,"endColumn":16,"suggestions":[{"fix":{"range":[9506,9563],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":244,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":244,"endColumn":16,"suggestions":[{"fix":{"range":[9569,9626],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":245,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":245,"endColumn":16,"suggestions":[{"fix":{"range":[9632,9688],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":249,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":249,"endColumn":16,"suggestions":[{"fix":{"range":[9736,9775],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":250,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":250,"endColumn":16,"suggestions":[{"fix":{"range":[9781,9845],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":251,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":251,"endColumn":16,"suggestions":[{"fix":{"range":[9851,9915],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":252,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":252,"endColumn":16,"suggestions":[{"fix":{"range":[9921,9984],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":255,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":255,"endColumn":14,"suggestions":[{"fix":{"range":[9995,10068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":256,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":256,"endColumn":14,"suggestions":[{"fix":{"range":[10072,10114],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":278,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":278,"endColumn":18,"suggestions":[{"fix":{"range":[10844,10883],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\scrapeNDS.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":6,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":6,"endColumn":14,"suggestions":[{"fix":{"range":[178,227],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":13,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":13,"endColumn":14,"suggestions":[{"fix":{"range":[394,440],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":17,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":17,"endColumn":16,"suggestions":[{"fix":{"range":[526,591],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":19,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":19,"endColumn":16,"suggestions":[{"fix":{"range":[609,678],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":24,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":24,"endColumn":14,"suggestions":[{"fix":{"range":[759,798],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":25,"column":27,"nodeType":"MemberExpression","messageId":"limited","endLine":25,"endColumn":38,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":28,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":28,"endColumn":14,"suggestions":[{"fix":{"range":[899,934],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":31,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":31,"endColumn":14,"suggestions":[{"fix":{"range":[985,1053],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedAdSceneTemplates.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":198,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":198,"endColumn":14,"suggestions":[{"fix":{"range":[9480,9529],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":235,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":235,"endColumn":20,"suggestions":[{"fix":{"range":[10739,10778],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":257,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":257,"endColumn":20,"suggestions":[{"fix":{"range":[11570,11609],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":266,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":266,"endColumn":14,"suggestions":[{"fix":{"range":[11747,11841],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":274,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":274,"endColumn":18,"suggestions":[{"fix":{"range":[12015,12036],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedBrandImages.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'users' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"users"},"fix":{"range":[155,162],"text":""},"desc":"Remove unused variable \"users\"."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":260,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":260,"endColumn":14,"suggestions":[{"fix":{"range":[10640,10703],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":265,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":265,"endColumn":16,"suggestions":[{"fix":{"range":[10798,10853],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":298,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":298,"endColumn":20,"suggestions":[{"fix":{"range":[11819,11866],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":302,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":302,"endColumn":20,"suggestions":[{"fix":{"range":[11971,12017],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":310,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":310,"endColumn":14,"suggestions":[{"fix":{"range":[12142,12191],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":311,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":311,"endColumn":14,"suggestions":[{"fix":{"range":[12195,12233],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":312,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":312,"endColumn":14,"suggestions":[{"fix":{"range":[12237,12275],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":313,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":313,"endColumn":14,"suggestions":[{"fix":{"range":[12279,12315],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":323,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":323,"endColumn":14,"suggestions":[{"fix":{"range":[12567,12640],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":333,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":333,"endColumn":16,"suggestions":[{"fix":{"range":[12924,12979],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":348,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":348,"endColumn":16,"suggestions":[{"fix":{"range":[13248,13320],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":377,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":377,"endColumn":20,"suggestions":[{"fix":{"range":[14271,14325],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":388,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":388,"endColumn":14,"suggestions":[{"fix":{"range":[14597,14657],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":389,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":389,"endColumn":14,"suggestions":[{"fix":{"range":[14661,14699],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":390,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":390,"endColumn":14,"suggestions":[{"fix":{"range":[14703,14741],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":391,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":391,"endColumn":14,"suggestions":[{"fix":{"range":[14745,14781],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":400,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":400,"endColumn":14,"suggestions":[{"fix":{"range":[14995,15030],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":401,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":401,"endColumn":14,"suggestions":[{"fix":{"range":[15034,15074],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":402,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":402,"endColumn":14,"suggestions":[{"fix":{"range":[15078,15113],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport { v2 as cloudinary } from \"cloudinary\";\r\nimport { db } from \"../db\";\r\nimport { brandImages, users } from \"@shared/schema\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\n/**\r\n * Brand Images Seed for NDS (Next Day Steel)\r\n *\r\n * Populates the brand images library with categorized reference assets.\r\n * These are existing brand photos that AI can reference for context.\r\n *\r\n * Categories:\r\n * - historical_ad: Previous advertising materials\r\n * - product_hero: Professional product photography\r\n * - installation: Real installation/site photos\r\n * - detail: Close-up product details\r\n * - lifestyle: Products in context/use\r\n * - comparison: Before/after, size comparisons\r\n *\r\n * This answers: \"What existing brand assets fit this context?\"\r\n *\r\n * Usage:\r\n *   POST /api/admin/seed-brand-images\r\n */\r\n\r\n// Configure Cloudinary\r\ncloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\n// Brand Image Categories\r\nconst CATEGORIES = {\r\n  HISTORICAL_AD: \"historical_ad\",\r\n  PRODUCT_HERO: \"product_hero\",\r\n  INSTALLATION: \"installation\",\r\n  DETAIL: \"detail\",\r\n  LIFESTYLE: \"lifestyle\",\r\n  COMPARISON: \"comparison\",\r\n} as const;\r\n\r\n// Suggested Use Cases\r\nconst SUGGESTED_USES = {\r\n  HERO: \"hero\", // Main image for ads\r\n  DETAIL: \"detail\", // Supporting detail shots\r\n  COMPARISON: \"comparison\", // Before/after, size demo\r\n  INSTALLATION: \"installation\", // How-to context\r\n  SOCIAL_MEDIA: \"social_media\", // Social post imagery\r\n  BACKGROUND: \"background\", // Background/texture\r\n} as const;\r\n\r\n/**\r\n * Sample Brand Images Data\r\n *\r\n * Describes the types of images NDS would have in their library.\r\n * In production, these would be populated from actual Cloudinary folders.\r\n */\r\nconst SAMPLE_BRAND_IMAGES = [\r\n  // Historical Ads\r\n  {\r\n    name: \"Next Day Delivery Promise Ad\",\r\n    category: CATEGORIES.HISTORICAL_AD,\r\n    description: \"Classic NDS ad highlighting next-day delivery. Orange and black color scheme, bold headline 'ORDER BY 1PM, DELIVERED TOMORROW'.\",\r\n    tags: [\"next-day\", \"delivery\", \"promise\", \"orange\", \"headline\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Trade Quality DIY Friendly Ad\",\r\n    category: CATEGORIES.HISTORICAL_AD,\r\n    description: \"Ad showing NDS serves both trade and DIY customers equally. Split design with contractor and homeowner imagery.\",\r\n    tags: [\"trade\", \"diy\", \"inclusive\", \"split-design\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n  {\r\n    name: \"No Minimum Order Campaign\",\r\n    category: CATEGORIES.HISTORICAL_AD,\r\n    description: \"Campaign highlighting no minimum order policy. Single rebar bar featured with '1 BAR OR 1000' messaging.\",\r\n    tags: [\"no-minimum\", \"accessibility\", \"single-bar\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"4:5\",\r\n  },\r\n\r\n  // Product Hero Shots\r\n  {\r\n    name: \"Rebar Stack - Professional Shot\",\r\n    category: CATEGORIES.PRODUCT_HERO,\r\n    description: \"Studio shot of T10-T25 rebar bars stacked neatly. Clean background, professional lighting showing ribbed texture.\",\r\n    tags: [\"rebar\", \"stack\", \"professional\", \"studio\", \"texture\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"A193 Mesh Sheet - Aerial View\",\r\n    category: CATEGORIES.PRODUCT_HERO,\r\n    description: \"Top-down shot of A193 mesh sheet showing grid pattern. Clean concrete floor background, CARES certification visible.\",\r\n    tags: [\"mesh\", \"A193\", \"aerial\", \"grid-pattern\", \"certified\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n  {\r\n    name: \"Spacer Collection - Product Range\",\r\n    category: CATEGORIES.PRODUCT_HERO,\r\n    description: \"Range shot showing all spacer types: clips, chairs, wheels. Size progression visible, clean white background.\",\r\n    tags: [\"spacers\", \"range\", \"collection\", \"sizes\", \"white-background\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.COMPARISON],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Tie Wire Coil - Close Up\",\r\n    category: CATEGORIES.PRODUCT_HERO,\r\n    description: \"Detailed shot of 20kg tie wire coil. Metallic texture visible, label showing specifications.\",\r\n    tags: [\"tie-wire\", \"coil\", \"detail\", \"specifications\"],\r\n    suggestedUse: [SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n\r\n  // Installation Photos\r\n  {\r\n    name: \"Foundation Reinforcement - Site Photo\",\r\n    category: CATEGORIES.INSTALLATION,\r\n    description: \"Real construction site showing foundation reinforcement. Workers in hi-vis, rebar cage visible in excavation.\",\r\n    tags: [\"foundation\", \"site\", \"workers\", \"rebar-cage\", \"excavation\"],\r\n    suggestedUse: [SUGGESTED_USES.INSTALLATION, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Mesh Installation - Slab Pour\",\r\n    category: CATEGORIES.INSTALLATION,\r\n    description: \"Ground floor slab installation with A193 mesh on chair spacers. Concrete pour in progress, professional site.\",\r\n    tags: [\"mesh\", \"slab\", \"pour\", \"chairs\", \"professional-site\"],\r\n    suggestedUse: [SUGGESTED_USES.INSTALLATION, SUGGESTED_USES.HERO],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Rebar Tying - Close Up\",\r\n    category: CATEGORIES.INSTALLATION,\r\n    description: \"Close-up of worker tying rebar intersections. Tie wire technique visible, gloved hands, professional quality.\",\r\n    tags: [\"tying\", \"technique\", \"close-up\", \"hands\", \"tie-wire\"],\r\n    suggestedUse: [SUGGESTED_USES.DETAIL, SUGGESTED_USES.INSTALLATION],\r\n    aspectRatio: \"4:5\",\r\n  },\r\n  {\r\n    name: \"Column Cage Assembly\",\r\n    category: CATEGORIES.INSTALLATION,\r\n    description: \"Column reinforcement cage being assembled on site. T20 main bars, T10 links visible, workers in background.\",\r\n    tags: [\"column\", \"cage\", \"assembly\", \"links\", \"main-bars\"],\r\n    suggestedUse: [SUGGESTED_USES.INSTALLATION, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"9:16\",\r\n  },\r\n  {\r\n    name: \"Spacer Positioning - Detail\",\r\n    category: CATEGORIES.INSTALLATION,\r\n    description: \"Detail shot of spacers being positioned under mesh. Correct cover being maintained, clean installation.\",\r\n    tags: [\"spacers\", \"positioning\", \"cover\", \"detail\", \"technique\"],\r\n    suggestedUse: [SUGGESTED_USES.INSTALLATION, SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n\r\n  // Detail/Close-up Shots\r\n  {\r\n    name: \"Rebar Ribs - Macro\",\r\n    category: CATEGORIES.DETAIL,\r\n    description: \"Macro shot of rebar ribbed surface. Shows deformation pattern for concrete bond, metallic texture.\",\r\n    tags: [\"ribs\", \"macro\", \"texture\", \"deformation\", \"bond\"],\r\n    suggestedUse: [SUGGESTED_USES.DETAIL, SUGGESTED_USES.BACKGROUND],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n  {\r\n    name: \"Mesh Weld Points\",\r\n    category: CATEGORIES.DETAIL,\r\n    description: \"Close-up of mesh weld intersections. Quality welding visible, structural integrity evident.\",\r\n    tags: [\"weld\", \"intersection\", \"quality\", \"close-up\"],\r\n    suggestedUse: [SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n  {\r\n    name: \"Coupler Thread Detail\",\r\n    category: CATEGORIES.DETAIL,\r\n    description: \"Macro shot of mechanical coupler threading. Precision machining visible, certification marks.\",\r\n    tags: [\"coupler\", \"thread\", \"precision\", \"machining\"],\r\n    suggestedUse: [SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"1:1\",\r\n  },\r\n\r\n  // Lifestyle/Context\r\n  {\r\n    name: \"Contractor on Site with Delivery\",\r\n    category: CATEGORIES.LIFESTYLE,\r\n    description: \"Contractor receiving NDS delivery on site. Branded vehicle visible, professional handover, satisfied customer.\",\r\n    tags: [\"delivery\", \"contractor\", \"branded\", \"handover\", \"customer\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"DIY Customer - Home Project\",\r\n    category: CATEGORIES.LIFESTYLE,\r\n    description: \"Homeowner working on garden project with NDS mesh. Domestic setting, achievable DIY project feel.\",\r\n    tags: [\"diy\", \"homeowner\", \"garden\", \"domestic\", \"achievable\"],\r\n    suggestedUse: [SUGGESTED_USES.HERO, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"4:5\",\r\n  },\r\n  {\r\n    name: \"Warehouse Operations\",\r\n    category: CATEGORIES.LIFESTYLE,\r\n    description: \"NDS warehouse showing stock levels and operations. Organised stock, professional environment, capacity.\",\r\n    tags: [\"warehouse\", \"stock\", \"operations\", \"professional\", \"capacity\"],\r\n    suggestedUse: [SUGGESTED_USES.BACKGROUND, SUGGESTED_USES.SOCIAL_MEDIA],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n\r\n  // Comparison Images\r\n  {\r\n    name: \"Mesh Size Comparison A142-A393\",\r\n    category: CATEGORIES.COMPARISON,\r\n    description: \"Side-by-side comparison of A142 vs A393 mesh. Wire size difference clearly visible, scale reference included.\",\r\n    tags: [\"comparison\", \"mesh\", \"sizes\", \"scale\", \"wire-size\"],\r\n    suggestedUse: [SUGGESTED_USES.COMPARISON, SUGGESTED_USES.DETAIL],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Rebar Size Range T8-T40\",\r\n    category: CATEGORIES.COMPARISON,\r\n    description: \"Cross-section comparison of rebar sizes T8 through T40. Diameter progression clear, size labels.\",\r\n    tags: [\"comparison\", \"rebar\", \"sizes\", \"cross-section\", \"range\"],\r\n    suggestedUse: [SUGGESTED_USES.COMPARISON, SUGGESTED_USES.HERO],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n  {\r\n    name: \"Spacer Cover Options\",\r\n    category: CATEGORIES.COMPARISON,\r\n    description: \"Comparison showing 25mm, 40mm, 50mm cover spacers in use. Cover difference visible against formwork.\",\r\n    tags: [\"comparison\", \"spacers\", \"cover\", \"options\", \"formwork\"],\r\n    suggestedUse: [SUGGESTED_USES.COMPARISON, SUGGESTED_USES.INSTALLATION],\r\n    aspectRatio: \"16:9\",\r\n  },\r\n];\r\n\r\n/**\r\n * Generate placeholder Cloudinary URL\r\n * In production, these would be actual uploaded images\r\n */\r\nfunction getPlaceholderUrl(category: string, name: string): { url: string; publicId: string } {\r\n  const slug = name.toLowerCase().replace(/\\s+/g, \"-\").replace(/[^a-z0-9-]/g, \"\");\r\n  const cloudName = process.env.CLOUDINARY_CLOUD_NAME || \"placeholder\";\r\n  return {\r\n    url: `https://res.cloudinary.com/${cloudName}/image/upload/v1/brand-images/${category}/${slug}.jpg`,\r\n    publicId: `brand-images/${category}/${slug}`,\r\n  };\r\n}\r\n\r\n/**\r\n * Seed brand images from sample data\r\n */\r\nexport async function seedBrandImagesFromSampleData() {\r\n  console.log(\" Seeding NDS Brand Images from sample data...\");\r\n\r\n  // Get first user\r\n  const user = await db.query.users.findFirst();\r\n  if (!user) {\r\n    console.log(\" No users found. Create a user first.\");\r\n    return { created: 0, updated: 0, errors: 0 };\r\n  }\r\n\r\n  let created = 0;\r\n  let updated = 0;\r\n  let errors = 0;\r\n\r\n  for (const imageData of SAMPLE_BRAND_IMAGES) {\r\n    try {\r\n      const { url, publicId } = getPlaceholderUrl(imageData.category, imageData.name);\r\n\r\n      // Check if image exists by publicId\r\n      const existing = await db.query.brandImages.findFirst({\r\n        where: eq(brandImages.cloudinaryPublicId, publicId),\r\n      });\r\n\r\n      const imageRecord = {\r\n        userId: user.id,\r\n        cloudinaryUrl: url,\r\n        cloudinaryPublicId: publicId,\r\n        category: imageData.category,\r\n        tags: imageData.tags,\r\n        description: imageData.description,\r\n        suggestedUse: imageData.suggestedUse,\r\n        aspectRatio: imageData.aspectRatio,\r\n      };\r\n\r\n      if (existing) {\r\n        await db.update(brandImages)\r\n          .set(imageRecord)\r\n          .where(eq(brandImages.id, existing.id));\r\n        updated++;\r\n        console.log(`   Updated: ${imageData.name}`);\r\n      } else {\r\n        await db.insert(brandImages).values(imageRecord);\r\n        created++;\r\n        console.log(`   Created: ${imageData.name}`);\r\n      }\r\n    } catch (err) {\r\n      errors++;\r\n      console.error(`   Failed: ${imageData.name}`, err);\r\n    }\r\n  }\r\n\r\n  console.log(`\\n Brand Image seeding complete:`);\r\n  console.log(`   Created: ${created}`);\r\n  console.log(`   Updated: ${updated}`);\r\n  console.log(`   Errors: ${errors}`);\r\n\r\n  return { created, updated, errors };\r\n}\r\n\r\n/**\r\n * Seed brand images from Cloudinary folder\r\n * Reads existing images and creates brand image records\r\n */\r\nexport async function seedBrandImagesFromCloudinary(folder: string = \"brand-images\") {\r\n  console.log(` Seeding brand images from Cloudinary folder: ${folder}`);\r\n\r\n  if (!process.env.CLOUDINARY_CLOUD_NAME || !process.env.CLOUDINARY_API_KEY) {\r\n    console.error(\" Cloudinary not configured\");\r\n    return { created: 0, skipped: 0, errors: 0 };\r\n  }\r\n\r\n  // Get first user\r\n  const user = await db.query.users.findFirst();\r\n  if (!user) {\r\n    console.log(\" No users found. Create a user first.\");\r\n    return { created: 0, skipped: 0, errors: 0 };\r\n  }\r\n\r\n  let created = 0;\r\n  let skipped = 0;\r\n  let errors = 0;\r\n\r\n  try {\r\n    const result = await cloudinary.api.resources({\r\n      type: \"upload\",\r\n      prefix: folder,\r\n      max_results: 500,\r\n    });\r\n\r\n    console.log(` Found ${result.resources.length} images in Cloudinary`);\r\n\r\n    for (const resource of result.resources) {\r\n      try {\r\n        // Check if already exists\r\n        const existing = await db.query.brandImages.findFirst({\r\n          where: eq(brandImages.cloudinaryPublicId, resource.public_id),\r\n        });\r\n\r\n        if (existing) {\r\n          skipped++;\r\n          continue;\r\n        }\r\n\r\n        // Extract category from path (e.g., \"brand-images/installation/photo1\" -> \"installation\")\r\n        const pathParts = resource.public_id.split(\"/\");\r\n        const category = pathParts.length > 1 ? pathParts[1] : \"uncategorized\";\r\n        const fileName = pathParts[pathParts.length - 1];\r\n\r\n        await db.insert(brandImages).values({\r\n          userId: user.id,\r\n          cloudinaryUrl: resource.secure_url,\r\n          cloudinaryPublicId: resource.public_id,\r\n          category,\r\n          tags: [category],\r\n          description: `Imported: ${fileName}`,\r\n        });\r\n\r\n        created++;\r\n        console.log(`   Created: ${fileName} (${category})`);\r\n      } catch (err) {\r\n        errors++;\r\n        console.error(`   Failed: ${resource.public_id}`, err);\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error(\" Failed to list Cloudinary resources:\", err);\r\n    return { created: 0, skipped: 0, errors: 1 };\r\n  }\r\n\r\n  console.log(`\\n Cloudinary brand image seeding complete:`);\r\n  console.log(`   Created: ${created}`);\r\n  console.log(`   Skipped: ${skipped}`);\r\n  console.log(`   Errors: ${errors}`);\r\n\r\n  return { created, skipped, errors };\r\n}\r\n\r\n/**\r\n * Main seed function\r\n */\r\nexport async function seedBrandImages(options?: { sampleOnly?: boolean; cloudinaryOnly?: boolean; cloudinaryFolder?: string }) {\r\n  console.log(\"\\n\" + \"=\".repeat(50));\r\n  console.log(\"NDS BRAND IMAGES SEEDING\");\r\n  console.log(\"=\".repeat(50) + \"\\n\");\r\n\r\n  const results = {\r\n    sample: { created: 0, updated: 0, errors: 0 },\r\n    cloudinary: { created: 0, skipped: 0, errors: 0 },\r\n  };\r\n\r\n  if (!options?.cloudinaryOnly) {\r\n    results.sample = await seedBrandImagesFromSampleData();\r\n  }\r\n\r\n  if (!options?.sampleOnly) {\r\n    results.cloudinary = await seedBrandImagesFromCloudinary(options?.cloudinaryFolder);\r\n  }\r\n\r\n  return results;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedBrandProfile.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'storage' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":17,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"storage"},"fix":{"range":[58,97],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":9,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":9,"endColumn":16,"suggestions":[{"fix":{"range":[260,307],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":15,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":15,"endColumn":20,"suggestions":[{"fix":{"range":[582,666],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":115,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":115,"endColumn":24,"suggestions":[{"fix":{"range":[6004,6057],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":120,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":120,"endColumn":24,"suggestions":[{"fix":{"range":[6226,6273],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":124,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":124,"endColumn":20,"suggestions":[{"fix":{"range":[6360,6416],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport { storage } from \"../storage\";\r\nimport { brandProfiles } from \"@shared/schema\";\r\nimport { db } from \"../db\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\nexport async function seedBrandProfile() {\r\n    console.log(\" Seeding NDS Brand Profile...\");\r\n\r\n    // 1. Get the primary user (for now, assume first user or specific email if needed)\r\n    // In a real app we'd map this to the specific logged-in user, but for single-tenant agency:\r\n    const users = await helpers.getUsers();\r\n    if (users.length === 0) {\r\n        console.log(\" No users found. Skipping Brand Profile seed. Create a user first.\");\r\n        return;\r\n    }\r\n    const userId = users[0].id;\r\n\r\n    // 2. Define NDS Brand Data (LLM-Optimized - Compiled from 13 Agent Analyses)\r\n    // Source: docs/NDS-BRAND-PROFILE-COMPLETE.md\r\n    const ndsProfile = {\r\n        userId: userId,\r\n        brandName: \"Next Day Steel\",\r\n        industry: \"Construction Materials & Steel Reinforcement\",\r\n        brandValues: [\r\n            \"Speed & Reliability - Order by 1pm, delivered next day\",\r\n            \"Problem-Solving Attitude - Solutions-focused, not problems-focused\",\r\n            \"Inclusivity - DIY to Enterprise, no minimum orders, equal service\",\r\n            \"Practical & Direct - Clear, specific, no fluff\",\r\n            \"Customer-First - Time-respectful, helpful, never rushed\",\r\n            \"Professional Competence - Knowledgeable without being corporate\",\r\n            \"Honesty - Confident about capabilities, honest about limitations\"\r\n        ],\r\n        targetAudience: {\r\n            demographics: \"SME Contractors, Groundworkers, DIY Homeowners, Procurement Officers, Maintenance Managers\",\r\n            psychographics: \"Values speed over bureaucracy, needs certainty, practical-minded, time-poor, weather-dependent schedules\",\r\n            painPoints: [\r\n                \"Material shortages causing project delays\",\r\n                \"Unreliable delivery windows before pour day\",\r\n                \"Suppliers who won't serve small orders\",\r\n                \"Complex ordering processes\",\r\n                \"Lack of technical support\",\r\n                \"Emergency/gap-fill needs\"\r\n            ],\r\n            personas: [\r\n                \"SME Contractor (Gary) - 35-55, small company owner, values reliability\",\r\n                \"DIY/Homeowner (Sarah) - 30-60, wants trade-quality at fair prices\",\r\n                \"Groundworker (Dave) - 25-45, tight schedules, gap-fill needs\",\r\n                \"Procurement Officer (James) - 30-50, process-driven, needs documentation\",\r\n                \"Maintenance Manager (Michelle) - 35-55, reactive needs, emergency situations\"\r\n            ]\r\n        },\r\n        preferredStyles: [\r\n            \"Industrial - Construction site context, real materials\",\r\n            \"Site-Realistic - Actual installation photos, workers on site\",\r\n            \"Clean Lines - Uncluttered, professional layouts\",\r\n            \"High Clarity - Sharp focus, good lighting\",\r\n            \"Technical Accuracy - Correct terminology, proper specs\"\r\n        ],\r\n        colorPreferences: [\r\n            \"Orange #FF6B35 - Safety, CTAs, urgency\",\r\n            \"Silver/Grey #7A7A7A - Steel, product imagery\",\r\n            \"Black #1A1A1A - Headlines, body text\",\r\n            \"White #FFFFFF - Backgrounds, readability\"\r\n        ],\r\n        voice: {\r\n            summary: \"Professional, helpful, and knowledgeable steel supplier voice. We speak with confident expertise but remain approachable and never condescending. Solutions-focused, time-respectful, building trust through specific commitments.\",\r\n            principles: [\r\n                \"Professional Helper - Competent without being corporate, solutions-focused\",\r\n                \"Approachable Expert - Friendly but not casual, industry-aware\",\r\n                \"Reliable Partner - Makes specific promises, follows through\"\r\n            ],\r\n            wordsToUse: [\r\n                \"Next Day\", \"Guaranteed\", \"Reliable\", \"On-site\", \"Solution\",\r\n                \"Reinforcement\", \"Mesh\", \"Rebar\", \"CARES-approved\", \"BS4449 certified\",\r\n                \"We can\", \"We will\", \"We deliver\", \"By [specific time]\"\r\n            ],\r\n            wordsToAvoid: [\r\n                \"Maybe\", \"Try to\", \"Usually\", \"Hopefully\", \"Probably\",\r\n                \"Bespoke (use Custom)\", \"Artisanal\", \"Luxury\", \"ASAP\",\r\n                \"To be honest\", \"Sorry to bother you\", \"Obviously\"\r\n            ],\r\n            sentencePatterns: [\r\n                \"I can arrange... (not 'I'll try to arrange')\",\r\n                \"We deliver next-day to... (not 'We usually deliver')\",\r\n                \"Let me take your requirements now so...\",\r\n                \"I'll WhatsApp you our details so you can reply when convenient\"\r\n            ],\r\n            forbiddenPatterns: [\r\n                \"Never recommend products - defer to structural engineers\",\r\n                \"Never give engineering advice or specifications\",\r\n                \"Never promise Saturday delivery\",\r\n                \"Never claim same-day universally (only London depot)\"\r\n            ]\r\n        },\r\n        industryTerminology: {\r\n            products: [\"T8-T40 rebar\", \"A142/A193/A252/A393 mesh\", \"Spacers\", \"Tie wire\", \"Couplers\"],\r\n            standards: [\"BS4449\", \"BS4483\", \"BS8666\", \"CARES certified\"],\r\n            terms: [\"Shape codes\", \"Stirrups\", \"Kickers\", \"Cover\", \"Lap\", \"Cut-to-length\"]\r\n        },\r\n        platformGuidelines: {\r\n            linkedin: \"Professional authority, technical accuracy, 1300-2000 chars, 3-5 hashtags\",\r\n            instagram: \"Behind-the-scenes, authentic, 138-150 chars, 8-11 hashtags\",\r\n            facebook: \"Community-focused, friendly, 40-80 chars, 1-2 hashtags\"\r\n        },\r\n        updatedAt: new Date()\r\n    };\r\n\r\n    // 3. Upsert into DB\r\n    try {\r\n        const existing = await db.select().from(brandProfiles).where(eq(brandProfiles.userId, userId));\r\n\r\n        if (existing.length > 0) {\r\n            console.log(\" Updating existing Brand Profile...\");\r\n            await db.update(brandProfiles)\r\n                .set(ndsProfile)\r\n                .where(eq(brandProfiles.userId, userId));\r\n        } else {\r\n            console.log(\" Creating new Brand Profile...\");\r\n            await db.insert(brandProfiles).values(ndsProfile);\r\n        }\r\n\r\n        console.log(\" NDS Brand Profile seeded successfully!\");\r\n    } catch (err) {\r\n        console.error(\" Failed to seed Brand Profile:\", err);\r\n    }\r\n}\r\n\r\n// Helper to get users without importing whole storage (circular dependency risk)\r\nconst helpers = {\r\n    getUsers: async () => {\r\n        return await db.query.users.findMany({ limit: 1 });\r\n    }\r\n};\r\n\r\n// CLI execution disabled - this check doesn't work correctly when bundled with esbuild\r\n// The bundled file becomes the \"main module\" so this would run on every server start\r\n// To seed manually, use: POST /api/admin/seed-brand\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedInstallationScenarios.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'users' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"users"},"fix":{"range":[127,134],"text":""},"desc":"Remove unused variable \"users\"."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":297,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":297,"endColumn":14,"suggestions":[{"fix":{"range":[14505,14561],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":302,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":302,"endColumn":16,"suggestions":[{"fix":{"range":[14680,14735],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":343,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":343,"endColumn":20,"suggestions":[{"fix":{"range":[16115,16162],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":347,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":347,"endColumn":20,"suggestions":[{"fix":{"range":[16280,16326],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":355,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":355,"endColumn":14,"suggestions":[{"fix":{"range":[16451,16510],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":356,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":356,"endColumn":14,"suggestions":[{"fix":{"range":[16514,16552],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":357,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":357,"endColumn":14,"suggestions":[{"fix":{"range":[16556,16594],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":358,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":358,"endColumn":14,"suggestions":[{"fix":{"range":[16598,16634],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport { db } from \"../db\";\r\nimport { installationScenarios, products, users } from \"@shared/schema\";\r\nimport { eq, ilike } from \"drizzle-orm\";\r\n\r\n/**\r\n * Installation Scenarios Seed for NDS (Next Day Steel)\r\n *\r\n * Populates installation scenarios that explain HOW products are installed.\r\n * This context-maximization prevents LLM hallucination by providing\r\n * verified installation knowledge.\r\n *\r\n * Scenarios answer: \"How is this product installed on site?\"\r\n *\r\n * Usage:\r\n *   POST /api/admin/seed-installation-scenarios\r\n */\r\n\r\n// Scenario Types\r\nconst SCENARIO_TYPES = {\r\n  APPLICATION: \"application\", // How product is applied/used\r\n  ROOM_TYPE: \"room_type\", // Installation by room/area\r\n  BEFORE_AFTER: \"before_after\", // Before/after transformation\r\n} as const;\r\n\r\n// Room Types for targeting\r\nconst ROOM_TYPES = {\r\n  FOUNDATION: \"foundation\",\r\n  SLAB: \"ground-floor-slab\",\r\n  SUSPENDED: \"suspended-slab\",\r\n  WALL: \"retaining-wall\",\r\n  COLUMN: \"column\",\r\n  BEAM: \"beam\",\r\n  DRIVEWAY: \"driveway\",\r\n  GARAGE: \"garage\",\r\n  COMMERCIAL: \"commercial-floor\",\r\n  INDUSTRIAL: \"industrial-floor\",\r\n} as const;\r\n\r\n// Style Tags\r\nconst STYLE_TAGS = {\r\n  RESIDENTIAL: \"residential\",\r\n  COMMERCIAL: \"commercial\",\r\n  INDUSTRIAL: \"industrial\",\r\n  DIY: \"diy-friendly\",\r\n  PROFESSIONAL: \"professional-only\",\r\n  GROUNDWORKS: \"groundworks\",\r\n} as const;\r\n\r\n/**\r\n * Installation Scenarios for NDS Steel Reinforcement Products\r\n *\r\n * Each scenario includes:\r\n * - What product category it applies to\r\n * - Step-by-step installation guide\r\n * - Required accessories\r\n * - Reference image descriptions\r\n */\r\nconst INSTALLATION_SCENARIOS = [\r\n  // Foundation Scenarios\r\n  {\r\n    title: \"Domestic Foundation Strip Footing - Rebar Installation\",\r\n    description: \"Standard rebar installation for domestic strip foundations. T10/T12 bars placed in excavated trench with correct cover maintained using spacers.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Excavate trench to engineer's specification (typically 450mm wide x 600mm deep)\",\r\n      \"Compact trench bottom and add 50mm blinding concrete\",\r\n      \"Position bottom bars (typically T10) on 50mm spacers\",\r\n      \"Place distribution bars at 200-300mm centers\",\r\n      \"Tie all intersections with tie wire\",\r\n      \"Install starter bars for walls if required\",\r\n      \"Check cover is maintained - minimum 40mm bottom, 75mm sides\",\r\n      \"Have reinforcement inspected before concrete pour\",\r\n    ],\r\n    requiredAccessories: [\"Concrete spacers - 50mm cover\", \"Tie wire 1.6mm\", \"Chair spacers for multiple layers\"],\r\n    roomTypes: [ROOM_TYPES.FOUNDATION],\r\n    styleTags: [STYLE_TAGS.RESIDENTIAL, STYLE_TAGS.GROUNDWORKS],\r\n    referenceImageDescription: \"Shows excavated trench with T10 rebar placed on spacers, tie wire connections visible, ready for inspection before pour.\",\r\n  },\r\n  {\r\n    title: \"Commercial Foundation Raft - Heavy Rebar Installation\",\r\n    description: \"Large-scale raft foundation installation using T16-T25 rebar in both directions. Two-layer reinforcement with proper spacing maintained throughout.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Prepare sub-base and install membrane as per engineer's specification\",\r\n      \"Mark out grid pattern for bottom layer reinforcement\",\r\n      \"Position T16/T20 bottom bars on 75mm spacers at designed centers\",\r\n      \"Install perpendicular distribution bars\",\r\n      \"Tie all intersections securely\",\r\n      \"Install chair spacers to support top layer\",\r\n      \"Position top layer reinforcement on chairs\",\r\n      \"Install edge reinforcement and trimming bars\",\r\n      \"Install any required U-bars or link reinforcement\",\r\n      \"Final check of cover and spacing before pour\",\r\n    ],\r\n    requiredAccessories: [\"Heavy-duty chair spacers\", \"Concrete spacers - 75mm\", \"Tie wire 1.6mm\", \"Rebar couplers if splicing required\"],\r\n    roomTypes: [ROOM_TYPES.FOUNDATION, ROOM_TYPES.COMMERCIAL],\r\n    styleTags: [STYLE_TAGS.COMMERCIAL, STYLE_TAGS.PROFESSIONAL],\r\n    referenceImageDescription: \"Large raft foundation with two layers of heavy rebar, chair spacers visible supporting top layer, workers tying reinforcement cage.\",\r\n  },\r\n\r\n  // Ground Floor Slab Scenarios\r\n  {\r\n    title: \"Domestic Ground Floor Slab - A193 Mesh Installation\",\r\n    description: \"Standard mesh reinforcement for domestic ground floor slabs. A193 mesh positioned in top third of slab with correct overlap and spacer support.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"mesh\",\r\n    installationSteps: [\r\n      \"Prepare sub-base with compacted hardcore and sand blinding\",\r\n      \"Install DPM membrane with 150mm overlaps\",\r\n      \"Lay insulation if required\",\r\n      \"Position chair spacers at 500-600mm centers\",\r\n      \"Lay A193 mesh sheets on spacers\",\r\n      \"Ensure 200mm minimum overlap between sheets\",\r\n      \"Secure overlaps with mesh clips\",\r\n      \"Trim edges as required - allow 40mm cover to edges\",\r\n      \"Install slab edge reinforcement if required\",\r\n      \"Check mesh is in top third of slab depth\",\r\n    ],\r\n    requiredAccessories: [\"Chair spacers\", \"Mesh clips - universal\", \"Edge protection where required\"],\r\n    roomTypes: [ROOM_TYPES.SLAB, ROOM_TYPES.GARAGE],\r\n    styleTags: [STYLE_TAGS.RESIDENTIAL, STYLE_TAGS.DIY],\r\n    referenceImageDescription: \"Ground floor with DPM visible, A193 mesh sheets laid on chair spacers, 200mm overlaps visible, mesh clips securing joints.\",\r\n  },\r\n  {\r\n    title: \"Driveway Slab - A252 Mesh for Vehicle Loading\",\r\n    description: \"Heavy-duty mesh installation for driveways subject to vehicle loading. A252 or A393 mesh with increased depth for load distribution.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"mesh\",\r\n    installationSteps: [\r\n      \"Excavate to required depth (typically 150mm slab on 150mm sub-base)\",\r\n      \"Install compacted MOT Type 1 sub-base\",\r\n      \"Add blinding sand layer\",\r\n      \"Position heavy-duty chair spacers\",\r\n      \"Lay A252 or A393 mesh on spacers\",\r\n      \"Overlap sheets by minimum 250mm\",\r\n      \"Secure with mesh clips at all overlaps\",\r\n      \"Install edge formwork at correct levels\",\r\n      \"Add reinforcement at edges and corners\",\r\n      \"Position expansion joints at changes of direction\",\r\n    ],\r\n    requiredAccessories: [\"Heavy-duty chair spacers\", \"Mesh clips\", \"Expansion joint material\", \"Edge reinforcement\"],\r\n    roomTypes: [ROOM_TYPES.DRIVEWAY, ROOM_TYPES.GARAGE],\r\n    styleTags: [STYLE_TAGS.RESIDENTIAL, STYLE_TAGS.GROUNDWORKS],\r\n    referenceImageDescription: \"Driveway excavation with sub-base visible, A252 mesh on heavy-duty spacers, formwork around edges, ready for concrete pour.\",\r\n  },\r\n\r\n  // Commercial Floor Scenarios\r\n  {\r\n    title: \"Industrial Floor Slab - A393 Mesh Double Layer\",\r\n    description: \"Heavy-duty industrial floor installation with A393 mesh. Double layer reinforcement for forklift traffic and heavy point loads.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"mesh\",\r\n    installationSteps: [\r\n      \"Design review - confirm slab thickness and reinforcement requirements\",\r\n      \"Prepare sub-base to engineer's specification\",\r\n      \"Install vapour barrier with sealed joints\",\r\n      \"Position bottom layer spacers (50mm minimum cover)\",\r\n      \"Lay bottom A393 mesh layer\",\r\n      \"Install chair spacers for top layer\",\r\n      \"Lay top A393 mesh layer\",\r\n      \"Install edge and joint reinforcement\",\r\n      \"Position dowel sleeves for joints\",\r\n      \"Install any required cast-in items\",\r\n      \"Final inspection before pour\",\r\n    ],\r\n    requiredAccessories: [\"Spacers - 50mm cover\", \"Heavy-duty chair spacers\", \"Mesh clips\", \"Dowel systems\", \"Edge protection\"],\r\n    roomTypes: [ROOM_TYPES.INDUSTRIAL, ROOM_TYPES.COMMERCIAL],\r\n    styleTags: [STYLE_TAGS.INDUSTRIAL, STYLE_TAGS.PROFESSIONAL],\r\n    referenceImageDescription: \"Large industrial floor under construction, double layer A393 mesh visible, dowel systems at joints, workers in PPE.\",\r\n  },\r\n\r\n  // Wall Scenarios\r\n  {\r\n    title: \"Retaining Wall - Rebar Cage Assembly\",\r\n    description: \"Reinforced concrete retaining wall installation. Vertical and horizontal rebar tied into cage with wall face shuttering.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Install kicker concrete with starter bars from foundation\",\r\n      \"Position vertical main bars - lap with starter bars (40 diameters minimum)\",\r\n      \"Install horizontal distribution bars at designed spacing\",\r\n      \"Tie all intersections securely\",\r\n      \"Install wall ties if cavity construction\",\r\n      \"Add U-bars at top of wall\",\r\n      \"Check vertical alignment\",\r\n      \"Install spacer wheels for consistent cover\",\r\n      \"Fix formwork to one face\",\r\n      \"Final cover check before closing shuttering\",\r\n    ],\r\n    requiredAccessories: [\"Tie wire\", \"Spacer wheels\", \"Chair spacers\", \"Coupler if required\"],\r\n    roomTypes: [ROOM_TYPES.WALL],\r\n    styleTags: [STYLE_TAGS.RESIDENTIAL, STYLE_TAGS.GROUNDWORKS],\r\n    referenceImageDescription: \"Retaining wall reinforcement cage visible, vertical bars lapped to starters, horizontal bars tied, formwork visible one side.\",\r\n  },\r\n\r\n  // Beam and Column Scenarios\r\n  {\r\n    title: \"Reinforced Concrete Column - Rebar Cage\",\r\n    description: \"Column reinforcement cage assembly with main bars and link stirrups. Typically T16-T25 main bars with T10 links.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Review bar bending schedule and shape codes\",\r\n      \"Assemble prefabricated links in correct spacing\",\r\n      \"Insert main vertical bars through links\",\r\n      \"Tie links to main bars - alternate links\",\r\n      \"Check link spacing matches schedule\",\r\n      \"Lift cage into position over starter bars\",\r\n      \"Lap main bars to starters (40 diameters minimum)\",\r\n      \"Secure cage to prevent movement\",\r\n      \"Install spacer wheels for cover\",\r\n      \"Fix column formwork\",\r\n    ],\r\n    requiredAccessories: [\"Tie wire\", \"Spacer wheels\", \"Lifting equipment for cage\"],\r\n    roomTypes: [ROOM_TYPES.COLUMN],\r\n    styleTags: [STYLE_TAGS.COMMERCIAL, STYLE_TAGS.PROFESSIONAL],\r\n    referenceImageDescription: \"Column rebar cage being assembled, T20 main bars visible, T10 links at regular spacing, cage ready for lifting into position.\",\r\n  },\r\n  {\r\n    title: \"Reinforced Concrete Beam - Rebar Installation\",\r\n    description: \"Beam reinforcement installation with tension bars bottom, compression bars top, and shear links throughout.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Install beam soffit formwork\",\r\n      \"Position bottom bars on spacers\",\r\n      \"Install shear links along beam length - closer spacing near supports\",\r\n      \"Position top compression bars\",\r\n      \"Tie all bars to links securely\",\r\n      \"Install any additional link reinforcement at supports\",\r\n      \"Add side face bars if beam depth exceeds 750mm\",\r\n      \"Check cover at all faces\",\r\n      \"Install beam side formwork\",\r\n      \"Final inspection before pour\",\r\n    ],\r\n    requiredAccessories: [\"Tie wire\", \"Spacers - 40mm cover\", \"Chair spacers\"],\r\n    roomTypes: [ROOM_TYPES.BEAM],\r\n    styleTags: [STYLE_TAGS.COMMERCIAL, STYLE_TAGS.PROFESSIONAL],\r\n    referenceImageDescription: \"Beam formwork with rebar cage visible, bottom tension bars, link stirrups, top bars, correct spacing visible throughout.\",\r\n  },\r\n\r\n  // Suspended Slab Scenarios\r\n  {\r\n    title: \"Suspended Floor Slab - Two-Way Reinforcement\",\r\n    description: \"Suspended reinforced concrete slab with two-way spanning reinforcement. Bottom bars in both directions plus top bars over supports.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"rebar\",\r\n    installationSteps: [\r\n      \"Complete propping and formwork installation\",\r\n      \"Position bottom bars in primary span direction on spacers\",\r\n      \"Install perpendicular bottom bars on top of primary bars\",\r\n      \"Install chair spacers for top reinforcement\",\r\n      \"Position top bars over columns and supports\",\r\n      \"Add additional top bars at openings and edges\",\r\n      \"Install edge reinforcement and U-bars\",\r\n      \"Tie all intersections\",\r\n      \"Check cover at all points - minimum 25mm internal, 40mm external\",\r\n      \"Final inspection and sign-off before pour\",\r\n    ],\r\n    requiredAccessories: [\"Spacers - 25mm cover\", \"Chair spacers - various heights\", \"Tie wire\", \"U-bars for edges\"],\r\n    roomTypes: [ROOM_TYPES.SUSPENDED],\r\n    styleTags: [STYLE_TAGS.COMMERCIAL, STYLE_TAGS.PROFESSIONAL],\r\n    referenceImageDescription: \"Suspended slab formwork with two-layer reinforcement, bottom bars crossed, chair spacers supporting top bars, workers checking levels.\",\r\n  },\r\n\r\n  // Spacer Application Scenarios\r\n  {\r\n    title: \"Correct Cover Maintenance with Spacers\",\r\n    description: \"Proper spacer installation to maintain concrete cover. Different spacer types for different applications - clips, chairs, and wheels.\",\r\n    scenarioType: SCENARIO_TYPES.APPLICATION,\r\n    productCategory: \"spacers\",\r\n    installationSteps: [\r\n      \"Determine required cover from drawings (typically 25-75mm)\",\r\n      \"Select appropriate spacer type - clips for horizontal bars, chairs for mesh support, wheels for vertical\",\r\n      \"Space spacers at maximum 500-600mm centers\",\r\n      \"Ensure spacers are on firm base (not soft ground or membrane)\",\r\n      \"Use additional spacers at heavy reinforcement concentrations\",\r\n      \"Check cover after reinforcement is complete\",\r\n      \"Add extra spacers if reinforcement has sagged or moved\",\r\n      \"Maintain cover at all external faces especially\",\r\n    ],\r\n    requiredAccessories: [\"Clip-on spacers\", \"Chair spacers\", \"Spacer wheels\", \"Heavy-duty spacers for commercial\"],\r\n    roomTypes: [ROOM_TYPES.FOUNDATION, ROOM_TYPES.SLAB, ROOM_TYPES.WALL],\r\n    styleTags: [STYLE_TAGS.DIY, STYLE_TAGS.PROFESSIONAL, STYLE_TAGS.GROUNDWORKS],\r\n    referenceImageDescription: \"Close-up of spacer installation showing clip-on spacer on rebar, chair spacer supporting mesh, correct cover visible against formwork.\",\r\n  },\r\n];\r\n\r\n/**\r\n * Seed installation scenarios\r\n */\r\nexport async function seedInstallationScenarios() {\r\n  console.log(\" Seeding NDS Installation Scenarios...\");\r\n\r\n  // Get first user (single-tenant for now)\r\n  const user = await db.query.users.findFirst();\r\n  if (!user) {\r\n    console.log(\" No users found. Create a user first.\");\r\n    return { created: 0, updated: 0, errors: 0 };\r\n  }\r\n\r\n  let created = 0;\r\n  let updated = 0;\r\n  let errors = 0;\r\n\r\n  for (const scenario of INSTALLATION_SCENARIOS) {\r\n    try {\r\n      // Check if scenario exists by title\r\n      const existing = await db.query.installationScenarios.findFirst({\r\n        where: eq(installationScenarios.title, scenario.title),\r\n      });\r\n\r\n      // Try to find primary product by category\r\n      const primaryProduct = await db.query.products.findFirst({\r\n        where: ilike(products.category, scenario.productCategory),\r\n      });\r\n\r\n      const scenarioRecord = {\r\n        userId: user.id,\r\n        title: scenario.title,\r\n        description: scenario.description,\r\n        scenarioType: scenario.scenarioType,\r\n        primaryProductId: primaryProduct?.id || null,\r\n        installationSteps: scenario.installationSteps,\r\n        requiredAccessories: scenario.requiredAccessories,\r\n        roomTypes: scenario.roomTypes,\r\n        styleTags: scenario.styleTags,\r\n        referenceImages: scenario.referenceImageDescription\r\n          ? [{ caption: scenario.referenceImageDescription }]\r\n          : null,\r\n        isActive: true,\r\n      };\r\n\r\n      if (existing) {\r\n        await db.update(installationScenarios)\r\n          .set(scenarioRecord)\r\n          .where(eq(installationScenarios.id, existing.id));\r\n        updated++;\r\n        console.log(`   Updated: ${scenario.title}`);\r\n      } else {\r\n        await db.insert(installationScenarios).values(scenarioRecord);\r\n        created++;\r\n        console.log(`   Created: ${scenario.title}`);\r\n      }\r\n    } catch (err) {\r\n      errors++;\r\n      console.error(`   Failed: ${scenario.title}`, err);\r\n    }\r\n  }\r\n\r\n  console.log(`\\n Installation Scenario seeding complete:`);\r\n  console.log(`   Created: ${created}`);\r\n  console.log(`   Updated: ${updated}`);\r\n  console.log(`   Errors: ${errors}`);\r\n\r\n  return { created, updated, errors };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedProducts.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":437,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":437,"endColumn":14,"suggestions":[{"fix":{"range":[16144,16203],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":438,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":438,"endColumn":14,"suggestions":[{"fix":{"range":[16207,16268],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":474,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":474,"endColumn":20,"suggestions":[{"fix":{"range":[17434,17483],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":478,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":478,"endColumn":20,"suggestions":[{"fix":{"range":[17587,17635],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":486,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":486,"endColumn":14,"suggestions":[{"fix":{"range":[17762,17807],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":487,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":487,"endColumn":14,"suggestions":[{"fix":{"range":[17811,17849],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":488,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":488,"endColumn":14,"suggestions":[{"fix":{"range":[17853,17891],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":489,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":489,"endColumn":14,"suggestions":[{"fix":{"range":[17895,17931],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":499,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":499,"endColumn":14,"suggestions":[{"fix":{"range":[18175,18244],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":519,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":519,"endColumn":16,"suggestions":[{"fix":{"range":[18791,18863],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":530,"column":11,"nodeType":"MemberExpression","messageId":"limited","endLine":530,"endColumn":22,"suggestions":[{"fix":{"range":[19177,19238],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":550,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":550,"endColumn":20,"suggestions":[{"fix":{"range":[19939,19993],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":561,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":561,"endColumn":14,"suggestions":[{"fix":{"range":[20277,20333],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":562,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":562,"endColumn":14,"suggestions":[{"fix":{"range":[20337,20375],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":563,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":563,"endColumn":14,"suggestions":[{"fix":{"range":[20379,20417],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":564,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":564,"endColumn":14,"suggestions":[{"fix":{"range":[20421,20457],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":573,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":573,"endColumn":14,"suggestions":[{"fix":{"range":[20723,20758],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":574,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":574,"endColumn":14,"suggestions":[{"fix":{"range":[20762,20797],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":575,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":575,"endColumn":14,"suggestions":[{"fix":{"range":[20801,20836],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedRelationships.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":322,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":322,"endColumn":14,"suggestions":[{"fix":{"range":[9251,9306],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":327,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":327,"endColumn":16,"suggestions":[{"fix":{"range":[9425,9480],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":341,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":341,"endColumn":16,"suggestions":[{"fix":{"range":[9811,9885],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":345,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":345,"endColumn":14,"suggestions":[{"fix":{"range":[9947,10006],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":357,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":357,"endColumn":20,"suggestions":[{"fix":{"range":[10266,10330],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":362,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":362,"endColumn":20,"suggestions":[{"fix":{"range":[10412,10476],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":377,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":377,"endColumn":20,"suggestions":[{"fix":{"range":[10913,10989],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":393,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":393,"endColumn":18,"suggestions":[{"fix":{"range":[11369,11450],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":400,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":400,"endColumn":14,"suggestions":[{"fix":{"range":[11585,11643],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":401,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":401,"endColumn":14,"suggestions":[{"fix":{"range":[11647,11685],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":402,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":402,"endColumn":14,"suggestions":[{"fix":{"range":[11689,11727],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":403,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":403,"endColumn":14,"suggestions":[{"fix":{"range":[11731,11767],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\seedTemplates.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'users' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"users"},"fix":{"range":[117,124],"text":""},"desc":"Remove unused variable \"users\"."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":492,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":492,"endColumn":14,"suggestions":[{"fix":{"range":[19011,19068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":497,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":497,"endColumn":16,"suggestions":[{"fix":{"range":[19163,19218],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":539,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":539,"endColumn":20,"suggestions":[{"fix":{"range":[20686,20732],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":543,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":543,"endColumn":20,"suggestions":[{"fix":{"range":[20850,20895],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":551,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":551,"endColumn":14,"suggestions":[{"fix":{"range":[21019,21076],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":552,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":552,"endColumn":14,"suggestions":[{"fix":{"range":[21080,21118],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":553,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":553,"endColumn":14,"suggestions":[{"fix":{"range":[21122,21160],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":554,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":554,"endColumn":14,"suggestions":[{"fix":{"range":[21164,21200],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":564,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":564,"endColumn":18,"suggestions":[{"fix":{"range":[21449,21483],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport \"dotenv/config\";\r\nimport { db } from \"../db\";\r\nimport { performingAdTemplates, users } from \"@shared/schema\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\n/**\r\n * Performing Ad Templates Seed for NDS (Next Day Steel)\r\n *\r\n * Populates high-performing ad templates based on construction industry patterns.\r\n * These are visual layouts and patterns that WORK for B2B construction ads.\r\n *\r\n * Sources researched:\r\n * - Construction industry LinkedIn ads\r\n * - B2B supply chain advertising patterns\r\n * - Industrial product photography conventions\r\n * - Trade publication advertising\r\n *\r\n * This answers: \"What visual pattern works for this type of ad?\"\r\n *\r\n * Usage:\r\n *   POST /api/admin/seed-templates\r\n */\r\n\r\n// Template Categories\r\nconst CATEGORIES = {\r\n  PRODUCT_SHOWCASE: \"product_showcase\",\r\n  TESTIMONIAL: \"testimonial\",\r\n  PROBLEM_SOLUTION: \"problem_solution\",\r\n  COMPARISON: \"comparison\",\r\n  URGENCY: \"urgency\",\r\n  EDUCATIONAL: \"educational\",\r\n  SOCIAL_PROOF: \"social_proof\",\r\n  BRAND_AWARENESS: \"brand_awareness\",\r\n} as const;\r\n\r\n// Template Moods\r\nconst MOODS = {\r\n  PROFESSIONAL: \"professional\",\r\n  INDUSTRIAL: \"industrial\",\r\n  TRUSTWORTHY: \"trustworthy\",\r\n  URGENT: \"urgent\",\r\n  HELPFUL: \"helpful\",\r\n  BOLD: \"bold\",\r\n} as const;\r\n\r\n// Template Styles\r\nconst STYLES = {\r\n  CLEAN: \"clean\",\r\n  MODERN: \"modern\",\r\n  INDUSTRIAL: \"industrial\",\r\n  MINIMAL: \"minimal\",\r\n  BOLD: \"bold\",\r\n  SPLIT: \"split\",\r\n} as const;\r\n\r\n/**\r\n * High-Performing Ad Template Patterns\r\n *\r\n * Each template includes:\r\n * - Visual layout structure\r\n * - Color palette recommendations\r\n * - Typography patterns\r\n * - Content block positioning\r\n * - Platform targeting\r\n */\r\nconst PERFORMING_TEMPLATES = [\r\n  // Product Showcase Templates\r\n  {\r\n    name: \"Hero Product - Industrial Clean\",\r\n    description: \"Large product hero shot with industrial backdrop. Clean typography, minimal distractions. Works for rebar, mesh, spacers.\",\r\n    category: CATEGORIES.PRODUCT_SHOWCASE,\r\n    mood: MOODS.PROFESSIONAL,\r\n    style: STYLES.CLEAN,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"single-hero\", primaryFocusArea: \"center\" },\r\n      { platform: \"facebook\", aspectRatio: \"1:1\", gridStructure: \"single-hero\", primaryFocusArea: \"center\" },\r\n      { platform: \"linkedin\", aspectRatio: \"1.91:1\", gridStructure: \"single-hero\", primaryFocusArea: \"center-left\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\", // NDS Orange\r\n      secondary: \"#1A1A1A\", // Black\r\n      accent: \"#7A7A7A\", // Steel Grey\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"high\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, industrial\",\r\n      headlineSize: \"large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"large\",\r\n    },\r\n    backgroundType: \"image\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-left\", maxChars: 50, placeholder: \"{{PRODUCT_NAME}} - {{KEY_BENEFIT}}\" },\r\n      body: { position: \"bottom-left\", maxChars: 100, placeholder: \"{{FEATURES}} | {{CERTIFICATION}}\" },\r\n      cta: { position: \"bottom-right\", text: \"Order Now \" },\r\n    },\r\n    visualPatterns: [\"large-product-center\", \"industrial-background\", \"high-contrast-text\", \"minimal-elements\"],\r\n    targetPlatforms: [\"instagram\", \"facebook\", \"linkedin\"],\r\n    targetAspectRatios: [\"1:1\", \"1.91:1\"],\r\n    bestForIndustries: [\"construction\", \"manufacturing\", \"industrial-supplies\"],\r\n    bestForObjectives: [\"awareness\", \"consideration\"],\r\n    engagementTier: \"top-10\",\r\n  },\r\n  {\r\n    name: \"Product Stack - Quantity Display\",\r\n    description: \"Stacked product display showing volume/quantity available. Emphasizes stock levels and capacity. Good for bulk messaging.\",\r\n    category: CATEGORIES.PRODUCT_SHOWCASE,\r\n    mood: MOODS.INDUSTRIAL,\r\n    style: STYLES.INDUSTRIAL,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"4:5\", gridStructure: \"full-bleed\", primaryFocusArea: \"center\" },\r\n      { platform: \"linkedin\", aspectRatio: \"1:1\", gridStructure: \"full-bleed\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#2D2D2D\",\r\n      accent: \"#7A7A7A\",\r\n      background: \"#1A1A1A\",\r\n      text: \"#FFFFFF\",\r\n      contrast: \"high\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, bold\",\r\n      headlineSize: \"extra-large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"large\",\r\n    },\r\n    backgroundType: \"image\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-center\", maxChars: 30, placeholder: \"{{QUANTITY}} IN STOCK\" },\r\n      body: { position: \"bottom-center\", maxChars: 80, placeholder: \"{{PRODUCT_RANGE}} ready for next-day delivery\" },\r\n      cta: { position: \"bottom-center\", text: \"Check Stock \" },\r\n    },\r\n    visualPatterns: [\"stacked-products\", \"dark-background\", \"quantity-emphasis\", \"industrial-lighting\"],\r\n    targetPlatforms: [\"instagram\", \"linkedin\"],\r\n    targetAspectRatios: [\"1:1\", \"4:5\"],\r\n    bestForIndustries: [\"construction\", \"wholesale\", \"industrial-supplies\"],\r\n    bestForObjectives: [\"awareness\", \"consideration\"],\r\n    engagementTier: \"top-25\",\r\n  },\r\n\r\n  // Urgency/Next-Day Templates\r\n  {\r\n    name: \"Next-Day Promise - Bold CTA\",\r\n    description: \"Time-sensitive messaging with bold typography. Emphasizes speed and reliability. Orange accent on time element.\",\r\n    category: CATEGORIES.URGENCY,\r\n    mood: MOODS.URGENT,\r\n    style: STYLES.BOLD,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"text-overlay\", primaryFocusArea: \"center\" },\r\n      { platform: \"facebook\", aspectRatio: \"1.91:1\", gridStructure: \"text-overlay\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#FFFFFF\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#1A1A1A\",\r\n      text: \"#FFFFFF\",\r\n      contrast: \"maximum\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, extra-bold\",\r\n      headlineSize: \"extra-large\",\r\n      bodySize: \"large\",\r\n      ctaSize: \"extra-large\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"center\", maxChars: 40, placeholder: \"ORDER BY 1PM\" },\r\n      body: { position: \"center-below-headline\", maxChars: 30, placeholder: \"DELIVERED TOMORROW\" },\r\n      cta: { position: \"bottom-center\", text: \"Order Now\" },\r\n    },\r\n    visualPatterns: [\"bold-typography\", \"dark-background\", \"orange-accent\", \"time-emphasis\"],\r\n    targetPlatforms: [\"instagram\", \"facebook\", \"twitter\"],\r\n    targetAspectRatios: [\"1:1\", \"1.91:1\"],\r\n    bestForIndustries: [\"construction\", \"delivery\", \"supplies\"],\r\n    bestForObjectives: [\"conversion\"],\r\n    engagementTier: \"top-5\",\r\n  },\r\n  {\r\n    name: \"Clock Countdown - Urgency Driver\",\r\n    description: \"Visual clock or time element with countdown urgency. Creates FOMO for delivery cutoff. High conversion rates.\",\r\n    category: CATEGORIES.URGENCY,\r\n    mood: MOODS.URGENT,\r\n    style: STYLES.MODERN,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"icon-centered\", primaryFocusArea: \"center\" },\r\n      { platform: \"facebook\", aspectRatio: \"1:1\", gridStructure: \"icon-centered\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"high\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, bold\",\r\n      headlineSize: \"large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"large\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-center\", maxChars: 30, placeholder: \" {{TIME}} LEFT\" },\r\n      body: { position: \"center\", maxChars: 50, placeholder: \"Order now for next-day delivery\" },\r\n      cta: { position: \"bottom-center\", text: \"Beat the Clock \" },\r\n    },\r\n    visualPatterns: [\"clock-icon\", \"countdown\", \"orange-highlight\", \"clean-background\"],\r\n    targetPlatforms: [\"instagram\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"delivery\", \"ecommerce\"],\r\n    bestForObjectives: [\"conversion\"],\r\n    engagementTier: \"top-10\",\r\n  },\r\n\r\n  // Problem-Solution Templates\r\n  {\r\n    name: \"Before/After Split - Installation\",\r\n    description: \"Split-screen showing problem (empty site) vs solution (reinforced site). Powerful for installation context.\",\r\n    category: CATEGORIES.PROBLEM_SOLUTION,\r\n    mood: MOODS.HELPFUL,\r\n    style: STYLES.SPLIT,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"split-vertical\", primaryFocusArea: \"both\" },\r\n      { platform: \"linkedin\", aspectRatio: \"1.91:1\", gridStructure: \"split-horizontal\", primaryFocusArea: \"both\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#4CAF50\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"medium\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, medium\",\r\n      headlineSize: \"medium\",\r\n      bodySize: \"small\",\r\n      ctaSize: \"medium\",\r\n    },\r\n    backgroundType: \"image\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-center\", maxChars: 40, placeholder: \"Before | After\" },\r\n      body: { position: \"bottom-center\", maxChars: 60, placeholder: \"Professional reinforcement makes the difference\" },\r\n      cta: { position: \"bottom-right\", text: \"Get Started \" },\r\n    },\r\n    visualPatterns: [\"split-screen\", \"before-after\", \"transformation\", \"site-photos\"],\r\n    targetPlatforms: [\"instagram\", \"linkedin\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\", \"1.91:1\"],\r\n    bestForIndustries: [\"construction\", \"renovation\", \"contracting\"],\r\n    bestForObjectives: [\"consideration\", \"conversion\"],\r\n    engagementTier: \"top-10\",\r\n  },\r\n  {\r\n    name: \"Pain Point Call-Out\",\r\n    description: \"Direct addressing of customer pain point with solution. Question headline format, clear answer below.\",\r\n    category: CATEGORIES.PROBLEM_SOLUTION,\r\n    mood: MOODS.HELPFUL,\r\n    style: STYLES.CLEAN,\r\n    layouts: [\r\n      { platform: \"linkedin\", aspectRatio: \"1:1\", gridStructure: \"text-heavy\", primaryFocusArea: \"top\" },\r\n      { platform: \"facebook\", aspectRatio: \"1:1\", gridStructure: \"text-heavy\", primaryFocusArea: \"top\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#F5F5F5\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"medium\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, regular\",\r\n      headlineSize: \"large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"large\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-center\", maxChars: 50, placeholder: \"Supplier let you down again?\" },\r\n      body: { position: \"center\", maxChars: 100, placeholder: \"We guarantee next-day delivery. Order by 1pm, on-site tomorrow.\" },\r\n      cta: { position: \"bottom-center\", text: \"Never Miss a Pour \" },\r\n    },\r\n    visualPatterns: [\"question-headline\", \"answer-body\", \"empathy-driven\", \"solution-focus\"],\r\n    targetPlatforms: [\"linkedin\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"supplies\", \"b2b-services\"],\r\n    bestForObjectives: [\"awareness\", \"consideration\"],\r\n    engagementTier: \"top-25\",\r\n  },\r\n\r\n  // Social Proof Templates\r\n  {\r\n    name: \"Testimonial Card - Contractor Quote\",\r\n    description: \"Customer testimonial with photo and quote. Professional contractor perspective. Trust-building format.\",\r\n    category: CATEGORIES.TESTIMONIAL,\r\n    mood: MOODS.TRUSTWORTHY,\r\n    style: STYLES.CLEAN,\r\n    layouts: [\r\n      { platform: \"linkedin\", aspectRatio: \"1:1\", gridStructure: \"testimonial-card\", primaryFocusArea: \"center\" },\r\n      { platform: \"facebook\", aspectRatio: \"1:1\", gridStructure: \"testimonial-card\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#1A1A1A\",\r\n      secondary: \"#FF6B35\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"medium\",\r\n    },\r\n    typography: {\r\n      fontStack: \"serif, quotes / sans-serif, body\",\r\n      headlineSize: \"large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"medium\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"center\", maxChars: 150, placeholder: \"\\\"{{TESTIMONIAL_QUOTE}}\\\"\" },\r\n      body: { position: \"bottom-center\", maxChars: 50, placeholder: \"{{NAME}}, {{COMPANY}}\" },\r\n      cta: { position: \"bottom-center\", text: \"Join 1000+ Contractors \" },\r\n    },\r\n    visualPatterns: [\"quote-marks\", \"customer-photo\", \"clean-background\", \"trust-signals\"],\r\n    targetPlatforms: [\"linkedin\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"b2b-services\", \"supplies\"],\r\n    bestForObjectives: [\"awareness\", \"consideration\"],\r\n    engagementTier: \"top-10\",\r\n  },\r\n  {\r\n    name: \"Stats & Numbers - Trust Building\",\r\n    description: \"Large numbers/statistics as visual anchor. Deliveries made, customers served, years in business.\",\r\n    category: CATEGORIES.SOCIAL_PROOF,\r\n    mood: MOODS.TRUSTWORTHY,\r\n    style: STYLES.BOLD,\r\n    layouts: [\r\n      { platform: \"linkedin\", aspectRatio: \"1.91:1\", gridStructure: \"stats-row\", primaryFocusArea: \"center\" },\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"stats-grid\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#1A1A1A\",\r\n      text: \"#FFFFFF\",\r\n      contrast: \"high\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, extra-bold\",\r\n      headlineSize: \"extra-large\",\r\n      bodySize: \"small\",\r\n      ctaSize: \"medium\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"center\", maxChars: 30, placeholder: \"10,000+\" },\r\n      body: { position: \"below-headline\", maxChars: 40, placeholder: \"Deliveries Made This Year\" },\r\n      cta: { position: \"bottom-center\", text: \"Be Next \" },\r\n    },\r\n    visualPatterns: [\"large-numbers\", \"stats-focus\", \"dark-background\", \"orange-accent\"],\r\n    targetPlatforms: [\"linkedin\", \"instagram\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\", \"1.91:1\"],\r\n    bestForIndustries: [\"construction\", \"logistics\", \"b2b-services\"],\r\n    bestForObjectives: [\"awareness\"],\r\n    engagementTier: \"top-25\",\r\n  },\r\n\r\n  // Educational Templates\r\n  {\r\n    name: \"How-To Carousel - Installation Steps\",\r\n    description: \"Step-by-step installation guide format. Numbered steps, clear visuals. High save/share rates.\",\r\n    category: CATEGORIES.EDUCATIONAL,\r\n    mood: MOODS.HELPFUL,\r\n    style: STYLES.CLEAN,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"carousel-step\", primaryFocusArea: \"center\" },\r\n      { platform: \"linkedin\", aspectRatio: \"1:1\", gridStructure: \"carousel-step\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"medium\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, medium\",\r\n      headlineSize: \"medium\",\r\n      bodySize: \"small\",\r\n      ctaSize: \"medium\",\r\n    },\r\n    backgroundType: \"image\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-left\", maxChars: 30, placeholder: \"Step {{NUMBER}}\" },\r\n      body: { position: \"bottom-left\", maxChars: 80, placeholder: \"{{STEP_DESCRIPTION}}\" },\r\n      cta: { position: \"bottom-right\", text: \"Swipe \" },\r\n    },\r\n    visualPatterns: [\"numbered-steps\", \"carousel-format\", \"instruction-focus\", \"process-visualization\"],\r\n    targetPlatforms: [\"instagram\", \"linkedin\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"diy\", \"trades\"],\r\n    bestForObjectives: [\"engagement\", \"awareness\"],\r\n    engagementTier: \"top-5\",\r\n  },\r\n  {\r\n    name: \"Specification Card - Technical Info\",\r\n    description: \"Technical specification display with clean layout. BS numbers, CARES certification, dimensions.\",\r\n    category: CATEGORIES.EDUCATIONAL,\r\n    mood: MOODS.PROFESSIONAL,\r\n    style: STYLES.MINIMAL,\r\n    layouts: [\r\n      { platform: \"linkedin\", aspectRatio: \"1:1\", gridStructure: \"spec-card\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#1A1A1A\",\r\n      secondary: \"#7A7A7A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"medium\",\r\n    },\r\n    typography: {\r\n      fontStack: \"monospace, specs / sans-serif, labels\",\r\n      headlineSize: \"medium\",\r\n      bodySize: \"small\",\r\n      ctaSize: \"medium\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-left\", maxChars: 40, placeholder: \"{{PRODUCT_NAME}} Specifications\" },\r\n      body: { position: \"center\", maxChars: 200, placeholder: \"{{SPECS_LIST}}\" },\r\n      cta: { position: \"bottom-center\", text: \"View Full Specs \" },\r\n    },\r\n    visualPatterns: [\"technical-layout\", \"spec-table\", \"certification-badges\", \"clean-minimal\"],\r\n    targetPlatforms: [\"linkedin\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"engineering\", \"industrial\"],\r\n    bestForObjectives: [\"consideration\"],\r\n    engagementTier: \"top-25\",\r\n  },\r\n\r\n  // No Minimum Order Templates\r\n  {\r\n    name: \"Single Item Highlight - Accessibility\",\r\n    description: \"Single product item emphasized to show no minimum order. '1 Bar or 1000' messaging. Inclusive positioning.\",\r\n    category: CATEGORIES.BRAND_AWARENESS,\r\n    mood: MOODS.HELPFUL,\r\n    style: STYLES.MINIMAL,\r\n    layouts: [\r\n      { platform: \"instagram\", aspectRatio: \"1:1\", gridStructure: \"single-item\", primaryFocusArea: \"center\" },\r\n      { platform: \"facebook\", aspectRatio: \"1:1\", gridStructure: \"single-item\", primaryFocusArea: \"center\" },\r\n    ],\r\n    colorPalette: {\r\n      primary: \"#FF6B35\",\r\n      secondary: \"#1A1A1A\",\r\n      accent: \"#FF6B35\",\r\n      background: \"#FFFFFF\",\r\n      text: \"#1A1A1A\",\r\n      contrast: \"high\",\r\n    },\r\n    typography: {\r\n      fontStack: \"sans-serif, bold\",\r\n      headlineSize: \"large\",\r\n      bodySize: \"medium\",\r\n      ctaSize: \"large\",\r\n    },\r\n    backgroundType: \"solid\",\r\n    contentBlocks: {\r\n      headline: { position: \"top-center\", maxChars: 30, placeholder: \"1 Bar or 1,000\" },\r\n      body: { position: \"bottom-center\", maxChars: 50, placeholder: \"No minimum orders. Ever.\" },\r\n      cta: { position: \"bottom-center\", text: \"Order Your Quantity \" },\r\n    },\r\n    visualPatterns: [\"single-product\", \"quantity-range\", \"inclusive-messaging\", \"clean-background\"],\r\n    targetPlatforms: [\"instagram\", \"facebook\"],\r\n    targetAspectRatios: [\"1:1\"],\r\n    bestForIndustries: [\"construction\", \"supplies\", \"wholesale\"],\r\n    bestForObjectives: [\"awareness\", \"conversion\"],\r\n    engagementTier: \"top-10\",\r\n  },\r\n];\r\n\r\n/**\r\n * Seed performing ad templates\r\n */\r\nexport async function seedPerformingTemplates() {\r\n  console.log(\" Seeding NDS Performing Ad Templates...\");\r\n\r\n  // Get first user\r\n  const user = await db.query.users.findFirst();\r\n  if (!user) {\r\n    console.log(\" No users found. Create a user first.\");\r\n    return { created: 0, updated: 0, errors: 0 };\r\n  }\r\n\r\n  let created = 0;\r\n  let updated = 0;\r\n  let errors = 0;\r\n\r\n  for (const template of PERFORMING_TEMPLATES) {\r\n    try {\r\n      // Check if template exists by name\r\n      const existing = await db.query.performingAdTemplates.findFirst({\r\n        where: eq(performingAdTemplates.name, template.name),\r\n      });\r\n\r\n      const templateRecord = {\r\n        userId: user.id,\r\n        name: template.name,\r\n        description: template.description,\r\n        category: template.category,\r\n        mood: template.mood,\r\n        style: template.style,\r\n        layouts: template.layouts,\r\n        colorPalette: template.colorPalette,\r\n        typography: template.typography,\r\n        backgroundType: template.backgroundType,\r\n        contentBlocks: template.contentBlocks,\r\n        visualPatterns: template.visualPatterns,\r\n        targetPlatforms: template.targetPlatforms,\r\n        targetAspectRatios: template.targetAspectRatios,\r\n        bestForIndustries: template.bestForIndustries,\r\n        bestForObjectives: template.bestForObjectives,\r\n        engagementTier: template.engagementTier,\r\n        isActive: true,\r\n        isFeatured: template.engagementTier === \"top-5\",\r\n      };\r\n\r\n      if (existing) {\r\n        await db.update(performingAdTemplates)\r\n          .set({ ...templateRecord, updatedAt: new Date() })\r\n          .where(eq(performingAdTemplates.id, existing.id));\r\n        updated++;\r\n        console.log(`   Updated: ${template.name}`);\r\n      } else {\r\n        await db.insert(performingAdTemplates).values(templateRecord);\r\n        created++;\r\n        console.log(`   Created: ${template.name}`);\r\n      }\r\n    } catch (err) {\r\n      errors++;\r\n      console.error(`   Failed: ${template.name}`, err);\r\n    }\r\n  }\r\n\r\n  console.log(`\\n Performing Template seeding complete:`);\r\n  console.log(`   Created: ${created}`);\r\n  console.log(`   Updated: ${updated}`);\r\n  console.log(`   Errors: ${errors}`);\r\n\r\n  return { created, updated, errors };\r\n}\r\n\r\n// Run if called directly (check for CLI execution)\r\nconst isMainModule = process.argv[1]?.includes('seedTemplates');\r\nif (isMainModule) {\r\n  seedPerformingTemplates()\r\n    .then((result) => {\r\n      console.log(\"\\n Done!\", result);\r\n      process.exit(0);\r\n    })\r\n    .catch((err) => {\r\n      console.error(\" Seed failed:\", err);\r\n      process.exit(1);\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\updatePerformingTemplateImages.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":81,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":81,"endColumn":14,"suggestions":[{"fix":{"range":[4393,4476],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":86,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":86,"endColumn":16,"suggestions":[{"fix":{"range":[4600,4674],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":105,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":105,"endColumn":18,"suggestions":[{"fix":{"range":[5263,5320],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":109,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":109,"endColumn":16,"suggestions":[{"fix":{"range":[5353,5431],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\seeds\\updateTemplateImages.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":63,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":63,"endColumn":14,"suggestions":[{"fix":{"range":[3303,3378],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":68,"endColumn":16,"suggestions":[{"fix":{"range":[3486,3549],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":77,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":77,"endColumn":20,"suggestions":[{"fix":{"range":[3765,3819],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":92,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":92,"endColumn":18,"suggestions":[{"fix":{"range":[4238,4296],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":96,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":96,"endColumn":16,"suggestions":[{"fix":{"range":[4329,4396],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\agentDefinition.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\agentRunner.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\tools\\copyTools.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2094,2097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2094,2097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2267,2270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2267,2270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4363,4366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4363,4366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4460,4463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4460,4463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4577,4580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4577,4580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4733,4736],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4733,4736],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Agent Tools  Copywriting & Ideas\r\n * Tools for generating ad copy and getting AI suggestions\r\n */\r\n\r\nimport { FunctionTool } from '@google/adk';\r\nimport type { ToolContext } from '@google/adk';\r\nimport { z } from 'zod';\r\nimport { logger } from '../../../lib/logger';\r\n\r\nexport function createCopyTools() {\r\n  const generateAdCopy = new FunctionTool({\r\n    name: 'generate_ad_copy',\r\n    description:\r\n      'Generate ad copy (headline, body, CTA, hashtags) for a product on a specific social media platform. Returns multiple variations with quality scores.',\r\n    parameters: z.object({\r\n      platform: z.enum(['instagram', 'linkedin', 'facebook', 'twitter', 'tiktok']).describe('Target platform'),\r\n      productName: z.string().describe('Product name'),\r\n      productDescription: z.string().describe('Brief product description'),\r\n      industry: z.string().optional().describe('Industry/vertical (default: general)'),\r\n      tone: z\r\n        .enum(['professional', 'casual', 'technical', 'urgent', 'minimal', 'authentic'])\r\n        .optional()\r\n        .describe('Tone of voice (default: professional)'),\r\n      framework: z\r\n        .enum(['aida', 'pas', 'bab', 'fab', 'auto'])\r\n        .optional()\r\n        .describe('Copywriting framework (default: auto)'),\r\n      variations: z.number().min(1).max(5).optional().describe('Number of variations (default 3)'),\r\n    }),\r\n    execute: async (input, _tool_context?: ToolContext) => {\r\n      try {\r\n        const { copywritingService } = await import('../../copywritingService');\r\n        const { randomUUID } = await import('node:crypto');\r\n        const results = await copywritingService.generateCopy({\r\n          generationId: randomUUID(),\r\n          platform: input.platform,\r\n          productName: input.productName,\r\n          productDescription: input.productDescription,\r\n          industry: input.industry ?? 'general',\r\n          tone: input.tone ?? 'professional',\r\n          framework: input.framework ?? 'auto',\r\n          campaignObjective: 'engagement',\r\n          variations: input.variations ?? 3,\r\n        } as any);\r\n\r\n        return {\r\n          status: 'success',\r\n          uiActions: [{ type: 'copy_generated', payload: { copies: results } }],\r\n          copies: results.map((c: any) => ({\r\n            headline: c.headline,\r\n            hook: c.hook,\r\n            bodyText: c.bodyText,\r\n            cta: c.cta,\r\n            caption: c.caption,\r\n            hashtags: c.hashtags,\r\n            framework: c.framework,\r\n            qualityScore: c.qualityScore?.overallScore,\r\n          })),\r\n          message: `Generated ${results.length} ad copy variation(s) for ${input.platform}`,\r\n        };\r\n      } catch (err: unknown) {\r\n        logger.error({ module: 'AgentTools', err }, 'Ad copy generation error');\r\n        return { status: 'error', message: 'Failed to generate ad copy. Please try again.' };\r\n      }\r\n    },\r\n  });\r\n\r\n  const getIdeaSuggestions = new FunctionTool({\r\n    name: 'get_idea_suggestions',\r\n    description:\r\n      'Get AI-powered creative suggestions for ad generation based on selected products. Returns prompt ideas with confidence scores.',\r\n    parameters: z.object({\r\n      productId: z.string().optional().describe('Product ID to get suggestions for'),\r\n      userGoal: z\r\n        .string()\r\n        .optional()\r\n        .describe('What the user wants to achieve (e.g. \"increase sales\", \"brand awareness\")'),\r\n      maxSuggestions: z.number().min(1).max(5).optional().describe('Number of suggestions (default 3)'),\r\n    }),\r\n    execute: async (input, tool_context?: ToolContext) => {\r\n      const userId = tool_context?.state?.get<string>('authenticatedUserId');\r\n      if (!userId) {\r\n        return { status: 'error', message: 'Authentication required. Please refresh the page and try again.' };\r\n      }\r\n\r\n      try {\r\n        const { ideaBankService } = await import('../../ideaBankService');\r\n\r\n        // Build request, only including defined properties\r\n        const request: Record<string, unknown> = {\r\n          userId,\r\n          maxSuggestions: input.maxSuggestions ?? 3,\r\n        };\r\n        if (input.productId !== undefined) request['productId'] = input.productId;\r\n        if (input.userGoal !== undefined) request['userGoal'] = input.userGoal;\r\n\r\n        const result = await ideaBankService.generateSuggestions(request as any);\r\n\r\n        if (!result.success) {\r\n          return { status: 'error', message: (result as any).error?.message ?? 'Failed to generate suggestions' };\r\n        }\r\n\r\n        const response = result.response as any;\r\n        const suggestions = response.suggestions ?? [];\r\n\r\n        return {\r\n          status: 'success',\r\n          suggestions: suggestions.map((s: any) => ({\r\n            summary: s.summary,\r\n            prompt: s.prompt,\r\n            confidence: s.confidence,\r\n            mode: s.mode,\r\n            recommendedPlatform: s.recommendedPlatform,\r\n          })),\r\n          message: `Generated ${suggestions.length} creative suggestion(s)`,\r\n        };\r\n      } catch (err: unknown) {\r\n        logger.error({ module: 'AgentTools', err, userId }, 'Idea suggestions error');\r\n        return { status: 'error', message: 'Failed to generate suggestions. Please try again.' };\r\n      }\r\n    },\r\n  });\r\n\r\n  return [generateAdCopy, getIdeaSuggestions];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\tools\\generationTools.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\tools\\knowledgeTools.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\tools\\productTools.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\agent\\tools\\schedulingTools.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\apiKeyValidationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\approvalQueueService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\authService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\brandDNAService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6089,6092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6089,6092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6107,6110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6107,6110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6127,6130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6127,6130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8643,8646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8643,8646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8662,8665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8662,8665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8982,8985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8982,8985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9077,9080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9077,9080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9272,9275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9272,9275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9291,9294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9291,9294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":253,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9657,9660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9657,9660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9779,9782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9779,9782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Brand DNA Service\r\n *\r\n * Analyzes brand data to build a persistent \"brand understanding\" that enriches\r\n * every generation. Examines brand profile, brand images, successful generations,\r\n * and brand voice settings to extract:\r\n *\r\n * - Visual Signature: dominant colors, composition style, lighting preferences\r\n * - Tone Analysis: formality, humor, technical depth, emotional register\r\n * - Audience Profile: engagement patterns, content preferences\r\n * - Content Rules: auto-learned do's and don'ts from high-scoring generations\r\n *\r\n * The resulting Brand DNA is stored per-user and injected into generation prompts\r\n * via Stage 3 (Brand Context) of the generation pipeline.\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport type { IStorage } from '../storage';\r\nimport type { BrandDNA } from '@shared/schema';\r\n\r\nconst BRAND_DNA_MODEL = 'gemini-3-flash';\r\n\r\n/**\r\n * Analyze a user's brand data and build/update their Brand DNA profile.\r\n *\r\n * Steps:\r\n * 1. Fetch brand profile (name, styles, values, colors, voice)\r\n * 2. Fetch recent successful generations (for pattern analysis)\r\n * 3. Fetch brand images (for visual signature)\r\n * 4. Use Gemini Flash to analyze patterns\r\n * 5. Upsert results to brandDNA table\r\n */\r\nexport async function analyzeBrandDNA(userId: string, storage: IStorage): Promise<BrandDNA> {\r\n  logger.info({ module: 'BrandDNAService', userId }, 'Starting Brand DNA analysis');\r\n\r\n  // 1. Fetch brand profile\r\n  const brandProfile = await storage.getBrandProfileByUserId(userId);\r\n\r\n  // 2. Fetch recent successful generations (last 20)\r\n  const recentGenerations = await storage.getGenerations(20, 0);\r\n  const userGenerations = recentGenerations.filter((g) => g.userId === userId && g.status === 'completed');\r\n\r\n  // 3. Fetch brand images\r\n  const brandImages = await storage.getBrandImagesByCategory(userId, 'historical_ad');\r\n  const productHeroImages = await storage.getBrandImagesByCategory(userId, 'product_hero');\r\n  const allBrandImages = [...brandImages, ...productHeroImages];\r\n\r\n  // 4. Build analysis prompt\r\n  const analysisPrompt = buildAnalysisPrompt(brandProfile, userGenerations, allBrandImages);\r\n\r\n  // 5. Call Gemini Flash for analysis\r\n  let analysisResult: Record<string, unknown> = {};\r\n\r\n  try {\r\n    const result = await generateContentWithRetry(\r\n      {\r\n        model: BRAND_DNA_MODEL,\r\n        contents: [\r\n          {\r\n            role: 'user',\r\n            parts: [{ text: analysisPrompt }],\r\n          },\r\n        ],\r\n        config: {\r\n          responseMimeType: 'application/json',\r\n        },\r\n      },\r\n      { operation: 'brand_dna_analysis' },\r\n    );\r\n\r\n    const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text;\r\n    if (responseText) {\r\n      analysisResult = JSON.parse(responseText);\r\n    }\r\n  } catch (err) {\r\n    logger.warn({ module: 'BrandDNAService', err }, 'Gemini analysis failed  using extracted data only');\r\n    // Fall back to basic extraction without AI\r\n    analysisResult = extractBasicBrandDNA(brandProfile, userGenerations);\r\n  }\r\n\r\n  // 6. Upsert to brandDNA table\r\n  const dna = await storage.upsertBrandDNA(userId, {\r\n    visualSignature: analysisResult.visualSignature ?? extractVisualSignature(brandProfile, allBrandImages),\r\n    toneAnalysis: analysisResult.toneAnalysis ?? extractToneAnalysis(brandProfile),\r\n    audienceProfile: analysisResult.audienceProfile ?? null,\r\n    competitorDiff: analysisResult.competitorDiff ?? null,\r\n    contentRules: analysisResult.contentRules ?? null,\r\n  });\r\n\r\n  logger.info({ module: 'BrandDNAService', userId, version: dna.version }, 'Brand DNA analysis completed');\r\n\r\n  return dna;\r\n}\r\n\r\n/**\r\n * Get a text block of Brand DNA context suitable for injection into generation prompts.\r\n * If no Brand DNA exists for the user, returns an empty string.\r\n */\r\nexport async function getBrandDNAContext(userId: string, storage: IStorage): Promise<string> {\r\n  const dna = await storage.getBrandDNA(userId);\r\n  if (!dna) return '';\r\n\r\n  const sections: string[] = [];\r\n\r\n  // Visual Signature\r\n  const visual = dna.visualSignature as Record<string, unknown> | null;\r\n  if (visual) {\r\n    const parts: string[] = [];\r\n    if (visual.dominantColors) parts.push(`Dominant Colors: ${formatValue(visual.dominantColors)}`);\r\n    if (visual.compositionStyle) parts.push(`Composition Style: ${visual.compositionStyle}`);\r\n    if (visual.lightingPreference) parts.push(`Lighting: ${visual.lightingPreference}`);\r\n    if (visual.typography) parts.push(`Typography: ${visual.typography}`);\r\n    if (parts.length > 0) {\r\n      sections.push(`Visual Signature:\\n${parts.map((p) => `  - ${p}`).join('\\n')}`);\r\n    }\r\n  }\r\n\r\n  // Tone Analysis\r\n  const tone = dna.toneAnalysis as Record<string, unknown> | null;\r\n  if (tone) {\r\n    const parts: string[] = [];\r\n    if (tone.formality) parts.push(`Formality: ${tone.formality}`);\r\n    if (tone.humorLevel) parts.push(`Humor: ${tone.humorLevel}`);\r\n    if (tone.technicalDepth) parts.push(`Technical Depth: ${tone.technicalDepth}`);\r\n    if (tone.emotionalRegister) parts.push(`Emotional Register: ${tone.emotionalRegister}`);\r\n    if (parts.length > 0) {\r\n      sections.push(`Brand Tone:\\n${parts.map((p) => `  - ${p}`).join('\\n')}`);\r\n    }\r\n  }\r\n\r\n  // Content Rules\r\n  const rules = dna.contentRules as Record<string, unknown> | null;\r\n  if (rules) {\r\n    const parts: string[] = [];\r\n    if (Array.isArray(rules.doList)) {\r\n      parts.push(`DO: ${rules.doList.join(', ')}`);\r\n    }\r\n    if (Array.isArray(rules.dontList)) {\r\n      parts.push(`DON'T: ${rules.dontList.join(', ')}`);\r\n    }\r\n    if (parts.length > 0) {\r\n      sections.push(`Content Rules:\\n${parts.map((p) => `  - ${p}`).join('\\n')}`);\r\n    }\r\n  }\r\n\r\n  if (sections.length === 0) return '';\r\n\r\n  return `\\nBRAND DNA INSIGHTS (v${dna.version}):\\n${sections.join('\\n')}`;\r\n}\r\n\r\n// ============================================\r\n// INTERNAL HELPERS\r\n// ============================================\r\n\r\nfunction buildAnalysisPrompt(brandProfile: any, generations: any[], brandImages: any[]): string {\r\n  const brandContext = brandProfile\r\n    ? `Brand Name: ${brandProfile.brandName || 'Unknown'}\r\nIndustry: ${brandProfile.industry || 'Unknown'}\r\nValues: ${(brandProfile.brandValues || []).join(', ')}\r\nPreferred Styles: ${(brandProfile.preferredStyles || []).join(', ')}\r\nColor Preferences: ${(brandProfile.colorPreferences || []).join(', ')}\r\nVoice Principles: ${JSON.stringify(brandProfile.voice || {})}\r\nTarget Audience: ${JSON.stringify(brandProfile.targetAudience || {})}`\r\n    : 'No brand profile available.';\r\n\r\n  const generationContext =\r\n    generations.length > 0\r\n      ? `Recent Generation Prompts (${generations.length} total):\r\n${generations\r\n  .slice(0, 10)\r\n  .map((g, i) => `  ${i + 1}. \"${g.prompt.slice(0, 200)}\"`)\r\n  .join('\\n')}`\r\n      : 'No generation history available.';\r\n\r\n  const imageContext =\r\n    brandImages.length > 0\r\n      ? `Brand Images: ${brandImages.length} images available across categories: ${[...new Set(brandImages.map((img) => img.category))].join(', ')}`\r\n      : 'No brand images available.';\r\n\r\n  return `Analyze this brand's data and extract a Brand DNA profile. Return a JSON object with these exact keys:\r\n\r\n{\r\n  \"visualSignature\": {\r\n    \"dominantColors\": [\"color1\", \"color2\", \"color3\"],\r\n    \"compositionStyle\": \"description of typical composition approach\",\r\n    \"lightingPreference\": \"description of preferred lighting\",\r\n    \"typography\": \"description of typography tendencies\"\r\n  },\r\n  \"toneAnalysis\": {\r\n    \"formality\": \"formal | semi-formal | casual\",\r\n    \"humorLevel\": \"none | subtle | moderate | frequent\",\r\n    \"technicalDepth\": \"basic | intermediate | expert\",\r\n    \"emotionalRegister\": \"description of dominant emotional tone\"\r\n  },\r\n  \"audienceProfile\": {\r\n    \"primaryAudience\": \"description\",\r\n    \"engagementDrivers\": [\"driver1\", \"driver2\"],\r\n    \"contentPreferences\": [\"preference1\", \"preference2\"]\r\n  },\r\n  \"competitorDiff\": {\r\n    \"uniqueStrengths\": [\"strength1\", \"strength2\"],\r\n    \"differentiators\": [\"differentiator1\", \"differentiator2\"]\r\n  },\r\n  \"contentRules\": {\r\n    \"doList\": [\"always include X\", \"emphasize Y\"],\r\n    \"dontList\": [\"avoid generic claims\", \"no stock imagery feel\"]\r\n  }\r\n}\r\n\r\nBRAND DATA:\r\n${brandContext}\r\n\r\nGENERATION HISTORY:\r\n${generationContext}\r\n\r\nIMAGE LIBRARY:\r\n${imageContext}\r\n\r\nAnalyze the patterns across all available data. If data is limited, make reasonable inferences based on the industry and brand values. Return ONLY the JSON object.`;\r\n}\r\n\r\nfunction extractBasicBrandDNA(brandProfile: any, _generations: any[]): Record<string, unknown> {\r\n  if (!brandProfile) return {};\r\n\r\n  return {\r\n    visualSignature: extractVisualSignature(brandProfile, []),\r\n    toneAnalysis: extractToneAnalysis(brandProfile),\r\n    audienceProfile: brandProfile.targetAudience\r\n      ? {\r\n          primaryAudience: (brandProfile.targetAudience as any)?.demographics || 'Unknown',\r\n          engagementDrivers: (brandProfile.targetAudience as any)?.painPoints || [],\r\n          contentPreferences: [],\r\n        }\r\n      : null,\r\n    competitorDiff: null,\r\n    contentRules: null,\r\n  };\r\n}\r\n\r\nfunction extractVisualSignature(brandProfile: any, _brandImages: any[]): Record<string, unknown> | null {\r\n  if (!brandProfile) return null;\r\n\r\n  return {\r\n    dominantColors: brandProfile.colorPreferences || [],\r\n    compositionStyle: (brandProfile.preferredStyles || []).join(', ') || 'professional',\r\n    lightingPreference: 'natural',\r\n    typography: 'clean and modern',\r\n  };\r\n}\r\n\r\nfunction extractToneAnalysis(brandProfile: any): Record<string, unknown> | null {\r\n  if (!brandProfile?.voice) return null;\r\n\r\n  const voice = brandProfile.voice as any;\r\n  return {\r\n    formality: 'semi-formal',\r\n    humorLevel: 'subtle',\r\n    technicalDepth: 'intermediate',\r\n    emotionalRegister: (voice?.principles || []).join(', ') || 'professional',\r\n  };\r\n}\r\n\r\nfunction formatValue(value: unknown): string {\r\n  if (Array.isArray(value)) return value.join(', ');\r\n  if (typeof value === 'object' && value !== null) return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\brandImageRecommendationRAG.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\carouselOutlineService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10804,10807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10804,10807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Carousel Outline Service\r\n *\r\n * Generates structured slide outlines for carousel content.\r\n * Uses AI to create a narrative flow with hook, points, and CTA.\r\n *\r\n * 2026 Best Practices (Research-based):\r\n * - Optimal slide count: 7 (sweet spot, 5-10 range)\r\n * - First slide critical: 80% of engagement comes from slide 1\r\n * - One idea per slide: Dense text = ignored content\r\n * - Mobile-first design: Large fonts, minimal text\r\n * - Engagement prompts: \"Save this\", \"Swipe \", questions in CTA\r\n * - Educational = highest engagement (4.7% avg vs 3.9% product)\r\n * - Authenticity > Perfection: Raw, honest content outperforms polished\r\n *\r\n * Sources:\r\n * - SocialInsider LinkedIn Benchmarks 2025\r\n * - SocialPilot, Neal Schaffer LinkedIn Carousel Guides 2026\r\n * - StackInfluence Instagram Carousel Guide 2026\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { getTemplateById } from '../../shared/contentTemplates';\r\n\r\n// Slide purposes for carousel structure\r\ntype SlidePurpose = 'hook' | 'problem' | 'point' | 'solution' | 'proof' | 'cta';\r\n\r\ninterface CarouselSlide {\r\n  slideNumber: number;\r\n  purpose: SlidePurpose;\r\n  headline: string;\r\n  body: string;\r\n  imagePrompt: string;\r\n}\r\n\r\ninterface CarouselOutline {\r\n  title: string;\r\n  description: string;\r\n  slideCount: number;\r\n  slides: CarouselSlide[];\r\n  captionCopy: string;\r\n  hashtags: string[];\r\n}\r\n\r\ninterface GenerateCarouselOutlineInput {\r\n  templateId: string;\r\n  topic: string;\r\n  slideCount: number;\r\n  platform: string;\r\n  productNames?: string[];\r\n}\r\n\r\nclass CarouselOutlineService {\r\n  /**\r\n   * Generate a carousel outline with slides\r\n   */\r\n  async generateOutline(input: GenerateCarouselOutlineInput): Promise<CarouselOutline> {\r\n    const { templateId, topic, slideCount, platform, productNames = [] } = input;\r\n\r\n    // Get template context\r\n    const template = getTemplateById(templateId);\r\n    if (!template) {\r\n      throw new Error(`Template not found: ${templateId}`);\r\n    }\r\n\r\n    // Build the slide structure based on count\r\n    const slideStructure = this.getSlideStructure(slideCount);\r\n\r\n    const prompt = this.buildOutlinePrompt({\r\n      template,\r\n      topic,\r\n      slideCount,\r\n      platform,\r\n      productNames,\r\n      slideStructure,\r\n    });\r\n\r\n    logger.info(\r\n      { templateId, topic, slideCount, platform },\r\n      '[CarouselOutline] Generating outline'\r\n    );\r\n\r\n    try {\r\n      const response = await generateContentWithRetry(\r\n        {\r\n          model: 'gemini-3-pro-preview',\r\n          contents: [\r\n            {\r\n              role: 'user',\r\n              parts: [{ text: prompt }],\r\n            },\r\n          ],\r\n          config: {\r\n            responseModalities: ['TEXT'],\r\n            responseMimeType: 'application/json',\r\n            temperature: 0.7,\r\n            maxOutputTokens: 4000,\r\n          },\r\n        },\r\n        { operation: 'carousel_outline_generation' }\r\n      );\r\n\r\n      // Extract text from response\r\n      const responseText = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n      const outline = this.parseOutlineResponse(responseText, slideCount, topic);\r\n\r\n      logger.info(\r\n        { slides: outline.slides.length },\r\n        '[CarouselOutline] Generated outline successfully'\r\n      );\r\n\r\n      return outline;\r\n    } catch (error) {\r\n      logger.error({ err: error }, '[CarouselOutline] Failed to generate outline');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get recommended slide structure based on count\r\n   * 2026 Research: 7 slides is the sweet spot (5-10 range optimal)\r\n   */\r\n  private getSlideStructure(slideCount: number): { purpose: SlidePurpose; label: string }[] {\r\n    // 5-slide structure (minimum effective)\r\n    if (slideCount === 5) {\r\n      return [\r\n        { purpose: 'hook', label: 'Hook - Stop the scroll (80% of engagement!)' },\r\n        { purpose: 'problem', label: 'Problem - The pain point they face' },\r\n        { purpose: 'point', label: 'Solution - Your key insight' },\r\n        { purpose: 'proof', label: 'Proof - Evidence or example' },\r\n        { purpose: 'cta', label: 'CTA - Save/Share prompt' },\r\n      ];\r\n    }\r\n\r\n    // 6-slide structure\r\n    if (slideCount === 6) {\r\n      return [\r\n        { purpose: 'hook', label: 'Hook - Stop the scroll (80% of engagement!)' },\r\n        { purpose: 'problem', label: 'Problem - The pain point' },\r\n        { purpose: 'point', label: 'Point 1 - First insight' },\r\n        { purpose: 'point', label: 'Point 2 - Second insight' },\r\n        { purpose: 'solution', label: 'Solution - The answer' },\r\n        { purpose: 'cta', label: 'CTA - Engagement prompt' },\r\n      ];\r\n    }\r\n\r\n    // 7-slide structure (2026 SWEET SPOT - highest engagement)\r\n    if (slideCount === 7) {\r\n      return [\r\n        { purpose: 'hook', label: 'Hook - Bold claim or question (CRITICAL!)' },\r\n        { purpose: 'problem', label: 'Problem - Agitate the pain point' },\r\n        { purpose: 'point', label: 'Point 1 - First key insight' },\r\n        { purpose: 'point', label: 'Point 2 - Second key insight' },\r\n        { purpose: 'point', label: 'Point 3 - Third key insight' },\r\n        { purpose: 'solution', label: 'Solution - The takeaway' },\r\n        { purpose: 'cta', label: 'CTA - Save this + question' },\r\n      ];\r\n    }\r\n\r\n    // 8-slide structure\r\n    if (slideCount === 8) {\r\n      return [\r\n        { purpose: 'hook', label: 'Hook - Grab attention immediately' },\r\n        { purpose: 'problem', label: 'Problem - What pain point?' },\r\n        { purpose: 'point', label: 'Point 1 - First insight' },\r\n        { purpose: 'point', label: 'Point 2 - Second insight' },\r\n        { purpose: 'point', label: 'Point 3 - Third insight' },\r\n        { purpose: 'proof', label: 'Proof - Evidence/example' },\r\n        { purpose: 'solution', label: 'Solution - The answer' },\r\n        { purpose: 'cta', label: 'CTA - Call to action' },\r\n      ];\r\n    }\r\n\r\n    // 10-slide structure (max recommended)\r\n    const structure: { purpose: SlidePurpose; label: string }[] = [\r\n      { purpose: 'hook', label: 'Hook - Stop the scroll' },\r\n      { purpose: 'problem', label: 'Problem - The pain point' },\r\n      { purpose: 'point', label: 'Point 1 - First insight' },\r\n      { purpose: 'point', label: 'Point 2 - Second insight' },\r\n      { purpose: 'point', label: 'Point 3 - Third insight' },\r\n      { purpose: 'point', label: 'Point 4 - Fourth insight' },\r\n      { purpose: 'proof', label: 'Proof - Evidence' },\r\n      { purpose: 'proof', label: 'Proof 2 - More evidence' },\r\n      { purpose: 'solution', label: 'Solution - The takeaway' },\r\n      { purpose: 'cta', label: 'CTA - Engagement prompt' },\r\n    ];\r\n    return structure.slice(0, slideCount);\r\n  }\r\n\r\n  /**\r\n   * Build the prompt for generating carousel outline\r\n   */\r\n  private buildOutlinePrompt(params: {\r\n    template: NonNullable<ReturnType<typeof getTemplateById>>;\r\n    topic: string;\r\n    slideCount: number;\r\n    platform: string;\r\n    productNames: string[];\r\n    slideStructure: { purpose: SlidePurpose; label: string }[];\r\n  }): string {\r\n    const { template, topic, slideCount, platform, productNames, slideStructure } = params;\r\n\r\n    const productContext = productNames.length > 0\r\n      ? `Products to feature: ${productNames.join(', ')}`\r\n      : 'No specific products - focus on the topic itself';\r\n\r\n    const hookFormulas = template.hookFormulas.slice(0, 3).join('\\n  - ');\r\n\r\n    return `You are a social media content strategist specializing in ${platform} carousels in 2026.\r\n\r\nCreate a ${slideCount}-slide carousel outline for the following:\r\n\r\nTOPIC: ${topic}\r\nCATEGORY: ${template.category} - ${template.title}\r\nPLATFORM: ${platform}\r\n${productContext}\r\n\r\nTEMPLATE CONTEXT:\r\n- Description: ${template.description}\r\n- Hook formulas to use:\r\n  - ${hookFormulas}\r\n- Post structure: ${template.postStructure}\r\n- What to avoid: ${template.whatToAvoid.join(', ')}\r\n\r\nSLIDE STRUCTURE:\r\n${slideStructure.map((s, i) => `Slide ${i + 1}: ${s.label} (${s.purpose})`).join('\\n')}\r\n\r\nFor each slide, provide:\r\n1. HEADLINE: Bold text (max 40 chars) - ONE main idea, mobile-readable\r\n2. BODY: Supporting text (max 100 chars) - explains the headline concisely\r\n3. IMAGE_PROMPT: A detailed prompt for generating a visual (max 200 chars)\r\n\r\nAlso provide:\r\n- CAPTION: The post caption for ${platform} (max 300 chars) with engagement prompts\r\n- HASHTAGS: 5 relevant hashtags\r\n\r\n2026 CAROUSEL BEST PRACTICES (MUST FOLLOW):\r\n1. SLIDE 1 IS CRITICAL: 80% of engagement comes from the first slide!\r\n   - Use bold claims, surprising stats, or curiosity-provoking questions\r\n   - Make people STOP scrolling immediately\r\n\r\n2. ONE IDEA PER SLIDE: Dense text = ignored content\r\n   - Max 40 chars headline, 100 chars body\r\n   - Large, readable fonts assumed\r\n\r\n3. VISUAL RHYTHM: Mix text-first with image-led slides\r\n   - Don't make every slide look the same\r\n   - Keep brand consistency but vary composition\r\n\r\n4. AUTHENTIC > POLISHED: Raw, honest content outperforms perfect content in 2026\r\n   - Write like a real person, not marketing copy\r\n   - Share genuine insights, not corporate speak\r\n\r\n5. ENGAGEMENT PROMPTS in CTA:\r\n   - Include \" Save this\" or \"Swipe \"\r\n   - End with a question to prompt comments\r\n   - Educational content gets 4.7% engagement vs 3.9% for product\r\n\r\n6. STORY FLOW: Each slide must connect to create a cohesive narrative\r\n   - Not random tips - a logical progression\r\n   - Build tension then resolve it\r\n\r\nRespond in this exact JSON format:\r\n{\r\n  \"title\": \"Carousel title\",\r\n  \"description\": \"Brief description of the carousel\",\r\n  \"slides\": [\r\n    {\r\n      \"slideNumber\": 1,\r\n      \"purpose\": \"hook\",\r\n      \"headline\": \"Stop doing this mistake\",\r\n      \"body\": \"Most contractors waste money on...\",\r\n      \"imagePrompt\": \"Professional construction site with warning sign, orange safety cones, dramatic lighting\"\r\n    }\r\n  ],\r\n  \"captionCopy\": \"The post caption...\",\r\n  \"hashtags\": [\"construction\", \"tips\", \"contractor\", \"building\", \"proadvice\"]\r\n}`;\r\n  }\r\n\r\n  /**\r\n   * Parse the AI response into structured outline\r\n   */\r\n  private parseOutlineResponse(response: string, expectedSlides: number, topic: string): CarouselOutline {\r\n    try {\r\n      // Extract JSON from response (might be wrapped in markdown code blocks)\r\n      const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\r\n      if (!jsonMatch) {\r\n        throw new Error('No JSON found in response');\r\n      }\r\n\r\n      const parsed = JSON.parse(jsonMatch[0]);\r\n\r\n      // Validate structure\r\n      if (!parsed.slides || !Array.isArray(parsed.slides)) {\r\n        throw new Error('Invalid slides structure');\r\n      }\r\n\r\n      // Ensure we have the right number of slides\r\n      const slides: CarouselSlide[] = parsed.slides.slice(0, expectedSlides).map((slide: any, index: number) => ({\r\n        slideNumber: index + 1,\r\n        purpose: slide.purpose || 'point',\r\n        headline: String(slide.headline || '').slice(0, 100),\r\n        body: String(slide.body || '').slice(0, 200),\r\n        imagePrompt: String(slide.imagePrompt || '').slice(0, 300),\r\n      }));\r\n\r\n      return {\r\n        title: String(parsed.title || topic).slice(0, 100),\r\n        description: String(parsed.description || '').slice(0, 300),\r\n        slideCount: slides.length,\r\n        slides,\r\n        captionCopy: String(parsed.captionCopy || '').slice(0, 500),\r\n        hashtags: Array.isArray(parsed.hashtags) ? parsed.hashtags.slice(0, 10) : [],\r\n      };\r\n    } catch (error) {\r\n      logger.error(\r\n        { err: error, response: response.slice(0, 500) },\r\n        '[CarouselOutline] Failed to parse response'\r\n      );\r\n\r\n      // Return a fallback structure\r\n      return this.generateFallbackOutline(topic, expectedSlides);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate fallback outline if AI response parsing fails\r\n   */\r\n  private generateFallbackOutline(topic: string, slideCount: number): CarouselOutline {\r\n    const structure = this.getSlideStructure(slideCount);\r\n\r\n    return {\r\n      title: topic,\r\n      description: `A carousel about ${topic}`,\r\n      slideCount,\r\n      slides: structure.map((s, i) => ({\r\n        slideNumber: i + 1,\r\n        purpose: s.purpose,\r\n        headline: `${s.label}`,\r\n        body: `Content about ${topic}...`,\r\n        imagePrompt: `Professional image related to ${topic}, clean design, ${s.purpose} visual`,\r\n      })),\r\n      captionCopy: `Learn more about ${topic}. Save this for later!`,\r\n      hashtags: ['tips', 'howto', 'learn', 'guide', 'professional'],\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const carouselOutlineService = new CarouselOutlineService();\r\n\r\nexport type { CarouselOutline, CarouselSlide, GenerateCarouselOutlineInput };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\confidenceScoringService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'imageUrl' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":124,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":124,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":361,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11484,11487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11484,11487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '../lib/logger';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { storage } from '../storage';\r\nimport type { BrandProfile } from '@shared/schema';\r\n\r\n// Platform character limits (same as copywritingService.ts)\r\ninterface PlatformLimits {\r\n  headline: { optimal: number; max: number };\r\n  hook: { optimal: number; max: number };\r\n  primaryText: { optimal: number; max: number };\r\n  caption: { optimal: number; max: number };\r\n  description?: { optimal: number; max: number };\r\n}\r\n\r\nconst PLATFORM_LIMITS: Record<string, PlatformLimits> = {\r\n  instagram: {\r\n    headline: { optimal: 40, max: 40 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 125, max: 2200 },\r\n    caption: { optimal: 125, max: 2200 },\r\n  },\r\n  linkedin: {\r\n    headline: { optimal: 150, max: 150 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 150, max: 600 },\r\n    caption: { optimal: 150, max: 600 },\r\n    description: { optimal: 45, max: 45 },\r\n  },\r\n  facebook: {\r\n    headline: { optimal: 27, max: 27 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 125, max: 500 },\r\n    caption: { optimal: 125, max: 500 },\r\n    description: { optimal: 27, max: 27 },\r\n  },\r\n  twitter: {\r\n    headline: { optimal: 23, max: 23 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 257, max: 280 },\r\n    caption: { optimal: 257, max: 280 },\r\n  },\r\n  tiktok: {\r\n    headline: { optimal: 40, max: 40 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 100, max: 150 },\r\n    caption: { optimal: 100, max: 150 },\r\n  },\r\n};\r\n\r\n// Proven hook patterns for quality scoring\r\nconst HOOK_PATTERNS = [\r\n  { pattern: /^(I quit|I stopped|I started|I spent|I learned)/i, name: 'pattern_interrupt' },\r\n  { pattern: /\\?$/, name: 'question_hook' },\r\n  { pattern: /\\d+%|\\d+\\/\\d+|\\d+ out of \\d+/i, name: 'stat_hook' },\r\n  { pattern: /^(Tired of|Struggling with|Frustrated by|Still using)/i, name: 'pain_point' },\r\n  { pattern: /^(Double|Triple|Increase|Boost|Get|Achieve)/i, name: 'benefit_promise' },\r\n  { pattern: /^(Even if|Without|No need to)/i, name: 'even_if_without' },\r\n];\r\n\r\n// CTA pattern detection\r\nconst CTA_PATTERNS = [\r\n  /shop now/i,\r\n  /learn more/i,\r\n  /sign up/i,\r\n  /get started/i,\r\n  /join now/i,\r\n  /try (it |now |free )?/i,\r\n  /download/i,\r\n  /click here/i,\r\n  /discover/i,\r\n  /order now/i,\r\n  /book now/i,\r\n  /contact us/i,\r\n  /see more/i,\r\n  /explore/i,\r\n  /start (your|now)/i,\r\n];\r\n\r\n/**\r\n * Confidence Score interface - AI-powered quality assessment\r\n */\r\nexport interface ConfidenceScore {\r\n  overall: number; // 0-100\r\n  breakdown: {\r\n    characterLimitValid: boolean;\r\n    brandVoiceAlignment: number; // 0-100\r\n    hookQuality: number; // 0-100\r\n    ctaPresence: boolean;\r\n    hashtagAppropriate: boolean;\r\n  };\r\n  reasoning: string;\r\n  recommendation: 'auto_approve' | 'manual_review' | 'auto_reject';\r\n}\r\n\r\n/**\r\n * Parameters for content evaluation\r\n */\r\nexport interface EvaluateContentParams {\r\n  caption: string;\r\n  platform: 'instagram' | 'linkedin' | 'facebook' | 'twitter' | 'tiktok';\r\n  imageUrl?: string;\r\n  hashtags?: string[];\r\n  userId: string;\r\n}\r\n\r\n/**\r\n * Evaluate generated content and calculate confidence score\r\n *\r\n * Scoring algorithm:\r\n * 1. Character limit compliance: +20 pts (pass/fail)\r\n * 2. Brand voice match: 0-30 pts (LLM comparison to brand guidelines)\r\n * 3. Hook effectiveness: 0-25 pts (pattern matching + LLM quality check)\r\n * 4. CTA presence: +15 pts (detected call-to-action)\r\n * 5. Hashtag appropriateness: +10 pts (platform-specific, not spammy)\r\n *\r\n * Thresholds:\r\n * - 95: Auto-approve eligible\r\n * - 85-94: Expedited review (4-hour SLA)\r\n * - 70-84: Standard review (24-hour SLA)\r\n * - 50-69: Detailed review (48-hour SLA)\r\n * - <50: Auto-reject with feedback\r\n */\r\nexport async function evaluateContent(params: EvaluateContentParams): Promise<ConfidenceScore> {\r\n  const { caption, platform, imageUrl, hashtags = [], userId } = params;\r\n\r\n  logger.info(\r\n    { module: 'ConfidenceScoring', platform, captionLength: caption.length, hashtagCount: hashtags.length },\r\n    'Starting content evaluation'\r\n  );\r\n\r\n  // STEP 1: Character Limit Validation (+20 pts if valid)\r\n  const characterLimitValid = validateCharacterLimits(caption, platform);\r\n  const characterLimitScore = characterLimitValid ? 20 : 0;\r\n\r\n  // STEP 2: Hook Quality Assessment (0-25 pts)\r\n  const hookQuality = assessHookQuality(caption);\r\n\r\n  // STEP 3: CTA Detection (+15 pts if present)\r\n  const ctaPresence = detectCTA(caption);\r\n  const ctaScore = ctaPresence ? 15 : 0;\r\n\r\n  // STEP 4: Hashtag Appropriateness (+10 pts if appropriate)\r\n  const hashtagAppropriate = validateHashtags(hashtags, platform);\r\n  const hashtagScore = hashtagAppropriate ? 10 : 0;\r\n\r\n  // STEP 5: Brand Voice Alignment (0-30 pts using LLM)\r\n  const brandProfile = await storage.getBrandProfileByUserId(userId);\r\n  const brandVoiceAlignment = await assessBrandVoiceAlignment(caption, brandProfile, platform);\r\n\r\n  // Calculate overall score\r\n  const overall = characterLimitScore + hookQuality + ctaScore + hashtagScore + brandVoiceAlignment;\r\n\r\n  // Determine recommendation based on thresholds\r\n  let recommendation: 'auto_approve' | 'manual_review' | 'auto_reject';\r\n  if (overall >= 95) {\r\n    recommendation = 'auto_approve';\r\n  } else if (overall < 50) {\r\n    recommendation = 'auto_reject';\r\n  } else {\r\n    recommendation = 'manual_review';\r\n  }\r\n\r\n  // Build reasoning\r\n  const reasoning = buildReasoning({\r\n    overall,\r\n    characterLimitValid,\r\n    hookQuality,\r\n    ctaPresence,\r\n    hashtagAppropriate,\r\n    brandVoiceAlignment,\r\n    platform,\r\n  });\r\n\r\n  const score: ConfidenceScore = {\r\n    overall,\r\n    breakdown: {\r\n      characterLimitValid,\r\n      brandVoiceAlignment,\r\n      hookQuality,\r\n      ctaPresence,\r\n      hashtagAppropriate,\r\n    },\r\n    reasoning,\r\n    recommendation,\r\n  };\r\n\r\n  logger.info(\r\n    {\r\n      module: 'ConfidenceScoring',\r\n      score: overall,\r\n      recommendation,\r\n      breakdown: score.breakdown,\r\n    },\r\n    'Content evaluation complete'\r\n  );\r\n\r\n  return score;\r\n}\r\n\r\n/**\r\n * Validate character limits for platform\r\n */\r\nfunction validateCharacterLimits(caption: string, platform: string): boolean {\r\n  const limits = PLATFORM_LIMITS[platform];\r\n  if (!limits) return false;\r\n\r\n  const captionLength = caption.length;\r\n  return captionLength <= limits.caption.max;\r\n}\r\n\r\n/**\r\n * Assess hook quality using pattern matching\r\n * Returns 0-25 points\r\n */\r\nfunction assessHookQuality(caption: string): number {\r\n  // Extract first sentence/line as the hook\r\n  const hook = caption.split(/[.\\n]/)[0].trim();\r\n  if (hook.length === 0) return 0;\r\n\r\n  // Check for proven hook patterns\r\n  const matchedPattern = HOOK_PATTERNS.find(({ pattern }) => pattern.test(hook));\r\n  if (matchedPattern) {\r\n    // Strong hook pattern detected: 20-25 pts\r\n    return 25;\r\n  }\r\n\r\n  // Check for basic hook qualities\r\n  let score = 10; // Base score for having a hook\r\n\r\n  // Bonus for optimal length (under 60 chars for Twitter/LinkedIn, under 100 for others)\r\n  if (hook.length > 10 && hook.length <= 60) {\r\n    score += 5;\r\n  }\r\n\r\n  // Bonus for attention-grabbing elements (numbers, questions, exclamations)\r\n  if (/\\d+/.test(hook)) score += 3; // Contains numbers\r\n  if (/[?!]/.test(hook)) score += 3; // Contains question/exclamation\r\n  if (/[\"']/.test(hook)) score += 2; // Contains quotes (social proof indicator)\r\n\r\n  return Math.min(score, 25);\r\n}\r\n\r\n/**\r\n * Detect call-to-action presence\r\n */\r\nfunction detectCTA(caption: string): boolean {\r\n  return CTA_PATTERNS.some(pattern => pattern.test(caption));\r\n}\r\n\r\n/**\r\n * Validate hashtag appropriateness for platform\r\n */\r\nfunction validateHashtags(hashtags: string[], platform: string): boolean {\r\n  // No hashtags is acceptable\r\n  if (hashtags.length === 0) return true;\r\n\r\n  // Platform-specific hashtag rules\r\n  const platformRules: Record<string, { minCount: number; maxCount: number }> = {\r\n    instagram: { minCount: 0, maxCount: 10 }, // Ads perform better with 3-5, but up to 10 acceptable\r\n    linkedin: { minCount: 0, maxCount: 5 }, // LinkedIn prefers 3-5 hashtags\r\n    facebook: { minCount: 0, maxCount: 5 }, // Facebook ads don't benefit from hashtags, limit to 5\r\n    twitter: { minCount: 0, maxCount: 3 }, // Twitter prefers 1-2 hashtags max\r\n    tiktok: { minCount: 0, maxCount: 5 }, // TikTok performs well with 3-5 hashtags\r\n  };\r\n\r\n  const rules = platformRules[platform];\r\n  if (!rules) return false;\r\n\r\n  // Check count\r\n  if (hashtags.length < rules.minCount || hashtags.length > rules.maxCount) {\r\n    return false;\r\n  }\r\n\r\n  // Check for spammy patterns\r\n  // - Too many hashtags per character (spam indicator)\r\n  // - All caps hashtags (spam indicator)\r\n  // - Very long hashtags (>30 chars - likely spam)\r\n  const allCapsCount = hashtags.filter(h => h === h.toUpperCase() && h.length > 3).length;\r\n  const longHashtagCount = hashtags.filter(h => h.length > 30).length;\r\n\r\n  if (allCapsCount > hashtags.length / 2) return false; // More than half all caps\r\n  if (longHashtagCount > 0) return false; // Any hashtag over 30 chars\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Assess brand voice alignment using LLM\r\n * Returns 0-30 points\r\n */\r\nasync function assessBrandVoiceAlignment(\r\n  caption: string,\r\n  brandProfile: BrandProfile | undefined,\r\n  platform: string\r\n): Promise<number> {\r\n  // If no brand profile, give baseline score\r\n  if (!brandProfile || !brandProfile.voice) {\r\n    return 15; // Neutral score when no brand guidelines exist\r\n  }\r\n\r\n  try {\r\n    const prompt = buildBrandVoicePrompt(caption, brandProfile, platform);\r\n\r\n    // MODEL RECENCY RULE: Before changing any model ID, verify today's date and confirm the model is current within the last 3-4 weeks.\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: 'gemini-3-pro-preview',\r\n        contents: [\r\n          {\r\n            role: 'user',\r\n            parts: [{ text: prompt }],\r\n          },\r\n        ],\r\n        config: {\r\n          responseModalities: ['TEXT'],\r\n          responseMimeType: 'application/json',\r\n          responseSchema: {\r\n            type: 'object',\r\n            properties: {\r\n              alignmentScore: {\r\n                type: 'number',\r\n                description: 'Brand voice alignment score (0-30)',\r\n                minimum: 0,\r\n                maximum: 30,\r\n              },\r\n              reasoning: {\r\n                type: 'string',\r\n                description: 'Explanation of the score',\r\n              },\r\n            },\r\n            required: ['alignmentScore', 'reasoning'],\r\n          },\r\n        },\r\n      },\r\n      { operation: 'brand_voice_scoring' }\r\n    );\r\n\r\n    const text = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n    const result = JSON.parse(text);\r\n\r\n    logger.info(\r\n      {\r\n        module: 'ConfidenceScoring',\r\n        alignmentScore: result.alignmentScore,\r\n        reasoning: result.reasoning,\r\n      },\r\n      'Brand voice alignment assessed'\r\n    );\r\n\r\n    return result.alignmentScore;\r\n  } catch (error) {\r\n    logger.error({ module: 'ConfidenceScoring', err: error }, 'Brand voice assessment failed, using baseline');\r\n    return 15; // Fallback to neutral score on error\r\n  }\r\n}\r\n\r\n/**\r\n * Build PTCF prompt for brand voice assessment\r\n */\r\nfunction buildBrandVoicePrompt(caption: string, brandProfile: BrandProfile, platform: string): string {\r\n  const voice = brandProfile.voice as any;\r\n\r\n  return `You are an expert brand voice analyst. Evaluate how well this social media caption aligns with the brand's voice guidelines.\r\n\r\nBRAND VOICE GUIDELINES:\r\n${voice.principles ? `Principles: ${voice.principles.join(', ')}` : 'No principles defined'}\r\n${voice.wordsToUse?.length ? `Words to USE: ${voice.wordsToUse.join(', ')}` : ''}\r\n${voice.wordsToAvoid?.length ? `Words to AVOID: ${voice.wordsToAvoid.join(', ')}` : ''}\r\n\r\nBRAND VALUES:\r\n${brandProfile.brandValues?.length ? brandProfile.brandValues.join(', ') : 'Not specified'}\r\n\r\nPLATFORM: ${platform}\r\n\r\nCAPTION TO EVALUATE:\r\n\"\"\"\r\n${caption}\r\n\"\"\"\r\n\r\nSCORING RUBRIC (0-30 points):\r\n- 25-30 pts: Perfectly aligned with brand voice, uses preferred terminology, matches tone\r\n- 20-24 pts: Strong alignment, mostly consistent with brand guidelines\r\n- 15-19 pts: Adequate alignment, no major violations but could be stronger\r\n- 10-14 pts: Weak alignment, some inconsistencies with brand voice\r\n- 0-9 pts: Poor alignment, violates brand guidelines or uses avoided words\r\n\r\nReturn a JSON object with:\r\n- alignmentScore: number (0-30)\r\n- reasoning: string (brief explanation of the score)\r\n\r\nFocus on:\r\n1. Use of brand-preferred words vs avoided words\r\n2. Adherence to brand principles (if defined)\r\n3. Tone consistency with brand values\r\n4. Platform appropriateness for this brand\r\n\r\nBe strict but fair. Most content should score 15-25 unless exceptional or clearly misaligned.`;\r\n}\r\n\r\n/**\r\n * Build human-readable reasoning for the score\r\n */\r\nfunction buildReasoning(data: {\r\n  overall: number;\r\n  characterLimitValid: boolean;\r\n  hookQuality: number;\r\n  ctaPresence: boolean;\r\n  hashtagAppropriate: boolean;\r\n  brandVoiceAlignment: number;\r\n  platform: string;\r\n}): string {\r\n  const { overall, characterLimitValid, hookQuality, ctaPresence, hashtagAppropriate, brandVoiceAlignment, platform } =\r\n    data;\r\n\r\n  const parts: string[] = [];\r\n\r\n  // Overall assessment\r\n  if (overall >= 95) {\r\n    parts.push(` EXCELLENT (${overall}/100) - Auto-approve eligible`);\r\n  } else if (overall >= 85) {\r\n    parts.push(` VERY GOOD (${overall}/100) - Expedited review (4-hour SLA)`);\r\n  } else if (overall >= 70) {\r\n    parts.push(` GOOD (${overall}/100) - Standard review (24-hour SLA)`);\r\n  } else if (overall >= 50) {\r\n    parts.push(` NEEDS WORK (${overall}/100) - Detailed review (48-hour SLA)`);\r\n  } else {\r\n    parts.push(` POOR (${overall}/100) - Auto-reject recommended`);\r\n  }\r\n\r\n  // Character limits\r\n  if (!characterLimitValid) {\r\n    parts.push(` Character limit exceeded for ${platform}`);\r\n  } else {\r\n    parts.push(` Character limits OK`);\r\n  }\r\n\r\n  // Hook quality\r\n  if (hookQuality >= 20) {\r\n    parts.push(` Strong hook (${hookQuality}/25 pts)`);\r\n  } else if (hookQuality >= 15) {\r\n    parts.push(` Adequate hook (${hookQuality}/25 pts)`);\r\n  } else {\r\n    parts.push(` Weak hook (${hookQuality}/25 pts) - Consider using proven patterns`);\r\n  }\r\n\r\n  // CTA presence\r\n  if (ctaPresence) {\r\n    parts.push(` Clear CTA present`);\r\n  } else {\r\n    parts.push(` No clear CTA detected - Consider adding \"Shop Now\", \"Learn More\", etc.`);\r\n  }\r\n\r\n  // Hashtags\r\n  if (hashtagAppropriate) {\r\n    parts.push(` Hashtag usage appropriate for ${platform}`);\r\n  } else {\r\n    parts.push(` Hashtag usage not optimal for ${platform}`);\r\n  }\r\n\r\n  // Brand voice\r\n  if (brandVoiceAlignment >= 25) {\r\n    parts.push(` Excellent brand voice alignment (${brandVoiceAlignment}/30 pts)`);\r\n  } else if (brandVoiceAlignment >= 20) {\r\n    parts.push(` Strong brand voice alignment (${brandVoiceAlignment}/30 pts)`);\r\n  } else if (brandVoiceAlignment >= 15) {\r\n    parts.push(` Adequate brand voice alignment (${brandVoiceAlignment}/30 pts)`);\r\n  } else {\r\n    parts.push(` Weak brand voice alignment (${brandVoiceAlignment}/30 pts) - Review brand guidelines`);\r\n  }\r\n\r\n  return parts.join('\\n');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\contentFormatterService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'contentType' is defined but never used. Allowed unused args must match /^_/u.","line":65,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Content Formatter Service\r\n *\r\n * Handles platform-specific content formatting for social media posting.\r\n * Validates character limits, formats hashtags, handles links, and optimizes content.\r\n *\r\n * Usage:\r\n *   import { formatContentForPlatform } from './services/contentFormatterService';\r\n *   const formatted = await formatContentForPlatform('My caption', ['marketing'], 'instagram');\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { getPlatformSpecs, type PlatformSpecs } from './platformSpecsService';\r\n\r\n/**\r\n * Formatted content result with validation\r\n */\r\nexport interface FormattedContent {\r\n  caption: string;\r\n  hashtags: string[];\r\n  characterCount: number;\r\n  hashtagCount: number;\r\n  warnings: string[];\r\n  errors: string[];\r\n  isValid: boolean;\r\n\r\n  // Image requirements for this platform\r\n  imageRequirements?: {\r\n    aspectRatio: string;\r\n    minWidth: number;\r\n    minHeight: number;\r\n    formats: string[];\r\n    maxSizeMB: number;\r\n  };\r\n\r\n  // Metadata\r\n  platform: string;\r\n  truncated: boolean;\r\n  emojiCount: number;\r\n  linkHandling?: {\r\n    linksDetected: number;\r\n    linksRemoved: number;\r\n    message?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Content type for specialized formatting\r\n */\r\nexport type ContentType = 'feed' | 'story' | 'reel' | 'short' | 'video';\r\n\r\n/**\r\n * Format content for a specific platform\r\n *\r\n * @param caption - Original caption text\r\n * @param hashtags - Array of hashtags (with or without # symbol)\r\n * @param platform - Platform identifier (e.g., 'instagram', 'linkedin')\r\n * @param contentType - Optional content type for specialized handling\r\n * @returns Formatted content with validation results\r\n */\r\nexport async function formatContentForPlatform(\r\n  caption: string,\r\n  hashtags: string[],\r\n  platform: string,\r\n  contentType?: ContentType\r\n): Promise<FormattedContent> {\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    // Get platform specs\r\n    const specs = getPlatformSpecs(platform);\r\n    if (!specs) {\r\n      return createErrorResult(caption, hashtags, platform, `Platform '${platform}' not supported`);\r\n    }\r\n\r\n    // Initialize result\r\n    const result: FormattedContent = {\r\n      caption: caption,\r\n      hashtags: [],\r\n      characterCount: 0,\r\n      hashtagCount: 0,\r\n      warnings: [],\r\n      errors: [],\r\n      isValid: true,\r\n      platform: platform,\r\n      truncated: false,\r\n      emojiCount: 0,\r\n    };\r\n\r\n    // Step 1: Clean and normalize input\r\n    let processedCaption = caption.trim();\r\n    const processedHashtags = normalizeHashtags(hashtags, specs);\r\n\r\n    // Step 2: Emoji optimization (for professional platforms)\r\n    if (specs.features.professionalPlatform) {\r\n      const emojiResult = optimizeEmojis(processedCaption, specs);\r\n      processedCaption = emojiResult.text;\r\n      if (emojiResult.removed > 0) {\r\n        result.warnings.push(\r\n          `Removed ${emojiResult.removed} excessive emojis for professional platform`\r\n        );\r\n      }\r\n    }\r\n\r\n    // Step 3: Link handling\r\n    const linkResult = handleLinks(processedCaption, specs);\r\n    processedCaption = linkResult.text;\r\n    result.linkHandling = linkResult.metadata;\r\n    if (linkResult.metadata.message) {\r\n      result.warnings.push(linkResult.metadata.message);\r\n    }\r\n\r\n    // Step 4: Hashtag validation and formatting\r\n    const hashtagResult = formatHashtags(processedHashtags, specs);\r\n    result.hashtags = hashtagResult.formatted;\r\n    result.hashtagCount = hashtagResult.formatted.length;\r\n    result.warnings.push(...hashtagResult.warnings);\r\n    result.errors.push(...hashtagResult.errors);\r\n\r\n    // Step 5: Combine caption and hashtags\r\n    const combinedText = combineTextAndHashtags(processedCaption, result.hashtags, specs);\r\n\r\n    // Step 6: Character limit validation and truncation\r\n    const charLimitResult = enforceCharacterLimit(combinedText, specs);\r\n    result.caption = charLimitResult.text;\r\n    result.characterCount = charLimitResult.count;\r\n    result.truncated = charLimitResult.truncated;\r\n    if (charLimitResult.truncated) {\r\n      result.warnings.push(\r\n        `Caption truncated from ${combinedText.length} to ${specs.caption.maxLength} characters`\r\n      );\r\n    }\r\n\r\n    // Step 7: Line break optimization\r\n    result.caption = optimizeLineBreaks(result.caption, specs);\r\n\r\n    // Step 8: Count emojis\r\n    result.emojiCount = countEmojis(result.caption);\r\n\r\n    // Step 9: Add image requirements\r\n    result.imageRequirements = getImageRequirements(specs);\r\n\r\n    // Step 10: Final validation\r\n    const validation = validateContent(result, specs);\r\n    result.errors.push(...validation.errors);\r\n    result.warnings.push(...validation.warnings);\r\n    result.isValid = result.errors.length === 0;\r\n\r\n    // Log formatting\r\n    logger.debug({\r\n      platform,\r\n      characterCount: result.characterCount,\r\n      hashtagCount: result.hashtagCount,\r\n      truncated: result.truncated,\r\n      isValid: result.isValid,\r\n      duration: Date.now() - startTime,\r\n    }, 'Content formatted for platform');\r\n\r\n    return result;\r\n\r\n  } catch (error) {\r\n    logger.error({ error, platform, caption }, 'Content formatting failed');\r\n    return createErrorResult(caption, hashtags, platform, 'Formatting failed due to internal error');\r\n  }\r\n}\r\n\r\n/**\r\n * Normalize hashtags: add/remove # symbol based on platform\r\n */\r\nfunction normalizeHashtags(hashtags: string[], specs: PlatformSpecs): string[] {\r\n  return hashtags.map(tag => {\r\n    const cleaned = tag.trim().replace(/^#+/, ''); // Remove existing #\r\n\r\n    if (specs.hashtags.requiresSymbol) {\r\n      return `#${cleaned}`;\r\n    } else {\r\n      return cleaned;\r\n    }\r\n  }).filter(tag => tag.length > (specs.hashtags.requiresSymbol ? 1 : 0)); // Remove empty\r\n}\r\n\r\n/**\r\n * Optimize emojis for professional platforms\r\n */\r\nfunction optimizeEmojis(text: string, specs: PlatformSpecs): { text: string; removed: number } {\r\n  if (!specs.features.professionalPlatform) {\r\n    return { text, removed: 0 };\r\n  }\r\n\r\n  // LinkedIn/professional: max 3 emojis total\r\n  const emojiRegex = /[\\u{1F300}-\\u{1F9FF}]|[\\u{2600}-\\u{26FF}]|[\\u{2700}-\\u{27BF}]/gu;\r\n  const emojis = text.match(emojiRegex) || [];\r\n\r\n  if (emojis.length <= 3) {\r\n    return { text, removed: 0 };\r\n  }\r\n\r\n  // Remove excessive emojis (keep first 3)\r\n  let count = 0;\r\n  const optimized = text.replace(emojiRegex, (match) => {\r\n    count++;\r\n    return count <= 3 ? match : '';\r\n  });\r\n\r\n  return { text: optimized, removed: emojis.length - 3 };\r\n}\r\n\r\n/**\r\n * Handle links based on platform capabilities\r\n */\r\nfunction handleLinks(text: string, specs: PlatformSpecs): {\r\n  text: string;\r\n  metadata: {\r\n    linksDetected: number;\r\n    linksRemoved: number;\r\n    message?: string;\r\n  };\r\n} {\r\n  const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n  const links = text.match(urlRegex) || [];\r\n  const linksDetected = links.length;\r\n\r\n  if (linksDetected === 0) {\r\n    return {\r\n      text,\r\n      metadata: { linksDetected: 0, linksRemoved: 0 },\r\n    };\r\n  }\r\n\r\n  // Platform supports links\r\n  if (specs.features.supportsLinks) {\r\n    let message: string | undefined;\r\n\r\n    if (specs.features.linkPosition === 'bio') {\r\n      // Instagram: suggest moving to bio\r\n      const textWithoutLinks = text.replace(urlRegex, '').trim();\r\n      message = `Links not clickable in captions. Add \"Link in bio\" message instead.`;\r\n      return {\r\n        text: textWithoutLinks + '\\n\\n Link in bio',\r\n        metadata: { linksDetected, linksRemoved: linksDetected, message },\r\n      };\r\n    } else if (specs.features.linkPosition === 'firstComment') {\r\n      // Some platforms: suggest first comment\r\n      const textWithoutLinks = text.replace(urlRegex, '').trim();\r\n      message = `Links moved to first comment for better engagement.`;\r\n      return {\r\n        text: textWithoutLinks,\r\n        metadata: { linksDetected, linksRemoved: linksDetected, message },\r\n      };\r\n    }\r\n\r\n    // Links allowed in caption (LinkedIn, Facebook, etc.)\r\n    return {\r\n      text,\r\n      metadata: { linksDetected, linksRemoved: 0 },\r\n    };\r\n  }\r\n\r\n  // Platform doesn't support links (TikTok)\r\n  const textWithoutLinks = text.replace(urlRegex, '').trim();\r\n  return {\r\n    text: textWithoutLinks,\r\n    metadata: {\r\n      linksDetected,\r\n      linksRemoved: linksDetected,\r\n      message: `Platform doesn't support clickable links. Links removed.`,\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Format hashtags according to platform rules\r\n */\r\nfunction formatHashtags(hashtags: string[], specs: PlatformSpecs): {\r\n  formatted: string[];\r\n  warnings: string[];\r\n  errors: string[];\r\n} {\r\n  const warnings: string[] = [];\r\n  const errors: string[] = [];\r\n\r\n  // Validate hashtag count\r\n  if (hashtags.length > specs.hashtags.max) {\r\n    warnings.push(\r\n      `${hashtags.length} hashtags exceeds platform limit of ${specs.hashtags.max}. Using first ${specs.hashtags.max}.`\r\n    );\r\n    hashtags = hashtags.slice(0, specs.hashtags.max);\r\n  }\r\n\r\n  if (hashtags.length < specs.hashtags.min) {\r\n    errors.push(\r\n      `Platform requires at least ${specs.hashtags.min} hashtags, but ${hashtags.length} provided.`\r\n    );\r\n  }\r\n\r\n  // Validate hashtag format\r\n  const formatted = hashtags.map(tag => {\r\n    // Remove spaces\r\n    const noSpaces = tag.replace(/\\s+/g, '');\r\n\r\n    // Validate characters (alphanumeric + underscore)\r\n    if (!/^#?[a-zA-Z0-9_]+$/.test(noSpaces)) {\r\n      warnings.push(`Invalid hashtag format: \"${tag}\" (special characters removed)`);\r\n      return noSpaces.replace(/[^a-zA-Z0-9_#]/g, '');\r\n    }\r\n\r\n    return noSpaces;\r\n  }).filter(tag => tag.length > (specs.hashtags.requiresSymbol ? 1 : 0));\r\n\r\n  return { formatted, warnings, errors };\r\n}\r\n\r\n/**\r\n * Combine text and hashtags based on platform position preference\r\n */\r\nfunction combineTextAndHashtags(text: string, hashtags: string[], specs: PlatformSpecs): string {\r\n  if (hashtags.length === 0) {\r\n    return text;\r\n  }\r\n\r\n  const hashtagString = hashtags.join(' ');\r\n\r\n  switch (specs.hashtags.position) {\r\n    case 'inline':\r\n      // Twitter/TikTok: hashtags within the text is common\r\n      return `${text} ${hashtagString}`;\r\n\r\n    case 'end':\r\n      // Instagram/LinkedIn: hashtags at the end after line breaks\r\n      return `${text}\\n\\n${hashtagString}`;\r\n\r\n    case 'both':\r\n      // Flexible: allow both inline and end\r\n      return `${text}\\n\\n${hashtagString}`;\r\n\r\n    case 'none':\r\n      // Platform doesn't use hashtags\r\n      return text;\r\n\r\n    default:\r\n      return `${text}\\n\\n${hashtagString}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Enforce character limit with smart truncation\r\n */\r\nfunction enforceCharacterLimit(text: string, specs: PlatformSpecs): {\r\n  text: string;\r\n  count: number;\r\n  truncated: boolean;\r\n} {\r\n  const count = countCharacters(text);\r\n\r\n  if (count <= specs.caption.maxLength) {\r\n    return { text, count, truncated: false };\r\n  }\r\n\r\n  // Truncate with ellipsis\r\n  const maxChars = specs.caption.maxLength - 3; // Leave room for \"...\"\r\n  let truncated = text.substring(0, maxChars);\r\n\r\n  // Try to break at word boundary\r\n  const lastSpace = truncated.lastIndexOf(' ');\r\n  if (lastSpace > maxChars * 0.8) {\r\n    // Only break at word if we're keeping at least 80% of text\r\n    truncated = truncated.substring(0, lastSpace);\r\n  }\r\n\r\n  truncated += '...';\r\n\r\n  return {\r\n    text: truncated,\r\n    count: countCharacters(truncated),\r\n    truncated: true,\r\n  };\r\n}\r\n\r\n/**\r\n * Optimize line breaks for readability\r\n */\r\nfunction optimizeLineBreaks(text: string, specs: PlatformSpecs): string {\r\n  // Remove excessive line breaks (max 2 consecutive)\r\n  let optimized = text.replace(/\\n{3,}/g, '\\n\\n');\r\n\r\n  // Platform-specific optimizations\r\n  if (specs.platform === 'twitter') {\r\n    // Twitter: compact formatting to save characters\r\n    optimized = optimized.replace(/\\n{2,}/g, '\\n');\r\n  }\r\n\r\n  // Trim trailing whitespace\r\n  optimized = optimized.trim();\r\n\r\n  return optimized;\r\n}\r\n\r\n/**\r\n * Count characters (handles emojis correctly)\r\n */\r\nfunction countCharacters(text: string): number {\r\n  // Use Array.from to properly count multi-byte characters (emojis)\r\n  return Array.from(text).length;\r\n}\r\n\r\n/**\r\n * Count emojis in text\r\n */\r\nfunction countEmojis(text: string): number {\r\n  const emojiRegex = /[\\u{1F300}-\\u{1F9FF}]|[\\u{2600}-\\u{26FF}]|[\\u{2700}-\\u{27BF}]/gu;\r\n  const emojis = text.match(emojiRegex) || [];\r\n  return emojis.length;\r\n}\r\n\r\n/**\r\n * Get image requirements for platform\r\n */\r\nfunction getImageRequirements(specs: PlatformSpecs) {\r\n  const recommended = specs.image.aspectRatios.find(ar => ar.recommended);\r\n\r\n  return {\r\n    aspectRatio: recommended?.ratio || specs.image.aspectRatios[0]?.ratio || '1:1',\r\n    minWidth: specs.image.minWidth,\r\n    minHeight: specs.image.minHeight,\r\n    formats: specs.image.formats,\r\n    maxSizeMB: specs.image.maxSizeMB,\r\n  };\r\n}\r\n\r\n/**\r\n * Validate final content\r\n */\r\nfunction validateContent(result: FormattedContent, specs: PlatformSpecs): {\r\n  errors: string[];\r\n  warnings: string[];\r\n} {\r\n  const errors: string[] = [];\r\n  const warnings: string[] = [];\r\n\r\n  // Character count validation\r\n  if (result.characterCount > specs.caption.maxLength) {\r\n    errors.push(`Character count ${result.characterCount} exceeds platform limit ${specs.caption.maxLength}`);\r\n  }\r\n\r\n  if (result.characterCount < specs.caption.minLength) {\r\n    errors.push(`Character count ${result.characterCount} below platform minimum ${specs.caption.minLength}`);\r\n  }\r\n\r\n  // Truncation warning\r\n  if (specs.caption.truncationPoint && result.characterCount > specs.caption.truncationPoint) {\r\n    warnings.push(\r\n      `Caption will be truncated in feed at ${specs.caption.truncationPoint} characters (current: ${result.characterCount})`\r\n    );\r\n  }\r\n\r\n  // Hashtag validation\r\n  if (result.hashtagCount > specs.hashtags.max) {\r\n    errors.push(`Hashtag count ${result.hashtagCount} exceeds platform limit ${specs.hashtags.max}`);\r\n  }\r\n\r\n  if (result.hashtagCount < specs.hashtags.min && specs.hashtags.min > 0) {\r\n    errors.push(`Platform requires at least ${specs.hashtags.min} hashtags`);\r\n  }\r\n\r\n  // Recommended length warning\r\n  if (result.characterCount > specs.caption.recommended * 1.5) {\r\n    warnings.push(\r\n      `Caption is ${result.characterCount} characters. Platform recommends ${specs.caption.recommended} for optimal engagement.`\r\n    );\r\n  }\r\n\r\n  return { errors, warnings };\r\n}\r\n\r\n/**\r\n * Create error result\r\n */\r\nfunction createErrorResult(\r\n  caption: string,\r\n  hashtags: string[],\r\n  platform: string,\r\n  errorMessage: string\r\n): FormattedContent {\r\n  return {\r\n    caption: caption,\r\n    hashtags: hashtags,\r\n    characterCount: caption.length,\r\n    hashtagCount: hashtags.length,\r\n    warnings: [],\r\n    errors: [errorMessage],\r\n    isValid: false,\r\n    platform: platform,\r\n    truncated: false,\r\n    emojiCount: 0,\r\n  };\r\n}\r\n\r\n/**\r\n * Batch format content for multiple platforms\r\n *\r\n * @param caption - Original caption text\r\n * @param hashtags - Array of hashtags\r\n * @param platforms - Array of platform identifiers\r\n * @returns Map of platform to formatted content\r\n */\r\nexport async function formatContentForMultiplePlatforms(\r\n  caption: string,\r\n  hashtags: string[],\r\n  platforms: string[]\r\n): Promise<Record<string, FormattedContent>> {\r\n  const results: Record<string, FormattedContent> = {};\r\n\r\n  // Process all platforms in parallel\r\n  const formatPromises = platforms.map(async (platform) => {\r\n    const formatted = await formatContentForPlatform(caption, hashtags, platform);\r\n    return { platform, formatted };\r\n  });\r\n\r\n  const formattedResults = await Promise.all(formatPromises);\r\n\r\n  // Build result object\r\n  formattedResults.forEach(({ platform, formatted }) => {\r\n    results[platform] = formatted;\r\n  });\r\n\r\n  logger.info({\r\n    platforms,\r\n    totalResults: Object.keys(results).length,\r\n  }, 'Batch content formatting completed');\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Generate platform-optimized caption suggestions\r\n *\r\n * @param originalCaption - Original caption text\r\n * @param platform - Target platform\r\n * @returns Optimized caption suggestions\r\n */\r\nexport function generateCaptionSuggestions(originalCaption: string, platform: string): string[] {\r\n  const specs = getPlatformSpecs(platform);\r\n  if (!specs) return [originalCaption];\r\n\r\n  const suggestions: string[] = [];\r\n\r\n  // Original\r\n  suggestions.push(originalCaption);\r\n\r\n  // Truncated to recommended length\r\n  if (originalCaption.length > specs.caption.recommended) {\r\n    const truncated = originalCaption.substring(0, specs.caption.recommended - 3) + '...';\r\n    suggestions.push(truncated);\r\n  }\r\n\r\n  // Truncated to \"See more\" point\r\n  if (specs.caption.truncationPoint && originalCaption.length > specs.caption.truncationPoint) {\r\n    const previewLength = specs.caption.truncationPoint - 3;\r\n    const preview = originalCaption.substring(0, previewLength) + '...';\r\n    suggestions.push(preview);\r\n  }\r\n\r\n  return [...new Set(suggestions)]; // Remove duplicates\r\n}\r\n\r\n/**\r\n * Export types\r\n */\r\nexport type { FormattedContent, ContentType };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\contentPlannerService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[727,730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[727,730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7314,7317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7314,7317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7408,7411],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7408,7411],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7473,7476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7473,7476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7672,7675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7672,7675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7730,7733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7730,7733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7780,7783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7780,7783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Content Planner Service - 2026 AI-First Implementation\r\n *\r\n * Generates complete posts (copy + image) with:\r\n * 1. Brand context integration\r\n * 2. Parallel generation with Promise.allSettled\r\n * 3. Partial success handling\r\n * 4. Unique content on every generation (temperature > 0)\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { storage } from '../storage';\r\nimport { copywritingService } from './copywritingService';\r\nimport { getTemplateById, type ContentTemplate } from '@shared/contentTemplates';\r\nimport type { Product, BrandProfile } from '@shared/schema';\r\nimport type { GenerateCopyInput } from '../validation/schemas';\r\n\r\n// Try to import genaiImage for direct image generation\r\nlet _genaiImage: any = null;\r\ntry {\r\n  const { genAI } = require('../lib/gemini');\r\n  _genaiImage = genAI;\r\n} catch {\r\n  logger.warn({ module: 'ContentPlannerService' }, 'Image generation not available - gemini client not loaded');\r\n}\r\n\r\n// LLM Configuration\r\nconst _COPY_MODEL = process.env.GEMINI_REASONING_MODEL || 'gemini-3-pro-preview';\r\nconst _IMAGE_MODEL = 'gemini-3-pro-image-preview';\r\n\r\n// Types\r\nexport interface GenerateCompletePostRequest {\r\n  userId: string;\r\n  templateId: string;\r\n  productIds: string[];\r\n  topic?: string;\r\n  platform: 'instagram' | 'linkedin' | 'facebook' | 'twitter' | 'tiktok';\r\n}\r\n\r\nexport interface CopyResult {\r\n  headline: string;\r\n  hook: string;\r\n  bodyText: string;\r\n  cta: string;\r\n  caption: string;\r\n  hashtags: string[];\r\n  framework: string;\r\n}\r\n\r\nexport interface ImageResult {\r\n  imageUrl: string;\r\n  prompt: string;\r\n}\r\n\r\nexport interface GenerateCompletePostResponse {\r\n  success: boolean;\r\n  copy?: CopyResult;\r\n  image?: ImageResult;\r\n  copyError?: string;\r\n  imageError?: string;\r\n  template: {\r\n    id: string;\r\n    title: string;\r\n    category: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Generate a complete post with copy and image in parallel\r\n */\r\nexport async function generateCompletePost(\r\n  request: GenerateCompletePostRequest\r\n): Promise<GenerateCompletePostResponse> {\r\n  const startTime = Date.now();\r\n  const { userId, templateId, productIds, topic, platform } = request;\r\n\r\n  logger.info({\r\n    module: 'ContentPlannerService',\r\n    userId,\r\n    templateId,\r\n    productCount: productIds.length,\r\n    platform\r\n  }, 'Starting complete post generation');\r\n\r\n  // 1. Fetch template\r\n  const template = getTemplateById(templateId);\r\n  if (!template) {\r\n    return {\r\n      success: false,\r\n      copyError: `Template not found: ${templateId}`,\r\n      imageError: `Template not found: ${templateId}`,\r\n      template: { id: templateId, title: 'Unknown', category: 'unknown' }\r\n    };\r\n  }\r\n\r\n  // 2. Validate product requirements\r\n  if (template.productRequirement === 'required' && productIds.length === 0) {\r\n    return {\r\n      success: false,\r\n      copyError: `Template \"${template.title}\" requires at least one product`,\r\n      imageError: `Template \"${template.title}\" requires at least one product`,\r\n      template: { id: template.id, title: template.title, category: template.category }\r\n    };\r\n  }\r\n\r\n  if (template.minProducts && productIds.length < template.minProducts) {\r\n    return {\r\n      success: false,\r\n      copyError: `Template \"${template.title}\" requires at least ${template.minProducts} products`,\r\n      imageError: `Template \"${template.title}\" requires at least ${template.minProducts} products`,\r\n      template: { id: template.id, title: template.title, category: template.category }\r\n    };\r\n  }\r\n\r\n  // 3. Fetch brand profile and products\r\n  const [brandProfile, products] = await Promise.all([\r\n    storage.getBrandProfileByUserId(userId),\r\n    productIds.length > 0 ? fetchProducts(userId, productIds) : Promise.resolve([])\r\n  ]);\r\n\r\n  // 4. Generate copy and image in parallel\r\n  const [copyResult, imageResult] = await Promise.allSettled([\r\n    generateCopy(template, products, brandProfile ?? null, topic, platform),\r\n    template.imageRequirement !== 'none'\r\n      ? generateImage(template, products, brandProfile ?? null, topic, platform)\r\n      : Promise.resolve(null)\r\n  ]);\r\n\r\n  // 5. Process results with partial success handling\r\n  const response: GenerateCompletePostResponse = {\r\n    success: false,\r\n    template: { id: template.id, title: template.title, category: template.category }\r\n  };\r\n\r\n  // Handle copy result\r\n  if (copyResult.status === 'fulfilled' && copyResult.value) {\r\n    response.copy = copyResult.value;\r\n    response.success = true;\r\n  } else if (copyResult.status === 'rejected') {\r\n    response.copyError = copyResult.reason?.message || 'Copy generation failed';\r\n    logger.error({\r\n      module: 'ContentPlannerService',\r\n      error: copyResult.reason\r\n    }, 'Copy generation failed');\r\n  }\r\n\r\n  // Handle image result\r\n  if (imageResult.status === 'fulfilled' && imageResult.value) {\r\n    response.image = imageResult.value;\r\n    response.success = true;\r\n  } else if (imageResult.status === 'rejected') {\r\n    response.imageError = imageResult.reason?.message || 'Image generation failed';\r\n    logger.error({\r\n      module: 'ContentPlannerService',\r\n      error: imageResult.reason\r\n    }, 'Image generation failed');\r\n  } else if (template.imageRequirement === 'none') {\r\n    // Not an error - template doesn't need images\r\n    response.success = response.copy !== undefined;\r\n  }\r\n\r\n  const duration = Date.now() - startTime;\r\n  logger.info({\r\n    module: 'ContentPlannerService',\r\n    duration,\r\n    hasCopy: !!response.copy,\r\n    hasImage: !!response.image,\r\n    success: response.success\r\n  }, 'Complete post generation finished');\r\n\r\n  return response;\r\n}\r\n\r\n/**\r\n * Fetch products by IDs\r\n */\r\nasync function fetchProducts(_userId: string, productIds: string[]): Promise<Product[]> {\r\n  const products: Product[] = [];\r\n\r\n  for (const productId of productIds) {\r\n    try {\r\n      const product = await storage.getProductById(productId);\r\n      if (product) {\r\n        products.push(product);\r\n      }\r\n    } catch {\r\n      logger.warn({\r\n        module: 'ContentPlannerService',\r\n        productId\r\n      }, 'Failed to fetch product');\r\n    }\r\n  }\r\n\r\n  return products;\r\n}\r\n\r\n/**\r\n * Generate copy using copywritingService with template context\r\n */\r\nasync function generateCopy(\r\n  template: ContentTemplate,\r\n  products: Product[],\r\n  brandProfile: BrandProfile | null,\r\n  topic: string | undefined,\r\n  platform: string\r\n): Promise<CopyResult> {\r\n  // Map template category to campaign objective\r\n  const campaignObjective = mapCategoryToObjective(template.category);\r\n\r\n  // Map template to copywriting framework\r\n  const framework = inferFramework(template);\r\n\r\n  // Build product context\r\n  const productName = products.length > 0\r\n    ? products.map(p => p.name).join(' + ')\r\n    : topic || template.title;\r\n\r\n  const productDescription = buildProductDescription(products, template, topic);\r\n\r\n  // Build target audience from brand profile\r\n  const targetAudience = brandProfile ? {\r\n    demographics: String(brandProfile.targetAudience || 'B2B professionals'),\r\n    psychographics: 'Decision-makers seeking reliable solutions',\r\n    painPoints: ['Quality concerns', 'Delivery timing', 'Cost optimization'] as string[]\r\n  } : undefined;\r\n\r\n  // Build brand voice from profile\r\n  const brandVoice = brandProfile?.voice ? {\r\n    principles: (brandProfile.voice as any).principles || ['Professional', 'Trustworthy'],\r\n    wordsToAvoid: (brandProfile.voice as any).wordsToAvoid || [],\r\n    wordsToUse: (brandProfile.voice as any).wordsToUse || []\r\n  } : undefined;\r\n\r\n  // Add template hooks to the request\r\n  const input: GenerateCopyInput = {\r\n    generationId: `content-planner-${Date.now()}`,\r\n    platform: platform as any,\r\n    tone: 'authentic',\r\n    framework: framework as any,\r\n    campaignObjective: campaignObjective as any,\r\n    productName,\r\n    productDescription,\r\n    industry: brandProfile?.industry || 'Construction/Steel',\r\n    targetAudience,\r\n    brandVoice,\r\n    variations: 1\r\n  };\r\n\r\n  const results = await copywritingService.generateCopy(input);\r\n\r\n  if (results.length === 0) {\r\n    throw new Error('No copy variations generated');\r\n  }\r\n\r\n  return results[0];\r\n}\r\n\r\n/**\r\n * Generate image prompt for the template\r\n * Returns the prompt that should be used with /api/transform\r\n */\r\nasync function generateImage(\r\n  template: ContentTemplate,\r\n  products: Product[],\r\n  brandProfile: BrandProfile | null,\r\n  topic: string | undefined,\r\n  platform: string\r\n): Promise<ImageResult> {\r\n  // Build an image prompt based on template and products\r\n  const platformFormats: Record<string, string> = {\r\n    instagram: '1080x1080 square format',\r\n    linkedin: '1200x627 landscape format',\r\n    facebook: '1080x1080 square format',\r\n    twitter: '1200x675 landscape format',\r\n    tiktok: '1080x1920 portrait format'\r\n  };\r\n\r\n  const prompt = buildImagePrompt(template, products, brandProfile, topic, platformFormats[platform]);\r\n\r\n  // For now, return the prompt - the frontend will call /api/transform\r\n  // In the future, we could call the image generation directly here\r\n  return {\r\n    imageUrl: '', // Will be filled by /api/transform call\r\n    prompt\r\n  };\r\n}\r\n\r\n/**\r\n * Build image prompt from template and context\r\n */\r\nfunction buildImagePrompt(\r\n  template: ContentTemplate,\r\n  products: Product[],\r\n  brandProfile: BrandProfile | null,\r\n  topic: string | undefined,\r\n  format: string\r\n): string {\r\n  let prompt = `Generate a professional marketing image for a ${template.category} social media post.\r\n\r\nTEMPLATE: ${template.title}\r\n${template.description}\r\n\r\nFORMAT: ${format}\r\n`;\r\n\r\n  if (products.length > 0) {\r\n    prompt += `\r\nPRODUCTS TO FEATURE:\r\n${products.map(p => `- ${p.name}: ${p.description || 'Product image'}`).join('\\n')}\r\n\r\nIMPORTANT: The product(s) must be the hero/focus of the image.\r\n`;\r\n  }\r\n\r\n  if (topic) {\r\n    prompt += `\r\nTOPIC/ANGLE: ${topic}\r\n`;\r\n  }\r\n\r\n  if (brandProfile) {\r\n    prompt += `\r\nBRAND GUIDELINES (${brandProfile.brandName}):\r\n- Visual Style: ${brandProfile.preferredStyles?.join(', ') || 'Professional'}\r\n- Brand Colors: ${brandProfile.colorPreferences?.join(', ') || 'Standard'}\r\n`;\r\n  }\r\n\r\n  prompt += `\r\nSTYLE REQUIREMENTS:\r\n- Professional photography quality\r\n- Clean, modern aesthetic\r\n- No text overlays or watermarks\r\n- Appropriate for ${template.bestPlatforms[0]?.platform || 'social media'}\r\n`;\r\n\r\n  return prompt;\r\n}\r\n\r\n/**\r\n * Build product description from products and template\r\n */\r\nfunction buildProductDescription(\r\n  products: Product[],\r\n  template: ContentTemplate,\r\n  topic: string | undefined\r\n): string {\r\n  let description = '';\r\n\r\n  if (products.length > 0) {\r\n    description = products.map(p => {\r\n      let desc = p.name;\r\n      if (p.description) desc += `: ${p.description}`;\r\n      return desc;\r\n    }).join('\\n\\n');\r\n  }\r\n\r\n  if (topic) {\r\n    description += `\\n\\nTopic/Angle: ${topic}`;\r\n  }\r\n\r\n  description += `\\n\\nContent Type: ${template.title}`;\r\n  description += `\\n\\nHook Patterns to Use:\\n${template.hookFormulas.slice(0, 2).join('\\n')}`;\r\n\r\n  return description;\r\n}\r\n\r\n/**\r\n * Map template category to campaign objective\r\n */\r\nfunction mapCategoryToObjective(category: string): string {\r\n  const mapping: Record<string, string> = {\r\n    product_showcase: 'consideration',\r\n    educational: 'awareness',\r\n    industry_insights: 'awareness',\r\n    customer_success: 'conversion',\r\n    company_updates: 'engagement',\r\n    engagement: 'engagement'\r\n  };\r\n  return mapping[category] || 'awareness';\r\n}\r\n\r\n/**\r\n * Infer copywriting framework from template post structure\r\n */\r\nfunction inferFramework(template: ContentTemplate): string {\r\n  const structure = template.postStructure.toLowerCase();\r\n\r\n  if (structure.includes('problem') && structure.includes('agitate')) {\r\n    return 'pas';\r\n  }\r\n  if (structure.includes('before') && structure.includes('after')) {\r\n    return 'bab';\r\n  }\r\n  if (structure.includes('feature') && structure.includes('benefit')) {\r\n    return 'fab';\r\n  }\r\n  if (structure.includes('attention') || structure.includes('interest')) {\r\n    return 'aida';\r\n  }\r\n\r\n  return 'auto';\r\n}\r\n\r\n// Export as service object for clean imports\r\nexport const contentPlannerService = {\r\n  generateCompletePost\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\contentSafetyService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7814,7817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7814,7817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10822,10825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10822,10825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Content Safety Service - Phase 8.0 HITL Approval System\r\n *\r\n * Performs multi-layer content safety validation to ensure brand-safe content:\r\n * 1. Gemini Safety API for hate speech, violence, sexual content, harassment\r\n * 2. PII detection (emails, phones, SSN, credit cards)\r\n * 3. Prohibited words detection (from brand profile)\r\n * 4. Competitor brand mentions\r\n * 5. Overall brand safety scoring (0-100)\r\n *\r\n * Returns comprehensive safety checks for approval queue filtering.\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { storage } from '../storage';\r\nimport { HarmCategory, HarmBlockThreshold, HarmBlockMethod } from '@google/genai';\r\n\r\n// Fast model for safety checks\r\nconst SAFETY_MODEL = 'gemini-3-flash-preview';\r\n\r\n/**\r\n * Safety check results interface\r\n * All boolean flags: true = PASSED (safe), false = FAILED (unsafe)\r\n */\r\nexport interface SafetyChecks {\r\n  hateSpeech: boolean;          // true = no hate speech detected\r\n  violence: boolean;            // true = no violence detected\r\n  sexualContent: boolean;       // true = no sexual content detected\r\n  piiDetection: boolean;        // true = no PII detected\r\n  prohibitedWords: string[];    // List of prohibited words found\r\n  competitorMentions: string[]; // List of competitor brands mentioned\r\n  brandSafetyScore: number;     // 0-100 (100 = perfect, 0 = multiple critical issues)\r\n}\r\n\r\n/**\r\n * Parameters for content safety check\r\n */\r\nexport interface CheckSafetyParams {\r\n  caption: string;\r\n  imageUrl?: string;  // Optional: for future image-based safety checks\r\n  userId: string;\r\n}\r\n\r\n/**\r\n * Hardcoded list of common competitor brands in steel/manufacturing industry\r\n * TODO: Make this configurable per brand profile in future\r\n */\r\nconst COMMON_COMPETITORS = [\r\n  'AcelorMittal',\r\n  'Nucor',\r\n  'Steel Dynamics',\r\n  'U.S. Steel',\r\n  'United States Steel',\r\n  'Commercial Metals',\r\n  'CMC Steel',\r\n  'ArcelorMittal',\r\n  'POSCO',\r\n  'Nippon Steel',\r\n  'JFE Steel',\r\n  'Baosteel',\r\n  'Tata Steel',\r\n  'ThyssenKrupp',\r\n  'Gerdau',\r\n];\r\n\r\n/**\r\n * PII detection patterns\r\n */\r\nconst PII_PATTERNS = {\r\n  email: /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g,\r\n  phone: /\\b(\\+?1[-.\\s]?)?\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}\\b/g,\r\n  ssn: /\\b\\d{3}-\\d{2}-\\d{4}\\b/g,\r\n  creditCard: /\\b\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}\\b/g,\r\n};\r\n\r\n/**\r\n * Detect PII in text content\r\n * @returns true if NO PII found (safe), false if PII detected (unsafe)\r\n */\r\nfunction detectPII(text: string): boolean {\r\n  for (const [type, pattern] of Object.entries(PII_PATTERNS)) {\r\n    const matches = text.match(pattern);\r\n    if (matches && matches.length > 0) {\r\n      logger.warn({\r\n        piiType: type,\r\n        matchCount: matches.length,\r\n      }, 'PII detected in content');\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Detect prohibited words from brand profile\r\n * @returns Array of prohibited words found (case-insensitive)\r\n */\r\nfunction detectProhibitedWords(text: string, prohibitedWords: string[]): string[] {\r\n  if (!prohibitedWords || prohibitedWords.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const textLower = text.toLowerCase();\r\n  const found: string[] = [];\r\n\r\n  for (const word of prohibitedWords) {\r\n    const wordLower = word.toLowerCase();\r\n    // Use word boundary regex for exact word matching\r\n    const regex = new RegExp(`\\\\b${wordLower}\\\\b`, 'i');\r\n    if (regex.test(textLower)) {\r\n      found.push(word);\r\n    }\r\n  }\r\n\r\n  return found;\r\n}\r\n\r\n/**\r\n * Detect competitor brand mentions\r\n * @returns Array of competitor brands found (case-insensitive)\r\n */\r\nfunction detectCompetitors(text: string): string[] {\r\n  const textLower = text.toLowerCase();\r\n  const found: string[] = [];\r\n\r\n  for (const competitor of COMMON_COMPETITORS) {\r\n    const competitorLower = competitor.toLowerCase();\r\n    // Use word boundary regex for exact word matching\r\n    const regex = new RegExp(`\\\\b${competitorLower}\\\\b`, 'i');\r\n    if (regex.test(textLower)) {\r\n      found.push(competitor);\r\n    }\r\n  }\r\n\r\n  return found;\r\n}\r\n\r\n/**\r\n * Check content with Gemini Safety API\r\n * @returns Object with safety category results (true = safe, false = unsafe)\r\n */\r\nasync function checkGeminiSafety(\r\n  caption: string,\r\n  imageUrl?: string\r\n): Promise<{\r\n  hateSpeech: boolean;\r\n  violence: boolean;\r\n  sexualContent: boolean;\r\n  harassment: boolean;\r\n}> {\r\n  try {\r\n    // Build contents array\r\n    const parts: Array<{ text?: string; fileData?: { mimeType: string; fileUri: string } }> = [\r\n      { text: caption },\r\n    ];\r\n\r\n    // Add image if provided (for future image safety checks)\r\n    if (imageUrl) {\r\n      // Note: Image safety checks require file upload to Gemini File API first\r\n      // For now, we only check text content\r\n      logger.info({ imageUrl }, 'Image URL provided but not yet implemented for safety checks');\r\n    }\r\n\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: SAFETY_MODEL,\r\n        contents: [\r\n          {\r\n            role: 'user',\r\n            parts,\r\n          },\r\n        ],\r\n        config: {\r\n          // Configure strict safety settings\r\n          safetySettings: [\r\n            {\r\n              method: HarmBlockMethod.SEVERITY,\r\n              category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,\r\n              threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,\r\n            },\r\n            {\r\n              method: HarmBlockMethod.SEVERITY,\r\n              category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,\r\n              threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,\r\n            },\r\n            {\r\n              method: HarmBlockMethod.SEVERITY,\r\n              category: HarmCategory.HARM_CATEGORY_HARASSMENT,\r\n              threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,\r\n            },\r\n            {\r\n              method: HarmBlockMethod.SEVERITY,\r\n              category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,\r\n              threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,\r\n            },\r\n          ],\r\n          maxOutputTokens: 10, // We don't care about the output, just the safety ratings\r\n          temperature: 0,\r\n        },\r\n      },\r\n      { operation: 'content_safety_check' }\r\n    );\r\n\r\n    // Check safety ratings\r\n    // If content was blocked, the response will indicate which categories triggered\r\n    const safetyRatings = response.candidates?.[0]?.safetyRatings || [];\r\n\r\n    // Initialize all as safe\r\n    let hateSpeech = true;\r\n    let violence = true;\r\n    let sexualContent = true;\r\n    let harassment = true;\r\n\r\n    // Check each safety rating\r\n    for (const rating of safetyRatings) {\r\n      const isUnsafe = rating.probability === 'HIGH' || rating.probability === 'MEDIUM';\r\n\r\n      switch (rating.category) {\r\n        case HarmCategory.HARM_CATEGORY_HATE_SPEECH:\r\n          hateSpeech = !isUnsafe;\r\n          break;\r\n        case HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT:\r\n          violence = !isUnsafe;\r\n          break;\r\n        case HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT:\r\n          sexualContent = !isUnsafe;\r\n          break;\r\n        case HarmCategory.HARM_CATEGORY_HARASSMENT:\r\n          harassment = !isUnsafe;\r\n          break;\r\n      }\r\n    }\r\n\r\n    // Also check if content was blocked entirely\r\n    const wasBlocked = response.candidates?.[0]?.finishReason === 'SAFETY';\r\n    if (wasBlocked) {\r\n      logger.warn({ safetyRatings }, 'Content was blocked by Gemini Safety API');\r\n      // If blocked, mark all as unsafe to be conservative\r\n      return {\r\n        hateSpeech: false,\r\n        violence: false,\r\n        sexualContent: false,\r\n        harassment: false,\r\n      };\r\n    }\r\n\r\n    return { hateSpeech, violence, sexualContent, harassment };\r\n  } catch (error: any) {\r\n    // FAIL-CLOSED: If Gemini Safety API fails, default to BLOCK (all flags false = unsafe).\r\n    // This prevents unsafe content from passing through on API failures.\r\n    // Set SAFETY_FAIL_OPEN=true in non-production environments to bypass this.\r\n    const failOpen = process.env.SAFETY_FAIL_OPEN === 'true' && process.env.NODE_ENV !== 'production';\r\n\r\n    logger.warn({\r\n      err: error,\r\n      errorMessage: error?.message,\r\n      failOpen,\r\n    }, `Gemini Safety API failed, defaulting to ${failOpen ? 'PASS (dev override)' : 'BLOCK (fail-closed)'}`);\r\n\r\n    return {\r\n      hateSpeech: failOpen,\r\n      violence: failOpen,\r\n      sexualContent: failOpen,\r\n      harassment: failOpen,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate brand safety score (0-100)\r\n * 100 = perfect (all checks passed)\r\n * 0 = multiple critical issues\r\n */\r\nfunction calculateBrandSafetyScore(checks: {\r\n  hateSpeech: boolean;\r\n  violence: boolean;\r\n  sexualContent: boolean;\r\n  harassment: boolean;\r\n  piiDetection: boolean;\r\n  prohibitedWords: string[];\r\n  competitorMentions: string[];\r\n}): number {\r\n  let score = 100;\r\n\r\n  // Critical failures (instant fail)\r\n  if (!checks.hateSpeech) score -= 100;\r\n  if (!checks.violence) score -= 100;\r\n  if (!checks.sexualContent) score -= 100;\r\n  if (!checks.harassment) score -= 100;\r\n\r\n  // Major issues\r\n  if (!checks.piiDetection) score -= 50;\r\n\r\n  // Minor issues\r\n  if (checks.prohibitedWords.length > 0) {\r\n    score -= 10 * checks.prohibitedWords.length;\r\n  }\r\n\r\n  if (checks.competitorMentions.length > 0) {\r\n    score -= 20 * checks.competitorMentions.length;\r\n  }\r\n\r\n  // Ensure score doesn't go below 0\r\n  return Math.max(0, score);\r\n}\r\n\r\n/**\r\n * Main function: Check content safety with multi-layer validation\r\n *\r\n * @param params - Content to check (caption, optional imageUrl, userId)\r\n * @returns Comprehensive safety check results\r\n *\r\n * Usage:\r\n * ```typescript\r\n * const safetyChecks = await checkContentSafety({\r\n *   caption: \"Check out our new product!\",\r\n *   userId: \"user-123\",\r\n * });\r\n *\r\n * if (safetyChecks.brandSafetyScore < 80) {\r\n *   // Flag for manual review\r\n * }\r\n * ```\r\n */\r\nexport async function checkContentSafety(\r\n  params: CheckSafetyParams\r\n): Promise<SafetyChecks> {\r\n  const { caption, imageUrl, userId } = params;\r\n\r\n  logger.info({\r\n    userId,\r\n    captionLength: caption.length,\r\n    hasImage: !!imageUrl,\r\n  }, 'Starting content safety check');\r\n\r\n  // STEP 1: Gemini Safety API check\r\n  const geminiChecks = await checkGeminiSafety(caption, imageUrl);\r\n\r\n  // STEP 2: PII detection\r\n  const piiDetection = detectPII(caption);\r\n\r\n  // STEP 3: Fetch brand profile for prohibited words\r\n  let prohibitedWords: string[] = [];\r\n  try {\r\n    const brandProfile = await storage.getBrandProfileByUserId(userId);\r\n    if (brandProfile?.voice && typeof brandProfile.voice === 'object') {\r\n      const voice = brandProfile.voice as { wordsToAvoid?: string[] };\r\n      prohibitedWords = voice.wordsToAvoid || [];\r\n    }\r\n  } catch (error: any) {\r\n    logger.warn({\r\n      err: error,\r\n      userId,\r\n    }, 'Failed to fetch brand profile for prohibited words check');\r\n  }\r\n\r\n  // STEP 4: Prohibited words detection\r\n  const prohibitedWordsFound = detectProhibitedWords(caption, prohibitedWords);\r\n\r\n  // STEP 5: Competitor detection\r\n  const competitorMentions = detectCompetitors(caption);\r\n\r\n  // STEP 6: Calculate brand safety score\r\n  const brandSafetyScore = calculateBrandSafetyScore({\r\n    ...geminiChecks,\r\n    piiDetection,\r\n    prohibitedWords: prohibitedWordsFound,\r\n    competitorMentions,\r\n  });\r\n\r\n  const result: SafetyChecks = {\r\n    hateSpeech: geminiChecks.hateSpeech,\r\n    violence: geminiChecks.violence,\r\n    sexualContent: geminiChecks.sexualContent,\r\n    piiDetection,\r\n    prohibitedWords: prohibitedWordsFound,\r\n    competitorMentions,\r\n    brandSafetyScore,\r\n  };\r\n\r\n  logger.info({\r\n    userId,\r\n    result,\r\n  }, 'Content safety check completed');\r\n\r\n  return result;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\copywritingService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4217,4220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4217,4220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '../lib/logger';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport type { GenerateCopyInput } from '../validation/schemas';\r\nimport { getFileSearchStoreForGeneration, queryFileSearchStore, FileCategory } from './fileSearchService';\r\nimport { sanitizeForPrompt } from '../lib/promptSanitizer';\r\nimport { safeParseLLMResponse, generatedCopySchema } from '../validation/llmResponseSchemas';\r\nimport { productKnowledgeService, type EnhancedProductContext } from './productKnowledgeService';\r\n\r\n// Platform character limits (2025 standards)\r\ninterface PlatformLimits {\r\n  headline: { optimal: number; max: number };\r\n  hook: { optimal: number; max: number };\r\n  primaryText: { optimal: number; max: number };\r\n  caption: { optimal: number; max: number };\r\n  description?: { optimal: number; max: number };\r\n}\r\n\r\nconst PLATFORM_LIMITS: Record<string, PlatformLimits> = {\r\n  instagram: {\r\n    headline: { optimal: 40, max: 40 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 125, max: 2200 },\r\n    caption: { optimal: 125, max: 2200 },\r\n  },\r\n  linkedin: {\r\n    headline: { optimal: 150, max: 150 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 150, max: 600 },\r\n    caption: { optimal: 150, max: 600 },\r\n    description: { optimal: 45, max: 45 },\r\n  },\r\n  facebook: {\r\n    headline: { optimal: 27, max: 27 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 125, max: 500 },\r\n    caption: { optimal: 125, max: 500 },\r\n    description: { optimal: 27, max: 27 },\r\n  },\r\n  twitter: {\r\n    headline: { optimal: 23, max: 23 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 257, max: 280 },\r\n    caption: { optimal: 257, max: 280 },\r\n  },\r\n  tiktok: {\r\n    headline: { optimal: 40, max: 40 },\r\n    hook: { optimal: 60, max: 60 },\r\n    primaryText: { optimal: 100, max: 150 },\r\n    caption: { optimal: 100, max: 150 },\r\n  },\r\n};\r\n\r\ninterface GeneratedCopy {\r\n  headline: string;\r\n  hook: string;\r\n  bodyText: string;\r\n  cta: string;\r\n  caption: string;\r\n  hashtags: string[];\r\n  framework: string;\r\n  qualityScore: {\r\n    clarity: number;\r\n    persuasiveness: number;\r\n    platformFit: number;\r\n    brandAlignment: number;\r\n    overallScore: number;\r\n    reasoning: string;\r\n  };\r\n  characterCounts: {\r\n    headline: number;\r\n    hook: number;\r\n    body: number;\r\n    caption: number;\r\n    total: number;\r\n  };\r\n}\r\n\r\nclass CopywritingService {\r\n  // No constructor needed - uses shared client\r\n\r\n  /**\r\n   * Generate ad copy with multiple variations using PTCF prompt framework\r\n   *\r\n   * @param request - The validated copy generation input\r\n   * @param options - Optional enrichment: productId + userId to auto-fetch product knowledge\r\n   */\r\n  async generateCopy(\r\n    request: GenerateCopyInput,\r\n    options?: { productId?: string; userId?: string },\r\n  ): Promise<GeneratedCopy[]> {\r\n    // Build enhanced product context if productId + userId are provided\r\n    let enhancedContext: EnhancedProductContext | null = null;\r\n    if (options?.productId && options?.userId) {\r\n      try {\r\n        enhancedContext = await productKnowledgeService.buildEnhancedContext(options.productId, options.userId);\r\n        if (enhancedContext) {\r\n          logger.info(\r\n            { module: 'Copywriting', productId: options.productId },\r\n            'Enhanced product context loaded for copy generation',\r\n          );\r\n        }\r\n      } catch (err) {\r\n        logger.warn({ module: 'Copywriting', err }, 'Failed to load enhanced product context, continuing without it');\r\n      }\r\n    }\r\n\r\n    const variations: GeneratedCopy[] = [];\r\n\r\n    for (let i = 0; i < request.variations; i++) {\r\n      const copy = await this.generateSingleCopy(request, i + 1, enhancedContext);\r\n      variations.push(copy);\r\n    }\r\n\r\n    return variations;\r\n  }\r\n\r\n  /**\r\n   * Generate a single copy variation with RAG enhancement\r\n   */\r\n  async generateSingleCopy(\r\n    request: GenerateCopyInput,\r\n    variationNumber: number,\r\n    enhancedContext?: EnhancedProductContext | null,\r\n  ): Promise<GeneratedCopy> {\r\n    // STEP 1: Retrieve relevant context from File Search Store (RAG)\r\n    let ragContext = '';\r\n    let citations: any[] = [];\r\n\r\n    try {\r\n      const _fileSearchStore = await getFileSearchStoreForGeneration();\r\n\r\n      // Query for ad examples matching the product/platform\r\n      const contextQuery = `${request.platform} ad examples for ${request.productName} ${request.industry} ${request.productDescription}`;\r\n      const searchResult = await queryFileSearchStore({\r\n        query: contextQuery,\r\n        category: FileCategory.AD_EXAMPLES,\r\n        maxResults: 3,\r\n      });\r\n\r\n      if (searchResult) {\r\n        ragContext = searchResult.context;\r\n        citations = searchResult.citations || [];\r\n        logger.info(\r\n          { module: 'Copywriting', contextLength: ragContext.length, citationCount: citations.length },\r\n          'Retrieved RAG context',\r\n        );\r\n      } else {\r\n        logger.info({ module: 'Copywriting' }, 'No RAG context found for this query');\r\n      }\r\n    } catch (error) {\r\n      logger.warn({ module: 'Copywriting', err: error }, 'File Search not available, continuing without RAG context');\r\n      // Continue without RAG if File Search fails - graceful degradation\r\n    }\r\n\r\n    // STEP 2: Build enhanced prompt with RAG context and product knowledge\r\n    const prompt = this.buildPTCFPromptWithRAG(request, variationNumber, ragContext, enhancedContext);\r\n\r\n    // STEP 3: Generate with File Search tool enabled\r\n    // Configure with File Search tool if available\r\n    let tools: Array<{ fileSearch: { fileSearchStoreNames: string[] } }> | undefined = undefined;\r\n    try {\r\n      const fileSearchStore = await getFileSearchStoreForGeneration();\r\n      if (fileSearchStore) {\r\n        tools = [\r\n          {\r\n            fileSearch: {\r\n              fileSearchStoreNames: [fileSearchStore],\r\n            },\r\n          },\r\n        ];\r\n      }\r\n    } catch {\r\n      // No File Search available, continue without tools\r\n    }\r\n\r\n    // MODEL RECENCY RULE: Before changing any model ID, verify today's date and confirm the model is current within the last 3-4 weeks.\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: 'gemini-3-pro-preview',\r\n        contents: [\r\n          {\r\n            role: 'user',\r\n            parts: [{ text: prompt }],\r\n          },\r\n        ],\r\n        config: {\r\n          responseModalities: ['TEXT'],\r\n          responseMimeType: 'application/json',\r\n          responseSchema: this.getResponseSchema(request.platform),\r\n        },\r\n        ...(tools && { tools }),\r\n      },\r\n      { operation: 'ad_copy_generation' },\r\n    );\r\n    const text = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n    const generatedCopy = safeParseLLMResponse(text, generatedCopySchema, 'ad_copy_generation');\r\n\r\n    // Calculate character counts\r\n    const characterCounts = {\r\n      headline: generatedCopy.headline.length,\r\n      hook: generatedCopy.hook.length,\r\n      body: generatedCopy.bodyText.length,\r\n      caption: generatedCopy.caption.length,\r\n      total:\r\n        generatedCopy.headline.length +\r\n        generatedCopy.hook.length +\r\n        generatedCopy.bodyText.length +\r\n        generatedCopy.caption.length,\r\n    };\r\n\r\n    return {\r\n      ...generatedCopy,\r\n      characterCounts,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Build PTCF (Persona, Task, Context, Format) prompt\r\n   */\r\n  private buildPTCFPrompt(request: GenerateCopyInput, variationNumber: number): string {\r\n    const limits = PLATFORM_LIMITS[request.platform];\r\n\r\n    // PERSONA\r\n    const persona = `You are an expert social media ad copywriter specializing in ${request.platform} advertising. You have 10+ years of experience writing conversion-focused copy for ${request.industry} brands. You understand platform algorithms, user behavior, and what drives engagement.`;\r\n\r\n    // TASK\r\n    const framework =\r\n      request.framework === 'auto' || !request.framework\r\n        ? 'the most effective copywriting framework for this campaign'\r\n        : request.framework.toUpperCase();\r\n\r\n    const task = `Write compelling ad copy variation #${variationNumber} for a ${request.platform} advertisement using ${framework} framework. This copy must grab attention in 3-8 seconds, resonate with the target audience, and drive them to take action.`;\r\n\r\n    const s = (v: string) => sanitizeForPrompt(v, { maxLength: 500, context: 'copy_ptcf' });\r\n\r\n    // CONTEXT\r\n    const context = `\r\nPRODUCT INFORMATION:\r\n- Name: ${s(request.productName)}\r\n- Description: ${s(request.productDescription)}\r\n${request.productBenefits ? `- Key Benefits: ${request.productBenefits.map(s).join(', ')}` : ''}\r\n${request.uniqueValueProp ? `- Unique Value: ${s(request.uniqueValueProp)}` : ''}\r\n- Industry: ${s(request.industry)}\r\n\r\n${request.campaignObjective ? `CAMPAIGN GOAL: ${s(request.campaignObjective).toUpperCase()}` : ''}\r\n\r\nTARGET AUDIENCE:\r\n${\r\n  request.targetAudience\r\n    ? `\r\n- Demographics: ${s(request.targetAudience.demographics)}\r\n- Psychographics: ${s(request.targetAudience.psychographics)}\r\n- Pain Points: ${request.targetAudience.painPoints.map(s).join(', ')}\r\n`\r\n    : 'General audience - use broad appeal messaging'\r\n}\r\n\r\nBRAND VOICE & TONE:\r\n${\r\n  request.brandVoice\r\n    ? `\r\n- Core Principles: ${request.brandVoice.principles.map(s).join(', ')}\r\n- Words to USE: ${request.brandVoice.wordsToUse?.map(s).join(', ') || 'N/A'}\r\n- Words to AVOID: ${request.brandVoice.wordsToAvoid?.map(s).join(', ') || 'N/A'}\r\n`\r\n    : `Tone: ${s(request.tone.charAt(0).toUpperCase() + request.tone.slice(1))}`\r\n}\r\n\r\n${\r\n  request.socialProof\r\n    ? `\r\nSOCIAL PROOF (incorporate if relevant):\r\n${request.socialProof.testimonial ? s(request.socialProof.testimonial) : ''}\r\n${request.socialProof.stats ? s(request.socialProof.stats) : ''}\r\n`\r\n    : ''\r\n}\r\n\r\nPLATFORM REQUIREMENTS (${request.platform.toUpperCase()}):\r\n${this.getPlatformRequirements(request.platform)}\r\n\r\nCHARACTER LIMITS (STRICT):\r\n- Headline: max ${limits.headline.max} characters (optimal: ${limits.headline.optimal})\r\n- Hook: max ${limits.hook.max} characters (optimal: ${limits.hook.optimal})\r\n- Body Text: max ${limits.primaryText.max} characters (optimal: ${limits.primaryText.optimal})\r\n- Caption: max ${limits.caption.max} characters (optimal: ${limits.caption.optimal})\r\n\r\nCOPYWRITING FRAMEWORK:\r\n${this.getFrameworkGuidance(request.framework || 'auto', request.campaignObjective)}\r\n\r\nHOOK REQUIREMENTS:\r\n${this.getHookGuidance(request.platform, request.campaignObjective)}\r\n\r\nVARIATION REQUIREMENTS:\r\nThis is variation #${variationNumber}. Make it distinct from other variations while maintaining brand consistency.\r\n${variationNumber === 1 ? '- Focus on emotional appeal' : ''}\r\n${variationNumber === 2 ? '- Focus on logical benefits and proof' : ''}\r\n${variationNumber === 3 ? '- Focus on urgency and scarcity' : ''}\r\n`;\r\n\r\n    // FORMAT\r\n    return `${persona}\\n\\n${task}\\n\\n${context}\\n\\nIMPORTANT: Return ONLY valid JSON matching the schema. No markdown, no explanations.`;\r\n  }\r\n\r\n  /**\r\n   * Build PTCF prompt with RAG context and product knowledge (enhanced version)\r\n   */\r\n  private buildPTCFPromptWithRAG(\r\n    request: GenerateCopyInput,\r\n    variationNumber: number,\r\n    ragContext: string,\r\n    enhancedContext?: EnhancedProductContext | null,\r\n  ): string {\r\n    const limits = PLATFORM_LIMITS[request.platform];\r\n\r\n    // PERSONA\r\n    const persona = `You are an expert social media ad copywriter specializing in ${request.platform} advertising. You have 10+ years of experience writing conversion-focused copy for ${request.industry} brands. You understand platform algorithms, user behavior, and what drives engagement.`;\r\n\r\n    // TASK\r\n    const framework =\r\n      request.framework === 'auto' || !request.framework\r\n        ? 'the most effective copywriting framework for this campaign'\r\n        : request.framework.toUpperCase();\r\n\r\n    const task = `Write compelling ad copy variation #${variationNumber} for a ${request.platform} advertisement using ${framework} framework. This copy must grab attention in 3-8 seconds, resonate with the target audience, and drive them to take action.`;\r\n\r\n    // RAG CONTEXT\r\n    const ragSection = ragContext\r\n      ? `\r\nREFERENCE MATERIALS FROM KNOWLEDGE BASE:\r\n${ragContext}\r\n\r\nIMPORTANT: Use these reference materials as inspiration and context, but do NOT copy them directly. Adapt the successful patterns, hooks, and approaches to match THIS specific product and audience.\r\n`\r\n      : '';\r\n\r\n    const s = (v: string) => sanitizeForPrompt(v, { maxLength: 500, context: 'copy_ptcf_rag' });\r\n\r\n    // PRODUCT KNOWLEDGE SECTION  enriched from productKnowledgeService\r\n    let productKnowledgeSection = '';\r\n    if (enhancedContext) {\r\n      const pkParts: string[] = [];\r\n\r\n      // Product features (key-value pairs from product DB)\r\n      const features = enhancedContext.product.features;\r\n      if (features && typeof features === 'object' && Object.keys(features).length > 0) {\r\n        const featureLines = Object.entries(features)\r\n          .slice(0, 10)\r\n          .map(([k, v]) => `  - ${k}: ${v}`)\r\n          .join('\\n');\r\n        pkParts.push(`Product Features:\\n${featureLines}`);\r\n      }\r\n\r\n      // Product specifications\r\n      const specs = enhancedContext.product.specifications;\r\n      if (specs && typeof specs === 'object' && Object.keys(specs).length > 0) {\r\n        const specLines = Object.entries(specs)\r\n          .slice(0, 10)\r\n          .map(([k, v]) => `  - ${k}: ${v}`)\r\n          .join('\\n');\r\n        pkParts.push(`Technical Specifications:\\n${specLines}`);\r\n      }\r\n\r\n      // Product benefits (from DB, supplement what caller may have already provided)\r\n      const dbBenefits = enhancedContext.product.benefits;\r\n      if (dbBenefits && dbBenefits.length > 0) {\r\n        pkParts.push(`Product Benefits: ${dbBenefits.slice(0, 6).join(', ')}`);\r\n      }\r\n\r\n      // Product category and tags\r\n      if (enhancedContext.product.category) {\r\n        pkParts.push(`Product Category: ${enhancedContext.product.category}`);\r\n      }\r\n      if (enhancedContext.product.tags && enhancedContext.product.tags.length > 0) {\r\n        pkParts.push(`Product Tags: ${enhancedContext.product.tags.slice(0, 8).join(', ')}`);\r\n      }\r\n\r\n      // Enrichment draft data (AI-scraped info like use cases, installation context)\r\n      const draft = enhancedContext.product.enrichmentDraft as Record<string, unknown> | undefined;\r\n      if (draft && typeof draft === 'object') {\r\n        if (draft['installationContext']) {\r\n          pkParts.push(`Installation Context: ${s(String(draft['installationContext']))}`);\r\n        }\r\n        const useCases = draft['useCases'];\r\n        if (Array.isArray(useCases) && useCases.length > 0) {\r\n          pkParts.push(`Real-World Use Cases: ${(useCases as string[]).slice(0, 5).join(', ')}`);\r\n        }\r\n      }\r\n\r\n      // Related products (complementary/pairs with)\r\n      if (enhancedContext.relatedProducts.length > 0) {\r\n        const relatedLines = enhancedContext.relatedProducts\r\n          .slice(0, 4)\r\n          .map(\r\n            (rp) =>\r\n              `  - ${rp.product.name} (${rp.relationshipType}${rp.relationshipDescription ? ': ' + rp.relationshipDescription : ''})`,\r\n          )\r\n          .join('\\n');\r\n        pkParts.push(`Related Products (can reference in copy for cross-sell / bundling):\\n${relatedLines}`);\r\n      }\r\n\r\n      // Installation scenarios\r\n      if (enhancedContext.installationScenarios.length > 0) {\r\n        const scenarioLines = enhancedContext.installationScenarios\r\n          .slice(0, 3)\r\n          .map((sc) => `  - ${sc.title}: ${sc.description.slice(0, 120)}`)\r\n          .join('\\n');\r\n        pkParts.push(\r\n          `Installation / Usage Scenarios (can reference for how-to or educational copy):\\n${scenarioLines}`,\r\n        );\r\n      }\r\n\r\n      if (pkParts.length > 0) {\r\n        productKnowledgeSection = `\\nDEEP PRODUCT KNOWLEDGE (use this to write specific, accurate copy  never invent product details):\\n${pkParts.join('\\n\\n')}\\n`;\r\n      }\r\n    }\r\n\r\n    // CONTEXT (core request data, with sanitization)\r\n    const context = `\r\nPRODUCT INFORMATION:\r\n- Name: ${s(request.productName)}\r\n- Description: ${s(request.productDescription)}\r\n${request.productBenefits ? `- Key Benefits: ${request.productBenefits.map(s).join(', ')}` : ''}\r\n${request.uniqueValueProp ? `- Unique Value: ${s(request.uniqueValueProp)}` : ''}\r\n- Industry: ${s(request.industry)}\r\n${productKnowledgeSection}\r\n${request.campaignObjective ? `CAMPAIGN GOAL: ${s(request.campaignObjective).toUpperCase()}` : ''}\r\n\r\nTARGET AUDIENCE:\r\n${\r\n  request.targetAudience\r\n    ? `\r\n- Demographics: ${s(request.targetAudience.demographics)}\r\n- Psychographics: ${s(request.targetAudience.psychographics)}\r\n- Pain Points: ${request.targetAudience.painPoints.map(s).join(', ')}\r\n`\r\n    : 'General audience - use broad appeal messaging'\r\n}\r\n\r\nBRAND VOICE & TONE:\r\n${\r\n  request.brandVoice\r\n    ? `\r\n- Core Principles: ${request.brandVoice.principles.map(s).join(', ')}\r\n- Words to USE: ${request.brandVoice.wordsToUse?.map(s).join(', ') || 'N/A'}\r\n- Words to AVOID: ${request.brandVoice.wordsToAvoid?.map(s).join(', ') || 'N/A'}\r\n`\r\n    : `Tone: ${s(request.tone.charAt(0).toUpperCase() + request.tone.slice(1))}`\r\n}\r\n\r\n${\r\n  request.socialProof\r\n    ? `\r\nSOCIAL PROOF (incorporate if relevant):\r\n${request.socialProof.testimonial ? s(request.socialProof.testimonial) : ''}\r\n${request.socialProof.stats ? s(request.socialProof.stats) : ''}\r\n`\r\n    : ''\r\n}\r\n\r\nPLATFORM REQUIREMENTS (${request.platform.toUpperCase()}):\r\n${this.getPlatformRequirements(request.platform)}\r\n\r\nCHARACTER LIMITS (STRICT):\r\n- Headline: max ${limits.headline.max} characters (optimal: ${limits.headline.optimal})\r\n- Hook: max ${limits.hook.max} characters (optimal: ${limits.hook.optimal})\r\n- Body Text: max ${limits.primaryText.max} characters (optimal: ${limits.primaryText.optimal})\r\n- Caption: max ${limits.caption.max} characters (optimal: ${limits.caption.optimal})\r\n\r\nCOPYWRITING FRAMEWORK:\r\n${this.getFrameworkGuidance(request.framework || 'auto', request.campaignObjective)}\r\n\r\nHOOK REQUIREMENTS:\r\n${this.getHookGuidance(request.platform, request.campaignObjective)}\r\n\r\nVARIATION REQUIREMENTS:\r\nThis is variation #${variationNumber}. Make it distinct from other variations while maintaining brand consistency.\r\n${variationNumber === 1 ? '- Focus on emotional appeal' : ''}\r\n${variationNumber === 2 ? '- Focus on logical benefits and proof' : ''}\r\n${variationNumber === 3 ? '- Focus on urgency and scarcity' : ''}\r\n`;\r\n\r\n    // FORMAT\r\n    return `${persona}\\n\\n${task}\\n\\n${ragSection}\\n${context}\\n\\nIMPORTANT: Return ONLY valid JSON matching the schema. No markdown, no explanations.`;\r\n  }\r\n\r\n  /**\r\n   * Platform-specific requirements (2025 best practices)\r\n   */\r\n  private getPlatformRequirements(platform: string): string {\r\n    const requirements: Record<string, string> = {\r\n      instagram: `\r\n- Visual-first: Copy must complement imagery\r\n- Casual, authentic, relatable tone\r\n- Use 3-5 hashtags max in ads (hashtags DON'T improve reach in ads)\r\n- Explicit CTAs perform better (\"Shop Now\", \"Learn More\")\r\n- First 125 characters are critical (shown before \"...more\")\r\n- Emojis can boost engagement but use sparingly (1-2 max)\r\n`,\r\n      linkedin: `\r\n- Lead with insight, NOT sales pitch\r\n- Thought leadership angle (1.7x higher CTR than promotional)\r\n- Professional but authentic tone (authenticity beats polish)\r\n- Shorter paragraphs, easier to skim\r\n- B2B audience: focus on ROI, efficiency, expertise\r\n- First 150 characters shown before \"...see more\"\r\n`,\r\n      facebook: `\r\n- Community-focused messaging\r\n- Social proof is CRITICAL (reviews, testimonials, user stats)\r\n- Skimmable format: short sentences, line breaks\r\n- Longer copy OK for high-ticket items (but keep it scannable)\r\n- Conversational tone, speak directly to reader\r\n- Strong CTA buttons perform best\r\n`,\r\n      twitter: `\r\n- Posts <100 chars get 17% more engagement\r\n- Punchy, concise, conversational\r\n- Join trending conversations when relevant\r\n- Use lists, numbers, specific stats\r\n- Thread-style narrative for complex messages\r\n- Strong hook in first 23 characters\r\n`,\r\n      tiktok: `\r\n- First 3 seconds are CRITICAL\r\n- UGC/\"lo-fi\" aesthetic beats polished ads\r\n- Authentic > corporate\r\n- Trending sounds + native editing style\r\n- \"Blend in while standing out\"\r\n- Conversational, casual language\r\n`,\r\n    };\r\n\r\n    return requirements[platform] || '';\r\n  }\r\n\r\n  /**\r\n   * Copywriting framework guidance\r\n   */\r\n  private getFrameworkGuidance(framework: string, _objective?: string): string {\r\n    if (framework === 'auto') {\r\n      return `\r\nAUTO-SELECT FRAMEWORK:\r\nBased on the campaign objective, choose the most effective framework:\r\n- AWARENESS: Use AIDA or PAS (grab attention + educate)\r\n- CONSIDERATION: Use BAB or FAB (show transformation)\r\n- CONVERSION: Use PAS (agitate pain, present solution)\r\n- ENGAGEMENT: Use AIDA (build desire, encourage action)\r\n\r\nExplain your choice in the qualityScore.reasoning field.\r\n`;\r\n    }\r\n\r\n    const frameworks: Record<string, string> = {\r\n      aida: `\r\nAIDA FRAMEWORK:\r\n1. ATTENTION: Hook that stops the scroll (stat, question, bold claim)\r\n2. INTEREST: Build curiosity about the product/benefit\r\n3. DESIRE: Make them want it (emotional appeal, social proof, FOMO)\r\n4. ACTION: Clear, specific CTA\r\n\r\nExample: \"87% of users see results in 7 days [A]. Here's how our AI-powered system works [I]. Imagine cutting your workload in half [D]. Start your free trial today [A].\"\r\n`,\r\n      pas: `\r\nPAS FRAMEWORK:\r\n1. PROBLEM: Identify the pain point your audience faces\r\n2. AGITATE: Make the problem feel urgent and costly\r\n3. SOLUTION: Present your product as the answer\r\n\r\nExample: \"Still manually scheduling 50+ posts per week? [P] Every hour spent on scheduling is an hour lost to strategy [A]. Our AI does it in 60 seconds [S].\"\r\n`,\r\n      bab: `\r\nBAB FRAMEWORK:\r\n1. BEFORE: Paint the current frustrating situation\r\n2. AFTER: Show the transformed future state\r\n3. BRIDGE: Explain how your product gets them there\r\n\r\nExample: \"Before: 6 hours/week on content scheduling. After: 10 minutes with full automation. Bridge: Our AI learns your brand voice and schedules perfectly.\"\r\n`,\r\n      fab: `\r\nFAB FRAMEWORK:\r\n1. FEATURES: What the product does (specific capabilities)\r\n2. ADVANTAGES: Why those features matter (benefits)\r\n3. BENEFITS: How it improves the customer's life\r\n\r\nExample: \"Multi-platform posting [F] = reach all audiences at once [A] = 3x more engagement with less effort [B].\"\r\n`,\r\n    };\r\n\r\n    return frameworks[framework.toLowerCase()] || frameworks.aida;\r\n  }\r\n\r\n  /**\r\n   * Hook pattern guidance\r\n   */\r\n  private getHookGuidance(platform: string, objective?: string): string {\r\n    return `\r\nThe HOOK is your most important element. You have 3-8 seconds to grab attention.\r\n\r\nPROVEN HOOK PATTERNS:\r\n1. PATTERN INTERRUPT: Unexpected opening that breaks the scroll\r\n   Example: \"I quit my 6-figure job for this...\" \"This sounds crazy but...\"\r\n\r\n2. QUESTION HOOK: Thought-provoking question that targets pain point\r\n   Example: \"Still losing 40% of leads at checkout?\" \"What if you could 10x your output?\"\r\n\r\n3. STAT HOOK: Surprising, specific statistic\r\n   Example: \"87% of ${platform} users miss this critical feature\" \"3 out of 4 professionals waste 15 hours/week on this\"\r\n\r\n4. PAIN POINT: Relatable frustration statement\r\n   Example: \"Tired of [specific pain]? Here's why...\" \"If you're struggling with [problem]...\"\r\n\r\n5. BENEFIT PROMISE: Bold outcome claim\r\n   Example: \"Double your engagement in 30 days\" \"Cut costs by 50% starting today\"\r\n\r\n6. EVEN IF/WITHOUT: Soothe objections upfront\r\n   Example: \"Even if you have zero experience...\" \"Get results without changing your workflow\"\r\n\r\nChoose the pattern that best fits:\r\n${objective === 'awareness' ? '- Use Stats or Questions for education' : ''}\r\n${objective === 'consideration' ? '- Use Pain Point or BAB for resonance' : ''}\r\n${objective === 'conversion' ? '- Use Benefit Promise or Even If for urgency' : ''}\r\n`;\r\n  }\r\n\r\n  /**\r\n   * Response schema for Gemini (ensures structured JSON output)\r\n   */\r\n  private getResponseSchema(platform: string) {\r\n    const limits = PLATFORM_LIMITS[platform];\r\n\r\n    return {\r\n      type: 'object',\r\n      properties: {\r\n        headline: {\r\n          type: 'string',\r\n          description: `Attention-grabbing headline (max ${limits.headline.max} chars)`,\r\n          maxLength: limits.headline.max,\r\n        },\r\n        hook: {\r\n          type: 'string',\r\n          description: `Opening hook that stops the scroll (max ${limits.hook.max} chars)`,\r\n          maxLength: limits.hook.max,\r\n        },\r\n        bodyText: {\r\n          type: 'string',\r\n          description: `Main copy body (max ${limits.primaryText.max} chars)`,\r\n          maxLength: limits.primaryText.max,\r\n        },\r\n        cta: {\r\n          type: 'string',\r\n          description: 'Clear call-to-action (max 30 chars)',\r\n          maxLength: 30,\r\n        },\r\n        caption: {\r\n          type: 'string',\r\n          description: `Full caption text (max ${limits.caption.max} chars)`,\r\n          maxLength: limits.caption.max,\r\n        },\r\n        hashtags: {\r\n          type: 'array',\r\n          description: 'Relevant hashtags (3-5 for ads)',\r\n          items: { type: 'string' },\r\n          minItems: 3,\r\n          maxItems: 5,\r\n        },\r\n        framework: {\r\n          type: 'string',\r\n          description: 'Framework used (AIDA, PAS, BAB, FAB)',\r\n          enum: ['AIDA', 'PAS', 'BAB', 'FAB'],\r\n        },\r\n        qualityScore: {\r\n          type: 'object',\r\n          description: 'Self-assessment of copy quality',\r\n          properties: {\r\n            clarity: { type: 'number', minimum: 1, maximum: 10 },\r\n            persuasiveness: { type: 'number', minimum: 1, maximum: 10 },\r\n            platformFit: { type: 'number', minimum: 1, maximum: 10 },\r\n            brandAlignment: { type: 'number', minimum: 1, maximum: 10 },\r\n            overallScore: { type: 'number', minimum: 1, maximum: 10 },\r\n            reasoning: { type: 'string', description: 'Why this approach works' },\r\n          },\r\n          required: ['clarity', 'persuasiveness', 'platformFit', 'brandAlignment', 'overallScore', 'reasoning'],\r\n        },\r\n      },\r\n      required: ['headline', 'hook', 'bodyText', 'cta', 'caption', 'hashtags', 'framework', 'qualityScore'],\r\n    };\r\n  }\r\n}\r\n\r\nexport const copywritingService = new CopywritingService();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\encryptionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichmentServiceWithUrl.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExtractedData' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ExtractedData"},"fix":{"range":[662,682],"text":""},"desc":"Remove unused variable \"ExtractedData\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2668,2671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2668,2671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5344,5347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5344,5347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8826,8829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8826,8829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9359,9362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9359,9362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9444,9447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9444,9447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * URL-Based Product Enrichment Service\r\n *\r\n * Enriches a product from a user-provided URL by:\r\n * 1. Fetching content from the URL\r\n * 2. Running through extraction + verification gates\r\n * 3. Returning enrichment draft with confidence scores\r\n *\r\n * This is a streamlined version of the full pipeline that uses a\r\n * single user-provided URL instead of auto-discovering sources.\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { storage } from '../storage';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { extractFeatures, extractBenefits, extractTags } from './enrichment/dataExtraction';\r\nimport { SOURCE_TRUST_LEVELS, type ExtractedData } from './enrichment/types';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface UrlEnrichmentInput {\r\n  productId: string;\r\n  productUrl: string;\r\n}\r\n\r\nexport interface UrlEnrichmentOutput {\r\n  success: boolean;\r\n  productId: string;\r\n  enrichmentDraft: EnrichmentDraft | null;\r\n  error?: string;\r\n}\r\n\r\nexport interface EnrichmentDraft {\r\n  description: string;\r\n  features: Record<string, string | string[]>;\r\n  benefits: string[];\r\n  specifications: Record<string, string>;\r\n  tags: string[];\r\n  confidence: number;\r\n  sources: Array<{\r\n    type: 'vision' | 'web_search' | 'kb' | 'url';\r\n    detail: string;\r\n  }>;\r\n  generatedAt: string;\r\n}\r\n\r\n// ============================================\r\n// URL CONTENT FETCHING\r\n// ============================================\r\n\r\n/**\r\n * Fetch and extract text content from a URL using Gemini's URL grounding\r\n */\r\nasync function fetchUrlContent(url: string): Promise<string> {\r\n  try {\r\n    // Use Gemini to fetch and summarize the page content\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: 'gemini-3-flash',\r\n        contents: [\r\n          {\r\n            role: 'user',\r\n            parts: [\r\n              {\r\n                text: `Fetch the content from this URL and extract all product-related information in a structured format. Include product name, description, specifications, features, benefits, materials, dimensions, and any other relevant details.\r\n\r\nURL: ${url}\r\n\r\nReturn the extracted content as plain text with clear sections.`,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n        config: {\r\n          tools: [{ urlContext: {} }],\r\n        },\r\n      },\r\n      { operation: 'enrichment_url' },\r\n    );\r\n\r\n    const text = response.text || '';\r\n    if (!text || text.length < 50) {\r\n      throw new Error('Failed to extract meaningful content from URL');\r\n    }\r\n\r\n    return text;\r\n  } catch (error: any) {\r\n    logger.error({ module: 'UrlEnrichment', err: error }, 'Failed to fetch URL content');\r\n    throw new Error(`Failed to fetch URL: ${error.message}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Get trust level for a URL based on domain\r\n */\r\nfunction getTrustLevel(url: string): number {\r\n  try {\r\n    const hostname = new URL(url).hostname.toLowerCase();\r\n\r\n    // Check for known trusted domains\r\n    for (const [domain, level] of Object.entries(SOURCE_TRUST_LEVELS)) {\r\n      if (hostname.includes(domain)) {\r\n        return level;\r\n      }\r\n    }\r\n\r\n    // Default trust level for user-provided URLs\r\n    return 5;\r\n  } catch {\r\n    return 4;\r\n  }\r\n}\r\n\r\n/**\r\n * Get source name from URL\r\n */\r\nfunction getSourceName(url: string): string {\r\n  try {\r\n    const hostname = new URL(url).hostname;\r\n    return hostname.replace('www.', '');\r\n  } catch {\r\n    return 'Unknown Source';\r\n  }\r\n}\r\n\r\n// ============================================\r\n// AI EXTRACTION\r\n// ============================================\r\n\r\n/**\r\n * Extract product data from URL content using AI\r\n */\r\nasync function extractProductData(\r\n  content: string,\r\n  productName: string,\r\n): Promise<{\r\n  description: string;\r\n  specifications: Record<string, string>;\r\n  features: Record<string, string | string[]>;\r\n  benefits: string[];\r\n  tags: string[];\r\n}> {\r\n  const prompt = `Analyze this product page content and extract structured data for \"${productName}\".\r\n\r\nCONTENT:\r\n${content.substring(0, 8000)}\r\n\r\nReturn a JSON object with these fields:\r\n{\r\n  \"description\": \"A comprehensive product description (2-3 sentences)\",\r\n  \"specifications\": {\r\n    \"key\": \"value pairs for technical specs like material, dimensions, weight, etc.\"\r\n  },\r\n  \"features\": {\r\n    \"key\": \"value pairs for product features\"\r\n  },\r\n  \"benefits\": [\"Array of product benefits/selling points\"],\r\n  \"tags\": [\"Array of relevant tags/keywords\"]\r\n}\r\n\r\nOnly include fields you can confidently extract from the content. Return valid JSON only.`;\r\n\r\n  try {\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: 'gemini-3-flash',\r\n        contents: [{ role: 'user', parts: [{ text: prompt }] }],\r\n        config: {\r\n          responseMimeType: 'application/json',\r\n        },\r\n      },\r\n      { operation: 'enrichment_url' },\r\n    );\r\n\r\n    const text = response.text || '{}';\r\n    const parsed = JSON.parse(text);\r\n\r\n    return {\r\n      description: parsed.description || '',\r\n      specifications: parsed.specifications || {},\r\n      features: parsed.features || {},\r\n      benefits: Array.isArray(parsed.benefits) ? parsed.benefits : [],\r\n      tags: Array.isArray(parsed.tags) ? parsed.tags : [],\r\n    };\r\n  } catch (error: any) {\r\n    logger.error({ module: 'UrlEnrichment', err: error }, 'AI extraction failed');\r\n\r\n    // Fallback: use existing extraction methods\r\n    // Cast empty specifications to Record<string, string> for extraction functions\r\n    const specsAsRecord: Record<string, string> = {};\r\n    return {\r\n      description: '',\r\n      specifications: {},\r\n      features: extractFeatures(specsAsRecord, content),\r\n      benefits: extractBenefits(content),\r\n      tags: extractTags(specsAsRecord, content, productName),\r\n    };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// MAIN ENRICHMENT FUNCTION\r\n// ============================================\r\n\r\n/**\r\n * Enrich a product from a user-provided URL\r\n */\r\nexport async function enrichFromUrl(input: UrlEnrichmentInput): Promise<UrlEnrichmentOutput> {\r\n  const { productId, productUrl } = input;\r\n\r\n  logger.info({ module: 'UrlEnrichment', productId, productUrl }, 'Starting enrichment');\r\n\r\n  try {\r\n    // 1. Validate and fetch product\r\n    const product = await storage.getProductById(productId);\r\n    if (!product) {\r\n      return {\r\n        success: false,\r\n        productId,\r\n        enrichmentDraft: null,\r\n        error: 'Product not found',\r\n      };\r\n    }\r\n\r\n    // 2. Validate URL (must be HTTP or HTTPS)\r\n    try {\r\n      const parsedUrl = new URL(productUrl);\r\n      if (!['http:', 'https:'].includes(parsedUrl.protocol)) {\r\n        return {\r\n          success: false,\r\n          productId,\r\n          enrichmentDraft: null,\r\n          error: 'URL must use HTTP or HTTPS protocol',\r\n        };\r\n      }\r\n    } catch {\r\n      return {\r\n        success: false,\r\n        productId,\r\n        enrichmentDraft: null,\r\n        error: 'Invalid URL provided',\r\n      };\r\n    }\r\n\r\n    // 3. Fetch URL content\r\n    logger.info({ module: 'UrlEnrichment' }, 'Fetching content from URL');\r\n    const content = await fetchUrlContent(productUrl);\r\n\r\n    // 4. Extract product data using AI\r\n    logger.info({ module: 'UrlEnrichment' }, 'Extracting product data');\r\n    const extracted = await extractProductData(content, product.name);\r\n\r\n    // 5. Calculate confidence based on data quality\r\n    let confidence = 50; // Base confidence\r\n\r\n    if (extracted.description && extracted.description.length > 50) {\r\n      confidence += 15;\r\n    }\r\n    if (Object.keys(extracted.specifications).length > 0) {\r\n      confidence += 10;\r\n    }\r\n    if (Object.keys(extracted.features).length > 0) {\r\n      confidence += 10;\r\n    }\r\n    if (extracted.benefits.length > 0) {\r\n      confidence += 10;\r\n    }\r\n    if (extracted.tags.length > 0) {\r\n      confidence += 5;\r\n    }\r\n\r\n    // Adjust by trust level\r\n    const trustLevel = getTrustLevel(productUrl);\r\n    confidence = Math.min(100, confidence * (trustLevel / 7));\r\n\r\n    // 6. Build enrichment draft\r\n    const enrichmentDraft: EnrichmentDraft = {\r\n      description: extracted.description,\r\n      features: extracted.features,\r\n      benefits: extracted.benefits,\r\n      specifications: extracted.specifications,\r\n      tags: extracted.tags,\r\n      confidence: Math.round(confidence),\r\n      sources: [\r\n        {\r\n          type: 'url',\r\n          detail: getSourceName(productUrl),\r\n        },\r\n      ],\r\n      generatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    logger.info({ module: 'UrlEnrichment', confidence: Math.round(confidence) }, 'Enrichment complete');\r\n\r\n    return {\r\n      success: true,\r\n      productId,\r\n      enrichmentDraft,\r\n    };\r\n  } catch (error: any) {\r\n    logger.error({ module: 'UrlEnrichment', err: error }, 'Enrichment error');\r\n    return {\r\n      success: false,\r\n      productId,\r\n      enrichmentDraft: null,\r\n      error: error.message,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Update product with enrichment draft data\r\n * This saves the draft to the product's enrichmentDraft field\r\n */\r\nexport async function saveEnrichmentDraft(productId: string, draft: EnrichmentDraft): Promise<boolean> {\r\n  try {\r\n    await storage.updateProduct(productId, {\r\n      enrichmentDraft: draft as any,\r\n      enrichmentStatus: 'draft',\r\n    });\r\n    return true;\r\n  } catch (error: any) {\r\n    logger.error({ module: 'UrlEnrichment', err: error }, 'Failed to save draft');\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default {\r\n  enrichFromUrl,\r\n  saveEnrichmentDraft,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\aiHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\dataExtraction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\gate1-sourceMatch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\gate2-extraction.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\gate3-dbWrite.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used. Allowed unused args must match /^_/u.","line":310,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":310,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Gate 3: Database Write Verification\r\n *\r\n * Purpose: Verify data was saved correctly and completely to the database.\r\n *\r\n * Verification process:\r\n * 1. Write data to database\r\n * 2. Read it back\r\n * 3. Compare field by field\r\n * 4. Detect issues (truncation, encoding, corruption)\r\n * 5. Retry if needed\r\n */\r\n\r\nimport { logger } from \"../../lib/logger\";\r\nimport { storage } from \"../../storage\";\r\nimport {\r\n  DEFAULT_PIPELINE_CONFIG,\r\n  type Gate3Result,\r\n  type WritePayload,\r\n  type WriteDiscrepancy,\r\n  type WriteIssue,\r\n  type PipelineConfig,\r\n} from \"./types\";\r\nimport type { Product } from \"@shared/schema\";\r\n\r\n// ============================================\r\n// MAIN VERIFICATION FUNCTION\r\n// ============================================\r\n\r\n/**\r\n * Write data to database and verify it was saved correctly\r\n */\r\nexport async function verifyDatabaseWrite(\r\n  payload: WritePayload,\r\n  config: PipelineConfig = { ...DEFAULT_PIPELINE_CONFIG }\r\n): Promise<Gate3Result> {\r\n  let retryCount = 0;\r\n  let lastError: Error | null = null;\r\n\r\n  while (retryCount <= config.maxDbWriteRetries) {\r\n    try {\r\n      // ============================================\r\n      // 1. Write to database\r\n      // ============================================\r\n      await storage.updateProduct(payload.productId, {\r\n        description: payload.description,\r\n        specifications: payload.specifications,\r\n        features: payload.features,\r\n        benefits: payload.benefits,\r\n        tags: payload.tags,\r\n        enrichmentStatus: \"verified\",\r\n        enrichmentVerifiedAt: new Date(),\r\n        enrichmentSource: \"ai_pipeline\",\r\n      });\r\n\r\n      // Small delay to ensure write is committed\r\n      await delay(100);\r\n\r\n      // ============================================\r\n      // 2. Read back from database\r\n      // ============================================\r\n      const actual = await storage.getProductById(payload.productId);\r\n\r\n      if (!actual) {\r\n        throw new Error(`Product ${payload.productId} not found after write`);\r\n      }\r\n\r\n      // ============================================\r\n      // 3. Compare field by field\r\n      // ============================================\r\n      const discrepancies = comparePayloadToProduct(payload, actual);\r\n\r\n      // ============================================\r\n      // 4. Determine if write was successful\r\n      // ============================================\r\n      const passed = discrepancies.length === 0;\r\n\r\n      if (passed) {\r\n        return {\r\n          passed: true,\r\n          productId: payload.productId,\r\n          discrepancies: [],\r\n          retryCount,\r\n        };\r\n      }\r\n\r\n      // If we have discrepancies but haven't exhausted retries, try again\r\n      if (retryCount < config.maxDbWriteRetries) {\r\n        logger.warn(\r\n          { module: 'Gate3', discrepancyCount: discrepancies.length },\r\n          'Write verification failed, retrying'\r\n        );\r\n        retryCount++;\r\n        await delay(config.retryDelayMs);\r\n        continue;\r\n      }\r\n\r\n      // Exhausted retries, return failure\r\n      return {\r\n        passed: false,\r\n        productId: payload.productId,\r\n        discrepancies,\r\n        retryCount,\r\n      };\r\n    } catch (err) {\r\n      lastError = err instanceof Error ? err : new Error(String(err));\r\n      logger.error({ module: 'Gate3', err: lastError }, 'Database operation failed');\r\n\r\n      if (retryCount < config.maxDbWriteRetries) {\r\n        retryCount++;\r\n        await delay(config.retryDelayMs * retryCount); // Exponential backoff\r\n        continue;\r\n      }\r\n\r\n      // Exhausted retries, return failure\r\n      return {\r\n        passed: false,\r\n        productId: payload.productId,\r\n        discrepancies: [\r\n          {\r\n            field: \"_database\",\r\n            intended: \"write and verify\",\r\n            actual: lastError.message,\r\n            issue: \"CORRUPTED\",\r\n          },\r\n        ],\r\n        retryCount,\r\n      };\r\n    }\r\n  }\r\n\r\n  // This shouldn't be reached, but TypeScript wants a return\r\n  return {\r\n    passed: false,\r\n    productId: payload.productId,\r\n    discrepancies: [\r\n      {\r\n        field: \"_database\",\r\n        intended: \"write and verify\",\r\n        actual: lastError?.message || \"Unknown error\",\r\n        issue: \"CORRUPTED\",\r\n      },\r\n    ],\r\n    retryCount,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// COMPARISON FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Compare write payload to actual product in database\r\n */\r\nfunction comparePayloadToProduct(\r\n  payload: WritePayload,\r\n  actual: Product\r\n): WriteDiscrepancy[] {\r\n  const discrepancies: WriteDiscrepancy[] = [];\r\n\r\n  // Compare description\r\n  if (payload.description) {\r\n    const discrepancy = compareStringField(\r\n      \"description\",\r\n      payload.description,\r\n      actual.description\r\n    );\r\n    if (discrepancy) discrepancies.push(discrepancy);\r\n  }\r\n\r\n  // Compare specifications (JSON object)\r\n  if (payload.specifications && Object.keys(payload.specifications).length > 0) {\r\n    const discrepancy = compareJsonField(\r\n      \"specifications\",\r\n      payload.specifications,\r\n      actual.specifications as Record<string, string> | null\r\n    );\r\n    if (discrepancy) discrepancies.push(discrepancy);\r\n  }\r\n\r\n  // Compare features (JSON object)\r\n  if (payload.features && Object.keys(payload.features).length > 0) {\r\n    const discrepancy = compareJsonField(\r\n      \"features\",\r\n      payload.features,\r\n      actual.features as Record<string, string | string[]> | null\r\n    );\r\n    if (discrepancy) discrepancies.push(discrepancy);\r\n  }\r\n\r\n  // Compare benefits (array)\r\n  if (payload.benefits && payload.benefits.length > 0) {\r\n    const discrepancy = compareArrayField(\r\n      \"benefits\",\r\n      payload.benefits,\r\n      actual.benefits\r\n    );\r\n    if (discrepancy) discrepancies.push(discrepancy);\r\n  }\r\n\r\n  // Compare tags (array)\r\n  if (payload.tags && payload.tags.length > 0) {\r\n    const discrepancy = compareArrayField(\r\n      \"tags\",\r\n      payload.tags,\r\n      actual.tags\r\n    );\r\n    if (discrepancy) discrepancies.push(discrepancy);\r\n  }\r\n\r\n  return discrepancies;\r\n}\r\n\r\n/**\r\n * Compare a string field\r\n */\r\nfunction compareStringField(\r\n  fieldName: string,\r\n  intended: string,\r\n  actual: string | null | undefined\r\n): WriteDiscrepancy | null {\r\n  if (!intended) return null;\r\n\r\n  const actualValue = actual || \"\";\r\n\r\n  if (intended === actualValue) {\r\n    return null; // Match\r\n  }\r\n\r\n  // Detect the type of issue\r\n  const issue = detectStringIssue(intended, actualValue);\r\n\r\n  return {\r\n    field: fieldName,\r\n    intended,\r\n    actual: actualValue,\r\n    issue,\r\n  };\r\n}\r\n\r\n/**\r\n * Compare a JSON object field\r\n */\r\nfunction compareJsonField(\r\n  fieldName: string,\r\n  intended: Record<string, unknown>,\r\n  actual: Record<string, unknown> | null | undefined\r\n): WriteDiscrepancy | null {\r\n  const intendedStr = JSON.stringify(intended, Object.keys(intended).sort());\r\n  const actualStr = actual\r\n    ? JSON.stringify(actual, Object.keys(actual).sort())\r\n    : \"{}\";\r\n\r\n  if (intendedStr === actualStr) {\r\n    return null; // Match\r\n  }\r\n\r\n  // Check if data exists but differs\r\n  if (actual && Object.keys(actual).length > 0) {\r\n    // Check for individual field mismatches\r\n    const missingKeys = Object.keys(intended).filter(k => !(k in actual));\r\n\r\n    if (missingKeys.length > 0) {\r\n      return {\r\n        field: fieldName,\r\n        intended: intendedStr,\r\n        actual: actualStr,\r\n        issue: \"MISSING\",\r\n      };\r\n    }\r\n\r\n    // Some keys exist but values differ\r\n    return {\r\n      field: fieldName,\r\n      intended: intendedStr,\r\n      actual: actualStr,\r\n      issue: \"CORRUPTED\",\r\n    };\r\n  }\r\n\r\n  return {\r\n    field: fieldName,\r\n    intended: intendedStr,\r\n    actual: actualStr,\r\n    issue: actual === null ? \"MISSING\" : \"CORRUPTED\",\r\n  };\r\n}\r\n\r\n/**\r\n * Compare an array field\r\n */\r\nfunction compareArrayField(\r\n  fieldName: string,\r\n  intended: string[],\r\n  actual: string[] | null | undefined\r\n): WriteDiscrepancy | null {\r\n  const actualArray = actual || [];\r\n\r\n  // Sort for comparison (order might not matter)\r\n  const intendedSorted = [...intended].sort();\r\n  const actualSorted = [...actualArray].sort();\r\n\r\n  if (JSON.stringify(intendedSorted) === JSON.stringify(actualSorted)) {\r\n    return null; // Match\r\n  }\r\n\r\n  // Check for truncation\r\n  if (actualArray.length < intended.length && actualArray.length > 0) {\r\n    // Check if it's a prefix\r\n    const isPrefix = actualArray.every((v, i) =>\r\n      intended.includes(v)\r\n    );\r\n\r\n    if (isPrefix) {\r\n      return {\r\n        field: fieldName,\r\n        intended: JSON.stringify(intended),\r\n        actual: JSON.stringify(actualArray),\r\n        issue: \"TRUNCATED\",\r\n      };\r\n    }\r\n  }\r\n\r\n  return {\r\n    field: fieldName,\r\n    intended: JSON.stringify(intended),\r\n    actual: JSON.stringify(actualArray),\r\n    issue: actualArray.length === 0 ? \"MISSING\" : \"CORRUPTED\",\r\n  };\r\n}\r\n\r\n/**\r\n * Detect the type of issue between intended and actual string values\r\n */\r\nfunction detectStringIssue(intended: string, actual: string): WriteIssue {\r\n  // Check for truncation\r\n  if (actual.length < intended.length && intended.startsWith(actual)) {\r\n    return \"TRUNCATED\";\r\n  }\r\n\r\n  // Check for encoding issues (common patterns)\r\n  const hasEncodingIssues =\r\n    actual.includes(\"\") || // Replacement character\r\n    actual.includes(\"\\\\u\") || // Escaped unicode\r\n    (intended.includes(\"'\") && actual.includes(\"''\")) || // SQL escaping artifacts\r\n    (intended.includes('\"') && actual.includes('\\\\\"'));\r\n\r\n  if (hasEncodingIssues) {\r\n    return \"ENCODING\";\r\n  }\r\n\r\n  // Check for complete missing data\r\n  if (!actual || actual.trim() === \"\") {\r\n    return \"MISSING\";\r\n  }\r\n\r\n  // Check for type mismatch (e.g., number stored as string differently)\r\n  if (typeof intended !== typeof actual) {\r\n    return \"TYPE_MISMATCH\";\r\n  }\r\n\r\n  // Default to corruption\r\n  return \"CORRUPTED\";\r\n}\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Simple delay utility\r\n */\r\nfunction delay(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Build a write payload from aggregated data\r\n */\r\nexport function buildWritePayload(\r\n  productId: string,\r\n  description: string,\r\n  specifications: Record<string, string>,\r\n  features: Record<string, string | string[]>,\r\n  benefits: string[],\r\n  tags: string[],\r\n  sources: string[]\r\n): WritePayload {\r\n  return {\r\n    productId,\r\n    description: description.trim(),\r\n    specifications: cleanObject(specifications),\r\n    features: cleanObject(features) as Record<string, string | string[]>,\r\n    benefits: benefits.filter(b => b && b.trim()),\r\n    tags: Array.from(new Set(tags.filter(t => t && t.trim()))), // Dedupe tags\r\n    sources,\r\n  };\r\n}\r\n\r\n/**\r\n * Clean an object by removing empty values\r\n */\r\nfunction cleanObject<T extends Record<string, unknown>>(obj: T): T {\r\n  const cleaned = {} as T;\r\n\r\n  for (const [key, value] of Object.entries(obj)) {\r\n    if (value !== null && value !== undefined && value !== \"\") {\r\n      if (Array.isArray(value) && value.length === 0) {\r\n        continue; // Skip empty arrays\r\n      }\r\n      (cleaned as Record<string, unknown>)[key] = value;\r\n    }\r\n  }\r\n\r\n  return cleaned;\r\n}\r\n\r\n/**\r\n * Check if Gate 3 result indicates a retry-able failure\r\n */\r\nexport function isRetryableFailure(result: Gate3Result): boolean {\r\n  if (result.passed) return false;\r\n\r\n  // Database errors are often transient\r\n  const transientIssues: WriteIssue[] = [\"CORRUPTED\"];\r\n\r\n  return result.discrepancies.some(d =>\r\n    transientIssues.includes(d.issue) && d.field === \"_database\"\r\n  );\r\n}\r\n\r\n// Export gate3 module\r\nexport const gate3 = {\r\n  verifyDatabaseWrite,\r\n  buildWritePayload,\r\n  isRetryableFailure,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\gate4-crossSource.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'importance' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":205,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Gate 4: Cross-Source Truth Verification\r\n *\r\n * Purpose: Ensure aggregated data is TRUE and not confused across sources.\r\n *\r\n * Verification methods:\r\n * 1. Detect conflicts across sources (different values for same field)\r\n * 2. Check equivalence (e.g., \"50mm\" vs \"2 inch\")\r\n * 3. Verify each claim in final description against ALL sources\r\n * 4. Exclude contradicted claims\r\n *\r\n * This is the CRITICAL gate that prevents data confusion from multi-source aggregation.\r\n */\r\n\r\nimport {\r\n  aiCheckEquivalence,\r\n  aiExtractClaims,\r\n  aiVerifyClaim,\r\n} from \"./aiHelpers\";\r\nimport {\r\n  SOURCE_TRUST_LEVELS,\r\n  type Gate4Result,\r\n  type Gate4Verdict,\r\n  type FieldConflict,\r\n  type TruthCheck,\r\n  type ClaimVerdict,\r\n  type ConflictResolution,\r\n  type ExtractedData,\r\n  type AggregatedData,\r\n  type ConfidenceLevel,\r\n} from \"./types\";\r\n\r\n// ============================================\r\n// MAIN VERIFICATION FUNCTION\r\n// ============================================\r\n\r\n/**\r\n * Verify cross-source truth of aggregated data\r\n */\r\nexport async function verifyCrossSourceTruth(\r\n  extractions: ExtractedData[],\r\n  aggregated: AggregatedData\r\n): Promise<Gate4Result> {\r\n  // ============================================\r\n  // 1. DETECT CONFLICTS across sources\r\n  // ============================================\r\n  const conflicts = await detectFieldConflicts(extractions, aggregated);\r\n\r\n  // ============================================\r\n  // 2. VERIFY each claim in final description against ALL sources\r\n  // ============================================\r\n  const truthChecks = await verifyDescriptionClaims(\r\n    aggregated.description,\r\n    extractions\r\n  );\r\n\r\n  // ============================================\r\n  // 3. Determine overall verdict\r\n  // ============================================\r\n  const hasUnresolvedConflicts = conflicts.some(c => c.resolution === \"CONFLICT\");\r\n  const hasContradictions = truthChecks.some(t => t.verdict === \"CONTRADICTED\");\r\n  const hasUnverified = truthChecks.some(t => t.verdict === \"UNVERIFIED\");\r\n\r\n  let overallVerdict: Gate4Verdict;\r\n  let passed: boolean;\r\n\r\n  if (hasUnresolvedConflicts || hasContradictions) {\r\n    overallVerdict = \"CONFLICTS_FOUND\";\r\n    passed = false;\r\n  } else if (hasUnverified) {\r\n    overallVerdict = \"SOME_UNVERIFIED\";\r\n    passed = true; // Still passes, but with lower confidence\r\n  } else {\r\n    overallVerdict = \"ALL_VERIFIED\";\r\n    passed = true;\r\n  }\r\n\r\n  return {\r\n    passed,\r\n    conflicts,\r\n    truthChecks,\r\n    overallVerdict,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// CONFLICT DETECTION\r\n// ============================================\r\n\r\n/**\r\n * Detect conflicts in field values across sources\r\n */\r\nasync function detectFieldConflicts(\r\n  extractions: ExtractedData[],\r\n  aggregated: AggregatedData\r\n): Promise<FieldConflict[]> {\r\n  const conflicts: FieldConflict[] = [];\r\n\r\n  // Get all unique field names from aggregated data\r\n  const fieldNames = new Set<string>([\r\n    \"productName\",\r\n    \"description\",\r\n    ...Object.keys(aggregated.specifications),\r\n  ]);\r\n\r\n  for (const fieldName of Array.from(fieldNames)) {\r\n    // Collect all values for this field across sources\r\n    const valuesWithSources: { source: string; value: string }[] = [];\r\n\r\n    for (const extraction of extractions) {\r\n      let value: string | undefined;\r\n\r\n      if (fieldName === \"productName\") {\r\n        value = extraction.productName;\r\n      } else if (fieldName === \"description\") {\r\n        value = extraction.description;\r\n      } else {\r\n        value = extraction.specifications[fieldName];\r\n      }\r\n\r\n      if (value && value.trim()) {\r\n        valuesWithSources.push({\r\n          source: extraction.sourceUrl,\r\n          value: value.trim(),\r\n        });\r\n      }\r\n    }\r\n\r\n    // Skip if fewer than 2 sources have this field\r\n    if (valuesWithSources.length < 2) {\r\n      continue;\r\n    }\r\n\r\n    // Check if all values are the same\r\n    const uniqueValues = Array.from(new Set(valuesWithSources.map(v => v.value.toLowerCase())));\r\n\r\n    if (uniqueValues.length === 1) {\r\n      continue; // No conflict, all sources agree\r\n    }\r\n\r\n    // Check if values are equivalent (e.g., unit conversions)\r\n    const equivalence = await aiCheckEquivalence(\r\n      valuesWithSources.map(v => v.value)\r\n    );\r\n\r\n    let resolution: ConflictResolution;\r\n    let resolvedValue: string | null = null;\r\n    let reasoning: string;\r\n\r\n    if (equivalence.allEquivalent) {\r\n      resolution = \"EQUIVALENT\";\r\n      resolvedValue = equivalence.resolvedValue;\r\n      reasoning = equivalence.reasoning;\r\n    } else if (equivalence.compatible) {\r\n      resolution = \"COMPATIBLE\";\r\n      resolvedValue = equivalence.resolvedValue;\r\n      reasoning = equivalence.reasoning;\r\n    } else {\r\n      resolution = \"CONFLICT\";\r\n      resolvedValue = null;\r\n      reasoning = equivalence.reasoning;\r\n    }\r\n\r\n    // Only record if there's something to report\r\n    if (resolution !== \"EQUIVALENT\" || uniqueValues.length > 1) {\r\n      conflicts.push({\r\n        field: fieldName,\r\n        values: valuesWithSources,\r\n        resolution,\r\n        resolvedValue,\r\n        reasoning,\r\n      });\r\n    }\r\n  }\r\n\r\n  return conflicts;\r\n}\r\n\r\n// ============================================\r\n// CLAIM VERIFICATION\r\n// ============================================\r\n\r\n/**\r\n * Verify claims in the aggregated description against all sources\r\n */\r\nasync function verifyDescriptionClaims(\r\n  description: string,\r\n  extractions: ExtractedData[]\r\n): Promise<TruthCheck[]> {\r\n  // Skip if description is empty\r\n  if (!description || !description.trim()) {\r\n    return [];\r\n  }\r\n\r\n  // Extract individual claims from description\r\n  const claims = await aiExtractClaims(description);\r\n\r\n  if (claims.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const truthChecks: TruthCheck[] = [];\r\n\r\n  // Verify each claim against all sources\r\n  for (const { claim, importance } of claims) {\r\n    const supportedBy: string[] = [];\r\n    const contradictedBy: string[] = [];\r\n\r\n    // Check claim against each source\r\n    for (const extraction of extractions) {\r\n      const support = await aiVerifyClaim({\r\n        claim,\r\n        source: extraction.rawExtract.substring(0, 4000),\r\n      });\r\n\r\n      if (support.supports) {\r\n        supportedBy.push(extraction.sourceUrl);\r\n      } else if (support.contradicts) {\r\n        contradictedBy.push(extraction.sourceUrl);\r\n      }\r\n      // Neutral sources are not tracked\r\n    }\r\n\r\n    // Determine verdict\r\n    let verdict: ClaimVerdict;\r\n\r\n    if (contradictedBy.length > 0) {\r\n      // Any contradiction is serious\r\n      verdict = \"CONTRADICTED\";\r\n    } else if (supportedBy.length > 0) {\r\n      verdict = \"VERIFIED\";\r\n    } else {\r\n      verdict = \"UNVERIFIED\";\r\n    }\r\n\r\n    truthChecks.push({\r\n      claim,\r\n      supportedBy,\r\n      contradictedBy,\r\n      verdict,\r\n    });\r\n  }\r\n\r\n  return truthChecks;\r\n}\r\n\r\n// ============================================\r\n// AUTOMATED RESOLUTION FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Automatically resolve conflicts when possible\r\n */\r\nexport function resolveConflicts(\r\n  conflicts: FieldConflict[],\r\n  extractions: ExtractedData[]\r\n): {\r\n  resolved: Record<string, string>;\r\n  unresolved: FieldConflict[];\r\n} {\r\n  const resolved: Record<string, string> = {};\r\n  const unresolved: FieldConflict[] = [];\r\n\r\n  // Build source trust map\r\n  const sourceTrustMap = buildSourceTrustMap(extractions);\r\n\r\n  for (const conflict of conflicts) {\r\n    if (conflict.resolution === \"EQUIVALENT\" || conflict.resolution === \"COMPATIBLE\") {\r\n      // Use the resolved value from AI\r\n      if (conflict.resolvedValue) {\r\n        resolved[conflict.field] = conflict.resolvedValue;\r\n      } else {\r\n        // Fall back to highest-trust source\r\n        const bestValue = selectHighestTrustValue(conflict.values, sourceTrustMap);\r\n        if (bestValue) {\r\n          resolved[conflict.field] = bestValue;\r\n        } else {\r\n          unresolved.push(conflict);\r\n        }\r\n      }\r\n    } else if (conflict.resolution === \"CONFLICT\") {\r\n      // Try to resolve using trust levels\r\n      const bestValue = selectHighestTrustValue(conflict.values, sourceTrustMap);\r\n      if (bestValue) {\r\n        resolved[conflict.field] = bestValue;\r\n      } else {\r\n        unresolved.push(conflict);\r\n      }\r\n    }\r\n  }\r\n\r\n  return { resolved, unresolved };\r\n}\r\n\r\n/**\r\n * Build a map of source URL to trust level\r\n */\r\nfunction buildSourceTrustMap(extractions: ExtractedData[]): Map<string, number> {\r\n  const trustMap = new Map<string, number>();\r\n\r\n  for (const extraction of extractions) {\r\n    try {\r\n      const url = new URL(extraction.sourceUrl);\r\n      const domain = url.hostname.replace(/^www\\./, \"\");\r\n\r\n      // Look up trust level\r\n      const trustLevel = SOURCE_TRUST_LEVELS[domain] || SOURCE_TRUST_LEVELS[\"default\"];\r\n      trustMap.set(extraction.sourceUrl, trustLevel);\r\n    } catch {\r\n      // Invalid URL, use default trust\r\n      trustMap.set(extraction.sourceUrl, 4);\r\n    }\r\n  }\r\n\r\n  return trustMap;\r\n}\r\n\r\n/**\r\n * Select value from highest-trust source\r\n */\r\nfunction selectHighestTrustValue(\r\n  values: { source: string; value: string }[],\r\n  trustMap: Map<string, number>\r\n): string | null {\r\n  if (values.length === 0) return null;\r\n\r\n  // Sort by trust level (highest first)\r\n  const sorted = [...values].sort((a, b) => {\r\n    const trustA = trustMap.get(a.source) || 4;\r\n    const trustB = trustMap.get(b.source) || 4;\r\n    return trustB - trustA;\r\n  });\r\n\r\n  return sorted[0].value;\r\n}\r\n\r\n/**\r\n * Filter out contradicted claims from description\r\n */\r\nexport function filterContradictedClaims(\r\n  description: string,\r\n  truthChecks: TruthCheck[]\r\n): string {\r\n  let filteredDescription = description;\r\n\r\n  // Get contradicted claims\r\n  const contradicted = truthChecks.filter(t => t.verdict === \"CONTRADICTED\");\r\n\r\n  // Simple approach: try to remove sentences containing the claim\r\n  for (const check of contradicted) {\r\n    // Find and remove the claim from the description\r\n    // This is a simple implementation - could be improved with NLP\r\n    const sentences = filteredDescription.split(/(?<=[.!?])\\s+/);\r\n    const filteredSentences = sentences.filter(sentence => {\r\n      // Check if this sentence contains the problematic claim\r\n      const sentenceLower = sentence.toLowerCase();\r\n      const claimLower = check.claim.toLowerCase();\r\n\r\n      // Simple word overlap check\r\n      const claimWords = claimLower.split(/\\s+/).filter(w => w.length > 3);\r\n      const matchCount = claimWords.filter(w => sentenceLower.includes(w)).length;\r\n      const matchRatio = matchCount / claimWords.length;\r\n\r\n      // Remove if more than 60% of claim words match\r\n      return matchRatio < 0.6;\r\n    });\r\n\r\n    filteredDescription = filteredSentences.join(\" \");\r\n  }\r\n\r\n  return filteredDescription.trim();\r\n}\r\n\r\n// ============================================\r\n// CONFIDENCE CALCULATION\r\n// ============================================\r\n\r\n/**\r\n * Calculate overall confidence from Gate 4 result\r\n */\r\nexport function calculateGate4Confidence(result: Gate4Result): ConfidenceLevel {\r\n  if (!result.passed) {\r\n    return \"LOW\";\r\n  }\r\n\r\n  const verifiedCount = result.truthChecks.filter(t => t.verdict === \"VERIFIED\").length;\r\n  const totalChecks = result.truthChecks.length;\r\n\r\n  if (totalChecks === 0) {\r\n    return \"MEDIUM\"; // No claims to verify\r\n  }\r\n\r\n  const verificationRatio = verifiedCount / totalChecks;\r\n\r\n  if (verificationRatio >= 0.8 && result.conflicts.length === 0) {\r\n    return \"HIGH\";\r\n  } else if (verificationRatio >= 0.5) {\r\n    return \"MEDIUM\";\r\n  } else {\r\n    return \"LOW\";\r\n  }\r\n}\r\n\r\n/**\r\n * Get summary of Gate 4 results\r\n */\r\nexport function getGate4Summary(result: Gate4Result): {\r\n  conflictsResolved: number;\r\n  conflictsUnresolved: number;\r\n  claimsVerified: number;\r\n  claimsUnverified: number;\r\n  claimsContradicted: number;\r\n} {\r\n  const conflictsResolved = result.conflicts.filter(\r\n    c => c.resolution === \"EQUIVALENT\" || c.resolution === \"COMPATIBLE\"\r\n  ).length;\r\n\r\n  const conflictsUnresolved = result.conflicts.filter(\r\n    c => c.resolution === \"CONFLICT\"\r\n  ).length;\r\n\r\n  const claimsVerified = result.truthChecks.filter(\r\n    t => t.verdict === \"VERIFIED\"\r\n  ).length;\r\n\r\n  const claimsUnverified = result.truthChecks.filter(\r\n    t => t.verdict === \"UNVERIFIED\"\r\n  ).length;\r\n\r\n  const claimsContradicted = result.truthChecks.filter(\r\n    t => t.verdict === \"CONTRADICTED\"\r\n  ).length;\r\n\r\n  return {\r\n    conflictsResolved,\r\n    conflictsUnresolved,\r\n    claimsVerified,\r\n    claimsUnverified,\r\n    claimsContradicted,\r\n  };\r\n}\r\n\r\n// Export gate4 module\r\nexport const gate4 = {\r\n  verifyCrossSourceTruth,\r\n  resolveConflicts,\r\n  filterContradictedClaims,\r\n  calculateGate4Confidence,\r\n  getGate4Summary,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\pipeline.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\sourceDiscovery.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\enrichment\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\errorTrackingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\experimentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\fileSearchService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3448,3451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3448,3451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3563,3566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3563,3566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3811,3814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3811,3814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4218,4221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4218,4221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6013,6016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6013,6016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7428,7431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7428,7431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7578,7581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7578,7581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7649,7652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7649,7652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8106,8109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8106,8109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8726,8729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8726,8729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'maxResults' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":270,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":270,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9541,9544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9541,9544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9919,9922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9919,9922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Google Gemini File Search Service\r\n *\r\n * Manages the RAG (Retrieval Augmented Generation) system for ad copywriting\r\n * using Google's File Search Tool for context grounding.\r\n *\r\n * Features:\r\n * - Upload brand guidelines, ad examples, product catalogs\r\n * - Automatic chunking, embedding, and indexing\r\n * - Semantic search for relevant context during copy generation\r\n * - Citation tracking for transparency\r\n *\r\n * Docs: https://ai.google.dev/gemini-api/docs/file-search\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport { generateContentWithRetry, getGlobalGeminiClient } from '../lib/geminiClient';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport { telemetry } from '../instrumentation';\r\n\r\n// File Search Store configuration\r\nconst FILE_SEARCH_STORE_NAME = 'nds-copywriting-rag';\r\n\r\n// Allowed file types for File Search (Google supports 100+ formats)\r\nexport const ALLOWED_FILE_EXTENSIONS = [\r\n  '.pdf', '.docx', '.doc', '.txt', '.md', '.csv', '.xlsx', '.xls',\r\n  '.pptx', '.ppt', '.json', '.xml', '.yaml', '.yml', '.html', '.htm'\r\n];\r\n\r\n// Dangerous extensions that should be blocked (security check)\r\nexport const DANGEROUS_EXTENSIONS = ['.exe', '.sh', '.bat', '.cmd', '.ps1'];\r\n\r\nexport const MAX_FILE_SIZE_MB = 100; // Google File Search limit\r\nexport const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;\r\n\r\n/**\r\n * Validate file before upload\r\n * Security checks run first (dangerous extensions), then format, then size\r\n */\r\nexport function validateFile(filePath: string, stats: { size: number }): void {\r\n  const ext = path.extname(filePath).toLowerCase();\r\n\r\n  // SECURITY FIRST: Block dangerous executable files\r\n  if (DANGEROUS_EXTENSIONS.includes(ext)) {\r\n    throw new Error(`Dangerous file type blocked: ${ext}`);\r\n  }\r\n\r\n  // Check file extension is in allowed list\r\n  if (!ALLOWED_FILE_EXTENSIONS.includes(ext)) {\r\n    throw new Error(\r\n      `Unsupported file type: ${ext}. Allowed types: ${ALLOWED_FILE_EXTENSIONS.join(', ')}`\r\n    );\r\n  }\r\n\r\n  // Check file size\r\n  if (stats.size > MAX_FILE_SIZE_BYTES) {\r\n    throw new Error(\r\n      `File too large: ${(stats.size / 1024 / 1024).toFixed(2)}MB (max: ${MAX_FILE_SIZE_MB}MB)`\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * File categories for organization\r\n */\r\nexport enum FileCategory {\r\n  /** Brand voice, tone, logo usage, color palettes */\r\n  BRAND_GUIDELINES = 'brand_guidelines',\r\n  /** Example ads for style reference and inspiration */\r\n  AD_EXAMPLES = 'ad_examples',\r\n  /** Product information, specs, pricing */\r\n  PRODUCT_CATALOG = 'product_catalog',\r\n  /** Competitor ad analysis and market research */\r\n  COMPETITOR_RESEARCH = 'competitor_research',\r\n  /** Historical ad performance metrics */\r\n  PERFORMANCE_DATA = 'performance_data',\r\n  /** Uncategorized reference materials */\r\n  GENERAL = 'general',\r\n  /** Installation manuals, how-to guides for products */\r\n  INSTALLATION_GUIDES = 'installation_guides',\r\n  /** Product ecosystem documentation, pairing guides */\r\n  PRODUCT_RELATIONSHIPS = 'product_relationships',\r\n  /** Style guides, image usage documentation */\r\n  BRAND_IMAGE_GUIDELINES = 'brand_image_guidelines',\r\n  /** Ad template patterns, design references */\r\n  TEMPLATE_LIBRARY = 'template_library',\r\n}\r\n\r\n/**\r\n * Initialize or get existing File Search Store\r\n * Note: File Search is not supported by Replit AI integrations\r\n * Returns null if not available\r\n */\r\nexport async function initializeFileSearchStore(): Promise<any | null> {\r\n  try {\r\n    // Check if store already exists\r\n    const stores = await (getGlobalGeminiClient() as any).fileSearchStores?.list?.();\r\n    if (!stores || !Array.isArray(stores)) {\r\n      logger.info({ module: 'FileSearch' }, 'File Search Store API not available');\r\n      return null;\r\n    }\r\n\r\n    const existingStore = stores.find(\r\n      (store: any) => store.config?.displayName === FILE_SEARCH_STORE_NAME\r\n    );\r\n\r\n    if (existingStore) {\r\n      logger.info({ module: 'FileSearch', storeName: existingStore.name }, 'Found existing File Search Store');\r\n      return existingStore;\r\n    }\r\n\r\n    // Create new store\r\n    logger.info({ module: 'FileSearch' }, 'Creating new File Search Store');\r\n    const newStore = await (getGlobalGeminiClient() as any).fileSearchStores.create({\r\n      config: {\r\n        displayName: FILE_SEARCH_STORE_NAME,\r\n      },\r\n    });\r\n\r\n    logger.info({ module: 'FileSearch', storeName: newStore.name }, 'Created File Search Store');\r\n    return newStore;\r\n  } catch (error) {\r\n    logger.error({ module: 'FileSearch', err: error }, 'Error initializing File Search Store');\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Upload a file to the File Search Store\r\n */\r\nexport async function uploadReferenceFile(params: {\r\n  filePath: string;\r\n  category: FileCategory;\r\n  description?: string;\r\n  metadata?: Record<string, string | number>;\r\n}) {\r\n  const { filePath, category, description, metadata = {} } = params;\r\n  const startTime = Date.now();\r\n  let success = false;\r\n  let errorType: string | undefined;\r\n\r\n  try {\r\n    // Validate file before upload\r\n    const stats = await fs.stat(filePath);\r\n    validateFile(filePath, stats);\r\n\r\n    // Get or create store\r\n    const store = await initializeFileSearchStore();\r\n\r\n    // Prepare file metadata\r\n    const fileName = path.basename(filePath);\r\n    const customMetadata = [\r\n      { key: 'category', stringValue: category },\r\n      { key: 'uploadedAt', stringValue: new Date().toISOString() },\r\n    ];\r\n\r\n    if (description) {\r\n      customMetadata.push({ key: 'description', stringValue: description });\r\n    }\r\n\r\n    // Add user-provided metadata (convert all values to strings)\r\n    for (const [key, value] of Object.entries(metadata)) {\r\n      if (value !== null && value !== undefined) {\r\n        customMetadata.push({ key, stringValue: String(value) });\r\n      }\r\n    }\r\n\r\n    // Upload file to File Search Store\r\n    logger.info({ module: 'FileSearch', fileName }, 'Uploading file to File Search Store');\r\n    const operation = await (getGlobalGeminiClient() as any).fileSearchStores.uploadToFileSearchStore({\r\n      file: filePath,\r\n      fileSearchStoreName: store.name,\r\n      config: {\r\n        displayName: fileName,\r\n        customMetadata,\r\n        chunkingConfig: {\r\n          whiteSpaceConfig: {\r\n            maxTokensPerChunk: 500, // Larger chunks for ad copy context\r\n            maxOverlapTokens: 50,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    // Wait for operation to complete\r\n    const result = await operation.result();\r\n    logger.info({ module: 'FileSearch', fileName, fileId: result.name }, 'Uploaded file');\r\n\r\n    success = true;\r\n\r\n    return {\r\n      fileName,\r\n      fileId: result.name,\r\n      category,\r\n      uploadedAt: new Date(),\r\n      metadata,\r\n    };\r\n  } catch (error) {\r\n    success = false;\r\n    errorType = error instanceof Error ? error.name : 'UnknownError';\r\n    logger.error({ module: 'FileSearch', filePath, err: error }, 'Error uploading file');\r\n    throw error;\r\n  } finally {\r\n    // Track upload metrics\r\n    const durationMs = Date.now() - startTime;\r\n    telemetry.trackFileSearchUpload({\r\n      category,\r\n      success,\r\n      durationMs,\r\n      errorType,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * List all files in the File Search Store\r\n */\r\nexport async function listReferenceFiles(category?: FileCategory) {\r\n  try {\r\n    const store = await initializeFileSearchStore();\r\n    const files = await (getGlobalGeminiClient() as any).fileSearchStores.listFiles({\r\n      fileSearchStoreName: store.name,\r\n    });\r\n\r\n    if (category) {\r\n      return files.filter(\r\n        (file: any) =>\r\n          file.config?.customMetadata?.find(\r\n            (m: any) => m.key === 'category' && m.stringValue === category\r\n          )\r\n      );\r\n    }\r\n\r\n    return files;\r\n  } catch (error) {\r\n    logger.error({ module: 'FileSearch', err: error }, 'Error listing files');\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a file from the File Search Store\r\n */\r\nexport async function deleteReferenceFile(fileId: string) {\r\n  try {\r\n    const store = await initializeFileSearchStore();\r\n    await (getGlobalGeminiClient() as any).fileSearchStores.deleteFile({\r\n      fileSearchStoreName: store.name,\r\n      fileName: fileId,\r\n    });\r\n\r\n    logger.info({ module: 'FileSearch', fileId }, 'Deleted file');\r\n    return { success: true };\r\n  } catch (error) {\r\n    logger.error({ module: 'FileSearch', fileId, err: error }, 'Error deleting file');\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Query the File Search Store for relevant context\r\n * Used internally by copywriting service\r\n */\r\nexport async function queryFileSearchStore(params: {\r\n  query: string;\r\n  category?: FileCategory;\r\n  maxResults?: number;\r\n}): Promise<{ context: string; citations: any[] } | null> {\r\n  const { query, category, maxResults = 5 } = params;\r\n  const startTime = Date.now();\r\n  let success = false;\r\n  let errorType: string | undefined;\r\n  let resultsCount = 0;\r\n\r\n  try {\r\n    const store = await initializeFileSearchStore();\r\n\r\n    // Return null if file search is not available\r\n    if (!store) {\r\n      return null;\r\n    }\r\n\r\n    // Build metadata filter if category specified\r\n    const metadataFilter = category ? `category=\"${category}\"` : undefined;\r\n\r\n    // Use Gemini's File Search tool with new SDK pattern\r\n    // Note: File Search tools may not be fully typed in the SDK yet\r\n    // MODEL RECENCY RULE: Before changing any model ID, verify today's date and confirm the model is current within the last 3-4 weeks.\r\n    const response = await (generateContentWithRetry as any)({\r\n      model: 'gemini-3-flash-preview',\r\n      contents: [{ role: 'user', parts: [{ text: query }] }],\r\n      tools: [\r\n        {\r\n          fileSearch: {\r\n            fileSearchStoreNames: [store.name],\r\n            ...(metadataFilter && { metadataFilter }),\r\n          },\r\n        },\r\n      ],\r\n    }, { operation: 'rag_query' });\r\n\r\n    const citations = (response as any).citations || [];\r\n    resultsCount = citations.length;\r\n    success = true;\r\n\r\n    const text = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n\r\n    return {\r\n      context: text,\r\n      citations,\r\n    };\r\n  } catch (error) {\r\n    success = false;\r\n    errorType = error instanceof Error ? error.name : 'UnknownError';\r\n    logger.error({ module: 'FileSearch', err: error }, 'Error querying File Search Store');\r\n    throw error;\r\n  } finally {\r\n    // Track query metrics\r\n    const durationMs = Date.now() - startTime;\r\n    telemetry.trackFileSearchQuery({\r\n      category,\r\n      success,\r\n      durationMs,\r\n      resultsCount,\r\n      errorType,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Get File Search Store for use in copywriting generation\r\n * Returns the store name to pass to Gemini's tools config, or null if unavailable\r\n */\r\nexport async function getFileSearchStoreForGeneration(): Promise<string | null> {\r\n  const store = await initializeFileSearchStore();\r\n  if (!store) {\r\n    return null;\r\n  }\r\n  return store.name;\r\n}\r\n\r\n/**\r\n * Upload multiple reference files from a directory\r\n */\r\nexport async function uploadDirectoryToFileSearch(params: {\r\n  directoryPath: string;\r\n  category: FileCategory;\r\n  description?: string;\r\n}) {\r\n  const { directoryPath, category, description } = params;\r\n\r\n  try {\r\n    const files = await fs.readdir(directoryPath);\r\n    const results = [];\r\n\r\n    for (const file of files) {\r\n      const filePath = path.join(directoryPath, file);\r\n      const stats = await fs.stat(filePath);\r\n\r\n      if (stats.isFile()) {\r\n        const result = await uploadReferenceFile({\r\n          filePath,\r\n          category,\r\n          description: description || `Uploaded from ${path.basename(directoryPath)}`,\r\n          metadata: {\r\n            source_directory: path.basename(directoryPath),\r\n          },\r\n        });\r\n        results.push(result);\r\n      }\r\n    }\r\n\r\n    logger.info({ module: 'FileSearch', directoryPath, fileCount: results.length }, 'Uploaded files from directory');\r\n    return results;\r\n  } catch (error) {\r\n    logger.error({ module: 'FileSearch', directoryPath, err: error }, 'Error uploading directory');\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Seed the File Search Store with initial reference materials\r\n * Call this once to bootstrap the system with NDS examples\r\n */\r\nexport async function seedFileSearchStore() {\r\n  logger.info({ module: 'FileSearch' }, 'Seeding File Search Store with initial reference materials');\r\n\r\n  try {\r\n    // Create reference materials directory if it doesn't exist\r\n    const refDir = path.join(process.cwd(), 'reference-materials');\r\n    await fs.mkdir(refDir, { recursive: true });\r\n\r\n    // Create subdirectories for each category\r\n    const categories = Object.values(FileCategory);\r\n    for (const category of categories) {\r\n      await fs.mkdir(path.join(refDir, category), { recursive: true });\r\n    }\r\n\r\n    logger.info({ module: 'FileSearch', referenceDir: refDir }, 'Created reference materials directory structure');\r\n\r\n    return { success: true, referenceDir: refDir };\r\n  } catch (error) {\r\n    logger.error({ module: 'FileSearch', err: error }, 'Error seeding File Search Store');\r\n    throw error;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\geminiService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\geminiVideoService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\generation\\criticStage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1070,1073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1070,1073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2453,2456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2453,2456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Critic Stage  Auto-Quality Evaluation\r\n *\r\n * Evaluates a generated ad image against the original prompt, brand guidelines,\r\n * and product requirements. If quality is below threshold, returns a revised\r\n * prompt for re-generation.\r\n *\r\n * Inspired by PaperBanana's Critic Agent pattern (iterative refinement).\r\n * Runs silently  user never sees the critique, just gets a better image.\r\n */\r\n\r\nimport { logger } from '../../lib/logger';\r\nimport type { GenerationContext } from '../../types/generationPipeline';\r\nimport type { CritiqueResult } from '../../types/generationPipeline';\r\n\r\n/** Minimum score (0-100) to pass without retry */\r\nconst QUALITY_THRESHOLD = 60;\r\n\r\n/** Maximum retry attempts */\r\nconst MAX_RETRIES = 2;\r\n\r\n/**\r\n * Evaluate a generated image and decide if it needs re-generation.\r\n *\r\n * Sends the generated image + original prompt to a VLM for evaluation.\r\n * Returns a CritiqueResult with pass/fail, score, and optional revised prompt.\r\n */\r\nexport async function evaluateGeneration(ctx: GenerationContext, geminiClient: any): Promise<CritiqueResult> {\r\n  if (!ctx.result?.imageBase64) {\r\n    return defaultPass();\r\n  }\r\n\r\n  const critiquePrompt = buildCritiquePrompt(ctx);\r\n\r\n  try {\r\n    const result = await geminiClient.models.generateContent({\r\n      model: 'gemini-3-flash',\r\n      contents: [\r\n        {\r\n          role: 'user',\r\n          parts: [\r\n            {\r\n              inlineData: {\r\n                mimeType: ctx.result.mimeType || 'image/png',\r\n                data: ctx.result.imageBase64,\r\n              },\r\n            },\r\n            { text: critiquePrompt },\r\n          ],\r\n        },\r\n      ],\r\n      config: {\r\n        responseMimeType: 'application/json',\r\n      },\r\n    });\r\n\r\n    const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text;\r\n    if (!responseText) {\r\n      logger.warn({ module: 'CriticStage' }, 'No critique response  passing by default');\r\n      return defaultPass();\r\n    }\r\n\r\n    return parseCritiqueResponse(responseText);\r\n  } catch (err) {\r\n    logger.warn({ module: 'CriticStage', err }, 'Critique evaluation failed  passing by default');\r\n    return defaultPass();\r\n  }\r\n}\r\n\r\n/**\r\n * Run the full critic loop: evaluate, optionally re-generate, up to MAX_RETRIES.\r\n *\r\n * Returns the final generation result (either the original or an improved one).\r\n */\r\nexport async function runCriticLoop(\r\n  ctx: GenerationContext,\r\n  geminiClient: any,\r\n  regenerateFn: (revisedPrompt: string) => Promise<typeof ctx.result>,\r\n): Promise<{ retriesUsed: number; finalCritique: CritiqueResult }> {\r\n  let retriesUsed = 0;\r\n\r\n  for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {\r\n    const critique = await evaluateGeneration(ctx, geminiClient);\r\n\r\n    logger.info(\r\n      {\r\n        module: 'CriticStage',\r\n        attempt: attempt + 1,\r\n        score: critique.score,\r\n        passed: critique.passed,\r\n        issues: critique.issues,\r\n      },\r\n      'Critique evaluation result',\r\n    );\r\n\r\n    if (critique.passed) {\r\n      return { retriesUsed, finalCritique: critique };\r\n    }\r\n\r\n    // Needs improvement  try to re-generate with revised prompt\r\n    if (!critique.revisedPrompt) {\r\n      // No revision suggestion  accept as-is\r\n      logger.info({ module: 'CriticStage' }, 'Failed critique but no revision suggested  accepting');\r\n      return { retriesUsed, finalCritique: critique };\r\n    }\r\n\r\n    logger.info({ module: 'CriticStage', attempt: attempt + 1 }, 'Re-generating with revised prompt');\r\n\r\n    try {\r\n      const newResult = await regenerateFn(critique.revisedPrompt);\r\n      ctx.result = newResult;\r\n      retriesUsed++;\r\n    } catch (err) {\r\n      logger.warn({ module: 'CriticStage', err }, 'Re-generation failed  keeping current result');\r\n      return { retriesUsed, finalCritique: critique };\r\n    }\r\n  }\r\n\r\n  // Exhausted retries  do a final evaluation for logging\r\n  const finalCritique = await evaluateGeneration(ctx, geminiClient);\r\n  return { retriesUsed, finalCritique };\r\n}\r\n\r\n// ============================================\r\n// PROMPT CONSTRUCTION\r\n// ============================================\r\n\r\nfunction buildCritiquePrompt(ctx: GenerationContext): string {\r\n  const userPrompt = ctx.input.prompt;\r\n  const brandName = ctx.brand?.name || 'Unknown';\r\n  const brandColors = ctx.brand?.colors?.join(', ') || 'not specified';\r\n  const productName = ctx.product?.primaryName || 'the product';\r\n  const hasProductImages = ctx.input.images.length > 0;\r\n\r\n  return `You are an advertising quality evaluator. Analyze this generated ad image and evaluate it against the original requirements.\r\n\r\nORIGINAL PROMPT: \"${userPrompt}\"\r\n\r\nCONTEXT:\r\n- Brand: ${brandName}\r\n- Brand Colors: ${brandColors}\r\n- Product: ${productName}\r\n- Product photos were provided: ${hasProductImages ? 'YES  product should be clearly visible' : 'NO  product was described in text only'}\r\n\r\nEvaluate the image on these 4 criteria:\r\n1. PRODUCT VISIBLE: Is the product/subject clearly visible and recognizable? (true/false)\r\n2. BRAND CONSISTENT: Does the image align with the brand colors and style? (true/false)\r\n3. COMPOSITION GOOD: Is the composition professional and balanced? (true/false)\r\n4. PROMPT FAITHFUL: Does the image match what was requested in the prompt? (true/false)\r\n\r\nGive an overall quality score from 0-100 where:\r\n- 80-100: Excellent, ready to publish\r\n- 60-79: Acceptable\r\n- 40-59: Needs improvement\r\n- 0-39: Poor, should be regenerated\r\n\r\nIf the score is below ${QUALITY_THRESHOLD}, provide a REVISED version of the original prompt that would fix the issues.\r\n\r\nRespond in this exact JSON format:\r\n{\r\n  \"score\": <number 0-100>,\r\n  \"product_visible\": <boolean>,\r\n  \"brand_consistent\": <boolean>,\r\n  \"composition_good\": <boolean>,\r\n  \"prompt_faithful\": <boolean>,\r\n  \"issues\": [<string list of specific issues found, empty if none>],\r\n  \"revised_prompt\": <string or null  only if score < ${QUALITY_THRESHOLD}>\r\n}`;\r\n}\r\n\r\n// ============================================\r\n// RESPONSE PARSING\r\n// ============================================\r\n\r\nfunction parseCritiqueResponse(responseText: string): CritiqueResult {\r\n  try {\r\n    // Try to extract JSON from the response\r\n    let jsonStr = responseText.trim();\r\n\r\n    // Handle markdown code blocks\r\n    if (jsonStr.startsWith('```')) {\r\n      const match = jsonStr.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\r\n      if (match) jsonStr = match[1].trim();\r\n    }\r\n\r\n    const data = JSON.parse(jsonStr);\r\n\r\n    // If score is missing or invalid, default to passing (don't block generation)\r\n    const rawScore = typeof data.score === 'number' ? data.score : null;\r\n    if (rawScore === null) {\r\n      logger.warn({ module: 'CriticStage' }, 'Critique response missing score  passing by default');\r\n      return defaultPass();\r\n    }\r\n    const score = Math.min(100, Math.max(0, rawScore));\r\n\r\n    return {\r\n      passed: score >= QUALITY_THRESHOLD,\r\n      score,\r\n      checks: {\r\n        productVisible: data.product_visible !== false,\r\n        brandConsistent: data.brand_consistent !== false,\r\n        compositionGood: data.composition_good !== false,\r\n        promptFaithful: data.prompt_faithful !== false,\r\n      },\r\n      issues: Array.isArray(data.issues) ? data.issues.slice(0, 5) : [],\r\n      revisedPrompt: typeof data.revised_prompt === 'string' ? data.revised_prompt : undefined,\r\n    };\r\n  } catch (err) {\r\n    logger.warn({ module: 'CriticStage', err }, 'Failed to parse critique response');\r\n    return defaultPass();\r\n  }\r\n}\r\n\r\nfunction defaultPass(): CritiqueResult {\r\n  return {\r\n    passed: true,\r\n    score: 75,\r\n    checks: {\r\n      productVisible: true,\r\n      brandConsistent: true,\r\n      compositionGood: true,\r\n      promptFaithful: true,\r\n    },\r\n    issues: [],\r\n  };\r\n}\r\n\r\nexport { QUALITY_THRESHOLD, MAX_RETRIES };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\generation\\generationPipelineService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5754,5757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5754,5757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5800,5803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5800,5803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5852,5855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5852,5855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":155,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5916,5919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5916,5919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6496,6499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6496,6499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7020,7023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7020,7023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12308,12311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12308,12311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":369,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13008,13011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13008,13011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":593,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":593,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19946,19949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19946,19949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Generation Pipeline Service\r\n *\r\n * Systematic orchestrator for image generation that connects ALL context sources.\r\n *\r\n * Pipeline stages (in order):\r\n * 1. Input (already parsed)\r\n * 2. Product Context  productKnowledgeService\r\n * 3. Brand Context  storage.getBrandProfileByUserId\r\n * 4. Style References  styleAnalysisService (KEY FIX: was 100% disconnected)\r\n * 5. Vision Analysis  visionAnalysisService\r\n * 6. KB/RAG Enrichment  fileSearchService\r\n * 7. Learned Patterns  patternExtractionService\r\n * 8. Template Resolution  storage.getAdSceneTemplateById\r\n * 9. Prompt Assembly  promptBuilder\r\n * 9.5. Pre-Generation Quality Gate  preGenGate (blocks score<40, warns 40-60)\r\n * 10. Generation  Gemini API\r\n * 10.5. Critic  auto-quality evaluation + silent retry (PaperBanana pattern)\r\n * 11. Persistence  storage.saveGeneration\r\n *\r\n * Each stage is fault-tolerant: if any context source fails, the pipeline\r\n * continues with what it has (same pattern as IdeaBank).\r\n */\r\n\r\nimport { logger } from '../../lib/logger';\r\nimport { storage } from '../../storage';\r\nimport { genAI, createGeminiClient } from '../../lib/gemini';\r\nimport { buildStyleDirective } from '../styleAnalysisService';\r\nimport { buildEnhancedContext } from '../productKnowledgeService';\r\nimport { analyzeProductImage } from '../visionAnalysisService';\r\nimport { queryFileSearchStore } from '../fileSearchService';\r\nimport { getRelevantPatterns, formatPatternsForPrompt } from '../patternExtractionService';\r\nimport { saveOriginalFile, saveGeneratedImage } from '../../fileStorage';\r\nimport { estimateGenerationCostMicros } from '../pricingEstimator';\r\nimport { buildPrompt } from './promptBuilder';\r\nimport { runCriticLoop } from './criticStage';\r\nimport { evaluatePreGenGate, BLOCK_THRESHOLD, WARN_THRESHOLD } from './preGenGate';\r\nimport type { PreGenGateResult } from './preGenGate';\r\nimport { captureException } from '../../lib/sentry';\r\nimport { notify } from '../notificationService';\r\nimport { getBrandDNAContext } from '../brandDNAService';\r\n\r\nimport type { GenerationContext, GenerationInput, GenerationResult } from '../../types/generationPipeline';\r\n\r\n// ============================================\r\n// MAIN PIPELINE\r\n// ============================================\r\n\r\n/**\r\n * Execute the full generation pipeline.\r\n *\r\n * Takes a GenerationInput, runs all context-gathering stages,\r\n * assembles the prompt, calls Gemini, and persists the result.\r\n */\r\nexport async function executeGenerationPipeline(input: GenerationInput): Promise<GenerationResult> {\r\n  const startTime = Date.now();\r\n  const stagesCompleted: string[] = [];\r\n\r\n  // Initialize context with input\r\n  const ctx: GenerationContext = { input };\r\n\r\n  logger.info(\r\n    {\r\n      module: 'GenerationPipeline',\r\n      mode: input.mode,\r\n      imageCount: input.images.length,\r\n      hasTemplate: !!input.templateId,\r\n      hasRecipe: !!input.recipe,\r\n      hasStyleRefs: !!input.styleReferenceIds?.length,\r\n    },\r\n    'Pipeline started',\r\n  );\r\n\r\n  // Stage 2: Product Context\r\n  await runStage('product', stagesCompleted, async () => {\r\n    ctx.product = await stageProductContext(ctx);\r\n  });\r\n\r\n  // Stage 3: Brand Context\r\n  await runStage('brand', stagesCompleted, async () => {\r\n    ctx.brand = await stageBrandContext(ctx);\r\n  });\r\n\r\n  // Stage 4: Style References (was completely disconnected)\r\n  await runStage('style', stagesCompleted, async () => {\r\n    ctx.style = await stageStyleReferences(ctx);\r\n  });\r\n\r\n  // Stage 5: Vision Analysis\r\n  await runStage('vision', stagesCompleted, async () => {\r\n    ctx.vision = await stageVisionAnalysis(ctx);\r\n  });\r\n\r\n  // Stage 6: KB/RAG Enrichment\r\n  await runStage('kb', stagesCompleted, async () => {\r\n    ctx.kb = await stageKBEnrichment(ctx);\r\n  });\r\n\r\n  // Stage 7: Learned Patterns\r\n  await runStage('patterns', stagesCompleted, async () => {\r\n    ctx.patterns = await stageLearnedPatterns(ctx);\r\n  });\r\n\r\n  // Stage 8: Template Resolution\r\n  await runStage('template', stagesCompleted, async () => {\r\n    ctx.template = await stageTemplateResolution(ctx);\r\n  });\r\n\r\n  // Stage 9: Prompt Assembly (not try/catch  must succeed)\r\n  const finalPrompt = buildPrompt(ctx);\r\n  const imageParts = await buildImageParts(ctx);\r\n  ctx.assembled = { finalPrompt, imageParts };\r\n  stagesCompleted.push('assembly');\r\n\r\n  logger.info(\r\n    {\r\n      module: 'GenerationPipeline',\r\n      stagesCompleted,\r\n      promptLength: finalPrompt.length,\r\n      imagePartsCount: imageParts.length,\r\n    },\r\n    'Prompt assembled',\r\n  );\r\n\r\n  // Stage 9.5: Pre-Generation Quality Gate\r\n  // Evaluates prompt + context completeness before expensive image generation.\r\n  // Score < 40 blocks (throws), 40-60 warns (continues), > 60 passes.\r\n  // NOTE: Unlike other stages, a BLOCK result must propagate  not be swallowed by runStage.\r\n  let preGenGateResult: PreGenGateResult | undefined;\r\n  try {\r\n    preGenGateResult = await evaluatePreGenGate({\r\n      prompt: input.prompt,\r\n      hasImages: input.images.length > 0,\r\n      imageCount: input.images.length,\r\n      hasTemplate: !!ctx.template,\r\n      hasBrandContext: !!ctx.brand,\r\n      hasRecipe: !!input.recipe,\r\n      mode: input.mode,\r\n    });\r\n    stagesCompleted.push('preGenGate');\r\n\r\n    if (preGenGateResult.score < BLOCK_THRESHOLD) {\r\n      // Block generation  throw with suggestions so the caller can return a 400\r\n      const suggestionsText =\r\n        preGenGateResult.suggestions.length > 0\r\n          ? `\\nSuggestions:\\n${preGenGateResult.suggestions.map((s) => `  - ${s}`).join('\\n')}`\r\n          : '';\r\n      const err = new Error(\r\n        `Pre-generation quality gate failed (score: ${preGenGateResult.score}/100).${suggestionsText}`,\r\n      );\r\n      (err as any).name = 'PreGenGateError';\r\n      (err as any).score = preGenGateResult.score;\r\n      (err as any).suggestions = preGenGateResult.suggestions;\r\n      (err as any).breakdown = preGenGateResult.breakdown;\r\n      throw err;\r\n    }\r\n\r\n    if (preGenGateResult.score < WARN_THRESHOLD) {\r\n      logger.warn(\r\n        {\r\n          module: 'GenerationPipeline',\r\n          score: preGenGateResult.score,\r\n          suggestions: preGenGateResult.suggestions,\r\n          breakdown: preGenGateResult.breakdown,\r\n        },\r\n        'Pre-gen gate warning  proceeding with reduced confidence',\r\n      );\r\n    } else {\r\n      logger.info({ module: 'GenerationPipeline', score: preGenGateResult.score }, 'Pre-gen gate passed');\r\n    }\r\n  } catch (err: any) {\r\n    // If it's a PreGenGateError, re-throw  caller should handle it\r\n    if (err.name === 'PreGenGateError') {\r\n      throw err;\r\n    }\r\n    // For any other error (LLM failure, network issue), log and continue\r\n    logger.warn(\r\n      { module: 'GenerationPipeline', stage: 'preGenGate', err },\r\n      'Pre-gen gate failed  continuing without it',\r\n    );\r\n  }\r\n\r\n  // Stage 10: Generation (must succeed  alert on failure)\r\n  let genResult;\r\n  try {\r\n    genResult = await stageGeneration(ctx);\r\n  } catch (err: any) {\r\n    captureException(err instanceof Error ? err : new Error(String(err)), {\r\n      stage: 'generation',\r\n      mode: input.mode,\r\n      userId: input.userId,\r\n    });\r\n    notify({\r\n      severity: 'error',\r\n      title: 'Image Generation Failed',\r\n      message: err?.message || 'Gemini API call failed',\r\n      context: {\r\n        mode: input.mode,\r\n        userId: input.userId,\r\n        promptLength: ctx.assembled?.finalPrompt?.length ?? 0,\r\n        imageCount: input.images.length,\r\n      },\r\n    }).catch((notifyErr) => {\r\n      logger.debug({ module: 'GenerationPipeline', err: notifyErr }, 'Notification delivery failed');\r\n    });\r\n    throw err; // Re-throw  caller handles the error response\r\n  }\r\n  ctx.result = genResult;\r\n  stagesCompleted.push('generation');\r\n\r\n  // Stage 10.5: Critic  silent auto-quality evaluation + retry\r\n  await runStage('critic', stagesCompleted, async () => {\r\n    const geminiClient = await resolveGeminiClient(ctx.input.userId);\r\n\r\n    const { retriesUsed, finalCritique } = await runCriticLoop(ctx, geminiClient, async (revisedPrompt: string) => {\r\n      // Re-generate with revised prompt  keep same images, swap prompt text\r\n      const revisedCtx = { ...ctx };\r\n      revisedCtx.assembled = {\r\n        finalPrompt: revisedPrompt,\r\n        imageParts: ctx.assembled.imageParts,\r\n      };\r\n      return stageGeneration(revisedCtx);\r\n    });\r\n\r\n    if (retriesUsed > 0) {\r\n      logger.info(\r\n        {\r\n          module: 'GenerationPipeline',\r\n          retriesUsed,\r\n          finalScore: finalCritique.score,\r\n        },\r\n        'Critic improved generation via auto-retry',\r\n      );\r\n    }\r\n  });\r\n\r\n  // Stage 11: Persistence\r\n  const persistResult = await stagePersistence(ctx, startTime);\r\n  stagesCompleted.push('persistence');\r\n\r\n  const processingTimeMs = Date.now() - startTime;\r\n  logger.info(\r\n    {\r\n      module: 'GenerationPipeline',\r\n      generationId: persistResult.generationId,\r\n      processingTimeMs,\r\n      stagesCompleted,\r\n    },\r\n    'Pipeline completed',\r\n  );\r\n\r\n  return {\r\n    generationId: persistResult.generationId,\r\n    imageUrl: persistResult.imageUrl,\r\n    prompt: input.prompt,\r\n    canEdit: true,\r\n    mode: input.mode,\r\n    templateId: input.templateId || undefined,\r\n    stagesCompleted,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// HELPER: Fault-tolerant stage runner\r\n// ============================================\r\n\r\nasync function runStage(name: string, stagesCompleted: string[], fn: () => Promise<void>): Promise<void> {\r\n  try {\r\n    await fn();\r\n    stagesCompleted.push(name);\r\n  } catch (err) {\r\n    logger.warn({ module: 'GenerationPipeline', stage: name, err }, `Stage ${name} failed  continuing without it`);\r\n  }\r\n}\r\n\r\n// ============================================\r\n// STAGE IMPLEMENTATIONS\r\n// ============================================\r\n\r\n/**\r\n * Stage 2: Product Context\r\n * Fetch product data and enhanced context (relationships, scenarios, brand images).\r\n */\r\nasync function stageProductContext(ctx: GenerationContext) {\r\n  // Extract product IDs from recipe (validate structure defensively)\r\n  const productIds = Array.isArray(ctx.input.recipe?.products)\r\n    ? ctx.input.recipe.products.map((p) => (typeof p?.id === 'string' ? p.id : '')).filter(Boolean)\r\n    : [];\r\n  if (productIds.length === 0) return undefined;\r\n\r\n  const primaryId = productIds[0];\r\n  const enhanced = await buildEnhancedContext(primaryId, ctx.input.userId);\r\n  if (!enhanced) return undefined;\r\n\r\n  return {\r\n    primaryId,\r\n    primaryName: enhanced.product.name,\r\n    category: enhanced.product.category,\r\n    description: enhanced.product.description,\r\n    relationships: enhanced.relatedProducts.map((rp) => ({\r\n      targetProductName: rp.product.name,\r\n      relationshipType: rp.relationshipType,\r\n      description: rp.relationshipDescription,\r\n    })),\r\n    scenarios: enhanced.installationScenarios.map((s) => ({\r\n      title: s.title,\r\n      description: s.description,\r\n      steps: s.installationSteps,\r\n      isActive: true,\r\n    })),\r\n    brandImages: enhanced.brandImages.map((bi) => ({\r\n      imageUrl: bi.cloudinaryUrl,\r\n      category: bi.category,\r\n    })),\r\n    formattedContext: enhanced.formattedContext,\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 3: Brand Context\r\n * Fetch brand profile for the current user.\r\n * Also fetches Brand DNA context for enrichment.\r\n */\r\nasync function stageBrandContext(ctx: GenerationContext) {\r\n  const brandProfile = await storage.getBrandProfileByUserId(ctx.input.userId);\r\n\r\n  // Fetch Brand DNA context (Phase 5)  runs in parallel, fault-tolerant\r\n  try {\r\n    const dnaContext = await getBrandDNAContext(ctx.input.userId, storage);\r\n    if (dnaContext) {\r\n      ctx.brandDNA = {\r\n        visualSignature: undefined,\r\n        toneGuidance: undefined,\r\n        contentRules: dnaContext,\r\n      };\r\n    }\r\n  } catch (err) {\r\n    logger.warn({ module: 'GenerationPipeline', err }, 'Brand DNA fetch failed  continuing without it');\r\n  }\r\n\r\n  if (!brandProfile) return undefined;\r\n\r\n  return {\r\n    name: brandProfile.brandName || 'Unknown',\r\n    styles: brandProfile.preferredStyles || [],\r\n    values: brandProfile.brandValues || [],\r\n    colors: brandProfile.colorPreferences || [],\r\n    voicePrinciples: (brandProfile.voice as any)?.principles || [],\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 4: Style References (KEY FIX  was completely disconnected)\r\n * Fetch user's selected style references and build a style directive.\r\n */\r\nasync function stageStyleReferences(ctx: GenerationContext) {\r\n  const ids = ctx.input.styleReferenceIds;\r\n  if (!ids || ids.length === 0) return undefined;\r\n\r\n  const directives: string[] = [];\r\n\r\n  for (const id of ids.slice(0, 3)) {\r\n    const ref = await storage.getStyleReferenceById(id);\r\n    if (!ref) continue;\r\n\r\n    // Use cached analysis if available\r\n    if (ref.styleDescription && ref.extractedElements) {\r\n      const directive = buildStyleDirective(ref.styleDescription, ref.extractedElements as any);\r\n      directives.push(directive);\r\n    }\r\n  }\r\n\r\n  if (directives.length === 0) return undefined;\r\n\r\n  return {\r\n    directive: directives.join('\\n'),\r\n    referenceCount: directives.length,\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 5: Vision Analysis\r\n * Analyze the product image to extract visual characteristics.\r\n */\r\nasync function stageVisionAnalysis(ctx: GenerationContext) {\r\n  // Need a product with an image to analyze\r\n  const productIds = ctx.input.recipe?.products?.map((p) => p.id) || [];\r\n  if (productIds.length === 0) return undefined;\r\n\r\n  const product = await storage.getProductById(productIds[0]);\r\n  if (!product || !product.cloudinaryUrl) return undefined;\r\n\r\n  const result = await analyzeProductImage(product, ctx.input.userId);\r\n  if (!result.success || !result.analysis) return undefined;\r\n\r\n  const analysis = result.analysis;\r\n  return {\r\n    category: analysis.category,\r\n    materials: analysis.materials,\r\n    colors: analysis.colors,\r\n    style: analysis.style,\r\n    usageContext: analysis.usageContext,\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 6: KB/RAG Enrichment\r\n * Query the knowledge base for relevant brand guidelines and context.\r\n */\r\nasync function stageKBEnrichment(ctx: GenerationContext) {\r\n  // Build a query from the prompt + product context\r\n  const queryParts = [ctx.input.prompt];\r\n  if (ctx.product?.primaryName) {\r\n    queryParts.push(ctx.product.primaryName);\r\n  }\r\n  if (ctx.product?.category) {\r\n    queryParts.push(ctx.product.category);\r\n  }\r\n\r\n  const result = await queryFileSearchStore({\r\n    query: queryParts.join(' '),\r\n    maxResults: 3,\r\n  });\r\n\r\n  if (!result) return undefined;\r\n\r\n  return {\r\n    context: result.context,\r\n    citations: result.citations?.map((c) => String(c)) || [],\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 7: Learned Patterns\r\n * Fetch relevant patterns from the user's pattern library.\r\n */\r\nasync function stageLearnedPatterns(ctx: GenerationContext) {\r\n  const patterns = await getRelevantPatterns({\r\n    userId: ctx.input.userId,\r\n    category: ctx.vision?.category || ctx.product?.category || undefined,\r\n    industry: ctx.brand?.name ? undefined : undefined, // Could be enhanced later\r\n    maxPatterns: 3,\r\n  });\r\n\r\n  if (patterns.length === 0) return undefined;\r\n\r\n  const directive = formatPatternsForPrompt(patterns);\r\n  return {\r\n    directive,\r\n    patternCount: patterns.length,\r\n  };\r\n}\r\n\r\n/**\r\n * Stage 8: Template Resolution\r\n * Fetch template details if a templateId was provided.\r\n */\r\nasync function stageTemplateResolution(ctx: GenerationContext) {\r\n  if (!ctx.input.templateId) return undefined;\r\n\r\n  const template = await storage.getAdSceneTemplateById(ctx.input.templateId);\r\n  if (!template) return undefined;\r\n\r\n  return {\r\n    id: template.id,\r\n    title: template.title,\r\n    blueprint: template.promptBlueprint,\r\n    mood: template.mood || '',\r\n    lighting: template.lightingStyle || '',\r\n    environment: template.environment || '',\r\n    placementHints: template.placementHints || {},\r\n    category: template.category,\r\n    referenceImageUrls: template.referenceImageUrls || [],\r\n  };\r\n}\r\n\r\n// ============================================\r\n// IMAGE PARTS BUILDER\r\n// ============================================\r\n\r\n/**\r\n * Build the image parts array for the Gemini API call.\r\n * Includes template reference images + user-uploaded product images.\r\n */\r\nasync function buildImageParts(\r\n  ctx: GenerationContext,\r\n): Promise<Array<{ inlineData: { mimeType: string; data: string } }>> {\r\n  const parts: Array<{ inlineData: { mimeType: string; data: string } }> = [];\r\n\r\n  // Add template reference images (for exact_insert mode)\r\n  if (ctx.input.mode === 'exact_insert' && ctx.input.templateReferenceUrls) {\r\n    const isAllowedUrl = (url: string): boolean => {\r\n      try {\r\n        const parsed = new URL(url);\r\n        const allowedHosts = ['res.cloudinary.com', 'images.unsplash.com', 'cdn.pixabay.com'];\r\n        return parsed.protocol === 'https:' && allowedHosts.some((h) => parsed.hostname.endsWith(h));\r\n      } catch {\r\n        return false;\r\n      }\r\n    };\r\n\r\n    for (const refUrl of ctx.input.templateReferenceUrls.slice(0, 3)) {\r\n      if (!isAllowedUrl(refUrl)) {\r\n        logger.warn({ module: 'GenerationPipeline', url: refUrl }, 'Skipping disallowed URL');\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 10000);\r\n        const response = await fetch(refUrl, { signal: controller.signal });\r\n        clearTimeout(timeoutId);\r\n\r\n        if (response.ok) {\r\n          const buffer = await response.arrayBuffer();\r\n          parts.push({\r\n            inlineData: {\r\n              mimeType: 'image/jpeg',\r\n              data: Buffer.from(buffer).toString('base64'),\r\n            },\r\n          });\r\n        }\r\n      } catch (err) {\r\n        logger.warn({ module: 'GenerationPipeline', url: refUrl, err }, 'Failed to fetch template reference image');\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add user-uploaded product images\r\n  for (const img of ctx.input.images) {\r\n    parts.push({\r\n      inlineData: {\r\n        mimeType: img.mimetype,\r\n        data: img.buffer.toString('base64'),\r\n      },\r\n    });\r\n  }\r\n\r\n  return parts;\r\n}\r\n\r\n// ============================================\r\n// STAGE 10: GENERATION\r\n// ============================================\r\n\r\nasync function stageGeneration(ctx: GenerationContext) {\r\n  const geminiClient = await resolveGeminiClient(ctx.input.userId);\r\n\r\n  const modelName = 'gemini-3-pro-image-preview';\r\n  const validResolutions = ['1K', '2K', '4K'];\r\n  const resolution = validResolutions.includes(ctx.input.resolution) ? ctx.input.resolution : '2K';\r\n\r\n  // Build content parts: images first, then prompt text\r\n  const userParts = [...ctx.assembled.imageParts, { text: ctx.assembled.finalPrompt }];\r\n\r\n  const contents = [{ role: 'user', parts: userParts }];\r\n\r\n  logger.info({ module: 'GenerationPipeline', model: modelName, resolution }, 'Calling Gemini API');\r\n\r\n  const result = await geminiClient.models.generateContent({\r\n    model: modelName,\r\n    contents,\r\n    config: {\r\n      imageConfig: {\r\n        imageSize: resolution,\r\n      },\r\n    },\r\n  });\r\n\r\n  // Extract image from response\r\n  if (!result.candidates?.[0]?.content?.parts?.[0]) {\r\n    throw new Error('No image generated');\r\n  }\r\n\r\n  const modelResponse = result.candidates[0].content;\r\n  const imagePart = modelResponse.parts?.find((p) => p.inlineData);\r\n\r\n  if (!imagePart?.inlineData?.data) {\r\n    throw new Error('Generated content was not an image');\r\n  }\r\n\r\n  // Build conversation history for future edits\r\n  const conversationHistory = [\r\n    { role: 'user', parts: userParts },\r\n    modelResponse, // Contains thoughtSignature fields  DO NOT MODIFY\r\n  ];\r\n\r\n  return {\r\n    imageBase64: imagePart.inlineData.data,\r\n    mimeType: imagePart.inlineData.mimeType || 'image/png',\r\n    conversationHistory,\r\n    usageMetadata: (result as any).usageMetadata || {},\r\n    modelResponse,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// STAGE 11: PERSISTENCE\r\n// ============================================\r\n\r\nasync function stagePersistence(\r\n  ctx: GenerationContext,\r\n  startTime: number,\r\n): Promise<{ generationId: string; imageUrl: string }> {\r\n  const result = ctx.result;\r\n\r\n  // Save uploaded originals to disk\r\n  const originalImagePaths: string[] = [];\r\n  for (const img of ctx.input.images) {\r\n    const savedPath = await saveOriginalFile(img.buffer, img.originalname);\r\n    originalImagePaths.push(savedPath);\r\n  }\r\n\r\n  // Save generated image\r\n  const format = (result.mimeType || 'image/png').split('/')[1] || 'png';\r\n  const generatedImagePath = await saveGeneratedImage(result.imageBase64, format);\r\n\r\n  // Save generation record\r\n  const generation = await storage.saveGeneration({\r\n    userId: ctx.input.userId,\r\n    prompt: ctx.input.prompt,\r\n    originalImagePaths,\r\n    generatedImagePath,\r\n    resolution: ctx.input.resolution,\r\n    conversationHistory: result.conversationHistory,\r\n    parentGenerationId: null,\r\n    editPrompt: null,\r\n  });\r\n\r\n  // Persist usage/cost estimate\r\n  try {\r\n    const durationMs = Date.now() - startTime;\r\n    const cost = estimateGenerationCostMicros({\r\n      resolution: ctx.input.resolution,\r\n      inputImagesCount: ctx.input.images.length,\r\n      promptChars: ctx.input.prompt.length,\r\n      usageMetadata: typeof result.usageMetadata === 'object' ? result.usageMetadata : null,\r\n    });\r\n\r\n    await storage.saveGenerationUsage({\r\n      generationId: generation.id,\r\n      brandId: ctx.input.userId || 'anonymous',\r\n      model: 'gemini-3-pro-image-preview',\r\n      operation: 'generate',\r\n      resolution: ctx.input.resolution,\r\n      inputImagesCount: ctx.input.images.length,\r\n      promptChars: ctx.input.prompt.length,\r\n      durationMs,\r\n      inputTokens: cost.inputTokens,\r\n      outputTokens: cost.outputTokens,\r\n      estimatedCostMicros: cost.estimatedCostMicros,\r\n      estimationSource: cost.estimationSource,\r\n    });\r\n  } catch (e) {\r\n    logger.warn({ module: 'GenerationPipeline', err: e }, 'Failed to persist generation usage');\r\n  }\r\n\r\n  const imageUrl = generatedImagePath.startsWith('http')\r\n    ? generatedImagePath\r\n    : `/${generatedImagePath.replace(/\\\\/g, '/')}`;\r\n\r\n  return { generationId: generation.id, imageUrl };\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\n/**\r\n * Resolve the Gemini client for a user (uses their saved API key if available).\r\n */\r\nasync function resolveGeminiClient(userId: string | undefined) {\r\n  if (!userId) return genAI;\r\n  try {\r\n    const resolved = await storage.resolveApiKey(userId, 'gemini');\r\n    if (resolved.key && resolved.source === 'user') {\r\n      return createGeminiClient(resolved.key);\r\n    }\r\n  } catch {\r\n    // Fall through to default\r\n  }\r\n  return genAI;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\generation\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\generation\\preGenGate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\generation\\promptBuilder.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11539,11542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11539,11542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Prompt Builder\r\n *\r\n * Assembles the final generation prompt from all pipeline context.\r\n * Extracts the prompt construction logic that was inline in /api/transform\r\n * into a testable, reusable module.\r\n *\r\n * Three mode-specific builders:\r\n * - buildStandardPrompt: direct generation from user prompt\r\n * - buildExactInsertPrompt: product inserted into template scene\r\n * - buildInspirationPrompt: template-inspired creative generation\r\n *\r\n * Each builder layers context in order:\r\n * [Style Directive] + [Core Prompt] + [Brand Context] + [Product Context]\r\n * + [Patterns] + [KB Context] + [Quality Constraints]\r\n */\r\n\r\nimport type { GenerationContext } from '../../types/generationPipeline';\r\nimport { logger } from '../../lib/logger';\r\n\r\n/**\r\n * Build the final prompt based on generation mode and all available context.\r\n */\r\nexport function buildPrompt(ctx: GenerationContext): string {\r\n  const { mode } = ctx.input;\r\n  const hasImages = ctx.input.images.length > 0;\r\n\r\n  let prompt: string;\r\n\r\n  switch (mode) {\r\n    case 'exact_insert':\r\n      prompt = buildExactInsertPrompt(ctx, hasImages);\r\n      break;\r\n    case 'inspiration':\r\n      prompt = buildInspirationPrompt(ctx, hasImages);\r\n      break;\r\n    default:\r\n      prompt = buildStandardPrompt(ctx, hasImages);\r\n      break;\r\n  }\r\n\r\n  // Layer shared context sections onto any mode's prompt\r\n  prompt = appendStyleDirective(prompt, ctx);\r\n  prompt = appendBrandContext(prompt, ctx);\r\n  prompt = appendBrandDNAContext(prompt, ctx);\r\n  prompt = appendProductContext(prompt, ctx);\r\n  prompt = appendPatternsContext(prompt, ctx);\r\n  prompt = appendKBContext(prompt, ctx);\r\n  prompt = appendVisionContext(prompt, ctx);\r\n  prompt = appendPlatformGuidelines(prompt, ctx);\r\n\r\n  return prompt;\r\n}\r\n\r\n// ============================================\r\n// MODE-SPECIFIC PROMPT BUILDERS\r\n// ============================================\r\n\r\nfunction buildStandardPrompt(ctx: GenerationContext, hasImages: boolean): string {\r\n  const { prompt } = ctx.input;\r\n\r\n  if (!hasImages) {\r\n    // Text-only generation  use prompt as-is\r\n    return prompt;\r\n  }\r\n\r\n  if (ctx.input.images.length === 1) {\r\n    return `Transform this product photo based on the following instructions: ${prompt}\r\n\r\nGuidelines:\r\n- Keep the product as the hero/focus\r\n- Maintain professional photography quality\r\n- Ensure the product is clearly visible and recognizable\r\n- Apply the requested scene, lighting, and style changes\r\n- Do not add text or watermarks`;\r\n  }\r\n\r\n  return `Transform these ${ctx.input.images.length} product photos based on the following instructions: ${prompt}\r\n\r\nGuidelines:\r\n- Combine/arrange all products in a cohesive scene\r\n- Keep all products clearly visible and recognizable\r\n- Maintain professional photography quality\r\n- Apply the requested scene, lighting, and style changes\r\n- Show how the products work together or as a collection\r\n- Do not add text or watermarks`;\r\n}\r\n\r\nfunction buildExactInsertPrompt(ctx: GenerationContext, hasImages: boolean): string {\r\n  const { prompt } = ctx.input;\r\n  const template = ctx.template;\r\n\r\n  if (!template) {\r\n    // Fallback to standard if template is missing\r\n    return buildStandardPrompt(ctx, hasImages);\r\n  }\r\n\r\n  if (hasImages) {\r\n    return `Insert this product into the following scene template while maintaining exact quality standards.\r\n\r\nTemplate Scene: ${template.blueprint}\r\n\r\nUser Instructions: ${prompt}\r\n\r\nCRITICAL QUALITY CONSTRAINTS:\r\n- Product must be clearly visible and recognizable as the main subject\r\n- Product lighting must match the template scene's lighting style exactly\r\n- Product placement must follow the template's placement hints: ${JSON.stringify(template.placementHints || {})}\r\n- Maintain professional photography quality\r\n- Scene environment should match template exactly: ${template.environment || 'as described'}\r\n- Overall mood must match template mood: ${template.mood || 'as described'}\r\n- Do not add text or watermarks\r\n- Product must look natural and integrated into the scene, not pasted on\r\n\r\nIf multiple products provided, arrange them according to the template's composition while maintaining all quality constraints.`;\r\n  }\r\n\r\n  return `Generate an image following this scene template exactly.\r\n\r\nTemplate Scene: ${template.blueprint}\r\n\r\nUser Instructions: ${prompt}\r\n\r\nQUALITY CONSTRAINTS:\r\n- Follow the template's scene description precisely\r\n- Match lighting style: ${template.lighting || 'as described in template'}\r\n- Match environment: ${template.environment || 'as described'}\r\n- Match mood: ${template.mood || 'as described'}\r\n- Professional photography quality\r\n- Do not add text or watermarks`;\r\n}\r\n\r\nfunction buildInspirationPrompt(ctx: GenerationContext, hasImages: boolean): string {\r\n  const { prompt } = ctx.input;\r\n  const template = ctx.template;\r\n\r\n  if (!template) {\r\n    return buildStandardPrompt(ctx, hasImages);\r\n  }\r\n\r\n  if (hasImages) {\r\n    return `Transform this product photo inspired by the following template style, but create a unique scene.\r\n\r\nTemplate Inspiration:\r\n- Category: ${template.category}\r\n- Mood: ${template.mood || 'not specified'}\r\n- Lighting Style: ${template.lighting || 'not specified'}\r\n- Environment Type: ${template.environment || 'not specified'}\r\n- General Vibe: ${template.blueprint.slice(0, 200)}\r\n\r\nUser Instructions: ${prompt}\r\n\r\nGuidelines:\r\n- Keep the product as the hero/focus\r\n- Capture the template's mood and style, but create a NEW unique scene\r\n- Maintain professional photography quality\r\n- Ensure the product is clearly visible and recognizable\r\n- Do not copy the template scene exactly - be creative while maintaining the aesthetic\r\n- Do not add text or watermarks`;\r\n  }\r\n\r\n  return `Generate an image inspired by this template style, creating a unique scene.\r\n\r\nTemplate Inspiration:\r\n- Category: ${template.category}\r\n- Mood: ${template.mood || 'not specified'}\r\n- Lighting Style: ${template.lighting || 'not specified'}\r\n- Environment: ${template.environment || 'not specified'}\r\n\r\nUser Instructions: ${prompt}\r\n\r\nGuidelines:\r\n- Capture the template's aesthetic and mood\r\n- Create a unique scene, don't copy the template exactly\r\n- Professional photography quality\r\n- Do not add text or watermarks`;\r\n}\r\n\r\n// ============================================\r\n// SHARED CONTEXT APPENDORS\r\n// ============================================\r\n\r\nfunction appendStyleDirective(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.style?.directive) return prompt;\r\n\r\n  logger.info(\r\n    { module: 'PromptBuilder', referenceCount: ctx.style.referenceCount },\r\n    'Style directive applied to prompt',\r\n  );\r\n\r\n  // Style directive goes at the very top for maximum influence\r\n  return `${ctx.style.directive}\\n\\n${prompt}`;\r\n}\r\n\r\nfunction appendBrandContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.brand) return prompt;\r\n\r\n  const brand = ctx.brand;\r\n  const section = `\r\n\r\nBRAND GUIDELINES (${brand.name}):\r\n- Visual Style: ${brand.styles.join(', ') || 'Professional'}\r\n- Brand Values: ${brand.values.join(', ') || 'Reliability'}\r\n- Brand Colors: ${brand.colors.join(', ') || 'Standard'}\r\n- Voice Principles: ${brand.voicePrinciples.join(', ') || 'Professional'}\r\n\r\nEnsure the generated image aligns with these brand guidelines where possible.`;\r\n\r\n  return prompt + section;\r\n}\r\n\r\nfunction appendProductContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.product) return prompt;\r\n\r\n  let section = `\r\n\r\nPRODUCT CONTEXT:`;\r\n\r\n  // Relationships\r\n  if (ctx.product.relationships.length > 0) {\r\n    section += `\r\nRelated Products:`;\r\n    for (const rel of ctx.product.relationships.slice(0, 5)) {\r\n      section += `\r\n- ${rel.targetProductName} (${rel.relationshipType})${rel.description ? `: ${rel.description}` : ''}`;\r\n    }\r\n  }\r\n\r\n  // Installation scenarios\r\n  const activeScenarios = ctx.product.scenarios.filter((s) => s.isActive !== false);\r\n  if (activeScenarios.length > 0) {\r\n    section += `\r\nInstallation Context:`;\r\n    for (const scenario of activeScenarios.slice(0, 2)) {\r\n      section += `\r\n- ${scenario.title}: ${scenario.description.slice(0, 200)}`;\r\n    }\r\n  }\r\n\r\n  section += `\r\n\r\nConsider these product relationships and usage contexts when generating the image.`;\r\n\r\n  return prompt + section;\r\n}\r\n\r\nfunction appendPatternsContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.patterns?.directive) return prompt;\r\n\r\n  logger.info(\r\n    { module: 'PromptBuilder', patternCount: ctx.patterns.patternCount },\r\n    'Learned patterns applied to prompt',\r\n  );\r\n\r\n  return (\r\n    prompt +\r\n    `\r\n\r\nLEARNED ADVERTISING PATTERNS:\r\n${ctx.patterns.directive}\r\n\r\nApply relevant patterns from successful ads when composing the image.`\r\n  );\r\n}\r\n\r\nfunction appendKBContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.kb?.context) return prompt;\r\n\r\n  logger.info({ module: 'PromptBuilder' }, 'KB context applied to prompt');\r\n\r\n  return (\r\n    prompt +\r\n    `\r\n\r\nBRAND KNOWLEDGE BASE:\r\n${ctx.kb.context.slice(0, 1000)}\r\n\r\nUse this brand knowledge to inform the image generation.`\r\n  );\r\n}\r\n\r\nfunction appendVisionContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.vision) return prompt;\r\n\r\n  return (\r\n    prompt +\r\n    `\r\n\r\nPRODUCT VISUAL ANALYSIS:\r\n- Category: ${ctx.vision.category}\r\n- Materials: ${ctx.vision.materials.join(', ')}\r\n- Colors: ${ctx.vision.colors.join(', ')}\r\n- Style: ${ctx.vision.style}\r\n- Usage Context: ${ctx.vision.usageContext}\r\n\r\nEnsure the generated image is consistent with these product characteristics.`\r\n  );\r\n}\r\n\r\n/**\r\n * Append Brand DNA context (Phase 5 Intelligence Layer).\r\n * Adds persistent brand insights learned from historical brand data analysis.\r\n */\r\nfunction appendBrandDNAContext(prompt: string, ctx: GenerationContext): string {\r\n  if (!ctx.brandDNA?.contentRules) return prompt;\r\n\r\n  logger.info({ module: 'PromptBuilder' }, 'Brand DNA context applied to prompt');\r\n\r\n  return (\r\n    prompt +\r\n    `\r\n${ctx.brandDNA.contentRules}\r\n\r\nApply these brand DNA insights to ensure generation aligns with the brand's proven patterns.`\r\n  );\r\n}\r\n\r\n// ============================================\r\n// PLATFORM-SPECIFIC GUIDELINES (Phase 5.3)\r\n// ============================================\r\n\r\n/**\r\n * Returns platform-specific image guidelines for the target platform.\r\n */\r\nexport function getPlatformGuidelines(platform: string): string {\r\n  const guidelines: Record<string, string> = {\r\n    instagram:\r\n      'Square (1:1) or vertical (4:5), vibrant colors, lifestyle-focused, clean composition, high visual impact',\r\n    linkedin: 'Horizontal (1.91:1), professional tone, data-driven visuals, minimal text overlay, business-appropriate',\r\n    tiktok: 'Vertical (9:16), bold text, high contrast, dynamic composition, eye-catching in first frame',\r\n    facebook: 'Flexible (1.91:1 for ads, 1:1 for posts), engaging, storytelling-focused, works at small sizes in feed',\r\n    twitter: 'Horizontal (16:9), clean composition, minimal text, works well cropped, stands out in timeline',\r\n    'twitter/x': 'Horizontal (16:9), clean composition, minimal text, works well cropped, stands out in timeline',\r\n  };\r\n\r\n  return guidelines[platform.toLowerCase()] || '';\r\n}\r\n\r\n/**\r\n * Append platform-specific guidelines to the prompt if a target platform is specified.\r\n */\r\nfunction appendPlatformGuidelines(prompt: string, ctx: GenerationContext): string {\r\n  // Determine platform from input or recipe\r\n  const platform = ctx.input.platform || (ctx.input.recipe as any)?.platform || null;\r\n\r\n  if (!platform) return prompt;\r\n\r\n  const guidelines = getPlatformGuidelines(platform);\r\n  if (!guidelines) return prompt;\r\n\r\n  logger.info({ module: 'PromptBuilder', platform }, 'Platform guidelines applied to prompt');\r\n\r\n  return (\r\n    prompt +\r\n    `\r\n\r\nPLATFORM GUIDELINES (${platform.toUpperCase()}):\r\n${guidelines}\r\n\r\nOptimize the image composition and style for ${platform} best practices.`\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\googleCloudMonitoringService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":364,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11417,11420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11417,11420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":402,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12762,12765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12762,12765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[858,861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[858,861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Google Cloud Monitoring Service\r\n *\r\n * Fetches real quota usage data from Google Cloud Monitoring API.\r\n * This provides accurate, Google-verified quota consumption data\r\n * with ~15 minute latency from Google's side.\r\n *\r\n * Prerequisites:\r\n * 1. Enable Cloud Monitoring API in Google Cloud Console\r\n * 2. Create a service account with \"Monitoring Viewer\" role\r\n * 3. Download the JSON key file\r\n * 4. Set GOOGLE_CLOUD_PROJECT and GOOGLE_APPLICATION_CREDENTIALS env vars\r\n *\r\n * @see https://cloud.google.com/monitoring/api/metrics\r\n * @see https://cloud.google.com/monitoring/alerts/using-quota-metrics\r\n */\r\n\r\nimport { logger } from \"../lib/logger\";\r\nimport { storage } from \"../storage\";\r\n\r\n// Lazy-load jsonwebtoken to prevent import errors from crashing the server\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nlet jwtSign: any = null;\r\n\r\nasync function ensureJwtLoaded(): Promise<void> {\r\n  if (!jwtSign) {\r\n    try {\r\n      const pkg = await import(\"jsonwebtoken\");\r\n      jwtSign = pkg.default?.sign || pkg.sign;\r\n    } catch (error) {\r\n      logger.error({ module: 'GoogleCloudMonitoring', err: error }, 'Failed to load jsonwebtoken');\r\n      throw new Error('jsonwebtoken module not available');\r\n    }\r\n  }\r\n}\r\n\r\n// Types for Cloud Monitoring API responses\r\ninterface TimeSeriesPoint {\r\n  interval: {\r\n    startTime: string;\r\n    endTime: string;\r\n  };\r\n  value: {\r\n    int64Value?: string;\r\n    doubleValue?: number;\r\n  };\r\n}\r\n\r\ninterface TimeSeries {\r\n  metric: {\r\n    type: string;\r\n    labels: Record<string, string>;\r\n  };\r\n  resource: {\r\n    type: string;\r\n    labels: Record<string, string>;\r\n  };\r\n  points: TimeSeriesPoint[];\r\n}\r\n\r\ninterface TimeSeriesListResponse {\r\n  timeSeries?: TimeSeries[];\r\n  nextPageToken?: string;\r\n}\r\n\r\nexport interface GoogleQuotaSnapshot {\r\n  syncedAt: Date;\r\n  projectId: string;\r\n  service: string;\r\n  quotas: {\r\n    metricName: string;\r\n    displayName: string;\r\n    usage: number;\r\n    limit: number;\r\n    percentage: number;\r\n    unit: string;\r\n  }[];\r\n  syncStatus: 'success' | 'partial' | 'failed';\r\n  errorMessage?: string;\r\n  nextSyncAt: Date;\r\n}\r\n\r\n// Quota metrics we care about for Gemini API\r\nconst GEMINI_QUOTA_METRICS = [\r\n  {\r\n    metricType: 'serviceruntime.googleapis.com/quota/rate/net_usage',\r\n    quotaMetric: 'generativelanguage.googleapis.com/generate_content_requests',\r\n    displayName: 'Generate Content Requests',\r\n    unit: 'requests',\r\n  },\r\n  {\r\n    metricType: 'serviceruntime.googleapis.com/quota/allocation/usage',\r\n    quotaMetric: 'generativelanguage.googleapis.com/generate_content_input_token_count',\r\n    displayName: 'Input Tokens',\r\n    unit: 'tokens',\r\n  },\r\n  {\r\n    metricType: 'serviceruntime.googleapis.com/quota/allocation/usage',\r\n    quotaMetric: 'generativelanguage.googleapis.com/generate_content_output_token_count',\r\n    displayName: 'Output Tokens',\r\n    unit: 'tokens',\r\n  },\r\n];\r\n\r\n// Sync interval in milliseconds (15 minutes)\r\nconst SYNC_INTERVAL_MS = 15 * 60 * 1000;\r\n\r\n// In-memory cache for last sync\r\nlet lastSyncResult: GoogleQuotaSnapshot | null = null;\r\nlet syncTimer: NodeJS.Timeout | null = null;\r\n\r\n/**\r\n * Check if Google Cloud credentials are configured\r\n */\r\nexport function isGoogleCloudConfigured(): boolean {\r\n  return !!(\r\n    process.env.GOOGLE_CLOUD_PROJECT &&\r\n    (process.env.GOOGLE_APPLICATION_CREDENTIALS || process.env.GOOGLE_CLOUD_CREDENTIALS_JSON)\r\n  );\r\n}\r\n\r\n/**\r\n * Get the Google Cloud project ID\r\n */\r\nfunction getProjectId(): string {\r\n  const projectId = process.env.GOOGLE_CLOUD_PROJECT;\r\n  if (!projectId) {\r\n    throw new Error('GOOGLE_CLOUD_PROJECT environment variable is not set');\r\n  }\r\n  return projectId;\r\n}\r\n\r\n/**\r\n * Get an access token using Application Default Credentials\r\n * This works with:\r\n * - Service account JSON key file (GOOGLE_APPLICATION_CREDENTIALS)\r\n * - Inline JSON credentials (GOOGLE_CLOUD_CREDENTIALS_JSON)\r\n * - GCE metadata server (when running on Google Cloud)\r\n */\r\nasync function getAccessToken(): Promise<string> {\r\n  // Try inline credentials first (for Railway/Render deployment)\r\n  if (process.env.GOOGLE_CLOUD_CREDENTIALS_JSON) {\r\n    try {\r\n      const credentials = JSON.parse(process.env.GOOGLE_CLOUD_CREDENTIALS_JSON);\r\n      return await getAccessTokenFromServiceAccount(credentials);\r\n    } catch (error) {\r\n      logger.error({ module: 'GoogleCloudMonitoring', err: error }, 'Failed to parse inline credentials');\r\n    }\r\n  }\r\n\r\n  // Try Application Default Credentials\r\n  if (process.env.GOOGLE_APPLICATION_CREDENTIALS) {\r\n    try {\r\n      const fs = await import('fs');\r\n      const credentialsPath = process.env.GOOGLE_APPLICATION_CREDENTIALS;\r\n      const credentialsJson = fs.readFileSync(credentialsPath, 'utf-8');\r\n      const credentials = JSON.parse(credentialsJson);\r\n      return await getAccessTokenFromServiceAccount(credentials);\r\n    } catch (error) {\r\n      logger.error({ module: 'GoogleCloudMonitoring', err: error }, 'Failed to load credentials file');\r\n    }\r\n  }\r\n\r\n  // Try GCE metadata server (when running on Google Cloud)\r\n  try {\r\n    const response = await fetch(\r\n      'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token',\r\n      { headers: { 'Metadata-Flavor': 'Google' } }\r\n    );\r\n    if (response.ok) {\r\n      const data = await response.json();\r\n      return data.access_token;\r\n    }\r\n  } catch {\r\n    // Not running on GCE, that's fine\r\n  }\r\n\r\n  throw new Error('No Google Cloud credentials configured. Set GOOGLE_APPLICATION_CREDENTIALS or GOOGLE_CLOUD_CREDENTIALS_JSON');\r\n}\r\n\r\n/**\r\n * Get access token from service account credentials using JWT\r\n */\r\nasync function getAccessTokenFromServiceAccount(credentials: {\r\n  client_email: string;\r\n  private_key: string;\r\n  token_uri?: string;\r\n}): Promise<string> {\r\n  // Ensure jsonwebtoken is loaded\r\n  await ensureJwtLoaded();\r\n  if (!jwtSign) {\r\n    throw new Error('jsonwebtoken not available');\r\n  }\r\n\r\n  const now = Math.floor(Date.now() / 1000);\r\n  const payload = {\r\n    iss: credentials.client_email,\r\n    sub: credentials.client_email,\r\n    aud: credentials.token_uri || 'https://oauth2.googleapis.com/token',\r\n    iat: now,\r\n    exp: now + 3600,\r\n    scope: 'https://www.googleapis.com/auth/monitoring.read',\r\n  };\r\n\r\n  const token = jwtSign(payload, credentials.private_key, { algorithm: 'RS256' });\r\n\r\n  const response = await fetch('https://oauth2.googleapis.com/token', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n    body: new URLSearchParams({\r\n      grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\r\n      assertion: token,\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`Failed to get access token: ${error}`);\r\n  }\r\n\r\n  const data = await response.json();\r\n  return data.access_token;\r\n}\r\n\r\n/**\r\n * Query Cloud Monitoring API for time series data\r\n */\r\nasync function queryTimeSeries(\r\n  projectId: string,\r\n  filter: string,\r\n  startTime: Date,\r\n  endTime: Date\r\n): Promise<TimeSeries[]> {\r\n  const accessToken = await getAccessToken();\r\n\r\n  const params = new URLSearchParams({\r\n    filter,\r\n    'interval.startTime': startTime.toISOString(),\r\n    'interval.endTime': endTime.toISOString(),\r\n    'aggregation.alignmentPeriod': '60s',\r\n    'aggregation.perSeriesAligner': 'ALIGN_RATE',\r\n  });\r\n\r\n  const url = `https://monitoring.googleapis.com/v3/projects/${projectId}/timeSeries?${params}`;\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Authorization: `Bearer ${accessToken}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    logger.error({ module: 'GoogleCloudMonitoring', status: response.status, error }, 'API error');\r\n    throw new Error(`Cloud Monitoring API error: ${response.status} ${response.statusText}`);\r\n  }\r\n\r\n  const data: TimeSeriesListResponse = await response.json();\r\n  return data.timeSeries || [];\r\n}\r\n\r\n/**\r\n * Query quota limit from Cloud Monitoring\r\n */\r\nasync function queryQuotaLimit(\r\n  projectId: string,\r\n  quotaMetric: string\r\n): Promise<number | null> {\r\n  const accessToken = await getAccessToken();\r\n\r\n  const filter = `metric.type=\"serviceruntime.googleapis.com/quota/limit\" AND resource.type=\"consumer_quota\" AND resource.label.service=\"generativelanguage.googleapis.com\" AND metric.label.quota_metric=\"${quotaMetric}\"`;\r\n\r\n  const endTime = new Date();\r\n  const startTime = new Date(endTime.getTime() - 60 * 60 * 1000); // Last hour\r\n\r\n  const params = new URLSearchParams({\r\n    filter,\r\n    'interval.startTime': startTime.toISOString(),\r\n    'interval.endTime': endTime.toISOString(),\r\n  });\r\n\r\n  const url = `https://monitoring.googleapis.com/v3/projects/${projectId}/timeSeries?${params}`;\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Authorization: `Bearer ${accessToken}`,\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    return null;\r\n  }\r\n\r\n  const data: TimeSeriesListResponse = await response.json();\r\n  const series = data.timeSeries?.[0];\r\n  const point = series?.points?.[0];\r\n\r\n  if (point?.value?.int64Value) {\r\n    return parseInt(point.value.int64Value, 10);\r\n  }\r\n  if (point?.value?.doubleValue !== undefined) {\r\n    return point.value.doubleValue;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Fetch all Gemini API quota metrics from Google Cloud Monitoring\r\n */\r\nexport async function fetchGoogleQuotaSnapshot(): Promise<GoogleQuotaSnapshot> {\r\n  const syncedAt = new Date();\r\n  const nextSyncAt = new Date(syncedAt.getTime() + SYNC_INTERVAL_MS);\r\n\r\n  if (!isGoogleCloudConfigured()) {\r\n    return {\r\n      syncedAt,\r\n      projectId: 'not-configured',\r\n      service: 'generativelanguage.googleapis.com',\r\n      quotas: [],\r\n      syncStatus: 'failed',\r\n      errorMessage: 'Google Cloud credentials not configured. Set GOOGLE_CLOUD_PROJECT and GOOGLE_APPLICATION_CREDENTIALS or GOOGLE_CLOUD_CREDENTIALS_JSON.',\r\n      nextSyncAt,\r\n    };\r\n  }\r\n\r\n  try {\r\n    const projectId = getProjectId();\r\n    const endTime = new Date();\r\n    const startTime = new Date(endTime.getTime() - 60 * 60 * 1000); // Last hour\r\n\r\n    const quotas: GoogleQuotaSnapshot['quotas'] = [];\r\n    const errors: string[] = [];\r\n\r\n    for (const metric of GEMINI_QUOTA_METRICS) {\r\n      try {\r\n        // Query usage\r\n        const usageFilter = `metric.type=\"${metric.metricType}\" AND resource.type=\"consumer_quota\" AND resource.label.service=\"generativelanguage.googleapis.com\" AND metric.label.quota_metric=\"${metric.quotaMetric}\"`;\r\n\r\n        const timeSeries = await queryTimeSeries(projectId, usageFilter, startTime, endTime);\r\n\r\n        // Get the most recent value\r\n        let usage = 0;\r\n        if (timeSeries.length > 0 && timeSeries[0].points?.length > 0) {\r\n          const point = timeSeries[0].points[0];\r\n          usage = point.value.int64Value\r\n            ? parseInt(point.value.int64Value, 10)\r\n            : (point.value.doubleValue || 0);\r\n        }\r\n\r\n        // Query limit\r\n        const limit = await queryQuotaLimit(projectId, metric.quotaMetric) || 0;\r\n\r\n        quotas.push({\r\n          metricName: metric.quotaMetric,\r\n          displayName: metric.displayName,\r\n          usage,\r\n          limit,\r\n          percentage: limit > 0 ? (usage / limit) * 100 : 0,\r\n          unit: metric.unit,\r\n        });\r\n      } catch (error: any) {\r\n        logger.error({ module: 'GoogleCloudMonitoring', metric: metric.displayName, err: error }, 'Failed to fetch metric');\r\n        errors.push(`${metric.displayName}: ${error.message}`);\r\n      }\r\n    }\r\n\r\n    const result: GoogleQuotaSnapshot = {\r\n      syncedAt,\r\n      projectId,\r\n      service: 'generativelanguage.googleapis.com',\r\n      quotas,\r\n      syncStatus: errors.length === 0 ? 'success' : (quotas.length > 0 ? 'partial' : 'failed'),\r\n      errorMessage: errors.length > 0 ? errors.join('; ') : undefined,\r\n      nextSyncAt,\r\n    };\r\n\r\n    // Cache the result\r\n    lastSyncResult = result;\r\n\r\n    // Persist to database\r\n    try {\r\n      await storage.saveGoogleQuotaSnapshot({\r\n        syncedAt: result.syncedAt,\r\n        nextSyncAt: result.nextSyncAt,\r\n        syncStatus: result.syncStatus,\r\n        errorMessage: result.errorMessage || null,\r\n        projectId: result.projectId,\r\n        service: result.service,\r\n        quotas: result.quotas,\r\n        brandId: null, // Global snapshot\r\n      });\r\n    } catch (dbError) {\r\n      logger.warn({ module: 'GoogleCloudMonitoring', err: dbError }, 'Failed to persist snapshot to database');\r\n    }\r\n\r\n    logger.info({ module: 'GoogleCloudMonitoring', metricCount: quotas.length, status: result.syncStatus }, 'Sync completed');\r\n\r\n    return result;\r\n  } catch (error: any) {\r\n    logger.error({ module: 'GoogleCloudMonitoring', err: error }, 'Sync failed');\r\n\r\n    const result: GoogleQuotaSnapshot = {\r\n      syncedAt,\r\n      projectId: process.env.GOOGLE_CLOUD_PROJECT || 'unknown',\r\n      service: 'generativelanguage.googleapis.com',\r\n      quotas: [],\r\n      syncStatus: 'failed',\r\n      errorMessage: error.message,\r\n      nextSyncAt,\r\n    };\r\n\r\n    lastSyncResult = result;\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the last sync result (from memory cache)\r\n */\r\nexport function getLastSyncResult(): GoogleQuotaSnapshot | null {\r\n  return lastSyncResult;\r\n}\r\n\r\n/**\r\n * Get sync status information\r\n */\r\nexport function getSyncStatus(): {\r\n  isConfigured: boolean;\r\n  lastSyncedAt: Date | null;\r\n  nextSyncAt: Date | null;\r\n  syncIntervalMs: number;\r\n  status: 'success' | 'partial' | 'failed' | 'never_synced';\r\n  errorMessage?: string;\r\n} {\r\n  const isConfigured = isGoogleCloudConfigured();\r\n\r\n  if (!lastSyncResult) {\r\n    return {\r\n      isConfigured,\r\n      lastSyncedAt: null,\r\n      nextSyncAt: isConfigured ? new Date(Date.now() + 1000) : null, // Sync soon if configured\r\n      syncIntervalMs: SYNC_INTERVAL_MS,\r\n      status: 'never_synced',\r\n    };\r\n  }\r\n\r\n  return {\r\n    isConfigured,\r\n    lastSyncedAt: lastSyncResult.syncedAt,\r\n    nextSyncAt: lastSyncResult.nextSyncAt,\r\n    syncIntervalMs: SYNC_INTERVAL_MS,\r\n    status: lastSyncResult.syncStatus,\r\n    errorMessage: lastSyncResult.errorMessage,\r\n  };\r\n}\r\n\r\n/**\r\n * Start the automatic sync timer\r\n */\r\nexport function startAutoSync(): void {\r\n  if (syncTimer) {\r\n    clearInterval(syncTimer);\r\n  }\r\n\r\n  if (!isGoogleCloudConfigured()) {\r\n    logger.info({ module: 'GoogleCloudMonitoring' }, 'Auto-sync disabled: Google Cloud credentials not configured');\r\n    return;\r\n  }\r\n\r\n  logger.info({ module: 'GoogleCloudMonitoring', intervalMinutes: SYNC_INTERVAL_MS / 1000 / 60 }, 'Starting auto-sync');\r\n\r\n  // Initial sync\r\n  fetchGoogleQuotaSnapshot().catch((err) => logger.error({ module: 'GoogleCloudMonitoring', err }, 'Initial sync failed'));\r\n\r\n  // Schedule recurring syncs\r\n  syncTimer = setInterval(() => {\r\n    fetchGoogleQuotaSnapshot().catch((err) => logger.error({ module: 'GoogleCloudMonitoring', err }, 'Scheduled sync failed'));\r\n  }, SYNC_INTERVAL_MS);\r\n}\r\n\r\n/**\r\n * Stop the automatic sync timer\r\n */\r\nexport function stopAutoSync(): void {\r\n  if (syncTimer) {\r\n    clearInterval(syncTimer);\r\n    syncTimer = null;\r\n    logger.info({ module: 'GoogleCloudMonitoring' }, 'Auto-sync stopped');\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger a manual sync\r\n */\r\nexport async function triggerManualSync(): Promise<GoogleQuotaSnapshot> {\r\n  logger.info({ module: 'GoogleCloudMonitoring' }, 'Manual sync triggered');\r\n  return fetchGoogleQuotaSnapshot();\r\n}\r\n\r\nexport const googleCloudMonitoringService = {\r\n  isConfigured: isGoogleCloudConfigured,\r\n  fetchSnapshot: fetchGoogleQuotaSnapshot,\r\n  getLastSync: getLastSyncResult,\r\n  getSyncStatus,\r\n  startAutoSync,\r\n  stopAutoSync,\r\n  triggerManualSync,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\ideaBankService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\imageSizingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\installationScenarioRAG.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":841,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":841,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25390,25393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25390,25393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":852,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":852,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25820,25823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25820,25823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":861,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":861,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26139,26142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26139,26142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":903,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":903,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27278,27281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27278,27281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":937,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":937,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28260,28263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28260,28263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":938,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":938,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28294,28297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28294,28297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Installation Scenario RAG Service\r\n *\r\n * Uses RAG (Retrieval Augmented Generation) to suggest installation steps,\r\n * tips, and required accessories based on product and room type.\r\n *\r\n * This service queries the knowledge base for relevant installation guides\r\n * and uses AI to generate contextual recommendations.\r\n *\r\n * Key capabilities:\r\n * 1. Suggest installation steps based on product type and room context\r\n * 2. Recommend required accessories for a complete installation\r\n * 3. Provide room-specific installation tips\r\n * 4. Match products to installation scenarios from the database\r\n */\r\n\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { storage } from '../storage';\r\nimport { logger } from '../lib/logger';\r\nimport { telemetry } from '../instrumentation';\r\nimport { queryFileSearchStore, FileCategory } from './fileSearchService';\r\nimport type { Product, ProductAnalysis, InstallationScenario } from '@shared/schema';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\n/**\r\n * Room types for installation context\r\n */\r\nexport const ROOM_TYPES = [\r\n  'living_room',\r\n  'bedroom',\r\n  'kitchen',\r\n  'bathroom',\r\n  'basement',\r\n  'commercial',\r\n  'outdoor',\r\n  'hallway',\r\n  'office',\r\n  'dining_room',\r\n] as const;\r\n\r\nexport type RoomType = (typeof ROOM_TYPES)[number];\r\n\r\n/**\r\n * Scenario types for installation contexts\r\n */\r\nexport const SCENARIO_TYPES = ['room_type', 'application', 'before_after'] as const;\r\n\r\nexport type ScenarioType = (typeof SCENARIO_TYPES)[number];\r\n\r\n/**\r\n * Context for installation suggestions\r\n */\r\nexport interface InstallationContext {\r\n  /** Product ID to get installation steps for */\r\n  productId: string;\r\n  /** Room type for context-specific suggestions */\r\n  roomType?: RoomType;\r\n  /** User ID for accessing user-specific scenarios */\r\n  userId: string;\r\n  /** Include related products in suggestions */\r\n  includeRelatedProducts?: boolean;\r\n  /** Maximum number of steps to suggest */\r\n  maxSteps?: number;\r\n}\r\n\r\n/**\r\n * A single installation step suggestion\r\n */\r\nexport interface InstallationStep {\r\n  /** Step number (1-based) */\r\n  stepNumber: number;\r\n  /** Title of the step */\r\n  title: string;\r\n  /** Detailed description of the step */\r\n  description: string;\r\n  /** Estimated time for this step (e.g., \"15 minutes\") */\r\n  estimatedTime?: string;\r\n  /** Tools required for this step */\r\n  toolsRequired?: string[];\r\n  /** Tips specific to this step */\r\n  tips?: string[];\r\n  /** Warning or caution notes */\r\n  warnings?: string[];\r\n}\r\n\r\n/**\r\n * Required accessory recommendation\r\n */\r\nexport interface AccessoryRecommendation {\r\n  /** Name of the accessory */\r\n  name: string;\r\n  /** Category of accessory (e.g., \"underlayment\", \"trim\", \"adhesive\") */\r\n  category: string;\r\n  /** Why this accessory is needed */\r\n  reason: string;\r\n  /** Whether this is required or optional */\r\n  isRequired: boolean;\r\n  /** Quantity suggestion if applicable */\r\n  quantitySuggestion?: string;\r\n  /** Related product ID if we have it in the database */\r\n  relatedProductId?: string;\r\n}\r\n\r\n/**\r\n * Installation tip specific to room type or product\r\n */\r\nexport interface InstallationTip {\r\n  /** The tip content */\r\n  tip: string;\r\n  /** Category of tip (prep, safety, finishing, maintenance) */\r\n  category: 'prep' | 'safety' | 'finishing' | 'maintenance';\r\n  /** Relevance to current context (0-100) */\r\n  relevance: number;\r\n  /** Source of the tip (kb, ai_inference, scenario) */\r\n  source: 'kb' | 'ai_inference' | 'scenario';\r\n}\r\n\r\n/**\r\n * Complete installation suggestion response\r\n */\r\nexport interface InstallationSuggestionResult {\r\n  /** Suggested installation steps */\r\n  steps: InstallationStep[];\r\n  /** Required and recommended accessories */\r\n  accessories: AccessoryRecommendation[];\r\n  /** Room-specific and general tips */\r\n  tips: InstallationTip[];\r\n  /** Matching installation scenarios from database */\r\n  matchingScenarios: InstallationScenario[];\r\n  /** Metadata about the suggestion */\r\n  metadata: {\r\n    productId: string;\r\n    productName: string;\r\n    roomType?: RoomType;\r\n    totalEstimatedTime?: string;\r\n    difficultyLevel?: 'beginner' | 'intermediate' | 'advanced';\r\n    kbContextUsed: boolean;\r\n    generatedAt: Date;\r\n  };\r\n}\r\n\r\n/**\r\n * Room-specific installation context\r\n */\r\nexport interface RoomInstallationContext {\r\n  /** Room type */\r\n  roomType: RoomType;\r\n  /** Special considerations for this room */\r\n  considerations: string[];\r\n  /** Recommended products for this room */\r\n  recommendedProductTypes: string[];\r\n  /** Common challenges */\r\n  challenges: string[];\r\n  /** Best practices */\r\n  bestPractices: string[];\r\n}\r\n\r\n// ============================================\r\n// CONSTANTS\r\n// ============================================\r\n\r\n// Model for text analysis\r\n// MODEL RECENCY RULE: Before changing any model ID, verify today's date and confirm the model is current within the last 3-4 weeks.\r\nconst TEXT_MODEL = 'gemini-3-flash';\r\n\r\n/**\r\n * Room-specific installation considerations\r\n */\r\nconst ROOM_CONSIDERATIONS: Record<RoomType, string[]> = {\r\n  living_room: [\r\n    'High traffic area - consider durability',\r\n    'May need furniture moving and replacement',\r\n    'Natural lighting affects color perception',\r\n    'Consider noise reduction for attached rooms',\r\n  ],\r\n  bedroom: [\r\n    'Softer feel underfoot preferred',\r\n    'Sound insulation important',\r\n    'Consider allergies - hypoallergenic options',\r\n    'Closet and doorway transitions',\r\n  ],\r\n  kitchen: [\r\n    'Water and moisture resistance essential',\r\n    'Easy to clean surface preferred',\r\n    'Consider subfloor leveling for appliances',\r\n    'May need to work around fixed cabinets',\r\n  ],\r\n  bathroom: [\r\n    'Waterproof flooring required',\r\n    'Non-slip surface critical for safety',\r\n    'Proper sealing around fixtures',\r\n    'Moisture barrier installation essential',\r\n  ],\r\n  basement: [\r\n    'Moisture control is primary concern',\r\n    'Concrete subfloor preparation needed',\r\n    'Consider floating floor systems',\r\n    'Temperature and humidity fluctuations',\r\n  ],\r\n  commercial: [\r\n    'Heavy duty products required',\r\n    'ADA compliance considerations',\r\n    'Minimal downtime during installation',\r\n    'Durability and maintenance long-term',\r\n  ],\r\n  outdoor: [\r\n    'Weather resistance critical',\r\n    'UV protection needed',\r\n    'Drainage considerations',\r\n    'Expansion and contraction allowance',\r\n  ],\r\n  hallway: [\r\n    'High traffic durability needed',\r\n    'Transition strips to adjacent rooms',\r\n    'Narrow space installation challenges',\r\n    'Consider pattern direction flow',\r\n  ],\r\n  office: [\r\n    'Professional appearance important',\r\n    'Static control may be needed',\r\n    'Under-desk and chair durability',\r\n    'Acoustic properties for noise',\r\n  ],\r\n  dining_room: [\r\n    'Spill and stain resistance',\r\n    'Easy to clean under furniture',\r\n    'Chair leg protection considerations',\r\n    'May connect to kitchen and living room',\r\n  ],\r\n};\r\n\r\n/**\r\n * Common accessory categories\r\n */\r\nconst _ACCESSORY_CATEGORIES = [\r\n  'underlayment',\r\n  'trim',\r\n  'transition_strips',\r\n  'adhesive',\r\n  'moisture_barrier',\r\n  'fasteners',\r\n  'tools',\r\n  'cleaning_supplies',\r\n  'protection',\r\n] as const;\r\n\r\n// ============================================\r\n// MAIN FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Suggest installation steps for a product\r\n *\r\n * Uses RAG to query knowledge base and AI to generate contextual steps\r\n */\r\nexport async function suggestInstallationSteps(context: InstallationContext): Promise<InstallationSuggestionResult> {\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    // 1. Get the product information\r\n    const product = await storage.getProductById(context.productId);\r\n    if (!product) {\r\n      throw new Error(`Product not found: ${context.productId}`);\r\n    }\r\n\r\n    // 2. Get product analysis if available\r\n    const productAnalysis = await storage.getProductAnalysisByProductId(context.productId);\r\n\r\n    // 3. Get existing installation scenarios for this product\r\n    const matchingScenarios = await storage.getInstallationScenariosForProducts([context.productId]);\r\n\r\n    // 4. If room type specified, also get scenarios by room type\r\n    let roomScenarios: InstallationScenario[] = [];\r\n    if (context.roomType) {\r\n      roomScenarios = await storage.getScenariosByRoomType(context.roomType);\r\n    }\r\n\r\n    // 5. Combine and deduplicate scenarios\r\n    const allScenarios = deduplicateScenarios([...matchingScenarios, ...roomScenarios]);\r\n\r\n    // 6. Query knowledge base for installation guides\r\n    const kbContext = await queryInstallationKnowledgeBase(product, context.roomType);\r\n\r\n    // 7. Build context for AI generation\r\n    const productContext = buildProductContext(product, productAnalysis);\r\n    const roomContext = context.roomType ? buildRoomContext(context.roomType) : null;\r\n    const scenarioContext = buildScenarioContext(allScenarios);\r\n\r\n    // 8. Generate installation suggestions using AI\r\n    const prompt = buildInstallationPrompt(\r\n      product,\r\n      productContext,\r\n      roomContext,\r\n      scenarioContext,\r\n      kbContext,\r\n      context.maxSteps,\r\n    );\r\n\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: TEXT_MODEL,\r\n        contents: [{ role: 'user', parts: [{ text: prompt }] }],\r\n        config: {\r\n          temperature: 0.3, // Lower temperature for more consistent results\r\n        },\r\n      },\r\n      { operation: 'installation_scenario' },\r\n    );\r\n\r\n    const responseText = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n\r\n    // 9. Parse the AI response\r\n    const suggestions = parseInstallationSuggestions(responseText, product, context.roomType);\r\n\r\n    // 10. Enrich with matching scenarios\r\n    suggestions.matchingScenarios = allScenarios;\r\n    suggestions.metadata.kbContextUsed = !!kbContext;\r\n\r\n    // Track telemetry\r\n    telemetry.trackGeminiUsage({\r\n      model: TEXT_MODEL,\r\n      operation: 'generate',\r\n      inputTokens: prompt.length * 0.25,\r\n      durationMs: Date.now() - startTime,\r\n      userId: context.userId,\r\n      success: true,\r\n    });\r\n\r\n    return suggestions;\r\n  } catch (error) {\r\n    telemetry.trackGeminiUsage({\r\n      model: TEXT_MODEL,\r\n      operation: 'generate',\r\n      inputTokens: 0,\r\n      durationMs: Date.now() - startTime,\r\n      success: false,\r\n      errorType: error instanceof Error ? error.name : 'unknown',\r\n    });\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get room-specific installation context\r\n *\r\n * Returns considerations, challenges, and best practices for a room type\r\n */\r\nexport function getRoomInstallationContext(roomType: RoomType): RoomInstallationContext {\r\n  const considerations = ROOM_CONSIDERATIONS[roomType] || [];\r\n\r\n  // Derive recommended product types based on room\r\n  const recommendedProductTypes = getRecommendedProductsForRoom(roomType);\r\n\r\n  // Common challenges for the room type\r\n  const challenges = getChallengesForRoom(roomType);\r\n\r\n  // Best practices\r\n  const bestPractices = getBestPracticesForRoom(roomType);\r\n\r\n  return {\r\n    roomType,\r\n    considerations,\r\n    recommendedProductTypes,\r\n    challenges,\r\n    bestPractices,\r\n  };\r\n}\r\n\r\n/**\r\n * Suggest accessories for a product installation\r\n *\r\n * Queries knowledge base and database for required accessories\r\n */\r\nexport async function suggestAccessories(\r\n  productId: string,\r\n  roomType?: RoomType,\r\n  userId?: string,\r\n): Promise<AccessoryRecommendation[]> {\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    // Get product information\r\n    const product = await storage.getProductById(productId);\r\n    if (!product) {\r\n      throw new Error(`Product not found: ${productId}`);\r\n    }\r\n\r\n    // Get product relationships (items that pair with this product)\r\n    const relationships = await storage.getProductRelationships([productId]);\r\n    const requiredRelationships = relationships.filter((r) => r.isRequired);\r\n    const pairsWithRelationships = relationships.filter((r) => r.relationshipType === 'pairs_with');\r\n\r\n    // Query knowledge base for accessory recommendations\r\n    const kbContext = await queryAccessoryKnowledgeBase(product, roomType);\r\n\r\n    // Build accessory prompt\r\n    const prompt = buildAccessoryPrompt(product, roomType, kbContext);\r\n\r\n    const response = await generateContentWithRetry(\r\n      {\r\n        model: TEXT_MODEL,\r\n        contents: [{ role: 'user', parts: [{ text: prompt }] }],\r\n        config: {\r\n          temperature: 0.2,\r\n        },\r\n      },\r\n      { operation: 'installation_scenario' },\r\n    );\r\n\r\n    const responseText = response.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n\r\n    // Parse AI recommendations\r\n    const aiAccessories = parseAccessoryRecommendations(responseText);\r\n\r\n    // Merge with database relationships\r\n    const mergedAccessories = mergeWithRelationships(aiAccessories, requiredRelationships, pairsWithRelationships);\r\n\r\n    // Track telemetry\r\n    telemetry.trackGeminiUsage({\r\n      model: TEXT_MODEL,\r\n      operation: 'generate',\r\n      inputTokens: prompt.length * 0.25,\r\n      durationMs: Date.now() - startTime,\r\n      userId,\r\n      success: true,\r\n    });\r\n\r\n    return mergedAccessories;\r\n  } catch (error) {\r\n    telemetry.trackGeminiUsage({\r\n      model: TEXT_MODEL,\r\n      operation: 'generate',\r\n      inputTokens: 0,\r\n      durationMs: Date.now() - startTime,\r\n      success: false,\r\n      errorType: error instanceof Error ? error.name : 'unknown',\r\n    });\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get installation tips for a product and room combination\r\n */\r\nexport async function getInstallationTips(\r\n  productId: string,\r\n  roomType?: RoomType,\r\n  _userId?: string,\r\n): Promise<InstallationTip[]> {\r\n  const tips: InstallationTip[] = [];\r\n\r\n  try {\r\n    // Get product information\r\n    const product = await storage.getProductById(productId);\r\n    if (!product) {\r\n      return [];\r\n    }\r\n\r\n    // Get matching scenarios for tips\r\n    const scenarios = await storage.getInstallationScenariosForProducts([productId]);\r\n\r\n    // Add tips from scenarios\r\n    for (const scenario of scenarios) {\r\n      if (scenario.installationSteps) {\r\n        // Extract tips from installation steps (if they contain tip-like content)\r\n        scenario.installationSteps.forEach((step, _index) => {\r\n          if (step.toLowerCase().includes('tip:') || step.toLowerCase().includes('note:')) {\r\n            tips.push({\r\n              tip: step,\r\n              category: 'prep',\r\n              relevance: 80,\r\n              source: 'scenario',\r\n            });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    // Get room-specific tips\r\n    if (roomType) {\r\n      const roomContext = getRoomInstallationContext(roomType);\r\n      roomContext.bestPractices.forEach((practice, index) => {\r\n        tips.push({\r\n          tip: practice,\r\n          category: 'prep',\r\n          relevance: 70 - index * 5,\r\n          source: 'ai_inference',\r\n        });\r\n      });\r\n    }\r\n\r\n    // Query knowledge base for additional tips\r\n    const kbContext = await queryTipsKnowledgeBase(product, roomType);\r\n    if (kbContext) {\r\n      tips.push({\r\n        tip: kbContext,\r\n        category: 'prep',\r\n        relevance: 90,\r\n        source: 'kb',\r\n      });\r\n    }\r\n\r\n    // Sort by relevance\r\n    return tips.sort((a, b) => b.relevance - a.relevance);\r\n  } catch (error) {\r\n    logger.error({ module: 'InstallationRAG', err: error }, 'Error getting tips');\r\n    return tips;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// KNOWLEDGE BASE QUERY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Query knowledge base for installation guides\r\n */\r\nasync function queryInstallationKnowledgeBase(product: Product, roomType?: RoomType): Promise<string | null> {\r\n  try {\r\n    let query = `Installation guide for ${product.name}`;\r\n    if (product.category) {\r\n      query += ` (${product.category})`;\r\n    }\r\n    if (roomType) {\r\n      query += ` in ${roomType.replace('_', ' ')}`;\r\n    }\r\n    query += '. Include step-by-step instructions, required tools, and best practices.';\r\n\r\n    const result = await queryFileSearchStore({\r\n      query,\r\n      category: FileCategory.INSTALLATION_GUIDES,\r\n      maxResults: 5,\r\n    });\r\n\r\n    return result?.context || null;\r\n  } catch (error) {\r\n    logger.warn({ module: 'InstallationRAG', err: error }, 'KB query failed');\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Query knowledge base for accessory recommendations\r\n */\r\nasync function queryAccessoryKnowledgeBase(product: Product, roomType?: RoomType): Promise<string | null> {\r\n  try {\r\n    let query = `Required accessories and materials for installing ${product.name}`;\r\n    if (product.category) {\r\n      query += ` (${product.category})`;\r\n    }\r\n    if (roomType) {\r\n      query += ` in ${roomType.replace('_', ' ')}`;\r\n    }\r\n    query += '. Include underlayment, trim, adhesives, and transition strips.';\r\n\r\n    const result = await queryFileSearchStore({\r\n      query,\r\n      category: FileCategory.INSTALLATION_GUIDES,\r\n      maxResults: 3,\r\n    });\r\n\r\n    return result?.context || null;\r\n  } catch (error) {\r\n    logger.warn({ module: 'InstallationRAG', err: error }, 'Accessory KB query failed');\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Query knowledge base for installation tips\r\n */\r\nasync function queryTipsKnowledgeBase(product: Product, roomType?: RoomType): Promise<string | null> {\r\n  try {\r\n    let query = `Installation tips and tricks for ${product.name}`;\r\n    if (roomType) {\r\n      query += ` in ${roomType.replace('_', ' ')}`;\r\n    }\r\n    query += '. Include common mistakes to avoid and professional recommendations.';\r\n\r\n    const result = await queryFileSearchStore({\r\n      query,\r\n      category: FileCategory.INSTALLATION_GUIDES,\r\n      maxResults: 3,\r\n    });\r\n\r\n    return result?.context || null;\r\n  } catch (error) {\r\n    logger.warn({ module: 'InstallationRAG', err: error }, 'Tips KB query failed');\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CONTEXT BUILDING FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Build product context string for AI prompts\r\n */\r\nfunction buildProductContext(product: Product, analysis?: ProductAnalysis | null): string {\r\n  const parts: string[] = [`Name: ${product.name}`];\r\n\r\n  if (product.description) {\r\n    parts.push(`Description: ${product.description}`);\r\n  }\r\n\r\n  if (product.category) {\r\n    parts.push(`Category: ${product.category}`);\r\n  }\r\n\r\n  if (product.tags && product.tags.length > 0) {\r\n    parts.push(`Tags: ${product.tags.join(', ')}`);\r\n  }\r\n\r\n  if (product.features && typeof product.features === 'object') {\r\n    const featureStr = Object.entries(product.features as Record<string, unknown>)\r\n      .map(([k, v]) => `${k}: ${v}`)\r\n      .join(', ');\r\n    parts.push(`Features: ${featureStr}`);\r\n  }\r\n\r\n  if (product.specifications && typeof product.specifications === 'object') {\r\n    const specStr = Object.entries(product.specifications as Record<string, unknown>)\r\n      .map(([k, v]) => `${k}: ${v}`)\r\n      .join(', ');\r\n    parts.push(`Specifications: ${specStr}`);\r\n  }\r\n\r\n  // Add vision analysis if available\r\n  if (analysis) {\r\n    if (analysis.category) parts.push(`Detected Category: ${analysis.category}`);\r\n    if (analysis.subcategory) parts.push(`Subcategory: ${analysis.subcategory}`);\r\n    if (analysis.materials && analysis.materials.length > 0) {\r\n      parts.push(`Materials: ${analysis.materials.join(', ')}`);\r\n    }\r\n  }\r\n\r\n  return parts.join('\\n');\r\n}\r\n\r\n/**\r\n * Build room context for AI prompts\r\n */\r\nfunction buildRoomContext(roomType: RoomType): string {\r\n  const considerations = ROOM_CONSIDERATIONS[roomType] || [];\r\n  return `Room Type: ${roomType.replace('_', ' ')}\\nConsiderations:\\n- ${considerations.join('\\n- ')}`;\r\n}\r\n\r\n/**\r\n * Build scenario context from existing installation scenarios\r\n */\r\nfunction buildScenarioContext(scenarios: InstallationScenario[]): string {\r\n  if (scenarios.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const scenarioSummaries = scenarios.slice(0, 3).map((s) => {\r\n    const parts = [`Title: ${s.title}`];\r\n    if (s.description) parts.push(`Description: ${s.description}`);\r\n    if (s.installationSteps && s.installationSteps.length > 0) {\r\n      parts.push(`Steps: ${s.installationSteps.length} steps`);\r\n    }\r\n    if (s.requiredAccessories && s.requiredAccessories.length > 0) {\r\n      parts.push(`Accessories: ${s.requiredAccessories.join(', ')}`);\r\n    }\r\n    return parts.join('\\n');\r\n  });\r\n\r\n  return `Existing Installation Scenarios:\\n${scenarioSummaries.join('\\n---\\n')}`;\r\n}\r\n\r\n// ============================================\r\n// PROMPT BUILDING FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Build prompt for installation step generation\r\n */\r\nfunction buildInstallationPrompt(\r\n  product: Product,\r\n  productContext: string,\r\n  roomContext: string | null,\r\n  scenarioContext: string,\r\n  kbContext: string | null,\r\n  maxSteps?: number,\r\n): string {\r\n  const stepLimit = maxSteps || 10;\r\n\r\n  const kbSection = kbContext ? `\\nKnowledge Base Context:\\n${kbContext}\\n` : '';\r\n\r\n  const roomSection = roomContext ? `\\nRoom Context:\\n${roomContext}\\n` : '';\r\n\r\n  const scenarioSection = scenarioContext ? `\\n${scenarioContext}\\n` : '';\r\n\r\n  return `You are an expert flooring and home improvement installation specialist. Generate detailed installation steps for the following product.\r\n\r\nPRODUCT INFORMATION:\r\n${productContext}\r\n${roomSection}\r\n${scenarioSection}\r\n${kbSection}\r\n\r\nTASK: Generate up to ${stepLimit} installation steps with the following information for each:\r\n1. Step number\r\n2. Clear title\r\n3. Detailed description\r\n4. Estimated time (if applicable)\r\n5. Tools required for this step\r\n6. Helpful tips\r\n7. Any warnings or cautions\r\n\r\nAlso provide:\r\n- Required accessories (underlayment, trim, adhesive, etc.)\r\n- General installation tips\r\n- Total estimated time\r\n- Difficulty level (beginner, intermediate, advanced)\r\n\r\nRespond in this exact JSON format:\r\n{\r\n  \"steps\": [\r\n    {\r\n      \"stepNumber\": 1,\r\n      \"title\": \"Prepare the Subfloor\",\r\n      \"description\": \"Clean the subfloor thoroughly...\",\r\n      \"estimatedTime\": \"30 minutes\",\r\n      \"toolsRequired\": [\"broom\", \"vacuum\", \"level\"],\r\n      \"tips\": [\"Check for moisture issues first\"],\r\n      \"warnings\": [\"Ensure subfloor is completely dry\"]\r\n    }\r\n  ],\r\n  \"accessories\": [\r\n    {\r\n      \"name\": \"Underlayment\",\r\n      \"category\": \"underlayment\",\r\n      \"reason\": \"Provides cushioning and moisture protection\",\r\n      \"isRequired\": true,\r\n      \"quantitySuggestion\": \"Same square footage as flooring plus 10%\"\r\n    }\r\n  ],\r\n  \"tips\": [\r\n    {\r\n      \"tip\": \"Acclimate flooring for 48 hours before installation\",\r\n      \"category\": \"prep\"\r\n    }\r\n  ],\r\n  \"metadata\": {\r\n    \"totalEstimatedTime\": \"4-6 hours\",\r\n    \"difficultyLevel\": \"intermediate\"\r\n  }\r\n}`;\r\n}\r\n\r\n/**\r\n * Build prompt for accessory recommendations\r\n */\r\nfunction buildAccessoryPrompt(product: Product, roomType: RoomType | undefined, kbContext: string | null): string {\r\n  const kbSection = kbContext ? `\\nKnowledge Base Context:\\n${kbContext}\\n` : '';\r\n\r\n  const roomSection = roomType\r\n    ? `\\nRoom Type: ${roomType.replace('_', ' ')}\\nConsiderations: ${ROOM_CONSIDERATIONS[roomType]?.join(', ') || 'Standard installation'}\\n`\r\n    : '';\r\n\r\n  return `You are an expert flooring and home improvement specialist. Recommend required and optional accessories for installing this product.\r\n\r\nPRODUCT: ${product.name}\r\n${product.category ? `Category: ${product.category}` : ''}\r\n${product.description ? `Description: ${product.description}` : ''}\r\n${roomSection}\r\n${kbSection}\r\n\r\nTASK: Recommend accessories in these categories:\r\n- Underlayment (if needed)\r\n- Trim and moldings\r\n- Transition strips\r\n- Adhesives or fasteners\r\n- Moisture barriers\r\n- Tools needed\r\n- Cleaning and maintenance supplies\r\n- Protection products\r\n\r\nFor each accessory, specify:\r\n1. Name\r\n2. Category\r\n3. Why it's needed\r\n4. Whether it's required or optional\r\n5. Quantity suggestion if applicable\r\n\r\nRespond in this exact JSON format:\r\n{\r\n  \"accessories\": [\r\n    {\r\n      \"name\": \"Foam Underlayment\",\r\n      \"category\": \"underlayment\",\r\n      \"reason\": \"Provides cushioning and sound absorption\",\r\n      \"isRequired\": true,\r\n      \"quantitySuggestion\": \"Same square footage as flooring\"\r\n    }\r\n  ]\r\n}`;\r\n}\r\n\r\n// ============================================\r\n// PARSING FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Parse installation suggestions from AI response\r\n */\r\nfunction parseInstallationSuggestions(\r\n  responseText: string,\r\n  product: Product,\r\n  roomType?: RoomType,\r\n): InstallationSuggestionResult {\r\n  const defaultResult: InstallationSuggestionResult = {\r\n    steps: [],\r\n    accessories: [],\r\n    tips: [],\r\n    matchingScenarios: [],\r\n    metadata: {\r\n      productId: product.id,\r\n      productName: product.name,\r\n      roomType,\r\n      kbContextUsed: false,\r\n      generatedAt: new Date(),\r\n    },\r\n  };\r\n\r\n  try {\r\n    // Extract JSON from response\r\n    const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\r\n    if (!jsonMatch) {\r\n      return defaultResult;\r\n    }\r\n\r\n    const parsed = JSON.parse(jsonMatch[0]);\r\n\r\n    // Parse steps\r\n    const steps: InstallationStep[] = (parsed.steps || []).map((step: any) => ({\r\n      stepNumber: step.stepNumber || 1,\r\n      title: step.title || 'Installation Step',\r\n      description: step.description || '',\r\n      estimatedTime: step.estimatedTime,\r\n      toolsRequired: step.toolsRequired || [],\r\n      tips: step.tips || [],\r\n      warnings: step.warnings || [],\r\n    }));\r\n\r\n    // Parse accessories\r\n    const accessories: AccessoryRecommendation[] = (parsed.accessories || []).map((acc: any) => ({\r\n      name: acc.name || 'Accessory',\r\n      category: acc.category || 'general',\r\n      reason: acc.reason || '',\r\n      isRequired: acc.isRequired ?? false,\r\n      quantitySuggestion: acc.quantitySuggestion,\r\n    }));\r\n\r\n    // Parse tips\r\n    const tips: InstallationTip[] = (parsed.tips || []).map((tip: any) => ({\r\n      tip: typeof tip === 'string' ? tip : tip.tip || '',\r\n      category: tip.category || 'prep',\r\n      relevance: 75,\r\n      source: 'ai_inference' as const,\r\n    }));\r\n\r\n    // Parse metadata\r\n    const metadata = {\r\n      productId: product.id,\r\n      productName: product.name,\r\n      roomType,\r\n      totalEstimatedTime: parsed.metadata?.totalEstimatedTime,\r\n      difficultyLevel: parsed.metadata?.difficultyLevel,\r\n      kbContextUsed: false,\r\n      generatedAt: new Date(),\r\n    };\r\n\r\n    return {\r\n      steps,\r\n      accessories,\r\n      tips,\r\n      matchingScenarios: [],\r\n      metadata,\r\n    };\r\n  } catch (error) {\r\n    logger.error({ module: 'InstallationRAG', err: error }, 'Failed to parse suggestions');\r\n    return defaultResult;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse accessory recommendations from AI response\r\n */\r\nfunction parseAccessoryRecommendations(responseText: string): AccessoryRecommendation[] {\r\n  try {\r\n    const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\r\n    if (!jsonMatch) {\r\n      return [];\r\n    }\r\n\r\n    const parsed = JSON.parse(jsonMatch[0]);\r\n    return (parsed.accessories || []).map((acc: any) => ({\r\n      name: acc.name || 'Accessory',\r\n      category: acc.category || 'general',\r\n      reason: acc.reason || '',\r\n      isRequired: acc.isRequired ?? false,\r\n      quantitySuggestion: acc.quantitySuggestion,\r\n    }));\r\n  } catch (error) {\r\n    logger.error({ module: 'InstallationRAG', err: error }, 'Failed to parse accessory recommendations');\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Deduplicate installation scenarios by ID\r\n */\r\nfunction deduplicateScenarios(scenarios: InstallationScenario[]): InstallationScenario[] {\r\n  const seen = new Set<string>();\r\n  return scenarios.filter((s) => {\r\n    if (seen.has(s.id)) return false;\r\n    seen.add(s.id);\r\n    return true;\r\n  });\r\n}\r\n\r\n/**\r\n * Merge AI accessories with database relationships\r\n */\r\nfunction mergeWithRelationships(\r\n  aiAccessories: AccessoryRecommendation[],\r\n  requiredRelationships: any[],\r\n  pairsWithRelationships: any[],\r\n): AccessoryRecommendation[] {\r\n  const merged = [...aiAccessories];\r\n  const existingNames = new Set(aiAccessories.map((a) => a.name.toLowerCase()));\r\n\r\n  // Add required relationships\r\n  for (const rel of requiredRelationships) {\r\n    if (!existingNames.has(rel.description?.toLowerCase() || '')) {\r\n      merged.push({\r\n        name: rel.description || 'Required Component',\r\n        category: 'required',\r\n        reason: 'Required for proper installation',\r\n        isRequired: true,\r\n        relatedProductId: rel.targetProductId,\r\n      });\r\n    }\r\n  }\r\n\r\n  // Add pairs_with relationships\r\n  for (const rel of pairsWithRelationships) {\r\n    if (!existingNames.has(rel.description?.toLowerCase() || '')) {\r\n      merged.push({\r\n        name: rel.description || 'Recommended Accessory',\r\n        category: 'recommended',\r\n        reason: rel.description || 'Works well with this product',\r\n        isRequired: false,\r\n        relatedProductId: rel.targetProductId,\r\n      });\r\n    }\r\n  }\r\n\r\n  return merged;\r\n}\r\n\r\n/**\r\n * Get recommended product types for a room\r\n */\r\nfunction getRecommendedProductsForRoom(roomType: RoomType): string[] {\r\n  const recommendations: Record<RoomType, string[]> = {\r\n    living_room: ['hardwood', 'laminate', 'luxury_vinyl', 'carpet'],\r\n    bedroom: ['carpet', 'hardwood', 'laminate', 'cork'],\r\n    kitchen: ['tile', 'luxury_vinyl', 'laminate', 'linoleum'],\r\n    bathroom: ['tile', 'luxury_vinyl', 'waterproof_laminate'],\r\n    basement: ['luxury_vinyl', 'tile', 'epoxy', 'rubber'],\r\n    commercial: ['commercial_tile', 'commercial_vinyl', 'polished_concrete'],\r\n    outdoor: ['tile', 'composite_decking', 'natural_stone', 'rubber'],\r\n    hallway: ['laminate', 'luxury_vinyl', 'tile', 'hardwood'],\r\n    office: ['carpet_tile', 'laminate', 'luxury_vinyl'],\r\n    dining_room: ['hardwood', 'laminate', 'tile', 'luxury_vinyl'],\r\n  };\r\n\r\n  return recommendations[roomType] || ['laminate', 'luxury_vinyl'];\r\n}\r\n\r\n/**\r\n * Get common challenges for a room type\r\n */\r\nfunction getChallengesForRoom(roomType: RoomType): string[] {\r\n  const challenges: Record<RoomType, string[]> = {\r\n    living_room: ['Furniture weight distribution', 'Color matching with existing decor', 'High traffic wear patterns'],\r\n    bedroom: ['Sound transmission to lower floors', 'Closet doorway transitions', 'Under-bed dust accumulation'],\r\n    kitchen: ['Water damage around sink and dishwasher', 'Subfloor leveling for appliances', 'Heat from cooking'],\r\n    bathroom: ['Constant moisture exposure', 'Sealing around toilet and tub', 'Non-slip requirements'],\r\n    basement: ['Concrete moisture issues', 'Temperature fluctuations', 'Potential flooding'],\r\n    commercial: ['Heavy foot traffic', 'Meeting ADA requirements', 'Maintenance scheduling'],\r\n    outdoor: ['Weather exposure', 'UV damage', 'Proper drainage'],\r\n    hallway: ['Narrow working space', 'Multiple room transitions', 'Heavy traffic wear'],\r\n    office: ['Static electricity', 'Cable management under flooring', 'Chair caster damage'],\r\n    dining_room: ['Chair movement wear', 'Spill cleanup', 'Table leg pressure points'],\r\n  };\r\n\r\n  return challenges[roomType] || ['Standard installation challenges'];\r\n}\r\n\r\n/**\r\n * Get best practices for a room type\r\n */\r\nfunction getBestPracticesForRoom(roomType: RoomType): string[] {\r\n  const practices: Record<RoomType, string[]> = {\r\n    living_room: ['Acclimate flooring for 48-72 hours', 'Use furniture pads', 'Leave expansion gaps at walls'],\r\n    bedroom: [\r\n      'Install underlayment for sound reduction',\r\n      'Consider radiant heating compatibility',\r\n      'Plan closet transitions',\r\n    ],\r\n    kitchen: ['Use waterproof flooring options', 'Install moisture barrier', 'Seal edges around appliances'],\r\n    bathroom: ['Always use waterproof products', 'Apply silicone sealant at edges', 'Ensure proper ventilation'],\r\n    basement: ['Test for moisture before installation', 'Use vapor barrier', 'Consider floating floor systems'],\r\n    commercial: [\r\n      'Schedule installation during off-hours',\r\n      'Use commercial-grade adhesives',\r\n      'Plan for heavy equipment',\r\n    ],\r\n    outdoor: ['Ensure proper drainage slope', 'Use weather-resistant fasteners', 'Allow for expansion'],\r\n    hallway: ['Plan layout to minimize waste', 'Install transition strips properly', 'Consider pattern direction'],\r\n    office: ['Use anti-static underlayment', 'Plan for cable access', 'Choose durable commercial products'],\r\n    dining_room: ['Use protective mats under chairs', 'Choose stain-resistant finishes', 'Plan for easy cleaning'],\r\n  };\r\n\r\n  return practices[roomType] || ['Follow manufacturer instructions', 'Acclimate flooring before installation'];\r\n}\r\n\r\n// ============================================\r\n// EXPORTS\r\n// ============================================\r\n\r\nexport const installationScenarioRAG = {\r\n  suggestInstallationSteps,\r\n  getRoomInstallationContext,\r\n  suggestAccessories,\r\n  getInstallationTips,\r\n};\r\n\r\nexport default installationScenarioRAG;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\modelTrainingService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\n8nPostingService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2759,2762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2759,2762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * n8n Posting Service\r\n *\r\n * Handles posting to n8n webhooks for multi-platform social media automation.\r\n * Manages callbacks, error handling, and post status tracking.\r\n *\r\n * Usage:\r\n *   import { postToN8n, handleN8nCallback } from './services/n8nPostingService';\r\n *   const result = await postToN8n('instagram', content, imageUrl, userId, scheduledPostId);\r\n */\r\n\r\nimport { logger } from '../lib/logger';\r\nimport type { FormattedContent } from './contentFormatterService';\r\nimport { updatePostAfterCallback, scheduleRetry } from './schedulingRepository';\r\n\r\n/**\r\n * n8n webhook configuration\r\n */\r\ninterface N8nWebhookConfig {\r\n  baseUrl: string;\r\n  webhooks: Record<string, string>;\r\n}\r\n\r\n/**\r\n * Get n8n webhook configuration from environment\r\n */\r\nfunction getN8nConfig(): N8nWebhookConfig {\r\n  const baseUrl = process.env.N8N_BASE_URL;\r\n\r\n  if (!baseUrl) {\r\n    throw new Error('N8N_BASE_URL not configured. Set this environment variable to use n8n posting.');\r\n  }\r\n\r\n  // Webhook paths for each platform\r\n  const webhooks: Record<string, string> = {\r\n    linkedin: `${baseUrl}/webhook/post/linkedin`,\r\n    'linkedin-company': `${baseUrl}/webhook/post/linkedin-company`,\r\n    instagram: `${baseUrl}/webhook/post/instagram`,\r\n    'instagram-story': `${baseUrl}/webhook/post/instagram-story`,\r\n    'instagram-reel': `${baseUrl}/webhook/post/instagram-reel`,\r\n    facebook: `${baseUrl}/webhook/post/facebook`,\r\n    'facebook-page': `${baseUrl}/webhook/post/facebook-page`,\r\n    twitter: `${baseUrl}/webhook/post/twitter`,\r\n    tiktok: `${baseUrl}/webhook/post/tiktok`,\r\n    youtube: `${baseUrl}/webhook/post/youtube`,\r\n    'youtube-shorts': `${baseUrl}/webhook/post/youtube-shorts`,\r\n    pinterest: `${baseUrl}/webhook/post/pinterest`,\r\n  };\r\n\r\n  return { baseUrl, webhooks };\r\n}\r\n\r\n/**\r\n * n8n post payload\r\n */\r\nexport interface N8nPostPayload {\r\n  platform: string;\r\n  userId: string;\r\n  content: {\r\n    caption: string;\r\n    hashtags: string[];\r\n    imageUrl?: string;\r\n    videoUrl?: string;\r\n  };\r\n  metadata: {\r\n    scheduledPostId: string;\r\n    generationId?: string;\r\n    templateId?: string;\r\n    scheduledFor?: string; // ISO 8601 timestamp\r\n  };\r\n  formatting?: {\r\n    characterCount: number;\r\n    hashtagCount: number;\r\n    truncated: boolean;\r\n    warnings: string[];\r\n  };\r\n  callbackUrl?: string; // URL for n8n to post results back\r\n}\r\n\r\n/**\r\n * n8n callback data (received from n8n after posting)\r\n */\r\nexport interface N8nCallbackData {\r\n  scheduledPostId: string;\r\n  success: boolean;\r\n  platformPostId?: string; // e.g., Instagram post ID\r\n  platformPostUrl?: string; // e.g., https://instagram.com/p/ABC123\r\n  error?: string;\r\n  errorCode?: string;\r\n  postedAt?: string; // ISO 8601 timestamp\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\n/**\r\n * Result from posting to n8n\r\n */\r\nexport interface N8nPostResult {\r\n  success: boolean;\r\n  workflowExecutionId?: string;\r\n  error?: string;\r\n  webhookUrl: string;\r\n}\r\n\r\n/**\r\n * Post content to n8n webhook\r\n *\r\n * @param platform - Platform identifier (e.g., 'instagram', 'linkedin')\r\n * @param content - Formatted content from contentFormatterService\r\n * @param imageUrl - Cloudinary image URL (optional)\r\n * @param userId - User ID for tracking\r\n * @param scheduledPostId - Scheduled post ID for callback matching\r\n * @param options - Additional options\r\n * @returns Post result with workflow execution ID\r\n */\r\nexport async function postToN8n(\r\n  platform: string,\r\n  content: FormattedContent,\r\n  imageUrl: string | undefined,\r\n  userId: string,\r\n  scheduledPostId: string,\r\n  options?: {\r\n    videoUrl?: string;\r\n    generationId?: string;\r\n    templateId?: string;\r\n    scheduledFor?: Date;\r\n    callbackUrl?: string;\r\n  },\r\n): Promise<N8nPostResult> {\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    // Get n8n configuration\r\n    const config = getN8nConfig();\r\n    const webhookUrl = config.webhooks[platform];\r\n\r\n    if (!webhookUrl) {\r\n      throw new Error(`No webhook configured for platform '${platform}'`);\r\n    }\r\n\r\n    // Build payload\r\n    const payload: N8nPostPayload = {\r\n      platform,\r\n      userId,\r\n      content: {\r\n        caption: content.caption,\r\n        hashtags: content.hashtags,\r\n        imageUrl,\r\n        videoUrl: options?.videoUrl,\r\n      },\r\n      metadata: {\r\n        scheduledPostId,\r\n        generationId: options?.generationId,\r\n        templateId: options?.templateId,\r\n        scheduledFor: options?.scheduledFor?.toISOString(),\r\n      },\r\n      formatting: {\r\n        characterCount: content.characterCount,\r\n        hashtagCount: content.hashtagCount,\r\n        truncated: content.truncated,\r\n        warnings: content.warnings,\r\n      },\r\n      callbackUrl: options?.callbackUrl,\r\n    };\r\n\r\n    // Log outgoing request\r\n    logger.info(\r\n      {\r\n        platform,\r\n        userId,\r\n        scheduledPostId,\r\n        webhookUrl,\r\n        hasImage: !!imageUrl,\r\n        hasVideo: !!options?.videoUrl,\r\n      },\r\n      'Posting to n8n webhook',\r\n    );\r\n\r\n    // Send POST request to n8n webhook\r\n    const response = await fetch(webhookUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'User-Agent': 'Automated-Ads-Agent/1.0',\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    // Check response\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      logger.error(\r\n        {\r\n          platform,\r\n          webhookUrl,\r\n          status: response.status,\r\n          statusText: response.statusText,\r\n          error: errorText,\r\n        },\r\n        'n8n webhook request failed',\r\n      );\r\n\r\n      return {\r\n        success: false,\r\n        error: `Webhook returned ${response.status}: ${response.statusText}`,\r\n        webhookUrl,\r\n      };\r\n    }\r\n\r\n    // Parse response (n8n returns execution ID)\r\n    const responseData = await response.json();\r\n    const workflowExecutionId = responseData.executionId || responseData.id;\r\n\r\n    logger.info(\r\n      {\r\n        platform,\r\n        userId,\r\n        scheduledPostId,\r\n        workflowExecutionId,\r\n        duration: Date.now() - startTime,\r\n      },\r\n      'Successfully posted to n8n',\r\n    );\r\n\r\n    return {\r\n      success: true,\r\n      workflowExecutionId,\r\n      webhookUrl,\r\n    };\r\n  } catch (error) {\r\n    logger.error(\r\n      {\r\n        error,\r\n        platform,\r\n        userId,\r\n        scheduledPostId,\r\n        duration: Date.now() - startTime,\r\n      },\r\n      'Failed to post to n8n',\r\n    );\r\n\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Unknown error',\r\n      webhookUrl: config.webhooks[platform] || 'unknown',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Handle callback from n8n after post completion\r\n *\r\n * This endpoint should be called by n8n workflows after posting completes.\r\n * Updates the scheduled post record with platform-specific post ID and URL.\r\n *\r\n * @param data - Callback data from n8n\r\n */\r\n/** Errors that should NOT be retried */\r\nconst NON_RETRYABLE_ERRORS = new Set([\r\n  'content_policy_violation',\r\n  'account_disconnected',\r\n  'invalid_credentials',\r\n  'insufficient_permissions',\r\n]);\r\n\r\nfunction isRetryableError(errorCode?: string): boolean {\r\n  if (!errorCode) return true; // unknown errors are retryable\r\n  return !NON_RETRYABLE_ERRORS.has(errorCode);\r\n}\r\n\r\nexport async function handleN8nCallback(data: N8nCallbackData): Promise<void> {\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    logger.info(\r\n      {\r\n        scheduledPostId: data.scheduledPostId,\r\n        success: data.success,\r\n        platformPostId: data.platformPostId,\r\n        platformPostUrl: data.platformPostUrl,\r\n      },\r\n      'Received n8n callback',\r\n    );\r\n\r\n    // Update the scheduled post in the database\r\n    try {\r\n      const result = await updatePostAfterCallback(data.scheduledPostId, data.success, {\r\n        platformPostId: data.platformPostId,\r\n        platformPostUrl: data.platformPostUrl,\r\n        errorMessage: data.error,\r\n        failureReason: data.errorCode,\r\n      });\r\n\r\n      if (!result || (Array.isArray(result) && result.length === 0)) {\r\n        logger.warn(\r\n          { scheduledPostId: data.scheduledPostId },\r\n          'No scheduled post found with this ID  callback acknowledged but no DB update',\r\n        );\r\n      }\r\n\r\n      // If failed and the error is retryable, schedule a retry\r\n      if (!data.success && isRetryableError(data.errorCode) && Array.isArray(result) && result.length > 0) {\r\n        await scheduleRetry(data.scheduledPostId);\r\n        logger.info(\r\n          { scheduledPostId: data.scheduledPostId, errorCode: data.errorCode },\r\n          'Retry scheduled for failed post',\r\n        );\r\n      }\r\n    } catch (dbError) {\r\n      // DB error (e.g. table doesn't exist yet)  log but don't fail the callback\r\n      logger.warn(\r\n        { scheduledPostId: data.scheduledPostId, err: dbError },\r\n        'DB update failed for callback  acknowledging anyway',\r\n      );\r\n    }\r\n\r\n    logger.info(\r\n      {\r\n        scheduledPostId: data.scheduledPostId,\r\n        duration: Date.now() - startTime,\r\n      },\r\n      'n8n callback processed successfully',\r\n    );\r\n  } catch (error) {\r\n    logger.error(\r\n      {\r\n        error,\r\n        scheduledPostId: data.scheduledPostId,\r\n      },\r\n      'Failed to process n8n callback',\r\n    );\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Post to multiple platforms\r\n *\r\n * @param platforms - Array of platform identifiers\r\n * @param formattedContent - Map of platform to formatted content\r\n * @param platformImages - Map of platform to image URLs\r\n * @param userId - User ID\r\n * @param baseScheduledPostId - Base ID (will append platform suffix)\r\n * @param options - Additional options\r\n * @returns Map of platform to post result\r\n */\r\nexport async function postToMultiplePlatforms(\r\n  platforms: string[],\r\n  formattedContent: Record<string, FormattedContent>,\r\n  platformImages: Record<string, string>,\r\n  userId: string,\r\n  baseScheduledPostId: string,\r\n  options?: {\r\n    videoUrls?: Record<string, string>;\r\n    generationId?: string;\r\n    templateId?: string;\r\n    scheduledFor?: Date;\r\n    callbackUrl?: string;\r\n  },\r\n): Promise<Record<string, N8nPostResult>> {\r\n  const startTime = Date.now();\r\n  const results: Record<string, N8nPostResult> = {};\r\n\r\n  try {\r\n    logger.info(\r\n      {\r\n        platforms,\r\n        userId,\r\n        baseScheduledPostId,\r\n        scheduledFor: options?.scheduledFor,\r\n      },\r\n      'Starting multi-platform post',\r\n    );\r\n\r\n    // Post to all platforms in parallel\r\n    const postPromises = platforms.map(async (platform) => {\r\n      const content = formattedContent[platform];\r\n      const imageUrl = platformImages[platform];\r\n      const videoUrl = options?.videoUrls?.[platform];\r\n\r\n      if (!content) {\r\n        logger.warn({ platform }, 'No formatted content for platform, skipping');\r\n        return {\r\n          platform,\r\n          result: {\r\n            success: false,\r\n            error: 'No formatted content provided',\r\n            webhookUrl: 'N/A',\r\n          },\r\n        };\r\n      }\r\n\r\n      const scheduledPostId = `${baseScheduledPostId}_${platform}`;\r\n\r\n      const result = await postToN8n(platform, content, imageUrl, userId, scheduledPostId, {\r\n        videoUrl,\r\n        generationId: options?.generationId,\r\n        templateId: options?.templateId,\r\n        scheduledFor: options?.scheduledFor,\r\n        callbackUrl: options?.callbackUrl,\r\n      });\r\n\r\n      return { platform, result };\r\n    });\r\n\r\n    const postResults = await Promise.all(postPromises);\r\n\r\n    // Build result object\r\n    postResults.forEach(({ platform, result }) => {\r\n      results[platform] = result;\r\n    });\r\n\r\n    const successCount = Object.values(results).filter((r) => r.success).length;\r\n\r\n    logger.info(\r\n      {\r\n        platforms,\r\n        totalPosts: platforms.length,\r\n        successCount,\r\n        failedCount: platforms.length - successCount,\r\n        duration: Date.now() - startTime,\r\n      },\r\n      'Multi-platform post completed',\r\n    );\r\n\r\n    return results;\r\n  } catch (error) {\r\n    logger.error(\r\n      {\r\n        error,\r\n        platforms,\r\n        userId,\r\n      },\r\n      'Multi-platform post failed',\r\n    );\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Retry failed post\r\n *\r\n * @param platform - Platform identifier\r\n * @param scheduledPostId - Original scheduled post ID\r\n * @param retryCount - Current retry attempt\r\n * @returns Post result\r\n */\r\nexport async function retryFailedPost(\r\n  platform: string,\r\n  scheduledPostId: string,\r\n  retryCount: number,\r\n): Promise<N8nPostResult> {\r\n  const MAX_RETRIES = 3;\r\n\r\n  logger.info(\r\n    {\r\n      platform,\r\n      scheduledPostId,\r\n      retryCount,\r\n    },\r\n    'Retrying failed post',\r\n  );\r\n\r\n  if (retryCount >= MAX_RETRIES) {\r\n    logger.warn({ scheduledPostId, retryCount }, 'Max retries exceeded');\r\n    return { success: false, error: `Max retries (${MAX_RETRIES}) exceeded`, webhookUrl: 'N/A' };\r\n  }\r\n\r\n  // Retry is handled automatically: scheduleRetry() sets the post back to\r\n  // status='scheduled' with a future scheduledFor. The posting job picks it\r\n  // up again when the time arrives. This function exists for manual retries.\r\n  await scheduleRetry(scheduledPostId);\r\n\r\n  return { success: true, webhookUrl: 'retry-scheduled' };\r\n}\r\n\r\n/**\r\n * Get post status from n8n\r\n *\r\n * Queries n8n API to check workflow execution status.\r\n *\r\n * @param workflowExecutionId - n8n workflow execution ID\r\n * @returns Execution status\r\n */\r\nexport async function getPostStatus(workflowExecutionId: string): Promise<{\r\n  status: 'running' | 'success' | 'error' | 'waiting' | 'unknown';\r\n  error?: string;\r\n  finishedAt?: string;\r\n}> {\r\n  const config = getN8nConfig();\r\n  const apiUrl = `${config.baseUrl}/api/v1/executions/${workflowExecutionId}`;\r\n\r\n  try {\r\n    const response = await fetch(apiUrl, {\r\n      method: 'GET',\r\n      headers: {\r\n        Accept: 'application/json',\r\n        // Note: May require API key authentication\r\n        // 'X-N8N-API-KEY': process.env.N8N_API_KEY,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      logger.warn(\r\n        {\r\n          workflowExecutionId,\r\n          status: response.status,\r\n        },\r\n        'Failed to get post status from n8n',\r\n      );\r\n\r\n      return { status: 'unknown' };\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    return {\r\n      status: data.finished ? (data.stoppedAt ? 'error' : 'success') : 'running',\r\n      error: data.error,\r\n      finishedAt: data.stoppedAt || data.finishedAt,\r\n    };\r\n  } catch (error) {\r\n    logger.error({ error, workflowExecutionId }, 'Failed to query n8n API');\r\n    return { status: 'unknown' };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate n8n configuration\r\n *\r\n * @returns Validation result\r\n */\r\nexport function validateN8nConfig(): {\r\n  isValid: boolean;\r\n  errors: string[];\r\n  warnings: string[];\r\n} {\r\n  const errors: string[] = [];\r\n  const warnings: string[] = [];\r\n\r\n  // Check base URL\r\n  if (!process.env.N8N_BASE_URL) {\r\n    errors.push('N8N_BASE_URL environment variable not set');\r\n  } else {\r\n    try {\r\n      const url = new URL(process.env.N8N_BASE_URL);\r\n      if (!url.protocol.startsWith('http')) {\r\n        errors.push('N8N_BASE_URL must be an HTTP(S) URL');\r\n      }\r\n    } catch {\r\n      errors.push('N8N_BASE_URL is not a valid URL');\r\n    }\r\n  }\r\n\r\n  // Check API key (optional, but recommended)\r\n  if (!process.env.N8N_API_KEY) {\r\n    warnings.push('N8N_API_KEY not set. Some features may not work (e.g., status checking)');\r\n  }\r\n\r\n  const isValid = errors.length === 0;\r\n\r\n  return { isValid, errors, warnings };\r\n}\r\n\r\n/**\r\n * Export types\r\n */\r\nexport type { N8nPostPayload, N8nCallbackData, N8nPostResult };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\ndsWebsiteScraper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\notificationService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\patternExtractionService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExtractedPatternData' is defined but never used. Allowed unused vars must match /^_/u.","line":30,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"ExtractedPatternData"},"fix":{"range":[954,984],"text":""},"desc":"Remove unused variable \"ExtractedPatternData\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * PatternExtractionService\r\n *\r\n * Extracts abstract SUCCESS PATTERNS from high-performing ad images.\r\n *\r\n * Key Principle: Extract WHAT makes an ad work, not the ad itself.\r\n *\r\n * Extracts:\r\n * - Layout structure (hero-top, split-50-50, text-overlay)\r\n * - Visual hierarchy (what draws attention first/second/third)\r\n * - Color psychology (mood, scheme, contrast)\r\n * - Hook patterns (question, statistic, pain-point, benefit)\r\n * - Visual elements (photography vs illustration, human presence)\r\n *\r\n * DOES NOT extract:\r\n * - Actual headline text or copy\r\n * - Brand names or company information\r\n * - Specific products or logos\r\n * - Contact information or faces\r\n */\r\n\r\nimport { createHash } from 'crypto';\r\nimport { generateContentWithRetry } from '../lib/geminiClient';\r\nimport { logger } from '../lib/logger';\r\nimport { storage } from '../storage';\r\nimport {\r\n  scanForPrivateContent,\r\n  sanitizeExtractedPattern,\r\n  type PrivacyScanResult,\r\n  type ExtractedPatternData,\r\n} from './patternPrivacyFilter';\r\nimport type { LearnedAdPattern } from '../../shared/schema';\r\n\r\n// Type definitions matching the schema JSONB types\r\ninterface LayoutPattern {\r\n  structure: string;\r\n  visualHierarchy: string[];\r\n  whitespaceUsage: 'minimal' | 'balanced' | 'generous';\r\n  focalPointPosition: string;\r\n}\r\n\r\ninterface ColorPsychology {\r\n  dominantMood: string;\r\n  colorScheme: 'monochromatic' | 'complementary' | 'analogous' | 'triadic';\r\n  contrastLevel: 'low' | 'medium' | 'high';\r\n  emotionalTone: string;\r\n}\r\n\r\ninterface HookPatterns {\r\n  hookType: string;\r\n  headlineFormula: string;\r\n  ctaStyle: 'soft' | 'direct' | 'urgency';\r\n  persuasionTechnique: string;\r\n}\r\n\r\ninterface VisualElements {\r\n  imageStyle: 'photography' | 'illustration' | 'mixed' | '3d-render' | 'abstract';\r\n  humanPresence: boolean;\r\n  productVisibility: 'prominent' | 'subtle' | 'none';\r\n  iconography: boolean;\r\n  backgroundType: 'solid' | 'gradient' | 'image' | 'pattern';\r\n}\r\n\r\n// Model for pattern extraction (use pro for quality)\r\nconst EXTRACTION_MODEL = process.env.GEMINI_EXTRACTION_MODEL || 'gemini-3-pro-preview';\r\n\r\n/**\r\n * Pattern extraction request\r\n */\r\nexport interface PatternExtractionRequest {\r\n  imageBuffer: Buffer;\r\n  mimeType: string;\r\n  userId: string;\r\n  metadata: {\r\n    name: string;\r\n    category: 'product_showcase' | 'testimonial' | 'comparison' | 'educational' | 'promotional' | 'brand_awareness';\r\n    platform: 'linkedin' | 'facebook' | 'instagram' | 'twitter' | 'tiktok' | 'youtube' | 'pinterest' | 'general';\r\n    industry?: string;\r\n    engagementTier?: 'top-1' | 'top-5' | 'top-10' | 'top-25' | 'unverified';\r\n  };\r\n}\r\n\r\n/**\r\n * Pattern extraction result\r\n */\r\nexport interface PatternExtractionResult {\r\n  success: boolean;\r\n  pattern?: LearnedAdPattern;\r\n  uploadId?: string;\r\n  privacyScan?: PrivacyScanResult;\r\n  error?: string;\r\n  isDuplicate?: boolean;\r\n  existingPatternId?: string;\r\n}\r\n\r\n/**\r\n * Raw extracted pattern from Gemini\r\n */\r\ninterface RawExtractedPattern {\r\n  layoutPattern: LayoutPattern;\r\n  colorPsychology: ColorPsychology;\r\n  hookPatterns: HookPatterns;\r\n  visualElements: VisualElements;\r\n  confidenceScore: number;\r\n}\r\n\r\n/**\r\n * Generate SHA-256 hash of image for deduplication\r\n */\r\nfunction generateImageHash(imageBuffer: Buffer): string {\r\n  return createHash('sha256').update(imageBuffer).digest('hex');\r\n}\r\n\r\n/**\r\n * Privacy-focused extraction prompt\r\n *\r\n * CRITICAL: This prompt explicitly instructs the model to NOT extract\r\n * any actual text, brand names, or identifying information.\r\n */\r\nconst EXTRACTION_PROMPT = `Analyze this advertisement image and extract ABSTRACT PATTERNS only.\r\n\r\nCRITICAL INSTRUCTIONS - READ CAREFULLY:\r\n1. DO NOT extract or describe any actual text, headlines, or copy\r\n2. DO NOT mention any brand names, company names, or product names\r\n3. DO NOT describe specific products, logos, or trademarks\r\n4. DO NOT include contact information, URLs, or specific numbers/statistics\r\n5. DO NOT describe faces or identifiable people\r\n\r\nONLY extract structural and psychological PATTERNS:\r\n\r\nReturn a JSON object with these exact fields:\r\n\r\n{\r\n  \"layoutPattern\": {\r\n    \"structure\": \"<layout type: hero-top, hero-left, hero-right, split-50-50, text-overlay, grid, full-bleed, minimal-centered>\",\r\n    \"visualHierarchy\": [\"<first attention element>\", \"<second attention element>\", \"<third attention element>\"],\r\n    \"whitespaceUsage\": \"<one of: minimal, balanced, generous>\",\r\n    \"focalPointPosition\": \"<position: center, upper-third, lower-third, left-third, right-third, golden-ratio>\"\r\n  },\r\n  \"colorPsychology\": {\r\n    \"dominantMood\": \"<emotional tone: trust, excitement, calm, urgency, luxury, friendly, professional>\",\r\n    \"colorScheme\": \"<one of: monochromatic, complementary, analogous, triadic>\",\r\n    \"contrastLevel\": \"<one of: low, medium, high>\",\r\n    \"emotionalTone\": \"<feeling: energetic, serene, bold, subtle, warm, cool>\"\r\n  },\r\n  \"hookPatterns\": {\r\n    \"hookType\": \"<opening strategy: question, statistic, pain-point, benefit, curiosity, fear, aspiration, social-proof>\",\r\n    \"headlineFormula\": \"<structure: how-to, number-list, problem-solution, before-after, testimonial-style, command, comparison>\",\r\n    \"ctaStyle\": \"<one of: soft, direct, urgency>\",\r\n    \"persuasionTechnique\": \"<primary technique: scarcity, authority, social-proof, reciprocity, commitment, liking>\"\r\n  },\r\n  \"visualElements\": {\r\n    \"imageStyle\": \"<one of: photography, illustration, mixed, 3d-render, abstract>\",\r\n    \"humanPresence\": <boolean - true if humans are visible, false otherwise>,\r\n    \"productVisibility\": \"<one of: prominent, subtle, none>\",\r\n    \"iconography\": <boolean - true if icons are used, false otherwise>,\r\n    \"backgroundType\": \"<one of: solid, gradient, image, pattern>\"\r\n  },\r\n  \"confidenceScore\": <number 0.0-1.0 indicating confidence in this analysis>\r\n}\r\n\r\nReturn ONLY generic pattern descriptors. Do not include any specific content from the ad.`;\r\n\r\n/**\r\n * Extract abstract patterns from an ad image\r\n *\r\n * Flow:\r\n * 1. Generate image hash for deduplication\r\n * 2. Check for existing pattern with same hash\r\n * 3. Run privacy scan\r\n * 4. If safe, extract patterns using Gemini Vision\r\n * 5. Sanitize extracted patterns\r\n * 6. Store in database\r\n */\r\nexport async function extractPatterns(\r\n  request: PatternExtractionRequest\r\n): Promise<PatternExtractionResult> {\r\n  const { imageBuffer, mimeType, userId, metadata } = request;\r\n\r\n  try {\r\n    // Step 1: Generate image hash for deduplication\r\n    const sourceHash = generateImageHash(imageBuffer);\r\n\r\n    // Step 2: Check for existing pattern with same hash\r\n    const existingPattern = await storage.getLearnedPatternByHash(userId, sourceHash);\r\n    if (existingPattern) {\r\n      logger.info({ patternId: existingPattern.id, userId }, 'Duplicate pattern detected');\r\n      return {\r\n        success: true,\r\n        pattern: existingPattern,\r\n        isDuplicate: true,\r\n        existingPatternId: existingPattern.id,\r\n      };\r\n    }\r\n\r\n    // Step 3: Run privacy scan\r\n    const privacyScan = await scanForPrivateContent(imageBuffer, mimeType);\r\n\r\n    if (!privacyScan.isSafeToProcess) {\r\n      logger.warn({\r\n        userId,\r\n        reason: privacyScan.rejectionReason,\r\n        hasFaces: privacyScan.hasFaces,\r\n        detectedBrands: privacyScan.detectedBrands,\r\n      }, 'Image rejected by privacy scan');\r\n\r\n      return {\r\n        success: false,\r\n        privacyScan,\r\n        error: privacyScan.rejectionReason,\r\n      };\r\n    }\r\n\r\n    // Step 4: Extract patterns using Gemini Vision\r\n    const base64Image = imageBuffer.toString('base64');\r\n\r\n    const response = await generateContentWithRetry({\r\n      model: EXTRACTION_MODEL,\r\n      contents: [\r\n        {\r\n          role: 'user',\r\n          parts: [\r\n            { text: EXTRACTION_PROMPT },\r\n            {\r\n              inlineData: {\r\n                mimeType,\r\n                data: base64Image,\r\n              },\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n      config: {\r\n        temperature: 0.2, // Low temperature for consistent pattern extraction\r\n      },\r\n    }, { operation: 'pattern_extraction' });\r\n\r\n    const responseText = response.text || '';\r\n\r\n    // Parse JSON response\r\n    const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\r\n    if (!jsonMatch) {\r\n      logger.error({ responseText: responseText.substring(0, 500) }, 'Failed to parse pattern extraction response');\r\n      return {\r\n        success: false,\r\n        privacyScan,\r\n        error: 'Failed to extract patterns from image',\r\n      };\r\n    }\r\n\r\n    const rawPattern: RawExtractedPattern = JSON.parse(jsonMatch[0]);\r\n\r\n    // Step 5: Sanitize extracted patterns (second-pass safety)\r\n    const sanitizedPattern = sanitizeExtractedPattern({\r\n      layoutPattern: rawPattern.layoutPattern,\r\n      colorPsychology: rawPattern.colorPsychology,\r\n      hookPatterns: rawPattern.hookPatterns,\r\n      visualElements: rawPattern.visualElements,\r\n    });\r\n\r\n    // Step 6: Store in database\r\n    const pattern = await storage.createLearnedPattern({\r\n      userId,\r\n      name: metadata.name,\r\n      category: metadata.category,\r\n      platform: metadata.platform,\r\n      industry: metadata.industry,\r\n      layoutPattern: sanitizedPattern.layoutPattern as LayoutPattern,\r\n      colorPsychology: sanitizedPattern.colorPsychology as ColorPsychology,\r\n      hookPatterns: sanitizedPattern.hookPatterns as HookPatterns,\r\n      visualElements: sanitizedPattern.visualElements as VisualElements,\r\n      engagementTier: metadata.engagementTier,\r\n      confidenceScore: rawPattern.confidenceScore || 0.8,\r\n      sourceHash,\r\n    });\r\n\r\n    logger.info({\r\n      patternId: pattern.id,\r\n      userId,\r\n      category: metadata.category,\r\n      platform: metadata.platform,\r\n      confidenceScore: rawPattern.confidenceScore,\r\n    }, 'Pattern extracted successfully');\r\n\r\n    return {\r\n      success: true,\r\n      pattern,\r\n      privacyScan,\r\n    };\r\n\r\n  } catch (error) {\r\n    logger.error({ err: error, userId }, 'Pattern extraction failed');\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Pattern extraction failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Process an upload record end-to-end\r\n *\r\n * This is the main entry point for the upload processing pipeline.\r\n * It handles the full flow from upload to pattern storage.\r\n */\r\nexport async function processUploadForPatterns(\r\n  uploadId: string,\r\n  imageBuffer: Buffer,\r\n  mimeType: string,\r\n  metadata: PatternExtractionRequest['metadata']\r\n): Promise<PatternExtractionResult> {\r\n  // Get upload record\r\n  const upload = await storage.getUploadById(uploadId);\r\n  if (!upload) {\r\n    return {\r\n      success: false,\r\n      error: 'Upload record not found',\r\n    };\r\n  }\r\n\r\n  // Update status to processing\r\n  await storage.updateUploadStatus(uploadId, 'processing');\r\n\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    // Extract patterns\r\n    const result = await extractPatterns({\r\n      imageBuffer,\r\n      mimeType,\r\n      userId: upload.userId,\r\n      metadata,\r\n    });\r\n\r\n    const processingDurationMs = Date.now() - startTime;\r\n\r\n    if (result.success && result.pattern) {\r\n      // Update upload with extracted pattern\r\n      await storage.updateUploadWithPattern(\r\n        uploadId,\r\n        result.pattern.id,\r\n        processingDurationMs\r\n      );\r\n    } else {\r\n      // Update upload as failed\r\n      await storage.updateUploadStatus(\r\n        uploadId,\r\n        'failed',\r\n        result.error\r\n      );\r\n    }\r\n\r\n    return result;\r\n\r\n  } catch (error) {\r\n    await storage.updateUploadStatus(\r\n      uploadId,\r\n      'failed',\r\n      error instanceof Error ? error.message : 'Processing failed'\r\n    );\r\n\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Processing failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get patterns relevant to a specific generation context\r\n *\r\n * Used by IdeaBankService to fetch patterns for ad generation.\r\n */\r\nexport async function getRelevantPatterns(params: {\r\n  userId: string;\r\n  category?: string;\r\n  platform?: string;\r\n  industry?: string;\r\n  maxPatterns?: number;\r\n}): Promise<LearnedAdPattern[]> {\r\n  const { userId, category, platform, industry, maxPatterns = 5 } = params;\r\n\r\n  // Fetch user's active patterns\r\n  const allPatterns = await storage.getLearnedPatterns(userId, { isActive: true });\r\n\r\n  if (allPatterns.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  // Score patterns based on relevance\r\n  const scoredPatterns = allPatterns.map(pattern => {\r\n    let score = 0;\r\n\r\n    // Category match (highest weight)\r\n    if (category && pattern.category === category) {\r\n      score += 25;\r\n    }\r\n\r\n    // Industry match\r\n    if (industry && pattern.industry === industry) {\r\n      score += 20;\r\n    }\r\n\r\n    // Platform match\r\n    if (platform && pattern.platform === platform) {\r\n      score += 15;\r\n    } else if (pattern.platform === 'general') {\r\n      score += 5; // General patterns are always somewhat relevant\r\n    }\r\n\r\n    // Engagement tier bonus\r\n    const tierScores: Record<string, number> = {\r\n      'top-1': 15,\r\n      'top-5': 12,\r\n      'top-10': 8,\r\n      'top-25': 4,\r\n      'unverified': 0,\r\n    };\r\n    score += tierScores[pattern.engagementTier || 'unverified'] || 0;\r\n\r\n    // Recency bonus (patterns used recently are more likely relevant)\r\n    if (pattern.lastUsedAt) {\r\n      const daysSinceUse = (Date.now() - new Date(pattern.lastUsedAt).getTime()) / (1000 * 60 * 60 * 24);\r\n      if (daysSinceUse < 7) score += 10;\r\n      else if (daysSinceUse < 30) score += 5;\r\n    }\r\n\r\n    // Usage count bonus (popular patterns)\r\n    if (pattern.usageCount > 10) score += 5;\r\n    else if (pattern.usageCount > 5) score += 3;\r\n    else if (pattern.usageCount > 0) score += 1;\r\n\r\n    return { pattern, score };\r\n  });\r\n\r\n  // Sort by score and take top N\r\n  return scoredPatterns\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, maxPatterns)\r\n    .map(sp => sp.pattern);\r\n}\r\n\r\n/**\r\n * Format patterns for inclusion in LLM generation prompt\r\n */\r\nexport function formatPatternsForPrompt(patterns: LearnedAdPattern[]): string {\r\n  if (patterns.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const formattedPatterns = patterns.map((pattern, index) => {\r\n    const parts: string[] = [`Pattern ${index + 1}: \"${pattern.name}\"`];\r\n\r\n    if (pattern.layoutPattern) {\r\n      const lp = pattern.layoutPattern;\r\n      const hierarchy = lp.visualHierarchy?.join(' -> ') || 'balanced';\r\n      parts.push(`  Layout: ${lp.structure || 'flexible'} structure, ${hierarchy} flow, ${lp.whitespaceUsage || 'balanced'} whitespace`);\r\n    }\r\n\r\n    if (pattern.colorPsychology) {\r\n      const cp = pattern.colorPsychology;\r\n      parts.push(`  Color Mood: ${cp.dominantMood || 'neutral'}, ${cp.colorScheme || 'balanced'} scheme, ${cp.contrastLevel || 'medium'} contrast`);\r\n    }\r\n\r\n    if (pattern.hookPatterns) {\r\n      const hp = pattern.hookPatterns;\r\n      parts.push(`  Hook: ${hp.hookType || 'benefit'} opening, ${hp.headlineFormula || 'direct'} headline, ${hp.ctaStyle || 'direct'} CTA`);\r\n    }\r\n\r\n    if (pattern.visualElements) {\r\n      const ve = pattern.visualElements;\r\n      const humanText = ve.humanPresence ? 'with people' : 'no people';\r\n      parts.push(`  Visuals: ${ve.imageStyle || 'photography'} style, ${ve.productVisibility || 'prominent'} product focus, ${humanText}`);\r\n    }\r\n\r\n    if (pattern.engagementTier && pattern.engagementTier !== 'unverified') {\r\n      parts.push(`  Performance: ${pattern.engagementTier.replace('-', ' ')} percentile`);\r\n    }\r\n\r\n    return parts.join('\\n');\r\n  });\r\n\r\n  return `\r\nLEARNED SUCCESS PATTERNS FROM HIGH-PERFORMING ADS:\r\nUse these proven patterns as inspiration for the ad design.\r\n\r\n${formattedPatterns.join('\\n\\n')}\r\n\r\nApply these patterns to create an effective ad while keeping the content original.\r\n`;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\patternPrivacyFilter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\platformSpecsService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\pricingEstimator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\productEnrichmentService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\productIntelligenceService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\productKnowledgeService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\pushNotificationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[697,700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[697,700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[837,840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[837,840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3690,3693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3690,3693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Push Notification Service  Web Push API Integration\r\n *\r\n * Sends push notifications to subscribed users via VAPID-authenticated Web Push.\r\n * Requires VAPID_PUBLIC_KEY, VAPID_PRIVATE_KEY, and VAPID_EMAIL env vars.\r\n */\r\n\r\nimport { db } from '../db';\r\nimport { pushSubscriptions } from '../../shared/schema';\r\nimport { eq, and } from 'drizzle-orm';\r\nimport { logger } from '../lib/logger';\r\n\r\ninterface PushKeys {\r\n  p256dh: string;\r\n  auth: string;\r\n}\r\n\r\ninterface SubscriptionData {\r\n  endpoint: string;\r\n  keys: PushKeys;\r\n}\r\n\r\ninterface NotificationPayload {\r\n  title: string;\r\n  body: string;\r\n  icon?: string;\r\n  badge?: string;\r\n  url?: string;\r\n  tag?: string;\r\n}\r\n\r\nlet webpush: any = null;\r\nlet vapidConfigured = false;\r\n\r\n/**\r\n * Lazily initialize web-push with VAPID keys.\r\n */\r\nasync function getWebPush(): Promise<any> {\r\n  if (vapidConfigured) return webpush;\r\n  vapidConfigured = true;\r\n\r\n  const publicKey = process.env.VAPID_PUBLIC_KEY;\r\n  const privateKey = process.env.VAPID_PRIVATE_KEY;\r\n  const email = process.env.VAPID_EMAIL;\r\n\r\n  if (!publicKey || !privateKey || !email) {\r\n    logger.debug({ module: 'Push' }, 'Web Push disabled (VAPID keys not set)');\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    webpush = await import('web-push');\r\n    webpush.setVapidDetails(`mailto:${email}`, publicKey, privateKey);\r\n    logger.info({ module: 'Push' }, 'Web Push initialized with VAPID keys');\r\n    return webpush;\r\n  } catch {\r\n    logger.debug({ module: 'Push' }, 'web-push not installed  push notifications disabled');\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Subscribe a user to push notifications.\r\n */\r\nexport async function subscribe(userId: string, subscription: SubscriptionData): Promise<void> {\r\n  // Upsert: deactivate old subscription for same endpoint, insert new one\r\n  await db\r\n    .update(pushSubscriptions)\r\n    .set({ isActive: false })\r\n    .where(and(eq(pushSubscriptions.userId, userId), eq(pushSubscriptions.endpoint, subscription.endpoint)));\r\n\r\n  await db.insert(pushSubscriptions).values({\r\n    userId,\r\n    endpoint: subscription.endpoint,\r\n    keys: subscription.keys,\r\n    isActive: true,\r\n  });\r\n\r\n  logger.info({ userId }, 'Push subscription created');\r\n}\r\n\r\n/**\r\n * Unsubscribe a user from push notifications.\r\n */\r\nexport async function unsubscribe(userId: string, endpoint: string): Promise<void> {\r\n  await db\r\n    .update(pushSubscriptions)\r\n    .set({ isActive: false })\r\n    .where(and(eq(pushSubscriptions.userId, userId), eq(pushSubscriptions.endpoint, endpoint)));\r\n\r\n  logger.info({ userId }, 'Push subscription deactivated');\r\n}\r\n\r\n/**\r\n * Send a push notification to a specific user (all active subscriptions).\r\n */\r\nexport async function sendNotification(\r\n  userId: string,\r\n  payload: NotificationPayload,\r\n): Promise<{ sent: number; failed: number }> {\r\n  const wp = await getWebPush();\r\n  if (!wp) return { sent: 0, failed: 0 };\r\n\r\n  const subscriptions = await db\r\n    .select()\r\n    .from(pushSubscriptions)\r\n    .where(and(eq(pushSubscriptions.userId, userId), eq(pushSubscriptions.isActive, true)));\r\n\r\n  let sent = 0;\r\n  let failed = 0;\r\n\r\n  for (const sub of subscriptions) {\r\n    try {\r\n      const keys = sub.keys as PushKeys;\r\n      await wp.sendNotification(\r\n        {\r\n          endpoint: sub.endpoint,\r\n          keys: { p256dh: keys.p256dh, auth: keys.auth },\r\n        },\r\n        JSON.stringify({\r\n          title: payload.title,\r\n          body: payload.body,\r\n          icon: payload.icon || '/icons/icon-192.svg',\r\n          badge: payload.badge || '/icons/icon-192.svg',\r\n          data: { url: payload.url || '/' },\r\n          tag: payload.tag,\r\n        }),\r\n      );\r\n      sent++;\r\n    } catch (error: any) {\r\n      failed++;\r\n      // If subscription expired (410 Gone), deactivate it\r\n      if (error?.statusCode === 410) {\r\n        await db.update(pushSubscriptions).set({ isActive: false }).where(eq(pushSubscriptions.id, sub.id));\r\n        logger.info({ subId: sub.id }, 'Expired push subscription deactivated');\r\n      } else {\r\n        logger.error({ err: error, subId: sub.id }, 'Failed to send push notification');\r\n      }\r\n    }\r\n  }\r\n\r\n  return { sent, failed };\r\n}\r\n\r\n/**\r\n * Get the VAPID public key for client-side subscription.\r\n */\r\nexport function getVapidPublicKey(): string | null {\r\n  return process.env.VAPID_PUBLIC_KEY ?? null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\quotaMonitoringService.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'durationMs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":116,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Quota Monitoring Service\r\n * Tracks Gemini API usage, provides real-time quota status, and manages alerts\r\n */\r\n\r\nimport { storage } from \"../storage\";\r\nimport type { InsertGeminiQuotaMetrics, InsertGeminiRateLimitEvent, GeminiQuotaAlert } from \"@shared/schema\";\r\nimport { createQuotaMetricsMap } from \"../utils/memoryManager\";\r\n\r\n// Gemini Free Tier Limits (December 2025)\r\nexport const GEMINI_FREE_TIER_LIMITS = {\r\n  rpm: 15,          // Requests per minute\r\n  rpd: 50,          // Requests per day (for image generation)\r\n  tpm: 1_000_000,   // Tokens per minute\r\n  tpd: 1_000_000,   // Tokens per day\r\n};\r\n\r\nexport interface QuotaStatus {\r\n  rpm: { current: number; limit: number; percentage: number; resetAt: Date };\r\n  rpd: { current: number; limit: number; percentage: number; resetAt: Date };\r\n  tokens: { current: number; limit: number; percentage: number; resetAt: Date };\r\n  cost: { today: number; thisMonth: number; estimatedMonthly: number };\r\n  status: 'healthy' | 'warning' | 'critical' | 'rate_limited';\r\n  warnings: string[];\r\n  retryAfter?: number;\r\n}\r\n\r\nexport interface UsageBreakdown {\r\n  byOperation: { generate: number; edit: number; analyze: number };\r\n  byModel: Record<string, number>;\r\n  totalRequests: number;\r\n  totalTokens: number;\r\n  totalCost: number;\r\n}\r\n\r\nexport interface TrackApiCallParams {\r\n  brandId: string;\r\n  operation: 'generate' | 'edit' | 'analyze';\r\n  model: string;\r\n  success: boolean;\r\n  durationMs: number;\r\n  inputTokens?: number;\r\n  outputTokens?: number;\r\n  costMicros: number;\r\n  errorType?: string;\r\n  isRateLimited?: boolean;\r\n}\r\n\r\n// In-memory tracking for minute-level metrics (faster than DB queries)\r\n// Now bounded with automatic cleanup of expired entries (max 5000 brands)\r\nconst inMemoryMetrics = createQuotaMetricsMap<{\r\n  requestsThisMinute: number;\r\n  tokensThisMinute: number;\r\n  windowStart: number;\r\n}>('QuotaMetrics', 5000);\r\n\r\n/**\r\n * Get the start of the current minute window\r\n */\r\nfunction getMinuteWindowStart(): Date {\r\n  const now = new Date();\r\n  now.setSeconds(0, 0);\r\n  return now;\r\n}\r\n\r\n/**\r\n * Get the start of the current hour window\r\n */\r\nfunction getHourWindowStart(): Date {\r\n  const now = new Date();\r\n  now.setMinutes(0, 0, 0);\r\n  return now;\r\n}\r\n\r\n/**\r\n * Get the start of the current day window (UTC)\r\n */\r\nfunction getDayWindowStart(): Date {\r\n  const now = new Date();\r\n  now.setUTCHours(0, 0, 0, 0);\r\n  return now;\r\n}\r\n\r\n/**\r\n * Get or create in-memory metrics for a brand\r\n */\r\nfunction getInMemoryMetrics(brandId: string): { requestsThisMinute: number; tokensThisMinute: number; windowStart: number } {\r\n  const now = Date.now();\r\n  const currentMinute = Math.floor(now / 60000) * 60000;\r\n\r\n  let metrics = inMemoryMetrics.get(brandId);\r\n\r\n  // Reset if we're in a new minute\r\n  if (!metrics || metrics.windowStart !== currentMinute) {\r\n    metrics = {\r\n      requestsThisMinute: 0,\r\n      tokensThisMinute: 0,\r\n      windowStart: currentMinute,\r\n    };\r\n    inMemoryMetrics.set(brandId, metrics);\r\n  }\r\n\r\n  return metrics;\r\n}\r\n\r\nexport const quotaMonitoringService = {\r\n  /**\r\n   * Track an API call - called after every Gemini API request\r\n   */\r\n  async trackApiCall(params: TrackApiCallParams): Promise<void> {\r\n    const {\r\n      brandId,\r\n      operation,\r\n      model,\r\n      success,\r\n      durationMs,\r\n      inputTokens = 0,\r\n      outputTokens = 0,\r\n      costMicros,\r\n      isRateLimited = false,\r\n    } = params;\r\n\r\n    // Update in-memory metrics for instant quota checks\r\n    const memMetrics = getInMemoryMetrics(brandId);\r\n    memMetrics.requestsThisMinute++;\r\n    memMetrics.tokensThisMinute += inputTokens + outputTokens;\r\n\r\n    // Persist to database for minute window\r\n    const minuteStart = getMinuteWindowStart();\r\n    const minuteEnd = new Date(minuteStart.getTime() + 60000);\r\n\r\n    const metricsInsert: InsertGeminiQuotaMetrics = {\r\n      windowType: 'minute',\r\n      windowStart: minuteStart,\r\n      windowEnd: minuteEnd,\r\n      brandId,\r\n      requestCount: 1,\r\n      successCount: success ? 1 : 0,\r\n      errorCount: success ? 0 : 1,\r\n      rateLimitCount: isRateLimited ? 1 : 0,\r\n      inputTokensTotal: inputTokens,\r\n      outputTokensTotal: outputTokens,\r\n      estimatedCostMicros: costMicros,\r\n      generateCount: operation === 'generate' ? 1 : 0,\r\n      editCount: operation === 'edit' ? 1 : 0,\r\n      analyzeCount: operation === 'analyze' ? 1 : 0,\r\n      modelBreakdown: { [model]: 1 },\r\n    };\r\n\r\n    await storage.upsertQuotaMetrics(metricsInsert);\r\n\r\n    // Also update hourly and daily aggregates\r\n    const hourStart = getHourWindowStart();\r\n    const hourEnd = new Date(hourStart.getTime() + 3600000);\r\n    await storage.upsertQuotaMetrics({\r\n      ...metricsInsert,\r\n      windowType: 'hour',\r\n      windowStart: hourStart,\r\n      windowEnd: hourEnd,\r\n    });\r\n\r\n    const dayStart = getDayWindowStart();\r\n    const dayEnd = new Date(dayStart.getTime() + 86400000);\r\n    await storage.upsertQuotaMetrics({\r\n      ...metricsInsert,\r\n      windowType: 'day',\r\n      windowStart: dayStart,\r\n      windowEnd: dayEnd,\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Log a rate limit event\r\n   */\r\n  async logRateLimitEvent(params: {\r\n    brandId: string;\r\n    operation: string;\r\n    model: string;\r\n    limitType: 'rpm' | 'rpd' | 'tpm' | 'tpd';\r\n    retryAfterSeconds?: number;\r\n    endpoint?: string;\r\n    requestMetadata?: Record<string, unknown>;\r\n  }): Promise<void> {\r\n    const event: InsertGeminiRateLimitEvent = {\r\n      brandId: params.brandId,\r\n      operation: params.operation,\r\n      model: params.model,\r\n      limitType: params.limitType,\r\n      retryAfterSeconds: params.retryAfterSeconds,\r\n      endpoint: params.endpoint,\r\n      requestMetadata: params.requestMetadata,\r\n    };\r\n\r\n    await storage.createRateLimitEvent(event);\r\n\r\n    // Also track in the metrics\r\n    await this.trackApiCall({\r\n      brandId: params.brandId,\r\n      operation: params.operation as 'generate' | 'edit' | 'analyze',\r\n      model: params.model,\r\n      success: false,\r\n      durationMs: 0,\r\n      costMicros: 0,\r\n      isRateLimited: true,\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Get current quota status for a brand\r\n   */\r\n  async getQuotaStatus(brandId: string): Promise<QuotaStatus> {\r\n    const now = new Date();\r\n    const warnings: string[] = [];\r\n\r\n    // Get in-memory metrics for instant RPM check\r\n    const memMetrics = getInMemoryMetrics(brandId);\r\n\r\n    // Get today's metrics from DB\r\n    const dayStart = getDayWindowStart();\r\n    const dayEnd = new Date(dayStart.getTime() + 86400000);\r\n    const todayMetrics = await storage.getQuotaMetrics({\r\n      brandId,\r\n      windowType: 'day',\r\n      startDate: dayStart,\r\n      endDate: dayEnd,\r\n    });\r\n\r\n    const todayAggregate = todayMetrics[0] || {\r\n      requestCount: 0,\r\n      inputTokensTotal: 0,\r\n      outputTokensTotal: 0,\r\n      estimatedCostMicros: 0,\r\n    };\r\n\r\n    // Get this month's metrics\r\n    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\r\n    const monthMetrics = await storage.getQuotaMetrics({\r\n      brandId,\r\n      windowType: 'day',\r\n      startDate: monthStart,\r\n      endDate: monthEnd,\r\n    });\r\n\r\n    const monthAggregate = monthMetrics.reduce((acc, m) => ({\r\n      requestCount: acc.requestCount + m.requestCount,\r\n      estimatedCostMicros: acc.estimatedCostMicros + m.estimatedCostMicros,\r\n    }), { requestCount: 0, estimatedCostMicros: 0 });\r\n\r\n    // Check for recent rate limit events\r\n    const recentRateLimits = await storage.getRecentRateLimitEvents(brandId, 5);\r\n    const isRateLimited = recentRateLimits.length > 0 &&\r\n      recentRateLimits[0].retryAfterSeconds &&\r\n      (new Date(recentRateLimits[0].createdAt).getTime() + recentRateLimits[0].retryAfterSeconds * 1000) > Date.now();\r\n\r\n    const retryAfter = isRateLimited && recentRateLimits[0].retryAfterSeconds\r\n      ? Math.max(0, Math.ceil((new Date(recentRateLimits[0].createdAt).getTime() + recentRateLimits[0].retryAfterSeconds * 1000 - Date.now()) / 1000))\r\n      : undefined;\r\n\r\n    // Calculate percentages\r\n    const rpmPercentage = (memMetrics.requestsThisMinute / GEMINI_FREE_TIER_LIMITS.rpm) * 100;\r\n    const rpdPercentage = (todayAggregate.requestCount / GEMINI_FREE_TIER_LIMITS.rpd) * 100;\r\n    const tokensPercentage = ((todayAggregate.inputTokensTotal + todayAggregate.outputTokensTotal) / GEMINI_FREE_TIER_LIMITS.tpd) * 100;\r\n\r\n    // Calculate reset times\r\n    const minuteReset = new Date(Math.ceil(Date.now() / 60000) * 60000);\r\n    const dayReset = new Date(dayStart.getTime() + 86400000);\r\n\r\n    // Generate warnings with issue + solution\r\n    if (rpmPercentage >= 100) {\r\n      warnings.push(` RATE LIMITED: Minute limit exceeded (${Math.round(rpmPercentage)}%) | Solution: Wait ${60 - new Date().getSeconds()}s for reset, or upgrade to paid tier at https://aistudio.google.com`);\r\n    } else if (rpmPercentage >= 80) {\r\n      warnings.push(` Approaching minute rate limit (${Math.round(rpmPercentage)}%) | Solution: Slow down requests or wait for reset in ${60 - new Date().getSeconds()}s`);\r\n    }\r\n\r\n    if (rpdPercentage >= 100) {\r\n      warnings.push(` DAILY LIMIT EXCEEDED: ${todayAggregate.requestCount}/${GEMINI_FREE_TIER_LIMITS.rpd} requests | Solution: Wait until midnight UTC for reset, or upgrade to paid tier`);\r\n    } else if (rpdPercentage >= 80) {\r\n      warnings.push(` Approaching daily request limit (${Math.round(rpdPercentage)}%) | Solution: ${GEMINI_FREE_TIER_LIMITS.rpd - todayAggregate.requestCount} requests remaining today. Resets at midnight UTC`);\r\n    }\r\n\r\n    if (tokensPercentage >= 100) {\r\n      warnings.push(` TOKEN LIMIT EXCEEDED | Solution: Wait until midnight UTC for reset, or upgrade to paid tier`);\r\n    } else if (tokensPercentage >= 80) {\r\n      warnings.push(` Approaching daily token limit (${Math.round(tokensPercentage)}%) | Solution: Reduce prompt sizes or wait until midnight UTC`);\r\n    }\r\n\r\n    // Determine overall status\r\n    let status: QuotaStatus['status'] = 'healthy';\r\n    if (isRateLimited) {\r\n      status = 'rate_limited';\r\n    } else if (rpmPercentage >= 90 || rpdPercentage >= 90 || tokensPercentage >= 90) {\r\n      status = 'critical';\r\n    } else if (rpmPercentage >= 60 || rpdPercentage >= 60 || tokensPercentage >= 60) {\r\n      status = 'warning';\r\n    }\r\n\r\n    // Calculate cost estimates\r\n    const todayCost = todayAggregate.estimatedCostMicros / 1_000_000;\r\n    const monthCost = monthAggregate.estimatedCostMicros / 1_000_000;\r\n    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();\r\n    const dayOfMonth = now.getDate();\r\n    const estimatedMonthly = dayOfMonth > 0 ? (monthCost / dayOfMonth) * daysInMonth : 0;\r\n\r\n    return {\r\n      rpm: {\r\n        current: memMetrics.requestsThisMinute,\r\n        limit: GEMINI_FREE_TIER_LIMITS.rpm,\r\n        percentage: rpmPercentage,\r\n        resetAt: minuteReset,\r\n      },\r\n      rpd: {\r\n        current: todayAggregate.requestCount,\r\n        limit: GEMINI_FREE_TIER_LIMITS.rpd,\r\n        percentage: rpdPercentage,\r\n        resetAt: dayReset,\r\n      },\r\n      tokens: {\r\n        current: todayAggregate.inputTokensTotal + todayAggregate.outputTokensTotal,\r\n        limit: GEMINI_FREE_TIER_LIMITS.tpd,\r\n        percentage: tokensPercentage,\r\n        resetAt: dayReset,\r\n      },\r\n      cost: {\r\n        today: todayCost,\r\n        thisMonth: monthCost,\r\n        estimatedMonthly,\r\n      },\r\n      status,\r\n      warnings,\r\n      retryAfter,\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Get usage history for charts\r\n   */\r\n  async getUsageHistory(params: {\r\n    brandId: string;\r\n    windowType: 'minute' | 'hour' | 'day';\r\n    startDate: Date;\r\n    endDate: Date;\r\n  }): Promise<Array<{\r\n    timestamp: string;\r\n    requests: number;\r\n    tokens: number;\r\n    cost: number;\r\n    successRate: number;\r\n  }>> {\r\n    const metrics = await storage.getQuotaMetrics(params);\r\n\r\n    return metrics.map(m => ({\r\n      timestamp: m.windowStart.toISOString(),\r\n      requests: m.requestCount,\r\n      tokens: m.inputTokensTotal + m.outputTokensTotal,\r\n      cost: m.estimatedCostMicros / 1_000_000,\r\n      successRate: m.requestCount > 0 ? (m.successCount / m.requestCount) * 100 : 100,\r\n    }));\r\n  },\r\n\r\n  /**\r\n   * Get usage breakdown for the dashboard\r\n   */\r\n  async getUsageBreakdown(params: {\r\n    brandId: string;\r\n    period: 'today' | 'week' | 'month';\r\n  }): Promise<UsageBreakdown> {\r\n    const now = new Date();\r\n    let startDate: Date;\r\n\r\n    switch (params.period) {\r\n      case 'today':\r\n        startDate = getDayWindowStart();\r\n        break;\r\n      case 'week':\r\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n        break;\r\n      case 'month':\r\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1);\r\n        break;\r\n    }\r\n\r\n    const metrics = await storage.getQuotaMetrics({\r\n      brandId: params.brandId,\r\n      windowType: 'day',\r\n      startDate,\r\n      endDate: now,\r\n    });\r\n\r\n    // Aggregate all metrics\r\n    const aggregate = metrics.reduce((acc, m) => ({\r\n      generate: acc.generate + m.generateCount,\r\n      edit: acc.edit + m.editCount,\r\n      analyze: acc.analyze + m.analyzeCount,\r\n      totalRequests: acc.totalRequests + m.requestCount,\r\n      totalTokens: acc.totalTokens + m.inputTokensTotal + m.outputTokensTotal,\r\n      totalCost: acc.totalCost + m.estimatedCostMicros,\r\n      modelBreakdown: mergeModelBreakdown(acc.modelBreakdown, m.modelBreakdown as Record<string, number> | null),\r\n    }), {\r\n      generate: 0,\r\n      edit: 0,\r\n      analyze: 0,\r\n      totalRequests: 0,\r\n      totalTokens: 0,\r\n      totalCost: 0,\r\n      modelBreakdown: {} as Record<string, number>,\r\n    });\r\n\r\n    return {\r\n      byOperation: {\r\n        generate: aggregate.generate,\r\n        edit: aggregate.edit,\r\n        analyze: aggregate.analyze,\r\n      },\r\n      byModel: aggregate.modelBreakdown,\r\n      totalRequests: aggregate.totalRequests,\r\n      totalTokens: aggregate.totalTokens,\r\n      totalCost: aggregate.totalCost / 1_000_000,\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Get rate limit status\r\n   */\r\n  async getRateLimitStatus(brandId: string): Promise<{\r\n    isLimited: boolean;\r\n    limitType?: string;\r\n    retryAfterSeconds?: number;\r\n    recentEvents: Array<{\r\n      limitType: string;\r\n      createdAt: Date;\r\n      retryAfterSeconds?: number;\r\n    }>;\r\n  }> {\r\n    const recentEvents = await storage.getRecentRateLimitEvents(brandId, 5);\r\n\r\n    if (recentEvents.length === 0) {\r\n      return { isLimited: false, recentEvents: [] };\r\n    }\r\n\r\n    const latest = recentEvents[0];\r\n    const expiresAt = latest.retryAfterSeconds\r\n      ? new Date(latest.createdAt).getTime() + latest.retryAfterSeconds * 1000\r\n      : 0;\r\n    const isLimited = expiresAt > Date.now();\r\n\r\n    return {\r\n      isLimited,\r\n      limitType: isLimited ? latest.limitType : undefined,\r\n      retryAfterSeconds: isLimited ? Math.ceil((expiresAt - Date.now()) / 1000) : undefined,\r\n      recentEvents: recentEvents.map(e => ({\r\n        limitType: e.limitType,\r\n        createdAt: e.createdAt,\r\n        retryAfterSeconds: e.retryAfterSeconds || undefined,\r\n      })),\r\n    };\r\n  },\r\n\r\n  /**\r\n   * Get and manage quota alerts\r\n   */\r\n  async getAlerts(brandId: string): Promise<GeminiQuotaAlert[]> {\r\n    return storage.getQuotaAlerts(brandId);\r\n  },\r\n\r\n  async setAlert(params: {\r\n    brandId: string;\r\n    alertType: 'rpm_threshold' | 'rpd_threshold' | 'token_threshold' | 'cost_threshold';\r\n    thresholdValue: number;\r\n    isEnabled: boolean;\r\n  }): Promise<GeminiQuotaAlert> {\r\n    return storage.upsertQuotaAlert({\r\n      brandId: params.brandId,\r\n      alertType: params.alertType,\r\n      thresholdValue: params.thresholdValue,\r\n      isEnabled: params.isEnabled,\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Check alert thresholds and return triggered alerts\r\n   */\r\n  async checkAlerts(brandId: string): Promise<Array<{\r\n    alertType: string;\r\n    currentValue: number;\r\n    threshold: number;\r\n    message: string;\r\n  }>> {\r\n    const alerts = await storage.getQuotaAlerts(brandId);\r\n    const status = await this.getQuotaStatus(brandId);\r\n    const triggered: Array<{\r\n      alertType: string;\r\n      currentValue: number;\r\n      threshold: number;\r\n      message: string;\r\n    }> = [];\r\n\r\n    for (const alert of alerts) {\r\n      if (!alert.isEnabled) continue;\r\n\r\n      let currentValue = 0;\r\n      let message = '';\r\n\r\n      switch (alert.alertType) {\r\n        case 'rpm_threshold':\r\n          currentValue = status.rpm.percentage;\r\n          message = `Requests per minute at ${Math.round(currentValue)}% of limit`;\r\n          break;\r\n        case 'rpd_threshold':\r\n          currentValue = status.rpd.percentage;\r\n          message = `Daily requests at ${Math.round(currentValue)}% of limit`;\r\n          break;\r\n        case 'token_threshold':\r\n          currentValue = status.tokens.percentage;\r\n          message = `Daily tokens at ${Math.round(currentValue)}% of limit`;\r\n          break;\r\n        case 'cost_threshold':\r\n          currentValue = status.cost.today;\r\n          message = `Today's cost: $${currentValue.toFixed(2)}`;\r\n          break;\r\n      }\r\n\r\n      if (currentValue >= alert.thresholdValue) {\r\n        triggered.push({\r\n          alertType: alert.alertType,\r\n          currentValue,\r\n          threshold: alert.thresholdValue,\r\n          message,\r\n        });\r\n\r\n        // Update trigger count\r\n        await storage.updateQuotaAlertTrigger(alert.id);\r\n      }\r\n    }\r\n\r\n    return triggered;\r\n  },\r\n};\r\n\r\n/**\r\n * Helper to merge model breakdown objects\r\n */\r\nfunction mergeModelBreakdown(\r\n  acc: Record<string, number>,\r\n  breakdown: Record<string, number> | null\r\n): Record<string, number> {\r\n  if (!breakdown) return acc;\r\n\r\n  for (const [model, count] of Object.entries(breakdown)) {\r\n    acc[model] = (acc[model] || 0) + count;\r\n  }\r\n\r\n  return acc;\r\n}\r\n\r\n/**\r\n * Parse retry delay from Gemini 429 error response\r\n */\r\nexport function parseRetryDelay(error: unknown): number | undefined {\r\n  if (!error || typeof error !== 'object') return undefined;\r\n\r\n  const err = error as Record<string, unknown>;\r\n\r\n  // Check structured error details\r\n  const details = (err.response as Record<string, unknown>)?.data as Record<string, unknown>;\r\n  const errorDetails = (details?.error as Record<string, unknown>)?.details as Array<Record<string, unknown>>;\r\n\r\n  if (Array.isArray(errorDetails)) {\r\n    for (const detail of errorDetails) {\r\n      if (detail['@type'] === 'type.googleapis.com/google.rpc.RetryInfo') {\r\n        const retryDelay = detail.retryDelay as Record<string, number> | undefined;\r\n        if (retryDelay) {\r\n          const seconds = retryDelay.seconds || 0;\r\n          const nanos = retryDelay.nanos || 0;\r\n          return seconds + nanos / 1_000_000_000;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Check error message for retry timing\r\n  const message = (err.message as string) || (details?.error as Record<string, unknown>)?.message as string;\r\n  if (message) {\r\n    const match = message.match(/retry in (\\d+\\.?\\d*)\\s*s/i);\r\n    if (match) {\r\n      return parseFloat(match[1]);\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Determine limit type from Gemini 429 error\r\n */\r\nexport function parseLimitType(error: unknown): 'rpm' | 'rpd' | 'tpm' | 'tpd' {\r\n  if (!error || typeof error !== 'object') return 'rpm';\r\n\r\n  const err = error as Record<string, unknown>;\r\n  const message = (err.message as string) || '';\r\n\r\n  if (message.includes('requests') && message.includes('day')) return 'rpd';\r\n  if (message.includes('tokens') && message.includes('day')) return 'tpd';\r\n  if (message.includes('tokens')) return 'tpm';\r\n\r\n  return 'rpm';\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\redisAuthLockout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\relationshipDiscoveryRAG.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\schedulingRepository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'desc' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"desc"},"fix":{"range":[438,444],"text":""},"desc":"Remove unused variable \"desc\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Scheduling Repository  DB queries for the content calendar\r\n *\r\n * Handles CRUD operations on the `scheduled_posts` table:\r\n * - Date-range queries for calendar grid\r\n * - Post-count aggregation for dot indicators\r\n * - Schedule / reschedule / cancel mutations\r\n * - Atomic claim for n8n due-post polling\r\n */\r\n\r\nimport { db, pool } from '../db';\r\nimport { scheduledPosts } from '@shared/schema';\r\nimport { eq, and, gte, lte, sql, desc } from 'drizzle-orm';\r\nimport { logger } from '../lib/logger';\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Types                                                              */\r\n/* ------------------------------------------------------------------ */\r\n\r\nexport interface SchedulePostInput {\r\n  userId: string;\r\n  connectionId: string;\r\n  caption: string;\r\n  hashtags?: string[];\r\n  imageUrl?: string;\r\n  imagePublicId?: string;\r\n  scheduledFor: Date;\r\n  timezone?: string;\r\n  generationId?: string;\r\n  templateId?: string;\r\n}\r\n\r\nexport interface DayCount {\r\n  date: string; // YYYY-MM-DD\r\n  total: number;\r\n  scheduled: number;\r\n  published: number;\r\n  failed: number;\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Queries                                                            */\r\n/* ------------------------------------------------------------------ */\r\n\r\n/**\r\n * Get all scheduled posts for a user within a date range.\r\n * Used by the calendar grid to render post cards.\r\n */\r\nexport async function getScheduledPostsByDateRange(userId: string, startDate: Date, endDate: Date) {\r\n  return db\r\n    .select()\r\n    .from(scheduledPosts)\r\n    .where(\r\n      and(\r\n        eq(scheduledPosts.userId, userId),\r\n        gte(scheduledPosts.scheduledFor, startDate),\r\n        lte(scheduledPosts.scheduledFor, endDate),\r\n      ),\r\n    )\r\n    .orderBy(scheduledPosts.scheduledFor);\r\n}\r\n\r\n/**\r\n * Get a single scheduled post by ID (with ownership check).\r\n */\r\nexport async function getScheduledPostById(postId: string, userId: string) {\r\n  const rows = await db\r\n    .select()\r\n    .from(scheduledPosts)\r\n    .where(and(eq(scheduledPosts.id, postId), eq(scheduledPosts.userId, userId)))\r\n    .limit(1);\r\n  return rows[0] ?? null;\r\n}\r\n\r\n/**\r\n * Aggregate post counts per day for a given month.\r\n * Returns one row per day that has at least one post.\r\n */\r\nexport async function getPostCountsByMonth(userId: string, year: number, month: number): Promise<DayCount[]> {\r\n  const startDate = new Date(year, month - 1, 1);\r\n  const endDate = new Date(year, month, 0, 23, 59, 59, 999);\r\n\r\n  const result = await pool.query(\r\n    `SELECT\r\n       TO_CHAR(scheduled_for, 'YYYY-MM-DD') AS date,\r\n       COUNT(*)::int AS total,\r\n       COUNT(*) FILTER (WHERE status = 'scheduled')::int AS scheduled,\r\n       COUNT(*) FILTER (WHERE status = 'published')::int AS published,\r\n       COUNT(*) FILTER (WHERE status = 'failed')::int AS failed\r\n     FROM scheduled_posts\r\n     WHERE user_id = $1\r\n       AND scheduled_for >= $2\r\n       AND scheduled_for <= $3\r\n     GROUP BY TO_CHAR(scheduled_for, 'YYYY-MM-DD')\r\n     ORDER BY date`,\r\n    [userId, startDate.toISOString(), endDate.toISOString()],\r\n  );\r\n\r\n  return result.rows as DayCount[];\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  Mutations                                                          */\r\n/* ------------------------------------------------------------------ */\r\n\r\n/**\r\n * Create a new scheduled post (status = 'scheduled').\r\n */\r\nexport async function schedulePost(input: SchedulePostInput) {\r\n  const rows = await db\r\n    .insert(scheduledPosts)\r\n    .values({\r\n      userId: input.userId,\r\n      connectionId: input.connectionId,\r\n      caption: input.caption,\r\n      hashtags: input.hashtags ?? [],\r\n      imageUrl: input.imageUrl ?? null,\r\n      imagePublicId: input.imagePublicId ?? null,\r\n      scheduledFor: input.scheduledFor,\r\n      timezone: input.timezone ?? 'UTC',\r\n      status: 'scheduled',\r\n      generationId: input.generationId ?? null,\r\n      templateId: input.templateId ?? null,\r\n    })\r\n    .returning();\r\n\r\n  return rows[0]!;\r\n}\r\n\r\n/**\r\n * Reschedule a post to a new date/time.\r\n * Only posts with status 'scheduled' can be rescheduled.\r\n */\r\nexport async function reschedulePost(postId: string, userId: string, newDate: Date) {\r\n  const rows = await db\r\n    .update(scheduledPosts)\r\n    .set({\r\n      scheduledFor: newDate,\r\n      updatedAt: new Date(),\r\n    })\r\n    .where(\r\n      and(eq(scheduledPosts.id, postId), eq(scheduledPosts.userId, userId), eq(scheduledPosts.status, 'scheduled')),\r\n    )\r\n    .returning();\r\n\r\n  return rows[0] ?? null;\r\n}\r\n\r\n/**\r\n * Cancel a scheduled post.\r\n * Only posts with status 'scheduled' can be cancelled.\r\n */\r\nexport async function cancelScheduledPost(postId: string, userId: string) {\r\n  const rows = await db\r\n    .update(scheduledPosts)\r\n    .set({\r\n      status: 'cancelled',\r\n      updatedAt: new Date(),\r\n    })\r\n    .where(\r\n      and(eq(scheduledPosts.id, postId), eq(scheduledPosts.userId, userId), eq(scheduledPosts.status, 'scheduled')),\r\n    )\r\n    .returning();\r\n\r\n  return rows[0] ?? null;\r\n}\r\n\r\n/* ------------------------------------------------------------------ */\r\n/*  n8n Integration                                                    */\r\n/* ------------------------------------------------------------------ */\r\n\r\n/**\r\n * Atomically claim due posts for publishing.\r\n *\r\n * Uses `FOR UPDATE SKIP LOCKED` to prevent double-claiming\r\n * when multiple n8n polling instances exist.\r\n *\r\n * @returns Array of posts that have been claimed (status  'publishing')\r\n */\r\nexport async function claimDuePosts(limit: number = 10) {\r\n  const client = await pool.connect();\r\n  try {\r\n    await client.query('BEGIN');\r\n\r\n    // Select posts that are due and lock them\r\n    const { rows: duePosts } = await client.query(\r\n      `SELECT id, user_id, connection_id, caption, hashtags,\r\n              image_url, scheduled_for, timezone,\r\n              generation_id, template_id\r\n       FROM scheduled_posts\r\n       WHERE status = 'scheduled'\r\n         AND scheduled_for <= NOW()\r\n       ORDER BY scheduled_for ASC\r\n       LIMIT $1\r\n       FOR UPDATE SKIP LOCKED`,\r\n      [limit],\r\n    );\r\n\r\n    if (duePosts.length === 0) {\r\n      await client.query('COMMIT');\r\n      return [];\r\n    }\r\n\r\n    // Update status to 'publishing'\r\n    const ids = duePosts.map((r: { id: string }) => r.id);\r\n    await client.query(\r\n      `UPDATE scheduled_posts\r\n       SET status = 'publishing', updated_at = NOW()\r\n       WHERE id = ANY($1::text[])`,\r\n      [ids],\r\n    );\r\n\r\n    await client.query('COMMIT');\r\n\r\n    logger.info({ claimedCount: duePosts.length, ids }, 'Claimed due posts for publishing');\r\n    return duePosts;\r\n  } catch (error) {\r\n    await client.query('ROLLBACK');\r\n    logger.error({ err: error }, 'Failed to claim due posts');\r\n    throw error;\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\n/**\r\n * Schedule a retry for a failed post using exponential backoff.\r\n * Sets the post back to 'scheduled' with a future scheduledFor.\r\n * The posting job will pick it up again when the time arrives.\r\n *\r\n * Backoff: 1min  2^retryCount (max 1 hour), plus random jitter.\r\n * Max 3 retries  after that, the post stays as 'failed'.\r\n */\r\nexport async function scheduleRetry(postId: string): Promise<boolean> {\r\n  const MAX_RETRIES = 3;\r\n  const BASE_DELAY_MS = 60_000; // 1 minute\r\n  const MAX_DELAY_MS = 3_600_000; // 1 hour\r\n\r\n  const rows = await db\r\n    .select({ retryCount: scheduledPosts.retryCount })\r\n    .from(scheduledPosts)\r\n    .where(eq(scheduledPosts.id, postId))\r\n    .limit(1);\r\n\r\n  const post = rows[0];\r\n  if (!post) return false;\r\n\r\n  const retryCount = post.retryCount ?? 0;\r\n  if (retryCount >= MAX_RETRIES) {\r\n    logger.info({ postId, retryCount }, 'Max retries reached, not scheduling another retry');\r\n    return false;\r\n  }\r\n\r\n  const delay = Math.min(BASE_DELAY_MS * Math.pow(2, retryCount), MAX_DELAY_MS);\r\n  const jitter = Math.floor(Math.random() * 10_000);\r\n  const nextRetryAt = new Date(Date.now() + delay + jitter);\r\n\r\n  await db\r\n    .update(scheduledPosts)\r\n    .set({\r\n      status: 'scheduled',\r\n      scheduledFor: nextRetryAt,\r\n      nextRetryAt,\r\n      updatedAt: new Date(),\r\n    })\r\n    .where(eq(scheduledPosts.id, postId));\r\n\r\n  logger.info({ postId, retryCount: retryCount + 1, nextRetryAt: nextRetryAt.toISOString() }, 'Retry scheduled');\r\n  return true;\r\n}\r\n\r\n/**\r\n * Update a post after n8n callback (success or failure).\r\n */\r\nexport async function updatePostAfterCallback(\r\n  postId: string,\r\n  success: boolean,\r\n  data: {\r\n    platformPostId?: string;\r\n    platformPostUrl?: string;\r\n    errorMessage?: string;\r\n    failureReason?: string;\r\n  },\r\n) {\r\n  if (success) {\r\n    return db\r\n      .update(scheduledPosts)\r\n      .set({\r\n        status: 'published',\r\n        publishedAt: new Date(),\r\n        platformPostId: data.platformPostId ?? null,\r\n        platformPostUrl: data.platformPostUrl ?? null,\r\n        errorMessage: null,\r\n        updatedAt: new Date(),\r\n      })\r\n      .where(eq(scheduledPosts.id, postId))\r\n      .returning();\r\n  }\r\n\r\n  // Failure  increment retry count\r\n  return db\r\n    .update(scheduledPosts)\r\n    .set({\r\n      status: 'failed',\r\n      errorMessage: data.errorMessage ?? 'Unknown error',\r\n      failureReason: data.failureReason ?? null,\r\n      retryCount: sql`retry_count + 1`,\r\n      updatedAt: new Date(),\r\n    })\r\n    .where(eq(scheduledPosts.id, postId))\r\n    .returning();\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\styleAnalysisService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\systemHealthService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\templatePatternRAG.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\visionAnalysisService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\services\\weeklyPlannerService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\storage.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3842,3845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3842,3845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21590,21593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21590,21593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  type Generation,\r\n  type InsertGeneration,\r\n  type Product,\r\n  type InsertProduct,\r\n  type PromptTemplate,\r\n  type InsertPromptTemplate,\r\n  type User,\r\n  type AdCopy,\r\n  type InsertAdCopy,\r\n  type GenerationUsage,\r\n  type InsertGenerationUsage,\r\n  type AdSceneTemplate,\r\n  type InsertAdSceneTemplate,\r\n  type BrandProfile,\r\n  type InsertBrandProfile,\r\n  type ProductAnalysis,\r\n  type InsertProductAnalysis,\r\n  // Phase 0.5: Product Knowledge types\r\n  type InstallationScenario,\r\n  type InsertInstallationScenario,\r\n  type ProductRelationship,\r\n  type InsertProductRelationship,\r\n  type BrandImage,\r\n  type InsertBrandImage,\r\n  // Performing Ad Templates types\r\n  type PerformingAdTemplate,\r\n  type InsertPerformingAdTemplate,\r\n  // Quota monitoring types\r\n  type GeminiQuotaMetrics,\r\n  type InsertGeminiQuotaMetrics,\r\n  type GeminiRateLimitEvent,\r\n  type InsertGeminiRateLimitEvent,\r\n  type GeminiQuotaAlert,\r\n  type InsertGeminiQuotaAlert,\r\n  // Google Cloud Monitoring sync types\r\n  type GoogleQuotaSnapshot,\r\n  type InsertGoogleQuotaSnapshot,\r\n  type GoogleQuotaSyncHistory,\r\n  type InsertGoogleQuotaSyncHistory,\r\n  // API Key Management types (Phase 7)\r\n  type UserApiKey,\r\n  type ApiKeyAuditLog,\r\n  // Learn from Winners types\r\n  type LearnedAdPattern,\r\n  type InsertLearnedAdPattern,\r\n  type AdAnalysisUpload,\r\n  type InsertAdAnalysisUpload,\r\n  type PatternApplicationHistory,\r\n  type InsertPatternApplicationHistory,\r\n  // Content Planner types\r\n  type ContentPlannerPost,\r\n  type InsertContentPlannerPost,\r\n  // Social Connections types (Phase 8.1)\r\n  type SocialConnection,\r\n  type InsertSocialConnection,\r\n  // Approval Queue types (Phase 8)\r\n  type ApprovalQueue,\r\n  type InsertApprovalQueue,\r\n  type ApprovalAuditLog,\r\n  type InsertApprovalAuditLog,\r\n  type ApprovalSettings,\r\n  // Style Reference types\r\n  type StyleReference,\r\n  type InsertStyleReference,\r\n  // Training types\r\n  type TrainingDataset,\r\n  type InsertTrainingDataset,\r\n  type TrainingExample,\r\n  type InsertTrainingExample,\r\n  // Phase 5: Intelligence Layer types\r\n  type BrandDNA,\r\n  type InsertBrandDNA,\r\n  type GenerationPerformance,\r\n  type InsertGenerationPerformance,\r\n} from '@shared/schema';\r\n\r\n// Repository imports\r\nimport {\r\n  generationRepo,\r\n  productRepo,\r\n  userRepo,\r\n  templateRepo,\r\n  copywritingRepo,\r\n  knowledgeRepo,\r\n  quotaRepo,\r\n  patternRepo,\r\n  planningRepo,\r\n  approvalRepo,\r\n  apiKeyRepo,\r\n  socialRepo,\r\n  styleReferenceRepo,\r\n  trainingRepo,\r\n  intelligenceRepo,\r\n} from './repositories';\r\n\r\nexport interface IStorage {\r\n  // Generation CRUD operations\r\n  saveGeneration(generation: InsertGeneration): Promise<Generation>;\r\n  getGenerations(limit?: number, offset?: number): Promise<Generation[]>;\r\n  getGenerationById(id: string): Promise<Generation | undefined>;\r\n  updateGeneration(id: number | string, updates: Partial<InsertGeneration>): Promise<Generation>;\r\n  deleteGeneration(id: string): Promise<void>;\r\n  getEditHistory(generationId: string): Promise<Generation[]>;\r\n\r\n  // Product CRUD operations\r\n  saveProduct(product: InsertProduct): Promise<Product>;\r\n  getProducts(limit?: number, offset?: number): Promise<Product[]>;\r\n  getProductById(id: string): Promise<Product | undefined>;\r\n  deleteProduct(id: string): Promise<void>;\r\n\r\n  // Prompt Template CRUD operations\r\n  savePromptTemplate(template: InsertPromptTemplate): Promise<PromptTemplate>;\r\n  getPromptTemplates(category?: string): Promise<PromptTemplate[]>;\r\n  getPromptTemplateById(id: string): Promise<PromptTemplate | undefined>;\r\n  deletePromptTemplate(id: string): Promise<void>;\r\n\r\n  // User CRUD operations\r\n  createUser(email: string, passwordHash: string): Promise<User>;\r\n  getUserByEmail(email: string): Promise<User | undefined>;\r\n  getUserById(id: string): Promise<User | undefined>;\r\n  updateUserBrandVoice(userId: string, brandVoice: any): Promise<User>;\r\n\r\n  // AdCopy CRUD operations\r\n  saveAdCopy(copy: InsertAdCopy): Promise<AdCopy>;\r\n  getAdCopyByGenerationId(generationId: string): Promise<AdCopy[]>;\r\n  getAdCopyById(id: string): Promise<AdCopy | undefined>;\r\n  deleteAdCopy(id: string): Promise<void>;\r\n  getCopyVariations(parentCopyId: string): Promise<AdCopy[]>;\r\n\r\n  // Generation usage/cost tracking\r\n  saveGenerationUsage(usage: InsertGenerationUsage): Promise<GenerationUsage>;\r\n  getGenerationUsageRows(params: {\r\n    brandId: string;\r\n    operation: string;\r\n    resolution: string;\r\n    inputImagesCount: number;\r\n    limit?: number;\r\n  }): Promise<{ estimatedCostMicros: number; createdAt: Date }[]>;\r\n\r\n  // ============================================\r\n  // INTELLIGENT IDEA BANK OPERATIONS\r\n  // ============================================\r\n\r\n  // Ad Scene Template CRUD operations\r\n  saveAdSceneTemplate(template: InsertAdSceneTemplate): Promise<AdSceneTemplate>;\r\n  getAdSceneTemplates(filters?: {\r\n    category?: string;\r\n    isGlobal?: boolean;\r\n    createdBy?: string;\r\n  }): Promise<AdSceneTemplate[]>;\r\n  getAdSceneTemplateById(id: string): Promise<AdSceneTemplate | undefined>;\r\n  updateAdSceneTemplate(id: string, updates: Partial<InsertAdSceneTemplate>): Promise<AdSceneTemplate>;\r\n  deleteAdSceneTemplate(id: string): Promise<void>;\r\n  searchAdSceneTemplates(query: string): Promise<AdSceneTemplate[]>;\r\n\r\n  // Brand Profile CRUD operations\r\n  saveBrandProfile(profile: InsertBrandProfile): Promise<BrandProfile>;\r\n  getBrandProfileByUserId(userId: string): Promise<BrandProfile | undefined>;\r\n  updateBrandProfile(userId: string, updates: Partial<InsertBrandProfile>): Promise<BrandProfile>;\r\n  deleteBrandProfile(userId: string): Promise<void>;\r\n\r\n  // Product Analysis CRUD operations\r\n  saveProductAnalysis(analysis: InsertProductAnalysis): Promise<ProductAnalysis>;\r\n  getProductAnalysisByProductId(productId: string): Promise<ProductAnalysis | undefined>;\r\n  getProductAnalysisByFingerprint(fingerprint: string): Promise<ProductAnalysis | undefined>;\r\n  updateProductAnalysis(productId: string, updates: Partial<InsertProductAnalysis>): Promise<ProductAnalysis>;\r\n  deleteProductAnalysis(productId: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // PHASE 0.5: PRODUCT KNOWLEDGE OPERATIONS\r\n  // ============================================\r\n\r\n  // Enhanced Product operations\r\n  updateProduct(id: string, updates: Partial<InsertProduct>): Promise<Product>;\r\n  getProductsByIds(ids: string[]): Promise<Product[]>;\r\n  searchProductsByTag(tag: string): Promise<Product[]>;\r\n\r\n  // Installation Scenario CRUD operations\r\n  createInstallationScenario(scenario: InsertInstallationScenario): Promise<InstallationScenario>;\r\n  getInstallationScenarioById(id: string): Promise<InstallationScenario | undefined>;\r\n  getInstallationScenariosForProducts(productIds: string[]): Promise<InstallationScenario[]>;\r\n  getScenariosByRoomType(roomType: string): Promise<InstallationScenario[]>;\r\n  updateInstallationScenario(id: string, updates: Partial<InsertInstallationScenario>): Promise<InstallationScenario>;\r\n  deleteInstallationScenario(id: string): Promise<void>;\r\n\r\n  // Product Relationship CRUD operations\r\n  createProductRelationship(relationship: InsertProductRelationship): Promise<ProductRelationship>;\r\n  getProductRelationships(productIds: string[]): Promise<ProductRelationship[]>;\r\n  getProductRelationshipsByType(productId: string, relationshipType: string): Promise<ProductRelationship[]>;\r\n  deleteProductRelationship(id: string): Promise<void>;\r\n\r\n  // Brand Image CRUD operations\r\n  createBrandImage(image: InsertBrandImage): Promise<BrandImage>;\r\n  getBrandImagesForProducts(productIds: string[], userId: string): Promise<BrandImage[]>;\r\n  getBrandImagesByCategory(userId: string, category: string): Promise<BrandImage[]>;\r\n  updateBrandImage(id: string, updates: Partial<InsertBrandImage>): Promise<BrandImage>;\r\n  deleteBrandImage(id: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // GEMINI QUOTA MONITORING OPERATIONS\r\n  // ============================================\r\n\r\n  // Quota Metrics CRUD operations\r\n  upsertQuotaMetrics(metrics: InsertGeminiQuotaMetrics): Promise<GeminiQuotaMetrics>;\r\n  getQuotaMetrics(params: {\r\n    brandId: string;\r\n    windowType: string;\r\n    startDate: Date;\r\n    endDate: Date;\r\n  }): Promise<GeminiQuotaMetrics[]>;\r\n  getLatestQuotaMetric(brandId: string, windowType: string): Promise<GeminiQuotaMetrics | undefined>;\r\n\r\n  // Rate Limit Event operations\r\n  createRateLimitEvent(event: InsertGeminiRateLimitEvent): Promise<GeminiRateLimitEvent>;\r\n  getRecentRateLimitEvents(brandId: string, minutes: number): Promise<GeminiRateLimitEvent[]>;\r\n\r\n  // Quota Alert operations\r\n  getQuotaAlerts(brandId: string): Promise<GeminiQuotaAlert[]>;\r\n  upsertQuotaAlert(alert: InsertGeminiQuotaAlert): Promise<GeminiQuotaAlert>;\r\n  updateQuotaAlertTrigger(id: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // GOOGLE CLOUD MONITORING SYNC OPERATIONS\r\n  // ============================================\r\n\r\n  // Google Quota Snapshot operations\r\n  saveGoogleQuotaSnapshot(snapshot: InsertGoogleQuotaSnapshot): Promise<GoogleQuotaSnapshot>;\r\n  getLatestGoogleQuotaSnapshot(brandId?: string): Promise<GoogleQuotaSnapshot | undefined>;\r\n  getGoogleQuotaSnapshotHistory(params: {\r\n    brandId?: string;\r\n    startDate: Date;\r\n    endDate: Date;\r\n    limit?: number;\r\n  }): Promise<GoogleQuotaSnapshot[]>;\r\n\r\n  // Sync History operations\r\n  createSyncHistoryEntry(entry: InsertGoogleQuotaSyncHistory): Promise<GoogleQuotaSyncHistory>;\r\n  updateSyncHistoryEntry(id: string, updates: Partial<InsertGoogleQuotaSyncHistory>): Promise<GoogleQuotaSyncHistory>;\r\n  getRecentSyncHistory(limit?: number): Promise<GoogleQuotaSyncHistory[]>;\r\n\r\n  // ============================================\r\n  // API KEY MANAGEMENT OPERATIONS (Phase 7)\r\n  // ============================================\r\n\r\n  // API Key CRUD operations\r\n  getUserApiKey(userId: string, service: string): Promise<UserApiKey | null>;\r\n  getAllUserApiKeys(userId: string): Promise<UserApiKey[]>;\r\n  saveUserApiKey(data: {\r\n    userId: string;\r\n    service: string;\r\n    encryptedKey: string;\r\n    iv: string;\r\n    authTag: string;\r\n    keyPreview: string;\r\n    isValid?: boolean;\r\n  }): Promise<UserApiKey>;\r\n  updateUserApiKeyValidity(userId: string, service: string, isValid: boolean): Promise<void>;\r\n  deleteUserApiKey(userId: string, service: string): Promise<void>;\r\n\r\n  // Audit logging\r\n  logApiKeyAction(entry: {\r\n    userId: string;\r\n    service: string;\r\n    action: 'create' | 'update' | 'delete' | 'validate' | 'use';\r\n    ipAddress?: string;\r\n    userAgent?: string;\r\n    success: boolean;\r\n    errorMessage?: string;\r\n  }): Promise<void>;\r\n  getApiKeyAuditLog(userId: string, service?: string, limit?: number): Promise<ApiKeyAuditLog[]>;\r\n\r\n  // Key resolution with fallback\r\n  resolveApiKey(\r\n    userId: string,\r\n    service: string,\r\n  ): Promise<{ key: string | null; source: 'user' | 'environment' | 'none' }>;\r\n\r\n  // ============================================\r\n  // N8N CONFIGURATION VAULT (Phase 8.1)\r\n  // ============================================\r\n\r\n  // n8n Configuration Vault\r\n  saveN8nConfig(userId: string, baseUrl: string, apiKey?: string): Promise<void>;\r\n  getN8nConfig(userId: string): Promise<{ baseUrl: string; apiKey?: string } | null>;\r\n  deleteN8nConfig(userId: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // SOCIAL CONNECTION MANAGEMENT (Phase 8.1)\r\n  // ============================================\r\n\r\n  // Social Connection CRUD operations\r\n  getSocialConnections(userId: string): Promise<SocialConnection[]>;\r\n  getSocialConnectionById(id: string): Promise<SocialConnection | null>;\r\n  getSocialConnectionByPlatform(userId: string, platform: string): Promise<SocialConnection | null>;\r\n  createSocialConnection(data: InsertSocialConnection): Promise<SocialConnection>;\r\n  updateSocialConnection(id: string, updates: Partial<SocialConnection>): Promise<SocialConnection>;\r\n  deleteSocialConnection(id: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // LEARN FROM WINNERS - PATTERN OPERATIONS\r\n  // ============================================\r\n\r\n  // Learned Ad Pattern CRUD operations\r\n  createLearnedPattern(pattern: InsertLearnedAdPattern): Promise<LearnedAdPattern>;\r\n  getLearnedPatterns(\r\n    userId: string,\r\n    filters?: {\r\n      category?: string;\r\n      platform?: string;\r\n      industry?: string;\r\n      isActive?: boolean;\r\n    },\r\n  ): Promise<LearnedAdPattern[]>;\r\n  getLearnedPatternById(id: string): Promise<LearnedAdPattern | undefined>;\r\n  getLearnedPatternByHash(userId: string, sourceHash: string): Promise<LearnedAdPattern | undefined>;\r\n  updateLearnedPattern(id: string, updates: Partial<InsertLearnedAdPattern>): Promise<LearnedAdPattern>;\r\n  deleteLearnedPattern(id: string): Promise<void>;\r\n  incrementPatternUsage(id: string): Promise<void>;\r\n\r\n  // Ad Analysis Upload CRUD operations\r\n  createUploadRecord(upload: InsertAdAnalysisUpload): Promise<AdAnalysisUpload>;\r\n  getUploadById(id: string): Promise<AdAnalysisUpload | undefined>;\r\n  updateUploadStatus(id: string, status: string, errorMessage?: string): Promise<AdAnalysisUpload>;\r\n  updateUploadWithPattern(id: string, patternId: string, processingDurationMs: number): Promise<AdAnalysisUpload>;\r\n  getExpiredUploads(): Promise<AdAnalysisUpload[]>;\r\n  deleteUpload(id: string): Promise<void>;\r\n\r\n  // Pattern Application History operations\r\n  createApplicationHistory(history: InsertPatternApplicationHistory): Promise<PatternApplicationHistory>;\r\n  getPatternApplicationHistory(patternId: string): Promise<PatternApplicationHistory[]>;\r\n  updateApplicationFeedback(\r\n    id: string,\r\n    rating: number,\r\n    wasUsed: boolean,\r\n    feedback?: string,\r\n  ): Promise<PatternApplicationHistory>;\r\n\r\n  // ============================================\r\n  // CONTENT PLANNER OPERATIONS\r\n  // ============================================\r\n\r\n  // Content Planner Post CRUD operations\r\n  createContentPlannerPost(post: InsertContentPlannerPost): Promise<ContentPlannerPost>;\r\n  getContentPlannerPostById(id: string): Promise<ContentPlannerPost | null>;\r\n  getContentPlannerPostsByUser(userId: string, startDate?: Date, endDate?: Date): Promise<ContentPlannerPost[]>;\r\n  getWeeklyBalance(userId: string): Promise<{ category: string; count: number }[]>;\r\n  deleteContentPlannerPost(id: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // APPROVAL QUEUE OPERATIONS (Phase 8)\r\n  // ============================================\r\n\r\n  // Approval Queue CRUD operations\r\n  createApprovalQueue(data: InsertApprovalQueue): Promise<ApprovalQueue>;\r\n  getApprovalQueue(id: string): Promise<ApprovalQueue | null>;\r\n  getApprovalQueueForUser(\r\n    userId: string,\r\n    filters?: {\r\n      status?: string;\r\n      priority?: string;\r\n      platform?: string;\r\n      dateFrom?: Date;\r\n      dateTo?: Date;\r\n    },\r\n  ): Promise<ApprovalQueue[]>;\r\n  updateApprovalQueue(id: string, updates: Partial<ApprovalQueue>): Promise<ApprovalQueue>;\r\n  deleteApprovalQueue(id: string): Promise<void>;\r\n\r\n  // Approval Audit Log operations\r\n  createApprovalAuditLog(data: InsertApprovalAuditLog): Promise<ApprovalAuditLog>;\r\n  getApprovalAuditLog(approvalQueueId: string): Promise<ApprovalAuditLog[]>;\r\n\r\n  // Approval Settings operations\r\n  getApprovalSettings(userId: string): Promise<ApprovalSettings | null>;\r\n  updateApprovalSettings(userId: string, settings: Partial<ApprovalSettings>): Promise<ApprovalSettings>;\r\n\r\n  // ============================================\r\n  // STYLE REFERENCE OPERATIONS\r\n  // ============================================\r\n  createStyleReference(data: InsertStyleReference): Promise<StyleReference>;\r\n  getStyleReferencesByUser(userId: string, limit?: number, offset?: number): Promise<StyleReference[]>;\r\n  getStyleReferenceById(id: string): Promise<StyleReference | undefined>;\r\n  getStyleReferencesByCategory(userId: string, category: string): Promise<StyleReference[]>;\r\n  updateStyleReference(id: string, updates: Partial<InsertStyleReference>): Promise<StyleReference>;\r\n  deleteStyleReference(id: string): Promise<void>;\r\n  incrementStyleReferenceUsage(id: string): Promise<void>;\r\n  getStyleReferencesByIds(ids: string[]): Promise<StyleReference[]>;\r\n\r\n  // ============================================\r\n  // CUSTOM MODEL TRAINING OPERATIONS\r\n  // ============================================\r\n  createTrainingDataset(data: InsertTrainingDataset): Promise<TrainingDataset>;\r\n  getTrainingDatasetById(id: string): Promise<TrainingDataset | undefined>;\r\n  getTrainingDatasetsByUser(userId: string): Promise<TrainingDataset[]>;\r\n  updateTrainingDataset(id: string, updates: Partial<InsertTrainingDataset>): Promise<TrainingDataset>;\r\n  deleteTrainingDataset(id: string): Promise<void>;\r\n  createTrainingExample(data: InsertTrainingExample): Promise<TrainingExample>;\r\n  getTrainingExamples(datasetId: string): Promise<TrainingExample[]>;\r\n  deleteTrainingExample(id: string): Promise<void>;\r\n\r\n  // ============================================\r\n  // BRAND DNA OPERATIONS (Phase 5)\r\n  // ============================================\r\n  getBrandDNA(userId: string): Promise<BrandDNA | null>;\r\n  upsertBrandDNA(userId: string, data: Partial<InsertBrandDNA>): Promise<BrandDNA>;\r\n\r\n  // ============================================\r\n  // GENERATION PERFORMANCE OPERATIONS (Phase 5)\r\n  // ============================================\r\n  getGenerationPerformance(generationId: string): Promise<GenerationPerformance[]>;\r\n  saveGenerationPerformance(data: InsertGenerationPerformance): Promise<GenerationPerformance>;\r\n}\r\n\r\nexport class DbStorage implements IStorage {\r\n  // ============================================\r\n  // GENERATION OPERATIONS\r\n  // ============================================\r\n  async saveGeneration(generation: InsertGeneration): Promise<Generation> {\r\n    return generationRepo.saveGeneration(generation);\r\n  }\r\n  async getGenerations(limit?: number, offset?: number): Promise<Generation[]> {\r\n    return generationRepo.getGenerations(limit, offset);\r\n  }\r\n  async getGenerationById(id: string): Promise<Generation | undefined> {\r\n    return generationRepo.getGenerationById(id);\r\n  }\r\n  async updateGeneration(id: number | string, updates: Partial<InsertGeneration>): Promise<Generation> {\r\n    return generationRepo.updateGeneration(id, updates);\r\n  }\r\n  async deleteGeneration(id: string): Promise<void> {\r\n    return generationRepo.deleteGeneration(id);\r\n  }\r\n  async getEditHistory(generationId: string): Promise<Generation[]> {\r\n    return generationRepo.getEditHistory(generationId);\r\n  }\r\n  async saveGenerationUsage(usage: InsertGenerationUsage): Promise<GenerationUsage> {\r\n    return generationRepo.saveGenerationUsage(usage);\r\n  }\r\n  async getGenerationUsageRows(params: {\r\n    brandId: string;\r\n    operation: string;\r\n    resolution: string;\r\n    inputImagesCount: number;\r\n    limit?: number;\r\n  }): Promise<{ estimatedCostMicros: number; createdAt: Date }[]> {\r\n    return generationRepo.getGenerationUsageRows(params);\r\n  }\r\n\r\n  // ============================================\r\n  // PRODUCT OPERATIONS\r\n  // ============================================\r\n  async saveProduct(product: InsertProduct): Promise<Product> {\r\n    return productRepo.saveProduct(product);\r\n  }\r\n  async getProducts(limit?: number, offset?: number): Promise<Product[]> {\r\n    return productRepo.getProducts(limit, offset);\r\n  }\r\n  async getProductById(id: string): Promise<Product | undefined> {\r\n    return productRepo.getProductById(id);\r\n  }\r\n  async deleteProduct(id: string): Promise<void> {\r\n    return productRepo.deleteProduct(id);\r\n  }\r\n  async updateProduct(id: string, updates: Partial<InsertProduct>): Promise<Product> {\r\n    return productRepo.updateProduct(id, updates);\r\n  }\r\n  async getProductsByIds(ids: string[]): Promise<Product[]> {\r\n    return productRepo.getProductsByIds(ids);\r\n  }\r\n  async searchProductsByTag(tag: string): Promise<Product[]> {\r\n    return productRepo.searchProductsByTag(tag);\r\n  }\r\n\r\n  // ============================================\r\n  // PRODUCT ANALYSIS OPERATIONS\r\n  // ============================================\r\n  async saveProductAnalysis(analysis: InsertProductAnalysis): Promise<ProductAnalysis> {\r\n    return productRepo.saveProductAnalysis(analysis);\r\n  }\r\n  async getProductAnalysisByProductId(productId: string): Promise<ProductAnalysis | undefined> {\r\n    return productRepo.getProductAnalysisByProductId(productId);\r\n  }\r\n  async getProductAnalysisByFingerprint(fingerprint: string): Promise<ProductAnalysis | undefined> {\r\n    return productRepo.getProductAnalysisByFingerprint(fingerprint);\r\n  }\r\n  async updateProductAnalysis(productId: string, updates: Partial<InsertProductAnalysis>): Promise<ProductAnalysis> {\r\n    return productRepo.updateProductAnalysis(productId, updates);\r\n  }\r\n  async deleteProductAnalysis(productId: string): Promise<void> {\r\n    return productRepo.deleteProductAnalysis(productId);\r\n  }\r\n\r\n  // ============================================\r\n  // USER OPERATIONS\r\n  // ============================================\r\n  async createUser(email: string, passwordHash: string): Promise<User> {\r\n    return userRepo.createUser(email, passwordHash);\r\n  }\r\n  async getUserByEmail(email: string): Promise<User | undefined> {\r\n    return userRepo.getUserByEmail(email);\r\n  }\r\n  async getUserById(id: string): Promise<User | undefined> {\r\n    return userRepo.getUserById(id);\r\n  }\r\n  async updateUserBrandVoice(userId: string, brandVoice: any): Promise<User> {\r\n    return userRepo.updateUserBrandVoice(userId, brandVoice);\r\n  }\r\n\r\n  // ============================================\r\n  // PROMPT TEMPLATE OPERATIONS\r\n  // ============================================\r\n  async savePromptTemplate(template: InsertPromptTemplate): Promise<PromptTemplate> {\r\n    return templateRepo.savePromptTemplate(template);\r\n  }\r\n  async getPromptTemplates(category?: string): Promise<PromptTemplate[]> {\r\n    return templateRepo.getPromptTemplates(category);\r\n  }\r\n  async getPromptTemplateById(id: string): Promise<PromptTemplate | undefined> {\r\n    return templateRepo.getPromptTemplateById(id);\r\n  }\r\n  async deletePromptTemplate(id: string): Promise<void> {\r\n    return templateRepo.deletePromptTemplate(id);\r\n  }\r\n\r\n  // ============================================\r\n  // AD SCENE TEMPLATE OPERATIONS\r\n  // ============================================\r\n  async saveAdSceneTemplate(template: InsertAdSceneTemplate): Promise<AdSceneTemplate> {\r\n    return templateRepo.saveAdSceneTemplate(template);\r\n  }\r\n  async getAdSceneTemplates(filters?: {\r\n    category?: string;\r\n    isGlobal?: boolean;\r\n    createdBy?: string;\r\n  }): Promise<AdSceneTemplate[]> {\r\n    return templateRepo.getAdSceneTemplates(filters);\r\n  }\r\n  async getAdSceneTemplateById(id: string): Promise<AdSceneTemplate | undefined> {\r\n    return templateRepo.getAdSceneTemplateById(id);\r\n  }\r\n  async updateAdSceneTemplate(id: string, updates: Partial<InsertAdSceneTemplate>): Promise<AdSceneTemplate> {\r\n    return templateRepo.updateAdSceneTemplate(id, updates);\r\n  }\r\n  async deleteAdSceneTemplate(id: string): Promise<void> {\r\n    return templateRepo.deleteAdSceneTemplate(id);\r\n  }\r\n  async searchAdSceneTemplates(query: string): Promise<AdSceneTemplate[]> {\r\n    return templateRepo.searchAdSceneTemplates(query);\r\n  }\r\n\r\n  // ============================================\r\n  // PERFORMING AD TEMPLATE OPERATIONS (extra methods not in IStorage)\r\n  // ============================================\r\n  async createPerformingAdTemplate(template: InsertPerformingAdTemplate): Promise<PerformingAdTemplate> {\r\n    return templateRepo.createPerformingAdTemplate(template);\r\n  }\r\n  async getPerformingAdTemplates(userId: string): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.getPerformingAdTemplates(userId);\r\n  }\r\n  async getPerformingAdTemplate(id: string): Promise<PerformingAdTemplate | undefined> {\r\n    return templateRepo.getPerformingAdTemplate(id);\r\n  }\r\n  async getPerformingAdTemplatesByCategory(userId: string, category: string): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.getPerformingAdTemplatesByCategory(userId, category);\r\n  }\r\n  async getPerformingAdTemplatesByPlatform(userId: string, platform: string): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.getPerformingAdTemplatesByPlatform(userId, platform);\r\n  }\r\n  async getFeaturedPerformingAdTemplates(userId: string): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.getFeaturedPerformingAdTemplates(userId);\r\n  }\r\n  async getTopPerformingAdTemplates(userId: string, limit: number = 10): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.getTopPerformingAdTemplates(userId, limit);\r\n  }\r\n  async updatePerformingAdTemplate(\r\n    id: string,\r\n    updates: Partial<InsertPerformingAdTemplate>,\r\n  ): Promise<PerformingAdTemplate> {\r\n    return templateRepo.updatePerformingAdTemplate(id, updates);\r\n  }\r\n  async deletePerformingAdTemplate(id: string): Promise<void> {\r\n    return templateRepo.deletePerformingAdTemplate(id);\r\n  }\r\n  async searchPerformingAdTemplates(\r\n    userId: string,\r\n    filters: {\r\n      category?: string;\r\n      platform?: string;\r\n      mood?: string;\r\n      style?: string;\r\n      engagementTier?: string;\r\n      industry?: string;\r\n      objective?: string;\r\n    },\r\n  ): Promise<PerformingAdTemplate[]> {\r\n    return templateRepo.searchPerformingAdTemplates(userId, filters);\r\n  }\r\n\r\n  // ============================================\r\n  // AD COPY OPERATIONS\r\n  // ============================================\r\n  async saveAdCopy(copy: InsertAdCopy): Promise<AdCopy> {\r\n    return copywritingRepo.saveAdCopy(copy);\r\n  }\r\n  async getAdCopyByGenerationId(generationId: string): Promise<AdCopy[]> {\r\n    return copywritingRepo.getAdCopyByGenerationId(generationId);\r\n  }\r\n  async getAdCopyById(id: string): Promise<AdCopy | undefined> {\r\n    return copywritingRepo.getAdCopyById(id);\r\n  }\r\n  async deleteAdCopy(id: string): Promise<void> {\r\n    return copywritingRepo.deleteAdCopy(id);\r\n  }\r\n  async getCopyVariations(parentCopyId: string): Promise<AdCopy[]> {\r\n    return copywritingRepo.getCopyVariations(parentCopyId);\r\n  }\r\n\r\n  // ============================================\r\n  // BRAND PROFILE OPERATIONS\r\n  // ============================================\r\n  async saveBrandProfile(profile: InsertBrandProfile): Promise<BrandProfile> {\r\n    return copywritingRepo.saveBrandProfile(profile);\r\n  }\r\n  async getBrandProfileByUserId(userId: string): Promise<BrandProfile | undefined> {\r\n    return copywritingRepo.getBrandProfileByUserId(userId);\r\n  }\r\n  async updateBrandProfile(userId: string, updates: Partial<InsertBrandProfile>): Promise<BrandProfile> {\r\n    return copywritingRepo.updateBrandProfile(userId, updates);\r\n  }\r\n  async deleteBrandProfile(userId: string): Promise<void> {\r\n    return copywritingRepo.deleteBrandProfile(userId);\r\n  }\r\n\r\n  // ============================================\r\n  // INSTALLATION SCENARIO OPERATIONS\r\n  // ============================================\r\n  async createInstallationScenario(scenario: InsertInstallationScenario): Promise<InstallationScenario> {\r\n    return knowledgeRepo.createInstallationScenario(scenario);\r\n  }\r\n  async getInstallationScenarioById(id: string): Promise<InstallationScenario | undefined> {\r\n    return knowledgeRepo.getInstallationScenarioById(id);\r\n  }\r\n  async getInstallationScenariosByUser(userId: string): Promise<InstallationScenario[]> {\r\n    return knowledgeRepo.getInstallationScenariosByUser(userId);\r\n  }\r\n  async getInstallationScenariosForProducts(productIds: string[]): Promise<InstallationScenario[]> {\r\n    return knowledgeRepo.getInstallationScenariosForProducts(productIds);\r\n  }\r\n  async getScenariosByRoomType(roomType: string): Promise<InstallationScenario[]> {\r\n    return knowledgeRepo.getScenariosByRoomType(roomType);\r\n  }\r\n  async updateInstallationScenario(\r\n    id: string,\r\n    updates: Partial<InsertInstallationScenario>,\r\n  ): Promise<InstallationScenario> {\r\n    return knowledgeRepo.updateInstallationScenario(id, updates);\r\n  }\r\n  async deleteInstallationScenario(id: string): Promise<void> {\r\n    return knowledgeRepo.deleteInstallationScenario(id);\r\n  }\r\n\r\n  // ============================================\r\n  // PRODUCT RELATIONSHIP OPERATIONS\r\n  // ============================================\r\n  async createProductRelationship(relationship: InsertProductRelationship): Promise<ProductRelationship> {\r\n    return knowledgeRepo.createProductRelationship(relationship);\r\n  }\r\n  async getProductRelationships(productIds: string[]): Promise<ProductRelationship[]> {\r\n    return knowledgeRepo.getProductRelationships(productIds);\r\n  }\r\n  async getProductRelationshipsByType(productId: string, relationshipType: string): Promise<ProductRelationship[]> {\r\n    return knowledgeRepo.getProductRelationshipsByType(productId, relationshipType);\r\n  }\r\n  async deleteProductRelationship(id: string): Promise<void> {\r\n    return knowledgeRepo.deleteProductRelationship(id);\r\n  }\r\n\r\n  // ============================================\r\n  // BRAND IMAGE OPERATIONS\r\n  // ============================================\r\n  async createBrandImage(image: InsertBrandImage): Promise<BrandImage> {\r\n    return knowledgeRepo.createBrandImage(image);\r\n  }\r\n  async getBrandImagesByUser(userId: string, limit?: number, offset?: number): Promise<BrandImage[]> {\r\n    return knowledgeRepo.getBrandImagesByUser(userId, limit, offset);\r\n  }\r\n  async getBrandImagesForProducts(productIds: string[], userId: string): Promise<BrandImage[]> {\r\n    return knowledgeRepo.getBrandImagesForProducts(productIds, userId);\r\n  }\r\n  async getBrandImagesByCategory(userId: string, category: string): Promise<BrandImage[]> {\r\n    return knowledgeRepo.getBrandImagesByCategory(userId, category);\r\n  }\r\n  async updateBrandImage(id: string, updates: Partial<InsertBrandImage>): Promise<BrandImage> {\r\n    return knowledgeRepo.updateBrandImage(id, updates);\r\n  }\r\n  async deleteBrandImage(id: string): Promise<void> {\r\n    return knowledgeRepo.deleteBrandImage(id);\r\n  }\r\n\r\n  // ============================================\r\n  // QUOTA MONITORING OPERATIONS\r\n  // ============================================\r\n  async upsertQuotaMetrics(metrics: InsertGeminiQuotaMetrics): Promise<GeminiQuotaMetrics> {\r\n    return quotaRepo.upsertQuotaMetrics(metrics);\r\n  }\r\n  async getQuotaMetrics(params: {\r\n    brandId: string;\r\n    windowType: string;\r\n    startDate: Date;\r\n    endDate: Date;\r\n  }): Promise<GeminiQuotaMetrics[]> {\r\n    return quotaRepo.getQuotaMetrics(params);\r\n  }\r\n  async getLatestQuotaMetric(brandId: string, windowType: string): Promise<GeminiQuotaMetrics | undefined> {\r\n    return quotaRepo.getLatestQuotaMetric(brandId, windowType);\r\n  }\r\n  async createRateLimitEvent(event: InsertGeminiRateLimitEvent): Promise<GeminiRateLimitEvent> {\r\n    return quotaRepo.createRateLimitEvent(event);\r\n  }\r\n  async getRecentRateLimitEvents(brandId: string, minutes: number): Promise<GeminiRateLimitEvent[]> {\r\n    return quotaRepo.getRecentRateLimitEvents(brandId, minutes);\r\n  }\r\n  async getQuotaAlerts(brandId: string): Promise<GeminiQuotaAlert[]> {\r\n    return quotaRepo.getQuotaAlerts(brandId);\r\n  }\r\n  async upsertQuotaAlert(alert: InsertGeminiQuotaAlert): Promise<GeminiQuotaAlert> {\r\n    return quotaRepo.upsertQuotaAlert(alert);\r\n  }\r\n  async updateQuotaAlertTrigger(id: string): Promise<void> {\r\n    return quotaRepo.updateQuotaAlertTrigger(id);\r\n  }\r\n\r\n  // ============================================\r\n  // GOOGLE CLOUD MONITORING SYNC OPERATIONS\r\n  // ============================================\r\n  async saveGoogleQuotaSnapshot(snapshot: InsertGoogleQuotaSnapshot): Promise<GoogleQuotaSnapshot> {\r\n    return quotaRepo.saveGoogleQuotaSnapshot(snapshot);\r\n  }\r\n  async getLatestGoogleQuotaSnapshot(brandId?: string): Promise<GoogleQuotaSnapshot | undefined> {\r\n    return quotaRepo.getLatestGoogleQuotaSnapshot(brandId);\r\n  }\r\n  async getGoogleQuotaSnapshotHistory(params: {\r\n    brandId?: string;\r\n    startDate: Date;\r\n    endDate: Date;\r\n    limit?: number;\r\n  }): Promise<GoogleQuotaSnapshot[]> {\r\n    return quotaRepo.getGoogleQuotaSnapshotHistory(params);\r\n  }\r\n  async createSyncHistoryEntry(entry: InsertGoogleQuotaSyncHistory): Promise<GoogleQuotaSyncHistory> {\r\n    return quotaRepo.createSyncHistoryEntry(entry);\r\n  }\r\n  async updateSyncHistoryEntry(\r\n    id: string,\r\n    updates: Partial<InsertGoogleQuotaSyncHistory>,\r\n  ): Promise<GoogleQuotaSyncHistory> {\r\n    return quotaRepo.updateSyncHistoryEntry(id, updates);\r\n  }\r\n  async getRecentSyncHistory(limit?: number): Promise<GoogleQuotaSyncHistory[]> {\r\n    return quotaRepo.getRecentSyncHistory(limit);\r\n  }\r\n\r\n  // ============================================\r\n  // API KEY MANAGEMENT OPERATIONS\r\n  // ============================================\r\n  async getUserApiKey(userId: string, service: string): Promise<UserApiKey | null> {\r\n    return apiKeyRepo.getUserApiKey(userId, service);\r\n  }\r\n  async getAllUserApiKeys(userId: string): Promise<UserApiKey[]> {\r\n    return apiKeyRepo.getAllUserApiKeys(userId);\r\n  }\r\n  async saveUserApiKey(data: {\r\n    userId: string;\r\n    service: string;\r\n    encryptedKey: string;\r\n    iv: string;\r\n    authTag: string;\r\n    keyPreview: string;\r\n    isValid?: boolean;\r\n  }): Promise<UserApiKey> {\r\n    return apiKeyRepo.saveUserApiKey(data);\r\n  }\r\n  async updateUserApiKeyValidity(userId: string, service: string, isValid: boolean): Promise<void> {\r\n    return apiKeyRepo.updateUserApiKeyValidity(userId, service, isValid);\r\n  }\r\n  async deleteUserApiKey(userId: string, service: string): Promise<void> {\r\n    return apiKeyRepo.deleteUserApiKey(userId, service);\r\n  }\r\n  async logApiKeyAction(entry: {\r\n    userId: string;\r\n    service: string;\r\n    action: 'create' | 'update' | 'delete' | 'validate' | 'use';\r\n    ipAddress?: string;\r\n    userAgent?: string;\r\n    success: boolean;\r\n    errorMessage?: string;\r\n  }): Promise<void> {\r\n    return apiKeyRepo.logApiKeyAction(entry);\r\n  }\r\n  async getApiKeyAuditLog(userId: string, service?: string, limit?: number): Promise<ApiKeyAuditLog[]> {\r\n    return apiKeyRepo.getApiKeyAuditLog(userId, service, limit);\r\n  }\r\n  async resolveApiKey(\r\n    userId: string,\r\n    service: string,\r\n  ): Promise<{ key: string | null; source: 'user' | 'environment' | 'none' }> {\r\n    return apiKeyRepo.resolveApiKey(userId, service);\r\n  }\r\n\r\n  // ============================================\r\n  // N8N CONFIGURATION VAULT\r\n  // ============================================\r\n  async saveN8nConfig(userId: string, baseUrl: string, apiKey?: string): Promise<void> {\r\n    return apiKeyRepo.saveN8nConfig(userId, baseUrl, apiKey);\r\n  }\r\n  async getN8nConfig(userId: string): Promise<{ baseUrl: string; apiKey?: string } | null> {\r\n    return apiKeyRepo.getN8nConfig(userId);\r\n  }\r\n  async deleteN8nConfig(userId: string): Promise<void> {\r\n    return apiKeyRepo.deleteN8nConfig(userId);\r\n  }\r\n\r\n  // ============================================\r\n  // SOCIAL CONNECTION OPERATIONS\r\n  // ============================================\r\n  async getSocialConnections(userId: string): Promise<SocialConnection[]> {\r\n    return socialRepo.getSocialConnections(userId);\r\n  }\r\n  async getSocialConnectionById(id: string): Promise<SocialConnection | null> {\r\n    return socialRepo.getSocialConnectionById(id);\r\n  }\r\n  async getSocialConnectionByPlatform(userId: string, platform: string): Promise<SocialConnection | null> {\r\n    return socialRepo.getSocialConnectionByPlatform(userId, platform);\r\n  }\r\n  async createSocialConnection(data: InsertSocialConnection): Promise<SocialConnection> {\r\n    return socialRepo.createSocialConnection(data);\r\n  }\r\n  async updateSocialConnection(id: string, updates: Partial<SocialConnection>): Promise<SocialConnection> {\r\n    return socialRepo.updateSocialConnection(id, updates);\r\n  }\r\n  async deleteSocialConnection(id: string): Promise<void> {\r\n    return socialRepo.deleteSocialConnection(id);\r\n  }\r\n\r\n  // ============================================\r\n  // LEARN FROM WINNERS - PATTERN OPERATIONS\r\n  // ============================================\r\n  async createLearnedPattern(pattern: InsertLearnedAdPattern): Promise<LearnedAdPattern> {\r\n    return patternRepo.createLearnedPattern(pattern);\r\n  }\r\n  async getLearnedPatterns(\r\n    userId: string,\r\n    filters?: {\r\n      category?: string;\r\n      platform?: string;\r\n      industry?: string;\r\n      isActive?: boolean;\r\n    },\r\n  ): Promise<LearnedAdPattern[]> {\r\n    return patternRepo.getLearnedPatterns(userId, filters);\r\n  }\r\n  async getLearnedPatternById(id: string): Promise<LearnedAdPattern | undefined> {\r\n    return patternRepo.getLearnedPatternById(id);\r\n  }\r\n  async getLearnedPatternByHash(userId: string, sourceHash: string): Promise<LearnedAdPattern | undefined> {\r\n    return patternRepo.getLearnedPatternByHash(userId, sourceHash);\r\n  }\r\n  async updateLearnedPattern(id: string, updates: Partial<InsertLearnedAdPattern>): Promise<LearnedAdPattern> {\r\n    return patternRepo.updateLearnedPattern(id, updates);\r\n  }\r\n  async deleteLearnedPattern(id: string): Promise<void> {\r\n    return patternRepo.deleteLearnedPattern(id);\r\n  }\r\n  async incrementPatternUsage(id: string): Promise<void> {\r\n    return patternRepo.incrementPatternUsage(id);\r\n  }\r\n  async createUploadRecord(upload: InsertAdAnalysisUpload): Promise<AdAnalysisUpload> {\r\n    return patternRepo.createUploadRecord(upload);\r\n  }\r\n  async getUploadById(id: string): Promise<AdAnalysisUpload | undefined> {\r\n    return patternRepo.getUploadById(id);\r\n  }\r\n  async updateUploadStatus(id: string, status: string, errorMessage?: string): Promise<AdAnalysisUpload> {\r\n    return patternRepo.updateUploadStatus(id, status, errorMessage);\r\n  }\r\n  async updateUploadWithPattern(\r\n    id: string,\r\n    patternId: string,\r\n    processingDurationMs: number,\r\n  ): Promise<AdAnalysisUpload> {\r\n    return patternRepo.updateUploadWithPattern(id, patternId, processingDurationMs);\r\n  }\r\n  async getExpiredUploads(): Promise<AdAnalysisUpload[]> {\r\n    return patternRepo.getExpiredUploads();\r\n  }\r\n  async deleteUpload(id: string): Promise<void> {\r\n    return patternRepo.deleteUpload(id);\r\n  }\r\n  async createApplicationHistory(history: InsertPatternApplicationHistory): Promise<PatternApplicationHistory> {\r\n    return patternRepo.createApplicationHistory(history);\r\n  }\r\n  async getPatternApplicationHistory(patternId: string): Promise<PatternApplicationHistory[]> {\r\n    return patternRepo.getPatternApplicationHistory(patternId);\r\n  }\r\n  async updateApplicationFeedback(\r\n    id: string,\r\n    rating: number,\r\n    wasUsed: boolean,\r\n    feedback?: string,\r\n  ): Promise<PatternApplicationHistory> {\r\n    return patternRepo.updateApplicationFeedback(id, rating, wasUsed, feedback);\r\n  }\r\n\r\n  // ============================================\r\n  // CONTENT PLANNER OPERATIONS\r\n  // ============================================\r\n  async createContentPlannerPost(post: InsertContentPlannerPost): Promise<ContentPlannerPost> {\r\n    return planningRepo.createContentPlannerPost(post);\r\n  }\r\n  async getContentPlannerPostById(id: string): Promise<ContentPlannerPost | null> {\r\n    return planningRepo.getContentPlannerPostById(id);\r\n  }\r\n  async getContentPlannerPostsByUser(userId: string, startDate?: Date, endDate?: Date): Promise<ContentPlannerPost[]> {\r\n    return planningRepo.getContentPlannerPostsByUser(userId, startDate, endDate);\r\n  }\r\n  async getWeeklyBalance(userId: string): Promise<{ category: string; count: number }[]> {\r\n    return planningRepo.getWeeklyBalance(userId);\r\n  }\r\n  async deleteContentPlannerPost(id: string): Promise<void> {\r\n    return planningRepo.deleteContentPlannerPost(id);\r\n  }\r\n\r\n  // ============================================\r\n  // APPROVAL QUEUE OPERATIONS\r\n  // ============================================\r\n  async createApprovalQueue(data: InsertApprovalQueue): Promise<ApprovalQueue> {\r\n    return approvalRepo.createApprovalQueue(data);\r\n  }\r\n  async getApprovalQueue(id: string): Promise<ApprovalQueue | null> {\r\n    return approvalRepo.getApprovalQueue(id);\r\n  }\r\n  async getApprovalQueueForUser(\r\n    userId: string,\r\n    filters?: {\r\n      status?: string;\r\n      priority?: string;\r\n      platform?: string;\r\n      dateFrom?: Date;\r\n      dateTo?: Date;\r\n    },\r\n  ): Promise<ApprovalQueue[]> {\r\n    return approvalRepo.getApprovalQueueForUser(userId, filters);\r\n  }\r\n  async updateApprovalQueue(id: string, updates: Partial<ApprovalQueue>): Promise<ApprovalQueue> {\r\n    return approvalRepo.updateApprovalQueue(id, updates);\r\n  }\r\n  async deleteApprovalQueue(id: string): Promise<void> {\r\n    return approvalRepo.deleteApprovalQueue(id);\r\n  }\r\n  async createApprovalAuditLog(data: InsertApprovalAuditLog): Promise<ApprovalAuditLog> {\r\n    return approvalRepo.createApprovalAuditLog(data);\r\n  }\r\n  async getApprovalAuditLog(approvalQueueId: string): Promise<ApprovalAuditLog[]> {\r\n    return approvalRepo.getApprovalAuditLog(approvalQueueId);\r\n  }\r\n  async getApprovalSettings(userId: string): Promise<ApprovalSettings | null> {\r\n    return approvalRepo.getApprovalSettings(userId);\r\n  }\r\n  async updateApprovalSettings(userId: string, settings: Partial<ApprovalSettings>): Promise<ApprovalSettings> {\r\n    return approvalRepo.updateApprovalSettings(userId, settings);\r\n  }\r\n\r\n  // ============================================\r\n  // STYLE REFERENCE OPERATIONS\r\n  // ============================================\r\n  async createStyleReference(data: InsertStyleReference): Promise<StyleReference> {\r\n    return styleReferenceRepo.createStyleReference(data);\r\n  }\r\n  async getStyleReferencesByUser(userId: string, limit?: number, offset?: number): Promise<StyleReference[]> {\r\n    return styleReferenceRepo.getStyleReferencesByUser(userId, limit, offset);\r\n  }\r\n  async getStyleReferenceById(id: string): Promise<StyleReference | undefined> {\r\n    return styleReferenceRepo.getStyleReferenceById(id);\r\n  }\r\n  async getStyleReferencesByCategory(userId: string, category: string): Promise<StyleReference[]> {\r\n    return styleReferenceRepo.getStyleReferencesByCategory(userId, category);\r\n  }\r\n  async updateStyleReference(id: string, updates: Partial<InsertStyleReference>): Promise<StyleReference> {\r\n    return styleReferenceRepo.updateStyleReference(id, updates);\r\n  }\r\n  async deleteStyleReference(id: string): Promise<void> {\r\n    return styleReferenceRepo.deleteStyleReference(id);\r\n  }\r\n  async incrementStyleReferenceUsage(id: string): Promise<void> {\r\n    return styleReferenceRepo.incrementUsageCount(id);\r\n  }\r\n  async getStyleReferencesByIds(ids: string[]): Promise<StyleReference[]> {\r\n    return styleReferenceRepo.getStyleReferencesByIds(ids);\r\n  }\r\n\r\n  // ============================================\r\n  // CUSTOM MODEL TRAINING OPERATIONS\r\n  // ============================================\r\n  async createTrainingDataset(data: InsertTrainingDataset): Promise<TrainingDataset> {\r\n    return trainingRepo.createTrainingDataset(data);\r\n  }\r\n  async getTrainingDatasetById(id: string): Promise<TrainingDataset | undefined> {\r\n    return trainingRepo.getTrainingDatasetById(id);\r\n  }\r\n  async getTrainingDatasetsByUser(userId: string): Promise<TrainingDataset[]> {\r\n    return trainingRepo.getTrainingDatasetsByUser(userId);\r\n  }\r\n  async updateTrainingDataset(id: string, updates: Partial<InsertTrainingDataset>): Promise<TrainingDataset> {\r\n    return trainingRepo.updateTrainingDataset(id, updates);\r\n  }\r\n  async deleteTrainingDataset(id: string): Promise<void> {\r\n    return trainingRepo.deleteTrainingDataset(id);\r\n  }\r\n  async createTrainingExample(data: InsertTrainingExample): Promise<TrainingExample> {\r\n    return trainingRepo.createTrainingExample(data);\r\n  }\r\n  async getTrainingExamples(datasetId: string): Promise<TrainingExample[]> {\r\n    return trainingRepo.getTrainingExamples(datasetId);\r\n  }\r\n  async deleteTrainingExample(id: string): Promise<void> {\r\n    return trainingRepo.deleteTrainingExample(id);\r\n  }\r\n\r\n  // ============================================\r\n  // BRAND DNA OPERATIONS (Phase 5)\r\n  // ============================================\r\n  async getBrandDNA(userId: string): Promise<BrandDNA | null> {\r\n    return intelligenceRepo.getBrandDNA(userId);\r\n  }\r\n  async upsertBrandDNA(userId: string, data: Partial<InsertBrandDNA>): Promise<BrandDNA> {\r\n    return intelligenceRepo.upsertBrandDNA(userId, data);\r\n  }\r\n\r\n  // ============================================\r\n  // GENERATION PERFORMANCE OPERATIONS (Phase 5)\r\n  // ============================================\r\n  async getGenerationPerformance(generationId: string): Promise<GenerationPerformance[]> {\r\n    return intelligenceRepo.getGenerationPerformance(generationId);\r\n  }\r\n  async saveGenerationPerformance(data: InsertGenerationPerformance): Promise<GenerationPerformance> {\r\n    return intelligenceRepo.saveGenerationPerformance(data);\r\n  }\r\n}\r\n\r\nexport const storage = new DbStorage();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\types\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\types\\express-session.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\types\\generationPipeline.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3235,3238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3235,3238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3309,3312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3309,3312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\n/**\r\n * Generation Pipeline Types\r\n *\r\n * Type definitions for the systematic image generation pipeline.\r\n * All context sources flow through a shared GenerationContext object.\r\n */\r\n\r\nimport type { GenerationRecipe } from '@shared/types/ideaBank';\r\n\r\n// ============================================\r\n// INPUT TYPES\r\n// ============================================\r\n\r\nexport interface ImageInput {\r\n  buffer: Buffer;\r\n  mimetype: string;\r\n  originalname: string;\r\n}\r\n\r\nexport type GenerationMode = 'standard' | 'exact_insert' | 'inspiration';\r\n\r\nexport interface GenerationInput {\r\n  prompt: string;\r\n  mode: GenerationMode;\r\n  images: ImageInput[];\r\n  templateId?: string;\r\n  templateReferenceUrls?: string[];\r\n  recipe?: GenerationRecipe;\r\n  styleReferenceIds?: string[];\r\n  resolution: '1K' | '2K' | '4K';\r\n  userId: string;\r\n  aspectRatio?: string; // e.g. '1:1', '4:5', '16:9'\r\n  platform?: string; // Target platform: instagram, linkedin, tiktok, facebook, twitter\r\n  productIds?: string[]; // Product IDs for Stage 2 context\r\n}\r\n\r\n// ============================================\r\n// CONTEXT TYPES (populated by pipeline stages)\r\n// ============================================\r\n\r\nexport interface ProductContext {\r\n  primaryId: string;\r\n  primaryName: string;\r\n  category?: string;\r\n  description?: string;\r\n  relationships: Array<{\r\n    targetProductName: string;\r\n    relationshipType: string;\r\n    description?: string;\r\n  }>;\r\n  scenarios: Array<{\r\n    title: string;\r\n    description: string;\r\n    steps?: string[];\r\n    isActive: boolean;\r\n  }>;\r\n  brandImages: Array<{\r\n    imageUrl: string;\r\n    category: string;\r\n  }>;\r\n  formattedContext: string;\r\n}\r\n\r\nexport interface BrandContext {\r\n  name: string;\r\n  styles: string[];\r\n  values: string[];\r\n  colors: string[];\r\n  voicePrinciples: string[];\r\n}\r\n\r\nexport interface StyleContext {\r\n  directive: string;\r\n  referenceCount: number;\r\n}\r\n\r\nexport interface VisionContext {\r\n  category: string;\r\n  materials: string[];\r\n  colors: string[];\r\n  style: string;\r\n  usageContext: string;\r\n}\r\n\r\nexport interface KBContext {\r\n  context: string;\r\n  citations: string[];\r\n}\r\n\r\nexport interface PatternsContext {\r\n  directive: string;\r\n  patternCount: number;\r\n}\r\n\r\nexport interface TemplateContext {\r\n  id: string;\r\n  title: string;\r\n  blueprint: string;\r\n  mood: string;\r\n  lighting: string;\r\n  environment: string;\r\n  placementHints: Record<string, unknown>;\r\n  category: string;\r\n  referenceImageUrls: string[];\r\n}\r\n\r\n// ============================================\r\n// MAIN CONTEXT OBJECT\r\n// ============================================\r\n\r\nexport interface BrandDNAContext {\r\n  visualSignature?: string;\r\n  toneGuidance?: string;\r\n  contentRules?: string;\r\n}\r\n\r\nexport interface GenerationContext {\r\n  input: GenerationInput;\r\n  product?: ProductContext;\r\n  brand?: BrandContext;\r\n  brandDNA?: BrandDNAContext;\r\n  style?: StyleContext;\r\n  vision?: VisionContext;\r\n  kb?: KBContext;\r\n  patterns?: PatternsContext;\r\n  template?: TemplateContext;\r\n  assembled?: {\r\n    finalPrompt: string;\r\n    imageParts: Array<{ inlineData: { mimeType: string; data: string } }>;\r\n  };\r\n  result?: {\r\n    imageBase64: string;\r\n    mimeType: string;\r\n    conversationHistory: any[];\r\n    usageMetadata?: Record<string, unknown>;\r\n    modelResponse?: any;\r\n  };\r\n}\r\n\r\n// ============================================\r\n// CRITIQUE TYPES (populated by critic stage)\r\n// ============================================\r\n\r\nexport interface CritiqueResult {\r\n  /** Whether the image passed quality checks */\r\n  passed: boolean;\r\n  /** Overall quality score 0-100 */\r\n  score: number;\r\n  /** Specific check results */\r\n  checks: {\r\n    productVisible: boolean;\r\n    brandConsistent: boolean;\r\n    compositionGood: boolean;\r\n    promptFaithful: boolean;\r\n  };\r\n  /** Short summary of issues found */\r\n  issues: string[];\r\n  /** Revised prompt suggestion if needs retry */\r\n  revisedPrompt?: string;\r\n}\r\n\r\n// ============================================\r\n// RESULT TYPES\r\n// ============================================\r\n\r\nexport interface GenerationResult {\r\n  generationId: string;\r\n  imageUrl: string;\r\n  prompt: string;\r\n  canEdit: boolean;\r\n  mode: GenerationMode;\r\n  templateId?: string;\r\n  stagesCompleted: string[];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\types\\router.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3064,3067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3064,3067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Router Types - Dependency Injection Pattern for Modular Routing\r\n * Sprint 2, Week 1, Days 3-5 - Task 2.3\r\n */\r\n\r\nimport { Router, RequestHandler } from 'express';\r\nimport { ZodSchema } from 'zod';\r\nimport type { IStorage } from '../storage';\r\nimport type { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport type { v2 as cloudinaryType } from 'cloudinary';\r\nimport type { Logger } from 'pino';\r\nimport type multer from 'multer';\r\n\r\n/**\r\n * Core services available to all routers\r\n */\r\nexport interface RouterServices {\r\n  /** Database/storage operations */\r\n  storage: IStorage;\r\n\r\n  /** Gemini AI client for text operations */\r\n  genAIText: GoogleGenerativeAI;\r\n\r\n  /** Gemini AI client for image operations */\r\n  genAIImage: GoogleGenerativeAI;\r\n\r\n  /** Cloudinary client (may be null if not configured) */\r\n  cloudinary: typeof cloudinaryType | null;\r\n\r\n  /** Structured logger instance */\r\n  logger: Logger;\r\n\r\n  /** Generation queue for async jobs */\r\n  generationQueue: typeof import('../lib/queue').generationQueue;\r\n\r\n  /** Queue events for SSE streaming */\r\n  generationQueueEvents: typeof import('../lib/queue').generationQueueEvents;\r\n\r\n  /** Telemetry for tracking */\r\n  telemetry: typeof import('../instrumentation').telemetry;\r\n\r\n  /** Database pool for raw queries */\r\n  pool: typeof import('../db').pool;\r\n}\r\n\r\n/**\r\n * Domain-specific services (lazy loaded)\r\n */\r\nexport interface RouterDomainServices {\r\n  /** Vision analysis for product images */\r\n  visionAnalysis: typeof import('../services/visionAnalysisService').visionAnalysisService;\r\n\r\n  /** Idea bank orchestration */\r\n  ideaBank: typeof import('../services/ideaBankService').ideaBankService;\r\n\r\n  /** Product knowledge base */\r\n  productKnowledge: typeof import('../services/productKnowledgeService').productKnowledgeService;\r\n\r\n  /** Quota monitoring */\r\n  quotaMonitoring: typeof import('../services/quotaMonitoringService').quotaMonitoringService;\r\n\r\n  /** Installation scenario RAG */\r\n  installationRAG: typeof import('../services/installationScenarioRAG');\r\n\r\n  /** Relationship discovery RAG */\r\n  relationshipRAG: typeof import('../services/relationshipDiscoveryRAG');\r\n\r\n  /** Brand image recommendation RAG */\r\n  brandImageRAG: typeof import('../services/brandImageRecommendationRAG').brandImageRecommendationRAG;\r\n\r\n  /** Template pattern matching RAG */\r\n  templatePatternRAG: typeof import('../services/templatePatternRAG');\r\n\r\n  /** Pattern extraction service */\r\n  patternExtraction: typeof import('../services/patternExtractionService');\r\n\r\n  /** Encryption service for API keys */\r\n  encryption: typeof import('../services/encryptionService');\r\n\r\n  /** API key validation */\r\n  apiKeyValidation: typeof import('../services/apiKeyValidationService');\r\n\r\n  /** Authentication service */\r\n  authService: typeof import('../services/authService').authService;\r\n\r\n  /** Pricing estimator */\r\n  pricingEstimator: typeof import('../services/pricingEstimator');\r\n\r\n  /** Google Cloud Monitoring (optional, lazy loaded) */\r\n  getGoogleCloudService: () => Promise<any>;\r\n}\r\n\r\n/**\r\n * Middleware functions available to routers\r\n */\r\nexport interface RouterMiddleware {\r\n  /** Require authenticated user */\r\n  requireAuth: RequestHandler;\r\n\r\n  /** Optional authentication (sets req.user if token present) */\r\n  optionalAuth: RequestHandler;\r\n\r\n  /** Validate request body/params against Zod schema */\r\n  validate: (schema: ZodSchema) => RequestHandler;\r\n\r\n  /** Extended timeout for long operations (5 minutes) */\r\n  extendedTimeout: RequestHandler;\r\n\r\n  /** Halt processing if request timed out */\r\n  haltOnTimeout: RequestHandler;\r\n\r\n  /** Validate N8N webhook signature */\r\n  validateN8nWebhook: RequestHandler;\r\n\r\n  /** File type validation for uploads */\r\n  validateFileType: RequestHandler;\r\n\r\n  /** Pattern upload rate limiter */\r\n  uploadPatternLimiter: RequestHandler;\r\n\r\n  /** Check pattern quota before upload */\r\n  checkPatternQuota: RequestHandler;\r\n\r\n  /** Create custom rate limiter */\r\n  createRateLimiter: typeof import('../middleware/rateLimit').createRateLimiter;\r\n}\r\n\r\n/**\r\n * Multer upload configurations\r\n */\r\nexport interface RouterUploads {\r\n  /** Standard upload instance (10MB, 6 files) */\r\n  standard: multer.Multer;\r\n\r\n  /** Single file upload middleware */\r\n  single: (fieldName: string) => RequestHandler;\r\n\r\n  /** Array of files upload middleware */\r\n  array: (fieldName: string, maxCount: number) => RequestHandler;\r\n}\r\n\r\n/**\r\n * Validation schemas available to routers\r\n */\r\nexport interface RouterSchemas {\r\n  insertGeneration: ZodSchema;\r\n  insertProduct: ZodSchema;\r\n  insertPromptTemplate: ZodSchema;\r\n  insertInstallationScenario: ZodSchema;\r\n  insertProductRelationship: ZodSchema;\r\n  saveApiKey: ZodSchema;\r\n  uploadPattern: ZodSchema;\r\n  updatePattern: ZodSchema;\r\n  applyPattern: ZodSchema;\r\n  ratePattern: ZodSchema;\r\n  listPatternsQuery: ZodSchema;\r\n  generateCompletePost: ZodSchema;\r\n  saveN8nConfig: ZodSchema;\r\n  n8nCallback: ZodSchema;\r\n  syncAccount: ZodSchema;\r\n}\r\n\r\n/**\r\n * Utility functions for route handlers\r\n */\r\nexport interface RouterUtils {\r\n  /** Save original file to storage */\r\n  saveOriginalFile: typeof import('../fileStorage').saveOriginalFile;\r\n\r\n  /** Save generated image */\r\n  saveGeneratedImage: typeof import('../fileStorage').saveGeneratedImage;\r\n\r\n  /** Delete file from storage */\r\n  deleteFile: typeof import('../fileStorage').deleteFile;\r\n\r\n  /** Convert generation to DTO */\r\n  toGenerationDTO: typeof import('../dto/generationDTO').toGenerationDTO;\r\n\r\n  /** Convert generation array to DTO array */\r\n  toGenerationDTOArray: typeof import('../dto/generationDTO').toGenerationDTOArray;\r\n\r\n  /** Check if server is shutting down */\r\n  isServerShuttingDown: typeof import('../utils/gracefulShutdown').isServerShuttingDown;\r\n}\r\n\r\n/**\r\n * Complete router context with all dependencies\r\n */\r\nexport interface RouterContext {\r\n  services: RouterServices;\r\n  domainServices: RouterDomainServices;\r\n  middleware: RouterMiddleware;\r\n  uploads: RouterUploads;\r\n  schemas: RouterSchemas;\r\n  utils: RouterUtils;\r\n}\r\n\r\n/**\r\n * Router factory function signature\r\n */\r\nexport type RouterFactory = (ctx: RouterContext) => Router;\r\n\r\n/**\r\n * Router module metadata for registration\r\n */\r\nexport interface RouterModule {\r\n  /** URL prefix for all routes (e.g., '/api/auth') */\r\n  prefix: string;\r\n\r\n  /** Factory function that creates the router */\r\n  factory: RouterFactory;\r\n\r\n  /** Human-readable description */\r\n  description: string;\r\n\r\n  /** Number of endpoints in this router */\r\n  endpointCount: number;\r\n\r\n  /** Whether router requires authentication for all routes */\r\n  requiresAuth?: boolean;\r\n\r\n  /** Tags for documentation/organization */\r\n  tags?: string[];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\utils\\gracefulShutdown.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\utils\\memoryManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\validation\\llmResponseSchemas.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'parseError' is defined but never used.","line":183,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":183,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from 'zod';\r\nimport { logger } from '../lib/logger';\r\n\r\n/**\r\n * Zod schemas for validating LLM JSON responses.\r\n * Replaces all bare JSON.parse() + `as Type` casts with runtime validation.\r\n *\r\n * Usage:\r\n *   const result = safeParseLLMResponse(jsonString, ideaSuggestionArraySchema, 'idea_suggestion');\r\n */\r\n\r\n//  Idea Bank Suggestions \r\n\r\nexport const ideaSuggestionSchema = z.object({\r\n  summary: z.string().optional(),\r\n  prompt: z.string(),\r\n  mode: z.string(),\r\n  templateId: z.string().optional(),\r\n  reasoning: z.string(),\r\n  confidence: z.number().min(0).max(100).default(70),\r\n  recommendedPlatform: z.string().optional(),\r\n  recommendedAspectRatio: z.string().optional(),\r\n});\r\n\r\nexport const ideaSuggestionArraySchema = z.array(ideaSuggestionSchema);\r\n\r\n//  Copywriting Service \r\n\r\nexport const generatedCopySchema = z.object({\r\n  headline: z.string().default(''),\r\n  hook: z.string().default(''),\r\n  bodyText: z.string().default(''),\r\n  caption: z.string().default(''),\r\n  cta: z.string().optional(),\r\n  hashtags: z.array(z.string()).optional(),\r\n  framework: z.string().optional(),\r\n});\r\n\r\n//  Vision Analysis \r\n\r\nexport const visionAnalysisSchema = z.object({\r\n  category: z.string().default('unknown'),\r\n  subcategory: z.string().default('unknown'),\r\n  materials: z.array(z.string()).default([]),\r\n  colors: z.array(z.string()).default([]),\r\n  style: z.string().default('unknown'),\r\n  usageContext: z.string().default(''),\r\n  targetDemographic: z.string().default(''),\r\n  detectedText: z.string().nullable().default(null),\r\n  confidence: z.number().min(0).max(100).default(80),\r\n});\r\n\r\n//  Confidence Scoring \r\n\r\nexport const brandVoiceAlignmentSchema = z.object({\r\n  alignmentScore: z.number().min(0).max(100),\r\n  reasoning: z.string(),\r\n});\r\n\r\n//  Carousel Outline \r\n\r\nexport const carouselSlideSchema = z.object({\r\n  purpose: z.string().default('point'),\r\n  headline: z.string().default(''),\r\n  body: z.string().default(''),\r\n  imagePrompt: z.string().default(''),\r\n});\r\n\r\nexport const carouselOutlineSchema = z.object({\r\n  title: z.string().default(''),\r\n  description: z.string().default(''),\r\n  slides: z.array(carouselSlideSchema).default([]),\r\n  captionCopy: z.string().default(''),\r\n  hashtags: z.array(z.string()).optional(),\r\n});\r\n\r\n//  Pattern Extraction \r\n\r\nexport const extractedPatternSchema = z.object({\r\n  layoutPattern: z.record(z.string(), z.unknown()).default({}),\r\n  colorPsychology: z.record(z.string(), z.unknown()).default({}),\r\n  hookPatterns: z.record(z.string(), z.unknown()).default({}),\r\n  visualElements: z.record(z.string(), z.unknown()).default({}),\r\n  confidenceScore: z.number().min(0).max(1).default(0.8),\r\n});\r\n\r\n//  Enrichment AI Helpers \r\n\r\nexport const enrichmentComparisonSchema = z.object({\r\n  isMatch: z.boolean().default(false),\r\n  confidence: z.number().min(0).max(1).default(0),\r\n  matchedAttributes: z.array(z.string()).default([]),\r\n  reasoning: z.string().default(''),\r\n});\r\n\r\nexport const enrichmentExtractionSchema = z.record(z.string(), z.unknown());\r\n\r\n//  Template Pattern RAG \r\n\r\nexport const templateAnalysisSchema = z.object({\r\n  templateType: z.string().default('unknown'),\r\n  elements: z.array(z.string()).default([]),\r\n  mood: z.string().default(''),\r\n  effectiveness: z.number().min(0).max(100).default(50),\r\n});\r\n\r\n//  Privacy Filter \r\n\r\nexport const privacyScanResultSchema = z.object({\r\n  containsPII: z.boolean().default(false),\r\n  detectedPII: z.array(z.string()).default([]),\r\n  containsText: z.boolean().default(false),\r\n  detectedText: z.array(z.string()).default([]),\r\n  riskLevel: z.enum(['low', 'medium', 'high']).default('low'),\r\n});\r\n\r\n//  Relationship Discovery \r\n\r\nexport const relationshipDiscoverySchema = z.object({\r\n  relationships: z.array(z.object({\r\n    type: z.string(),\r\n    sourceId: z.string().optional(),\r\n    targetId: z.string().optional(),\r\n    confidence: z.number().min(0).max(1).default(0),\r\n    reasoning: z.string().default(''),\r\n  })).default([]),\r\n});\r\n\r\n//  Installation Scenario RAG \r\n\r\nexport const installationMatchSchema = z.object({\r\n  matches: z.array(z.object({\r\n    scenarioId: z.string().optional(),\r\n    relevance: z.number().min(0).max(1).default(0),\r\n    reasoning: z.string().default(''),\r\n  })).default([]),\r\n});\r\n\r\n//  Product Enrichment \r\n\r\nexport const productEnrichmentSchema = z.record(z.string(), z.unknown());\r\n\r\n//  Source Discovery \r\n\r\nexport const sourceDiscoverySchema = z.array(z.object({\r\n  url: z.string(),\r\n  type: z.string().default('unknown'),\r\n  confidence: z.number().min(0).max(1).default(0),\r\n}));\r\n\r\n\r\n//  Safe Parse Helper \r\n\r\n/**\r\n * Safely parse an LLM JSON response with Zod validation.\r\n * Extracts JSON from the text, parses it, and validates against the schema.\r\n * Returns the validated data or throws a descriptive error.\r\n */\r\nexport function safeParseLLMResponse<T extends z.ZodType>(\r\n  text: string,\r\n  schema: T,\r\n  context: string,\r\n): z.infer<T> {\r\n  // Extract JSON from text (may be wrapped in markdown code blocks)\r\n  let jsonContent = text;\r\n\r\n  // Try extracting from code block first\r\n  const codeBlockMatch = text.match(/```(?:json)?\\s*([\\s\\S]*?)```/);\r\n  if (codeBlockMatch?.[1]) {\r\n    jsonContent = codeBlockMatch[1].trim();\r\n  } else {\r\n    // Try to find raw JSON array or object\r\n    const jsonMatch = text.match(/[\\[{][\\s\\S]*[\\]}]/);\r\n    if (jsonMatch) {\r\n      jsonContent = jsonMatch[0];\r\n    }\r\n  }\r\n\r\n  // Parse JSON\r\n  let raw: unknown;\r\n  try {\r\n    raw = JSON.parse(jsonContent);\r\n  } catch (parseError) {\r\n    // Try fixing truncated JSON\r\n    let fixed = jsonContent.replace(/,\\s*$/, '');\r\n    const openBraces = (fixed.match(/\\{/g) || []).length;\r\n    const closeBraces = (fixed.match(/\\}/g) || []).length;\r\n    const openBrackets = (fixed.match(/\\[/g) || []).length;\r\n    const closeBrackets = (fixed.match(/\\]/g) || []).length;\r\n    for (let i = 0; i < openBraces - closeBraces; i++) fixed += '}';\r\n    for (let i = 0; i < openBrackets - closeBrackets; i++) fixed += ']';\r\n\r\n    try {\r\n      raw = JSON.parse(fixed);\r\n    } catch {\r\n      logger.error({ module: 'llmValidation', context, textSnippet: text.slice(0, 200) },\r\n        'Failed to parse LLM JSON response');\r\n      throw new Error(`Failed to parse LLM response JSON in ${context}`);\r\n    }\r\n  }\r\n\r\n  // Validate with Zod\r\n  const result = schema.safeParse(raw);\r\n  if (!result.success) {\r\n    logger.warn({\r\n      module: 'llmValidation',\r\n      context,\r\n      errors: result.error.issues.map(i => `${i.path.join('.')}: ${i.message}`),\r\n    }, 'LLM response failed Zod validation, using defaults where possible');\r\n\r\n    // Try again with passthrough to get partial data\r\n    // If the schema has defaults, this might still produce usable output\r\n    try {\r\n      return schema.parse(raw);\r\n    } catch {\r\n      throw new Error(`LLM response validation failed in ${context}: ${result.error.issues.map(i => i.message).join(', ')}`);\r\n    }\r\n  }\r\n\r\n  return result.data;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\validation\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\webhooks\\observabilityWebhook.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'telemetry' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"telemetry"},"fix":{"range":[391,440],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[881,884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[881,884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Webhook Handler for Observability Alerts\r\n * \r\n * This endpoint receives alerts from Axiom/Grafana and can:\r\n * 1. Auto-create GitHub Issues for bugs\r\n * 2. Take automated actions (block users, enable maintenance mode)\r\n * 3. Notify team via Slack/Discord\r\n * \r\n * Connect your observability platform to POST to /api/webhooks/observability\r\n */\r\n\r\nimport { Router } from 'express';\r\nimport { telemetry } from '../instrumentation';\r\nimport { logger } from '../lib/logger';\r\n\r\nconst router = Router();\r\n\r\n// Types for incoming alerts\r\ninterface ObservabilityAlert {\r\n  alertName: string;\r\n  severity: 'info' | 'warning' | 'critical';\r\n  message: string;\r\n  timestamp: string;\r\n  data: {\r\n    endpoint?: string;\r\n    errorType?: string;\r\n    errorCount?: number;\r\n    userId?: string;\r\n    ip?: string;\r\n    threshold?: number;\r\n    currentValue?: number;\r\n    [key: string]: any;\r\n  };\r\n}\r\n\r\n// GitHub Issue creation (requires GITHUB_TOKEN env var)\r\nasync function createGitHubIssue(title: string, body: string, labels: string[] = ['bug', 'auto-created']) {\r\n  const token = process.env.GITHUB_TOKEN;\r\n  const repo = process.env.GITHUB_REPO; // format: \"owner/repo\"\r\n\r\n  if (!token || !repo) {\r\n    logger.info({ module: 'Webhook' }, 'GitHub not configured, skipping issue creation');\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`https://api.github.com/repos/${repo}/issues`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`,\r\n        'Accept': 'application/vnd.github.v3+json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ title, body, labels }),\r\n    });\r\n\r\n    if (response.ok) {\r\n      const issue = await response.json();\r\n      logger.info({ module: 'Webhook', issueNumber: issue.number, title }, 'Created GitHub Issue');\r\n      return issue;\r\n    } else {\r\n      logger.error({ module: 'Webhook', response: await response.text() }, 'Failed to create GitHub issue');\r\n      return null;\r\n    }\r\n  } catch (error) {\r\n    logger.error({ module: 'Webhook', err: error }, 'Error creating GitHub issue');\r\n    return null;\r\n  }\r\n}\r\n\r\n// Slack notification (requires SLACK_WEBHOOK_URL env var)\r\nasync function notifySlack(message: string, severity: string) {\r\n  const webhookUrl = process.env.SLACK_WEBHOOK_URL;\r\n\r\n  if (!webhookUrl) {\r\n    logger.info({ module: 'Webhook' }, 'Slack not configured, skipping notification');\r\n    return;\r\n  }\r\n\r\n  const emoji = severity === 'critical' ? '' : severity === 'warning' ? '' : '';\r\n\r\n  try {\r\n    await fetch(webhookUrl, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        text: `${emoji} *${severity.toUpperCase()}*: ${message}`,\r\n      }),\r\n    });\r\n  } catch (error) {\r\n    logger.error({ module: 'Webhook', err: error }, 'Error sending Slack notification');\r\n  }\r\n}\r\n\r\n// Main webhook endpoint\r\nrouter.post('/observability', async (req, res) => {\r\n  try {\r\n    const alert: ObservabilityAlert = req.body;\r\n\r\n    logger.info({ module: 'Webhook', alertName: alert.alertName, severity: alert.severity }, 'Received alert');\r\n\r\n    // Handle different alert types\r\n    switch (alert.alertName) {\r\n      // =============================================\r\n      // ERROR SPIKE - Auto-create GitHub Issue\r\n      // =============================================\r\n      case 'high_error_rate':\r\n      case 'error_spike': {\r\n        const issueBody = `\r\n##  Automated Bug Report\r\n\r\n**Alert:** ${alert.alertName}\r\n**Severity:** ${alert.severity}\r\n**Time:** ${alert.timestamp}\r\n\r\n### Details\r\n- **Endpoint:** ${alert.data.endpoint || 'Unknown'}\r\n- **Error Type:** ${alert.data.errorType || 'Unknown'}\r\n- **Error Count:** ${alert.data.errorCount || 'Unknown'}\r\n- **Threshold:** ${alert.data.threshold}\r\n- **Current Value:** ${alert.data.currentValue}\r\n\r\n### Context\r\nThis issue was automatically created by the observability system when error rates exceeded the threshold.\r\n\r\n### Next Steps\r\n1. Check the observability dashboard for detailed traces\r\n2. Review recent deployments\r\n3. Check external service status (Gemini API, database)\r\n\r\n---\r\n*Auto-generated by Observability Webhook*\r\n        `;\r\n\r\n        await createGitHubIssue(\r\n          `[Auto] Error spike detected on ${alert.data.endpoint || 'API'}`,\r\n          issueBody,\r\n          ['bug', 'auto-created', 'priority-high']\r\n        );\r\n        \r\n        await notifySlack(\r\n          `Error spike detected! ${alert.data.errorCount} errors on ${alert.data.endpoint}. GitHub issue created.`,\r\n          alert.severity\r\n        );\r\n        break;\r\n      }\r\n\r\n      // =============================================\r\n      // USER SPENDING LIMIT - Disable user\r\n      // =============================================\r\n      case 'user_spending_limit': {\r\n        const userId = alert.data.userId;\r\n\r\n        if (userId) {\r\n          // Here you would disable the user in your database\r\n          // await storage.setUserLimit(userId, { exceeded: true });\r\n\r\n          logger.info({ module: 'Webhook', userId }, 'Would disable user for exceeding spending limit');\r\n          \r\n          await notifySlack(\r\n            `User ${userId} exceeded spending limit ($${alert.data.currentValue}). Account flagged.`,\r\n            'warning'\r\n          );\r\n        }\r\n        break;\r\n      }\r\n\r\n      // =============================================\r\n      // BRUTE FORCE - Block IP\r\n      // =============================================\r\n      case 'brute_force_detected': {\r\n        const ip = alert.data.ip;\r\n\r\n        if (ip) {\r\n          // Here you would block the IP in Redis\r\n          // await redis.sadd('blocked_ips', ip);\r\n          // await redis.expire(`blocked_ip:${ip}`, 86400); // 24 hours\r\n\r\n          logger.info({ module: 'Webhook', ip }, 'Would block IP for brute force attempt');\r\n          \r\n          await notifySlack(\r\n            `Brute force detected from IP ${ip}. ${alert.data.errorCount} failed attempts. IP blocked.`,\r\n            'critical'\r\n          );\r\n        }\r\n        break;\r\n      }\r\n\r\n      // =============================================\r\n      // GEMINI API DEGRADED - Notify\r\n      // =============================================\r\n      case 'gemini_latency_high':\r\n      case 'external_api_slow': {\r\n        await notifySlack(\r\n          `Gemini API is slow (${alert.data.currentValue}ms avg). This may affect user experience.`,\r\n          'warning'\r\n        );\r\n        break;\r\n      }\r\n\r\n      // =============================================\r\n      // DAILY COST EXCEEDED - Notify\r\n      // =============================================\r\n      case 'daily_cost_exceeded': {\r\n        await notifySlack(\r\n          `Daily Gemini cost exceeded $${alert.data.threshold}. Current: $${alert.data.currentValue}`,\r\n          'warning'\r\n        );\r\n        break;\r\n      }\r\n\r\n      default:\r\n        logger.info({ module: 'Webhook', alertName: alert.alertName }, 'Unhandled alert type');\r\n    }\r\n\r\n    res.json({ received: true, alertName: alert.alertName });\r\n  } catch (error) {\r\n    logger.error({ module: 'Webhook', err: error }, 'Error processing alert');\r\n    res.status(500).json({ error: 'Failed to process alert' });\r\n  }\r\n});\r\n\r\n// Health check endpoint\r\nrouter.get('/observability/health', (req, res) => {\r\n  res.json({ status: 'ok', timestamp: new Date().toISOString() });\r\n});\r\n\r\nexport default router;\r\n\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\server\\workers\\generationWorkerInstance.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\shared\\contentTemplates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\shared\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\shared\\types\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\shared\\types\\ideaBank.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\test-axiom.ts","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":16,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":16,"endColumn":12,"suggestions":[{"fix":{"range":[356,390],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":17,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":17,"endColumn":12,"suggestions":[{"fix":{"range":[392,466],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":18,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":18,"endColumn":12,"suggestions":[{"fix":{"range":[468,526],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":19,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":19,"endColumn":12,"suggestions":[{"fix":{"range":[528,544],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":25,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":25,"endColumn":12,"suggestions":[{"fix":{"range":[699,748],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":28,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":28,"endColumn":12,"suggestions":[{"fix":{"range":[783,826],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":35,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":35,"endColumn":12,"suggestions":[{"fix":{"range":[924,971],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":46,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":46,"endColumn":12,"suggestions":[{"fix":{"range":[1185,1221],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":54,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":54,"endColumn":12,"suggestions":[{"fix":{"range":[1356,1391],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":55,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":55,"endColumn":12,"suggestions":[{"fix":{"range":[1393,1442],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":12,"suggestions":[{"fix":{"range":[1444,1489],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":57,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":57,"endColumn":12,"suggestions":[{"fix":{"range":[1491,1548],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":58,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":58,"endColumn":12,"suggestions":[{"fix":{"range":[1550,1618],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":59,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":59,"endColumn":12,"suggestions":[{"fix":{"range":[1620,1655],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":60,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":60,"endColumn":12,"suggestions":[{"fix":{"range":[1657,1712],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":61,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":61,"endColumn":12,"suggestions":[{"fix":{"range":[1714,1771],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":62,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":62,"endColumn":12,"suggestions":[{"fix":{"range":[1773,1826],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":66,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":66,"endColumn":14,"suggestions":[{"fix":{"range":[1900,1962],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":68,"endColumn":16,"suggestions":[{"fix":{"range":[1990,2030],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vite-plugin-meta-images.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2345,2348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2345,2348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":77,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":77,"endColumn":16,"suggestions":[{"fix":{"range":[2413,2434],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console */\r\nimport type { Plugin } from 'vite';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\n/**\r\n * Vite plugin that updates og:image and twitter:image meta tags\r\n * to point to the app's opengraph image with the correct Replit domain.\r\n */\r\nexport function metaImagesPlugin(): Plugin {\r\n  return {\r\n    name: 'vite-plugin-meta-images',\r\n    transformIndexHtml(html) {\r\n      const baseUrl = getDeploymentUrl();\r\n      if (!baseUrl) {\r\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\r\n        return html;\r\n      }\r\n\r\n      // Check if opengraph image exists in public directory\r\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\r\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\r\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\r\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\r\n\r\n      let imageExt: string | null = null;\r\n      if (fs.existsSync(opengraphPngPath)) {\r\n        imageExt = 'png';\r\n      } else if (fs.existsSync(opengraphJpgPath)) {\r\n        imageExt = 'jpg';\r\n      } else if (fs.existsSync(opengraphJpegPath)) {\r\n        imageExt = 'jpeg';\r\n      }\r\n\r\n      if (!imageExt) {\r\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\r\n        return html;\r\n      }\r\n\r\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\r\n\r\n      log('[meta-images] updating meta image tags to:', imageUrl);\r\n\r\n      html = html.replace(\r\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\r\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\r\n      );\r\n\r\n      html = html.replace(\r\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\r\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\r\n      );\r\n\r\n      return html;\r\n    },\r\n  };\r\n}\r\n\r\nfunction getDeploymentUrl(): string | null {\r\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\r\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\r\n    log('[meta-images] using internal app domain:', url);\r\n    return url;\r\n  }\r\n\r\n  if (process.env.REPLIT_DEV_DOMAIN) {\r\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\r\n    log('[meta-images] using dev domain:', url);\r\n    return url;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction log(...args: any[]): void {\r\n  if (process.env.NODE_ENV === 'production') {\r\n    console.log(...args);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vitest.client.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vitest.client.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vitest.server.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\avibm\\worktrees\\w7-lint\\vitest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]